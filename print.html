<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Rust Programming Language</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="ferris.css">
        <link rel="stylesheet" href="theme/2018-edition.css">
        <link rel="stylesheet" href="theme/semantic-notes.css">
        <link rel="stylesheet" href="theme/listing.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Programming Language</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-rust-programming-language"><a class="header" href="#the-rust-programming-language">The Rust Programming Language</a></h1>
<p><em>by Steve Klabnik and Carol Nichols, with contributions from the Rust Community</em></p>
<p>This version of the text assumes youâ€™re using Rust 1.67.1 (released 2023-02-09)
or later. See the <a href="ch01-01-installation.html">â€œInstallationâ€ section of Chapter 1</a><!-- ignore -->
to install or update Rust.</p>
<p>The HTML format is available online at
<a href="https://doc.rust-lang.org/stable/book/">https://doc.rust-lang.org/stable/book/</a>
and offline with installations of Rust made with <code>rustup</code>; run <code>rustup docs --book</code> to open.</p>
<p>Several community <a href="appendix-06-translation.html">translations</a> are also available.</p>
<p>This text is available in <a href="https://nostarch.com/rust-programming-language-2nd-edition">paperback and ebook format from No Starch
Press</a>.</p>
<blockquote>
<p><strong>ğŸš¨ Want a more interactive learning experience? Try out a different version
of the Rust Book, featuring: quizzes, highlighting, visualizations, and
more</strong>: <a href="https://rust-book.cs.brown.edu">https://rust-book.cs.brown.edu</a></p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lá»i-nÃ³i-Ä‘áº§u"><a class="header" href="#lá»i-nÃ³i-Ä‘áº§u">Lá»i nÃ³i Ä‘áº§u</a></h1>
<p>TrÆ°á»›c Ä‘Ã¢y Ä‘iá»u nÃ y khÃ´ng pháº£i lÃºc nÃ o cÅ©ng rÃµ rÃ ng,
nhÆ°ng ngÃ´n ngá»¯ láº­p trÃ¬nh Rust vá» cÆ¡ báº£n nÃ³i vá» <em>sá»©c máº¡nh</em>:
báº¥t ká»ƒ báº¡n Ä‘ang viáº¿t loáº¡i code nÃ o, Rust giÃºp báº¡n
má»Ÿ rá»™ng kháº£ nÄƒng, láº­p trÃ¬nh vá»›i sá»± tá»± tin trong
nhiá»u lÄ©nh vá»±c hÆ¡n trÆ°á»›c Ä‘Ã¢y.</p>
<p>VÃ­ dá»¥, cÃ´ng viá»‡c â€œcáº¥p há»‡ thá»‘ngâ€ liÃªn quan Ä‘áº¿n cÃ¡c chi tiáº¿t
tháº¥p cá»§a quáº£n lÃ½ bá»™ nhá»›, biá»ƒu diá»…n dá»¯ liá»‡u vÃ  Ä‘a luá»“ng.
Truyá»n thá»‘ng, lÄ©nh vá»±c nÃ y Ä‘Æ°á»£c xem lÃ  khÃ³ tiáº¿p cáº­n,
chá»‰ dÃ nh cho má»™t sá»‘ Ã­t ngÆ°á»i Ä‘Ã£ dÃ nh nhiá»u nÄƒm há»c cÃ¡ch trÃ¡nh cÃ¡c lá»—i kinh Ä‘iá»ƒn.
VÃ  ngay cáº£ nhá»¯ng ngÆ°á»i thá»±c hÃ nh cÅ©ng lÃ m viá»‡c tháº­n trá»ng,
Ä‘á»ƒ code khÃ´ng gáº·p lá»—i, bá»‹ crash hay bá»‹ há»ng dá»¯ liá»‡u.</p>
<p>Rust phÃ¡ vá»¡ cÃ¡c rÃ o cáº£n nÃ y báº±ng cÃ¡ch loáº¡i bá» nhá»¯ng cáº¡m báº«y
cÅ© vÃ  cung cáº¥p má»™t bá»™ cÃ´ng cá»¥ thÃ¢n thiá»‡n, tinh táº¿ Ä‘á»ƒ há»— trá»£ báº¡n.
CÃ¡c láº­p trÃ¬nh viÃªn cáº§n â€œcháº¡mâ€ xuá»‘ng má»©c Ä‘iá»u khiá»ƒn tháº¥p cÃ³ thá»ƒ
lÃ m Ä‘iá»u Ä‘Ã³ vá»›i Rust mÃ  khÃ´ng gáº·p rá»§i ro thÃ´ng thÆ°á»ng vá» crash
hay lá»— há»•ng báº£o máº­t, vÃ  khÃ´ng cáº§n há»c háº¿t cÃ¡c chi tiáº¿t phá»©c táº¡p cá»§a toolchain.
HÆ¡n ná»¯a, ngÃ´n ngá»¯ Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ hÆ°á»›ng báº¡n má»™t cÃ¡ch tá»± nhiÃªn
tá»›i code Ä‘Ã¡ng tin cáº­y, hiá»‡u quáº£ vá» tá»‘c Ä‘á»™ vÃ  bá»™ nhá»›.</p>
<p>CÃ¡c láº­p trÃ¬nh viÃªn Ä‘Ã£ lÃ m viá»‡c vá»›i code cáº¥p tháº¥p cÃ³ thá»ƒ
dÃ¹ng Rust Ä‘á»ƒ nÃ¢ng cao tham vá»ng. VÃ­ dá»¥, Ä‘Æ°a song song hÃ³a (parallelism)
vÃ o Rust lÃ  má»™t thao tÃ¡c tÆ°Æ¡ng Ä‘á»‘i an toÃ n: compiler
sáº½ báº¯t lá»—i cá»• Ä‘iá»ƒn cho báº¡n. Báº¡n cÅ©ng cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c
tá»‘i Æ°u máº¡nh máº½ hÆ¡n trong code vá»›i sá»± tá»± tin ráº±ng báº¡n sáº½
khÃ´ng vÃ´ tÃ¬nh gÃ¢y crash hay lá»— há»•ng.</p>
<p>NhÆ°ng Rust khÃ´ng giá»›i háº¡n á»Ÿ láº­p trÃ¬nh há»‡ thá»‘ng tháº¥p.
NÃ³ Ä‘á»§ biá»ƒu cáº£m vÃ  tiá»‡n lá»£i Ä‘á»ƒ viáº¿t cÃ¡c á»©ng dá»¥ng CLI,
web server, vÃ  nhiá»u loáº¡i code khÃ¡c ráº¥t dá»… chá»‹u â€”
báº¡n sáº½ tháº¥y cÃ¡c vÃ­ dá»¥ Ä‘Æ¡n giáº£n vá» cáº£ hai sau nÃ y trong sÃ¡ch.
LÃ m viá»‡c vá»›i Rust giÃºp báº¡n xÃ¢y dá»±ng cÃ¡c ká»¹ nÄƒng cÃ³ thá»ƒ chuyá»ƒn
tá»« lÄ©nh vá»±c nÃ y sang lÄ©nh vá»±c khÃ¡c; báº¡n cÃ³ thá»ƒ há»c Rust
báº±ng cÃ¡ch viáº¿t web app, sau Ä‘Ã³ Ã¡p dá»¥ng ká»¹ nÄƒng Ä‘Ã³ trÃªn Raspberry Pi cá»§a mÃ¬nh.</p>
<p>Cuá»‘n sÃ¡ch nÃ y hoÃ n toÃ n khai thÃ¡c tiá»m nÄƒng cá»§a Rust
Ä‘á»ƒ trao quyá»n cho ngÆ°á»i dÃ¹ng. ÄÃ¢y lÃ  má»™t vÄƒn báº£n thÃ¢n thiá»‡n,
dá»… tiáº¿p cáº­n, nháº±m giÃºp báº¡n nÃ¢ng cao khÃ´ng chá»‰ kiáº¿n thá»©c vá»
Rust mÃ  cÃ²n cáº£ pháº¡m vi vÃ  sá»± tá»± tin cá»§a báº¡n vá»›i tÆ° cÃ¡ch láº­p trÃ¬nh viÃªn.
Váº­y hÃ£y báº¯t Ä‘áº§u, sáºµn sÃ ng há»c há»i â€” vÃ  chÃ o má»«ng báº¡n Ä‘áº¿n vá»›i cá»™ng Ä‘á»“ng Rust!</p>
<p>â€” Nicholas Matsakis vÃ  Aaron Turon</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="giá»›i-thiá»‡u"><a class="header" href="#giá»›i-thiá»‡u">Giá»›i thiá»‡u</a></h1>
<blockquote>
<p>Ghi chÃº: PhiÃªn báº£n nÃ y cÅ©ng chÃ­nh lÃ  phiÃªn báº£n in <a href="https://nostarch.com/rust">The Rust Programming
Language</a> vÃ  ebook <a href="https://nostarch.com/">No Starch
Press</a> cá»§a sÃ¡ch.</p>
</blockquote>
<p>ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i <em>NgÃ´n ngá»¯ láº­p trÃ¬nh Rust</em>, má»™t cuá»‘n sÃ¡ch giá»›i thiá»‡u vá» Rust.
â€œNgÃ´n ngá»¯ láº­p trÃ¬nh Rustâ€ sáº½ giÃºp báº¡n viáº¿t cÃ¡c pháº§n má»m nhanh vÃ  tin cáº­y hÆ¡n.
Viá»‡c thiáº¿t káº¿ ngÃ´n ngá»¯ láº­p trÃ¬nh luÃ´n pháº£i giáº£i quyáº¿t bÃ i toÃ¡n xung Ä‘á»™t giá»¯a
kiá»ƒm soÃ¡t á»Ÿ cáº¥p tháº¥p vÃ  viá»‡c há»— trá»£ con ngÆ°á»i á»Ÿ báº­c cao; Rust thÃ¡ch thá»©c sá»± xung Ä‘á»™t
nÃ y. ThÃ´ng qua kháº£ nÄƒng cÃ¢n báº±ng giá»¯a kháº£ nÄƒng tiáº¿p thu cÃ´ng nghá»‡ máº¡nh máº½ vÃ  kinh nghiá»‡m
phÃ¡t triá»ƒn tuyá»‡t vá»i, Rust cung cáº¥p cho báº¡n kháº£ nÄƒng kiá»ƒm soÃ¡t cÃ¡c chi tiáº¿t á»Ÿ cáº¥p Ä‘á»™
tháº¥p (cháº³ng háº¡n viá»‡c sá»­ dá»¥ng bá»™ nhá»›) mÃ  váº«n trÃ¡nh Ä‘Æ°á»£c nhá»¯ng phiá»n toÃ¡i vá»‘n hay gáº·p pháº£i
khi pháº£i lÃ m viá»‡c á»Ÿ cáº¥p Ä‘á»™ nÃ y.</p>
<h2 id="rust-Ä‘Æ°á»£c-dÃ nh-cho-ai"><a class="header" href="#rust-Ä‘Æ°á»£c-dÃ nh-cho-ai">Rust Ä‘Æ°á»£c dÃ nh cho ai</a></h2>
<p>Rust khÃ¡ lÃ½ tÆ°á»Ÿng cho nhiá»u ngÆ°á»i vÃ¬ nhiá»u lÃ½ do khÃ¡c nhau. HÃ£y cÅ©ng xem qua má»™t
vÃ i trong sá»‘ nhá»¯ng nhÃ³m lÃ½ do quan trá»ng nháº¥t.</p>
<h3 id="cÃ¡c-nhÃ³m-phÃ¡t-triá»ƒn"><a class="header" href="#cÃ¡c-nhÃ³m-phÃ¡t-triá»ƒn">CÃ¡c nhÃ³m phÃ¡t triá»ƒn</a></h3>
<p>Rust Ä‘ang dáº§n chá»©ng minh nhÆ° má»™t cÃ´ng cá»¥ há»¯u hiá»‡u cho viá»‡c cá»™ng tÃ¡c giá»¯a nhá»¯ng nhÃ³m
lá»›n nhÃ  phÃ¡t triá»ƒn vá»›i cÃ¡c má»©c Ä‘á»™ kiáº¿n thá»©c vá» láº­p trÃ¬nh há»‡ thá»‘ng khÃ¡c nhau. MÃ£ lá»‡nh cáº¥p tháº¥p
thÆ°á»ng dÃ­nh pháº£i cÃ¡c loáº¡i lá»—i áº©n, vá»‘n chá»‰ cÃ³ thá»ƒ tÃ¬m tháº¥y thÃ´ng qua viá»‡c kiá»ƒm thá»­
hoáº·c review cáº©n tháº­n bá»Ÿi cÃ¡c nhÃ  phÃ¡t triá»ƒn nhiá»u kinh nghiá»‡m. Trong Rust, trÃ¬nh biÃªn
dá»‹ch Ä‘Ã³ng vai trÃ² nhÆ° ngÆ°á»i gÃ¡c cá»•ng báº±ng cÃ¡ch tá»« chá»‘i cÃ¡c loáº¡i lá»—i nhÆ° váº­y, bao gá»“m
cáº£ cÃ¡c lá»—i liÃªn quan Ä‘áº¿n viá»‡c xá»­ lÃ½ Ä‘á»“ng thá»i. Báº±ng cÃ¡ch káº¿t há»£p vá»›i trÃ¬nh dá»‹ch, nhÃ³m
phÃ¡t triá»ƒn cÃ³ thá»ƒ dÃ nh thá»i gian táº­p trung cho logic chÆ°Æ¡ng trÃ¬nh hÆ¡n lÃ  tÃ¬m kiáº¿m
cÃ¡c lá»—i.</p>
<p>Rust cÅ©ng Ä‘á»“ng thá»i cung cáº¥p cÃ¡c cÃ´ng cá»¥ há»— trá»£ phÃ¡t triá»ƒn Ä‘áº¿n cho tháº¿ giá»›i láº­p trÃ¬nh há»‡ thá»‘ng:</p>
<ul>
<li>Cargo, cÃ´ng cá»¥ quáº£n lÃ½ thÆ° viá»‡n vÃ  build, cho phÃ©p thÃªm, dá»‹ch, quáº£n lÃ½
cÃ¡c thÆ° viá»‡n phá»¥ thuá»™c dá»… dÃ ng vÃ  Ä‘á»“ng bá»™ xuyÃªn suá»‘t há»‡ sinh thÃ¡i Rust.</li>
<li>CÃ´ng cá»¥ Ä‘á»‹nh dáº¡ng code Rustfmt Ä‘áº£m báº£o sá»± Ä‘á»“ng nháº¥t vá» phong cÃ¡ch viáº¿t code giá»¯a cÃ¡c nhÃ  phÃ¡t triá»ƒn.</li>
<li>The Rust Language Server cung cáº¥p sá»©c máº¡nh cho cÃ¡c Integrated Development Environment (IDE) Ä‘á»ƒ
há»— trá»£ cÃ¡c tÃ­nh nÄƒng nhÆ° code completion vÃ  cÃ¡c thÃ´ng bÃ¡o lá»—i táº¡i chá»—.</li>
</ul>
<p>Báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c cÃ´ng cá»¥ á»Ÿ trÃªn cÅ©ng nhÆ° má»™t sá»‘ cÃ´ng cá»¥ khÃ¡c trong há»‡ sinh thÃ¡i
Rust, cÃ¡c nhÃ  phÃ¡t triá»ƒn cÃ³ thá»ƒ viáº¿t má»™t cÃ¡ch hiá»‡u quáº£ cÃ¡c mÃ£ lá»‡nh cáº¥p há»‡ thá»‘ng.</p>
<h3 id="sinh-viÃªn"><a class="header" href="#sinh-viÃªn">Sinh viÃªn</a></h3>
<p>Rust Ä‘Æ°á»£c dÃ nh cho sinh viÃªn vÃ  báº¥t ká»³ ai yÃªu thÃ­ch viá»‡c há»c cÃ¡c khÃ¡i niá»‡m
há»‡ thá»‘ng. Nhiá»u ngÆ°á»i thÃ´ng qua sá»­ dá»¥ng Rust Ä‘Ã£ há»c vá» nhá»¯ng chá»§ Ä‘á» nhÆ° phÃ¡t
triá»ƒn há»‡ Ä‘iá»u hÃ nh. Cá»™ng Ä‘Ã´ng Rust cÅ©ng ráº¥t sáºµn sÃ ng chÃ o Ä‘Ã³n vÃ  há»— trá»£ tráº£
cÃ¡c cÃ¢u há»i cá»§a sinh viÃªn. ThÃ´ng qua nhá»¯ng ná»— lá»±c tÆ°Æ¡ng tá»± nhÆ° cuá»‘n sÃ¡ch nÃ y,
cÃ¡c nhÃ³m Rust muá»‘n lÃ m cho viá»‡c hiá»ƒu cÃ¡c khÃ¡i niá»‡m vá» há»‡ thá»‘ng dá»… dÃ ng hÆ¡n vá»›i
nhiá»u ngÆ°á»i, Ä‘áº·c biá»‡t nhá»¯ng ngÆ°á»i má»›i lÃ m quen vá»›i láº­p trÃ¬nh.</p>
<h3 id="cÃ¡c-cÃ´ng-ty"><a class="header" href="#cÃ¡c-cÃ´ng-ty">CÃ¡c cÃ´ng ty</a></h3>
<p>HÃ ng trÄƒm cÃ´ng ty, cáº£ lá»›n vÃ  nhá», sá»­ dá»¥ng Rust cho nhiá»u nhiá»‡m vá»¥ khÃ¡c nhau trong
hoáº¡t Ä‘á»™ng cá»§a há». Nhá»¯ng nhiá»‡m vá»¥ Ä‘Ã³ bao gá»“m cÃ¡c cÃ´ng cá»¥ dÃ²ng lá»‡nh, dá»‹ch vá»¥ web,
cÃ¡c cÃ´ng cá»¥ DevOps, cÃ¡c thiáº¿t bá»‹ nhÃºng, cÃ¡c trÃ¬nh phÃ¢n tÃ­ch vÃ  mÃ£ hÃ³a Ã¢m thanh
hÃ¬nh áº£nh, tiá»n mÃ£ hÃ³a, tin sinh há»c, cÃ¡c mÃ¡y tÃ¬m kiáº¿m, cÃ¡c á»©ng dá»¥ng IoT, há»c mÃ¡y,
vÃ  tháº­m chÃ­ cÃ¡c pháº§n chÃ­nh cá»§a trÃ¬nh duyá»‡t web FireFox.</p>
<h3 id="cÃ¡c-nhÃ -phÃ¡t-triá»ƒn-mÃ£-nguá»“n-má»Ÿ"><a class="header" href="#cÃ¡c-nhÃ -phÃ¡t-triá»ƒn-mÃ£-nguá»“n-má»Ÿ">CÃ¡c nhÃ  phÃ¡t triá»ƒn mÃ£ nguá»“n má»Ÿ</a></h3>
<p>Rust dÃ nh cho nhá»¯ng ngÆ°á»i táº¡o nÃªn ngÃ´n ngá»¯, cá»™ng Ä‘á»“ng, cÃ´ng cá»¥ phÃ¡t triá»ƒn
vÃ  cÃ¡c thÆ° viá»‡n. ChÃºng tÃ´i sáº½ ráº¥t vui khi Ä‘Æ°á»£c báº¡n gÃ³p pháº§n xÃ¢y dá»±ng ngÃ´n ngá»¯ Rust.</p>
<h3 id="nhá»¯ng-ngÆ°á»i-quan-tÃ¢m-Ä‘áº¿n-tá»‘c-Ä‘á»™-vÃ -á»•n-Ä‘á»‹nh"><a class="header" href="#nhá»¯ng-ngÆ°á»i-quan-tÃ¢m-Ä‘áº¿n-tá»‘c-Ä‘á»™-vÃ -á»•n-Ä‘á»‹nh">Nhá»¯ng ngÆ°á»i quan tÃ¢m Ä‘áº¿n tá»‘c Ä‘á»™ vÃ  á»•n Ä‘á»‹nh</a></h3>
<p>Rust Ä‘Æ°á»£c dÃ nh cho nhá»¯ng ngÆ°á»i Ä‘am mÃª tá»‘c Ä‘á»™ vÃ  sá»± á»•n Ä‘á»‹nh trong má»™t ngÃ´n ngá»¯. Vá»›i
tá»‘c Ä‘á»™, chÃºng tÃ´i nÃ³ vá» cáº£ tá»‘c Ä‘á»™ thá»±c thi chÆ°Æ¡ng trÃ¬nh vÃ  cáº£
tá»‘c Ä‘á»™ mÃ  Rust cho phÃ©p báº¡n viáº¿t ra chÃºng. CÃ¡c phÃ©p kiá»ƒm tra cá»§a trÃ¬nh dá»‹ch Rust Ä‘áº£m
báº£o sá»± á»•n Ä‘á»‹nh thÃ´ng qua cÃ¡c Ä‘áº·c tÃ­nh thÃªm vÃ o vÃ  viá»‡c tÃ¡i cáº¥u trÃºc (refactoring).
Äiá»u nÃ y ngÆ°á»£c láº¡i vá»›i cÃ¡c mÃ£ lá»‡nh dá»…-máº¯c-lá»—i khi viáº¿t báº±ng cÃ¡c ngÃ´n ngá»¯ khÃ´ng cÃ³
cÃ¡c phÃ©p tra Ä‘Ã³, vá»‘n lÃ m cho cÃ¡c nhÃ  phÃ¡t triá»ƒn ngáº¡i viá»‡c chá»‰nh sá»­a. Báº±ng viá»‡c Ä‘Ã¡nh
vÃ o sá»± trá»«u tÆ°á»£ng, hoáº·c cÃ¡c Ä‘áº·c tÃ­nh á»Ÿ cáº¥p Ä‘á»™ cao khÃ´ng gÃ¢y phÃ¡t sinh ra thÃªm chi phÃ­
khi dá»‹ch ra mÃ£ lá»‡nh cáº¥p tháº¥p, Rust cho phÃ©p cÃ¡c mÃ£ lá»‡nh nÃ y thá»±c thi nhanh vÃ  an toÃ n
nhÆ° khi viáº¿t báº±ng tay.</p>
<p>NgÃ´n ngá»¯ Rust cÅ©ng hy vá»ng há»— trá»£ thÃªm nhiá»u ngÆ°á»i dÃ¹ng khÃ¡c; nhá»¯ng ngÆ°á»i Ä‘Æ°á»£c nháº¯c
Ä‘áº¿n á»Ÿ Ä‘Ã¢y chá»‰ Ä‘Æ¡n thuáº§n lÃ  má»™t trong sá»‘ nhá»¯ng ngÆ°á»i tham gia nhiá»u nháº¥t. Tá»•ng thá»ƒ
láº¡i, tham vá»ng lá»›n nháº¥t cá»§a Rust lÃ  loáº¡i bá» nhá»¯ng sá»± Ä‘Ã¡nh Ä‘á»•i mÃ  láº­p trÃ¬nh viÃªn pháº£i
cháº¥p nháº­n trong hÃ ng tháº­p ká»· qua, Ä‘á»ƒ cung cáº¥p sá»± an toÃ n <em>vÃ </em> nÄƒng suáº¥t, tá»‘c
Ä‘á»™ <em>vÃ </em> sá»± há»— trá»£ báº­c cao cá»§a ngÃ´n ngá»¯. HÃ£y thá»­ vÃ  xem Rust liá»‡u cÃ³ thá»ƒ trá»Ÿ thÃ nh
lá»±a chá»n cho cÃ´ng viá»‡c cá»§a báº¡n.</p>
<h2 id="cuá»‘n-sÃ¡ch-nÃ y-dÃ nh-cho-ai"><a class="header" href="#cuá»‘n-sÃ¡ch-nÃ y-dÃ nh-cho-ai">Cuá»‘n sÃ¡ch nÃ y dÃ nh cho ai</a></h2>
<p>Cuá»‘n sÃ¡ch nÃ y cho ráº±ng báº¡n Ä‘Ã£ viáº¿t code báº±ng má»™t ngÃ´n ngá»¯ khÃ¡c nhÆ°ng khÃ´ng chá»‰
rÃµ lÃ  ngÃ´n ngá»¯ nÃ o. ChÃºng tÃ´i Ä‘Ã£ cá»‘ gáº¯ng táº¡o ra cÃ¡c tÃ i liá»‡u cÃ³ thá»ƒ dÃ¹ng Ä‘Æ°á»£c
bá»Ÿi nhiá»u ngÆ°á»i vá»›i nhiá»u ná»n táº£ng láº­p trÃ¬nh khÃ¡c nhau. ChÃºng tÃ´i khÃ´ng dÃ nh nhiá»u
thá»i gian Ä‘á»ƒ nÃ³i vá» nhá»¯ng thá»© nhÆ° láº­p trÃ¬nh <em>lÃ  gÃ¬</em> vÃ  báº¡n nghÄ© vá» nÃ³ nhÆ° tháº¿ nÃ o.
Náº¿u báº¡n lÃ  ngÆ°á»i hoÃ n toÃ n má»›i vá»›i viá»‡c láº­p trÃ¬nh, cÃ³ láº½ tá»‘t hÆ¡n lÃ  báº¡n nÃªn Ä‘á»c
trÆ°á»›c má»™t quyá»ƒn sÃ¡ch chuyÃªn vá» nháº­p mÃ´n láº­p trÃ¬nh.</p>
<h2 id="sá»­-dá»¥ng-quyá»ƒn-sÃ¡ch-nÃ y-nhÆ°-tháº¿-nÃ o"><a class="header" href="#sá»­-dá»¥ng-quyá»ƒn-sÃ¡ch-nÃ y-nhÆ°-tháº¿-nÃ o">Sá»­ dá»¥ng quyá»ƒn sÃ¡ch nÃ y nhÆ° tháº¿ nÃ o</a></h2>
<p>Vá» tá»•ng thá»ƒ, quyá»ƒn sÃ¡ch nÃ y cho lÃ  báº¡n Ä‘ang Ä‘á»c tuáº§n tá»± tá»« Ä‘áº§u Ä‘áº¿n cuá»‘i. CÃ¡c chÆ°Æ¡ng
sau Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn cÃ¡c khÃ¡i niá»‡m Ä‘Æ°á»£c giá»›i thiá»‡u trong cÃ¡c chÆ°Æ¡ng trÆ°á»›c,
vÃ  cÃ¡c chÆ°Æ¡ng Ä‘áº§u cÃ³ láº½ sáº½ khÃ´ng Ä‘i vÃ o chi tiáº¿t vá» má»™t chá»§ Ä‘á» cá»¥ thá»ƒ, thay vÃ¬ váº­y
chÃºng ta sáº½ quay láº¡i chá»§ Ä‘á» Ä‘Ã³ trong cÃ¡c chÆ°Æ¡ng sau.</p>
<p>Báº¡n sáº½ tÃ¬m tháº¥y hai loáº¡i chÆ°Æ¡ng trong cuá»‘n sÃ¡ch nÃ y: cÃ¡c chÆ°Æ¡ng khÃ¡i niá»‡m vÃ  cÃ¡c chÆ°Æ¡ng
dá»± Ã¡n. Trong cÃ¡c chÆ°Æ¡ng khÃ¡i niá»‡m, báº¡n sáº½ há»c vá» má»™t khÃ­a cáº¡nh nÃ o Ä‘Ã³ cá»§a Rust. Trong
cÃ¡c chÆ°Æ¡ng dá»± Ã¡n, chÃºng ta sáº½ cÃ¹ng vá»›i nhau xÃ¢y dá»±ng cÃ¡c chÆ°Æ¡ng trÃ¬nh nhá», Ã¡p dá»¥ng
nhá»¯ng gÃ¬ cÃ¡c báº¡n Ä‘Ã£ há»c. CÃ¡c chÆ°Æ¡ng 2, 12 vÃ  20 lÃ  cÃ¡c chÆ°Æ¡ng dá»± Ã¡n; cÃ²n láº¡i lÃ  cÃ¡c
chÆ°Æ¡ng khÃ¡i niá»‡m.</p>
<p>ChÆ°Æ¡ng 1 hÆ°á»›ng dáº«n cÃ¡ch cÃ i Ä‘áº·t Rust, lÃ m sao Ä‘á»ƒ viáº¿t má»™t chÆ°Æ¡ng trÃ¬nh â€œHello, world!â€,
vÃ  lÃ m sao sá»­ dung Cargo, cÃ´ng cá»¥ quáº£n lÃ½ cÃ¡c gÃ³i thÆ° viá»‡n vÃ  build chÆ°Æ¡ng trÃ¬nh.
ChÆ°Æ¡ng 2 lÃ  má»™t pháº§n giá»›i thiá»‡u kiá»ƒu â€œtrÃªn tayâ€ vá» cÃ¡ch viáº¿t chÆ°Æ¡ng trÃ¬nh trong
ngÃ´n ngá»¯ Rust, báº¡n cÅ©ng sáº½ xÃ¢y dá»±ng má»™t trÃ² chÆ¡i Ä‘oÃ¡n sá»‘. ChÃºng ta sáº½ xem sÆ¡
cÃ¡c khÃ¡i niá»‡m á»Ÿ cáº¥p cao, rá»“i cÃ¡c chÆ°Æ¡ng sau Ä‘Ã³ sáº½ cung cáº¥p thÃªm cÃ¡c chi tiáº¿t. Náº¿u
báº¡n muá»‘n vá»c váº¡ch ngay, chÆ°Æ¡ng nÃ y lÃ  dÃ nh cho báº¡n. Äáº§u tiÃªn, cÃ³ láº½ báº¡n sáº½ muá»‘n
bá» qua chÆ°Æ¡ng 3, vá»‘n giá»›i thiá»‡u cÃ¡c Ä‘áº·c tÃ­nh cá»§a Rust tÆ°Æ¡ng tá»± trong cÃ¡c ngÃ´n
ngá»¯ khÃ¡c, vÃ  nháº£y ngay Ä‘áº¿n chÆ°Æ¡ng 4 Ä‘á»ƒ há»c vá» há»‡ thá»‘ng ownership cá»§a Rust. Tuy nhiÃªn,
náº¿u báº¡n lÃ  má»™t ngÆ°á»i há»c cáº©n trá»ng muá»‘n há»c táº¥t cáº£ cÃ¡c chi tiáº¿t trÆ°á»›c khi chuyá»ƒn Ä‘áº¿n
pháº§n káº¿ tiáº¿p, cÃ³ láº½ báº¡n sáº½ bá» qua chÆ°Æ¡ng 2 vÃ  Ä‘i tháº³ng Ä‘áº¿n chÆ°Æ¡ng 3, trá»Ÿ vá» láº¡i chÆ°Æ¡ng 2
khi báº¡n muá»‘n Ã¡p dá»¥ng nhá»¯ng chi  tiáº¿t mÃ  báº¡n Ä‘Ã£ há»c.</p>
<p>ChÆ°Æ¡ng 5 tháº£o luáº­n vá» struct vÃ  method, chÆ°Æ¡ng 6 giá»›i thiá»‡u vá» enum, cÃ¡c biá»ƒu thá»©c <code>match</code>,
vÃ  cáº¥u trÃºc Ä‘iá»u khiá»ƒn <code>if let</code>. Báº¡n sáº½ dÃ¹ng struct vÃ  enum Ä‘á»ƒ táº¡o ra cÃ¡c kiá»ƒu tÃ¹y biáº¿n
trong Rust.</p>
<p>Trong chÆ°Æ¡ng 7, báº¡n sáº½ há»c vá» há»‡ thá»‘ng module cá»§a Rust vÃ  vá» cÃ¡c quy táº¯c riÃªng tÆ°
khi tá»• chá»©c mÃ£ nguá»“n vÃ  há»‡ thá»‘ng Application Programming Interface (API) cá»§a nÃ³.
ChÆ°Æ¡ng 8 tháº£o luáº­n vá» má»™t sá»‘ kiá»ƒu táº­p hÆ¡n (collection) mÃ  cÃ¡c thÆ° viá»‡n chuáº©n cung
cáº¥p, nhÆ° vector, string vÃ  hash map. ChÆ°Æ¡ng 9 khÃ¡m phÃ¡ cÃ¡c triáº¿t lÃ½ cÅ©ng nhÆ° ká»¹ thuáº­t cá»§a
Rust trong viá»‡c xá»­ lÃ½ lá»—i.</p>
<p>ChÆ°Æ¡ng 10 Ä‘Ã o sÃ¢u vÃ  generic, strait vÃ  vÃ²ng Ä‘á»i, thá»© mang láº¡i sá»©c máº¡nh Ä‘á»ƒ táº¡o
ra cÃ¡c mÃ£ lá»‡nh cÃ³ thá»ƒ dÃ¹ng Ä‘Æ°á»£c vá»›i nhiá»u kiá»ƒu dá»¯ liá»‡u khÃ¡c nhau. ChÆ°Æ¡ng 11 nÃ³i hoÃ n toÃ n
vá» kiá»ƒm thá»­, thá»© cáº§n cÃ³ Ä‘á»ƒ Ä‘áº£m báº£o logic chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n lÃ  chÃ­nh xÃ¡c, ngay cáº£ khi
Ä‘Ã£ cÃ³ há»‡ thá»‘ng an toÃ n cá»§a Rust. Trong chÆ°Æ¡ng 12, chÃºng ta sáº½ xÃ¢y dá»±ng má»™t táº­p con cÃ¡c
tÃ­nh nÄƒng tá»« cÃ¢u lá»‡nh <code>grep</code>, cho phÃ©p tÃ¬m kiáº¿m cÃ¡c Ä‘oáº¡n vÄƒn báº£n bÃªn trong cÃ¡c file.
Äá»ƒ lÃ m Ä‘iá»u nÃ y, chÃºng ta sáº½ dÃ¹ng nhiá»u cÃ¡c khÃ¡i niá»‡m Ä‘Ã£ tháº£o luáº­n trong cÃ¡c chÆ°Æ¡ng trÆ°á»›c.</p>
<p>ChÆ°Æ¡ng 13 khÃ¡m phÃ¡ closure vÃ  iterator: cÃ¡c tÃ­nh nÄƒng cá»§a Rust vá»‘n Ä‘áº¿n tá»« cÃ¡c ngÃ´n
ngá»¯ láº­p trÃ¬nh hÃ m (functional programming). Trong chÆ°Æ¡ng 14, chÃºng ta sáº½ kháº£o sÃ¡t láº¡i
Cargo sÃ¢u hÆ¡n vÃ  nÃ³i vá» cÃ¡c phÆ°Æ¡ng phÃ¡p hay nháº¥t Ä‘á»ƒ chia sáº» thÆ° viá»‡n cá»§a báº¡n vá»›i nhá»¯ng ngÆ°á»i
khÃ¡c. ChÆ°Æ¡ng 15 tháº£o luáº­n vá» cÃ¡c con trá» thÃ´ng minh mÃ  cÃ¡c thÆ° viá»‡n chuáº©n cung cáº¥p, Ä‘á»“ng thá»i
nÃ³i vá» cÃ¡c trait cho phÃ©p chÃºng hoáº¡t Ä‘á»™ng.</p>
<p>Trong chÆ°Æ¡ng 16, chÃºng ta sáº½ dáº¡o qua cÃ¡c mÃ´ hÃ¬nh khÃ¡c nhau cá»§a láº­p trÃ¬nh song song vÃ  nÃ³i
vá» cÃ¡ch Rust há»— trá»£ báº¡n viáº¿t Ä‘a luá»“ng má»™t cÃ¡ch dá»… dÃ ng. ChÆ°Æ¡ng 17 so sÃ¡nh má»™t sá»‘ thÃ nh pháº§n trong
Rust vá»›i cÃ¡c khÃ¡i niá»‡m hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng mÃ  cÃ³ láº½ báº¡n Ä‘Ã£ quen thuá»™c.</p>
<p>ChÆ°Æ¡ng 18 lÃ  pháº§n tham kháº£o vá» máº«u vÃ  khá»›p máº«u, vá»‘n lÃ  nhá»¯ng cÃ¡ch thá»©c máº¡nh máº½ Ä‘á»ƒ
biá»ƒu Ä‘áº¡t cÃ¡c Ã½ tÆ°á»Ÿng trong suá»‘t cÃ¡c chÆ°Æ¡ng trÃ¬nh Rust. ChÆ°Æ¡ng 19 lÃ  má»™t bá»¯a Ä‘áº¡i tiá»‡c vá»›i
nhiá»u chá»§ Ä‘á» nÃ¢ng cao khÃ¡c nhau, bao gá»“m unsafe Rust, macro, vÃ  nÃ³i thÃªm vá» vÃ²ng Ä‘á»i, trait,
type, function vÃ  closure.</p>
<p>Trong chÆ°Æ¡ng 20, chÃºng ta sáº½ hoÃ n thÃ nh má»™t mÃ¡y chá»§ web Ä‘a luá»“ng cáº¥p tháº¥p.</p>
<p>Cuá»‘i cÃ¹ng, cÃ¡c phá»¥ lá»¥c sáº½ chá»©a nhiá»u thÃ´ng tin há»¯u Ã­ch vá» ngÃ´n ngá»¯ theo dáº¡ng liá»‡t kÃª dá»… dÃ ng Ä‘á»ƒ
tham kháº£o. Phá»¥ lá»¥c A chá»©a cÃ¡c tá»« khÃ³a cá»§a Rust, phá»¥ lá»¥c B chá»©a cÃ¡c toÃ¡n tá»« vÃ  kÃ½ hiá»‡u, phá»¥ lá»¥c C
chá»©a cÃ¡c trait cÃ³ thá»ƒ dáº«n xuáº¥t láº¡i Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n chuáº©n, phá»¥ lá»¥c D nÃ³i vá» cÃ¡c cÃ´ng cá»¥
phÃ¡t triá»ƒn há»¯u Ã­ch, vÃ  phá»¥ lá»¥c E nÃ³i vá» cÃ¡c phiÃªn báº£n cá»§a Rust.</p>
<p>Sáº½ khÃ´ng cÃ³ má»™t cÃ¡ch sai Ä‘á»ƒ Ä‘á»c quyá»ƒn sÃ¡ch nÃ y: náº¿u báº¡n muá»‘n nháº£y qua má»™t vÃ i pháº§n, cá»© viá»‡c! Báº¡n
cÅ©ng cÃ³ thá»ƒ nháº£y ngÆ°á»£c láº¡i cÃ¡c chÆ°Æ¡ng trÆ°á»›c khi gáº·p pháº£i Ä‘iá»u gÃ¬ khÃ³ hiá»ƒu. Cá»© Ä‘Æ¡n giáº£n lÃ m cÃ¡i
gÃ¬ báº¡n cáº£m tháº¥y hiá»‡u quáº£.</p>
<p><span id="ferris"></span></p>
<p>Má»™t pháº§n quan trá»ng khi há»c Rust lÃ  há»c cÃ¡ch Ä‘á»c cÃ¡c thÃ´ng bÃ¡o lá»—i mÃ  trÃ¬nh biÃªn dá»‹ch hiá»ƒn thá»‹:
ChÃºng sáº½ giÃºp báº¡n táº¡o ra cÃ¡c code lÃ m viá»‡c Ä‘Æ°á»£c. Do Ä‘Ã³, chÃºng tÃ´i sáº½ cung cáº¥p nhiá»u vÃ­ dá»¥ khÃ´ng
thá»ƒ dá»‹ch Ä‘Æ°á»£c cÃ¹ng vá»›i thÃ´ng bÃ¡o lá»—i trÃ¬nh dá»‹ch sáº½ hiá»ƒn thá»‹ trong trÆ°á»ng há»£p tÆ°Æ¡ng á»©ng. HÃ£y nhá»›
náº¿u báº¡n nháº­p vÃ  cháº¡y má»™t vÃ­ dá»¥ ngáº«u nhiÃªn, nÃ³ cÃ³ thá»ƒ bá»‹ lá»—i! HÃ£y Ä‘áº£m báº£o báº¡n Ä‘Ã£ Ä‘á»c nhá»¯ng ná»™i dung
xung quanh Ä‘á»ƒ xem liá»‡u code báº¡n Ä‘ang thá»­ cháº¡y cÃ³ táº¡o ra lá»—i hay khÃ´ng. Ferris cÅ©ng sáº½ giÃºp báº¡n phÃ¢n
biá»‡t nhá»¯ng code nÃ o sáº½ khÃ´ng cháº¡y:</p>
<div class="table-wrapper"><table><thead><tr><th>Ferris</th><th>Meaning</th></tr></thead><tbody>
<tr><td><img src="img/ferris/does_not_compile.svg" class="ferris-explain" alt="Ferris with a question mark"/></td><td>Code nÃ y khÃ´ng dá»‹ch Ä‘Æ°á»£c!</td></tr>
<tr><td><img src="img/ferris/panics.svg" class="ferris-explain" alt="Ferris throwing up their hands"/></td><td>Code nÃ y trÃ´ng phÃ¡t á»›n!</td></tr>
<tr><td><img src="img/ferris/not_desired_behavior.svg" class="ferris-explain" alt="Ferris with one claw up, shrugging"/></td><td>Code nÃ y sáº½ khÃ´ng táº¡o ra káº¿t quáº£ mong muá»‘n.</td></tr>
</tbody></table>
</div>
<p>Trong háº§u háº¿t trÆ°á»ng há»£p, chÃºng tÃ´i sáº½ dáº«n báº¡n Ä‘áº¿n phiÃªn báº£n Ä‘Ãºng cá»§a báº¥t ká»³ code nÃ o khÃ´ng dá»‹ch Ä‘Æ°á»£c.</p>
<h2 id="mÃ£-nguá»“n"><a class="header" href="#mÃ£-nguá»“n">MÃ£ nguá»“n</a></h2>
<p>CÃ¡c file nguá»“n cá»§a Ä‘á»ƒ táº¡o ra cuá»‘n sÃ¡ch nÃ y cÃ³ thá»ƒ tÃ¬m tháº¥y táº¡i
<a href="https://github.com/rust-lang/book/tree/main/src">GitHub</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="báº¯t-Ä‘áº§u"><a class="header" href="#báº¯t-Ä‘áº§u">Báº¯t Ä‘áº§u</a></h1>
<p>HÃ£y cÃ¹ng báº¯t Ä‘áº§u hÃ nh trÃ¬nh cÃ¹ng Rust! CÃ³ ráº¥t nhiá»u thá»© Ä‘á»ƒ há»c, nhÆ°ng má»i
chuyáº¿n Ä‘i Ä‘á»u cÃ³ Ä‘iá»ƒm khá»Ÿi Ä‘áº§u. Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ cÃ¹ng tháº£o luáº­n vá»:</p>
<ul>
<li>CÃ i Ä‘áº·t Rust trÃªn Linux, macOS, vÃ  Windows</li>
<li>Viáº¿t má»™t chÆ°Æ¡ng trÃ¬nh in ra dÃ²ng chá»¯ <code>Hello, world!</code></li>
<li>Sá»­ dá»¥ng <code>cargo</code>, há»‡ thá»‘ng quáº£n lÃ½ cÃ¡c gÃ³i vÃ  build chÆ°Æ¡ng trÃ¬nh cá»§a Rust.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p><a id="installation"></a></p>
<h2 id="cÃ i-Ä‘áº·t"><a class="header" href="#cÃ i-Ä‘áº·t">CÃ i Ä‘áº·t</a></h2>
<p>BÆ°á»›c Ä‘áº§u tiÃªn lÃ  cÃ i Ä‘áº·t Rust. ChÃºng ta sáº½ táº£i vá» Rust thÃ´ng qua <code>rustup</code>, má»™t cÃ´ng cá»¥
dÃ²ng lá»‡nh quáº£n lÃ½ phiÃªn báº£n vÃ  cÃ¡c cÃ´ng cá»¥ cá»§a Rust. Báº¡n sáº½ cáº§n má»™t Ä‘Æ°á»ng Internet
Ä‘á»ƒ download.</p>
<blockquote>
<p>Ghi chÃº: náº¿u vÃ¬ lÃ½ do gÃ¬ Ä‘Ã³ báº¡n khÃ´ng muá»‘n dÃ¹ng <code>rustup</code>, xin Ä‘á»c pháº§n
<a href="https://forge.rust-lang.org/infra/other-installation-methods.html">Other Rust Installation Methods page</a> for more options.</p>
</blockquote>
<p>CÃ¡c bÆ°á»›c káº¿ tiáº¿p cÃ i Ä‘áº·t phiÃªn báº£n á»•n Ä‘á»‹nh má»›i nháº¥t cá»§a trÃ¬nh dá»‹ch Rust. CÃ¡c yÃªu cáº§u vá» tÃ­nh
á»•n Ä‘á»‹nh cá»§a Rust Ä‘áº£m báº£o ráº±ng táº¥t cáº£ cÃ¡c vÃ­ dá»¥ cÃ³ thá»ƒ dá»‹ch Ä‘Æ°á»£c trong sÃ¡ch váº«n cÃ³ thá»ƒ tiáº¿p tá»¥c
dá»‹ch Ä‘Æ°á»£c vá»›i cÃ¡c phiÃªn báº£n Rust má»›i hÆ¡n. CÃ¡c thÃ´ng bÃ¡o cÃ³ thá»ƒ khÃ¡c nhau má»™t chÃºt, vÃ¬ Rust
thÆ°á»ng xuyÃªn cáº£i thiá»‡n cÃ¡c thÃ´ng bÃ¡o lá»—i hoáº·c cÃ¡c cáº£nh bÃ¡o. NÃ³i cÃ¡ch khÃ¡c, báº¥t ká»³ phiÃªn báº£n
á»•n Ä‘á»‹nh má»›i hÆ¡n nÃ o cá»§a Rust cÅ©ng Ä‘á»u hoáº¡t Ä‘á»™ng vá»›i ná»™i dung cuá»‘n sÃ¡ch nÃ y.</p>
<section class="note" aria-role="note">
<h3 id="quy-Æ°á»›c-vá»-dÃ²ng-lá»‡nh"><a class="header" href="#quy-Æ°á»›c-vá»-dÃ²ng-lá»‡nh">Quy Æ°á»›c vá» dÃ²ng lá»‡nh</a></h3>
<p>Trong chÆ°Æ¡ng nÃ y cÅ©ng nhÆ° trong cÃ¡c pháº§n cÃ²n láº¡i cá»§a sÃ¡ch, chÃºng tÃ´i
sáº½ trÃ¬nh bÃ y má»™t sá»‘ cÃ¢u lá»‡nh giá»‘ng nhÆ° khi cháº¡y trong cá»­a sá»• terminal.
CÃ¡c dÃ²ng báº¡n cáº§n nháº­p vÃ o terminal sáº½ báº¯t Ä‘áº§u vá»›i <code>$</code>. Tuy nhiÃªn báº¡n
khÃ´ng cáº§n nháº­p kÃ½ tá»± <code>$</code>; nÃ³ chá»‰ Ä‘á»ƒ biá»ƒu thá»‹ vá»‹ trÃ­ báº¯t Ä‘áº§u cá»§a cÃ¡c cÃ¢u lá»‡nh.
CÃ¡c dÃ²ng khÃ´ng báº¯t Ä‘áº§u vá»›i <code>$</code> thÆ°á»ng lÃ  káº¿t quáº£ hiá»ƒn thá»‹ cá»§a cÃ¢u lá»‡nh trÆ°á»›c Ä‘Ã³.
ThÃªm ná»¯a, cÃ¡c vÃ­ dá»¥ vá»›i PowerShell sáº½ dÃ¹ng <code>&gt;</code> thay vÃ¬ <code>$</code>.</p>
</section>
<h3 id="cÃ i-Ä‘áº·t-rustup-trÃªn-linux-hoáº·c-macos"><a class="header" href="#cÃ i-Ä‘áº·t-rustup-trÃªn-linux-hoáº·c-macos">CÃ i Ä‘áº·t <code>rustup</code> trÃªn Linux hoáº·c macOS</a></h3>
<p>Náº¿u báº¡n Ä‘ang dÃ¹ng Linux hay macOS, hÃ£y má»Ÿ má»™t cá»­a sá»• terminal vÃ  gÃµ vÃ o lá»‡nh sau:</p>
<pre><code class="language-console">$ curl --proto '=https' --tlsv1.3 https://sh.rustup.rs -sSf | sh
</code></pre>
<p>CÃ¢u lá»‡nh nÃ y sáº½ táº£i vá» má»™t Ä‘oáº¡n script vÃ  báº¯t Ä‘áº§u quÃ¡ trÃ¬nh cÃ i Ä‘áº·t cÃ´ng cá»¥
<code>rustup</code>, tiáº¿p sau Ä‘Ã³ sáº½ cÃ i Ä‘áº·t phiÃªn báº£n á»•n Ä‘á»‹nh má»›i nháº¥t cá»§a Rust. Báº¡n cÃ³ thá»ƒ
Ä‘Æ°á»£c nháº¯c nháº­p vÃ o máº­t kháº©u. Náº¿u quÃ¡ trÃ¬nh cÃ i Ä‘áº·t thÃ nh cÃ´ng, dÃ²ng sau Ä‘Ã¢y sáº½ xuáº¥t hiá»‡n:</p>
<pre><code class="language-text">Rust is installed now. Great!
</code></pre>
<p>Báº¡n cÅ©ng sáº½ cáº§n má»™t trÃ¬nh liÃªn káº¿t (linker), thá»© mÃ  Rust sáº½ dÃ¹ng Ä‘á»ƒ káº¿t ná»‘i cÃ¡c
káº¿t quáº£ dá»‹ch riÃªng biá»‡t thÃ nh má»™t file duy nháº¥t. VÃ  thÆ°á»ng nÃ³ sáº½ Ä‘Æ°á»£c cÃ i Ä‘áº·t sáºµn.
Tuy nhiÃªn náº¿u báº¡n gáº·p pháº£i cÃ¡c lá»—i liÃªn káº¿t, báº¡n cáº§n cÃ i má»™t trÃ¬nh biÃªn dá»‹ch C, vÃ 
nÃ³ thÆ°á»ng sáº½ bao gá»“m cáº£ má»™t trÃ¬nh liÃªn káº¿t. Má»™t trÃ¬nh dá»‹ch C cÅ©ng cÅ©ng cáº§n thiáº¿t vÃ¬
cÃ¡c gÃ³i Rust dá»±a trÃªn mÃ£ C vÃ  do Ä‘Ã³ sáº½ cáº§n má»™t trÃ¬nh dá»‹ch C.</p>
<p>TrÃªn MacOS, báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t má»™t trÃ¬nh dá»‹ch C báº±ng cÃ¡ch cháº¡y:</p>
<pre><code class="language-console">$ xcode-select --install
</code></pre>
<p>Vá»›i  ngÆ°á»i dÃ¹ng Linux nÃ³i chung nÃªn cÃ i GCC hoáº·c Clang, tÃ¹y thuá»™c vÃ o tÃ i liá»‡u cá»§a
bá»™ phÃ¢n phá»‘i Linux mÃ  há» sá»­ dá»¥ng. VÃ­ dá»¥, náº¿u báº¡n dÃ¹ng Ubuntu, báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t gÃ³i
<code>build-essential</code>.</p>
<h3 id="cÃ i-Ä‘áº·t-rustup-trÃªn-windows"><a class="header" href="#cÃ i-Ä‘áº·t-rustup-trÃªn-windows">CÃ i Ä‘áº·t <code>rustup</code> trÃªn Windows</a></h3>
<p>TrÃªn Windows, truy cáº­p vÃ o <a href="https://www.rust-lang.org/tools/install">https://www.rust-lang.org/tools/install</a> vÃ 
theo cÃ¡c hÆ°á»›ng dáº«n Ä‘á»ƒ cÃ i Ä‘áº·t Rust. Trong lÃºc cÃ i Ä‘áº·t báº¡n sáº½ nháº­n Ä‘Æ°á»£c má»™t thÃ´ng
bÃ¡o nÃ³i vá» viá»‡c báº¡n cáº§n thÃªm cÃ¡c cÃ´ng cá»¥ build cho Visual Studio 2013 hoáº·c má»›i
hÆ¡n.
CÃ¡ch dá»… nháº¥t Ä‘á»ƒ láº¥y vá» cÃ¡c cÃ´ng cá»¥ nÃ y lÃ  cÃ i Ä‘áº·t <a href="https://visualstudio.microsoft.com/visual-cpp-build-tools/">Visual Studio
2022</a>.
Khi Ä‘Æ°á»£c há»i pháº§n nÃ o cáº§n Ä‘Æ°á»£c cÃ i Ä‘áº·t, nhá»› hÃ£y chá»n:</p>
<ul>
<li>â€œDesktop Development with C++â€.</li>
<li>Windows 10 or 11 SDK.</li>
<li>English language pack component, cÃ¹ng báº¥t ká»³ ngÃ´n ngá»¯ nÃ o báº¡n muá»‘n chá»n.</li>
</ul>
<p>CÃ¡c cÃ¢u lá»‡nh trong pháº§n cÃ²n láº¡i cá»§a cuá»‘n sÃ¡ch nÃ y sáº½ lÃ m viá»‡c vá»›i cáº£ hai <em>cmd.exe</em>
vÃ  PowerShell. Náº¿u cÃ³ gÃ¬ khÃ¡c nhau, chÃºng tÃ´i sáº½ chá»‰ ra báº¡n cáº§n sá»­ dá»¥ng cÃ¡i nÃ o.</p>
<p><a id="troubleshooting"></a></p>
<h3 id="xá»­-lÃ½-trá»¥c-tráº·c"><a class="header" href="#xá»­-lÃ½-trá»¥c-tráº·c">Xá»­ lÃ½ trá»¥c tráº·c</a></h3>
<p>Äá»ƒ kiá»ƒm tra xem báº¡n Ä‘Ã£ cÃ i Ä‘áº·t Rust Ä‘Ãºng chÆ°a, má»Ÿ má»™t cá»­a sá»• lá»‡nh má»›i vÃ  gÃµ vÃ o
dÃ²ng sau:</p>
<pre><code class="language-console">$ rustc --version
</code></pre>
<p>Báº¡n sáº½ tháº¥y sá»‘ phiÃªn báº£n, chuá»—i hash vÃ  ngÃ y commit cá»§a phiÃªn báº£n á»•n Ä‘á»‹nh má»›i nháº¥t
theo Ä‘á»‹nh dáº¡ng sau:</p>
<pre><code class="language-text">rustc x.y.z (abcabcabc yyyy-mm-dd)
</code></pre>
<p>Náº¿u báº¡n tháº¥y thÃ´ng tin nÃ y, báº¡n Ä‘Ã£ cÃ i Ä‘áº·t Rust thÃ nh cÃ´ng! Náº¿u khÃ´ng tháº¥y vÃ  báº¡n
Ä‘ang sá»­ dá»¥ng Windows, hÃ£y kiá»ƒm tra xe Rust cÃ³ trong biáº¿n mÃ´i trÆ°á»ng PATH khÃ´ng, theo
má»™t trong nhá»¯ng cÃ¡ch sau:</p>
<p>Trong cá»­a sá»• Windows CMD, sá»­ dá»¥ng:</p>
<pre><code class="language-console">&gt; echo %PATH%
</code></pre>
<p>Trong cá»­a sá»• PowerShell, sá»­ dá»¥ng:</p>
<pre><code class="language-powershell">&gt; echo $env:Path
</code></pre>
<p>Trong cá»­a sá»• Linux vÃ  macOS, sá»­ dá»¥ng:</p>
<pre><code class="language-console">$ echo $PATH
</code></pre>
<p>Náº¿u táº¥t cáº£ Ä‘á»u Ä‘Ãºng nhÆ°ng Rust váº«n khÃ´ng cháº¡y, báº¡n cÃ³ thá»ƒ tÃ¬m sá»± giÃºp Ä‘á»¡ tá»« má»™t
sá»‘ nÆ¡i. CÃ¡ch dá»… nháº¥t lÃ  kÃªnh #beginners trÃªn [the official Rust Discord][discord].
á» Ä‘Ã³ báº¡n cÃ³ thá»ƒ chat vá»›i nhá»¯ng Rustacean (nickname chÃºng tÃ´i tá»± Ä‘áº·t cho báº£n thÃ¢n) khÃ¡c
trÃªn <a href="https://www.rust-lang.org/community">the community page</a>.</p>
<h3 id="cáº­p-nháº­t-vÃ -gá»¡-bá»"><a class="header" href="#cáº­p-nháº­t-vÃ -gá»¡-bá»">Cáº­p nháº­t vÃ  gá»¡ bá»</a></h3>
<p>Sau khi Ä‘Ã£ cÃ i Ä‘áº·t xong Rust thÃ´ng qua <code>rustup</code>, viá»‡c cáº­p nháº­t phiÃªn báº£n má»›i nháº¥t
khÃ¡ Ä‘Æ¡n giáº£n. Tá»« dÃ²ng lá»‡nh, cháº¡y cÃ¢u lá»‡nh cáº­p nháº­t sau:</p>
<pre><code class="language-console">$ rustup update
</code></pre>
<p>Äá»ƒ gá»¡ bá» Rust vÃ  <code>rustup</code>, cháº¡y cÃ¢u lá»‡nh sau:</p>
<pre><code class="language-console">$ rustup self uninstall
</code></pre>
<h3 id="tÃ i-liá»‡u-trÃªn-mÃ¡y"><a class="header" href="#tÃ i-liá»‡u-trÃªn-mÃ¡y">TÃ i liá»‡u trÃªn mÃ¡y</a></h3>
<p>Báº£n cÃ i Ä‘áº·t cá»§a Rust cÅ©ng bao gá»“m má»™t báº£n sao cá»§a tÃ i liá»‡u nÃ y, dÃ³ Ä‘Ã³ báº¡n cÃ³ thá»ƒ
Ä‘á»c offline. Cháº¡y <code>rustup doc</code> Ä‘á»ƒ má»Ÿ tÃ i liá»‡u nÃ y báº±ng trÃ¬nh duyá»‡t cá»§a báº¡n.</p>
<p>Báº¥t ká»³ lÃºc nÃ o náº¿u báº¡n khÃ´ng biáº¿t má»™t kiá»ƒu dá»¯ liá»‡u hay má»™t hÃ m trong thÆ° viá»‡n chuáº©n
pháº£i Ä‘Æ°á»£c dÃ¹ng tháº¿ nÃ o, hay tra tÃ i liá»‡u application programming interface (API)!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="hello-world"><a class="header" href="#hello-world">Hello, World!</a></h2>
<p>Giá» báº¡n Ä‘Ã£ hoÃ n thÃ nh cÃ i Ä‘áº·t Rust, chÃºng ta sáº½ báº¯t Ä‘áº§u chÆ°Æ¡ng trÃ¬nh Ä‘áº§u tiÃªn.
Má»™t truyá»n thá»‘ng khi há»c ngÃ´n ngá»¯ má»›i lÃ  viáº¿t má»™t chÆ°Æ¡ng trÃ¬nh in ra dÃ²ng chá»¯
<code>Hello, world!</code> lÃªn mÃ n hÃ¬nh, vÃ  chÃºng ta cÅ©ng sáº½ lÃ m nhÆ° váº­y.</p>
<blockquote>
<p>Ghi chÃº: Quyá»ƒn sÃ¡ch nÃ y cho lÃ m báº¡n Ä‘Ã£ quen thuá»™c vá»›i dÃ²ng lá»‡nh. Rust khÃ´ng cÃ³
yÃªu cáº§u gÃ¬ Ä‘áº·c biá»‡t vá» cÃ¡c cÃ´ng cá»¥ hay trÃ¬nh soáº¡n tháº£o mÃ  báº¡n sá»­ dá»¥ng, váº­y nÃªn
báº¡n cá»© thoáº£i mÃ¡i náº¿u muá»‘n dÃ¹ng má»™t IDE nÃ o khÃ¡c thay vÃ¬ dÃ²ng lá»‡nh. Nhiá»u IDE
cung cáº¥p há»— trá»£ cho Rust á»Ÿ nhá»¯ng cáº¥p Ä‘á»™ khÃ¡c nhau; hÃ£y kiá»ƒm tra tÃ i liá»‡u vá»
IDE cá»§a báº¡n Ä‘á»ƒ cÃ³ thÃªm thÃ´ng tin. Gáº§n Ä‘Ã¢y nhÃ³m Rust Ä‘Ã£ táº­p trung vÃ o viá»‡c cung
cáº¥p cÃ¡c há»— trá»£ tuyá»‡t vá»i cho cÃ¡c IDE, vÃ  quÃ¡ trÃ¬nh nÃ y Ä‘Ã£ hoÃ n thÃ nh ráº¥t nhanh
chÃ³ng.</p>
</blockquote>
<h3 id="táº¡o-ra-má»™t-thÆ°-má»¥c-cho-dá»±-Ã¡n"><a class="header" href="#táº¡o-ra-má»™t-thÆ°-má»¥c-cho-dá»±-Ã¡n">Táº¡o ra má»™t thÆ° má»¥c cho dá»± Ã¡n</a></h3>
<p>Báº¡n sáº½ báº¯t Ä‘áº§u báº±ng viá»‡c táº¡o ra má»™t thÆ° má»¥c Ä‘á»ƒ lÆ°u mÃ£ nguá»“n Rust cá»§a báº¡n. Viá»‡c
nÃ³ náº±m á»Ÿ Ä‘Ã¢u khÃ´ng quan trá»ng, nhÆ°ng Ä‘á»ƒ dá»… dÃ ng cho viá»‡c sá»­ dá»¥ng cÃ¡c bÃ i táº­p hoáº·c
dá»± Ã¡n trong cuá»‘n sÃ¡ch nÃ y, chÃºng tÃ´i Ä‘á» nghá»‹ báº¡n nÃªn táº¡o má»™t thÆ° má»¥c <em>projects</em>
trong thÆ° má»¥c home cá»§a báº¡n vÃ  lÆ°u táº¥t cáº£ cÃ¡c dá»± Ã¡n trong Ä‘Ã³.</p>
<p>Má»Ÿ má»™t terminal vÃ  nháº­p vÃ o cÃ¡c cÃ¢u lá»‡nh sau Ä‘á»ƒ táº¡o má»™t thÆ° má»¥c <em>projects</em> vÃ  má»™t
thÆ° má»¥c con cho chÆ°Æ¡ng trÃ¬nh â€œHello, world!â€ bÃªn trong Ä‘Ã³.</p>
<p>Vá»›i Linux, macOS, vÃ  PowerShell trÃªn Windows, nháº­p vÃ o lá»‡nh sau:</p>
<pre><code class="language-console">$ mkdir ~/projects
$ cd ~/projects
$ mkdir hello_world
$ cd hello_world
</code></pre>
<p>Vá»›i dÃ²ng lá»‡nh Windows (CMD), nháº­p vÃ o:</p>
<pre><code class="language-cmd">&gt; mkdir "%USERPROFILE%\projects"
&gt; cd /d "%USERPROFILE%\projects"
&gt; mkdir hello_world
&gt; cd hello_world
</code></pre>
<h3 id="viáº¿t-vÃ -cháº¡y-má»™t-chÆ°Æ¡ng-trÃ¬nh-rust"><a class="header" href="#viáº¿t-vÃ -cháº¡y-má»™t-chÆ°Æ¡ng-trÃ¬nh-rust">Viáº¿t vÃ  cháº¡y má»™t chÆ°Æ¡ng trÃ¬nh Rust</a></h3>
<p>Tiáº¿p theo, táº¡o má»™t file mÃ£ nguá»“n vÃ  Ä‘áº·t tÃªn nÃ³ lÃ  <em>main.rs</em>. CÃ¡c file Rust luÃ´n
káº¿t thÃºc vá»›i Ä‘uÃ´i <em>.rs</em>. Náº¿u báº¡n dÃ¹ng nhiá»u hÆ¡n má»™t tá»« trong tÃªn file, hÃ£y dÃ¹ng
kÃ½ tá»± gáº¡ch dÆ°á»›i _ Ä‘á»ƒ phÃ¢n cÃ¡ch chÃºng. VÃ­ dá»¥, dÃ¹ng <em>hello_world.rs</em> thay vÃ¬
<em>helloworld.rs</em>.</p>
<p>Giá» má»Ÿ file <em>main.rs</em> báº¡n vá»«a táº¡o vÃ  nháº­p vÃ o dÃ²ng code trong Listing 1-1.</p>
<p><span class="filename">Filename: main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    println!("Hello, world!");
}</code></pre></pre>
<p><span class="caption">Listing 1-1: Má»™t chÆ°Æ¡ng trÃ¬nh in ra dÃ²ng <code>Hello, world!</code></span></p>
<p>LÆ°u láº¡i file vÃ  trá»Ÿ láº¡i cá»­a sá»• terminal. TrÃªn Linux hoáº·c macOS, nháº­p vÃ o cÃ¡c
lá»‡nh sau Ä‘á»ƒ dá»‹ch vÃ  cháº¡y:</p>
<pre><code class="language-console">$ rustc main.rs
$ ./main
Hello, world!
</code></pre>
<p>TrÃªn Windows, gÃµ vÃ o lá»‡nh <code>.\main.exe</code> thay vÃ¬ <code>./main</code>:</p>
<pre><code class="language-powershell">&gt; rustc main.rs
&gt; .\main.exe
Hello, world!
</code></pre>
<p>KhÃ´ng phá»¥ thuá»™c vÃ o há»‡ Ä‘iá»u hÃ nh nÃ o, chuá»—i <code>Hello, world!</code> sáº½ Ä‘Æ°á»£c in ra mÃ n
hÃ¬nh terminal. Náº¿u báº¡n khÃ´ng tháº¥y dÃ²ng nÃ y, hÃ£y tham kháº£o láº¡i pháº§n
<a href="ch01-01-installation.html#troubleshooting">â€œTroubleshootingâ€</a><!-- ignore --> trong pháº§n cÃ i Ä‘áº·t Ä‘á»ƒ xem
nhá»¯ng cÃ¡ch Ä‘á»ƒ tÃ¬m kiáº¿m há»— trá»£.</p>
<p>Náº¿u dÃ²ng <code>Hello, world!</code> Ä‘Æ°á»£c in ra, xin chÃºc má»«ng! Báº¡n Ä‘Ã£ chÃ­nh thá»©c viáº¿t má»™t
chÆ°Æ¡ng trÃ¬nh Rust, vÃ  báº¡n Ä‘Ã£ báº¯t Ä‘áº§u con Ä‘Æ°á»ng trá»Ÿ thÃ nh má»™t láº­p trÃ¬nh viÃªn Rust!</p>
<h3 id="má»•-xáº»-cÃ¡c-thÃ nh-pháº§n-trong-má»™t-chÆ°Æ¡ng-trÃ¬nh-rust"><a class="header" href="#má»•-xáº»-cÃ¡c-thÃ nh-pháº§n-trong-má»™t-chÆ°Æ¡ng-trÃ¬nh-rust">Má»• xáº» cÃ¡c thÃ nh pháº§n trong má»™t chÆ°Æ¡ng trÃ¬nh Rust</a></h3>
<p>HÃ£y cÃ¹ng xem láº¡i má»™t cÃ¡ch chi tiáº¿t nhá»¯ng gÃ¬ Ä‘Ã£ xáº£y ra trong chÆ°Æ¡ng trÃ¬nh
â€œHello, world!â€. ÄÃ¢y lÃ  pháº§n Ä‘áº§u tiÃªn:</p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {

}</code></pre></pre>
<p>CÃ¡c dÃ²ng nÃ y Ä‘á»‹nh nghÄ©a má»™t hÃ m trong Rust. HÃ m <code>main</code> lÃ  má»™t hÃ m Ä‘áº·c biá»‡t: nÃ³
lÃ  nÆ¡i chá»©a cÃ¡c cÃ¢u lá»‡nh Ä‘áº§u tiÃªn nháº¥t cá»§a chÆ°Æ¡ng trÃ¬nh. DÃ²ng Ä‘áº§u tiÃªn khai bÃ¡o
má»™t hÃ m cÃ³ tÃªn <code>main</code> khÃ´ng cÃ³ tham sá»‘ vÃ  khÃ´ng tráº£ vá» báº¥t ká»³ giÃ¡ trá»‹ nÃ o. Náº¿u
cÃ³ thÃªm tham sá»‘, chÃºng sáº½ pháº£i náº±m bÃªn trong cáº·p dáº¥u ngoáº·c trÃ²n <code>()</code>.</p>
<p>TÆ°Æ¡ng tá»±, thÃ¢n hÃ m sáº½ náº±m trong cáº·p dáº¥u ngoáº·c nhá»n <code>{}</code>. Rust yÃªu cáº§u chÃºng bao
toÃ n bá»™ thÃ¢n hÃ m. Tá»‘t nháº¥t lÃ  báº¡n Ä‘áº·t dáº¥u ngoáº·c nhá»n má»Ÿ trÃªn cÃ¹ng dÃ²ng khai bÃ¡o
hÃ m vá»›i má»™t khoáº£ng tráº¯ng phÃ¢n cÃ¡ch á»Ÿ giá»¯a.</p>
<p>Náº¿u báº¡n muá»‘n Ã¡p dá»¥ng má»™t Ä‘á»‹nh dáº¡ng code chuáº©n trong táº¥t cáº£ cÃ¡c dá»± Ã¡n Rust, báº¡n
cÃ³ thá»ƒ dÃ¹ng má»™t cÃ´ng cá»¥ Ä‘á»‹nh dáº¡ng cÃ³ tÃªn <code>rustfmt</code>. NhÃ³m Rust Ä‘Ã£ thÃªm cÃ´ng cá»¥ nÃ y
vÃ o gÃ³i cÃ i Ä‘áº·t chuáº©n cá»§a Rust, giá»‘ng nhÆ° <code>rustc</code>, do váº­y nÃ³ cháº¯c cháº¯n cÅ©ng Ä‘Ã£ Ä‘Æ°á»£c
cÃ i sáºµn trong mÃ¡y tÃ­nh cá»§a báº¡n. HÃ£y xem thÃªm cÃ¡c tÃ i liá»‡u online náº¿u cáº§n thÃªm
thÃ´ng tin.</p>
<p>BÃªn trong hÃ m <code>main</code> lÃ  Ä‘oáº¡n code sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    println!("Hello, world!");
<span class="boring">}</span></code></pre></pre>
<p>DÃ²ng nÃ y thá»±c hiá»‡n toÃ n bá»™ cÃ´ng viá»‡c trong chÆ°Æ¡ng trÃ¬nh tÃ­ hon nÃ y: in má»™t dÃ²ng
vÄƒn báº£n ra mÃ n hÃ¬nh. CÃ³ bá»‘n chi tiáº¿t quan trá»ng cáº§n lÆ°u Ã½ á»Ÿ Ä‘Ã¢y:</p>
<p>Äáº§u tiÃªn, Rust canh dÃ²ng báº±ng bá»‘n khoáº£ng tráº¯ng, khÃ´ng pháº£i dáº¥u tab.</p>
<p>Thá»© hai, <code>println!</code> gá»i Ä‘áº¿n má»™t macro. Náº¿u lÃ  má»™t hÃ m, nÃ³ sáº½ Ä‘Æ°á»£c gá»i vá»›i <code>println</code>
(khÃ´ng cÃ³ dáº¥u <code>!</code>). ChÃºng ta sáº½ tháº£o luáº­n chi tiáº¿t thÃªm vá» macro trong chÆ°Æ¡ng 19.
Hiá»‡n táº¡i, chÃºng ta chá»‰ cáº§n biáº¿t lÃ  khi dÃ¹ng <code>!</code>, chÃºng ta sáº½ gá»i Ä‘áº¿n má»™t macro thay
vÃ¬ má»™t hÃ m bÃ¬nh thÆ°á»ng, vÃ  cÃ¡c macro Ä‘Ã³ khÃ´ng hoÃ n toÃ n sá»­ dá»¥ng cÃ¹ng cÃ¡c quy táº¯c nhÆ°
cÃ¡c hÃ m.</p>
<p>Thá»© ba, báº¡n tháº¥y chuá»—i <code>"Hello, world!"</code>. ChÃºng ta truyá»n chuá»—i nÃ y nhÆ° má»™t tham
sá»‘ cho <code>println!</code>, vÃ  nÃ³ sáº½ Ä‘Æ°á»£c in ra máº¡n hÃ¬nh.</p>
<p>Thá»© tÆ°, chÃºng ta káº¿t thÃºc dÃ²ng vá»›i má»™t dáº¥u cháº¥m pháº©y (<code>;</code>), nÃ³ chá»‰ ra ráº±ng cÃ¢u lá»‡nh
Ä‘Ã£ káº¿t thÃºc vÃ  sáºµn sÃ ng cho lá»‡nh káº¿ tiáº¿p. Háº§u háº¿t cÃ¡c lá»‡nh Rust káº¿t thÃºc báº±ng má»™t
dáº¥u cháº¥m pháº©y.</p>
<h3 id="dá»‹ch-vÃ -cháº¡y-lÃ -cÃ¡c-bÆ°á»›c-riÃªng-biá»‡t"><a class="header" href="#dá»‹ch-vÃ -cháº¡y-lÃ -cÃ¡c-bÆ°á»›c-riÃªng-biá»‡t">Dá»‹ch vÃ  cháº¡y lÃ  cÃ¡c bÆ°á»›c riÃªng biá»‡t</a></h3>
<p>Báº¡n vá»«a cháº¡y chÆ°Æ¡ng trÃ¬nh má»›i táº¡o, giá» hÃ£y cÃ¹ng xem qua cÃ¡c bÆ°á»›c trong toÃ n bá»™
quÃ¡ trÃ¬nh.</p>
<p>TrÆ°á»›c khi cháº¡y má»™t chÆ°Æ¡ng trÃ¬nh Rust, báº¡n pháº£i dá»‹ch nÃ³ dÃ¹ng trÃ¬nh dá»‹ch
Rust báº±ng cÃ¡ch gÃµ vÃ o cÃ¢u lá»‡nh <code>rustc</code> vÃ  truyá»n cho nÃ³ tÃªn file nguá»“n cá»§a báº¡n,
tÆ°Æ¡ng tá»± dÆ°á»›i Ä‘Ã¢y:</p>
<pre><code class="language-console">$ rustc main.rs
</code></pre>
<p>Náº¿u báº¡n Ä‘Ã£ cÃ³ má»™t ná»n táº£ng C hay C++, báº¡n sáº½ tháº¥y Ä‘iá»u nÃ y tÆ°Æ¡ng tá»± nhÆ° lá»‡nh
<code>gcc</code> hay <code>clang</code>. Sau khi biÃªn dá»‹ch thÃ nh cÃ´ng, Rust sáº½ táº¡o ra má»™t file thá»±c thi.</p>
<p>TrÃªn Linux, macOS, vÃ  PowerShell trÃªn Windows, báº¡n cÃ³ thá»ƒ tháº¥y file thá»±c thi nÃ y
báº±ng cÃ¡ch cháº¡y lá»‡nh <code>ls</code>. TrÃªn Linux vÃ  macOS, báº¡n sáº½ tháº¥y 2 file. Vá»›i PowerShell
trÃªn Windows, báº¡n sáº½ tháº¥y 3 file giá»‘ng nhÆ° khi báº¡n liá»‡t kÃª file dÃ¹ng CMD.</p>
<pre><code class="language-console">$ ls
main  main.rs
</code></pre>
<p>Vá»›i CMD trÃªn Windows, Báº¡n cÃ³ thá»ƒ nháº­p vÃ o:</p>
<pre><code class="language-cmd">&gt; dir /B %= tÃ¹y chá»n /B chá»‰ ra báº¡n chá»‰ muá»‘n hiá»ƒn thá»‹ cÃ¡c file =%
main.exe
main.pdb
main.rs
</code></pre>
<p>CÃ¢u lá»‡nh nÃ y sáº½ hiá»ƒn thá»‹ file mÃ£ nguá»“n vá»›i pháº§n má»Ÿ rá»™ng <em>.rs</em>, file thá»±c thi
(<em>main.exe</em> trÃªn Windows, nhÆ°ng lÃ  <em>main</em> trÃªn cÃ¡c ná»n táº£ng khÃ¡c), vÃ , khi
sá»­ dá»¥ng Windows, má»™t file chá»©a thÃ´ng tin debug vá»›i Ä‘uÃ´i <em>.pdb</em>. Tá»« Ä‘Ã¢y, báº¡n cháº¡y
file <em>main.exe</em> hay <em>main</em> nhÆ° sau:</p>
<pre><code class="language-console">$ ./main # or .\main.exe on Windows
</code></pre>
<p>Náº¿u <em>main.rs</em> lÃ  chÆ°Æ¡ng trÃ¬nh â€œHello, world!â€ cá»§a báº¡n, dÃ²ng nÃ y sáº½ in ra <code>Hello, world!</code>
trÃªn cá»­a sá»• terminal.</p>
<p>Náº¿u báº¡n thÃ¢n thuá»™c hÆ¡n vá»›i má»™t ngÃ´n ngá»¯ Ä‘á»™ng (dynamic language), nhÆ° Ruby, Python, hay
JavaScript, cÃ³ thá»ƒ báº¡n chÆ°a tá»«ng dá»‹ch vÃ  cháº¡y chÆ°Æ¡ng trÃ¬nh trong cÃ¡c bÆ°á»›c riÃªng nhÆ° trÃªn.
Rust lÃ  má»™t ngÃ´n ngá»¯ <em>biÃªn dá»‹ch sáºµn</em> (<em>ahead-of-time compiled</em>), cÃ³ nghÄ©a lÃ  báº¡n cÃ³ thá»ƒ
dá»‹ch má»™t chÆ°Æ¡ng trÃ¬nh vÃ  Ä‘Æ°a file thá»±c thi cho má»™t ai Ä‘Ã³, vÃ  há» cÃ³ thá»ƒ cháº¡y nÃ³
mÃ  tháº­m chÃ­ khÃ´ng cáº§n cÃ i Ä‘áº·t Rust. Náº¿u báº¡n Ä‘Æ°a ai Ä‘Ã³ má»™t file <em>.rb</em>, <em>.py</em>, hay
<em>.js</em>, há» sáº½ cáº§n cÃ³ Ruby, Python hay JavaScript cÃ i Ä‘áº·t sáºµn trÃªn mÃ¡y. NhÆ°ng trong
cÃ¡c ngÃ´n ngá»¯ Ä‘Ã³ báº¡n chá»‰ cáº§n má»™t cÃ¢u lá»‡nh Ä‘á»ƒ dá»‹ch vÃ  cháº¡y chÆ°Æ¡ng trÃ¬nh. NÃ³i chung
trong thiáº¿t káº¿ ngÃ´n ngá»¯ thÃ¬ cÃ¡i gÃ¬ cÅ©ng cÃ³ cÃ¡i giÃ¡ cá»§a nÃ³.</p>
<p>Chá»‰ biÃªn dá»‹ch vá»›i <code>rustc</code> thÃ¬ khÃ´ng cÃ³ váº¥n Ä‘á» gÃ¬ vá»›i cÃ¡c chÆ°Æ¡ng trÃ¬nh Ä‘Æ¡n giáº£n,
nhÆ°ng khi chÆ°Æ¡ng trÃ¬nh phÃ¡t triá»ƒn lÃªn, báº¡n sáº½ muá»‘n quáº£n lÃ½ táº¥t cáº£ cÃ¡c cÃ i Ä‘áº·t
vÃ  lÃ m cho viá»‡c chia sáº» code trá»Ÿ nÃªn dá»… dÃ ng. Tiáº¿p theo, chÃºng tÃ´i sáº½ giá»›i thiá»‡u
má»™t cÃ´ng cá»¥ cÃ³ tÃªn Cargo, thá»© sáº½ giÃºp báº¡n táº¡o nÃªn cÃ¡c chÆ°Æ¡ng trÃ¬nh thá»±c sá»±.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="hello-cargo"><a class="header" href="#hello-cargo">Hello, Cargo!</a></h2>
<p>Cargo lÃ  há»‡ thá»‘ng build vÃ  quáº£n lÃ½ cÃ¡c gÃ³i cá»§a Rust. Háº§u háº¿t cÃ¡c Rustacean (cÃ¡ch
chÃºng tÃ´i gá»i nhá»¯ng ngÆ°á»i sá»­ dá»¥ng Rust) dÃ¹ng cÃ´ng cá»¥ nÃ y Ä‘á»ƒ quáº£n lÃ½ cÃ¡c dá»± Ã¡n
Rust vÃ¬ nÃ³ cÃ³ thá»ƒ xá»­ lÃ½ ráº¥t nhiá»u tÃ¡c vá»¥ khÃ¡c nhau, nhÆ° dá»‹ch code, táº£i cÃ¡c thÆ° viá»‡n
mÃ  chÆ°Æ¡ng trÃ¬nh báº¡n dÃ¹ng, vÃ  dá»‹ch cÃ¡c thÆ° viá»‡n Ä‘Ã³. (Ta gá»i cÃ¡c thÆ° viá»‡n mÃ 
chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n cáº§n lÃ  cÃ¡c phá»¥ thuá»™c - <em>dependency</em>).</p>
<p>Nhá»¯ng chÆ°Æ¡ng trÃ¬nh Ä‘Æ¡n giáº£n nháº¥t giá»‘ng nhÆ° cÃ¡i mÃ  chÃºng ta Ä‘Ã£ viáº¿t, khÃ´ng dÃ¹ng báº¥t
ká»³ dependency nÃ o. Do váº­y náº¿u báº¡n Ä‘Ã£ build â€œHello, world!â€ vá»›i Cargo, nÃ³ cÃ³ láº½
chá»‰ dÃ¹ng má»™t pháº§n kháº£ nÄƒng Ä‘á»ƒ build chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n. Khi viáº¿t cÃ¡c chÆ°Æ¡ng trÃ¬nh
phá»©c táº¡p hÆ¡n, báº¡n sáº½ pháº£i thÃªm cÃ¡c phá»¥ thuá»™c, vÃ  náº¿u khá»Ÿi táº¡o má»™t dá»± Ã¡n báº±ng cÃ¡ch
dÃ¹ng Cargo, viá»‡c thÃªm cÃ¡c thÆ° viá»‡n phá»¥ thuá»™c sáº½ dá»… dÃ ng hÆ¡n ráº¥t nhiá»u.</p>
<p>Bá»Ÿi vÃ¬ pháº§n lá»›n cÃ¡c dá»± Ã¡n Rust dÃ¹ng Cargo, pháº§n cÃ²n láº¡i trong cuá»‘n sÃ¡ch nÃ y cÅ©ng
cho ráº±ng báº¡n Ä‘ang dÃ¹ng Cargo. Cargo sáº½ Ä‘Æ°á»£c cÃ i Ä‘áº·t chung vá»›i Rust vá» báº¡n dÃ¹ng cÃ¡c
bá»™ cÃ i Ä‘áº·t chuáº©n Ä‘Æ°á»£c nÃ³i Ä‘áº¿n trong pháº§n <a href="ch01-01-installation.html#installation">â€œInstallationâ€</a><!-- ignore -->.
Náº¿u báº¡n cÃ i Ä‘áº·t theo nhá»¯ng cÃ¡ch khÃ¡c, hÃ£y kiá»ƒm tra thá»­ xem liá»‡u Cargo Ä‘Ã£ Ä‘Æ°á»£c
cÃ i Ä‘áº·t chÆ°a báº±ng cÃ¡ch nháº­p lá»‡nh sau vÃ o terminal:</p>
<pre><code class="language-console">$ cargo --version
</code></pre>
<p>Náº¿u tháº¥y sá»‘ hiá»‡u phiÃªn báº£n nghÄ©a lÃ  báº¡n Ä‘Ã£ cÃ i Ä‘áº·t nÃ³. Náº¿u tháº¥y má»™t thÃ´ng bÃ¡o lá»—i,
kiá»ƒu nhÆ° <code>command not found</code>, hÃ£y Ä‘á»c tÃ i liá»‡u vá» phÆ°Æ¡ng phÃ¡p cÃ i Ä‘áº·t cá»§a báº¡n Ä‘á»ƒ
xem cÃ¡ch cÃ i Cargo má»™t cÃ¡ch Ä‘á»™c láº­p.</p>
<h3 id="táº¡o-má»™t-dá»±-Ã¡n-vá»›i-cargo"><a class="header" href="#táº¡o-má»™t-dá»±-Ã¡n-vá»›i-cargo">Táº¡o má»™t dá»± Ã¡n vá»›i Cargo</a></h3>
<p>HÃ£y báº¯t Ä‘áº§u má»™t dá»± Ã¡n má»›i dÃ¹ng Cargo vÃ  xem nÃ³ khÃ¡c gÃ¬ so vá»›i dá»± Ã¡n â€œHello, world!â€
lÃºc Ä‘áº§u. Quay láº¡i thÆ° má»¥c <em>projects</em> (hay má»™t nÆ¡i nÃ o Ä‘Ã³ báº¡n Ä‘Ã£ lÆ°u mÃ£ nguá»“n). Sau Ä‘Ã³
cháº¡y cÃ¢u lá»‡nh sau:</p>
<pre><code class="language-console">$ cargo new hello_cargo
$ cd hello_cargo
</code></pre>
<p>CÃ¢u lá»‡nh Ä‘áº§u tiÃªn táº¡o má»™t thÆ° má»¥c tÃªn lÃ  <em>hello_cargo</em>. ChÃºng ta Ä‘Ã£ Ä‘áº·t tÃªn
dá»± Ã¡n lÃ  <em>hello_cargo</em>, vÃ  Cargo táº¡o cÃ¡c file cá»§a nÃ³ trong thÆ° má»¥c cÃ¹ng tÃªn.</p>
<p>Äi vÃ o bÃªn trong thÆ° má»¥c <em>hello_cargo</em> vÃ  xem danh sÃ¡ch file, báº¡n sáº½ tháº¥y Cargo
Ä‘Ã£ táº¡o cho chÃºng ta hai file vÃ  má»™t thÆ° má»¥c: file <em>Cargo.toml</em> vÃ  má»™t thÆ° má»¥c
cÃ³ tÃªn <em>src</em> vá»›i má»™t file <em>main.rs</em> á»Ÿ trong.</p>
<p>NÃ³ cÅ©ng khá»Ÿi táº¡o má»™t repository Git cÃ¹ng má»™t file <em>.gitignore</em>. CÃ¡c file Git
sáº½ khÃ´ng Ä‘Æ°á»£c táº¡o ra náº¿u báº¡n cháº¡y <code>cargo new</code> bÃªn trong má»™t repository Git sáºµn cÃ³;
báº¡n cÃ³ thá»ƒ Ã©p Cargo thá»±c hiá»‡n báº±ng cÃ¢u lá»‡nh <code>cargo new --vcs=git</code>.</p>
<blockquote>
<p>Ghi chÃº: Git lÃ  má»™t há»‡ quáº£n lÃ½ phiÃªn báº£n phá»• biáº¿n. Báº¡n cÃ³ thá»ƒ thay Ä‘á»•i Ä‘á»ƒ
<code>cargo new</code> dÃ¹ng má»™t há»‡ quáº£n lÃ½ phiÃªn báº£n khÃ¡c hoáº·c tháº­m chÃ­ khÃ´ng dÃ¹ng báº±ng
cÃ¡ch sá»­ dá»¥ng tham sá»‘ <code>--vcs</code>. Cháº¡y <code>cargo new --help</code> Ä‘á»ƒ xem cÃ¡c tÃ¹y chá»n Ä‘Æ°á»£c
há»— trá»£.</p>
</blockquote>
<p>Má»Ÿ <em>Cargo.toml</em> trong má»™t trÃ¬nh soáº¡n tháº£o. NÃ³ sáº½ trÃ´ng tÆ°Æ¡ng tá»± nhÆ° code trong
pháº§n Listing 1-2.</p>
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">[package]
name = "hello_cargo"
version = "0.1.0"
edition = "2021"

[dependencies]
</code></pre>
<p><span class="caption">Listing 1-2: Ná»™i dung file <em>Cargo.toml</em> Ä‘Æ°á»£c táº¡o bá»Ÿi <code>cargo new</code></span></p>
<p>File nÃ y á»Ÿ dáº¡ng <a href="https://toml.io"><em>TOML</em></a><!-- ignore --> (<em>Tomâ€™s Obvious,
Minimal Language</em>), lÃ  Ä‘á»‹nh dáº¡ng Cargo dÃ¹ng Ä‘á»ƒ chá»©a thÃ´ng tin cáº¥u hÃ¬nh.</p>
<p>DÃ²ng Ä‘áº§u tiÃªn, <code>[package]</code>, lÃ  pháº§n tiÃªu Ä‘á» (section heading) chá»‰ ra cÃ¡c
thÃ´ng tin phÃ­a sau lÃ  Ä‘á»ƒ cáº¥u hÃ¬nh má»™t gÃ³i. Khi thÃªm thÃ´ng tin vÃ o file nÃ y, ta
cÅ©ng sáº½ thÃªm cÃ¡c pháº§n (section) khÃ¡c.</p>
<p>Ba dÃ²ng káº¿ tiáº¿p chá»©a thÃ´ng tin Cargo cáº§n Ä‘á»ƒ dá»‹ch chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n: tÃªn, phiÃªn
báº£n chÆ°Æ¡ng trÃ¬nh vÃ  phiÃªn báº£n Rust mÃ  báº¡n dÃ¹ng. ChÃºng ta sáº½ nÃ³i thÃªm vá» <code>edition</code>
trong pháº§n <a href="appendix-05-editions.html">Phá»¥ lá»¥c E</a><!-- ignore -->.</p>
<p>DÃ²ng cuá»‘i cÃ¹ng, <code>[dependencies]</code>, lÃ  nÆ¡i báº¯t Ä‘áº§u danh sÃ¡ch cÃ¡c phá»¥ thuá»™c mÃ 
dá»± Ã¡n cá»§a báº¡n sá»­ dá»¥ng. Trong Rust, cÃ¡c gÃ³i mÃ£ nguá»“n Ä‘Æ°á»£c tham chiáº¿u Ä‘áº¿n nhÆ°
cÃ¡c <em>crates</em>. ChÃºng ta sáº½ khÃ´ng cáº§n cÃ¡c crate nÃ o khÃ¡c cho dá»± Ã¡n nÃ y, nhÆ°ng chÃºng
ta sáº½ dÃ¹ng khi viáº¿t dá»± Ã¡n Ä‘áº§u tiÃªn á»Ÿ chÆ°Æ¡ng 2, do váº­y khi Ä‘Ã³ ta sáº½ sá»­ dá»¥ng pháº§n phá»¥
thuá»™c nÃ y.</p>
<p>Giá» hÃ£y má»Ÿ file <em>src/main.rs</em> vÃ  xem qua:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    println!("Hello, world!");
}</code></pre></pre>
<p>Cargo Ä‘Ã£ táº¡o má»™t chÆ°Æ¡ng trÃ¬nh â€œHello, world!â€ cho báº¡n, giá»‘ng y nhÆ° cÃ¡i chÃºng ta
Ä‘Ã£ viáº¿t trong pháº§n Listing 1-1! Cho tá»›i giá», sá»± khÃ¡c biá»‡t giá»¯a dá»± Ã¡n trÆ°á»›c Ä‘Ã³
cá»§a chÃºng ta vÃ  dá»± Ã¡n do Cargo táº¡o ra chá»‰ khÃ¡c nhau á»Ÿ chá»— Cargo Ä‘Æ°a mÃ£ nguá»“n vÃ o
thÆ° má»¥c <em>src</em>, vÃ  chÃºng ta cÃ³ thÃªm file <em>Cargo.toml</em> trong thÆ° má»¥c gá»‘c cá»§a dá»± Ã¡n.</p>
<p>Cargo muá»‘n Ä‘á»ƒ táº¥t cáº£ cÃ¡c mÃ£ nguá»“n trong thÆ° má»¥c <em>src</em>. ThÆ° má»¥c gá»‘c chá»‰ Ä‘á»ƒ chá»©a cÃ¡c
file README, thÃ´ng tin cáº¥p phÃ©p, cÃ¡c file cáº¥u hÃ¬nh, vÃ  nhá»¯ng thá»© khÃ¡c khÃ´ng liÃªn
quan Ä‘áº¿n mÃ£ nguá»“n. Sá»­ dá»¥ng Cargo giÃºp báº¡n tá»• chá»©c cÃ¡c file trong dá»± Ã¡n. Má»™t nÆ¡i
cho táº¥t cáº£, vÃ  táº¥t sáº½ náº±m trong Ä‘Ãºng vá»‹ trÃ­ cá»§a nÃ³.</p>
<p>Náº¿u báº¯t Ä‘áº§u má»™t dá»± Ã¡n mÃ  khÃ´ng sá»­ dá»¥ng Cargo, nhÆ° Ä‘Ã£ lÃ m vá»›i dá»± Ã¡n â€œHello, world!â€,
báº¡n cÅ©ng cÃ³ thá»ƒ chuyá»ƒn nÃ³ thÃ nh má»™t dá»± Ã¡n sá»­ dá»¥ng Cargo. Chuyá»ƒn file dá»± Ã¡n vÃ o trong
thÆ° má»¥c src vÃ  táº¡o má»™t file <em>Cargo.toml</em> tÆ°Æ¡ng á»©ng.</p>
<h3 id="dá»‹ch-vÃ -cháº¡y-má»™t-dá»±-Ã¡n-cargo"><a class="header" href="#dá»‹ch-vÃ -cháº¡y-má»™t-dá»±-Ã¡n-cargo">Dá»‹ch vÃ  cháº¡y má»™t dá»± Ã¡n Cargo</a></h3>
<p>Giá» cÃ¹ng xem thá»­ cÃ³ gÃ¬ khÃ¡c khi dá»‹ch vÃ  cháº¡y chÆ°Æ¡ng trÃ¬nh â€œHello, world!â€ vá»›i
Cargo! Tá»« thÆ° má»¥c <em>hello_cargo</em>, dá»‹ch chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n vá»›i lá»‡nh sau:</p>
<pre><code class="language-console">$ cargo build
   Compiling hello_cargo v0.1.0 (file:///projects/hello_cargo)
    Finished dev [unoptimized + debuginfo] target(s) in 2.85 secs
</code></pre>
<p>CÃ¢u lá»‡nh nÃ y táº¡o ra má»™t file thá»±c thi trong <em>target/debug/hello_cargo</em> (hoáº·c
<em>target\debug\hello_cargo.exe</em> náº¿u cháº¡y trÃªn Windows) thay vÃ¬ trong thÆ° má»¥c
hiá»‡n táº¡i cá»§a báº¡n. Báº¡n cÃ³ thá»ƒ cháº¡y file nÃ y vá»›i lá»‡nh sau:</p>
<pre><code class="language-console">$ ./target/debug/hello_cargo # or .\target\debug\hello_cargo.exe on Windows
Hello, world!
</code></pre>
<p>Náº¿u má»i thá»© Ä‘á»u á»•n, dÃ²ng <code>Hello, world!</code> sáº½ Ä‘Æ°á»£c in ra mÃ n hÃ¬nh. Khi cháº¡y cÃ¢u
lá»‡nh <code>cargo build</code> láº§n Ä‘áº§u, Cargo cÅ©ng sáº½ táº¡o ra má»™t file cÃ³ tÃªn <em>Cargo.lock</em>
trong thÆ° má»¥c gá»‘c cá»§a dá»± Ã¡n. File nÃ y Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ theo dÃµi phiÃªn báº£n chÃ­nh xÃ¡c
cá»§a cÃ¡c phá»¥ thuá»™c mÃ  chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n sá»­ dá»¥ng, do dá»± Ã¡n nÃ y khÃ´ng cÃ³ cÃ¡c phá»¥ thuá»™c
nÃªn ná»™i dung cá»§a nÃ³ cÅ©ng khÃ¡ Ä‘Æ¡n giáº£n. Báº¡n sáº½ khÃ´ng cáº§n sá»­a Ä‘á»•i file nÃ y báº±ng tay;
Cargo sáº½ quáº£n lÃ½ nÃ³ giÃºp báº¡n.</p>
<p>ChÃºng ta vá»«a build má»™t dá»± Ã¡n vá»›i <code>cargo build</code> vÃ  cháº¡y nÃ³ vá»›i <code>./target/debug/hello_cargo</code>,
nhÆ°ng chÃºng ta cÅ©ng cÃ³ thá»ƒ dÃ¹ng <code>cargo run</code> Ä‘á»ƒ vá»«a dá»‹ch code vá»«a cháº¡y trong cÃ¹ng má»™t cÃ¢u lá»‡nh:</p>
<pre><code class="language-console">$ cargo run
    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
     Running `target/debug/hello_cargo`
Hello, world!
</code></pre>
<p>Äá»ƒ Ã½ lÃ  láº§n nÃ y báº¡n sáº½ khÃ´ng tháº¥y cÃ¡c thÃ´ng bÃ¡o khi Cargo biÃªn dá»‹ch <code>hello_cargo</code>.
Cargo kiá»ƒm tra vÃ  tháº¥y mÃ£ nguá»“n khÃ´ng bá»‹ thay Ä‘á»•i, do váº­y nÃ³ chá»‰ cháº¡y file Ä‘Ã£
biÃªn dá»‹ch. Náº¿u báº¡n Ä‘Ã£ sá»­a Ä‘á»•i mÃ£ nguá»“n, Cargo sáº½ dá»‹ch láº¡i trÆ°á»›c khi cháº¡y vÃ  báº¡n
sáº½ tháº¥y thÃ´ng bÃ¡o tÆ°Æ¡ng tá»± nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling hello_cargo v0.1.0 (file:///projects/hello_cargo)
    Finished dev [unoptimized + debuginfo] target(s) in 0.33 secs
     Running `target/debug/hello_cargo`
Hello, world!
</code></pre>
<p>Cargo cÅ©ng cung cáº¥p má»™t lá»‡nh cÃ³ tÃªn <code>cargo check</code>. Lá»‡nh nÃ y Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ kiá»ƒm tra
nhanh xem code cá»§a báº¡n cÃ³ thá»ƒ dá»‹ch Ä‘Æ°á»£c khÃ´ng mÃ  khÃ´ng cáº§n táº¡o ra má»™t file thá»±c
thi.</p>
<pre><code class="language-console">$ cargo check
   Checking hello_cargo v0.1.0 (file:///projects/hello_cargo)
    Finished dev [unoptimized + debuginfo] target(s) in 0.32 secs
</code></pre>
<p>Táº¡i sao báº¡n láº¡i khÃ´ng cáº§n má»™t file thá»±c thi? ThÃ´ng thÆ°á»ng, <code>cargo check</code> nhanh
hÆ¡n nhiá»u so vá»›i <code>cargo build</code>, vÃ¬ nÃ³ bá» qua bÆ°á»›c táº¡o file thá»±c thi. Náº¿u báº¡n cÃ³
thÃ³i quen kiá»ƒm tra kháº£ nÄƒng biÃªn dá»‹ch liÃªn tá»¥c khi viáº¿t code, dÃ¹ng <code>cargo check</code>
sáº½ giÃºp tÄƒng tá»‘c Ä‘Ã¡ng ká»ƒ! Do váº­y nhiá»u Rustacean cháº¡y <code>cargo check</code> Ä‘á»‹nh ká»³ khi
viáº¿t lÃ m viá»‡c Ä‘á»ƒ Ä‘áº£m báº£o code cÃ³ thá»ƒ dá»‹ch Ä‘Æ°á»£c. Sau Ä‘Ã³ há» sáº½ dÃ¹ng <code>cargo build</code>
khi muá»‘n cháº¡y chÆ°Æ¡ng trÃ¬nh.</p>
<p>HÃ£y cÅ©ng Ä‘iá»ƒm qua nhá»¯ng thá»© ta Ä‘Ã£ há»c Ä‘Æ°á»£c vá» Cargo:</p>
<ul>
<li>ChÃºng ta cÃ³ thá»ƒ dÃ¹ng <code>cargo new</code> Ä‘á»ƒ táº¡o dá»± Ã¡n má»›i.</li>
<li>ChÃºng ta cÃ³ thá»ƒ dá»‹ch chÆ°Æ¡ng trÃ¬nh báº±ng cÃ¡ch dÃ¹ng <code>cargo build</code> .</li>
<li>ChÃºng ta cÃ³ thá»ƒ dá»‹ch vÃ  cháº¡y chÆ°Æ¡ng trÃ¬nh chá»‰ vá»›i má»™t bÆ°á»›c báº±ng <code>cargo run</code>.</li>
<li>ChÃºng ta cÃ³ thá»ƒ dá»‹ch mÃ  khÃ´ng cáº§n táº¡o ra file thá»±c thi báº±ng <code>cargo check</code>.</li>
<li>Thay vÃ¬ lÆ°u káº¿t quáº£ dá»‹ch vÃ o cÃ¹ng thÆ° má»¥c code, Cargo lÆ°u chÃºng trong thÆ°
má»¥c <em>target/debug</em>.</li>
</ul>
<p>Má»™t lá»£i Ã­ch ná»¯a cá»§a Cargo lÃ  cÃ¡c lá»‡nh cá»§a nÃ³ hoÃ n toÃ n giá»‘ng nhau, khÃ´ng phá»¥ thuá»™c
vÃ o há»‡ Ä‘iá»u hÃ nh mÃ  báº¡n dÃ¹ng. Do váº­y, hiá»‡n táº¡i chÃºng ta sáº½ khÃ´ng cáº§n cung cáº¥p cÃ¡c
hÆ°á»›ng dáº«n riÃªng cho Linux, macOS hay Windows.</p>
<h3 id="táº¡o-báº£n-phÃ¡t-hÃ nh"><a class="header" href="#táº¡o-báº£n-phÃ¡t-hÃ nh">Táº¡o báº£n phÃ¡t hÃ nh</a></h3>
<p>Khi dá»± Ã¡n cá»§a báº¡n Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ phÃ¡t hÃ nh, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng <code>cargo build --release</code>
Ä‘á»ƒ biÃªn dá»‹ch nÃ³ vá»›i cÃ¡c tÃ­nh nÄƒng tá»‘i Æ°u hÃ³a. Lá»‡nh nÃ y sáº½ táº¡o ra má»™t
file thá»±c thi trong <em>target/release</em> thay vÃ¬ <em>target/debug</em>. Viá»‡c tá»‘i Æ°u hÃ³a
lÃ m cho mÃ£ Rust cá»§a báº¡n cháº¡y nhanh hÆ¡n, nhÆ°ng viá»‡c báº­t chÃºng láº¡i kÃ©o dÃ i thá»i gian
Ä‘á»ƒ biÃªn dá»‹ch chÆ°Æ¡ng trÃ¬nh. ÄÃ¢y lÃ  lÃ½ do táº¡i sao cÃ³ hai cáº¥u hÃ¬nh khÃ¡c nhau: má»™t
Ä‘á»ƒ phÃ¡t triá»ƒn, khi báº¡n muá»‘n build láº¡i nhanh chÃ³ng vÃ  thÆ°á»ng xuyÃªn, vÃ  má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ
cung cáº¥p báº£n build cuá»‘i cÃ¹ng cho ngÆ°á»i dÃ¹ng, vá»‘n sáº½ khÃ´ng Ä‘Æ°á»£c build láº¡i ná»¯a
vÃ  tá»‘i Æ°u Ä‘á»ƒ cháº¡y nhanh nháº¥t cÃ³ thá»ƒ. Náº¿u báº¡n Ä‘ang benchmark thá»i gian cháº¡y code,
hÃ£y Ä‘áº£m báº£o dá»‹ch báº±ng <code>cargo build --release</code> vÃ  benchmark vá»›i tá»‡p thá»±c thi trong <em>target/release</em>.</p>
<h3 id="cargo-nhÆ°-lÃ -má»™t-quy-Æ°á»›c"><a class="header" href="#cargo-nhÆ°-lÃ -má»™t-quy-Æ°á»›c">Cargo nhÆ° lÃ  má»™t quy Æ°á»›c</a></h3>
<p>Vá»›i cÃ¡c dá»± Ã¡n Ä‘Æ¡n giáº£n, Cargo khÃ´ng mang láº¡i nhiá»u giÃ¡ trá»‹ náº¿u chá»‰ sá»­ dá»¥ng
<code>rustc</code>, nhÆ°ng nÃ³ sáº½ chá»©ng minh giÃ¡ trá»‹ cá»§a nÃ³ khi cÃ¡c chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n trá»Ÿ nÃªn phá»©c táº¡p hÆ¡n.
Vá»›i cÃ¡c dá»± Ã¡n phá»©c táº¡p bao gá»“m nhiá»u crate, viá»‡c sá»­ dá»¥ng Cargo Ä‘á»ƒ build sáº½
trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n ráº¥t nhiá»u.</p>
<p>Máº·c dÃ¹ dá»± Ã¡n <code>hello_cargo</code> ráº¥t Ä‘Æ¡n giáº£n, nhÆ°ng bÃ¢y giá» nÃ³ sá»­ dá»¥ng nhiá»u
cÃ´ng cá»¥ báº¡n sáº½ sá»­ dá»¥ng trong pháº§n cÃ²n láº¡i cá»§a sá»± nghiá»‡p Rust cá»§a mÃ¬nh. Thá»±c táº¿ lÃ ,
vá»›i báº¥t ká»³ dá»± Ã¡n cÃ³ sáºµn nÃ o, báº¡n Ä‘á»u cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c lá»‡nh sau Ä‘á»ƒ láº¥y code
vá» tá»« Git, chuyá»ƒn vÃ o thÆ° má»¥c cá»§a dá»± Ã¡n Ä‘Ã³ vÃ  build:</p>
<pre><code class="language-console">$ git clone example.org/someproject
$ cd someproject
$ cargo build
</code></pre>
<p>Äá»ƒ Ä‘á»c thÃªm vá» Cargo, xin hÃ£y truy cáº­p <a href="https://doc.rust-lang.org/cargo/">tÃ i liá»‡u cá»§a nÃ³</a>.</p>
<h2 id="tá»•ng-káº¿t"><a class="header" href="#tá»•ng-káº¿t">Tá»•ng káº¿t</a></h2>
<p>Báº¡n Ä‘Ã£ cÃ³ má»™t khá»Ÿi Ä‘áº§u tuyá»‡t vá»i trong hÃ nh trÃ¬nh Rust cá»§a mÃ¬nh! Trong chÆ°Æ¡ng nÃ y,
báº¡n Ä‘Ã£ há»c cÃ¡ch:</p>
<ul>
<li>CÃ i Ä‘áº·t phiÃªn báº£n á»•n Ä‘á»‹nh má»›i nháº¥t cá»§a Rust báº±ng cÃ¡ch sá»­ dá»¥ng â€˜rustupâ€™</li>
<li>Cáº­p nháº­t lÃªn phiÃªn báº£n Rust má»›i hÆ¡n</li>
<li>Má»Ÿ tÃ i liá»‡u cÃ i Ä‘áº·t cá»¥c bá»™</li>
<li>Viáº¿t vÃ  cháº¡y chÆ°Æ¡ng trÃ¬nh â€œHello, world!â€ sá»­ dá»¥ng trá»±c tiáº¿p lá»‡nh <code>rustup</code></li>
<li>Táº¡o vÃ  cháº¡y má»™t dá»± Ã¡n má»›i báº±ng cÃ¡ch sá»­ dá»¥ng Cargo, Ä‘á»“ng thá»i tÃ¬m hiá»ƒu vá» cÃ¡c quy Æ°á»›c
khi lÃ m viá»‡c vá»›i nÃ³</li>
</ul>
<p>ÄÃ¢y lÃ  thá»i Ä‘iá»ƒm tuyá»‡t vá»i Ä‘á»ƒ xÃ¢y dá»±ng má»™t chÆ°Æ¡ng trÃ¬nh quan trá»ng hÆ¡n Ä‘á»ƒ lÃ m quen vá»›i viá»‡c Ä‘á»c
vÃ  viáº¿t code Rust. VÃ¬ váº­y, trong ChÆ°Æ¡ng 2, chÃºng tÃ´i sáº½ xÃ¢y dá»±ng má»™t chÆ°Æ¡ng trÃ¬nh trÃ² chÆ¡i Ä‘oÃ¡n sá»‘.
Náº¿u báº¡n muá»‘n báº¯t Ä‘áº§u báº±ng cÃ¡ch tÃ¬m hiá»ƒu cÃ¡c khÃ¡i niá»‡m láº­p trÃ¬nh phá»• biáº¿n trong
Rust, hÃ£y xem ChÆ°Æ¡ng 3 rá»“i sau Ä‘Ã³ quay láº¡i ChÆ°Æ¡ng 2.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="láº­p-trÃ¬nh-má»™t-trÃ²-chÆ¡i-Ä‘oÃ¡n-sá»‘"><a class="header" href="#láº­p-trÃ¬nh-má»™t-trÃ²-chÆ¡i-Ä‘oÃ¡n-sá»‘">Láº­p trÃ¬nh má»™t trÃ² chÆ¡i Ä‘oÃ¡n sá»‘</a></h1>
<p>HÃ£y báº¯t Ä‘áº§u vá»›i Rust báº±ng cÃ¡ch cÃ¹ng nhau lÃ m má»™t dá»± Ã¡n thá»±c hÃ nh! ChÆ°Æ¡ng nÃ y giá»›i
thiá»‡u báº¡n vá»›i má»™t sá»‘ khÃ¡i niá»‡m Rust phá»• biáº¿n báº±ng cÃ¡ch hÆ°á»›ng dáº«n cÃ¡ch sá»­ dá»¥ng
chÃºng trong má»™t chÆ°Æ¡ng trÃ¬nh thá»±c táº¿. Báº¡n sáº½ tÃ¬m hiá»ƒu vá» <code>let</code>, <code>match</code>, cÃ¡c phÆ°Æ¡ng
thá»©c, cÃ¡c hÃ m liÃªn káº¿t, cÃ¡c crate bÃªn ngoÃ i, vÃ  nhiá»u Ä‘iá»u khÃ¡c ná»¯a! Trong cÃ¡c chÆ°Æ¡ng
tiáº¿p theo, chÃºng ta sáº½ khÃ¡m phÃ¡ nhá»¯ng Ã½ tÆ°á»Ÿng nÃ y má»™t cÃ¡ch chi tiáº¿t hÆ¡n.
Trong chÆ°Æ¡ng nÃ y, báº¡n chá»‰ cáº§n thá»±c hÃ nh cÃ¡c kiáº¿n thá»©c cÆ¡ báº£n.</p>
<p>ChÃºng ta sáº½ triá»ƒn khai má»™t bÃ i toÃ¡n láº­p trÃ¬nh cÆ¡ báº£n dÃ nh cho ngÆ°á»i má»›i há»c: má»™t trÃ²
chÆ¡i Ä‘oÃ¡n sá»‘. CÃ¡ch thá»©c hoáº¡t Ä‘á»™ng nhÆ° sau: chÆ°Æ¡ng trÃ¬nh sáº½ táº¡o má»™t sá»‘ nguyÃªn ngáº«u
nhiÃªn tá»« 1 Ä‘áº¿n 100. Sau Ä‘Ã³, nÃ³ sáº½ yÃªu cáº§u ngÆ°á»i chÆ¡i nháº­p má»™t dá»± Ä‘oÃ¡n. Sau khi cÃ³ dá»± Ä‘oÃ¡n,
chÆ°Æ¡ng trÃ¬nh sáº½ cho biáº¿t liá»‡u dá»± Ä‘oÃ¡n cÃ³ quÃ¡ tháº¥p, quÃ¡ cao, hay chÃ­nh xÃ¡c. Náº¿u
dá»± Ä‘oÃ¡n Ä‘Ãºng, trÃ² chÆ¡i sáº½ in má»™t thÃ´ng bÃ¡o chÃºc má»«ng vÃ  thoÃ¡t.</p>
<h2 id="setting-up-a-new-project"><a class="header" href="#setting-up-a-new-project">Setting Up a New Project</a></h2>
<p>Äá»ƒ thiáº¿t láº­p má»™t dá»± Ã¡n má»›i, hÃ£y di chuyá»ƒn Ä‘áº¿n thÆ° má»¥c <em>projects</em> mÃ  báº¡n Ä‘Ã£ táº¡o trong
ChÆ°Æ¡ng 1 vÃ  táº¡o má»™t dá»± Ã¡n má»›i báº±ng Cargo, nhÆ° sau:</p>
<pre><code class="language-console">$ cargo new guessing_game
$ cd guessing_game
</code></pre>
<p>Lá»‡nh Ä‘áº§u tiÃªn, cargo new, nháº­n tÃªn cá»§a dá»± Ã¡n (<code>guessing_game</code>) nhÆ° lÃ  Ä‘á»‘i sá»‘
Ä‘áº§u tiÃªn. Lá»‡nh thá»© hai chuyá»ƒn Ä‘áº¿n thÆ° má»¥c má»›i cá»§a dá»± Ã¡n.</p>
<p>HÃ£y xem vÃ o tá»‡p <em>Cargo.toml</em> Ä‘Æ°á»£c táº¡o ra:</p>
<!-- manual-regeneration
cd listings/ch02-guessing-game-tutorial
rm -rf no-listing-01-cargo-new
cargo new no-listing-01-cargo-new --name guessing_game
cd no-listing-01-cargo-new
cargo run > output.txt 2>&1
cd ../../..
-->
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">[package]
name = "guessing_game"
version = "0.1.0"
edition = "2024"

[dependencies]
</code></pre>
<p>NhÆ° báº¡n Ä‘Ã£ tháº¥y á»Ÿ ChÆ°Æ¡ng 1, <code>cargo new</code> táº¡o ra má»™t chÆ°Æ¡ng trÃ¬nh â€œHello, world!â€
cho báº¡n. HÃ£y xem tá»‡p <em>src/main.rs</em>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    println!("Hello, world!");
}</code></pre></pre>
<p>Äá»ƒ biÃªn dá»‹ch vÃ  cháº¡y chÆ°Æ¡ng trÃ¬nh â€œHello, world!â€ trong Rust, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh <code>cargo run</code>:</p>
<pre><code class="language-console">$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.08s
     Running `target/debug/guessing_game`
Hello, world!
</code></pre>
<p>Lá»‡nh <code>run</code> ráº¥t há»¯u Ã­ch khi báº¡n cáº§n láº·p nhanh chÃ³ng trÃªn má»™t dá»± Ã¡n, nhÆ°
chÃºng ta sáº½ lÃ m trong trÃ² chÆ¡i nÃ y, kiá»ƒm thá»­ nhanh chÃ³ng tá»«ng bÆ°á»›c
trÆ°á»›c khi chuyá»ƒn sang bÆ°á»›c tiáº¿p theo.</p>
<p>Má»Ÿ láº¡i tá»‡p <em>src/main.rs</em>. Báº¡n sáº½ viáº¿t toÃ n bá»™ code trong file nÃ y.</p>
<h2 id="processing-a-guess"><a class="header" href="#processing-a-guess">Processing a Guess</a></h2>
<p>Pháº§n Ä‘áº§u tiÃªn cá»§a chÆ°Æ¡ng trÃ¬nh trÃ² chÆ¡i Ä‘oÃ¡n sá»‘ sáº½ yÃªu cáº§u ngÆ°á»i chÆ¡i nháº­p liá»‡u,
xá»­ lÃ½ Ä‘áº§u vÃ o Ä‘Ã³ vÃ  kiá»ƒm tra xem Ä‘áº§u vÃ o cÃ³ Ä‘Ãºng dáº¡ng mong Ä‘á»£i hay khÃ´ng. Äá»ƒ báº¯t Ä‘áº§u,
chÃºng ta sáº½ cho phÃ©p ngÆ°á»i chÆ¡i nháº­p má»™t sá»‘ Ä‘oÃ¡n. Nháº­p code trong Listing 2-1
vÃ o <em>src/main.rs</em>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">use std::io;

fn main() {
    println!("Guess the number!");

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin()
        .read_line(&amp;mut guess)
        .expect("Failed to read line");

    println!("You guessed: {guess}");
}</code></pre>
<p><span class="caption">Listing 2-1: Code that gets a guess from the user and
prints it</span></p>
<p>This code contains a lot of information, so letâ€™s go over it line by line. To
obtain user input and then print the result as output, we need to bring the
<code>io</code> input/output library into scope. The <code>io</code> library comes from the standard
library, known as <code>std</code>:</p>
<pre><code class="language-rust ignore">use std::io;
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span><span class="boring">        .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">    println!("You guessed: {guess}");
</span><span class="boring">}</span></code></pre>
<p>By default, Rust has a set of items defined in the standard library that it
brings into the scope of every program. This set is called the <em>prelude</em>, and
you can see everything in it <a href="../std/prelude/index.html">in the standard library documentation</a>.</p>
<p>If a type you want to use isnâ€™t in the prelude, you have to bring that type
into scope explicitly with a <code>use</code> statement. Using the <code>std::io</code> library
provides you with a number of useful features, including the ability to accept
user input.</p>
<p>As you saw in Chapter 1, the <code>main</code> function is the entry point into the
program:</p>
<pre><code class="language-rust ignore"><span class="boring">use std::io;
</span><span class="boring">
</span>fn main() {
<span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span><span class="boring">        .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">    println!("You guessed: {guess}");
</span><span class="boring">}</span></code></pre>
<p>The <code>fn</code> syntax declares a new function; the parentheses, <code>()</code>, indicate there
are no parameters; and the curly bracket, <code>{</code>, starts the body of the function.</p>
<p>As you also learned in Chapter 1, <code>println!</code> is a macro that prints a string to
the screen:</p>
<pre><code class="language-rust ignore"><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">fn main() {
</span>    println!("Guess the number!");

    println!("Please input your guess.");
<span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span><span class="boring">        .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">    println!("You guessed: {guess}");
</span><span class="boring">}</span></code></pre>
<p>This code is printing a prompt stating what the game is and requesting input
from the user.</p>
<h3 id="storing-values-with-variables"><a class="header" href="#storing-values-with-variables">Storing Values with Variables</a></h3>
<p>Next, weâ€™ll create a <em>variable</em> to store the user input, like this:</p>
<pre><code class="language-rust ignore"><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span>    let mut guess = String::new();
<span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span><span class="boring">        .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">    println!("You guessed: {guess}");
</span><span class="boring">}</span></code></pre>
<p>Now the program is getting interesting! Thereâ€™s a lot going on in this little
line. We use the <code>let</code> statement to create the variable. Hereâ€™s another example:</p>
<pre><code class="language-rust ignore">let apples = 5;</code></pre>
<p>This line creates a new variable named <code>apples</code> and binds it to the value 5. In
Rust, variables are immutable by default, meaning once we give the variable a
value, the value wonâ€™t change. Weâ€™ll be discussing this concept in detail in
the <a href="ch03-01-variables-and-mutability.html#variables-and-mutability">â€œVariables and Mutabilityâ€</a><!-- ignore -->
section in Chapter 3. To make a variable mutable, we add <code>mut</code> before the
variable name:</p>
<pre><code class="language-rust ignore">let apples = 5; // immutable
let mut bananas = 5; // mutable</code></pre>
<section class="note" aria-role="note">
<p>Note: The <code>//</code> syntax starts a comment that continues until the end of the
line. Rust ignores everything in comments. Weâ€™ll discuss comments in more
detail in <a href="ch03-04-comments.html">Chapter 3</a><!-- ignore -->.</p>
</section>
<p>Returning to the guessing game program, you now know that <code>let mut guess</code> will
introduce a mutable variable named <code>guess</code>. The equal sign (<code>=</code>) tells Rust we
want to bind something to the variable now. On the right of the equal sign is
the value that <code>guess</code> is bound to, which is the result of calling
<code>String::new</code>, a function that returns a new instance of a <code>String</code>.
<a href="../std/string/struct.String.html"><code>String</code></a><!-- ignore --> is a string type provided by the standard
library that is a growable, UTF-8 encoded bit of text.</p>
<p>The <code>::</code> syntax in the <code>::new</code> line indicates that <code>new</code> is an associated
function of the <code>String</code> type. An <em>associated function</em> is a function thatâ€™s
implemented on a type, in this case <code>String</code>. This <code>new</code> function creates a
new, empty string. Youâ€™ll find a <code>new</code> function on many types because itâ€™s a
common name for a function that makes a new value of some kind.</p>
<p>In full, the <code>let mut guess = String::new();</code> line has created a mutable
variable that is currently bound to a new, empty instance of a <code>String</code>. Whew!</p>
<h3 id="receiving-user-input"><a class="header" href="#receiving-user-input">Receiving User Input</a></h3>
<p>Recall that we included the input/output functionality from the standard
library with <code>use std::io;</code> on the first line of the program. Now weâ€™ll call
the <code>stdin</code> function from the <code>io</code> module, which will allow us to handle user
input:</p>
<pre><code class="language-rust ignore"><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span>    io::stdin()
        .read_line(&amp;mut guess)
<span class="boring">        .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">    println!("You guessed: {guess}");
</span><span class="boring">}</span></code></pre>
<p>If we hadnâ€™t imported the <code>io</code> library with <code>use std::io;</code> at the beginning of
the program, we could still use the function by writing this function call as
<code>std::io::stdin</code>. The <code>stdin</code> function returns an instance of
<a href="../std/io/struct.Stdin.html"><code>std::io::Stdin</code></a><!-- ignore -->, which is a type that represents a
handle to the standard input for your terminal.</p>
<p>Next, the line <code>.read_line(&amp;mut guess)</code> calls the <a href="../std/io/struct.Stdin.html#method.read_line"><code>read_line</code></a><!--
ignore --> method on the standard input handle to get input from the user.
Weâ€™re also passing <code>&amp;mut guess</code> as the argument to <code>read_line</code> to tell it what
string to store the user input in. The full job of <code>read_line</code> is to take
whatever the user types into standard input and append that into a string
(without overwriting its contents), so we therefore pass that string as an
argument. The string argument needs to be mutable so the method can change the
stringâ€™s content.</p>
<p>The <code>&amp;</code> indicates that this argument is a <em>reference</em>, which gives you a way to
let multiple parts of your code access one piece of data without needing to
copy that data into memory multiple times. References are a complex feature,
and one of Rustâ€™s major advantages is how safe and easy it is to use
references. You donâ€™t need to know a lot of those details to finish this
program. For now, all you need to know is that, like variables, references are
immutable by default. Hence, you need to write <code>&amp;mut guess</code> rather than
<code>&amp;guess</code> to make it mutable. (Chapter 4 will explain references more
thoroughly.)</p>
<!-- Old heading. Do not remove or links may break. -->
<p><a id="handling-potential-failure-with-the-result-type"></a></p>
<h3 id="handling-potential-failure-with-result"><a class="header" href="#handling-potential-failure-with-result">Handling Potential Failure with <code>Result</code></a></h3>
<p>Weâ€™re still working on this line of code. Weâ€™re now discussing a third line of
text, but note that itâ€™s still part of a single logical line of code. The next
part is this method:</p>
<pre><code class="language-rust ignore"><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span>        .expect("Failed to read line");
<span class="boring">
</span><span class="boring">    println!("You guessed: {guess}");
</span><span class="boring">}</span></code></pre>
<p>We could have written this code as:</p>
<pre><code class="language-rust ignore">io::stdin().read_line(&amp;mut guess).expect("Failed to read line");</code></pre>
<p>However, one long line is difficult to read, so itâ€™s best to divide it. Itâ€™s
often wise to introduce a newline and other whitespace to help break up long
lines when you call a method with the <code>.method_name()</code> syntax. Now letâ€™s
discuss what this line does.</p>
<p>As mentioned earlier, <code>read_line</code> puts whatever the user enters into the string
we pass to it, but it also returns a <code>Result</code> value. <a href="../std/result/enum.Result.html"><code>Result</code></a><!--
ignore --> is an <a href="ch06-00-enums.html"><em>enumeration</em></a><!-- ignore -->, often called an <em>enum</em>,
which is a type that can be in one of multiple possible states. We call each
possible state a <em>variant</em>.</p>
<p><a href="ch06-00-enums.html">Chapter 6</a><!-- ignore --> will cover enums in more detail. The purpose
of these <code>Result</code> types is to encode error-handling information.</p>
<p><code>Result</code>â€™s variants are <code>Ok</code> and <code>Err</code>. The <code>Ok</code> variant indicates the
operation was successful, and inside <code>Ok</code> is the successfully generated value.
The <code>Err</code> variant means the operation failed, and <code>Err</code> contains information
about how or why the operation failed.</p>
<p>Values of the <code>Result</code> type, like values of any type, have methods defined on
them. An instance of <code>Result</code> has an <a href="../std/result/enum.Result.html#method.expect"><code>expect</code> method</a><!-- ignore -->
that you can call. If this instance of <code>Result</code> is an <code>Err</code> value, <code>expect</code>
will cause the program to crash and display the message that you passed as an
argument to <code>expect</code>. If the <code>read_line</code> method returns an <code>Err</code>, it would
likely be the result of an error coming from the underlying operating system.
If this instance of <code>Result</code> is an <code>Ok</code> value, <code>expect</code> will take the return
value that <code>Ok</code> is holding and return just that value to you so you can use it.
In this case, that value is the number of bytes in the userâ€™s input.</p>
<p>If you donâ€™t call <code>expect</code>, the program will compile, but youâ€™ll get a warning:</p>
<pre><code class="language-console">$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
warning: unused `Result` that must be used
  --&gt; src/main.rs:10:5
   |
10 |     io::stdin().read_line(&amp;mut guess);
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = note: this `Result` may be an `Err` variant, which should be handled
   = note: `#[warn(unused_must_use)]` on by default
help: use `let _ = ...` to ignore the resulting value
   |
10 |     let _ = io::stdin().read_line(&amp;mut guess);
   |     +++++++

warning: `guessing_game` (bin "guessing_game") generated 1 warning
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.59s
</code></pre>
<p>Rust warns that you havenâ€™t used the <code>Result</code> value returned from <code>read_line</code>,
indicating that the program hasnâ€™t handled a possible error.</p>
<p>The right way to suppress the warning is to actually write error-handling code,
but in our case we just want to crash this program when a problem occurs, so we
can use <code>expect</code>. Youâ€™ll learn about recovering from errors in <a href="ch09-02-recoverable-errors-with-result.html">Chapter
9</a><!-- ignore -->.</p>
<h3 id="printing-values-with-println-placeholders"><a class="header" href="#printing-values-with-println-placeholders">Printing Values with <code>println!</code> Placeholders</a></h3>
<p>Aside from the closing curly bracket, thereâ€™s only one more line to discuss in
the code so far:</p>
<pre><code class="language-rust ignore"><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span><span class="boring">        .expect("Failed to read line");
</span><span class="boring">
</span>    println!("You guessed: {guess}");
<span class="boring">}</span></code></pre>
<p>This line prints the string that now contains the userâ€™s input. The <code>{}</code> set of
curly brackets is a placeholder: think of <code>{}</code> as little crab pincers that hold
a value in place. When printing the value of a variable, the variable name can
go inside the curly brackets. When printing the result of evaluating an
expression, place empty curly brackets in the format string, then follow the
format string with a comma-separated list of expressions to print in each empty
curly bracket placeholder in the same order. Printing a variable and the result
of an expression in one call to <code>println!</code> would look like this:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 5;
let y = 10;

println!("x = {x} and y + 2 = {}", y + 2);
<span class="boring">}</span></code></pre></pre>
<p>This code would print <code>x = 5 and y = 12</code>.</p>
<h3 id="testing-the-first-part"><a class="header" href="#testing-the-first-part">Testing the First Part</a></h3>
<p>Letâ€™s test the first part of the guessing game. Run it using <code>cargo run</code>:</p>
<!-- manual-regeneration
cd listings/ch02-guessing-game-tutorial/listing-02-01/
cargo clean
cargo run
input 6 -->
<pre><code class="language-console">$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 6.44s
     Running `target/debug/guessing_game`
Guess the number!
Please input your guess.
6
You guessed: 6
</code></pre>
<p>At this point, the first part of the game is done: weâ€™re getting input from the
keyboard and then printing it.</p>
<h2 id="generating-a-secret-number"><a class="header" href="#generating-a-secret-number">Generating a Secret Number</a></h2>
<p>Next, we need to generate a secret number that the user will try to guess. The
secret number should be different every time so the game is fun to play more
than once. Weâ€™ll use a random number between 1 and 100 so the game isnâ€™t too
difficult. Rust doesnâ€™t yet include random number functionality in its standard
library. However, the Rust team does provide a <a href="https://crates.io/crates/rand"><code>rand</code> crate</a> with
said functionality.</p>
<h3 id="using-a-crate-to-get-more-functionality"><a class="header" href="#using-a-crate-to-get-more-functionality">Using a Crate to Get More Functionality</a></h3>
<p>Remember that a crate is a collection of Rust source code files. The project
weâ€™ve been building is a <em>binary crate</em>, which is an executable. The <code>rand</code>
crate is a <em>library crate</em>, which contains code that is intended to be used in
other programs and canâ€™t be executed on its own.</p>
<p>Cargoâ€™s coordination of external crates is where Cargo really shines. Before we
can write code that uses <code>rand</code>, we need to modify the <em>Cargo.toml</em> file to
include the <code>rand</code> crate as a dependency. Open that file now and add the
following line to the bottom, beneath the <code>[dependencies]</code> section header that
Cargo created for you. Be sure to specify <code>rand</code> exactly as we have here, with
this version number, or the code examples in this tutorial may not work:</p>
<!-- When updating the version of `rand` used, also update the version of
`rand` used in these files so they all match:
* ch07-04-bringing-paths-into-scope-with-the-use-keyword.md
* ch14-03-cargo-workspaces.md
-->
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">[dependencies]
rand = "0.8.5"
</code></pre>
<p>In the <em>Cargo.toml</em> file, everything that follows a header is part of that
section that continues until another section starts. In <code>[dependencies]</code> you
tell Cargo which external crates your project depends on and which versions of
those crates you require. In this case, we specify the <code>rand</code> crate with the
semantic version specifier <code>0.8.5</code>. Cargo understands <a href="http://semver.org">Semantic
Versioning</a><!-- ignore --> (sometimes called <em>SemVer</em>), which is a
standard for writing version numbers. The specifier <code>0.8.5</code> is actually
shorthand for <code>^0.8.5</code>, which means any version that is at least 0.8.5 but
below 0.9.0.</p>
<p>Cargo considers these versions to have public APIs compatible with version
0.8.5, and this specification ensures youâ€™ll get the latest patch release that
will still compile with the code in this chapter. Any version 0.9.0 or greater
is not guaranteed to have the same API as what the following examples use.</p>
<p>Now, without changing any of the code, letâ€™s build the project, as shown in
Listing 2-2.</p>
<!-- manual-regeneration
cd listings/ch02-guessing-game-tutorial/listing-02-02/
rm Cargo.lock
cargo clean
cargo build -->
<pre><code class="language-console">$ cargo build
    Updating crates.io index
  Downloaded rand v0.8.5
  Downloaded libc v0.2.127
  Downloaded getrandom v0.2.7
  Downloaded cfg-if v1.0.0
  Downloaded ppv-lite86 v0.2.16
  Downloaded rand_chacha v0.3.1
  Downloaded rand_core v0.6.3
   Compiling libc v0.2.127
   Compiling getrandom v0.2.7
   Compiling cfg-if v1.0.0
   Compiling ppv-lite86 v0.2.16
   Compiling rand_core v0.6.3
   Compiling rand_chacha v0.3.1
   Compiling rand v0.8.5
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53s
</code></pre>
<p><span class="caption">Listing 2-2: The output from running <code>cargo build</code> after
adding the rand crate as a dependency</span></p>
<p>You may see different version numbers (but they will all be compatible with the
code, thanks to SemVer!) and different lines (depending on the operating
system), and the lines may be in a different order.</p>
<p>When we include an external dependency, Cargo fetches the latest versions of
everything that dependency needs from the <em>registry</em>, which is a copy of data
from <a href="https://crates.io/">Crates.io</a>. Crates.io is where people in the Rust ecosystem
post their open source Rust projects for others to use.</p>
<p>After updating the registry, Cargo checks the <code>[dependencies]</code> section and
downloads any crates listed that arenâ€™t already downloaded. In this case,
although we only listed <code>rand</code> as a dependency, Cargo also grabbed other crates
that <code>rand</code> depends on to work. After downloading the crates, Rust compiles
them and then compiles the project with the dependencies available.</p>
<p>If you immediately run <code>cargo build</code> again without making any changes, you
wonâ€™t get any output aside from the <code>Finished</code> line. Cargo knows it has already
downloaded and compiled the dependencies, and you havenâ€™t changed anything
about them in your <em>Cargo.toml</em> file. Cargo also knows that you havenâ€™t changed
anything about your code, so it doesnâ€™t recompile that either. With nothing to
do, it simply exits.</p>
<p>If you open the <em>src/main.rs</em> file, make a trivial change, and then save it and
build again, youâ€™ll only see two lines of output:</p>
<!-- manual-regeneration
cd listings/ch02-guessing-game-tutorial/listing-02-02/
touch src/main.rs
cargo build -->
<pre><code class="language-console">$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53 secs
</code></pre>
<p>These lines show that Cargo only updates the build with your tiny change to the
<em>src/main.rs</em> file. Your dependencies havenâ€™t changed, so Cargo knows it can
reuse what it has already downloaded and compiled for those.</p>
<h4 id="ensuring-reproducible-builds-with-the-cargolock-file"><a class="header" href="#ensuring-reproducible-builds-with-the-cargolock-file">Ensuring Reproducible Builds with the <em>Cargo.lock</em> File</a></h4>
<p>Cargo has a mechanism that ensures you can rebuild the same artifact every time
you or anyone else builds your code: Cargo will use only the versions of the
dependencies you specified until you indicate otherwise. For example, say that
next week version 0.8.6 of the <code>rand</code> crate comes out, and that version
contains an important bug fix, but it also contains a regression that will
break your code. To handle this, Rust creates the <em>Cargo.lock</em> file the first
time you run <code>cargo build</code>, so we now have this in the <em>guessing_game</em>
directory.</p>
<p>When you build a project for the first time, Cargo figures out all the versions
of the dependencies that fit the criteria and then writes them to the
<em>Cargo.lock</em> file. When you build your project in the future, Cargo will see
that the <em>Cargo.lock</em> file exists and will use the versions specified there
rather than doing all the work of figuring out versions again. This lets you
have a reproducible build automatically. In other words, your project will
remain at 0.8.5 until you explicitly upgrade, thanks to the <em>Cargo.lock</em> file.
Because the <em>Cargo.lock</em> file is important for reproducible builds, itâ€™s often
checked into source control with the rest of the code in your project.</p>
<h4 id="updating-a-crate-to-get-a-new-version"><a class="header" href="#updating-a-crate-to-get-a-new-version">Updating a Crate to Get a New Version</a></h4>
<p>When you <em>do</em> want to update a crate, Cargo provides the command <code>update</code>,
which will ignore the <em>Cargo.lock</em> file and figure out all the latest versions
that fit your specifications in <em>Cargo.toml</em>. Cargo will then write those
versions to the <em>Cargo.lock</em> file. Otherwise, by default, Cargo will only look
for versions greater than 0.8.5 and less than 0.9.0. If the <code>rand</code> crate has
released the two new versions 0.8.6 and 0.9.0, you would see the following if
you ran <code>cargo update</code>:</p>
<!-- manual-regeneration
cd listings/ch02-guessing-game-tutorial/listing-02-02/
cargo update
assuming there is a new 0.8.x version of rand; otherwise use another update
as a guide to creating the hypothetical output shown here -->
<pre><code class="language-console">$ cargo update
    Updating crates.io index
    Updating rand v0.8.5 -&gt; v0.8.6
</code></pre>
<p>Cargo ignores the 0.9.0 release. At this point, you would also notice a change
in your <em>Cargo.lock</em> file noting that the version of the <code>rand</code> crate you are
now using is 0.8.6. To use <code>rand</code> version 0.9.0 or any version in the 0.9.<em>x</em>
series, youâ€™d have to update the <em>Cargo.toml</em> file to look like this instead:</p>
<pre><code class="language-toml">[dependencies]
rand = "0.9.0"
</code></pre>
<p>The next time you run <code>cargo build</code>, Cargo will update the registry of crates
available and reevaluate your <code>rand</code> requirements according to the new version
you have specified.</p>
<p>Thereâ€™s a lot more to say about <a href="http://doc.crates.io">Cargo</a><!-- ignore --> and <a href="http://doc.crates.io/crates-io.html">its
ecosystem</a><!-- ignore -->, which weâ€™ll discuss in Chapter 14, but
for now, thatâ€™s all you need to know. Cargo makes it very easy to reuse
libraries, so Rustaceans are able to write smaller projects that are assembled
from a number of packages.</p>
<h3 id="generating-a-random-number"><a class="header" href="#generating-a-random-number">Generating a Random Number</a></h3>
<p>Letâ€™s start using <code>rand</code> to generate a number to guess. The next step is to
update <em>src/main.rs</em>, as shown in Listing 2-3.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">use std::io;

use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1..=100);

    println!("The secret number is: {secret_number}");

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin()
        .read_line(&amp;mut guess)
        .expect("Failed to read line");

    println!("You guessed: {guess}");
}</code></pre>
<p><span class="caption">Listing 2-3: Adding code to generate a random
number</span></p>
<p>First we add the line <code>use rand::Rng;</code>. The <code>Rng</code> trait defines methods that
random number generators implement, and this trait must be in scope for us to
use those methods. Chapter 10 will cover traits in detail.</p>
<p>Next, weâ€™re adding two lines in the middle. In the first line, we call the
<code>rand::thread_rng</code> function that gives us the particular random number
generator weâ€™re going to use: one that is local to the current thread of
execution and is seeded by the operating system. Then we call the <code>gen_range</code>
method on the random number generator. This method is defined by the <code>Rng</code>
trait that we brought into scope with the <code>use rand::Rng;</code> statement. The
<code>gen_range</code> method takes a range expression as an argument and generates a
random number in the range. The kind of range expression weâ€™re using here takes
the form <code>start..=end</code> and is inclusive on the lower and upper bounds, so we
need to specify <code>1..=100</code> to request a number between 1 and 100.</p>
<section class="note" aria-role="note">
<p>Note: You wonâ€™t just know which traits to use and which methods and functions
to call from a crate, so each crate has documentation with instructions for
using it. Another neat feature of Cargo is that running the <code>cargo doc --open</code> command will build documentation provided by all your dependencies
locally and open it in your browser. If youâ€™re interested in other
functionality in the <code>rand</code> crate, for example, run <code>cargo doc --open</code> and
click <code>rand</code> in the sidebar on the left.</p>
</section>
<p>The second new line prints the secret number. This is useful while weâ€™re
developing the program to be able to test it, but weâ€™ll delete it from the
final version. Itâ€™s not much of a game if the program prints the answer as soon
as it starts!</p>
<p>Try running the program a few times:</p>
<!-- manual-regeneration
cd listings/ch02-guessing-game-tutorial/listing-02-03/
cargo run
4
cargo run
5
-->
<pre><code class="language-console">$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 7
Please input your guess.
4
You guessed: 4

$ cargo run
    Finished dev [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 83
Please input your guess.
5
You guessed: 5
</code></pre>
<p>You should get different random numbers, and they should all be numbers between
1 and 100. Great job!</p>
<h2 id="comparing-the-guess-to-the-secret-number"><a class="header" href="#comparing-the-guess-to-the-secret-number">Comparing the Guess to the Secret Number</a></h2>
<p>Now that we have user input and a random number, we can compare them. That step
is shown in Listing 2-4. Note that this code wonâ€™t compile just yet, as we will
explain.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">use std::cmp::Ordering;
use std::io;

use rand::Rng;

fn main() {
    // --snip--
<span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    let secret_number = rand::thread_rng().gen_range(1..=100);
</span><span class="boring">
</span><span class="boring">    println!("The secret number is: {secret_number}");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span><span class="boring">        .expect("Failed to read line");
</span>
    println!("You guessed: {guess}");

    match guess.cmp(&amp;secret_number) {
        Ordering::Less =&gt; println!("Too small!"),
        Ordering::Greater =&gt; println!("Too big!"),
        Ordering::Equal =&gt; println!("You win!"),
    }
}</code></pre>
<p><span class="caption">Listing 2-4: Handling the possible return values of
comparing two numbers</span></p>
<p>First we add another <code>use</code> statement, bringing a type called
<code>std::cmp::Ordering</code> into scope from the standard library. The <code>Ordering</code> type
is another enum and has the variants <code>Less</code>, <code>Greater</code>, and <code>Equal</code>. These are
the three outcomes that are possible when you compare two values.</p>
<p>Then we add five new lines at the bottom that use the <code>Ordering</code> type. The
<code>cmp</code> method compares two values and can be called on anything that can be
compared. It takes a reference to whatever you want to compare with: here itâ€™s
comparing <code>guess</code> to <code>secret_number</code>. Then it returns a variant of the
<code>Ordering</code> enum we brought into scope with the <code>use</code> statement. We use a
<a href="ch06-02-match.html"><code>match</code></a><!-- ignore --> expression to decide what to do next based on
which variant of <code>Ordering</code> was returned from the call to <code>cmp</code> with the values
in <code>guess</code> and <code>secret_number</code>.</p>
<p>A <code>match</code> expression is made up of <em>arms</em>. An arm consists of a <em>pattern</em> to
match against, and the code that should be run if the value given to <code>match</code>
fits that armâ€™s pattern. Rust takes the value given to <code>match</code> and looks
through each armâ€™s pattern in turn. Patterns and the <code>match</code> construct are
powerful Rust features: they let you express a variety of situations your code
might encounter and they make sure you handle them all. These features will be
covered in detail in Chapter 6 and Chapter 18, respectively.</p>
<p>Letâ€™s walk through an example with the <code>match</code> expression we use here. Say that
the user has guessed 50 and the randomly generated secret number this time is
38.</p>
<p>When the code compares 50 to 38, the <code>cmp</code> method will return
<code>Ordering::Greater</code> because 50 is greater than 38. The <code>match</code> expression gets
the <code>Ordering::Greater</code> value and starts checking each armâ€™s pattern. It looks
at the first armâ€™s pattern, <code>Ordering::Less</code>, and sees that the value
<code>Ordering::Greater</code> does not match <code>Ordering::Less</code>, so it ignores the code in
that arm and moves to the next arm. The next armâ€™s pattern is
<code>Ordering::Greater</code>, which <em>does</em> match <code>Ordering::Greater</code>! The associated
code in that arm will execute and print <code>Too big!</code> to the screen. The <code>match</code>
expression ends after the first successful match, so it wonâ€™t look at the last
arm in this scenario.</p>
<p>However, the code in Listing 2-4 wonâ€™t compile yet. Letâ€™s try it:</p>
<!--
The error numbers in this output should be that of the code **WITHOUT** the
anchor or snip comments
-->
<pre><code class="language-console">$ cargo build
   Compiling libc v0.2.86
   Compiling getrandom v0.2.2
   Compiling cfg-if v1.0.0
   Compiling ppv-lite86 v0.2.10
   Compiling rand_core v0.6.2
   Compiling rand_chacha v0.3.0
   Compiling rand v0.8.5
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
error[E0308]: mismatched types
  --&gt; src/main.rs:23:21
   |
23 |     match guess.cmp(&amp;secret_number) {
   |                 --- ^^^^^^^^^^^^^^ expected `&amp;String`, found `&amp;{integer}`
   |                 |
   |                 arguments to this method are incorrect
   |
   = note: expected reference `&amp;String`
              found reference `&amp;{integer}`
note: method defined here
  --&gt; /rustc/4eb161250e340c8f48f66e2b929ef4a5bed7c181/library/core/src/cmp.rs:964:8

For more information about this error, try `rustc --explain E0308`.
error: could not compile `guessing_game` (bin "guessing_game") due to 1 previous error
</code></pre>
<p>The core of the error states that there are <em>mismatched types</em>. Rust has a
strong, static type system. However, it also has type inference. When we wrote
<code>let mut guess = String::new()</code>, Rust was able to infer that <code>guess</code> should be
a <code>String</code> and didnâ€™t make us write the type. The <code>secret_number</code>, on the other
hand, is a number type. A few of Rustâ€™s number types can have a value between 1
and 100: <code>i32</code>, a 32-bit number; <code>u32</code>, an unsigned 32-bit number; <code>i64</code>, a
64-bit number; as well as others. Unless otherwise specified, Rust defaults to
an <code>i32</code>, which is the type of <code>secret_number</code> unless you add type information
elsewhere that would cause Rust to infer a different numerical type. The reason
for the error is that Rust cannot compare a string and a number type.</p>
<p>Ultimately, we want to convert the <code>String</code> the program reads as input into a
real number type so we can compare it numerically to the secret number. We do
so by adding this line to the <code>main</code> function body:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::cmp::Ordering;
</span><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">use rand::Rng;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    let secret_number = rand::thread_rng().gen_range(1..=100);
</span><span class="boring">
</span><span class="boring">    println!("The secret number is: {secret_number}");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span>    // --snip--

    let mut guess = String::new();

    io::stdin()
        .read_line(&amp;mut guess)
        .expect("Failed to read line");

    let guess: u32 = guess.trim().parse().expect("Please type a number!");

    println!("You guessed: {guess}");

    match guess.cmp(&amp;secret_number) {
        Ordering::Less =&gt; println!("Too small!"),
        Ordering::Greater =&gt; println!("Too big!"),
        Ordering::Equal =&gt; println!("You win!"),
    }
<span class="boring">}</span></code></pre>
<p>The line is:</p>
<pre><code class="language-rust ignore">let guess: u32 = guess.trim().parse().expect("Please type a number!");</code></pre>
<p>We create a variable named <code>guess</code>. But wait, doesnâ€™t the program already have
a variable named <code>guess</code>? It does, but helpfully Rust allows us to shadow the
previous value of <code>guess</code> with a new one. <em>Shadowing</em> lets us reuse the <code>guess</code>
variable name rather than forcing us to create two unique variables, such as
<code>guess_str</code> and <code>guess</code>, for example. Weâ€™ll cover this in more detail in
<a href="ch03-01-variables-and-mutability.html#shadowing">Chapter 3</a><!-- ignore -->, but for now, know that this feature is
often used when you want to convert a value from one type to another type.</p>
<p>We bind this new variable to the expression <code>guess.trim().parse()</code>. The <code>guess</code>
in the expression refers to the original <code>guess</code> variable that contained the
input as a string. The <code>trim</code> method on a <code>String</code> instance will eliminate any
whitespace at the beginning and end, which we must do to be able to compare the
string to the <code>u32</code>, which can only contain numerical data. The user must press
<span class="keystroke">enter</span> to satisfy <code>read_line</code> and input their
guess, which adds a newline character to the string. For example, if the user
types <span class="keystroke">5</span> and presses <span
class="keystroke">enter</span>, <code>guess</code> looks like this: <code>5\n</code>. The <code>\n</code>
represents â€œnewline.â€ (On Windows, pressing <span
class="keystroke">enter</span> results in a carriage return and a newline,
<code>\r\n</code>.) The <code>trim</code> method eliminates <code>\n</code> or <code>\r\n</code>, resulting in just <code>5</code>.</p>
<p>The <a href="../std/primitive.str.html#method.parse"><code>parse</code> method on strings</a><!-- ignore --> converts a string to
another type. Here, we use it to convert from a string to a number. We need to
tell Rust the exact number type we want by using <code>let guess: u32</code>. The colon
(<code>:</code>) after <code>guess</code> tells Rust weâ€™ll annotate the variableâ€™s type. Rust has a
few built-in number types; the <code>u32</code> seen here is an unsigned, 32-bit integer.
Itâ€™s a good default choice for a small positive number. Youâ€™ll learn about
other number types in <a href="ch03-02-data-types.html#integer-types">Chapter 3</a><!-- ignore -->.</p>
<p>Additionally, the <code>u32</code> annotation in this example program and the comparison
with <code>secret_number</code> means Rust will infer that <code>secret_number</code> should be a
<code>u32</code> as well. So now the comparison will be between two values of the same
type!</p>
<p>The <code>parse</code> method will only work on characters that can logically be converted
into numbers and so can easily cause errors. If, for example, the string
contained <code>AğŸ‘%</code>, there would be no way to convert that to a number. Because it
might fail, the <code>parse</code> method returns a <code>Result</code> type, much as the <code>read_line</code>
method does (discussed earlier in <a href="ch02-00-guessing-game-tutorial.html#handling-potential-failure-with-result">â€œHandling Potential Failure with
<code>Result</code>â€</a><!-- ignore-->). Weâ€™ll treat
this <code>Result</code> the same way by using the <code>expect</code> method again. If <code>parse</code>
returns an <code>Err</code> <code>Result</code> variant because it couldnâ€™t create a number from the
string, the <code>expect</code> call will crash the game and print the message we give it.
If <code>parse</code> can successfully convert the string to a number, it will return the
<code>Ok</code> variant of <code>Result</code>, and <code>expect</code> will return the number that we want from
the <code>Ok</code> value.</p>
<p>Letâ€™s run the program now:</p>
<!-- manual-regeneration
cd listings/ch02-guessing-game-tutorial/no-listing-03-convert-string-to-number/
cargo run
  76
-->
<pre><code class="language-console">$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 0.43s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 58
Please input your guess.
  76
You guessed: 76
Too big!
</code></pre>
<p>Nice! Even though spaces were added before the guess, the program still figured
out that the user guessed 76. Run the program a few times to verify the
different behavior with different kinds of input: guess the number correctly,
guess a number that is too high, and guess a number that is too low.</p>
<p>We have most of the game working now, but the user can make only one guess.
Letâ€™s change that by adding a loop!</p>
<h2 id="allowing-multiple-guesses-with-looping"><a class="header" href="#allowing-multiple-guesses-with-looping">Allowing Multiple Guesses with Looping</a></h2>
<p>The <code>loop</code> keyword creates an infinite loop. Weâ€™ll add a loop to give users
more chances at guessing the number:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::cmp::Ordering;
</span><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">use rand::Rng;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    let secret_number = rand::thread_rng().gen_range(1..=100);
</span><span class="boring">
</span>    // --snip--

    println!("The secret number is: {secret_number}");

    loop {
        println!("Please input your guess.");

        // --snip--

<span class="boring">
</span><span class="boring">        let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">        io::stdin()
</span><span class="boring">            .read_line(&amp;mut guess)
</span><span class="boring">            .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">        let guess: u32 = guess.trim().parse().expect("Please type a number!");
</span><span class="boring">
</span><span class="boring">        println!("You guessed: {guess}");
</span><span class="boring">
</span>        match guess.cmp(&amp;secret_number) {
            Ordering::Less =&gt; println!("Too small!"),
            Ordering::Greater =&gt; println!("Too big!"),
            Ordering::Equal =&gt; println!("You win!"),
        }
    }
}</code></pre>
<p>As you can see, weâ€™ve moved everything from the guess input prompt onward into
a loop. Be sure to indent the lines inside the loop another four spaces each
and run the program again. The program will now ask for another guess forever,
which actually introduces a new problem. It doesnâ€™t seem like the user can quit!</p>
<p>The user could always interrupt the program by using the keyboard shortcut
<span class="keystroke">ctrl-c</span>. But thereâ€™s another way to escape this
insatiable monster, as mentioned in the <code>parse</code> discussion in <a href="ch02-00-guessing-game-tutorial.html#comparing-the-guess-to-the-secret-number">â€œComparing the
Guess to the Secret Numberâ€</a><!--
ignore -->: if the user enters a non-number answer, the program will crash. We
can take advantage of that to allow the user to quit, as shown here:</p>
<!-- manual-regeneration
cd listings/ch02-guessing-game-tutorial/no-listing-04-looping/
cargo run
(too small guess)
(too big guess)
(correct guess)
quit
-->
<pre><code class="language-console">$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 1.50s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 59
Please input your guess.
45
You guessed: 45
Too small!
Please input your guess.
60
You guessed: 60
Too big!
Please input your guess.
59
You guessed: 59
You win!
Please input your guess.
quit
thread 'main' panicked at 'Please type a number!: ParseIntError { kind: InvalidDigit }', src/main.rs:28:47
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>Typing <code>quit</code> will quit the game, but as youâ€™ll notice, so will entering any
other non-number input. This is suboptimal, to say the least; we want the game
to also stop when the correct number is guessed.</p>
<h3 id="quitting-after-a-correct-guess"><a class="header" href="#quitting-after-a-correct-guess">Quitting After a Correct Guess</a></h3>
<p>Letâ€™s program the game to quit when the user wins by adding a <code>break</code> statement:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::cmp::Ordering;
</span><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">use rand::Rng;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    let secret_number = rand::thread_rng().gen_range(1..=100);
</span><span class="boring">
</span><span class="boring">    println!("The secret number is: {secret_number}");
</span><span class="boring">
</span><span class="boring">    loop {
</span><span class="boring">        println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">        let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">        io::stdin()
</span><span class="boring">            .read_line(&amp;mut guess)
</span><span class="boring">            .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">        let guess: u32 = guess.trim().parse().expect("Please type a number!");
</span><span class="boring">
</span><span class="boring">        println!("You guessed: {guess}");
</span><span class="boring">
</span>        // --snip--

        match guess.cmp(&amp;secret_number) {
            Ordering::Less =&gt; println!("Too small!"),
            Ordering::Greater =&gt; println!("Too big!"),
            Ordering::Equal =&gt; {
                println!("You win!");
                break;
            }
        }
    }
}</code></pre>
<p>Adding the <code>break</code> line after <code>You win!</code> makes the program exit the loop when
the user guesses the secret number correctly. Exiting the loop also means
exiting the program, because the loop is the last part of <code>main</code>.</p>
<h3 id="handling-invalid-input"><a class="header" href="#handling-invalid-input">Handling Invalid Input</a></h3>
<p>To further refine the gameâ€™s behavior, rather than crashing the program when
the user inputs a non-number, letâ€™s make the game ignore a non-number so the
user can continue guessing. We can do that by altering the line where <code>guess</code>
is converted from a <code>String</code> to a <code>u32</code>, as shown in Listing 2-5.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::cmp::Ordering;
</span><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">use rand::Rng;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    let secret_number = rand::thread_rng().gen_range(1..=100);
</span><span class="boring">
</span><span class="boring">    println!("The secret number is: {secret_number}");
</span><span class="boring">
</span><span class="boring">    loop {
</span><span class="boring">        println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">        let mut guess = String::new();
</span><span class="boring">
</span>        // --snip--

        io::stdin()
            .read_line(&amp;mut guess)
            .expect("Failed to read line");

        let guess: u32 = match guess.trim().parse() {
            Ok(num) =&gt; num,
            Err(_) =&gt; continue,
        };

        println!("You guessed: {guess}");

        // --snip--
<span class="boring">
</span><span class="boring">        match guess.cmp(&amp;secret_number) {
</span><span class="boring">            Ordering::Less =&gt; println!("Too small!"),
</span><span class="boring">            Ordering::Greater =&gt; println!("Too big!"),
</span><span class="boring">            Ordering::Equal =&gt; {
</span><span class="boring">                println!("You win!");
</span><span class="boring">                break;
</span><span class="boring">            }
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 2-5: Ignoring a non-number guess and asking for
another guess instead of crashing the program</span></p>
<p>We switch from an <code>expect</code> call to a <code>match</code> expression to move from crashing
on an error to handling the error. Remember that <code>parse</code> returns a <code>Result</code>
type and <code>Result</code> is an enum that has the variants <code>Ok</code> and <code>Err</code>. Weâ€™re using
a <code>match</code> expression here, as we did with the <code>Ordering</code> result of the <code>cmp</code>
method.</p>
<p>If <code>parse</code> is able to successfully turn the string into a number, it will
return an <code>Ok</code> value that contains the resultant number. That <code>Ok</code> value will
match the first armâ€™s pattern, and the <code>match</code> expression will just return the
<code>num</code> value that <code>parse</code> produced and put inside the <code>Ok</code> value. That number
will end up right where we want it in the new <code>guess</code> variable weâ€™re creating.</p>
<p>If <code>parse</code> is <em>not</em> able to turn the string into a number, it will return an
<code>Err</code> value that contains more information about the error. The <code>Err</code> value
does not match the <code>Ok(num)</code> pattern in the first <code>match</code> arm, but it does
match the <code>Err(_)</code> pattern in the second arm. The underscore, <code>_</code>, is a
catchall value; in this example, weâ€™re saying we want to match all <code>Err</code>
values, no matter what information they have inside them. So the program will
execute the second armâ€™s code, <code>continue</code>, which tells the program to go to the
next iteration of the <code>loop</code> and ask for another guess. So, effectively, the
program ignores all errors that <code>parse</code> might encounter!</p>
<p>Now everything in the program should work as expected. Letâ€™s try it:</p>
<!-- manual-regeneration
cd listings/ch02-guessing-game-tutorial/listing-02-05/
cargo run
(too small guess)
(too big guess)
foo
(correct guess)
-->
<pre><code class="language-console">$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 4.45s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 61
Please input your guess.
10
You guessed: 10
Too small!
Please input your guess.
99
You guessed: 99
Too big!
Please input your guess.
foo
Please input your guess.
61
You guessed: 61
You win!
</code></pre>
<p>Awesome! With one tiny final tweak, we will finish the guessing game. Recall
that the program is still printing the secret number. That worked well for
testing, but it ruins the game. Letâ€™s delete the <code>println!</code> that outputs the
secret number. Listing 2-6 shows the final code.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">use std::cmp::Ordering;
use std::io;

use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1..=100);

    loop {
        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin()
            .read_line(&amp;mut guess)
            .expect("Failed to read line");

        let guess: u32 = match guess.trim().parse() {
            Ok(num) =&gt; num,
            Err(_) =&gt; continue,
        };

        println!("You guessed: {guess}");

        match guess.cmp(&amp;secret_number) {
            Ordering::Less =&gt; println!("Too small!"),
            Ordering::Greater =&gt; println!("Too big!"),
            Ordering::Equal =&gt; {
                println!("You win!");
                break;
            }
        }
    }
}</code></pre>
<p><span class="caption">Listing 2-6: Complete guessing game code</span></p>
<p>At this point, youâ€™ve successfully built the guessing game. Congratulations!</p>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>This project was a hands-on way to introduce you to many new Rust concepts:
<code>let</code>, <code>match</code>, functions, the use of external crates, and more. In the next
few chapters, youâ€™ll learn about these concepts in more detail. Chapter 3
covers concepts that most programming languages have, such as variables, data
types, and functions, and shows how to use them in Rust. Chapter 4 explores
ownership, a feature that makes Rust different from other languages. Chapter 5
discusses structs and method syntax, and Chapter 6 explains how enums work.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cÃ¡c-khÃ¡i-niá»‡m-láº­p-trÃ¬nh-chung"><a class="header" href="#cÃ¡c-khÃ¡i-niá»‡m-láº­p-trÃ¬nh-chung">CÃ¡c khÃ¡i niá»‡m láº­p trÃ¬nh chung</a></h1>
<p>ChÆ°Æ¡ng nÃ y bao gá»“m cÃ¡c khÃ¡i niá»‡m xuáº¥t hiá»‡n trong háº§u háº¿t má»i ngÃ´n ngá»¯ láº­p trÃ¬nh
vÃ  cÃ¡ch chÃºng hoáº¡t Ä‘á»™ng trong Rust. Nhiá»u ngÃ´n ngá»¯ láº­p trÃ¬nh cÃ³ nhá»¯ng Ä‘iá»ƒm chung trong
pháº§n lÃµi. KhÃ´ng cÃ³ khÃ¡i niá»‡m nÃ o Ä‘Æ°á»£c trÃ¬nh bÃ y trong chÆ°Æ¡ng nÃ y lÃ  duy nháº¥t Ä‘á»‘i vá»›i Rust,
tuy nhiÃªn chÃºng ta sáº½ tháº£o luáº­n vá» chÃºng trong ngá»¯ cáº£nh cá»§a Rust vÃ  giáº£i thÃ­ch cÃ¡c quy Æ°á»›c
xung quanh viá»‡c sá»­ dá»¥ng cÃ¡c khÃ¡i niá»‡m nÃ y.</p>
<p>Cá»¥ thá»ƒ, báº¡n sáº½ tÃ¬m hiá»ƒu vá» cÃ¡c biáº¿n, kiá»ƒu cÆ¡ báº£n, hÃ m, ghi chÃº,
vÃ  cÃ¡c cáº¥u trÃºc Ä‘iá»u khiá»ƒn. Nhá»¯ng ná»n táº£ng nÃ y cÃ³ trong má»i chÆ°Æ¡ng trÃ¬nh Rust, vÃ  viá»‡c há»c
chÃºng sá»›m sáº½ cung cáº¥p cho báº¡n má»™t ná»n táº£ng tá»‘t Ä‘á»ƒ báº¯t Ä‘áº§u.</p>
<section class="note" aria-role="note">
<h4 id="cÃ¡c-tá»«-khÃ³a"><a class="header" href="#cÃ¡c-tá»«-khÃ³a">CÃ¡c tá»« khÃ³a</a></h4>
<p>NgÃ´n ngá»¯ Rust cÃ³ má»™t bá»™ <em>tá»« khÃ³a</em> dÃ nh riÃªng, hoÃ n toÃ n tÆ°Æ¡ng tá»± nhÆ° trong cÃ¡c ngÃ´n ngá»¯ khÃ¡c.
HÃ£y nhá»› ráº±ng báº¡n khÃ´ng thá»ƒ sá»­ dá»¥ng nhá»¯ng tá»« nÃ y lÃ m tÃªn cá»§a cÃ¡c biáº¿n hoáº·c hÃ m. Háº§u háº¿t cÃ¡c tá»« khÃ³a cÃ³
Ã½ nghÄ©a Ä‘áº·c biá»‡t vÃ  báº¡n sáº½ sá»­ dá»¥ng chÃºng Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c nhiá»‡m vá»¥ khÃ¡c nhau trong cÃ¡c
chÆ°Æ¡ng trÃ¬nh Rust cá»§a mÃ¬nh; má»™t sá»‘ Ã­t hiá»‡n táº¡i khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng
nhÆ°ng Ä‘Æ°á»£c dÃ nh riÃªng cho nhá»¯ng chá»©c nÄƒng cÃ³ thá»ƒ Ä‘Æ°á»£c thÃªm vÃ o Rust trong tÆ°Æ¡ng lai. Báº¡n
cÃ³ thá»ƒ tÃ¬m tháº¥y danh sÃ¡ch cÃ¡c tá»« khÃ³a trong <a href="appendix-01-keywords.html">Appendix A</a><!-- ignore -->.</p>
</section>
<div style="break-before: page; page-break-before: always;"></div><p><a id="variables-and-mutability"></a></p>
<h2 id="biáº¿n-vÃ -tÃ­nh-kháº£-biáº¿n"><a class="header" href="#biáº¿n-vÃ -tÃ­nh-kháº£-biáº¿n">Biáº¿n vÃ  tÃ­nh kháº£ biáº¿n</a></h2>
<p>NhÆ° Ä‘Ã£ nháº¯c Ä‘áº¿n trong pháº§n <a href="ch02-00-guessing-game-tutorial.html#storing-values-with-variables">â€œStoring Values with
Variablesâ€</a><!-- ignore -->, máº·c nhiÃªn cÃ¡c biáº¿n
lÃ  khÃ´ng thá»ƒ thay Ä‘á»•i giÃ¡ trá»‹ (immutable). ÄÃ¢y lÃ  má»™t trong nhiá»u cÃ¡ch Rust mang Ä‘áº¿n Ä‘á»ƒ giÃºp viáº¿t
ra nhá»¯ng Ä‘oáº¡n code an toÃ n vÃ  dá»… dÃ ng hoáº¡t Ä‘á»™ng song song. Tuy nhiÃªn, báº¡n váº«n cÃ³ cÃ¡c
tÃ¹y chá»n Ä‘á»ƒ cho phÃ©p thay Ä‘á»•i giÃ¡ trá»‹ cÃ¡c biáº¿n. HÃ£y cÃ¹ng chÃºng tÃ´i xem qua nhÆ° tháº¿
nÃ o vÃ  vÃ¬ sao Rust khuyáº¿n khÃ­ch viá»‡c cháº·n thay Ä‘á»•i giÃ¡ trá»‹ biáº¿n, vÃ  vÃ¬ sao Ä‘Ã´i khi
chÃºng ta váº«n pháº£i bá» cháº·n.</p>
<p>Khi má»™t biáº¿n lÃ  báº¥t biáº¿n (immutable), má»™t khi Ä‘Ã£ gÃ¡n cho nÃ³ má»™t giÃ¡ trá»‹, báº¡n sáº½ khÃ´ng
thá»ƒ thay Ä‘á»•i giÃ¡ trá»‹ Ä‘Ã³ ná»¯a. Äá»ƒ minh há»a Ä‘iá»u nÃ y, hÃ£y táº¡o ra má»™t dá»± Ã¡n má»›i
Ä‘Æ°á»£c gá»i lÃ  <em>variables</em> trong thÆ° má»¥c <em>projects</em> báº±ng cÃ¡ch cháº¡y cÃ¢u lá»‡nh <code>cargo new variables</code>.</p>
<p>Sau Ä‘Ã³, trong thÆ° má»¥c <em>variables</em> má»›i táº¡o, má»Ÿ file <em>src/main.rs</em> vÃ  thay tháº¿ code cá»§a nÃ³ vá»›i
Ä‘oáº¡n sau (Ä‘oáº¡n code nÃ y sáº½ khÃ´ng thá»ƒ dá»‹ch Ä‘Æ°á»£c ngay):</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let x = 5;
    println!("The value of x is: {x}");
    x = 6;
    println!("The value of x is: {x}");
}</code></pre>
<p>LÆ°u láº¡i vÃ  cháº¡y chÆ°Æ¡ng trÃ¬nh dÃ¹ng <code>cargo run</code>. Báº¡n sáº½ pháº£i tháº¥y má»™t thÃ´ng bÃ¡o
liÃªn quan Ä‘áº¿n lá»—i báº¥t biáº¿n, nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ dÆ°á»›i Ä‘Ã¢y:</p>
<pre><code class="language-console">$ cargo run
   Compiling variables v0.1.0 (file:///projects/variables)
error[E0384]: cannot assign twice to immutable variable `x`
 --&gt; src/main.rs:4:5
  |
2 |     let x = 5;
  |         - first assignment to `x`
3 |     println!("The value of x is: {x}");
4 |     x = 6;
  |     ^^^^^ cannot assign twice to immutable variable
  |
help: consider making this binding mutable
  |
2 |     let mut x = 5;
  |         +++

For more information about this error, try `rustc --explain E0384`.
error: could not compile `variables` (bin "variables") due to 1 previous error
</code></pre>
<p>VÃ­ dá»¥ nÃ y cho tháº¥y cÃ¡ch trÃ¬nh biÃªn dá»‹ch giÃºp báº¡n tÃ¬m lá»—i trong chÆ°Æ¡ng trÃ¬nh.
CÃ¡c lá»—i biÃªn dá»‹ch cÃ³ thá»ƒ lÃ m náº£n lÃ²ng, nhÆ°ng chÃºng thá»±c sá»± mang Ã½ nghÄ©a lÃ  chÆ°Æ¡ng
trÃ¬nh cá»§a báº¡n khÃ´ng an toÃ n khi thá»±c hiá»‡n cÃ¡i mÃ  báº¡n yÃªu cáº§u nÃ³ thá»±c hiá»‡n.
ChÃºng <em>khÃ´ng</em> cÃ³ nghÄ©a báº¡n khÃ´ng pháº£i lÃ  má»™t láº­p trÃ¬nh viÃªn tá»‘t! Nhá»¯ng Rustaceans
nhiá»u kinh nghiá»‡m váº«n gáº·p cÃ¡c lá»—i biÃªn dá»‹ch.</p>
<p>Báº¡n nháº­n Ä‘Æ°á»£c thÃ´ng bÃ¡o <code>cannot assign twice to immutable variable `x`</code>,
vÃ¬ báº¡n Ä‘Ã£ thá»­ gÃ¡n giÃ¡ trá»‹ cho biáº¿n immutable <code>x</code> thÃªm má»™t láº§n ná»¯a.</p>
<p>Viá»‡c nháº­n Ä‘Æ°á»£c cÃ¡c lá»—i biÃªn dá»‹ch khi ta cá»‘ gáº¯ng thay Ä‘á»•i giÃ¡ trá»‹ cá»§a má»™t biáº¿n Ä‘Æ°á»£c
chá»‰ Ä‘á»‹nh lÃ  báº¥t biáº¿n lÃ  ráº¥t quan trá»ng, nÃ³ lÃ  má»™t trong nhá»¯ng nguyÃªn nhÃ¢n hÃ ng
Ä‘áº§u dáº«n Ä‘áº¿n bug. Náº¿u má»™t pháº§n trong chÆ°Æ¡ng trÃ¬nh cho lÃ  biáº¿n Ä‘Ã³ sáº½ khÃ´ng thay Ä‘á»•i
nhÆ°ng á»Ÿ má»™t pháº§n khÃ¡c láº¡i gÃ¡n má»™t giÃ¡ trá»‹ má»›i cho nÃ³, ráº¥t cÃ³ thá»ƒ pháº§n Ä‘áº§u tiÃªn sáº½
khÃ´ng cÃ²n hoáº¡t Ä‘á»™ng nhÆ° nÃ³ Ä‘Æ°á»£c thiáº¿t káº¿. NguyÃªn nhÃ¢n gÃ¢y lá»—i nÃ y Ä‘Ã´i khi ráº¥t khÃ³
dÃ² ra, Ä‘áº·c biá»‡t náº¿u pháº§n code thay Ä‘á»•i giÃ¡ trá»‹ cá»§a biáº¿n chá»‰ <em>Ä‘Ã´i khi</em> Ä‘Æ°á»£c thá»±c hiá»‡n.
TrÃ¬nh dá»‹ch Rust báº£o Ä‘áº£m khi báº¡n Ä‘Ã£ phÃ¡t biá»ƒu ráº±ng má»™t biáº¿n sáº½ khÃ´ng thá»ƒ thay Ä‘á»•i, nÃ³
sáº½ thá»±c sá»± khÃ´ng thay Ä‘á»•i, vÃ  báº¡n khÃ´ng cáº§n pháº£i tá»± kiá»ƒm soÃ¡t viá»‡c Ä‘Ã³. NhÆ° váº­y
code cá»§a báº¡n sáº½ dá»… lÃ½ giáº£i hÆ¡n.</p>
<p>NhÆ°ng kháº£ nÄƒng thay Ä‘á»•i giÃ¡ trá»‹ cÅ©ng ráº¥t cáº§n thiáº¿t, vÃ  lÃ m cho viá»‡c viáº¿t code dá»… dÃ ng
hÆ¡n. CÃ¡c biáº¿n máº·c nhiÃªn sáº½ khÃ´ng thay Ä‘á»•i Ä‘Æ°á»£c; nhÆ° báº¡n Ä‘Ã£ tháº¥y trong <a href="ch02-00-guessing-game-tutorial.html#storing-values-with-variables">ChÆ°Æ¡ng
2</a><!-- ignore -->,
báº¡n cÃ³ thá»ƒ lÃ m cho chÃºng thay Ä‘á»•i Ä‘Æ°á»£c giÃ¡ trá»‹ báº±ng cÃ¡ch thÃªm <code>mut</code> vÃ o phÃ­a trÆ°á»›c
tÃªn biáº¿n. Viá»‡c thÃªm <code>mut</code> cÅ©ng truyá»n Ä‘áº¡t Ã½ Ä‘á»‹nh cho nhá»¯ng ngÆ°á»i Ä‘á»c code trong tÆ°Æ¡ng lai
báº±ng cÃ¡ch chá»‰ ra ráº±ng cÃ¡c pháº§n khÃ¡c cá»§a code sáº½ thay Ä‘á»•i giÃ¡ trá»‹ cá»§a biáº¿n nÃ y.</p>
<p>Láº¥y vÃ­ dá»¥, hÃ£y thay Ä‘á»•i <em>src/main.rs</em> thÃ nh nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let mut x = 5;
    println!("The value of x is: {x}");
    x = 6;
    println!("The value of x is: {x}");
}</code></pre></pre>
<p>Giá» cháº¡y chÆ°Æ¡ng trÃ¬nh, báº¡n sáº½ nháº­n Ä‘Æ°á»£c ná»™i dung sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling variables v0.1.0 (file:///projects/variables)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.30s
     Running `target/debug/variables`
The value of x is: 5
The value of x is: 6
</code></pre>
<p>ChÃºng ta Ä‘Æ°á»£c phÃ©p thay Ä‘á»•i giÃ¡ trá»‹ gÃ¡n cho <code>x</code> tá»« <code>5</code> thÃ nh <code>6</code> khi dÃ¹ng <code>mut</code>.
HÆ¡n háº¿t, viá»‡c quyáº¿t Ä‘á»‹nh liá»‡u cÃ³ cho phÃ©p thay Ä‘á»•i hay khÃ´ng lÃ  do báº¡n vÃ  phá»¥ thuá»™c
vÃ o viá»‡c báº¡n nghÄ© cÃ¡ch nÃ o lÃ  rÃµ rÃ ng nháº¥t trong má»™t trÆ°á»ng há»£p cá»¥ thá»ƒ.</p>
<p><a id="constants"></a></p>
<h3 id="háº±ng"><a class="header" href="#háº±ng">Háº±ng</a></h3>
<p>TÆ°Æ¡ng tá»± vá»›i cÃ¡c biáº¿n khÃ´ng Ä‘á»•i, cÃ¡c háº±ng cÅ©ng lÃ  cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c Ä‘áº·t tÃªn vÃ  khÃ´ng Ä‘Æ°á»£c
phÃ©p thay Ä‘á»•i, tuy nhiÃªn cÃ³ má»™t sá»‘ Ä‘iá»ƒm khÃ¡c nhau.</p>
<p>Äáº§u tiÃªn, báº¡n khÃ´ng Ä‘Æ°á»£c phÃ©p dÃ¹ng <code>mut</code> vá»›i háº±ng. CÃ¡c háº±ng khÃ´ng chá»‰ lÃ  máº·c nhiÃªn
báº¥t biáº¿n - mÃ  lÃ  luÃ´n luÃ´n báº¥t biáº¿n. Báº¡n khai bÃ¡o cÃ¡c háº±ng dÃ¹ng tá»« khÃ³a <code>const</code>
thay vÃ¬ tá»« khÃ³a <code>let</code>, vÃ  <em>pháº£i</em> chá»‰ ra kiá»ƒu cá»§a háº±ng. ChÃºng ta sáº½ nÃ³ thÃªm vá»
cover type vÃ  type annotation trong pháº§n tiáº¿p theo, <a href="ch03-02-data-types.html#data-types">â€œCÃ¡c kiá»ƒu dá»¯ liá»‡u,â€</a><!-- ignore -->
do váº­y Ä‘á»«ng lo vá» chi tiáº¿t bÃ¢y giá». Chá»‰ cáº§n nhá»› lÃ  báº¡n luÃ´n pháº£i chá»‰ ra kiá»ƒu.</p>
<p>CÃ¡c háº±ng cÃ³ thá»ƒ Ä‘Æ°á»£c khai bÃ¡o trong báº¥t ká»³ táº§m vá»±c nÃ o, bao gá»“m pháº¡m vi toÃ n cá»¥c (global),
Ä‘iá»u nÃ y há»¯u Ã­ch vá»›i cÃ¡c giÃ¡ trá»‹ mÃ  báº¡n muá»‘n truy cáº­p tá»« nhiá»u Ä‘oáº¡n code khÃ¡c nhau.</p>
<p>Pháº§n khÃ¡c biá»‡t cuá»‘i cÃ¹ng lÃ  cÃ¡c háº±ng chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c gÃ¡n giÃ¡ trá»‹ lÃ  má»™t biá»ƒu thá»©c
háº±ng, khÃ´ng thá»ƒ lÃ  má»™t giÃ¡ trá»‹ mÃ  chá»‰ cÃ³ thá»ƒ tÃ­nh toÃ¡n Ä‘Æ°á»£c khi cháº¡y.</p>
<p>ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ vá» khai bÃ¡o háº±ng:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;
<span class="boring">}</span></code></pre></pre>
<p>TÃªn cá»§a háº±ng lÃ  <code>THREE_HOURS_IN_SECONDS</code> vÃ  giÃ¡ trá»‹ cá»§a nÃ³ lÃ  tÃ­ch cá»§a 60 (sá»‘ giÃ¢y
trong má»™t phÃºt) vá»›i 60 (sá»‘ phÃºt trong má»™t giá») vá»›i (sá»‘ giá» báº¡n muá»‘n tÃ­nh trong
chÆ°Æ¡ng trÃ¬nh nÃ y). Quy Æ°á»›c Ä‘áº·t tÃªn háº±ng trong Rust lÃ  sá»­ dá»¥ng táº¥t cáº£ kÃ½ tá»± in hoa,
cÃ¡c tá»« cÃ¡ch nhau báº±ng kÃ½ tá»± gáº¡ch dÆ°á»›i. TrÃ¬nh dá»‹ch cho phÃ©p sá»­ dá»¥ng má»™t sá»‘ toÃ¡n tá»­
khi dá»‹ch, nhá» Ä‘Ã³ chÃºng ta cÃ³ thá»ƒ viáº¿t cÃ¡c giÃ¡ trá»‹ nÃ y theo cÃ¡ch dá»… hiá»ƒu vÃ o kiá»ƒm
tra hÆ¡n, thay vÃ¬ viáº¿t 10,000. Xem pháº§n <a href="../reference/const_eval.html">Rust Referenceâ€™s section on constant
evaluation</a> Ä‘á»ƒ biáº¿t thÃªm vá» nhá»¯ng toÃ¡n tá»­ nÃ o ta cÃ³ thá»ƒ dÃ¹ng Ä‘Æ°á»£c
khi khai bÃ¡o háº±ng.</p>
<p>Háº±ng cÃ³ giÃ¡ trá»‹ trong toÃ n bá»™ thá»i gian chÆ°Æ¡ng trÃ¬nh cháº¡y, trong pháº¡m vi chÃºng
Ä‘Æ°á»£c khai bÃ¡o. TÃ­nh cháº¥t nÃ y lÃ m cho cÃ¡c háº±ng trá»Ÿ nÃªn há»¯u Ã­ch vá»›i nhá»¯ng giÃ¡ trá»‹ trong
miá»n á»©ng dá»¥ng mÃ  nhiá»u pháº§n khÃ¡c cá»§a chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ cáº§n biáº¿t tá»›i, cháº³ng háº¡n
nhÆ° sá»‘ Ä‘iá»ƒm tá»‘i Ä‘a mÃ  mÃ  má»™t ngÆ°á»i chÆ¡i cá»§a trÃ² chÆ¡i cÃ³ thá»ƒ kiáº¿m Ä‘Æ°á»£c hoáº·c
tá»‘c Ä‘á»™ Ã¡nh sÃ¡ng.</p>
<p>Äáº·t tÃªn cho cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c mÃ£ hÃ³a cá»©ng Ä‘Æ°á»£c sá»­ dá»¥ng trong suá»‘t chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n
dÆ°á»›i dáº¡ng háº±ng ráº¥t há»¯u Ã­ch trong viá»‡c truyá»n Ä‘áº¡t Ã½ nghÄ©a cá»§a giÃ¡ trá»‹ Ä‘Ã³ cho
nhá»¯ng ngÆ°á»i duy trÃ¬ code trong tÆ°Æ¡ng lai. NÃ³ cÅ©ng giÃºp chá»‰ cÃ³ má»™t vá»‹ trÃ­ trong code
cáº§n thay Ä‘á»•i náº¿u giÃ¡ trá»‹ cá»§a háº±ng cáº§n Ä‘Æ°á»£c cáº­p nháº­t trong tÆ°Æ¡ng lai.</p>
<h3 id="shadowing"><a class="header" href="#shadowing">Shadowing</a></h3>
<p>NhÆ° báº¡n Ä‘Ã£ tháº¥y trong pháº§n hÆ°á»›ng dáº«n trÃ² chÆ¡i Ä‘oÃ¡n sá»‘ trong pháº§n <a href="ch02-00-guessing-game-tutorial.html#comparing-the-guess-to-the-secret-number">Chapter
2</a><!-- ignore -->, báº¡n cÃ³ thá»ƒ khai bÃ¡o má»™t
biáº¿n má»›i trÃ¹ng tÃªn vá»›i biáº¿n trÆ°á»›c Ä‘Ã³. Rustaceans nÃ³i ráº±ng biáº¿n Ä‘áº§u tiÃªn bá»‹
<em>shadowed</em> bá»Ÿi biáº¿n thá»© hai, nghÄ©a lÃ  trÃ¬nh biÃªn dá»‹ch sáº½ chá»‰ tháº¥y biáº¿n thá»© hai
khi báº¡n sá»­ dá»¥ng tÃªn cá»§a biáº¿n. TrÃªn thá»±c táº¿, biáº¿n thá»© hai che Ä‘i biáº¿n thá»© nháº¥t,
sá»Ÿ há»¯u tÃªn biáº¿n cho Ä‘áº¿n khi chÃ­nh nÃ³ bá»‹ shadowed hoáº·c pháº¡m vi káº¿t thÃºc.
ChÃºng ta cÃ³ thá»ƒ shadow má»™t biáº¿n báº±ng cÃ¡ch sá»­ dá»¥ng tÃªn cá»§a biáº¿n Ä‘Ã³ vÃ  láº·p láº¡i
sá»­ dá»¥ng tá»« khÃ³a <code>let</code> nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let x = 5;

    let x = x + 1;

    {
        let x = x * 2;
        println!("The value of x in the inner scope is: {x}");
    }

    println!("The value of x is: {x}");
}</code></pre></pre>
<p>Äáº§u tiÃªn chÆ°Æ¡ng trÃ¬nh nÃ y liÃªn káº¿t <code>x</code> vá»›i giÃ¡ trá»‹ lÃ <code> 5</code>. Sau Ä‘Ã³, nÃ³ táº¡o ra má»™t biáº¿n má»›i
<code>x</code> báº±ng cÃ¡ch láº·p láº¡i <code>let x = </code>, láº¥y giÃ¡ trá»‹ ban Ä‘áº§u vÃ  thÃªm <code>1</code> Ä‘á»ƒ giÃ¡ trá»‹
cá»§a <code>x</code> khi Ä‘Ã³ lÃ <code> 6</code>. Sau Ä‘Ã³, trong má»™t pháº¡m vi má»›i Ä‘Æ°á»£c táº¡o báº±ng cáº·p dáº¥u ngoáº·c kÃ©p,
cÃ¢u lá»‡nh thá»© ba <code>let</code> cÅ©ng shadow <code>x</code> vÃ  táº¡o ra má»™t biáº¿n má»›i, nhÃ¢n giÃ¡ trá»‹ trÆ°á»›c Ä‘Ã³
vá»›i <code>2</code> Ä‘á»ƒ cung cáº¥p cho <code>x</code> giÃ¡ trá»‹ lÃ  <code>12</code>.
Khi pháº¡m vi Ä‘Ã³ káº¿t thÃºc, viá»‡c shadow bÃªn trong káº¿t thÃºc vÃ  <code>x</code> trá»Ÿ láº¡i lÃ  <code>6</code>.
Khi chÃºng ta cháº¡y chÆ°Æ¡ng trÃ¬nh nÃ y, nÃ³ sáº½ xuáº¥t ra nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling variables v0.1.0 (file:///projects/variables)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.31s
     Running `target/debug/variables`
The value of x in the inner scope is: 12
The value of x is: 6
</code></pre>
<p>Shadowing khÃ¡c vá»›i viá»‡c Ä‘Ã¡nh dáº¥u má»™t biáº¿n lÃ  <code>mut</code>, vÃ¬ chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c má»™t
lá»—i thá»i gian biÃªn dá»‹ch náº¿u chÃºng ta vÃ´ tÃ¬nh cá»‘ gáº¯ng gÃ¡n láº¡i biáº¿n nÃ y mÃ  khÃ´ng
sá»­ dá»¥ng tá»« khÃ³a <code>let</code>. Báº±ng cÃ¡ch sá»­ dá»¥ng <code>let</code>, chÃºng ta cÃ³ thá»ƒ thá»±c hiá»‡n má»™t
sá»‘ phÃ©p biáº¿n Ä‘á»•i trÃªn má»™t biáº¿n nhÆ°ng biáº¿n Ä‘Ã³ láº¥y láº¡i giÃ¡ trá»‹ ban Ä‘áº§u sau khi hoÃ n thÃ nh cÃ´ng viá»‡c.</p>
<p>Sá»± khÃ¡c biá»‡t khÃ¡c giá»¯a <code>mut</code> vÃ  shadowing lÃ  khi ta táº¡o má»™t biáº¿n má»›i báº±ng cÃ¡ch dÃ¹ng tá»« khÃ³a <code>let</code>,
chÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i kiá»ƒu cá»§a biáº¿n nhÆ°ng sá»­ dá»¥ng láº¡i tÃªn. VÃ­ dá»¥, cho má»™t chÆ°Æ¡ng trÃ¬nh
yÃªu cáº§u ngÆ°á»i dÃ¹ng hiá»ƒn thá»‹ bao nhiÃªu khoáº£ng tráº¯ng há» muá»‘n giá»¯a má»™t sá»‘ vÄƒn báº£n báº±ng cÃ¡ch
nháº­p cÃ¡c kÃ½ tá»± khoáº£ng tráº¯ng, sau Ä‘Ã³ lÆ°u láº¡i dá»¯ liá»‡u Ä‘Ã³ Ä‘Ã³ dÆ°á»›i dáº¡ng sá»‘:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let spaces = "   ";
    let spaces = spaces.len();
<span class="boring">}</span></code></pre></pre>
<p>Biáº¿n <code>spaces</code> Ä‘áº§u tiÃªn lÃ  má»™t kiá»ƒu string vÃ  biáº¿n <code>spaces</code> thá»© hai lÃ  kiá»ƒu sá»‘.
Shadowing do Ä‘Ã³ giÃºp chÃºng ta khÃ´ng pháº£i nghÄ© ra cÃ¡c tÃªn khÃ¡c nhau, cháº³ng háº¡n
nhÆ° <code>spaces_str</code> vÃ  <code>spaces_num</code>; thay vÃ o Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng láº¡i
tÃªn <code>spaces</code> Ä‘Æ¡n giáº£n hÆ¡n. Tuy nhiÃªn, náº¿u chÃºng ta cá»‘ gáº¯ng sá»­ dá»¥ng <code>mut</code> cho Ä‘iá»u nÃ y,
nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y, chÃºng ta sáº½ gáº·p lá»—i biÃªn dá»‹ch:</p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span>    let mut spaces = "   ";
    spaces = spaces.len();
<span class="boring">}</span></code></pre>
<p>Lá»—i nÃ y nÃ³ lÃ  chÃºng ta khÃ´ng Ä‘Æ°á»£c phÃ©p thay Ä‘á»•i kiá»ƒu cá»§a má»™t biáº¿n:</p>
<pre><code class="language-console">$ cargo run
   Compiling variables v0.1.0 (file:///projects/variables)
error[E0308]: mismatched types
 --&gt; src/main.rs:3:14
  |
2 |     let mut spaces = "   ";
  |                      ----- expected due to this value
3 |     spaces = spaces.len();
  |              ^^^^^^^^^^^^ expected `&amp;str`, found `usize`

For more information about this error, try `rustc --explain E0308`.
error: could not compile `variables` (bin "variables") due to 1 previous error
</code></pre>
<p>ChÃºng ta Ä‘Ã£ xem xong cÃ¡ch cÃ¡c biáº¿n lÃ m viá»‡c, giá» hÃ£y cÃ¹ng xem cÃ¡c kiá»ƒu dá»¯ liá»‡u chÃºng cÃ³ thá»ƒ cÃ³.</p>
<div style="break-before: page; page-break-before: always;"></div><p><a id="data-types"></a></p>
<h2 id="cÃ¡c-kiá»ƒu-dá»¯-liá»‡u"><a class="header" href="#cÃ¡c-kiá»ƒu-dá»¯-liá»‡u">CÃ¡c kiá»ƒu dá»¯ liá»‡u</a></h2>
<p>Má»i giÃ¡ trá»‹ trong Rust Ä‘á»u thuá»™c má»™t <em>kiá»ƒu dá»¯ liá»‡u</em> cá»¥ thá»ƒ, Ä‘iá»u nÃ y cho Rust biáº¿t loáº¡i
dá»¯ liá»‡u Ä‘ang Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh Ä‘á»ƒ nÃ³ biáº¿t cÃ¡ch lÃ m viá»‡c vá»›i dá»¯ liá»‡u Ä‘Ã³. ChÃºng ta sáº½ xem xÃ©t
hai táº­p con kiá»ƒu dá»¯ liá»‡u: scalar (vÃ´ hÆ°á»›ng) vÃ  compound (phá»©c).</p>
<p>HÃ£y nhá»› ráº±ng Rust lÃ  má»™t ngÃ´n ngá»¯ <em>xÃ¡c Ä‘á»‹nh kiá»ƒu</em>, cÃ³ nghÄ©a lÃ  nÃ³
pháº£i biáº¿t kiá»ƒu dá»¯ liá»‡u cá»§a táº¥t cáº£ cÃ¡c biáº¿n táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch. TrÃ¬nh biÃªn dá»‹ch cÅ©ng cÃ³ thá»ƒ
suy ra kiá»ƒu dá»¯ liá»‡u ta muá»‘n sá»­ dá»¥ng dá»±a trÃªn giÃ¡ trá»‹ vÃ  cÃ¡ch chÃºng ta sá»­ dá»¥ng nÃ³. Trong cÃ¡c trÆ°á»ng há»£p
khi cÃ³ thá»ƒ cÃ³ nhiá»u kiá»ƒu, cháº³ng háº¡n nhÆ° khi chÃºng ta chuyá»ƒn Ä‘á»•i <code>String</code> thÃ nh má»™t sá»‘ báº±ng
cÃ¡ch sá»­ dá»¥ng <code>parse</code> trong <a href="ch02-00-guessing-game-tutorial.html#comparing-the-guess-to-the-secret-number">â€œComparing the Guess to the Secret
Numberâ€</a><!-- ignore --> nhÆ° trong
ChÆ°Æ¡ng 2, chÃºng ta pháº£i thÃªm má»™t chÃº thÃ­ch kiá»ƒu giá»‘ng nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let guess: u32 = "42".parse().expect("Not a number!");
<span class="boring">}</span></code></pre></pre>
<p>Náº¿u chÃºng ta khÃ´ng thÃªm chÃº thÃ­ch vá» kiá»ƒu <code>: u32</code> nhÆ° á»Ÿ trÃªn, Rust sáº½ hiá»ƒn thá»‹
lá»—i sau, cÃ³ nghÄ©a lÃ  trÃ¬nh biÃªn dá»‹ch cáº§n thÃªm thÃ´ng tin tá»« chÃºng ta Ä‘á»ƒ
biáº¿t chÃ­nh xÃ¡c kiá»ƒu dá»¯ liá»‡u nÃ o chÃºng ta muá»‘n sá»­ dá»¥ng:</p>
<pre><code class="language-console">$ cargo build
   Compiling no_type_annotations v0.1.0 (file:///projects/no_type_annotations)
error[E0284]: type annotations needed
 --&gt; src/main.rs:2:9
  |
2 |     let guess = "42".parse().expect("Not a number!");
  |         ^^^^^        ----- type must be known at this point
  |
  = note: cannot satisfy `&lt;_ as FromStr&gt;::Err == _`
help: consider giving `guess` an explicit type
  |
2 |     let guess: /* Type */ = "42".parse().expect("Not a number!");
  |              ++++++++++++

For more information about this error, try `rustc --explain E0284`.
error: could not compile `no_type_annotations` (bin "no_type_annotations") due to 1 previous error
</code></pre>
<p>Báº¡n sáº½ tháº¥y cÃ¡c chÃº thÃ­ch kiá»ƒu khÃ¡c nhau cho nhá»¯ng kiá»ƒu dá»¯ liá»‡u khÃ¡c.</p>
<h3 id="cÃ¡c-kiá»ƒu-vÃ´-hÆ°á»›ng-scalar-type"><a class="header" href="#cÃ¡c-kiá»ƒu-vÃ´-hÆ°á»›ng-scalar-type">CÃ¡c kiá»ƒu vÃ´ hÆ°á»›ng (Scalar type)</a></h3>
<p>Má»™t <em>kiá»ƒu vÃ´ hÆ°á»›ng</em> biá»ƒu diá»…n má»™t giÃ¡ trá»‹ Ä‘Æ¡n. Rust cÃ³ bá»‘n kiá»ƒu vÃ´ hÆ°á»›ng chÃ­nh: sá»‘ nguyÃªn (integer),
cÃ¡c kiá»ƒu sá»‘ dáº¥u cháº¥m Ä‘á»™ng, boolean vÃ  kiá»ƒu kÃ½ tá»±. Báº¡n cÃ³ thá»ƒ tháº¥y chÃºng cÅ©ng tÆ°Æ¡ng tá»±
trong cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c. HÃ£y cÃ¹ng xem thá»­ trong Rust chÃºng hoáº¡t Ä‘á»™ng tháº¿ nÃ o.</p>
<p><a id="integer-types"></a></p>
<h4 id="cÃ¡c-kiá»ƒu-sá»‘-nguyÃªn-integer"><a class="header" href="#cÃ¡c-kiá»ƒu-sá»‘-nguyÃªn-integer">CÃ¡c kiá»ƒu sá»‘ nguyÃªn (integer)</a></h4>
<p>Má»™t <em>integer</em> lÃ  má»™t sá»‘ khÃ´ng cÃ³ pháº§n tháº­p phÃ¢n. ChÃºng ta Ä‘Ã£ tá»«ng dÃ¹ng má»™t kiá»ƒu integer
trong chÆ°Æ¡ng 2, kiá»ƒu <code>u32</code>. Viá»‡c khai bÃ¡o kiá»ƒu nÃ y chá»‰ ra giÃ¡ trá»‹ mÃ  nÃ³ káº¿t há»£p pháº£i
lÃ  má»™t sá»‘ nguyÃªn khÃ´ng dáº¥u (cÃ¡c kiá»ƒu cÃ³ dáº¥u sáº½ báº¯t Ä‘áº§u báº±ng chá»¯ <code>i</code> thay vÃ¬ <code>u</code>), vÃ  nÃ³
chiáº¿m 32 bit khÃ´ng gian nhá»›. Báº£ng 3-1 trÃ¬nh bÃ y cÃ¡c kiá»ƒu integer Ä‘Æ°á»£c há»— trá»£ sáºµn bá»Ÿi Rust.
ChÃºng ta cÃ³ thá»ƒ dÃ¹ng báº¥t ká»³ biáº¿n thá»ƒ nÃ o trong danh sÃ¡ch Ä‘á»ƒ khai bÃ¡o má»™t kiá»ƒu nguyÃªn.</p>
<p><span class="caption">Table 3-1: CÃ¡c kiá»ƒu sá»‘ nguyÃªn trong Rust</span></p>
<div class="table-wrapper"><table><thead><tr><th>Length</th><th>Signed</th><th>Unsigned</th></tr></thead><tbody>
<tr><td>8-bit</td><td><code>i8</code></td><td><code>u8</code></td></tr>
<tr><td>16-bit</td><td><code>i16</code></td><td><code>u16</code></td></tr>
<tr><td>32-bit</td><td><code>i32</code></td><td><code>u32</code></td></tr>
<tr><td>64-bit</td><td><code>i64</code></td><td><code>u64</code></td></tr>
<tr><td>128-bit</td><td><code>i128</code></td><td><code>u128</code></td></tr>
<tr><td>arch</td><td><code>isize</code></td><td><code>usize</code></td></tr>
</tbody></table>
</div>
<p>Má»—i biáº¿n thá»ƒ cÃ³ thá»ƒ cÃ³ hoáº·c khÃ´ng cÃ³ dáº¥u, Ä‘á»“ng thá»i sáº½ cÃ³ má»™t kÃ­ch thÆ°á»›c cá»¥ thá»ƒ.
<em>Signed</em> vÃ  <em>unsigned</em> chá»‰ ra liá»‡u má»™t kiá»ƒu cÃ³ thá»ƒ chá»©a sá»‘ Ã¢m hay khÃ´ng, hay nÃ³i cÃ¡ch khÃ¡c
ta cÃ³ cáº§n viáº¿t dáº¥u cho nÃ³ hay khÃ´ng (khi nÃ³ chá»©a má»™t giÃ¡ trá»‹ Ã¢m). NÃ³ cÅ©ng hoÃ n toÃ n tÆ°Æ¡ng
tá»± khi báº¡n viáº¿t ra giáº¥y: Náº¿u dáº¥u lÃ  quan trá»ng, báº¡n cáº§n viáº¿t rÃµ con sá»‘ vá»›i dáº¥u cá»™ng hoáº·c trá»«;
tuy nhiÃªn khi nÃ³ an toÃ n Ä‘á»ƒ xÃ¡c Ä‘á»‹nh Ä‘Ã¢y lÃ  má»™t sá»‘ dÆ°Æ¡ng, báº¡n cÃ³ thá»ƒ bá» qua vÃ  khÃ´ng cáº§n viáº¿t
dáº¥u.
CÃ¡c sá»‘ Ã¢m Ä‘Æ°á»£c lÆ°u trá»¯ dÆ°á»›i dáº¡ng biá»ƒu diá»…n <a href="https://en.wikipedia.org/wiki/Two%27s_complement">twoâ€™s complement</a><!-- ignore -->.</p>
<p>Má»—i má»™t biáº¿n thá»ƒ cÃ³ dáº¥u cÃ³ thá»ƒ lÆ°u cÃ¡c con sá»‘ tá»« -(2<sup>n - 1</sup>) Ä‘áº¿n 2<sup>n -
1</sup> - 1, vá»›i <em>n</em> lÃ  sá»‘ bit mÃ  biáº¿n thá»ƒ Ä‘Ã³ dÃ¹ng. NhÆ° váº­y má»™t biáº¿n <code>i8</code> cÃ³ thá»ƒ
lÆ°u cÃ¡c giÃ¡ trá»‹ tá»« -(2<sup>7</sup>) Ä‘áº¿n 2<sup>7</sup> - 1, tÆ°Æ¡ng á»©ng vá»›i -128 Ä‘áº¿n 127.
CÃ¡c biáº¿n thá»ƒ khÃ´ng dáº¥u cÃ³ thá»ƒ lÆ°u cÃ¡c giÃ¡ trá»‹ tá»« 0 Ä‘áº¿n 2<sup>n</sup> - 1, do váº­y
má»™t biáº¿n <code>u8</code> cÃ³ thá»ƒ lÆ°u Ä‘Æ°á»£c tá»« 0 Ä‘áº¿n 2<sup>8</sup> - 1, tÆ°Æ¡ng á»©ng vá»›i 0 Ä‘áº¿n 255.</p>
<p>ThÃªm vÃ o Ä‘Ã³, cÃ¡c kiá»ƒu <code>isize</code> vÃ  <code>usize</code> sáº½ phá»¥ thuá»™c vÃ o kiáº¿n trÃºc há»‡ thá»‘ng mÃ 
chÆ°Æ¡ng trÃ¬nh cháº¡y trÃªn Ä‘Ã³ (Ä‘Æ°á»£c ghi trong báº£ng vá»›i tÃªn â€œarchâ€):  64 bit náº¿u Ä‘ang
cháº¡y trÃªn kiáº¿n trÃºc 64 bit vÃ  32 bit náº¿u cháº¡y trÃªn kiáº¿n trÃºc 32 bit.</p>
<p>Báº¡n cÃ³ thá»ƒ viáº¿t cÃ¡c giÃ¡ trá»‹ kiá»ƒu sá»‘ nguyÃªn theo báº¥t ká»³ dáº¡ng nÃ o trong báº£ng 3-2. LÆ°u Ã½
lÃ  náº¿u má»™t giÃ¡ trá»‹ sá»‘ nguyÃªn cÃ³ thá»ƒ thuá»™c nhiá»u kiá»ƒu dá»¯ liá»‡u khÃ¡c nhau thÃ¬ báº¡n cÅ©ng cÃ³
thá»ƒ chá»‰ rÃµ ra má»™t kiá»ƒu cá»¥ thá»ƒ nÃ o Ä‘Ã³, vÃ­ dá»¥ <code>57u8</code>. CÃ¡c giÃ¡ trá»‹ sá»‘ cÅ©ng cÃ³ thá»ƒ dÃ¹ng
dáº¥u gáº¡ch dÆ°á»›i nhÆ° má»™t kÃ½ hiá»‡u phÃ¢n cÃ¡ch dá»… dá»… nhÃ¬n hÆ¡n, nhÆ° lÃ  <code>1_000</code>, sáº½ cÃ³ cÃ¹ng
giÃ¡ trá»‹ vá»›i <code>1000</code>.</p>
<p><span class="caption">Table 3-2: CÃ¡c giÃ¡ trá»‹ sá»‘ nguyÃªn trong Rust</span></p>
<div class="table-wrapper"><table><thead><tr><th>CÃ¡c giÃ¡ trá»‹</th><th>VÃ­ dá»¥</th></tr></thead><tbody>
<tr><td>Decimal</td><td><code>98_222</code></td></tr>
<tr><td>Hex</td><td><code>0xff</code></td></tr>
<tr><td>Octal</td><td><code>0o77</code></td></tr>
<tr><td>Binary</td><td><code>0b1111_0000</code></td></tr>
<tr><td>Byte (<code>u8</code> only)</td><td><code>b'A'</code></td></tr>
</tbody></table>
</div>
<p>Váº­y lÃ m sao báº¡n biáº¿t Ä‘Æ°á»£c kiá»ƒu sá»‘ nguyÃªn nÃ o Ä‘á»ƒ dÃ¹ng? Náº¿u khÃ´ng cháº¯c thÃ¬ hÃ£y nhá»›,
máº·c nhiÃªn trong Rust cÃ¡c kiá»ƒu sá»‘ nguyÃªn sáº½ lÃ  <code>i32</code>. Má»™t trÆ°á»ng há»£p mÃ  báº¡n cÃ³ láº½
sáº½ dÃ¹ng tá»›i <code>isize</code> hay <code>usize</code> lÃ  khi sá»­ dá»¥ng chá»‰ sá»‘ trong cÃ¡c táº­p há»£p.</p>
<section class="note" aria-role="note">
<h5 id="trÃ n-sá»‘"><a class="header" href="#trÃ n-sá»‘">TrÃ n sá»‘</a></h5>
<p>Láº¥y vÃ­ dá»¥ báº¡n cÃ³ má»™t biáº¿n kiá»ƒu <code>u8</code> cÃ³ thá»ƒ chá»©a Ä‘Æ°á»£c giÃ¡ trá»‹ tá»« 0 Ä‘áº¿n 255. Náº¿u
báº¡n cá»‘ thay Ä‘á»•i giÃ¡ trá»‹ cá»§a biáº¿n thÃ nh má»™t giÃ¡ trá»‹ ngoÃ i pháº¡m vi Ä‘Ã³, cháº³ng háº¡n
256, <em>integer overflow</em> (lá»—i trÃ n sá»‘) sáº½ xáº£y ra, vÃ  nÃ³ sáº½ dáº«n Ä‘áº¿n má»™t trong hai
tráº¡ng thÃ¡i. Náº¿u báº¡n dá»‹ch code á»Ÿ cháº¿ Ä‘á»™ debug, Rust sáº½ thÃªm vÃ o cÃ¡c phÃ©p kiá»ƒm tra
trÃ n sá»‘ vÃ  khiáº¿n chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n bá»‹ dá»«ng láº¡i vÃ  tráº£ vá» má»™t lá»—i nghiÃªm trá»ng,
Rust gá»i viá»‡c dá»«ng láº¡i nÃ y lÃ  panicking; chÃºng ta sáº½ tháº£o luáº­n thÃªm vá» trong pháº§n
<a href="ch09-01-unrecoverable-errors-with-panic.html">â€œUnrecoverable Errors with <code>panic!</code>â€</a><!-- ignore -->
á»Ÿ chÆ°Æ¡ng 9.</p>
<p>Khi dá»‹ch chÆ°Æ¡ng trÃ¬nh á»Ÿ cháº¿ Ä‘á»™ release vá»›i tÃ¹y chá»n <code>--release</code>, Rust <em>khÃ´ng</em>
thÃªm vÃ o cÃ¡c phÃ©p kiá»ƒm tra trÃ n sá»‘ gÃ¢y dá»«ng chÆ°Æ¡ng trÃ¬nh. Thay vÃ o Ä‘Ã³, náº¿u xáº£y ra
trÃ n sá»‘, Rust sáº½ thá»±c hiá»‡n <em>twoâ€™s complement wrapping</em>. NÃ³i má»™t cÃ¡ch ngáº¯n gá»n, cÃ¡c
giÃ¡ trá»‹ lá»›n hÆ¡n giÃ¡ trá»‹ lá»›n nháº¥t mÃ  kiá»ƒu dá»¯ liá»‡u cÃ³ thá»ƒ chá»©a Ä‘Æ°á»£c sáº½ bá»‹ â€œxoay vÃ²ngâ€
láº¡i tá»« giÃ¡ trá»‹ nhá» nháº¥t. Trong trÆ°á»ng há»£p cá»§a <code>u8</code>, giÃ¡ trá»‹ 256 sáº½ quay vÃ²ng láº¡i 0,
257 trá»Ÿ thÃ nh 1, vÃ  tiáº¿p tá»¥c nhÆ° váº­y. ChÆ°Æ¡ng trÃ¬nh sáº½ khÃ´ng dá»«ng do lá»—i, nhÆ°ng biáº¿n
cÃ³ thá»ƒ chá»©a má»™t giÃ¡ trá»‹ mÃ  báº¡n cÃ³ thá»ƒ khÃ´ng mong muá»‘n. Khi xáº£y ra â€œxoay vÃ²ngâ€ láº¡i
giÃ¡ trá»‹, ta cÃ³ thá»ƒ coi nhÆ° má»™t lá»—i.</p>
<p>Äá»ƒ cÃ³ thá»ƒ xá»­ lÃ½ viá»‡c trÃ n sá»‘ má»™t cÃ¡ch cá»¥ thá»ƒ, báº¡n cÃ³ thá»ƒ dÃ¹ng cÃ¡c nhÃ³m phÆ°Æ¡ng
thá»©c há»— trá»£ cÃ¡c kiá»ƒu dá»¯ liá»‡u sá»‘ nguyÃªn thá»§y Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n chuáº©n:</p>
<ul>
<li>Sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c bao bá»c <code>wrapping_*</code>, kiá»ƒu nhÆ° <code>wrapping_add</code>.</li>
<li>Tráº£ vá» giÃ¡ trá»‹ <code>None</code> náº¿u xáº£y ra trÃ n sá»‘ vá»›i cÃ¡c phÆ°Æ¡ng thá»©c <code>checked_*</code>.</li>
<li>Tráº£ vá» giÃ¡ trá»‹ vÃ  má»™t giÃ¡ trá»‹ bool Ä‘á»ƒ chá»‰ ra liá»‡u Ä‘Ã£ xáº£ ra trÃ n sá»‘ hay khÃ´ng
vá»›i cÃ¡c phÆ°Æ¡ng thá»©c <code>overflowing_*</code>.</li>
<li>Tráº£ vá» giÃ¡ trá»‹ lá»›n nháº¥t hoáº·c nhá» nháº¥t cá»§a kiá»ƒu dá»¯ liá»‡u vá»›i cÃ¡c phÆ°Æ¡ng thá»©c <code>saturating_*</code>.</li>
</ul>
</section>
<h4 id="cÃ¡c-kiá»ƒu-sá»‘-dáº¥u-cháº¥m-Ä‘á»™ng"><a class="header" href="#cÃ¡c-kiá»ƒu-sá»‘-dáº¥u-cháº¥m-Ä‘á»™ng">CÃ¡c kiá»ƒu sá»‘ dáº¥u cháº¥m Ä‘á»™ng</a></h4>
<p>Rust cÅ©ng cÃ³ hai kiá»ƒu nguyÃªn thá»§y cho cÃ¡c <em>sá»‘ dáº¥u cháº¥m Ä‘á»™ng</em> (floating-point numbers),
lÃ  cÃ¡c kiá»ƒu sá»‘ cÃ³ pháº§n tháº­p phÃ¢n. CÃ¡c kiá»ƒu sá»‘ dáº¥u cháº¥m Ä‘á»™ng cá»§a Rust gá»“m cÃ³ <code>f32</code> vÃ  <code>f64</code>,
tÆ°Æ¡ng á»©ng vá»›i cÃ¡c kÃ­ch cá»¡ 32 bit vÃ  64 bit. Kiá»ƒu máº·c nhiÃªn lÃ  <code>f64</code>, vÃ¬ trÃªn cÃ¡c bá»™ xá»­ lÃ½
hiá»‡n Ä‘áº¡i tá»‘c Ä‘á»™ xá»­ lÃ½ cá»§a nÃ³ tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i <code>f32</code> nhÆ°ng cÃ³ Ä‘á»™ chÃ­nh xÃ¡c cao hÆ¡n. Táº¥t cáº£
cÃ¡c kiá»ƒu dáº¥u cháº¥m Ä‘á»™ng Ä‘á»u lÃ  cÃ³ dáº¥u.</p>
<p>ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ vá» viá»‡c dÃ¹ng cÃ¡c dáº¥u cháº¥m Ä‘á»™ng:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let x = 2.0; // f64

    let y: f32 = 3.0; // f32
}</code></pre></pre>
<p>CÃ¡c kiá»ƒu dáº¥u cháº¥m Ä‘á»™ng Ä‘Æ°á»£c biá»ƒu diá»…n dá»±a trÃªn tiÃªu chuáº©n IEEE-754. Kiá»ƒu <code>f32</code> lÃ 
kiá»ƒu dáº¥u cháº¥m Ä‘á»™ng chÃ­nh xÃ¡c Ä‘Æ¡n, vÃ  <code>f64</code> cÃ³ Ä‘á»™ chÃ­nh xÃ¡c kÃ©p.</p>
<h4 id="cÃ¡c-toÃ¡n-tá»­-sá»‘"><a class="header" href="#cÃ¡c-toÃ¡n-tá»­-sá»‘">CÃ¡c toÃ¡n tá»­ sá»‘</a></h4>
<p>Rust há»— trá»£ cÃ¡c phÃ©p toÃ¡n toÃ¡n há»c cÆ¡ báº£n: cá»™ng, trá»«, nhÃ¢n, chia vÃ  láº¥y pháº§n dÆ°.
CÃ¡c kiá»ƒu sá»‘ nguyÃªn khi chia sáº½ tráº£ vá» má»™t sá»‘ nguyÃªn gáº§n nháº¥t vá»›i thÆ°Æ¡ng. Äoáº¡n code
sau Ä‘Ã¢y biá»ƒu diá»…n cÃ¡ch báº¡n sáº½ dÃ¹ng cÃ¡c toÃ¡n tá»­ trong má»™t phÃ¡t biá»ƒu <code>let</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    // addition
    let sum = 5 + 10;

    // subtraction
    let difference = 95.5 - 4.3;

    // multiplication
    let product = 4 * 30;

    // division
    let quotient = 56.7 / 32.2;
    let truncated = -5 / 3; // Results in -1

    // remainder
    let remainder = 43 % 5;
}</code></pre></pre>
<p>Má»—i biá»ƒu thá»©c trong cÃ¡c phÃ¡t biá»ƒu Ä‘Ã³ dÃ¹ng má»™t toÃ¡n tá»­ toÃ¡n há»c vÃ  tráº£ vá» má»™t giÃ¡ trá»‹
Ä‘Æ¡n, giÃ¡ trá»‹ nÃ y sau Ä‘Ã³ láº¡i Ä‘Æ°á»£c gÃ¡n cho má»™t biáº¿n. <a href="appendix-02-operators.html">Appendix B</a><!-- ignore --> chá»©a
má»™t danh sÃ¡ch táº¥t cáº£ cÃ¡c toÃ¡n tá»­ cÃ³ trong Rust.</p>
<h4 id="kiá»ƒu-boolean"><a class="header" href="#kiá»ƒu-boolean">Kiá»ƒu Boolean</a></h4>
<p>TÆ°Æ¡ng tá»± trong cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c, má»™t kiá»ƒu Boolean cÃ³ thá»ƒ chá»©a má»™t trong
hai giÃ¡ trá»‹ <code>true</code> vÃ  <code>false</code>. Boolean cÃ³ kÃ­ch cá»¡ má»™t byte. Má»™t biáº¿u kiá»ƒu Boolean trong Rust
Ä‘Æ°á»£c khai bÃ¡o sá»­ dá»¥ng <code>bool</code>. VÃ­ dá»¥:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let t = true;

    let f: bool = false; // with explicit type annotation
}</code></pre></pre>
<p>CÃ¡ch chÃ­nh Ä‘á»ƒ dÃ¹ng Boolean lÃ  thÃ´ng qua cÃ¡c Ä‘iá»u kiá»‡n, kiá»ƒu nhÆ° phÃ¡t biá»ƒu <code>if</code>.
ChÃºng ta sáº½ xem thÃªm vá» cÃ¡ch <code>if</code> lÃ m viá»‡c trong Rust trong pháº§n <a href="ch03-05-control-flow.html#control-flow">â€œCÃ¡c khá»‘i Ä‘iá»u khiá»ƒnâ€</a><!-- ignore -->.</p>
<h4 id="kiá»ƒu-kÃ½-tá»±"><a class="header" href="#kiá»ƒu-kÃ½-tá»±">Kiá»ƒu kÃ½ tá»±</a></h4>
<p>Kiá»ƒu <code>char</code> trong Rust lÃ  kiá»ƒu kÃ½ tá»± nguyÃªn thá»§y nháº¥t. Sau Ä‘Ã¢y lÃ  má»™t sá»‘ vÃ­ dá»¥ vá»
cÃ¡ch khai bÃ¡o cÃ¡c giÃ¡ trá»‹ kiá»ƒu <code>char</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let c = 'z';
    let z: char = 'â„¤'; // with explicit type annotation
    let heart_eyed_cat = 'ğŸ˜»';
}</code></pre></pre>
<p>LÆ°u Ã½ lÃ  chÃºng ta chá»‰ ra má»™t dá»¯ liá»‡u nÃ o Ä‘Ã³ lÃ  kiá»ƒu <code>char</code> báº±ng cÃ¡ch dÃ¹ng dáº¥u nhÃ¡y Ä‘Æ¡n, trong khi Ä‘Ã³
vá»›i string thÃ¬ ta dÃ¹ng dáº¥u nhÃ¡y kÃ©p. Kiá»ƒu <code>char</code> trong Rust cÃ³ kÃ­ch cá»¡ 4 byte vÃ  biá»ƒu diá»…n má»™t kÃ½ tá»±
Unicode, do nÃ³ nÃ³ cÃ³ thá»ƒ biá»ƒu diá»…n nhiá»u hÆ¡n nhiá»u so vá»›i ASCII. CÃ¡c kÃ½ tá»± cá»•, cÃ¡c kÃ½ tá»± tiáº¿ng Trung,
tiáº¿ng Nháº­t, tiáº¿ng HÃ n; cÃ¡c biá»ƒu tÆ°á»£ng cáº£m xÃºc (emoji); vÃ  cáº£ cÃ¡c khoáº£ng trá»‘ng cÃ³ chiá»u rá»™ng báº±ng 0
Ä‘á»u lÃ  cÃ¡c kÃ½ tá»± kiá»ƒu <code>char</code> há»£p lá»‡. CÃ¡c kÃ½ tá»± Unicode cÅ©ng bao gá»“m cáº£ tá»« <code>U+0000</code> Ä‘áº¿n <code>U+D7FF</code>
vÃ  tá»« <code>U+E000</code> Ä‘áº¿n <code>U+10FFFF</code>. Tuy nhiÃªn, â€œkÃ½ tá»±â€ lÃ  má»™t khÃ¡i niá»‡m khÃ´ng thá»±c sá»± Ä‘Æ°á»£c dÃ¹ng trong
Unicode, do váº­y cÃ¡ch mÃ  báº¡n nghÄ© vá» â€œkÃ½ tá»±â€ cÃ³ thá»ƒ khÃ´ng hoÃ n toÃ n giá»‘ng vá»›i <code>char</code> trong Rust.
ChÃºng ta sáº½ tháº£o luáº­n thÃªm vá» chá»§ Ä‘á» nÃ y trong pháº§n <a href="ch08-02-strings.html#storing-utf-8-encoded-text-with-strings">â€œStoring UTF-8 Encoded Text with
Stringsâ€</a><!-- ignore --> in ChÆ°Æ¡ng 8.</p>
<h3 id="cÃ¡c-kiá»ƒu-phá»©c"><a class="header" href="#cÃ¡c-kiá»ƒu-phá»©c">CÃ¡c kiá»ƒu phá»©c</a></h3>
<p><em>Kiá»ƒu phá»©c</em> cÃ³ thá»ƒ nhÃ³m nhiá»u giÃ¡ trá»‹ vÃ o chung má»™t kiá»ƒu. Rust cÃ³ hai kiá»ƒu phá»©c chÃ­nh: tuple vÃ  array.</p>
<p><a id="the-tuple-type"></a></p>
<h4 id="kiá»ƒu-tuple"><a class="header" href="#kiá»ƒu-tuple">Kiá»ƒu tuple</a></h4>
<p>Má»™t kiá»ƒu tuple lÃ  má»™t cÃ¡ch chung Ä‘á»ƒ nhÃ³m cÃ¡c giÃ¡ trá»‹ khÃ¡c nhau vÃ o lÃ m má»™t. CÃ¡c tupble cÃ³ kÃ­ch thÆ°á»›c cá»‘
Ä‘á»‹nh: má»™t khi Ä‘Ã£ khai bÃ¡o, chÃºng sáº½ khÃ´ng thá»ƒ tÄƒng hay giáº£m kÃ­ch cá»¡. ChÃºng ta táº¡o má»™t tuble báº±ng cÃ¡ch viáº¿t
má»™t danh sÃ¡ch cÃ¡c giÃ¡ trá»‹ cÃ¡ch nhau bá»Ÿi dáº¥u pháº©y, bao bá»c láº¡i bá»Ÿi má»™t cáº·p ngoáº·c trÃ²n. Má»—i vá»‹ trÃ­ trong tuble
cÃ³ má»™t kiá»ƒu, vÃ  cÃ¡c giÃ¡ trá»‹ khÃ¡c nhau trong má»™t tuble khÃ´ng nháº¥t thiáº¿t pháº£i cÃ¹ng kiá»ƒu. ChÃºng ta cÅ©ng Ä‘Ã£
thÃªm má»™t sá»‘ phá»¥ chÃº kiá»ƒu trong vÃ­ dá»¥ sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let tup: (i32, f64, u8) = (500, 6.4, 1);
}</code></pre></pre>
<p>Biáº¿n <code>tup</code> Ä‘áº¡i diá»‡n cho toÃ n bá»™ tuple, vÃ¬ má»—i má»™t tuple Ä‘Æ°á»£c coi nhÆ° má»™t biáº¿n Ä‘Æ¡n. Äá»ƒ láº¥y giÃ¡ trá»‹ cá»§a tá»«ng
thÃ nh pháº§n riÃªng láº» bÃªn trong má»™t tuple, chÃºng ta cÃ³ thá»ƒ dÃ¹ng cÃ¡ch khá»›p máº«u Ä‘á»ƒ phÃ¢n tÃ¡ch má»™t giÃ¡ trá»‹ kiá»ƒu
tuple, giá»‘ng trong vÃ­ dá»¥ sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let tup = (500, 6.4, 1);

    let (x, y, z) = tup;

    println!("The value of y is: {y}");
}</code></pre></pre>
<p>ChÆ°Æ¡ng trÃ¬nh nÃ y Ä‘áº§u tiÃªn sáº½ táº¡o ra má»™t tuple vÃ  gáº¯n káº¿t nÃ³ vá»›i biáº¿n <code>tup</code>.
Sau Ä‘Ã³ nÃ³ dÃ¹ng má»™t máº«u vá»›i <code>let</code> Ä‘á»ƒ láº¥y ra ba giÃ¡ trá»‹ riÃªng láº» tá»« cÃ¡c thÃ nh pháº§n
cá»§a <code>tup</code>, <code>x</code>, <code>y</code> vÃ  <code>z</code>. Ta gá»i quÃ¡ trÃ¬nh nÃ y lÃ  phÃ¡ há»§y (<em>destructuring</em>), vÃ¬ nÃ³ sáº½ tÃ¡ch má»™t
tuple Ä‘Æ¡n ra thÃ nh ba pháº§n riÃªng biá»‡t. Cuá»‘i cÃ¹ng, chÆ°Æ¡ng trÃ¬nh in ra giÃ¡ trá»‹ cá»§a <code>y</code> la <code>6.4</code>.</p>
<p>Ta cÅ©ng cÃ³ thá»ƒ truy cáº­p trá»±c tiáº¿p vÃ o má»™t thÃ nh pháº§n bÃªn trong tuple báº±ng cÃ¡ch dÃ¹ng
dáº¥u cháº¥m (<code>.</code>), theo sau bá»Ÿi chá»‰ má»¥c cá»§a giÃ¡ trá»‹ mÃ  báº¡n muá»‘n Ä‘á»c hay ghi. VÃ­ dá»¥:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let x: (i32, f64, u8) = (500, 6.4, 1);

    let five_hundred = x.0;

    let six_point_four = x.1;

    let one = x.2;
}</code></pre></pre>
<p>ChÆ°Æ¡ng trÃ¬nh nÃ y táº¡o má»™t tuple <code>x</code> vÃ  sau Ä‘Ã³ truy cáº­p vÃ o tá»«ng thÃ nh pháº§n cá»§a tuple
thÃ´ng qua cÃ¡c giÃ¡ trá»‹ chá»‰ má»¥c tÆ°Æ¡ng á»©ng. TÆ°Æ¡ng tá»± vá»›i háº§u háº¿t ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c,
chá»‰ má»¥c Ä‘áº§u tiÃªn sáº½ mang giÃ¡ trá»‹ 0.</p>
<p>Má»™t tuple mÃ  khÃ´ng cÃ³ giÃ¡ trá»‹ nÃ o cÃ³ má»™t cÃ¡i tÃªn Ä‘áº·c biá»‡t, <em>unit</em>. GiÃ¡ trá»‹ nÃ y vÃ  kiá»ƒu
tÆ°Æ¡ng á»©ng cá»§a nÃ³ Ä‘Æ°á»£c viáº¿t lÃ  <code>()</code> vÃ  Ä‘áº¡i diá»‡n cho má»™t giÃ¡ trá»‹ rá»—ng hay má»™t kiá»ƒu tráº£
vá» rá»—ng. CÃ¡c biá»ƒu thá»©c Ä‘Æ°á»£c ngáº§m hiá»ƒu lÃ  tráº£ vá» <em>unit</em> náº¿u chÃºng khÃ´ng tráº£ vá» má»™t giÃ¡
trá»‹ nÃ o khÃ¡c.</p>
<h4 id="kiá»ƒu-máº£ng-array"><a class="header" href="#kiá»ƒu-máº£ng-array">Kiá»ƒu máº£ng (array)</a></h4>
<p>Má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ khai bÃ¡o má»™t biáº¿n chá»©a Ä‘Æ°á»£c nhiá»u giÃ¡ trá»‹ lÃ  <em>array</em> (máº£ng). KhÃ´ng nhÆ°
tuple, cÃ¡c thÃ nh pháº§n cá»§a máº£ng pháº£i cÃ³ cÃ¹ng kiá»ƒu. CÅ©ng khÃ´ng giá»‘ng máº£ng trong nhiá»u ngÃ´n
ngá»¯ khÃ¡c, máº£ng trong Rust cÃ³ chiá»u dÃ i cá»‘ Ä‘á»‹nh.</p>
<p>ChÃºng ta viáº¿t cÃ¡c giÃ¡ trá»‹ cá»§a máº£ng nhÆ° má»™t danh sÃ¡ch cÃ¡c giÃ¡ trá»‹ cÃ¡ch nhau bá»Ÿi dáº¥u pháº©y,
Ä‘Æ°á»£c bao bá»c bá»Ÿi cáº·p dáº¥u ngoáº·c vuÃ´ng:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let a = [1, 2, 3, 4, 5];
}</code></pre></pre>
<p>CÃ¡c máº£ng sáº½ há»¯u Ã­ch hÆ¡n khi chÃºng ta phÃ¢n bá»‘ chÃºng trÃªn stack thay vÃ¬ heap (chÃºng ta sáº½
tháº£o luáº­n vá» stack vÃ  heap trong <a href="ch04-01-what-is-ownership.html#the-stack-and-the-heap">ChÆ°Æ¡ng 4</a><!-- ignore -->) hoáº·c
khi chÃºng ta muá»‘n Ä‘áº£m báº£o luÃ´n cÃ³ má»™t sá»‘ pháº§n tá»­ cá»‘ Ä‘á»‹nh. DÃ¹ váº­y kiá»ƒu array khÃ´ng
Ä‘Æ°á»£c má»m dáº»o nhÆ° vector. Má»™t vector lÃ  má»™t kiá»ƒu táº­p há»£p tÆ°Æ¡ng tá»± Ä‘Æ°á»£c cung cáº¥p
bá»Ÿi thÆ° viá»‡n chuáº©n, vÃ  nÃ³ cho phÃ©p thay Ä‘á»•i kÃ­ch thÆ°á»›c. Náº¿u báº¡n khÃ´ng cháº¯c nÃªn dÃ¹ng
array hay vector, váº­y thÃ¬ hÃ£y dÃ¹ng vector. <a href="ch08-01-vectors.html">ChÆ°Æ¡ng 8</a><!-- ignore --> sáº½
tháº£o luáº­n ká»¹ hÆ¡n vá» vector.</p>
<p>Tuy nhiÃªn, cÃ¡c máº£ng sáº½ há»¯u Ã­ch hÆ¡n náº¿u báº¡n biáº¿t sá»‘ pháº§n tá»­ sáº½ khÃ´ng thay Ä‘á»•i. VÃ­ dá»¥,
náº¿u báº¡n muá»‘n lÆ°u danh sÃ¡ch tÃªn cÃ¡c thÃ¡ng trong nÄƒm, sáº½ tá»‘t hÆ¡n khi dÃ¹ng array thay vÃ¬
vector vÃ¬ báº¡n biáº¿t nÃ³ luÃ´n cÃ³ 12 pháº§n tá»­:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let months = ["January", "February", "March", "April", "May", "June", "July",
              "August", "September", "October", "November", "December"];
<span class="boring">}</span></code></pre></pre>
<p>Báº¡n viáº¿t má»™t kiá»ƒu cá»§a máº£ng sá»­ dá»¥ng cáº·p dáº¥u ngoáº·c vuÃ´ng vá»›i kiá»ƒu cá»§a má»—i pháº§n tá»­,
má»™t dáº¥u cháº¥m pháº©y, vÃ  sá»‘ pháº§n tá»­ cá»§a máº£ng, giá»‘ng nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let a: [i32; 5] = [1, 2, 3, 4, 5];
<span class="boring">}</span></code></pre></pre>
<p>á» Ä‘Ã¢y, <code>i32</code> lÃ  kiá»ƒu cá»§a má»—i pháº§n tá»­. Sau dáº¥u cháº¥m pháº©y, sá»‘ <code>5</code> chá»‰ ra mang nÃ y cÃ³ 5
pháº§n tá»­.</p>
<p>Báº¡n cÅ©ng cÃ³ thá»ƒ khá»Ÿi táº¡o má»™t máº£ng Ä‘á»ƒ chá»©a cÃ¡c pháº§n tá»­ cÃ¹ng giÃ¡ trá»‹ báº±ng cÃ¡ch chá»‰ ra
giÃ¡ trá»‹ ban Ä‘áº§u, theo sau bá»Ÿi má»™t dáº¥u cháº¥m pháº©y, vÃ  sau Ä‘Ã³ lÃ  chiá»u dai cá»§a máº£ng, táº¥t
cáº£ bao trong cáº·p dáº¥u ngoáº·c vuÃ´ng, nhÆ° vÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let a = [3; 5];
<span class="boring">}</span></code></pre></pre>
<p>Máº£ng tÃªn <code>a</code> sáº½ chá»©a <code>5</code> pháº§n tá»­ vá»›i giÃ¡ trá»‹ ban Ä‘áº§u lÃ  <code>3</code>. Äiá»u nÃ y hoÃ n toÃ n giá»‘ng
vá»›i khi báº¡n viáº¿t <code>let a = [3, 3, 3, 3, 3];</code> nhÆ°ng theo má»™t cÃ¡ch ngáº¯n gá»n hÆ¡n.</p>
<h5 id="truy-cáº­p-cÃ¡c-pháº§n-tá»­-cá»§a-máº£ng"><a class="header" href="#truy-cáº­p-cÃ¡c-pháº§n-tá»­-cá»§a-máº£ng">Truy cáº­p cÃ¡c pháº§n tá»­ cá»§a máº£ng</a></h5>
<p>Má»™t máº£ng lÃ  má»™t Ä‘oáº¡n bá»™ nhá»› cÃ³ kÃ­ch thÆ°á»›c cá»‘ Ä‘á»‹nh, xÃ¡c Ä‘á»‹nh trÆ°á»›c vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c cáº¥p
phÃ¡t trÃªn stack. Báº¡n cÃ³ thá»ƒ truy cáº­p cÃ¡c pháº§n tá»­ cá»§a máº£ng dÃ¹ng chá»‰ sá»‘, giá»‘ng nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let a = [1, 2, 3, 4, 5];

    let first = a[0];
    let second = a[1];
}</code></pre></pre>
<p>Trong vÃ­ dá»¥ nÃ y, má»™t biáº¿n cÃ³ tÃªn <code>first</code> sáº½ cÃ³ giÃ¡ trá»‹ <code>1</code>, vÃ¬ nÃ³ lÃ  giÃ¡ trá»‹ táº¡i vá»‹ trÃ­
<code>[0]</code> trong máº£ng. Biáº¿n cÃ³ tÃªn <code>second</code> sáº½ cÃ³ giÃ¡ trá»‹ <code>2</code> tá»« pháº§n tá»­ <code>[1]</code> trong máº£ng.</p>
<h5 id="viá»‡c-truy-cáº­p-máº£ng-khÃ´ng-há»£p-lá»‡"><a class="header" href="#viá»‡c-truy-cáº­p-máº£ng-khÃ´ng-há»£p-lá»‡">Viá»‡c truy cáº­p máº£ng khÃ´ng há»£p lá»‡</a></h5>
<p>HÃ£y xem Ä‘iá»u gÃ¬ sáº½ xáº£y ra náº¿u báº¡n thá»­ truy cáº­p vÃ o má»™t pháº§n tá»­ vÆ°á»£t quÃ¡ pháº§n tá»­ cuá»‘i cá»§a
máº£ng. ChÃºng ta sáº½ cháº¡y Ä‘oáº¡n code sau, tÆ°Æ¡ng tá»± trong trÃ² chÆ¡i Ä‘oÃ¡n chá»¯ trong chÆ°Æ¡ng 2, Ä‘á»ƒ
láº¥y má»™t chá»‰ má»¥c tá»« ngÆ°á»i dÃ¹ng:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore panics">use std::io;

fn main() {
    let a = [1, 2, 3, 4, 5];

    println!("Please enter an array index.");

    let mut index = String::new();

    io::stdin()
        .read_line(&amp;mut index)
        .expect("Failed to read line");

    let index: usize = index
        .trim()
        .parse()
        .expect("Index entered was not a number");

    let element = a[index];

    println!("The value of the element at index {index} is: {element}");
}</code></pre>
<p>Äoáº¡n code nÃ y Ä‘Æ°á»£c dá»‹ch thÃ nh cÃ´ng. Náº¿u báº¡n cháº¡y nÃ³ báº±ng cÃ¡ch dÃ¹ng <code>cargo run</code> vÃ  nháº­p
vÃ o <code>0</code>, <code>1</code>, <code>2</code>, <code>3</code>, hay <code>4</code>, chÆ°Æ¡ng trÃ¬nh sáº½ in ra giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng táº¡i vá»‹ trÃ­ trong máº£ng. Náº¿u
báº¡n nháº­p má»™t giÃ¡ trá»‹ vÆ°á»£t quÃ¡ kÃ­ch thÆ°á»›c máº£ng, cháº³ng háº¡n 10, báº¡n sáº½ tháº¥y xuáº¥t ra nhÆ° sau:</p>
<!-- manual-regeneration
cd listings/ch03-common-programming-concepts/no-listing-15-invalid-array-access
cargo run
10
-->
<pre><code class="language-console">thread 'main' panicked at 'index out of bounds: the len is 5 but the index is 10', src/main.rs:19:19
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>ChÆ°Æ¡ng trÃ¬nh sinh ra má»™t lá»—i <em>runtime</em> ngay táº¡i nÆ¡i mÃ  chÃºng ta dÃ¹ng má»™t giÃ¡ trá»‹ khÃ´ng
há»£p lá»‡ khi dÃ¹ng chá»‰ sá»‘ máº£ng. ChÆ°Æ¡ng trÃ¬nh káº¿t thÃºc vá»›i má»™t thÃ´ng bÃ¡o lá»—i vÃ  Ä‘Ã£ khÃ´ng
thá»±c thi Ä‘áº¿n cÃ¢u lá»‡nh <code>println!</code> cuá»‘i cÃ¹ng. Khi báº¡n thá»­ truy cáº­p má»™t pháº§n tá»­ báº±ng cÃ¡ch
dÃ¹ng chá»‰ sá»‘, Rust sáº½ kiá»ƒm tra xem liá»‡u chá»‰ sá»‘ Ä‘Ã³ cÃ³ nhá» hÆ¡n chiá»u dÃ i cá»§a máº£ng hay khÃ´ng.
Náº¿u chá»‰ sá»‘ nÃ y lá»›n hÆ¡n hay báº±ng chiá»u dÃ i máº£ng, chÆ°Æ¡ng trÃ¬nh sáº½ bá»‹ lá»—i vÃ  káº¿t thÃºc
ngay láº­p tá»©c (panic). Viá»‡c kiá»ƒm tra nÃ y pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n khi cháº¡y chÆ°Æ¡ng trÃ¬nh, Ä‘áº·c
biá»‡t trong trÆ°á»ng há»£p nÃ y, vÃ¬ trÃ¬nh dá»‹ch khÃ´ng thá»ƒ biáº¿t giÃ¡ trá»‹ mÃ  ngÆ°á»i dÃ¹ng sáº½ nháº­p
vÃ o khi cháº¡y chÆ°Æ¡ng trÃ¬nh sau nÃ y.</p>
<p>ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ vá» cÃ¡c nguyÃªn táº¯c an toÃ n cá»§a Rust khi hoáº¡t Ä‘á»™ng. Trong nhiá»u ngÃ´n ngá»¯
cáº¥p tháº¥p, viá»‡c kiá»ƒm tra nÃ y khÃ´ng Ä‘Æ°á»£c thá»±c hiá»‡n, vÃ  khi báº¡n cung cáº¥p má»™t chá»‰ sá»‘ khÃ´ng
há»£p lá»‡, vÃ¹ng bá»™ nhá»› khÃ´ng há»£p lá»‡ sáº½ bá»‹ truy cáº­p. Rust báº£o vá»‡ báº¡n khá»i loáº¡i lá»—i nÃ y báº±ng
cÃ¡ch thoÃ¡t ra ngay láº­p tá»©c thay vÃ¬ cho phÃ©p truy cáº­p vÃ o vÃ¹ng nhá»› vÃ  tiáº¿p tá»¥c cháº¡y.
ChÆ°Æ¡ng 9 sáº½ tháº£o luáº­n thÃªm vá» viá»‡c xá»­ lÃ½ lá»—i trong Rust, cÃ¡ch viáº¿t code dá»… Ä‘á»c, an toÃ n
vÃ  trÃ¡nh cÃ¡c lá»—i panic hay truy cáº­p vÃ¹ng nhá»› khÃ´ng há»£p lá»‡.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="hÃ m---functions"><a class="header" href="#hÃ m---functions">HÃ m - Functions</a></h2>
<p>CÃ¡c hÃ m khÃ¡ phá»• biáº¿n trong Rust. Báº¡n Ä‘Ã£ gáº·p má»™t trong nhá»¯ng hÃ m quan quan trá»ng
nháº¥t cá»§a ngÃ´n ngá»¯: hÃ m <code>main</code>, vá»‘n lÃ  Ä‘iá»ƒm báº¯t Ä‘áº§u cho nhiá»u chÆ°Æ¡ng trÃ¬nh. Báº¡n cÅ©ng Ä‘Ã£ tháº¥y
tá»« khÃ³a <code>fn</code>, vá»‘n cho phÃ©p báº¡n khai bÃ¡o cÃ¡c hÃ m má»›i.</p>
<p>MÃ£ Rust dÃ¹ng <em>snake case</em> nhÆ° quy Æ°á»›c Ä‘áº·t tÃªn hÃ m vÃ  biáº¿n, trong Ä‘Ã³ táº¥t cáº£ cÃ¡c kÃ½ tá»±
Ä‘Æ°á»£c viáº¿t chá»¯ thÆ°á»ng, cÃ¡c tá»« cÃ¡ch nhau bá»Ÿi dáº¥u gáº¡ch dÆ°á»›i. ÄÃ¢y lÃ  má»™t chÆ°Æ¡ng trÃ¬nh
chá»©a má»™t vÃ­ dá»¥ vá» cÃ¡ch khai bÃ¡o hÃ m:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    println!("Hello, world!");

    another_function();
}

fn another_function() {
    println!("Another function.");
}</code></pre></pre>
<p>ChÃºng ta Ä‘á»‹nh nghÄ©a má»™t hÃ m trong Rust báº±ng cÃ¡ch dÃ¹ng tá»« khÃ³a <code>fn</code> theo sau bá»Ÿi
tÃªn hÃ m vÃ  má»™t táº­p cÃ¡c dáº¥u ngoáº·c trÃ²n. Cáº·p dáº¥u ngoáº·c nhá»n theo sau Ä‘Ã³ chá»‰ ra vá»‹
trÃ­ báº¯t Ä‘áº§u vÃ  káº¿t thÃºc cá»§a thÃ¢n hÃ m.</p>
<p>ChÃºng ta cÃ³ thá»ƒ gá»i báº¥t ká»³ hÃ m nÃ o ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a báº±ng cÃ¡ch gá»i tÃªn hÃ m, theo
sau bá»Ÿi cáº·p dáº¥u ngoáº·c trÃ²n. VÃ¬ <code>another_function</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong chÆ°Æ¡ng
trÃ¬nh, nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i tá»« hÃ m <code>main</code>. LÆ°u Ã½ lÃ  chÃºng ta Ä‘á»‹nh nghÄ©a <code>another_function</code>
<em>sau</em> hÃ m <code>main</code> trong file mÃ£ nguá»“n; nhÆ°ng táº¥t nhiÃªn ta cÅ©ng cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a
nÃ³ trÆ°á»›c hÃ m <code>main</code>. Rust khÃ´ng quan tÃ¢m báº¡n Ä‘á»‹nh nghÄ©a hÃ m á»Ÿ chá»— nÃ o, miá»…n sao
báº¡n viáº¿t nÃ³ trong pháº¡m vi mÃ  tá»« nÆ¡i gá»i cÃ³ thá»ƒ truy cáº­p Ä‘áº¿n Ä‘Æ°á»£c.</p>
<p>HÃ£y táº¡o má»™t dá»± Ã¡n cÃ³ tÃªn <em>functions</em> Ä‘á»ƒ khÃ¡m phÃ¡ thÃªm vá» cÃ¡c hÃ m. Äáº·t hÃ m vÃ­ dá»¥
<code>another_function</code> trong file <em>src/main.rs</em> vÃ  cháº¡y nÃ³. Báº¡n sáº½ tháº¥y ná»™i dung sau
Ä‘Æ°á»£c xuáº¥t ra:</p>
<pre><code class="language-console">$ cargo run
   Compiling functions v0.1.0 (file:///projects/functions)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.28s
     Running `target/debug/functions`
Hello, world!
Another function.
</code></pre>
<p>CÃ¡c dÃ²ng Ä‘Æ°á»£c thá»±c thi theo thá»© tá»± chÃºng xuáº¥t hiá»‡n trong hÃ m <code>main</code>. Äáº§u tiÃªn,
chuá»—i â€œHello, world!â€ Ä‘Æ°á»£c xuáº¥t ra mÃ n hÃ¬nh, tiáº¿p theo Ä‘Ã³ <code>another_function</code>
Ä‘Æ°á»£c gá»i vÃ  ná»™i dung cá»§a nÃ³ Ä‘Æ°á»£c in ra.</p>
<h3 id="tham-sá»‘"><a class="header" href="#tham-sá»‘">Tham sá»‘</a></h3>
<p>ChÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a hÃ m vá»›i cÃ¡c <em>parameters</em> (tham sá»‘), lÃ  nhá»¯ng biáº¿n Ä‘áº·c biá»‡t nhÆ° lÃ 
má»™t pháº§n cá»§a chá»¯ kÃ½ cá»§a hÃ m. Náº¿u má»™t hÃ m cÃ³ tham sá»‘, báº¡n cÃ³ thá»ƒ cung cáº¥p cho nÃ³
cÃ¡c giÃ¡ trá»‹ cá»¥ thá»ƒ khi gá»i. Vá» máº·t ká»¹ thuáº­t, nhá»¯ng giÃ¡ trá»‹ cá»¥ thá»ƒ mÃ  báº¡n cung cáº¥p
sáº½ Ä‘Æ°á»£c gá»i lÃ  cÃ¡c <em>argument</em> (Ä‘á»‘i sá»‘), tuy nhiÃªn trong thá»±c táº¿ sá»­ dá»¥ng, chÃºng
ta thÆ°á»ng dÃ¹ng hai tá»« nÃ y láº«n lá»™n vá»›i nhau.</p>
<p>Trong phiÃªn báº£n nÃ y cá»§a <code>another_function</code> chÃºng ta thÃªm má»™t tham sá»‘:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    another_function(5);
}

fn another_function(x: i32) {
    println!("The value of x is: {x}");
}</code></pre></pre>
<p>Khi thá»­ cháº¡y chÆ°Æ¡ng trÃ¬nh; báº¡n sáº½ nháº­n Ä‘Æ°á»£c káº¿t xuáº¥t sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling functions v0.1.0 (file:///projects/functions)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.21s
     Running `target/debug/functions`
The value of x is: 5
</code></pre>
<p>Trong pháº§n khai bÃ¡o hÃ m <code>another_function</code> ta cÃ³ thÃªm má»™t tham sá»‘ Ä‘Æ°á»£c Ä‘áº·t tÃªn <code>x</code>.
Kiá»ƒu cá»§a <code>x</code> lÃ  <code>i32</code>. Khi truyá»n giÃ¡ trá»‹ <code>5</code> cho <code>another_function</code>, macro
<code>println!</code> sáº½ in ra giÃ¡ trá»‹ <code>5</code> ngay táº¡i vá»‹ trÃ­ chá»©a <code>x</code> Ä‘Æ°á»£c bao bá»Ÿi cáº·p dáº¥u ngoáº·c
nhá»n trong chuá»—i Ä‘á»‹nh dáº¡ng.</p>
<p>Trong chá»¯ kÃ½ cá»§a hÃ m (thÃ nh pháº§n phÃ¢n biá»‡t cÃ¡c hÃ m vá»›i nhau), báº¡n <em>pháº£i</em> khai bÃ¡o
kiá»ƒu cá»§a má»—i tham sá»‘. ÄÃ¢y lÃ  má»™t quyáº¿t Ä‘á»‹nh cáº©n trá»ng trong thiáº¿t káº¿ cá»§a Rust:
yÃªu cáº§u khai bÃ¡o kiá»ƒu khi Ä‘á»‹nh nghÄ©a hÃ m Ä‘á»“ng nghÄ©a vá»›i viá»‡c trÃ¬nh biÃªn dá»‹ch sáº½
khÃ´ng bao giá» cáº§n báº¡n pháº£i dÃ¹ng má»™t tham sá»‘ Ä‘á»ƒ cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c kiá»ƒu dá»¯ liá»‡u
cá»§a tham sá»‘ Ä‘Ã³. TrÃ¬nh dá»‹ch cÅ©ng sáº½ cÃ³ thá»ƒ Ä‘Æ°a ra cÃ¡c thÃ´ng bÃ¡o há»¯u Ã­ch hÆ¡n khi nÃ³
biáº¿t chÃ­nh xÃ¡c kiá»ƒu dá»¯ liá»‡u mÃ  hÃ m Ä‘Ã³ cáº§n.</p>
<p>Khi Ä‘á»‹nh nghÄ©a nhiá»u tham sá»‘, báº¡n cáº§n phÃ¢n cÃ¡ch chÃºng báº±ng dáº¥u pháº©y, giá»‘ng nhÆ°
sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    print_labeled_measurement(5, 'h');
}

fn print_labeled_measurement(value: i32, unit_label: char) {
    println!("The measurement is: {value}{unit_label}");
}</code></pre></pre>
<p>VÃ­ dá»¥ nÃ y táº¡o ra má»™t hÃ m cÃ³ tÃªn <code>print_labeled_measurement</code> vá»›i hai tham sá»‘.
Tham sá»‘ Ä‘áº§u tiÃªn Ä‘Æ°á»£c Ä‘áº·t tÃªn <code>value</code> vÃ  lÃ  má»™t <code>i32</code>. Tham sá»‘ thá»© hai cÃ³ tÃªn
<code>unit_label</code> vÃ  cÃ³ kiá»ƒu <code>char</code>. HÃ m nÃ y sau Ä‘Ã³ in ra má»™t dÃ²ng vÄƒn báº£n chá»©a cáº£ hai
<code>value</code> vÃ  <code>unit_label</code>.</p>
<p>HÃ£y thá»­ cháº¡y Ä‘oáº¡n code nÃ y. Thay tháº¿ chÆ°Æ¡ng trÃ¬nh <em>src/main.rs</em> hiá»‡n cÃ³ trong
dá»± Ã¡n <em>functions</em> vá»›i vÃ­ dá»¥ phÃ­a trÃªn vÃ  cháº¡y dÃ¹ng <code>cargo run</code>:</p>
<pre><code class="language-console">$ cargo run
   Compiling functions v0.1.0 (file:///projects/functions)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.31s
     Running `target/debug/functions`
The measurement is: 5h
</code></pre>
<p>VÃ¬ chÃºng ta gá»i hÃ m vá»›i <code>5</code> nhÆ° lÃ  giÃ¡ trá»‹ cá»§a <code>value</code> vÃ  <code>'h'</code> lÃ  giÃ¡ trá»‹ cá»§a
<code>unit_label</code>, chÆ°Æ¡ng trÃ¬nh sáº½ xuáº¥t ra cÃ¡c giÃ¡ trá»‹ Ä‘Ã³.</p>
<h3 id="cÃ¡c-phÃ¡t-biá»ƒu-statement-vÃ -biá»ƒu-thá»©c-expression"><a class="header" href="#cÃ¡c-phÃ¡t-biá»ƒu-statement-vÃ -biá»ƒu-thá»©c-expression">CÃ¡c phÃ¡t biá»ƒu (statement) vÃ  biá»ƒu thá»©c (expression)</a></h3>
<p>ThÃ¢n hÃ m Ä‘Æ°á»£c táº¡o bá»Ÿi má»™t chuá»—i cÃ¡c phÃ¡t biá»ƒu, vÃ  cÃ³ thá»ƒ káº¿t thÃºc báº±ng má»™t biá»ƒu thá»©c.
Cho tá»›i hiá»‡n táº¡i, cÃ¡c hÃ m chÃºng ta Ä‘Ã£ lÃ m qua chÆ°a bao gá»“m biá»ƒu thá»©c káº¿t thÃºc,
nhÆ°ng báº¡n cÅ©ng Ä‘Ã£ gáº·p cÃ¡c biá»ƒu thá»©c lÃ  má»™t pháº§n cá»§a má»™t phÃ¡t biá»ƒu. VÃ¬ Rust lÃ  má»™t
ngÃ´n ngá»¯ dá»±a trÃªn cÃ¡c phÃ¡t biá»ƒu, Ä‘Ã¢y lÃ  má»™t sá»± phÃ¢n biá»‡t quan trá»ng Ä‘á»ƒ hiá»ƒu. CÃ¡c ngÃ´n
ngá»¯ khÃ¡c khÃ´ng cÃ³ sá»± phÃ¢n biá»‡t tÆ°Æ¡ng tá»± nhÆ° váº­y, do váº­y ta hÃ£y cÃ¹ng xem qua cÃ¡c phÃ¡t
biá»ƒu vÃ  biá»ƒu thá»©c cÅ©ng nhÆ° sá»± khÃ¡c biá»‡t giá»¯a chÃºng Ä‘Ã£ áº£nh hÆ°á»Ÿng Ä‘áº¿n thÃ¢n cÃ¡c hÃ m nhÆ°
tháº¿ nÃ o.</p>
<p><strong>PhÃ¡t biá»ƒu</strong> lÃ  cÃ¡c cÃ¢u lá»‡nh mÃ  nÃ³ sáº½ thá»±c hiá»‡n má»™t sá»‘ hÃ nh Ä‘á»™ng nÃ o Ä‘Ã³ vÃ  khÃ´ng
tráº£ vá» giÃ¡ trá»‹. <strong>Biá»ƒu thá»©c</strong> cÃ³ tráº£ vá» giÃ¡ trá»‹. HÃ£y cÅ©ng xem qua má»™t sá»‘ vÃ­ dá»¥.</p>
<p>ChÃºng ta Ä‘Ã£ tá»«ng thá»±c sá»± dÃ¹ng Ä‘áº¿n cÃ¡c phÃ¡t biá»ƒu vÃ  biá»ƒu thá»©c. Viá»‡c táº¡o ra má»™t biáº¿n vÃ  gÃ¡n má»™t
giÃ¡ trá»‹ cho nÃ³ vá»›i tá»« khÃ³a <code>let</code> lÃ  má»™t phÃ¡t biá»ƒu. Trong Listing 3-1, <code>let y = 6;</code> lÃ  má»™t
phÃ¡t biá»ƒu.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let y = 6;
}</code></pre></pre>
<p><span class="caption">Listing 3-1: Má»™t hÃ m <code>main</code> Ä‘ang khai bÃ¡o má»™t phÃ¡t biá»ƒu</span></p>
<p>CÃ¡c khai bÃ¡o hÃ m cÅ©ng lÃ  cÃ¡c phÃ¡t biá»ƒu; toÃ n bá»™ vÃ­ dá»¥ trÃªn báº£n thÃ¢n nÃ³ cÅ©ng lÃ  má»™t phÃ¡t biá»ƒu.</p>
<p>CÃ¡c phÃ¡t biá»ƒu khÃ´ng tráº£ vá» giÃ¡ trá»‹. Do váº­y, báº¡n khÃ´ng thá»ƒ gÃ¡n má»™t phÃ¡t biá»ƒu <code>let</code>
cho má»™t biáº¿n khÃ¡c, báº¡n sáº½ gáº·p lá»—i náº¿u thá»­ lÃ m nhÆ° trong vÃ­ dá»¥ sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let x = (let y = 6);
}</code></pre>
<p>Khi cháº¡y chÆ°Æ¡ng trÃ¬nh nÃ y, lá»—i báº¡n gáº·p sáº½ giá»‘ng nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling functions v0.1.0 (file:///projects/functions)
error: expected expression, found `let` statement
 --&gt; src/main.rs:2:14
  |
2 |     let x = (let y = 6);
  |              ^^^
  |
  = note: only supported directly in conditions of `if` and `while` expressions

warning: unnecessary parentheses around assigned value
 --&gt; src/main.rs:2:13
  |
2 |     let x = (let y = 6);
  |             ^         ^
  |
  = note: `#[warn(unused_parens)]` on by default
help: remove these parentheses
  |
2 -     let x = (let y = 6);
2 +     let x = let y = 6;
  |

warning: `functions` (bin "functions") generated 1 warning
error: could not compile `functions` (bin "functions") due to 1 previous error; 1 warning emitted
</code></pre>
<p>PhÃ¡t biá»ƒu <code>let y = 6</code> khÃ´ng tráº£ vá» má»™t giÃ¡ trá»‹, do váº­y cháº³ng cÃ³ gÃ¬ Ä‘á»ƒ Ä‘Æ°a vÃ o
biáº¿n <code>x</code>. Äiá»u nÃ y khÃ¡c vá»›i cÃ¡c ngÃ´n ngá»¯ khÃ¡c nhÆ° C hoáº·c Ruby, khi cÃ¡c má»™t cÃ¢u
lá»‡nh gÃ¡n sáº½ tráº£ vá» giÃ¡ trá»‹ báº±ng giÃ¡ trá»‹ Ä‘Æ°á»£c gÃ¡n. Trong cÃ¡c ngÃ´n ngá»¯ Ä‘Ã³, báº¡n cÃ³
thá»ƒ viáº¿t <code>x = y = 6</code> vÃ  lÃ m cho cáº£ hai <code>x</code> vÃ  <code>y</code> mang cÃ¹ng giÃ¡ trá»‹ <code>6</code>; Ä‘iá»u
nÃ y khÃ´ng xáº£y ra trong Rust.</p>
<p>CÃ¡c biá»ƒu thá»©c xÃ¡c Ä‘á»‹nh giÃ¡ trá»‹ vÃ  táº¡o nÃªn háº§u háº¿t cÃ¡c Ä‘oáº¡n lá»‡nh báº¡n viáº¿t trong
Rust. HÃ£y xem qua má»™t phÃ©p toÃ¡n, nhÆ° <code>5 + 6</code>, Ä‘Ã³ lÃ  má»™t biá»ƒu thá»©c vÃ  tráº£ vá»
giÃ¡ trá»‹ <code>11</code>. CÃ¡c biá»ƒu thá»©c cÅ©ng cÃ³ thá»ƒ lÃ  má»™t pháº§n cá»§a cÃ¡c phÃ¡t biá»ƒu: Trong
Listing 3-1, giÃ¡ trá»‹ <code>6</code>  trong phÃ¡t biá»ƒu <code>let y = 6;</code> lÃ  má»™t biá»ƒu thá»©c vÃ  tráº£
vá» giÃ¡ trá»‹ <code>6</code>. Viá»‡c gá»i má»™t hÃ m cÅ©ng lÃ  má»™t biá»ƒu thá»©c, gá»i má»™t macro cÅ©ng lÃ 
má»™t biá»ƒu thá»©c. Má»™t khá»‘i lá»‡nh má»›i Ä‘Æ°á»£c táº¡o bá»Ÿi má»™t cáº·p ngoáº·c nhá»n cÅ©ng lÃ  má»™t
biá»ƒu thá»©c, giá»‘ng nhÆ° trong vÃ­ dá»¥ sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let y = {
        let x = 3;
        x + 1
    };

    println!("The value of y is: {y}");
}</code></pre></pre>
<p>Biá»ƒu thá»©c nÃ y:</p>
<pre><code class="language-rust ignore">{
    let x = 3;
    x + 1
}</code></pre>
<p>lÃ  má»™t khá»‘i lá»‡nh, mÃ  trong trÆ°á»ng há»£p nÃ y tráº£ vá» giÃ¡ trá»‹ <code>4</code>. GiÃ¡ trá»‹ nÃ y Ä‘Æ°á»£c
gÃ¡n vÃ o cho <code>y</code> nhÆ° má»™t pháº§n cá»§a phÃ¡t biá»ƒu <code>let</code>. LÆ°u Ã½ lÃ  <code>x + 1</code> line khÃ´ng
cÃ³ má»™t dáº¥u cháº¥m pháº©y (;) á»Ÿ cuá»‘i, khÃ´ng nhÆ° háº§u háº¿t cÃ¡c dÃ²ng lá»‡nh báº¡n Ä‘Ã£ tá»«ng tháº¥y.
CÃ¡c biá»ƒu thá»©c khÃ´ng cÃ³ dáº¥u cháº¥m pháº©y káº¿t thÃºc. Náº¿u báº¡n thÃªm dáº¥u cháº¥m pháº©y, báº¡n sáº½
biáº¿n nÃ³ thÃ nh má»™t phÃ¡t biá»ƒu, vÃ  nÃ³ sáº½ khÃ´ng tráº£ vá» giÃ¡ trá»‹. HÃ£y lÆ°u Ã½ Ä‘iá»u nÃ y khi
báº¡n xem Ä‘áº¿n pháº§n káº¿ tiáº¿p nÃ³i vá» giÃ¡ trá»‹ vÃ  biá»ƒu thá»©c tráº£ vá» cá»§a hÃ m.</p>
<h3 id="hÃ m-vá»›i-káº¿t-quáº£-tráº£-vá»"><a class="header" href="#hÃ m-vá»›i-káº¿t-quáº£-tráº£-vá»">HÃ m vá»›i káº¿t quáº£ tráº£ vá»</a></h3>
<p>CÃ¡c hÃ m cÃ³ thá»ƒ tráº£ vá» cÃ¡c giÃ¡ trá»‹ cho Ä‘oáº¡n code gá»i chÃºng. ChÃºng ta khÃ´ng cáº§n Ä‘áº·t
tÃªn cho káº¿t quáº£ tráº£ vá», nhÆ°ng ta pháº£i khai bÃ¡o kiá»ƒu dá»¯ liá»‡u cá»§a chÃºng phÃ­a sau dáº¥u
mÅ©i tÃªn (<code>-&gt;</code>). Trong Rust, giÃ¡ trá»‹ tráº£ vá» cá»§a hÃ m Ä‘á»“ng nghÄ©a vá»›i giÃ¡ trá»‹ cá»§a biá»ƒu
thá»©c cuá»‘i cÃ¹ng trong thÃ¢n hÃ m. Báº¡n cÃ³ thá»ƒ dÃ¹ng tá»« khÃ³a <code>return</code> Ä‘á»ƒ tráº£ vá» má»™t giÃ¡ trá»‹
sá»›m hÆ¡n, nhÆ°ng háº§u háº¿t cÃ¡c hÃ m sáº½ láº¥y giÃ¡ trá»‹ tráº£ vá» lÃ  cÃ¢u lá»‡nh cuá»‘i cÃ¹ng. Sau Ä‘Ã¢y
lÃ  má»™t vÃ­ dá»¥ vá» hÃ m cÃ³ tráº£ vá» giÃ¡ trá»‹:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn five() -&gt; i32 {
    5
}

fn main() {
    let x = five();

    println!("The value of x is: {x}");
}</code></pre></pre>
<p>KhÃ´ng cÃ³ cÃ¡c lá»i gá»i hÃ m, macro, hay tháº­m chÃ­ phÃ¡t biá»ƒu <code>let</code> trong hÃ m <code>five</code>
ngoÃ i chÃ­nh sá»‘ <code>5</code>. ÄÃ³ hoÃ n toÃ n lÃ  má»™t hÃ m há»£p lá»‡ trong Rust. LÆ°u Ã½ lÃ  kiá»ƒu tráº£
vá» cá»§a hÃ m cÅ©ng Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh, lÃ  <code>-&gt; i32</code>. Thá»­ cháº¡y Ä‘oáº¡n code; káº¿t xuáº¥t sáº½ giá»‘ng
nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling functions v0.1.0 (file:///projects/functions)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.30s
     Running `target/debug/functions`
The value of x is: 5
</code></pre>
<p>Sá»‘ <code>5</code> trong <code>five</code> lÃ  giÃ¡ trá»‹ tráº£ vá» cá»§a hÃ m, Ä‘Ã³ lÃ  lÃ½ do vÃ¬ sao hÃ m nÃ y pháº£i cÃ³
kiá»ƒu lÃ  <code>i32</code>. HÃ£y xem xÃ©t má»™t cÃ¡ch chi tiáº¿t hÆ¡n. CÃ³ hai thÃ´ng tin quan trá»ng:
Ä‘áº§u tiÃªn, dÃ²ng <code>let x = five();</code> cho tháº¥y chÃºng ta Ä‘ang dÃ¹ng káº¿t quáº£ tráº£ vá» cá»§a
má»™t hÃ m Ä‘á»ƒ khá»Ÿi táº¡o má»™t biáº¿n. VÃ¬ hÃ m <code>five</code> tráº£ vá» giÃ¡ trá»‹ <code>5</code>, do váº­y dÃ²ng lá»‡nh
Ä‘Ã³ cÅ©ng tÆ°Æ¡ng tá»± nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 5;
<span class="boring">}</span></code></pre></pre>
<p>Thá»© hai, hÃ m <code>five</code> khÃ´ng cÃ³ tham sá»‘ vÃ  Ä‘á»‹nh nghÄ©a kiá»ƒu cá»§a giÃ¡ trá»‹ tráº£ vá», mÃ 
thÃ¢n hÃ m chá»‰ bao gá»“m má»™t sá»‘ <code>5</code> khÃ´ng cÃ³ dáº¥u cháº¥m pháº©y, vÃ¬ Ä‘Ã³ chÃ­nh lÃ  biá»ƒu thá»©c
chÃºng ta muá»‘n tráº£ vá».</p>
<p>HÃ£y cÃ¹ng xem má»™t vÃ­ dá»¥ khÃ¡c:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let x = plus_one(5);

    println!("The value of x is: {x}");
}

fn plus_one(x: i32) -&gt; i32 {
    x + 1
}</code></pre></pre>
<p>Cháº¡y Ä‘oáº¡n code nÃ y sáº½ in ra <code>The value of x is: 6</code>. NhÆ°ng náº¿u ta thÃªm má»™t dáº¥u
cháº¥m pháº©y vÃ o cuá»‘i dÃ²ng chá»©a <code>x + 1</code>, biáº¿n nÃ³ tá»« má»™t biá»ƒu thá»©c thÃ nh má»™t phÃ¡t
biá»ƒu, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c má»™t lá»—i.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let x = plus_one(5);

    println!("The value of x is: {x}");
}

fn plus_one(x: i32) -&gt; i32 {
    x + 1;
}</code></pre>
<p>Dá»‹ch Ä‘oáº¡n code sinh ra lá»—i, giá»‘ng nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling functions v0.1.0 (file:///projects/functions)
error[E0308]: mismatched types
 --&gt; src/main.rs:7:24
  |
7 | fn plus_one(x: i32) -&gt; i32 {
  |    --------            ^^^ expected `i32`, found `()`
  |    |
  |    implicitly returns `()` as its body has no tail or `return` expression
8 |     x + 1;
  |          - help: remove this semicolon to return this value

For more information about this error, try `rustc --explain E0308`.
error: could not compile `functions` (bin "functions") due to 1 previous error
</code></pre>
<p>ThÃ´ng bÃ¡o lá»—i chÃ­nh, <code>mismatched types</code>, cho tháº¥y gá»‘c rá»… váº¥n Ä‘á» cá»§a Ä‘oáº¡n code.
Äá»‹nh nghÄ©a hÃ m <code>plus_one</code> nÃ³i ráº±ng nÃ³ sáº½ tráº£ vá» má»™t <code>i32</code>, nhÆ°ng cÃ¡c phÃ¡t biá»ƒu
láº¡i khÃ´ng tráº£ vá» má»™t giÃ¡ trá»‹, tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i viá»‡c tráº£ vá» má»™t giÃ¡ trá»‹ rá»—ng <code>()</code>.
Do khÃ´ng cÃ³ giÃ¡ trá»‹ nÃ o Ä‘Æ°á»£c tráº£ vá», Ä‘iá»u nÃ y trÃ¡i ngÆ°á»£c vá»›i Ä‘á»‹nh nghÄ©a cá»§a
hÃ m vÃ  gÃ¢y ra lá»—i. Trong káº¿t xuáº¥t nÃ y, Rust cÅ©ng cung cáº¥p thÃªm má»™t thÃ´ng bÃ¡o cÃ³
thá»ƒ giÃºp sá»­a Ä‘Æ°á»£c lá»—i: nÃ³ Ä‘á» xuáº¥t viá»‡c xÃ³a dáº¥u cháº¥m pháº©y, vÃ  cÃ³ thá»ƒ loáº¡i bá» Ä‘Æ°á»£c
lá»—i.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="ghi-chÃº"><a class="header" href="#ghi-chÃº">Ghi chÃº</a></h2>
<p>Táº¥t cáº£ cÃ¡c láº­p trÃ¬nh viÃªn khi viáº¿t code Ä‘á»u cá»‘ gáº¯ng viáº¿t sao cho dá»… hiá»ƒu, nhÆ°ng
Ä‘Ã´i khi váº«n cáº§n cÃ¡c Ä‘oáº¡n giáº£i thÃ­ch thÃªm. Trong trÆ°á»ng há»£p Ä‘o, há» sáº½ Ä‘á»ƒ láº¡i cÃ¡c
<em>ghi chÃº</em> trong mÃ£ nguá»“n, cÃ¡c ghi chÃº nÃ y sáº½ bá»‹ bá» qua bá»Ÿi trÃ¬nh biÃªn dá»‹ch nhÆ°ng
sáº½ há»¯u Ã­ch cho ngÆ°á»i Ä‘á»c code.</p>
<p>ÄÃ¢y lÃ  má»™t ghi chÃº Ä‘Æ¡n giáº£n:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// hello, world
<span class="boring">}</span></code></pre></pre>
<p>Trong Rust, cÃ¡c ghi chÃº báº¯t Ä‘áº§u báº±ng cáº·p dáº¥u slash (<code>//</code>), vÃ  kÃ½ hiá»‡u ghi chÃº Ä‘Ã³
sáº½ cÃ³ giÃ¡ trá»‹ cho Ä‘áº¿n háº¿t dÃ²ng. Vá»›i nhá»¯ng ghi chÃº trÃªn nhiá»u hÃ ng, báº¡n sáº½ cáº§n
bao gá»“m <code>//</code> trÃªn tá»«ng dÃ²ng ghi chÃº.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// á» Ä‘Ã¢y chÃºng ta Ä‘ang lÃ m má»™t sá»‘ Ä‘iá»u phá»©c táº¡p, dÃ i Ä‘á»§ Ä‘á»ƒ ta pháº£i cáº§n nhiá»u 
// dÃ²ng ghi chÃº Ä‘á»ƒ hoÃ n thÃ nh! Whew! Hi vá»ng lÃ  ghi chÃº nÃ y sáº½ giáº£i thÃ­ch Ä‘Æ°á»£c 
// vá» nhá»¯ng Ä‘iá»u Ä‘ang diá»…n ra.
<span class="boring">}</span></code></pre></pre>
<p>Ghi chÃº cÅ©ng cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘áº·t á»Ÿ cuá»‘i dÃ²ng code:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let lucky_number = 7; // I'm feeling lucky today
}</code></pre></pre>
<p>NhÆ°ng báº¡n sáº½ tháº¥y chÃºng Ä‘Æ°á»£c dÃ¹ng á»Ÿ dáº¡ng sau thÆ°á»ng xuyÃªn hÆ¡n, vá»›i ghi chÃº
trÃªn má»™t dÃ²ng riÃªng biá»‡t phÃ­a trÃªn Ä‘oáº¡n code nÃ³ Ä‘ang giáº£i thÃ­ch:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    // I'm feeling lucky today
    let lucky_number = 7;
}</code></pre></pre>
<p>Rust cÅ©ng cÃ³ má»™t kiá»ƒu ghi chÃº khÃ¡c, Ä‘Æ°á»£c gá»i lÃ  cÃ¡c ghi chÃº tÃ i liá»‡u, chÃºng
ta sáº½ tháº£o luáº­n thÃªm trong pháº§n <a href="ch14-02-publishing-to-crates-io.html">â€œPublishing a Crate to Crates.ioâ€</a><!-- ignore --> á»Ÿ chÆ°Æ¡ng 14.</p>
<div style="break-before: page; page-break-before: always;"></div><p><a id="control-flow"></a></p>
<h2 id="cÃ¡c-khá»‘i-Ä‘iá»u-khiá»ƒn"><a class="header" href="#cÃ¡c-khá»‘i-Ä‘iá»u-khiá»ƒn">CÃ¡c khá»‘i Ä‘iá»u khiá»ƒn</a></h2>
<p>Kháº£ nÄƒng cháº¡y má»™t sá»‘ Ä‘oáº¡n lá»‡nh dá»±a khi má»™t Ä‘iá»u kiá»‡n nÃ o Ä‘Ã³ lÃ  <code>true</code>, hoáº·c cháº¡y láº·p láº¡i má»™t
lá»‡nh khi má»™t Ä‘iá»u kiá»‡n nÃ o Ä‘Ã³ lÃ  <code>true</code>, lÃ  cÃ¡c khá»‘i Ä‘iá»u khiá»ƒn cÆ¡ báº£n cÃ³ trong háº§u
háº¿t cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh. Khá»‘i Ä‘iá»u khiá»ƒn phá»• biáº¿n nháº¥t cho phÃ©p báº¡n kiá»ƒm soÃ¡t viá»‡c
thá»±c thi cÃ¡c Ä‘oáº¡n code trong Rust lÃ  cÃ¡c biá»ƒu thá»©c <code>if</code> vÃ  cÃ¡c lá»‡nh láº·p.</p>
<h3 id="biá»ƒu-thá»©c-if"><a class="header" href="#biá»ƒu-thá»©c-if">Biá»ƒu thá»©c <code>if</code></a></h3>
<p>Má»™t biá»ƒu thá»©c <code>if</code> cho phÃ©p báº¡n ráº½ nhÃ¡nh thá»±c thi dá»±a trÃªn cÃ¡c Ä‘iá»u kiá»‡n nÃ o Ä‘Ã³.
Báº¡n cung cáº¥p má»™t Ä‘iá»u kiá»‡n vÃ  phÃ¡t biá»ƒu: â€œNáº¿u Ä‘iá»u kiá»‡n nÃ y Ä‘Ãºng, hÃ£y cháº¡y Ä‘oáº¡n lá»‡nh
nÃ y. Náº¿u khÃ´ng Ä‘áº¡t, Ä‘á»«ng cháº¡y nÃ³â€.</p>
<p>Táº¡o má»™t dá»± Ã¡n má»›i Ä‘Æ°á»£c gá»i lÃ  <em>branches</em> trong thÆ° má»¥c <em>projects</em> Ä‘á»ƒ kháº£o sÃ¡t biá»ƒu
thá»©c <code>if</code>. Trong file <em>src/main.rs</em>, hÃ£y nháº­p vÃ o ná»™i dung sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let number = 3;

    if number &lt; 5 {
        println!("condition was true");
    } else {
        println!("condition was false");
    }
}</code></pre></pre>
<p>Táº¥t cáº£ cÃ¡c phÃ¡t biá»ƒu <code>if</code> sáº½ báº¯t Ä‘áº§u báº±ng tá»« khÃ³a <code>if</code>, theo sau bá»Ÿi má»™t Ä‘iá»u kiá»‡n.
Trong trÆ°á»ng há»£p nÃ y, Ä‘iá»u kiá»‡n lÃ  kiá»ƒm tra xem liá»‡u biáº¿n <code>number</code> cÃ³ giÃ¡ trá»‹ nhá»
hÆ¡n 5 hay khÃ´ng. ChÃºng ta Ä‘áº·t khá»‘i lá»‡nh Ä‘á»ƒ thá»±c thi náº¿u Ä‘iá»u kiá»‡n lÃ  Ä‘Ãºng ngay sau
dáº¥u ngoáº·c Ä‘Ã³ng cá»§a Ä‘iá»u kiá»‡n. CÃ¡c khá»‘i lá»‡nh káº¿t há»£p vá»›i <code>if</code> Ä‘Ã´i khi Ä‘Æ°á»£c gá»i lÃ 
<em>arm</em>, giá»‘ng nhÆ° <em>arms</em> trong phÃ¡t biá»ƒu <code>match</code> mÃ  ta Ä‘Ã£ tháº£o luáº­n trong pháº§n
<a href="ch02-00-guessing-game-tutorial.html#comparing-the-guess-to-the-secret-number">â€œComparing the Guess to the Secret Numberâ€</a><!--
ignore --> section of Chapter 2.</p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ tÃ¹y chá»n thÃªm má»™t phÃ¡t biá»ƒu <code>else</code>, giá»‘ng nhÆ° chÃºng ta Ä‘Ã£
lÃ m á»Ÿ Ä‘Ã¢y, Ä‘á»ƒ cung cáº¥p má»™t Ä‘oáº¡n code mÃ  sáº½ Ä‘Æ°á»£c thá»±c thi náº¿u Ä‘iá»u kiá»‡n tráº£ vá»
giÃ¡ trá»‹ false. Náº¿u báº¡n khÃ´ng cung cáº¥p <code>else</code>, chÆ°Æ¡ng trÃ¬nh sáº½ chá»‰ Ä‘Æ¡n giáº£n bá» qua
khá»‘i lá»‡nh <code>if</code> vÃ  tiáº¿p tá»¥c thá»±c thi cÃ¡c lá»‡nh tiáº¿p sau Ä‘Ã³.</p>
<p>Thá»­ cháº¡y Ä‘oáº¡n lá»‡nh nÃ y, báº¡n sáº½ tháº¥y káº¿t xuáº¥t nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling branches v0.1.0 (file:///projects/branches)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.31s
     Running `target/debug/branches`
condition was true
</code></pre>
<p>HÃ£y thá»­ thay Ä‘á»•i <code>number</code> sang má»™t giÃ¡ trá»‹ lÃ m cho Ä‘iá»u kiá»‡n tráº£ vá» káº¿t quáº£ false
Ä‘á»ƒ xem Ä‘iá»u gÃ¬ xáº£y ra:</p>
<pre><code class="language-rust ignore"><span class="boring">fn main() {
</span>    let number = 7;
<span class="boring">
</span><span class="boring">    if number &lt; 5 {
</span><span class="boring">        println!("condition was true");
</span><span class="boring">    } else {
</span><span class="boring">        println!("condition was false");
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Cháº¡y láº¡i chÆ°Æ¡ng trÃ¬nh, vÃ  xem káº¿t xuáº¥t:</p>
<pre><code class="language-console">$ cargo run
   Compiling branches v0.1.0 (file:///projects/branches)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.31s
     Running `target/debug/branches`
condition was false
</code></pre>
<p>Má»™t Ä‘iá»ƒm quan trá»ng cáº§n lÆ°u Ã½ lÃ  Ä‘iá»u kiá»‡n trong Ä‘oáº¡n code nÃ y báº¯t buá»™c <em>pháº£i</em> cÃ³
kiá»ƒu <code>bool</code>. Náº¿u Ä‘iá»u kiá»‡n nÃ y khÃ´ng pháº£i lÃ  bool, báº¡n sáº½ nháº­n má»™t lá»—i. VÃ­ dá»¥, thá»­
cháº¡y Ä‘oáº¡n lá»‡nh sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let number = 3;

    if number {
        println!("number was three");
    }
}</code></pre>
<p>Trong trÆ°á»ng há»£p nÃ y biá»ƒu thá»©c trong <code>if</code> tráº£ vá» giÃ¡ trá»‹ <code>3</code>, vÃ  Rust phÃ¡t ra má»™t
lá»—i:</p>
<pre><code class="language-console">$ cargo run
   Compiling branches v0.1.0 (file:///projects/branches)
error[E0308]: mismatched types
 --&gt; src/main.rs:4:8
  |
4 |     if number {
  |        ^^^^^^ expected `bool`, found integer

For more information about this error, try `rustc --explain E0308`.
error: could not compile `branches` (bin "branches") due to 1 previous error
</code></pre>
<p>Lá»—i nÃ y chá»‰ ra Rust cáº§n má»™t <code>bool</code> nhÆ°ng láº¡i nháº­n Ä‘Æ°á»£c má»™t integer. KhÃ´ng nhÆ°
cÃ¡c ngÃ´n ngá»¯ nhÆ° Ruby hay JavaScript, Rust khÃ´ng tá»± Ä‘á»™ng thá»­ chuyá»ƒn cÃ¡c giÃ¡ trá»‹
khÃ´ng pháº£i boolean sang boolean. Náº¿u báº¡n muá»‘n Ä‘oáº¡n <code>if</code> chá»‰ cháº¡y khi má»™t sá»‘ báº±ng
vá»›i <code>0</code>, báº¡n cÃ³ thá»ƒ viáº¿t láº¡i nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let number = 3;

    if number != 0 {
        println!("number was something other than zero");
    }
}</code></pre></pre>
<p>Cháº¡y Ä‘oáº¡n code nÃ y sáº½ tráº£ vá» káº¿t xuáº¥t sau: <code>number was something other than zero</code>.</p>
<h4 id="xá»­-lÃ½-nhiá»u-Ä‘iá»u-kiá»‡n-vá»›i-else-if"><a class="header" href="#xá»­-lÃ½-nhiá»u-Ä‘iá»u-kiá»‡n-vá»›i-else-if">Xá»­ lÃ½ nhiá»u Ä‘iá»u kiá»‡n vá»›i <code>else if</code></a></h4>
<p>Báº¡n cÃ³ thá»ƒ dÃ¹ng nhiá»u Ä‘iá»u kiá»‡n khÃ¡c nhau báº±ng cÃ¡ch káº¿t há»£p <code>if</code> vá»›i <code>else</code> trong
má»™t biá»ƒu thá»©c <code>else if</code>. VÃ­ dá»¥:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let number = 6;

    if number % 4 == 0 {
        println!("number is divisible by 4");
    } else if number % 3 == 0 {
        println!("number is divisible by 3");
    } else if number % 2 == 0 {
        println!("number is divisible by 2");
    } else {
        println!("number is not divisible by 4, 3, or 2");
    }
}</code></pre></pre>
<p>ChÆ°Æ¡ng trÃ¬nh nÃ y cÃ³ bá»‘n nhÃ¡nh cÃ³ thá»ƒ thá»±c thi. Sau khi cháº¡y báº¡n sáº½ tháº¥y káº¿t xuáº¥t sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling branches v0.1.0 (file:///projects/branches)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.31s
     Running `target/debug/branches`
number is divisible by 3
</code></pre>
<p>Khi cháº¡y chÆ°Æ¡ng trÃ¬nh nÃ y, nÃ³ sáº½ kiá»ƒm tra láº§n lÆ°á»£t má»—i biá»ƒu thá»©c <code>if</code> vÃ  thá»±c
thi thÃ¢n <code>if</code> Ä‘áº§u tiÃªn mÃ  biá»ƒu thá»©c tráº£ vá» <code>true</code>. LÆ°u Ã½ ráº±ng tuy 6 chia háº¿t cho 2,
chÃºng ta váº«n khÃ´ng tháº¥y cÃ¢u <code>number is divisible by 2</code> Ä‘Æ°á»£c in ra, cÅ©ng nhÆ° khÃ´ng
tháº¥y cÃ¢u <code>number is not divisible by 4, 3, or 2</code> trong khá»‘i <code>else</code>. ÄÃ³ lÃ  vÃ¬ Rust
chá»‰ thá»±c thi Ä‘oáº¡n lá»‡nh trong thÃ¢n <code>if</code> Ä‘áº§u tiÃªn mÃ  nÃ³ tháº¥y tráº£ vá» true, vÃ  má»™t khi
tÃ¬m tháº¥y, nÃ³ sáº½ tháº­m chÃ­ khÃ´ng kiá»ƒm tra cÃ¡c biá»ƒu thá»©c phÃ­a sau.</p>
<p>Sá»­ dá»¥ng quÃ¡ nhiá»u <code>else if</code> lÃ m cho code cá»§a báº¡n lá»™n xá»™n, do váº­y náº¿u báº¡n cÃ³ nhiá»u
hÆ¡n má»™t, báº¡n cÃ³ thá»ƒ sáº½ cáº§n refactor code. ChÆ°Æ¡ng 6 mÃ´ táº£ má»™t cáº¥u trÃºc ráº½ nhÃ¡nh máº¡nh
máº½ trong Rust Ä‘Æ°á»£c gá»i lÃ  <code>match</code> phÃ¹ há»£p vá»›i trÆ°á»ng há»£p nÃ y.</p>
<h4 id="sá»­-dá»¥ng-if-bÃªn-trong-phÃ¡t-biá»ƒu-let"><a class="header" href="#sá»­-dá»¥ng-if-bÃªn-trong-phÃ¡t-biá»ƒu-let">Sá»­ dá»¥ng <code>if</code> bÃªn trong phÃ¡t biá»ƒu <code>let</code></a></h4>
<p>VÃ¬ <code>if</code> lÃ  má»™t biá»ƒu thá»©c, váº­y nÃªn ta cÃ³ thá»ƒ dÃ¹ng nÃ³ bÃªn pháº£i cá»§a má»™t phÃ¡t biá»ƒu <code>let</code>
Ä‘á»ƒ gÃ¡n giÃ¡ trá»‹ tráº£ vá» cho má»™t biáº¿n, nhÆ° trong Listing 3-2.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let condition = true;
    let number = if condition { 5 } else { 6 };

    println!("The value of number is: {number}");
}</code></pre></pre>
<p><span class="caption">Listing 3-2: GÃ¡n káº¿t quáº£ cá»§a má»™t biá»ƒu thá»©c <code>if</code> vÃ o má»™t biáº¿n</span></p>
<p>Biáº¿n <code>number</code> sáº½ Ä‘Æ°á»£c gÃ¡n má»™t giÃ¡ trá»‹ dá»±a trÃªn káº¿t quáº£ cá»§a má»™t biá»ƒu thá»©c <code>if</code>. Cháº¡y
Ä‘oáº¡n code sau Ä‘á»ƒ xem Ä‘iá»u gÃ¬ xáº£y ra:</p>
<pre><code class="language-console">$ cargo run
   Compiling branches v0.1.0 (file:///projects/branches)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.30s
     Running `target/debug/branches`
The value of number is: 5
</code></pre>
<p>HÃ£y nhá»› lÃ  cÃ¡c khá»‘i lá»‡nh sáº½ Ä‘Æ°á»£c Ä‘á»‹nh giÃ¡ trá»‹ báº±ng vá»›i giÃ¡ trá»‹ cá»§a biá»ƒu thá»©c cuá»‘i
cÃ¹ng bÃªn trong nÃ³, vÃ  báº£n thÃ¢n cÃ¡c con sá»‘ cÅ©ng lÃ  cÃ¡c biá»ƒu thá»©c. Trong trÆ°á»ng há»£p nÃ y,
giÃ¡ trá»‹ cá»§a toÃ n bá»™ biá»ƒu thá»©c <code>if</code> phá»¥ thuá»™c vÃ o nhÃ¡nh nÃ o Ä‘Æ°á»£c thá»±c thi. CÃ³ nghÄ©a lÃ 
cÃ¡c nhÃ¡nh cá»§a <code>if</code> pháº£i cÃ³ cÃ¹ng kiá»ƒu; trong Listing 3-2, káº¿t quáº£ cá»§a cáº£ hai nhÃ¡nh
cá»§a <code>if</code> Ä‘á»u cÃ³ kiá»ƒu sá»‘ nguyÃªn <code>i32</code>. Náº¿u cÃ¡c kiá»ƒu khÃ´ng khá»›p nhau, nhÆ° trong vÃ­ dá»¥
dÆ°á»›i Ä‘Ã¢y, chÃºng ta sáº½ nháº­n vá» má»™t lá»—i.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let condition = true;

    let number = if condition { 5 } else { "six" };

    println!("The value of number is: {number}");
}</code></pre>
<p>Khi chÃºng ta thá»­ dá»‹ch Ä‘oáº¡n code nÃ y, chÃºng ta sáº½ nháº­n vá» má»™t lá»—i. CÃ¡c nhÃ¡nh <code>if</code>
vÃ  <code>else</code> cÃ³ cÃ¡c kiá»ƒu khÃ´ng tÆ°Æ¡ng thÃ­ch, vÃ  Rust chá»‰ ra chÃ­nh xÃ¡c vá»‹ trÃ­ nÆ¡i phÃ¡t
sinh lá»—i trong chÆ°Æ¡ng trÃ¬nh:</p>
<pre><code class="language-console">$ cargo run
   Compiling branches v0.1.0 (file:///projects/branches)
error[E0308]: `if` and `else` have incompatible types
 --&gt; src/main.rs:4:44
  |
4 |     let number = if condition { 5 } else { "six" };
  |                                 -          ^^^^^ expected integer, found `&amp;str`
  |                                 |
  |                                 expected because of this

For more information about this error, try `rustc --explain E0308`.
error: could not compile `branches` (bin "branches") due to 1 previous error
</code></pre>
<p>Biá»ƒu thá»©c trong khá»‘i <code>if</code> tráº£ vá» má»™t giÃ¡ trá»‹ integer, trong khi biá»ƒu thá»©c trong khá»‘i <code>else</code>
tráº£ vá» má»™t string. Äiá»u nÃ y khÃ´ng thá»ƒ hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c vÃ¬ cÃ¡c biáº¿n chá»‰ cÃ³ thá»ƒ cÃ³ má»™t kiá»ƒu
duy nháº¥t, vÃ  Rust cáº§n biáº¿t kiá»ƒu cá»§a biáº¿n <code>number</code> lÃ  gÃ¬ ngay khi dá»‹ch. Viá»‡c biáº¿t
kiá»ƒu cá»§a biáº¿n <code>number</code> cho phÃ©p trÃ¬nh dá»‹ch xÃ¡c Ä‘á»‹nh tÃ­nh há»£p lá»‡ vá» kiá»ƒu báº¥t cá»© khi nÃ o
ta truy xuáº¥t Ä‘áº¿n nÃ³. Rust sáº½ khÃ´ng thá»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u nÃ y náº¿u nÃ³ chá»‰ cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh kiá»ƒu
cá»§a <code>number</code> vÃ o lÃºc cháº¡y chÆ°Æ¡ng trÃ¬nh; trÃ¬nh dá»‹ch cÃ³ láº½ sáº½ phá»©c táº¡p hÆ¡n nhiá»u cÅ©ng nhÆ°
khÃ³ Ä‘áº£m báº£o vá» Ä‘oáº¡n code hÆ¡n náº¿u nÃ³ pháº£i lÆ°u giá»¯ thÃ´ng tin vá» táº¥t cáº£ cÃ¡c kiá»ƒu dá»¯ liá»‡u
<code>giáº£ tÆ°á»Ÿng</code> cho báº¥t ká»³ biáº¿n nÃ o.</p>
<h3 id="sá»­-dá»¥ng-vÃ²ng-láº·p-loops"><a class="header" href="#sá»­-dá»¥ng-vÃ²ng-láº·p-loops">Sá»­ dá»¥ng vÃ²ng láº·p (loops)</a></h3>
<p>ChÃºng ta thÆ°á»ng xuyÃªn pháº£i thá»±c thi má»™t Ä‘oáº¡n code nÃ o Ä‘Ã³ nhiá»u láº§n. Äá»ƒ lÃ m Ä‘iá»u nÃ y,
Rust cung cáº¥p má»™t sá»‘ dáº¡ng <em>vÃ²ng láº·p</em>, nÃ³ cho phÃ©p cháº¡y Ä‘áº¿n cuá»‘i Ä‘oáº¡n code bÃªn trong
thÃ¢n vÃ²ng láº·p , sau Ä‘Ã³ quay trá»Ÿ láº¡i vá»‹ trÃ­ báº¯t Ä‘áº§u. Äá»ƒ tráº£i nghiá»‡m thá»­ cÃ¡c vÃ²ng láº·p,
chÃºng ta sáº½ cÃ¹ng táº¡o má»™t dá»± Ã¡n má»›i cÃ³ tÃªn <em>loops</em>.</p>
<p>Rust cÃ³ ba dáº¡ng láº·p: <code>loop</code>, <code>while</code>, vÃ  <code>for</code>. HÃ£y cÃ¹ng thá»­ qua tá»«ng cÃ¡i.</p>
<h4 id="láº·p-láº¡i-má»™t-Ä‘oáº¡n-code-sá»­-dá»¥ng-loop"><a class="header" href="#láº·p-láº¡i-má»™t-Ä‘oáº¡n-code-sá»­-dá»¥ng-loop">Láº·p láº¡i má»™t Ä‘oáº¡n code sá»­ dá»¥ng <code>loop</code></a></h4>
<p>Tá»« khÃ³a <code>loop</code> sáº½ yÃªu cáº§u Rust thá»±c thi má»™t Ä‘oáº¡n code láº·p Ä‘i láº·p láº¡i cho Ä‘áº¿n
khi báº¡n yÃªu cáº§u nÃ³ káº¿t thÃºc.</p>
<p>Äá»ƒ vÃ­ dá»¥, hÃ£y thay Ä‘á»•i file <em>src/main.rs</em> trong thÆ° má»¥c <em>loops</em> cá»§a báº¡n Ä‘á»ƒ nÃ³ trÃ´ng
nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">fn main() {
    loop {
        println!("again!");
    }
}</code></pre>
<p>Khi cháº¡y chÆ°Æ¡ng trÃ¬nh nÃ y, chÃºng ta sáº½ tháº¥y dÃ²ng <code>again!</code> Ä‘Æ°á»£c in lÃªn mÃ n hÃ¬nh
liÃªn tá»¥c cho Ä‘áº¿n khi báº¡n ngá»«ng cháº¡y chÆ°Æ¡ng trÃ¬nh. Háº§u háº¿t cÃ¡c terminal há»— trá»£
tá»• há»£p phÃ­m <span class="keystroke">ctrl-c</span> Ä‘á»ƒ ngáº¯t má»™t chÆ°Æ¡ng trÃ¬nh Ä‘ang
bá»‹ káº¹t trong má»™t vÃ²ng láº·p. HÃ£y cÃ¹ng cháº¡y thá»­:</p>
<!-- manual-regeneration
cd listings/ch03-common-programming-concepts/no-listing-32-loop
cargo run
CTRL-C
-->
<pre><code class="language-console">$ cargo run
   Compiling loops v0.1.0 (file:///projects/loops)
    Finished dev [unoptimized + debuginfo] target(s) in 0.29s
     Running `target/debug/loops`
again!
again!
again!
again!
^Cagain!
</code></pre>
<p>KÃ½ hiá»‡u <code>^C</code> Ä‘áº¡i diá»‡n cho vá»‹ trÃ­ báº¡n nháº¥n <span class="keystroke">ctrl-c
</span>. Báº¡n cÃ³ thá»ƒ nhÃ¬n tháº¥y dÃ²ng <code>again!</code> Ä‘Æ°á»£c in phÃ­a sau <code>^C</code> hoáº·c khÃ´ng,
phá»¥ thuá»™c vÃ o nÆ¡i Ä‘oáº¡n code Ä‘ang thá»±c thi bÃªn trong vÃ²ng láº·p khi nÃ³ nháº­n Ä‘Æ°á»£c
tÃ­n hiá»‡u ngáº¯t.</p>
<p>May máº¯n lÃ  Rust cÅ©ng cung cáº¥p má»™t cÃ¡ch Ä‘á»ƒ thoÃ¡t khá»i vÃ²ng láº·p báº±ng code. Báº¡n cÃ³
thá»ƒ Ä‘áº·t má»™t tá»« khÃ³a <code>break</code> bÃªn trong vÃ²ng láº·p Ä‘á»ƒ nÃ³i vá»›i chÆ°Æ¡ng trÃ¬nh khi nÃ o
cáº§n thoÃ¡t khá»i vÃ²ng láº·p. HÃ£y nhá»› láº¡i chÃºng ta Ä‘Ã£ lÃ m Ä‘iá»u nÃ y trong <a href="ch02-00-guessing-game-tutorial.html#quitting-after-a-correct-guess">â€œQuitting
After a Correct Guessâ€</a><!-- ignore --> trong
chÆ°Æ¡ng 2 Ä‘á»ƒ thoÃ¡t khá»i chÆ°Æ¡ng trÃ¬nh khi ngÆ°á»i dÃ¹ng chiáº¿n tháº¯ng báº±ng cÃ¡ch Ä‘oÃ¡n Ä‘Ãºng
con sá»‘.</p>
<p>ChÃºng ta cÅ©ng dÃ¹ng <code>continue</code> trong trÃ² chÆ¡i Ä‘oÃ¡n sá»‘, Ä‘á»ƒ yÃªu cáº§u chÆ°Æ¡ng trÃ¬nh bá»
qua pháº§n cÃ²n láº¡i trong thÃ¢n vÃ²ng láº·p hiá»‡n táº¡i vÃ  báº¯t Ä‘áº§u má»™t vÃ²ng láº·p má»›i.</p>
<h4 id="tráº£-káº¿t-quáº£-vá»-tá»«-vÃ²ng-láº·p"><a class="header" href="#tráº£-káº¿t-quáº£-vá»-tá»«-vÃ²ng-láº·p">Tráº£ káº¿t quáº£ vá» tá»« vÃ²ng láº·p</a></h4>
<p>Má»™t trong nhá»¯ng lÃ½ do dÃ¹ng <code>loop</code> lÃ  Ä‘á»ƒ thá»±c thi láº¡i má»™t tÃ¡c vá»¥ nÃ o Ä‘Ã³ báº¡n biáº¿t
cÃ³ thá»ƒ sáº½ tháº¥t báº¡i, kiá»ƒu nhÆ° khi kiá»ƒm tra xem má»™t thread Ä‘Ã£ hoÃ n thÃ nh cÃ´ng viá»‡c
hay chÆ°a. Báº¡n cÅ©ng cáº§n tráº£ vá» káº¿t quáº£ cá»§a tÃ¡c vá»¥ Ä‘Ã³ cho pháº§n cÃ²n láº¡i cá»§a chÆ°Æ¡ng
trÃ¬nh khi káº¿t thÃºc vÃ²ng láº·p. Äá»ƒ lÃ m Ä‘iá»ƒu nÃ y báº¡n cÃ³ thá»ƒ thÃªm giÃ¡ trá»‹ muá»‘n tráº£ vá»
sau phÃ¡t biá»ƒu <code>break</code> mÃ  báº¡n dÃ¹ng Ä‘á»ƒ káº¿t thÃºc vÃ²ng láº·p; giÃ¡ trá»‹ Ä‘Ã³ sáº½ Ä‘Æ°á»£c tráº£
vá» ra ngoÃ i vÃ²ng láº·p vÃ  báº¡n cÃ³ thá»ƒ dÃ¹ng Ä‘Æ°á»£c nÃ³ nhÆ° trong vÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y:</p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let mut counter = 0;

    let result = loop {
        counter += 1;

        if counter == 10 {
            break counter * 2;
        }
    };

    println!("The result is {result}");
}</code></pre></pre>
<p>TrÆ°á»›c khi láº·p, báº¡n khai bÃ¡o má»™t biáº¿n tÃªn <code>counter</code> vÃ  khá»Ÿi táº¡o giÃ¡ trá»‹ cá»§a nÃ³ lÃ 
<code>0</code>. Sau Ä‘Ã³ báº¡n khai bÃ¡o tiáº¿p má»™t biáº¿n tÃªn lÃ  <code>result</code> Ä‘á»ƒ lÆ°u láº¡i giÃ¡ trá»‹ tráº£ vá»
tá»« vÃ²ng láº·p. Cá»© má»—i láº§n láº·p ta láº¡i cá»™ng thÃªm <code>1</code> vÃ o biáº¿n <code>counter</code> vÃ  kiá»ƒm tra
giÃ¡ trá»‹ cá»§a <code>counter</code> vá»›i <code>10</code>, khi Ä‘iá»ƒu nÃ y xáº£y ra, ta dÃ¹ng tá»« khÃ³a <code>break</code> vá»›i
giÃ¡ trá»‹ tráº£ vá» lÃ  <code>counter </code>* 2<code>. Sau vÃ²ng láº·p, ta dÃ¹ng má»™t dáº¥u cháº¥m pháº©y Ä‘á»ƒ káº¿t  thÃºc phÃ¡t biá»ƒu gÃ¡n giÃ¡ trá»‹ vÃ o cho </code>result<code>. Cuá»‘i cÃ¹ng, ta in ra giÃ¡ trá»‹ cá»§a </code>result`,
trong trÆ°á»ng há»£p nÃ y sáº½ lÃ  20.</p>
<h4 id="gÃ¡n-nhÃ£n-Ä‘á»ƒ-phÃ¢n-biá»‡t-giá»¯a-cÃ¡c-vÃ²ng-láº·p"><a class="header" href="#gÃ¡n-nhÃ£n-Ä‘á»ƒ-phÃ¢n-biá»‡t-giá»¯a-cÃ¡c-vÃ²ng-láº·p">GÃ¡n nhÃ£n Ä‘á»ƒ phÃ¢n biá»‡t giá»¯a cÃ¡c vÃ²ng láº·p</a></h4>
<p>Náº¿u báº¡n cÃ³ nhiá»u vÃ²ng láº·p lá»“ng nhau, <code>break</code> vÃ  <code>continue</code> Ä‘Æ°á»£c Ã¡p dá»¥ng cho vÃ²ng
láº·p bÃªn trong nháº¥t táº¡i nÆ¡i báº¡n gá»i. Báº¡n cÅ©ng cÃ³ thá»ƒ Ä‘áº·t <em>nhÃ£n</em> cho má»™t vÃ²ng láº·p
Ä‘á»ƒ sau Ä‘Ã³ khi gá»i <code>break</code> hoáº·c <code>continue</code>, ta cÃ³ thá»ƒ chá»‰ ra chÃ­nh xÃ¡c ta muá»‘n
Ã¡p dá»¥ng nhá»¯ng tá»« khÃ³a Ä‘Ã³ cho vÃ²ng láº·p Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n nhÃ£n thay vÃ¬ vÃ²ng láº·p trong cÃ¹ng.
CÃ¡c nhÃ£n vÃ²ng láº·p pháº£i báº¯t Ä‘áº§u vá»›i má»™t dáº¥u nhÃ¡y Ä‘Æ¡n. Sau Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ vá» hai
vÃ²ng láº·p lá»“ng nhau:</p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let mut count = 0;
    'counting_up: loop {
        println!("count = {count}");
        let mut remaining = 10;

        loop {
            println!("remaining = {remaining}");
            if remaining == 9 {
                break;
            }
            if count == 2 {
                break 'counting_up;
            }
            remaining -= 1;
        }

        count += 1;
    }
    println!("End count = {count}");
}</code></pre></pre>
<p>VÃ²ng láº·p bÃªn ngoÃ i cÃ³ nhÃ£n <code>'counting_up</code>, vÃ  nÃ³ sáº½ Ä‘áº¿m tá»« 0 Ä‘áº¿n 2. VÃ²ng láº·p bÃªn trong
khÃ´ng cÃ³ nhÃ£n vÃ  Ä‘áº¿m ngÆ°á»£c tá»« 10 xuá»‘ng 9. PhÃ¡t biá»ƒu <code>break</code> Ä‘áº§u tiÃªn khÃ´ng chá»‰ ra nhÃ£n
nÃªn chá»‰ thoÃ¡t ra khá»i vÃ²ng láº·p bÃªn trong. Trong khi Ä‘Ã³, phÃ¡t biá»ƒu <code>break 'counting_up;</code>
sáº½ thoÃ¡t ra vÃ²ng láº·p bÃªn ngoÃ i. Äoáº¡n code nÃ y sáº½ in ra:</p>
<pre><code class="language-console">$ cargo run
   Compiling loops v0.1.0 (file:///projects/loops)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.58s
     Running `target/debug/loops`
count = 0
remaining = 10
remaining = 9
count = 1
remaining = 10
remaining = 9
count = 2
remaining = 10
End count = 2
</code></pre>
<h4 id="láº·p-theo-Ä‘iá»u-kiá»‡n-vá»›i-while"><a class="header" href="#láº·p-theo-Ä‘iá»u-kiá»‡n-vá»›i-while">Láº·p theo Ä‘iá»u kiá»‡n vá»›i <code>while</code></a></h4>
<p>Má»™t chÆ°Æ¡ng trÃ¬nh sáº½ thÆ°á»ng pháº£i kiá»ƒm tra Ä‘iá»u kiá»‡n bÃªn trong má»™t vÃ²ng láº·p. Khi Ä‘iá»u
kiá»‡n lÃ  true, tiáº¿p tá»¥c vÃ²ng láº·p. Khi Ä‘iá»u kiá»‡n khÃ´ng cÃ²n lÃ  <code>true</code>, chÆ°Æ¡ng trÃ¬nh sáº½
gá»i <code>break</code> vÃ  ngÆ°ng vÃ²ng láº·p. Báº¡n hoÃ n toÃ n cÃ³ thá»ƒ lÃ m nhá»¯ng Ä‘iá»u trÃªn báº±ng viá»‡c
káº¿t há»£p <code>loop</code>, <code>if</code>, <code>else</code> vÃ  <code>break</code>; báº¡n cÃ³ thá»ƒ thá»­ ngay náº¿u muá»‘n. Tuy nhiÃªn,
cáº¥u trÃºc nÃ y ráº¥t phá»• biáº¿n, do váº­y Rust táº¡o ra má»™t cáº¥u trÃºc láº·p riÃªng cho nÃ³, gá»i
vÃ²ng láº·p <code>while</code>. Trong Listing 3-3, chÃºng ta sáº½ dÃ¹ng <code>while</code> Ä‘á»ƒ láº·p chÆ°Æ¡ng trÃ¬nh
3 láº§n, Ä‘áº¿m ngÆ°á»£c má»—i láº§n láº·p, in ra má»™t thÃ´ng bÃ¡o vÃ  káº¿t thÃºc sau khi hoÃ n thÃ nh
vÃ²ng láº·p.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let mut number = 3;

    while number != 0 {
        println!("{number}!");

        number -= 1;
    }

    println!("LIFTOFF!!!");
}</code></pre></pre>
<p><span class="caption">Listing 3-3: DÃ¹ng má»™t vÃ²ng láº·p <code>while</code> Ä‘á»ƒ cháº¡y code trong khi má»™t
Ä‘iá»u kiá»‡n váº«n cÃ²n Ä‘Ãºng</span></p>
<p>VÃ²ng láº·p nÃ y cho phÃ©p loáº¡i bá» nhiá»u cáº¥u trÃºc lá»“ng nhau nhÆ° khi báº¡n káº¿t há»£p
<code>loop</code>, <code>if</code>, <code>else</code>, vÃ  <code>break</code>, giÃºp code cá»§a báº¡n sÃ¡ng sá»§a hÆ¡n. Trong khi má»™t
Ä‘iá»u kiá»‡n váº«n lÃ  <code>true</code>, cháº¡y vÃ²ng láº·p; ngÆ°á»£c láº¡i, káº¿t thÃºc vÃ²ng láº·p.</p>
<p><a id="looping-through-a-collection-with-for"></a></p>
<h4 id="láº·p-qua-má»™t-táº­p-há»£p-vá»›i-for"><a class="header" href="#láº·p-qua-má»™t-táº­p-há»£p-vá»›i-for">Láº·p qua má»™t táº­p há»£p vá»›i <code>for</code></a></h4>
<p>Báº¡n cÃ³ thá»ƒ chá»n dÃ¹ng <code>while</code> Ä‘á»ƒ duyá»‡t qua cÃ¡c thÃ nh pháº§n cá»§a má»™t táº­p há»£p, kiá»ƒu
nhÆ° má»™t máº£ng. VÃ­ dá»¥, vÃ²ng láº·p trong Listing 3-4 in ra cÃ¡c pháº§n tá»­ cÃ³ trong máº£ng
<code>a</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let a = [10, 20, 30, 40, 50];
    let mut index = 0;

    while index &lt; 5 {
        println!("the value is: {}", a[index]);

        index += 1;
    }
}</code></pre></pre>
<p><span class="caption">Listing 3-4: Láº·p qua tá»«ng pháº§n tá»­ trong má»™t táº­p há»£p sá»­ dá»¥ng
vÃ²ng láº·p <code>while</code></span></p>
<p>á» Ä‘Ã¢y, Ä‘oáº¡n code Ä‘áº¿m qua cÃ¡c pháº§n tá»­ cÃ³ trong máº£ng. NÃ³ báº¯t Ä‘áº§u tá»« chá»‰ sá»‘ <code>0</code>, vÃ 
tiáº¿p tá»¥c láº·p cho Ä‘áº¿n khi gáº·p chá»‰ sá»‘ cuá»‘i cÃ¹ng cá»§a máº£ng (lÃ  khi <code>index &lt; 5</code> khÃ´ng
cÃ²n tráº£ vá» true). Cháº¡y Ä‘oáº¡n code nÃ y sáº½ in ra táº¥t cáº£ cÃ¡c pháº§n tá»­ trong máº£ng:</p>
<pre><code class="language-console">$ cargo run
   Compiling loops v0.1.0 (file:///projects/loops)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.32s
     Running `target/debug/loops`
the value is: 10
the value is: 20
the value is: 30
the value is: 40
the value is: 50
</code></pre>
<p>Táº¥t cáº£ nÄƒm giÃ¡ trá»‹ trong máº£ng Ä‘á»u Ä‘Æ°á»£c xuáº¥t ra cá»­a sá»• cháº¡y chÆ°Æ¡ng trÃ¬nh. Máº·c dÃ¹
<code>index</code> sáº½ Ä‘áº¡t giÃ¡ trá»‹ <code>5</code> vÃ o má»™t thá»i Ä‘iá»ƒm nÃ o Ä‘Ã³, vÃ²ng láº·p sáº½ ngá»«ng thá»±c thi
trÆ°á»›c khi cá»‘ láº¥y giÃ¡ trá»‹ thá»© sÃ¡u (khÃ´ng tá»“n táº¡i) tá»« máº£ng.</p>
<p>Tuy nhiÃªn, cÃ¡c tiáº¿p cáº­n nÃ y áº©n chá»©a lá»—i; chÃºng ta cÃ³ thá»ƒ lÃ m chÆ°Æ¡ng trÃ¬nh vá» tráº¡ng
thÃ¡i panic náº¿u giÃ¡ trá»‹ chá»‰ sá»‘ hay Ä‘iá»u kiá»‡n láº·p khÃ´ng chÃ­nh xÃ¡c. VÃ­ dá»¥, náº¿u báº¡n
thay Ä‘á»•i Ä‘á»‹nh nghÄ©a máº£ng <code>a</code> thÃ nh má»™t máº£ng chá»‰ cÃ³ bá»‘n pháº§n tá»­ nhÆ°ng láº¡i quÃªn thay
Ä‘á»•i Ä‘iá»u kiá»‡n thÃ nh <code>while index &lt; 4</code>, Ä‘oáº¡n code sáº½ bá»‹ lá»—i. VÃ  nÃ³ cÅ©ng cháº¡y cháº­m
bá»Ÿi trÃ¬nh dá»‹ch pháº£i thÃªm code Ä‘á»ƒ kiá»ƒm tra má»—i láº§n láº·p xem chá»‰ sá»‘ cÃ³ náº±m trong
pháº¡m vi há»£p lá»‡ hay khÃ´ng.</p>
<p>NhÆ° má»™t cÃ¡ch tiáº¿p cáº­n chÃ­nh xÃ¡c hÆ¡n, báº¡n cÃ³ thá»ƒ dÃ¹ng má»™t vÃ²ng <code>for</code> vÃ  thá»±c thi
code cho má»—i pháº§n tá»­ trong táº­p há»£p. Má»™t vÃ²ng láº·p <code>for</code> sáº½ trÃ´ng nhÆ° Ä‘oáº¡n code
trong Listing 3-5.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let a = [10, 20, 30, 40, 50];

    for element in a {
        println!("the value is: {element}");
    }
}</code></pre></pre>
<p><span class="caption">Listing 3-5: Looping through each element of a collection
using a <code>for</code> loop</span></p>
<p>Khi cháº¡y Ä‘oáº¡n code nÃ y, báº¡n sáº½ tháº¥y cÃ¹ng káº¿t xuáº¥t nhÆ° trong Listing 3-4. Quan trá»ng
hÆ¡n, giá» Ä‘á»™ an toÃ n cá»§a code cao hÆ¡n vÃ  loáº¡i bá» cÆ¡ há»™i phÃ¡t sinh bug khi cá»‘ truy
cáº­p má»™t pháº§n tá»­ vÆ°á»£t ra ngoÃ i pháº¡m vi cá»§a máº£ng.</p>
<p>Sá»­ dá»¥ng vÃ²ng <code>for</code>, báº¡n cÅ©ng khÃ´ng cáº§n pháº£i nhá»› thay Ä‘á»•i cÃ¡c Ä‘oáº¡n code khÃ¡c náº¿u báº¡n thay
Ä‘á»•i sá»‘ giÃ¡ trá»‹ cÃ³ trong máº£ng, nhÆ° cÃ¡ch báº¡n cáº§n lÃ m náº¿u sá»­ dá»¥ng cÃ¡ch thá»©c trong
Listing 3-4.</p>
<p>Sá»± an toÃ n vÃ  chÃ­nh xÃ¡c cá»§a cÃ¡c vÃ²ng <code>for</code> lÃ m cho chÃºng trá»Ÿ thÃ nh cáº¥u trÃºc láº·p
phá»• biáº¿n nháº¥t trong Rust. Ngay cáº£ khi báº¡n muá»‘n cháº¡y má»™t sá»‘ code má»™t sá»‘ láº§n nháº¥t
Ä‘á»‹nh, giá»‘ng trong vÃ­ dá»¥ Ä‘áº¿m ngÆ°á»£c mÃ  chÃºng ta dÃ¹ng vÃ²ng láº·p <code>while</code>trong Listing 3-3,
háº§u háº¿t Rustaceans sáº½ chá»n dÃ¹ng <code>for</code>. Äá»ƒ lÃ m Ä‘iá»u nÃ y ta cÃ³ thá»ƒ dÃ¹ng má»™t <code>Range</code>,
vá»‘n Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n chuáº©n, vÃ  sáº½ táº¡o ra táº¥t cáº£ cÃ¡c con sá»‘ tuáº§n tá»± báº¯t
Ä‘áº§u tá»« má»™t giÃ¡ trá»‹ vÃ  káº¿t thÃºc trÆ°á»›c má»™t giÃ¡ trá»‹ khÃ¡c.</p>
<p>ÄÃ¢y lÃ  vÃ­ dá»¥ countdown Ä‘Æ°á»£c viáº¿t láº¡i dÃ¹ng vÃ²ng <code>for</code> vÃ  má»™t phÆ°Æ¡ng thá»©c khÃ¡c ta chÆ°a
nháº¯c Ä‘áº¿n, <code>rev</code>, Ä‘á»ƒ Ä‘áº£o ngÆ°á»£c <code>Range</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    for number in (1..4).rev() {
        println!("{number}!");
    }
    println!("LIFTOFF!!!");
}</code></pre></pre>
<p>Äoáº¡n code nÃ y trÃ´ng rÃµ rÃ ng sÃ¡ng sá»§a hÆ¡n pháº£i khÃ´ng?</p>
<h2 id="tá»•ng-káº¿t-1"><a class="header" href="#tá»•ng-káº¿t-1">Tá»•ng káº¿t</a></h2>
<p>Báº¡n Ä‘Ã£ lÃ m Ä‘Æ°á»£c! ÄÃ¢y tháº­t lÃ  má»™t chÆ°Æ¡ng vá»›i ráº¥t nhiá»u thÃ´ng tin: báº¡n há»c vá» biáº¿n,
cÃ¡c kiá»ƒu dá»¯ liá»‡u vÃ´ hÆ°á»›ng vÃ  káº¿t há»£p, hÃ m, ghi chÃº, phÃ¡t biá»ƒu <code>if</code>, vÃ  cáº£ cÃ¡c
vÃ²ng láº·p! Äá»ƒ thá»±c hÃ nh vá»›i cÃ¡c khÃ¡i niá»‡m Ä‘Æ°á»£c giá»›i thiá»‡u trong chÆ°Æ¡ng nÃ y, hÃ£y thá»­
viáº¿t má»™t chÆ°Æ¡ng trÃ¬nh lÃ m nhá»¯ng viá»‡c sau:</p>
<ul>
<li>Chuyá»ƒn Ä‘á»•i nhiá»‡t Ä‘á»™ giá»¯a cÃ¡c há»‡ Fahrenheit vÃ  Celsius.</li>
<li>Táº¡o sá»‘ Fibonacci thá»© <em>n</em>.</li>
<li>In ra lá»i bÃ i hÃ¡t â€œThe Twelve Days of Christmasâ€, á»©ng dá»¥ng cÃ¡c vÃ²ng láº·p Ä‘á»ƒ in ra nhá»¯ng Ä‘oáº¡n láº·p láº¡i trong bÃ i hÃ¡t.</li>
</ul>
<p>Khi báº¡n Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ tiáº¿p tá»¥c, chÃºng ta sáº½ nÃ³i vá» má»™t khÃ¡i niá»‡m <em>khÃ´ng</em> tá»“n táº¡i
trong háº§u háº¿t cÃ¡c ngÃ´n ngá»¯ khÃ¡c: ownership.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tÃ¬m-hiá»ƒu-vá»-ownership-tÃ­nh-sá»Ÿ-há»¯u"><a class="header" href="#tÃ¬m-hiá»ƒu-vá»-ownership-tÃ­nh-sá»Ÿ-há»¯u">TÃ¬m hiá»ƒu vá» Ownership (tÃ­nh sá»Ÿ há»¯u)</a></h1>
<p>Ownership lÃ  tÃ­nh nÄƒng Ä‘á»™c Ä‘Ã¡o nháº¥t cÃ³ trong Rust vÃ  cÃ³ áº£nh hÆ°á»Ÿng sÃ¢u rá»™ng Ä‘áº¿n
nhá»¯ng pháº§n khÃ¡c cá»§a ngÃ´n ngá»¯. NÃ³ cho phÃ©p Rust Ä‘áº£m báº£o an toÃ n khi truy cáº­p vÃ o
bá»™ nhá»› mÃ  khÃ´ng cáº§n Ä‘áº¿n trÃ¬nh dá»n rÃ¡c, do váº­y viá»‡c hiá»ƒu rÃµ vá» ownership lÃ  ráº¥t
quan trá»ng. Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ nÃ³i vá» ownership cÅ©ng nhÆ° má»™t vÃ i Ä‘áº·c
tÃ­nh liÃªn quan: borrowing, slide, vÃ  cÃ¡ch Rust sáº¯p xáº¿p dá»¯ liá»‡u trong bá»™ nhá»›.</p>
<div style="break-before: page; page-break-before: always;"></div><p><a id="the-stack-and-the-heap"></a></p>
<h2 id="ownership-tÃ­nh-sá»Ÿ-há»¯u-lÃ -gÃ¬"><a class="header" href="#ownership-tÃ­nh-sá»Ÿ-há»¯u-lÃ -gÃ¬">Ownership (tÃ­nh sá»Ÿ há»¯u) lÃ  gÃ¬?</a></h2>
<p><em>Ownership</em> lÃ  má»™t táº­p cÃ¡c quy táº¯c phá»‘i há»£p vá»›i nhau, Ä‘á»‹nh hÃ¬nh cÃ¡ch Rust quáº£n lÃ½
bá»™ nhá»›. Táº¥t cáº£ cÃ¡c chÆ°Æ¡ng trÃ¬nh Ä‘á»u pháº£i quáº£n lÃ½ cÃ¡ch chÃºng sá»­ dá»¥ng bá»™ nhá»› mÃ¡y
tÃ­nh khi cháº¡y. Má»™t sá»‘ ngÃ´n ngá»¯ cÃ³ bá»™ dá»n rÃ¡c cháº¡y Ä‘á»‹nh ká»³ Ä‘á»ƒ giáº£i phÃ³ng cÃ¡c pháº§n
bá»™ nhá»› khÃ´ng cÃ²n Ä‘Æ°á»£c dÃ¹ng tá»›i; trong cÃ¡c ngÃ´n ngá»¯ khÃ¡c, chÆ°Æ¡ng trÃ¬nh pháº£i xin
cáº¥p phÃ¡t hoáº·c giáº£i phÃ³ng bá»™ nhá»› má»™t cÃ¡ch cá»¥ thá»ƒ. Rust dÃ¹ng cÃ¡ch tiáº¿p cáº­n thá»© ba:
bá»™ nhá»› Ä‘Æ°á»£c quáº£n lÃ½ thÃ´ng qua má»™t há»‡ thá»‘ng sá»Ÿ há»¯u vá»›i má»™t táº­p cÃ¡c quy táº¯c sáº½ Ä‘Æ°á»£c
kiá»ƒm tra bá»Ÿi trÃ¬nh biÃªn dá»‹ch. Náº¿u báº¥t ká»³ quy táº¯c nÃ o bá»‹ vi pháº¡m, chÆ°Æ¡ng trÃ¬nh sáº½
khÃ´ng Ä‘Æ°á»£c dá»‹ch. KhÃ´ng cÃ³ báº¥t ká»³ tÃ­nh nÄƒng nÃ o cá»§a ownership lÃ m cháº­m chÆ°Æ¡ng trÃ¬nh
cá»§a báº¡n khi cháº¡y.</p>
<p>VÃ¬ ownership lÃ  má»™t khÃ¡i niá»‡m má»›i vá»›i nhiá»u láº­p trÃ¬nh viÃªn, nÃ³ sáº½ máº¥t má»™t thá»i
gian Ä‘á»ƒ lÃ m quen. Tin tá»‘t lÃ  cÃ ng cÃ³ nhiá»u kinh nghiá»‡m vá»›i Rust vÃ  cÃ¡c quy táº¯c
cá»§a há»‡ thá»‘ng ownership, báº¡n cÃ ng tháº¥y viá»‡c láº­p trÃ¬nh cÃ¡c code an toÃ n vÃ  hiá»‡u quáº£
dá»… dÃ ng hÆ¡n. Váº­y nÃªn hÃ£y cá»‘ lÃªn!</p>
<p>Khi Ä‘Ã£ hiá»ƒu ownership, báº¡n sáº½ cÃ³ má»™t ná»n táº£ng cháº¯c cháº¯n Ä‘á»ƒ hiá»ƒu cÃ¡c tÃ­nh nÄƒng
vá»‘n lÃ m cho Rust trá»Ÿ nÃªn Ä‘á»™c nháº¥t. Trong chÆ°Æ¡ng nÃ y báº¡n sáº½ há»c vá» ownership
thÃ´ng qua má»™t sá»‘ vÃ­ dá»¥ táº­p trung vÃ o má»™t cáº¥u trÃºc dá»¯ liá»‡u ráº¥t phá»• biáº¿n: string.</p>
<section class="note" aria-role="note">
<h3 id="stack-vÃ -heap"><a class="header" href="#stack-vÃ -heap">Stack vÃ  Heap</a></h3>
<p>Nhiá»u ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ´ng yÃªu cáº§u báº¡n pháº£i nghÄ© vá» stack vÃ  heap thÆ°á»ng
xuyÃªn. NhÆ°ng vá»›i má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh há»‡ thá»‘ng nhÆ° Rust, viá»‡c má»™t giÃ¡ trá»‹ sáº½
Ä‘Æ°á»£c lÆ°u trÃªn stack hay trÃªn heap áº£nh hÆ°á»Ÿng tá»›i cÃ¡ch ngÃ´n ngá»¯ xá»­ lÃ½ cÅ©ng nhÆ°
lÃ½ do báº¡n quyáº¿t Ä‘á»‹nh. CÃ¡c pháº§n cá»§a ownership sáº½ Ä‘Æ°á»£c mÃ´ táº£ trong má»‘i quan há»‡
vá»›i stack vÃ  heap á»Ÿ pháº§n sau cá»§a chÆ°Æ¡ng nÃ y, á»Ÿ Ä‘Ã¢y chá»‰ lÃ  má»™t giáº£i thÃ­ch
ngáº¯n gá»n Ä‘á»ƒ chuáº©n bá»‹.</p>
<p>Cáº£ hai stack vÃ  heap Ä‘á»u lÃ  cÃ¡c pháº§n cá»§a bá»™ nhá»› mÃ  chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n cÃ³ thá»ƒ
sá»­ dá»¥ng khi cháº¡y, nhÆ°ng chÃºng Ä‘Æ°á»£c tá»• chá»©c theo nhá»¯ng cÃ¡ch khÃ¡c nhau. Stack lÆ°u
trá»¯ cÃ¡c giÃ¡ trá»‹ theo thá»© tá»± báº¡n Ä‘Æ°a vÃ o vÃ  láº¥y cÃ¡c giÃ¡ trá»‹ ra theo thá»© tá»± ngÆ°á»£c
láº¡i. Ta thÆ°á»ng gá»i lÃ  <em>last in, first out</em>. HÃ£y tÆ°á»Ÿng tÆ°á»£ng má»™t chá»“ng Ä‘Ä©a: khi
báº¡n thÃªm Ä‘Ä©a, báº¡n sáº½ Ä‘áº·t chÃºng lÃªn trÃªn cÃ¹ng, vÃ  khi cáº§n láº¥y má»™t cÃ¡i Ä‘Ä©a, báº¡n
sáº½ láº¥y cÃ¡i trÃªn nháº¥t. Báº¡n sáº½ khÃ´ng bá» vÃ o hoáº·c láº¥y ra cÃ¡c Ä‘Ä©a á»Ÿ giá»¯a hay bÃªn
dÆ°á»›i cÃ¹ng. ThÃªm dá»¯ liá»‡u vÃ o Ä‘Æ°á»£c gá»i lÃ  <em>Ä‘áº©y (push)</em> vÃ  stack, vÃ  thao tÃ¡c
láº¥y ra Ä‘Æ°á»£c gá»i lÃ  <em>láº¥y ra khá»i stack (pop)</em>. Táº¥t cáº£ dá»¯ liá»‡u lÆ°u trÃªn stack
pháº£i cÃ³ má»™t kiá»ƒu dá»¯ liá»‡u cÃ³ kÃ­ch thÆ°á»›c cá»‘ Ä‘á»‹nh cho trÆ°á»›c. Dá»¯ liá»‡u cÃ³ kÃ­ch thÆ°á»›c
khÃ´ng thá»ƒ biáº¿t trÆ°á»›c khi biÃªn dá»‹ch hoáº·c cÃ³ thá»ƒ thay Ä‘á»•i pháº£i Ä‘Æ°á»£c lÆ°u trÃªn heap.</p>
<p>Heap Ä‘Æ°á»£c tá»• chá»©c Ã­t quy cá»§ hÆ¡n: khi báº¡n Ä‘Æ°a dá»¯ liá»‡u lÃªn heap, báº¡n yÃªu cáº§u má»™t
khÃ´ng gian trá»‘ng cÃ³ kÃ­ch thÆ°á»›c cá»¥ thá»ƒ. Bá»™ phÃ¢n phá»‘i bá»™ nhá»› sáº½ tÃ¬m má»™t pháº§n trá»‘ng
trÃªn heap Ä‘á»§ lá»›n Ä‘á»ƒ chá»©a, Ä‘Ã¡nh dáº¥u nÃ³ Ä‘Ã£ Ä‘Æ°á»£c dÃ¹ng, vÃ  tráº£ vá» má»™t <em>con trá» (pointer)</em>,
chá»©a Ä‘á»‹a chá»‰ cá»§a vá»‹ trÃ­ pháº§n bá»™ nhá»› vá»«a Ä‘Æ°á»£c cáº¥p phÃ¡t. QuÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c gá»i
lÃ  <em>phÃ¢n phá»‘i bá»™ nhá»› trÃªn heap</em> vÃ  Ä‘Ã´i khi Ä‘Æ°á»£c gá»i ngáº¯n gá»n lÃ  <em>phÃ¢n phá»‘i bá»™ nhá»›</em>
(Ä‘áº©y má»™t giÃ¡ trá»‹ vÃ o stack khÃ´ng Ä‘Æ°á»£c coi lÃ  phÃ¢n phá»‘i bá»™ nhá»›). VÃ¬ con trá» chá»©a
Ä‘á»‹a chá»‰ vÃ¹ng nhá»› cÃ³ kÃ­ch thÆ°á»›c cá»‘ Ä‘á»‹nh vÃ  biáº¿t trÆ°á»›c, nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c lÆ°u trong
stack, nhÆ°ng khi báº¡n cáº§n láº¥y dá»¯ liá»‡u thá»±c sá»±, báº¡n sáº½ cáº§n Ä‘i theo Ä‘á»‹a chá»‰ chá»©a
trong con trá». HÃ£y tÆ°á»Ÿng tÆ°á»£ng khi Ä‘áº¿n má»™t nhÃ  hÃ ng, báº¡n cho nhÃ¢n viÃªn biáº¿t
sá»‘ ngÆ°á»i trong nhÃ³m, há» sáº½ tÃ¬m má»™t bÃ n trá»‘ng Ä‘á»§ cho nhÃ³m cá»§a báº¡n vÃ  dáº«n báº¡n Ä‘áº¿n
Ä‘Ã³. Náº¿u má»™t ngÆ°á»i trong nhÃ³m Ä‘áº¿n muá»™n, há» cÃ³ thá»ƒ há»i nÆ¡i báº¡n ngá»“i Ä‘á»ƒ tÃ¬m báº¡n.</p>
<p>Äáº©y má»™t giÃ¡ trá»‹ vÃ o stack nhanh hÆ¡n phÃ¢n phá»‘i trÃªn heap vÃ¬ trÃ¬nh quáº£n lÃ½ khÃ´ng
cáº§n tÃ¬m má»™t nÆ¡i Ä‘á»ƒ lÆ°u dá»¯ liá»‡u; vá»‹ trÃ­ Ä‘Ã³ luÃ´n náº±m trÃªn Ä‘á»‰nh cá»§a stack. Trong khi
Ä‘Ã³, phÃ¢n phá»‘i bá»™ nhá»› trÃªn heap cáº§n nhiá»u thao tÃ¡c hÆ¡n vÃ¬ trÃ¬nh quáº£n lÃ½ Ä‘áº§u tiÃªn
pháº£i tÃ¬m má»™t khÃ´ng gian trá»‘ng Ä‘á»§ lá»›n Ä‘á»ƒ chá»©a dá»¯ liá»‡u, sau Ä‘Ã³ lÃ m cÃ¡c thao tÃ¡c Ä‘á»ƒ
Ä‘Ã¡nh dáº¥u viá»‡c sá»­ dá»¥ng khÃ´ng gian nhá»› Ä‘Ã³.</p>
<p>Truy cáº­p dá»¯ liá»‡u trÃªn heap cÅ©ng cháº­m hÆ¡n trong stack vÃ¬ báº¡n pháº£i theo má»™t con trá» Ä‘á»ƒ
Ä‘áº¿n Ä‘Ãºng nÆ¡i. CÃ¡c bá»™ xá»­ lÃ½ hiá»‡n nay sáº½ hoáº¡t Ä‘á»™ng nhanh hÆ¡n náº¿u chÃºng khÃ´ng pháº£i
truy cáº­p bá»™ nhá»› nhiá»u. Tiáº¿p tá»¥c vá»›i vÃ­ dá»¥ á»Ÿ trÃªn, hÃ£y tÆ°á»Ÿng tÆ°á»£ng má»™t ngÆ°á»i phá»¥c
vá»¥ á»Ÿ nhÃ  hÃ ng pháº£i nháº­n Ä‘áº·t mÃ³n tá»« nhiá»u bÃ n khÃ¡c nhau. CÃ¡ch lÃ m hiá»‡u quáº£ nháº¥t lÃ 
nháº­n táº¥t cáº£ yÃªu cáº§u Ä‘áº·t mÃ³n tá»« má»™t bÃ n trÆ°á»›c khi di chuyá»ƒn Ä‘áº¿n bÃ n tiáº¿p theo. Nháº­n
mÃ³n tá»« bÃ n A, rá»“i sang bÃ n B, sau Ä‘Ã³ quay láº¡i bÃ n A, rá»“i tiáº¿p tá»¥c quay láº¡i bÃ n B
cÃ³ láº½ sáº½ cháº­m hÆ¡n nhiá»u. Theo cÃ¹ng cÃ¡ch, má»™t bá»™ xá»­ lÃ½ cÃ³ thá»ƒ hoÃ n thÃ nh cÃ´ng viá»‡c
tá»‘t hÆ¡n náº¿u nÃ³ lÃ m viá»‡c vá»›i cÃ¡c dá»¯ liá»‡u náº±m gáº§n nhau (giá»‘ng nhÆ° trong stack) hÆ¡n
lÃ  khi chÃºng náº±m xa nhau (nhÆ° vá»›i heap).</p>
<p>Khi code cá»§a báº¡n gá»i má»™t hÃ m, cÃ¡c giÃ¡ trá»‹ truyá»n vÃ o cho hÃ m Ä‘Ã³ (cÃ³ thá»ƒ bao gá»“m
cáº£ cÃ¡c con trá» lÃªn heap) vÃ  cÃ¡c biáº¿n cá»¥c bá»™ cá»§a hÃ m Ä‘á»u Ä‘Æ°á»£c Ä‘áº©y vÃ o stack. Khi
hÃ m káº¿t thÃºc, cÃ¡c giÃ¡ trá»‹ Ä‘Ã³ sáº½ Ä‘Æ°á»£c láº¥y ra khá»i stack.</p>
<p>Theo dÃµi pháº§n code nÃ o code Ä‘ang dÃ¹ng nhá»¯ng pháº§n nÃ o cá»§a heap, tá»‘i thiá»ƒu hÃ³a viá»‡c
trÃ¹ng láº¯p dá»¯ liá»‡u, vÃ  dá»n dáº¹p nhá»¯ng dá»¯ liá»‡u nÃ o khÃ´ng Ä‘Æ°á»£c dÃ¹ng tá»›i trÃªn heap sao
cho chÃºng ta khÃ´ng cáº¡n kiá»‡t cÃ¡c tÃ i nguyÃªn bá»™ nhá»› lÃ  nhá»¯ng váº¥n Ä‘á» mÃ  ownership
nháº¯m Ä‘áº¿n. Má»™t khi Ä‘Ã£ hiá»ƒu vá» ownership, báº¡n sáº½ khÃ´ng cáº§n nghÄ© vá» stack vÃ  heap thÆ°á»ng
xuyÃªn ná»¯a, nhÆ°ng biáº¿t má»¥c Ä‘Ã­ch chÃ­nh cá»§a ownership lÃ  Ä‘á»ƒ quáº£n lÃ½ bá»™ nhá»› heap cÃ³ thá»ƒ
giÃºp giáº£i thÃ­ch vÃ¬ sao nÃ³ lÃ m viá»‡c theo cÃ¡ch mÃ  báº¡n sáº½ tháº¥y.</p>
</section>
<h3 id="cÃ¡c-quy-táº¯c-cá»§a-ownership"><a class="header" href="#cÃ¡c-quy-táº¯c-cá»§a-ownership">CÃ¡c quy táº¯c cá»§a Ownership</a></h3>
<p>Äáº§u tiÃªn, hÃ£y xem qua cÃ¡c quy táº¯c cá»§a ownership. HÃ£y ghi nhá»› cÃ¡c quy táº¯c nÃ y khi
ta Ä‘i qua cÃ¡c vÃ­ Ä‘á»¥ minh há»a:</p>
<ul>
<li>Má»—i giÃ¡ trá»‹ trong Rust cÃ³ má»™t chá»§ sá»Ÿ há»¯u (<em>owner</em>)</li>
<li>Má»—i thá»i Ä‘iá»ƒm chá»‰ cÃ³ duy nháº¥t má»™t owner.</li>
<li>Khi owner ra khá»i pháº¡m vi (scope, táº§m vá»±c cá»§a biáº¿n) cá»§a nÃ³, giÃ¡ trá»‹ sáº½ bá»‹ há»§y.</li>
</ul>
<h3 id="táº§m-vá»±c-cá»§a-biáº¿n"><a class="header" href="#táº§m-vá»±c-cá»§a-biáº¿n">Táº§m vá»±c cá»§a biáº¿n</a></h3>
<p>Giá» ta Ä‘Ã£ hoÃ n thÃ nh cÃº phÃ¡p cÆ¡ báº£n cá»§a Rust, chÃºng ta sáº½ khÃ´ng cáº§n thÃªm <code>fn main() {</code>
vÃ o cÃ¡c vÃ­ dá»¥, do váº­y náº¿u muá»‘n cháº¡y thá»­ hÃ£y tá»± thÃªm chÃºng vÃ o trong hÃ m <code>main</code>. Khi viáº¿t
cÃ¡c vÃ­ dá»¥ theo cÃ¡ch ngáº¯n gá»n nhÆ° váº­y, chÃºng ta cÃ³ thá»ƒ táº­p trung vÃ o chi tiáº¿t muá»‘n
nÃ³i hÆ¡n lÃ  cÃ¡c Ä‘oáº¡n code máº«u.</p>
<p>VÃ­ dá»¥ Ä‘áº§u tiÃªn vá» ownership, chÃºng ta sáº½ xem qua <em>táº§m vá»±c (scope)</em> cá»§a má»™t sá»‘ biáº¿n.
Má»™t táº§m vá»±c lÃ  má»™t Ä‘oáº¡n trong má»™t chÆ°Æ¡ng trÃ¬nh mÃ  trong Ä‘Ã³ má»™t thÃ nh pháº§n nÃ o Ä‘Ã³
lÃ  há»£p lá»‡. HÃ£y xem qua vÃ­ dá»¥ sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s = "hello";
<span class="boring">}</span></code></pre></pre>
<p>Biáº¿n <code>s</code> tham chiáº¿u Ä‘áº¿n má»™t giÃ¡ trá»‹ chuá»—i, giÃ¡ trá»‹ nÃ y Ä‘Æ°á»£c hard code vÃ o trong
pháº§n text cá»§a chÆ°Æ¡ng trÃ¬nh. CÃ¡c biáº¿n lÃ  há»£p lá»‡ táº¡i thá»i Ä‘iá»ƒm chÃºng Ä‘Æ°á»£c khai bÃ¡o
cho Ä‘áº¿n háº¿t <em>táº§m vá»±c</em> hiá»‡n táº¡i. Listing 4-1 trÃ¬nh bÃ y má»™t chÆ°Æ¡ng trÃ¬nh vá»›i cÃ¡c
ghi chÃº chá»‰ ra nÆ¡i biáº¿n <code>s</code> lÃ  há»£p lá»‡.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    {                      // s is not valid here, since it's not yet declared
        let s = "hello";   // s is valid from this point forward

        // do stuff with s
    }                      // this scope is now over, and s is no longer valid
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 4-1: Má»™t biáº¿n vÃ  táº§m vá»±c (pháº¡m vi) cá»§a nÃ³</span></p>
<p>NÃ³i cÃ¡ch khÃ¡c, cÃ³ hai thá»i Ä‘iá»ƒm quan trá»ng á»Ÿ Ä‘Ã¢y:</p>
<ul>
<li>Khi <code>s</code> Ä‘i vÃ o trong táº§m vá»±c, nÃ³ trá»Ÿ nÃªn há»£p lá»‡.</li>
<li><code>s</code> sáº½ váº«n há»£p lá»‡ cho Ä‘áº¿n khi nÃ³ Ä‘i ra khá»i <em>táº§m vá»±c</em>.</li>
</ul>
<p>Táº¡i Ä‘iá»ƒm nÃ y, má»‘i quan há»‡ giá»¯a cÃ¡c táº§m vá»±c vÃ  khi cÃ¡c biáº¿n lÃ  há»£p lá»‡ hoÃ n toÃ n tÆ°Æ¡ng
tá»± trong cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c. Giá» chÃºng ta sáº½ Ã¡p dá»¥ng Ä‘iá»u nÃ y vá»›i kiá»ƒu
dá»¯ liá»‡u <code>String</code> Ä‘á»ƒ tÃ¬m hiá»ƒu sÃ¢u hÆ¡n.</p>
<h3 id="kiá»ƒu-string"><a class="header" href="#kiá»ƒu-string">Kiá»ƒu <code>String</code></a></h3>
<p>Äá»ƒ minh há»a cÃ¡c quy táº¯c cá»§a ownership, chÃºng ta sáº½ cáº§n má»™t kiá»ƒu dá»¯ liá»‡u phá»©c táº¡p
hÆ¡n nhá»¯ng kiá»ƒu Ä‘Ã£ Ä‘Æ°á»£c nÃ³i Ä‘áº¿n trong pháº§n <a href="ch03-02-data-types.html#data-types">â€œCÃ¡c kiá»ƒu dá»¯ liá»‡uâ€</a><!-- ignore -->
á»Ÿ chÆ°Æ¡ng 3. Nhá»¯ng kiá»ƒu Ä‘Æ°á»£c nÃ³i Ä‘áº¿n trong pháº§n Ä‘Ã³ cÃ³ kÃ­ch thÆ°á»›c cá»‘ Ä‘á»‹nh, cÃ³ thá»ƒ
Ä‘Æ°á»£c lÆ°u trong stack vÃ  dá»… dÃ ng láº¥y ra khi Ä‘i ra khá»i pháº¡m vi cá»§a nÃ³, cÅ©ng nhÆ°
cÃ³ thá»ƒ táº¡o má»™t báº£n sao má»›i Ä‘á»™c láº­p vá»›i báº£n gá»‘c náº¿u má»™t pháº§n khÃ¡c cá»§a chÆ°Æ¡ng trÃ¬nh
muá»‘n Ä‘á»c giÃ¡ trá»‹ cá»§a nÃ³. NhÆ°ng chÃºng ta muá»‘n xem cÃ¡ch dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trÃªn heap
vÃ  khÃ¡m phÃ¡ cÃ¡ch Rust biáº¿t khi nÃ o cáº§n giáº£i phÃ³ng dá»¯ liá»‡u Ä‘Ã³, trong trÆ°á»ng há»£p
nÃ y <code>String</code> lÃ  má»™t vÃ­ dá»¥ tuyá»‡t vá»i.</p>
<p>ChÃºng ta sáº½ táº­p trung trÃªn cÃ¡c pháº§n cá»§a <code>String</code> cÃ³ liÃªn quan Ä‘áº¿n tÃ­nh sá»Ÿ há»¯u (ownership).
NhÆ°ng nhá»¯ng pháº§n nÃ y cÅ©ng cÃ³ thá»ƒ Ã¡p dá»¥ng lÃªn cÃ¡c kiá»ƒu dá»¯ liá»‡u phá»©c táº¡p khÃ¡c,
bao gá»“m cáº£ cÃ¡c kiá»ƒu trong thÆ° viá»‡n chuáº©n vÃ  cÃ¡c kiá»ƒu do báº¡n tá»± táº¡o. ChÃºng ta sáº½
nÃ³i sÃ¢u hÆ¡n vá» <code>String</code> trong <a href="ch08-02-strings.html">ChÆ°Æ¡ng 8</a><!-- ignore -->.</p>
<p>ChÃºng ta Ä‘Ã£ xem cÃ¡c giÃ¡ trá»‹ chuá»—i, khi mÃ  cÃ¡c chuá»—i Ä‘Æ°á»£c hard code vÃ o tháº³ng
trong chÆ°Æ¡ng trÃ¬nh. CÃ¡c giÃ¡ trá»‹ chuá»—i ráº¥t cÃ³ Ã­ch, nhÆ°ng chÃºng láº¡i khÃ´ng phÃ¹ há»£p
cho nhiá»u trÆ°á»ng há»£p. Má»™t lÃ½ do lÃ  chÃºng khÃ´ng thá»ƒ thay Ä‘á»•i. Má»™t lÃ½ do khÃ¡c lÃ 
trong nhiá»u trÆ°á»ng há»£p ta khÃ´ng biáº¿t giÃ¡ trá»‹ thá»±c sá»± cá»§a nÃ³ lÃºc viáº¿t code: vÃ­
dá»¥ náº¿u báº¡n muá»‘n nháº­n dá»¯ liá»‡u tá»« ngÆ°á»i dÃ¹ng vÃ  lÆ°u láº¡i? Vá»›i nhá»¯ng trÆ°á»ng há»£p nhÆ°
váº­y, Rust cÃ³ má»™t kiá»ƒu dá»¯ liá»‡u chuá»—i ná»¯a, <code>String</code>. Kiá»ƒu dá»¯ liá»‡u nÃ y quáº£n lÃ½ dá»¯ liá»‡u
Ä‘Æ°á»£c phÃ¢n bá»‘ trÃªn heap vÃ  nÃ³ cÃ³ kháº£ nÄƒng lÆ°u trá»¯ má»™t khá»‘i vÄƒn báº£n ta khÃ´ng biáº¿t
vÃ o thá»i Ä‘iá»ƒm biÃªn dá»‹ch. Báº¡n cÃ³ thá»ƒ táº¡o má»™t <code>String</code> tá»« má»™t giÃ¡ trá»‹ chuá»—i báº±ng cÃ¡ch
dÃ¹ng hÃ m <code>from</code>, giá»‘ng nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s = String::from("hello");
<span class="boring">}</span></code></pre></pre>
<p>Cáº·p dáº¥u hai cháº¥m <code>::</code> cho phÃ©p chÃºng ta Ä‘áº·t cÃ¡c thÃ nh pháº§n trong Rust vÃ o cÃ¡c
namespace khÃ¡c nhau. ChÃºng ta cÃ³ thá»ƒ chá»‰ ra hÃ m <code>from</code> náº±m trong <code>String</code> thay vÃ¬
pháº£i viáº¿t theo kiá»ƒu <code>string_from</code>. ChÃºng ta sáº½ tháº£o luáº­n thÃªm vá» cÃº phÃ¡p nÃ y trong pháº§n
<a href="ch05-03-method-syntax.html#method-syntax">â€œCÃº phÃ¡p cá»§a phÆ°Æ¡ng thá»©câ€</a><!-- ignore --> á»Ÿ chÆ°Æ¡ng 5. VÃ  khi chÃºng
ta nÃ³i vá» namespace vá»›i cÃ¡c module trong <a href="ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html">â€œPaths for Referring to an Item in the
Module Treeâ€</a><!-- ignore --> á»Ÿ chÆ°Æ¡ng 7.</p>
<p>Kiá»ƒu chuá»—i nÃ y <em>cÃ³ thá»ƒ</em> thay Ä‘á»•i.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let mut s = String::from("hello");

    s.push_str(", world!"); // push_str() appends a literal to a String

    println!("{s}"); // this will print `hello, world!`
<span class="boring">}</span></code></pre></pre>
<p>Váº­y sá»± khÃ¡c biá»‡t á»Ÿ Ä‘Ã¢y lÃ  gÃ¬? Táº¡i sao <code>String</code> cÃ³ thá»ƒ thay Ä‘á»•i mÃ  háº±ng chuá»—i thÃ¬
khÃ´ng? Sá»± khÃ¡c nhau náº±m á»Ÿ cÃ¡ch hai loáº¡i nÃ y thao tÃ¡c vá»›i bá»™ nhá»›.</p>
<h3 id="bá»™-nhá»›-vÃ -phÃ¢n-phá»‘i-bá»™-nhá»›"><a class="header" href="#bá»™-nhá»›-vÃ -phÃ¢n-phá»‘i-bá»™-nhá»›">Bá»™ nhá»› vÃ  phÃ¢n phá»‘i bá»™ nhá»›</a></h3>
<p>Trong trÆ°á»ng há»£p cá»§a háº±ng chuá»—i, chÃºng ta biáº¿t ná»™i dung cá»§a nÃ³ vÃ o lÃºc biÃªn dá»‹ch,
so váº­y ná»™i dung vÄƒn báº£n cá»§a nÃ³ sáº½ Ä‘Æ°á»£c biÃªn dá»‹ch tháº³ng vÃ o bÃªn trong file thá»±c thi.
ÄÃ¢y lÃ  lÃ½ do vÃ¬ sao cÃ¡c háº±ng chuá»—i nhanh vÃ  hiá»‡u quáº£. NhÆ°ng nhá»¯ng tÃ­nh cháº¥t Ä‘Ã³ chá»‰
cÃ³ nhá» vÃ o tÃ­nh khÃ´ng-kháº£-biáº¿n (khÃ´ng thá»ƒ thay Ä‘á»•i) cá»§a háº±ng chuá»—i. KhÃ´ng may lÃ ,
báº¡n khÃ´ng thá»ƒ nhÃºng má»™t khá»‘i vÄƒn báº£n vÃ o má»™t file thá»±c thi mÃ  khÃ´ng biáº¿t kÃ­ch thÆ°á»›c
cá»§a nÃ³ vÃ o lÃºc biÃªn dá»‹ch, hoáº·c kÃ­ch thÆ°á»›c Ä‘Ã³ cÃ³ thá»ƒ thay Ä‘á»•i vÃ o lÃºc cháº¡y chÆ°Æ¡ng
trÃ¬nh.</p>
<p>Vá»›i kiá»ƒu <code>String</code>, Ä‘á»ƒ cho phÃ©p thay Ä‘á»•i ná»™i dung, hoáº·c tÄƒng Ä‘á»™ dÃ i cá»§a khá»‘i vÄƒn
báº£n, chÃºng ta cáº§n phÃ¢n phá»‘i cho nÃ³ má»™t pháº§n bá»™ nhá»› trÃªn heap Ä‘á»ƒ lÆ°u trá»¯ ná»™i dung.
Äiá»u nÃ y cÃ³ nghÄ©a lÃ :</p>
<ul>
<li>Pháº§n bá»™ nhá»› nÃ y cáº§n Ä‘Æ°á»£c cáº¥p phÃ¡p bá»Ÿi trÃ¬nh quáº£n lÃ½ bá»™ nhá»› khi cháº¡y chÆ°Æ¡ng trÃ¬nh.</li>
<li>Cáº§n má»™t cÃ¡ch Ä‘á»ƒ tráº£ láº¡i pháº§n bá»™ nhá»› nÃ y khi Ä‘Ã£ lÃ m viá»‡c xong vá»›i chuá»—i
<code>String</code> cá»§a chÃºng ta.</li>
</ul>
<p>Pháº§n thá»© nháº¥t Ä‘Ã£ Ä‘Æ°á»£c hoÃ n thÃ nh khi chÃºng ta gá»i <code>String::from</code>, hÃ m <code>from</code> sáº½
yÃªu cáº§u pháº§n bá»™ nhá»› mÃ  nÃ³ cáº§n. Nhá»¯ng thao tÃ¡o quen thuá»™c nÃ y khÃ¡ phá»• biáº¿n trong
cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh.</p>
<p>Tuy nhiÃªn, pháº§n thá»© hai láº¡i khÃ¡c. Trong cÃ¡c ngÃ´n ngá»¯ cÃ³ <em>bá»™ dá»n rÃ¡c</em> (garbage collector
(GC)), GC sáº½ theo dÃµi vÃ  giáº£i phÃ³ng cÃ¡c pháº§n bá»™ nhá»› khÃ´ng cÃ²n Ä‘Æ°á»£c dÃ¹ng Ä‘áº¿n, vÃ 
ta khÃ´ng cáº§n pháº£i quan tÃ¢m Ä‘áº¿n chÃºng. Trong háº§u háº¿t cÃ¡c ngÃ´n ngá»¯ khÃ´ng cÃ³ GC,
chÃºng ta pháº£i cÃ³ trÃ¡ch nhiá»‡m tá»± quáº£n lÃ½ cÃ¡c vÃ¹ng nhá»› Ä‘á»ƒ biáº¿t chÃºng khi nÃ o khÃ´ng
cÃ²n Ä‘Æ°á»£c dÃ¹ng ná»¯a vÃ  gá»i hÃ m giáº£i phÃ³ng bá»™ nhá»›. CÃ´ng viá»‡c nÃ y vá»‘n Ä‘Ã£ Ä‘Æ°á»£c lá»‹ch sá»­
chá»©ng minh lÃ  ráº¥t khÃ³ Ä‘á»ƒ lÃ m má»™t cÃ¡c Ä‘Ãºng Ä‘áº¯n. Náº¿u ta lá»¡ quÃªn, chÃºng ta sáº½ gÃ¢y lÃ£ng
phÃ­ bá»™ nhá»›. Náº¿u ta lÃ m Ä‘iá»u Ä‘Ã³ quÃ¡ sá»›m, chÃºng ta sáº½ cÃ³ má»™t biáº¿n khÃ´ng há»£p lá»‡. Náº¿u
ta lÃ m Ä‘iá»u Ä‘Ã³ hai láº§n, Ä‘Ã³ cÅ©ng lÃ  lá»—i. ChÃºng ta pháº£i cÃ³ chÃ­nh xÃ¡c tá»«ng <code>free</code> cho
má»—i <code>allocate</code>.</p>
<p>Rust chá»n má»™t con Ä‘Æ°á»ng khÃ¡c: pháº§n bá»™ nhá»› sáº½ Ä‘Æ°á»£c tá»± Ä‘á»™ng tráº£ láº¡i má»™t khi biáº¿n Ä‘i
ra khá»i táº§m vá»±c cá»§a nÃ³. ÄÃ¢y lÃ  má»™t phiÃªn báº£n cá»§a vÃ­ dá»¥ vá» táº§m vá»±c tá»« Listing 4-1
nhÆ°ng sá»­ dá»¥ng <code>String</code> thay vÃ¬ má»™t háº±ng chuá»—i:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    {
        let s = String::from("hello"); // s is valid from this point forward

        // do stuff with s
    }                                  // this scope is now over, and s is no
                                       // longer valid
<span class="boring">}</span></code></pre></pre>
<p>CÃ³ má»™t thá»i Ä‘iá»ƒm tá»± nhiÃªn mÃ  chÃºng ta cÃ³ thá»ƒ tráº£ láº¡i pháº§n bá»™ nhá»› mÃ  biáº¿n <code>String</code>
cáº§n: khi <code>s</code> Ä‘i ra khá»i táº§m vá»±c cá»§a nÃ³. Khi má»™t biáº¿n Ä‘i ra khá»i scope, Rust gá»i má»™t
hÃ m Ä‘áº·c biá»‡t cho chÃºng ta. HÃ m nÃ y Ä‘Æ°á»£c gá»i lÃ  <a href="../std/ops/trait.Drop.html#tymethod.drop"><code>drop</code></a><!-- ignore -->, vÃ 
nÃ³ lÃ  nÆ¡i tÃ¡c giáº£ cá»§a <code>String</code> cÃ³ thá»ƒ viáº¿t code Ä‘á»ƒ tráº£ láº¡i pháº§n bá»™ nhá»› Ä‘Ã£ cáº¥p phÃ¡t
trÆ°á»›c Ä‘Ã³. Rust gá»i <code>drop</code> má»™t cÃ¡ch tá»± Ä‘á»™ng ngay táº¡i vá»‹ trÃ­ dáº¥u ngoáº·c nhá»n Ä‘Ã³ng.</p>
<blockquote>
<p>Ghi chÃº: trong C++, máº«u thiáº¿t káº¿ cho phÃ©p tá»± Ä‘á»™ng giáº£i phÃ³ng tÃ i nguyÃªn vÃ o
thá»i Ä‘iá»ƒm má»™t pháº§n tá»­ nÃ o Ä‘Ã³ káº¿t thÃºc vÃ²ng Ä‘á»i Ä‘Ã´i khi Ä‘Æ°á»£c gá»i lÃ : <em>Resource
Acquisition Is Initialization (RAII)</em>. HÃ m <code>drop</code> trong Rust sáº½ lÃ  quen thuá»™c
náº¿u báº¡n Ä‘Ã£ tá»«ng sá»­ dá»¥ng máº«u RAII.</p>
</blockquote>
<p>Máº«u thiáº¿t káº¿ nÃ y cÃ³ má»™t sá»± áº£nh hÆ°á»Ÿng sÃ¢u sáº¯c Ä‘áº¿n cÃ¡ch viáº¿t code Rust. NÃ³ trÃ´ng
cÃ³ váº» Ä‘Æ¡n giáº£n, nhÆ°ng trong nhá»¯ng trÆ°á»ng há»£p phá»©c táº¡p code cÃ³ thá»ƒ trá»Ÿ nÃªn khÃ³ dá»±
Ä‘oÃ¡n, nhÆ° khi ta cÃ³ nhiá»u biáº¿n dÃ¹ng dá»¯ liá»‡u Ä‘Æ°á»£c phÃ¢n bá»‘ trÃªn heap. HÃ£y cÃ¹ng kháº£o
sÃ¡t má»™t vÃ i trÆ°á»ng há»£p:</p>
<!-- Old heading. Do not remove or links may break. -->
<p><a id="ways-variables-and-data-interact-move"></a><a id="variables-and-data-interacting-with-move"></a></p>
<h4 id="cÃ¡c-biáº¿n-vÃ -viá»‡c-tÆ°Æ¡ng-tÃ¡c-dá»¯-liá»‡u-vá»›i-move"><a class="header" href="#cÃ¡c-biáº¿n-vÃ -viá»‡c-tÆ°Æ¡ng-tÃ¡c-dá»¯-liá»‡u-vá»›i-move">CÃ¡c biáº¿n vÃ  viá»‡c tÆ°Æ¡ng tÃ¡c dá»¯ liá»‡u vá»›i Move</a></h4>
<p>Nhiá»u biáº¿n cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c vá»›i cÃ¹ng dá»¯ liá»‡u theo nhá»¯ng cÃ¡ch khÃ¡c nhau trong Rust.
HÃ£y cÃ¹ng xem qua má»™t vÃ­ dá»¥ sá»­ dá»¥ng biáº¿n kiá»ƒu integer trong Listing 4-2.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let x = 5;
    let y = x;
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 4-2: GÃ¡n má»™t sá»‘ nguyÃªn tá»« biáº¿n <code>x</code> sang biáº¿n <code>y</code></span></p>
<p>ChÃºng ta cÃ³ thá»ƒ Ä‘oÃ¡n xem Ä‘oáº¡n code nÃ y lÃ m gÃ¬: â€œgÃ¡n giÃ¡ trá»‹ <code>5</code> vÃ o <code>x</code>; sau Ä‘Ã³
táº¡o má»™t báº£n sao cá»§a giÃ¡ trá»‹ trong <code>x</code> vÃ  gÃ¡n nÃ³ cho <code>y</code>â€. ChÃºng ta sáº½ cÃ³ hai biáº¿n,
<code>x</code> vÃ  <code>y</code>, vÃ  cáº£ hai Ä‘á»u báº±ng <code>5</code>. ÄÃ¢y thá»±c sá»± lÃ  nhá»¯ng gÃ¬ Ä‘Ã£ diá»…n ra, vÃ¬ sá»‘ nguyÃªn
lÃ  nhá»¯ng giÃ¡ trá»‹ Ä‘Æ¡n giáº£n vá»›i kÃ­ch thÆ°á»›c cá»‘ Ä‘á»‹nh biáº¿t trÆ°á»›c, vÃ  hai giÃ¡ trá»‹ <code>5</code> Ä‘Ã³
sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn stack.</p>
<p>Giá» hÃ£y xem qua phiÃªn báº£n vá»›i <code>String</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let s1 = String::from("hello");
    let s2 = s1;
<span class="boring">}</span></code></pre></pre>
<p>Äoáº¡n nÃ y trÃ´ng khÃ¡ tÆ°Æ¡ng tá»±, do váº­y ta cÃ³ thá»ƒ cho lÃ  chÃºng hoáº¡t Ä‘á»™ng theo cÃ¹ng cÃ¡ch:
Ä‘Ã³ lÃ , dÃ²ng thá»© hai sáº½ táº¡o má»™t báº£n sao cá»§a giÃ¡ trá»‹ trong <code>s1</code> vÃ  gÃ¡n nÃ³ vÃ o cho
<code>s2</code>. NhÆ°ng Ä‘Ã¢y khÃ´ng thá»±c sá»± lÃ  Ä‘iá»u diá»…n ra.</p>
<p>HÃ£y xem qua Figure 4-1 Ä‘á»ƒ xem Ä‘iá»u gÃ¬ diá»…n ra Ä‘áº±ng sau Ä‘á»‘i vá»›i <code>String</code>. Má»™t
<code>String</code> Ä‘Æ°á»£c táº¡o nÃªn tá»« ba pháº§n, Ä‘Æ°á»£c hiá»ƒn thá»‹ phÃ­a bÃªn trÃ¡i: má»™t con trá»
Ä‘áº¿n pháº§n bá»™ nhá»› lÆ°u giá»¯ ná»™i dung cá»§a chuá»—i, má»™t biáº¿n chá»©a chiá»u dÃ i vÃ  má»™t chá»©a
kháº£ nÄƒng lÆ°u trá»¯. NhÃ³m dá»¯ liá»‡u nÃ y Ä‘Æ°á»£c lÆ°u trÃªn stack. BÃªn phÃ­a pháº£i lÃ  pháº§n bá»™
nhá»› chá»©a ná»™i dung cá»§a chuá»—i.</p>
<p><img alt="Hai báº£ng: Báº£ng Ä‘áº§u tiÃªn chá»©a biá»ƒu diá»…n cá»§a s1 trÃªn stack, bao gá»“m chiá»u 
dÃ i (5), dung lÆ°á»£ng kháº£ dá»¥ng (5) vÃ  má»™t con trá» Ä‘áº¿n giÃ¡ trá»‹ Ä‘áº§u tiÃªn trong báº£ng thá»©
hai. Báº£ng thá»© hai chá»©a biá»ƒu diá»…n dá»¯ liá»‡u cá»§a chuá»—i trÃªn heap, theo tá»«ng byte."
src="img/trpl04-01.svg" class="center"
style="width: 50%;" /></p>
<p><span class="caption">Figure 4-1: Biá»ƒu diá»…n bÃªn trong bá»™ nhá»› cá»§a má»™t <code>String</code>
chá»©a giÃ¡ trá»‹ <code>"hello"</code> gÃ¡n cho biáº¿n <code>s1</code></span></p>
<p>Chiá»u dÃ i lÃ  bao nhiÃªu bá»™ nhá»›, tÃ­nh theo byte, mÃ  ná»™i dung cá»§a <code>String</code> hiá»‡n Ä‘ang
dÃ¹ng. Dung lÆ°á»£ng kháº£ dá»¥ng lÃ  tá»•ng sá»‘ bá»™ nhá»›, tÃ­nh theo byte, mÃ  <code>String</code> Ä‘Ã£ nháº­n
tá»« trÃ¬nh quáº£n lÃ½ bá»™ nhá»›. Sá»± khÃ¡c nhau giá»¯a chiá»u dÃ i vÃ  dung lÆ°á»£ng kháº£ dá»¥ng, vÃ¬
khÃ´ng cÃ³ trong vÃ­ dá»¥ nÃ y, nÃªn hiá»‡n táº¡i ta táº¡m thá»i bá» qua khÃ´ng nÃ³i Ä‘áº¿n.</p>
<p>Khi ta gÃ¡n <code>s1</code> vÃ o <code>s2</code>, ná»™i dung cá»§a <code>String</code> sáº½ Ä‘Æ°á»£c sao chÃ©p, cÃ³ nghÄ©a lÃ  ta
chá»‰ sao chÃ©p cÃ¡c thÃ´ng tin con trá», chiá»u dÃ i, vÃ  dung lÆ°á»£ng kháº£ dá»¥ng vá»‘n Ä‘Æ°á»£c
lÆ°u trÃªn stack. Ta khÃ´ng sao chÃ©p dá»¯ liá»‡u trÃªn heap mÃ  con trá» trá» Ä‘áº¿n. NÃ³i cÃ¡ch
khÃ¡c, biá»ƒu diá»…n dá»¯ liá»‡u trong bá»™ nhá»› sáº½ giá»‘ng nhÆ° trong hÃ¬nh minh há»a 4-2.</p>
<p><img alt="Ba báº£ng: báº£ng s1 vÃ  s2 biá»ƒu diá»…n cÃ¡c string tÆ°Æ¡ng á»©ng trÃªn stack, vÃ  
cáº£ hai cÃ¹ng trá» vÃ o cÃ¹ng má»™t vÃ¹ng dá»¯ liá»‡u trÃªn heap."
src="img/trpl04-02.svg" class="center" style="width: 50%;" /></p>
<p><span class="caption">HÃ¬nh minh há»a 4-2: Biá»ƒu diá»…n trong bá»™ nhá»› cá»§a biáº¿n <code>s2</code>
chá»©a báº£n sao con trá», chiá»u dÃ i, vÃ  dung lÆ°á»£ng kháº£ dá»¥ng <code>s1</code></span></p>
<p>Biá»ƒu diá»…n <em>khÃ´ng</em> trÃ´ng giá»‘ng nhÆ° HÃ¬nh 4-3, lÃ  tá»• chá»©c bá»™ nhá»› trong trÆ°á»ng há»£p Rust
cÅ©ng sao chÃ©p dá»¯ liá»‡u heap. Náº¿u Rust Ä‘Ã£ lÃ m Ä‘iá»u nÃ y, phÃ©p gÃ¡n <code>s2 = s1</code> cÃ³ thá»ƒ
ráº¥t tá»‘n kÃ©m vá» hiá»‡u suáº¥t thá»i gian cháº¡y náº¿u dá»¯ liá»‡u trÃªn heap lá»›n.</p>
<p><img alt="Bá»‘n báº£ng: hai báº£ng Ä‘áº¡i diá»‡n cho dá»¯ liá»‡u stack cho s1 vÃ  s2,
vÃ  má»—i con trá» trá» Ä‘áº¿n báº£n sao dá»¯ liá»‡u chuá»—i cá»§a riÃªng nÃ³ trÃªn heap."
src="img/trpl04-03.svg" class="center" style="width: 50%;" /></p>
<p><span class="caption">HÃ¬nh 4-3: Biá»ƒu diá»…n bá»™ nhá»› sau phÃ©p gÃ¡n <code>s2 = s1</code> náº¿u Rust
sao chÃ©p cáº£ dá»¯ liá»‡u trÃªn heap</span></p>
<p>TrÆ°á»›c Ä‘Ã³, chÃºng tÃ´i Ä‘Ã£ nÃ³i ráº±ng khi má»™t biáº¿n ra ngoÃ i pháº¡m vi, Rust sáº½ tá»± Ä‘á»™ng
gá»i hÃ m <code>drop</code> vÃ  dá»n sáº¡ch bá»™ nhá»› heap cho biáº¿n Ä‘Ã³. NhÆ°ng HÃ¬nh 4-2 cho tháº¥y cáº£
hai con trá» dá»¯ liá»‡u trá» Ä‘áº¿n cÃ¹ng má»™t vá»‹ trÃ­. ÄÃ¢y lÃ  má»™t váº¥n Ä‘á»: khi <code>s2</code> vÃ  <code>s1</code>
vÆ°á»£t ra ngoÃ i pháº¡m vi, cáº£ hai sáº½ cá»‘ gáº¯ng giáº£i phÃ³ng cÃ¹ng má»™t pháº§n bá»™ nhá»›. ÄÃ¢y
Ä‘Æ°á»£c gá»i lÃ  lá»—i <em>double free</em> (giáº£i phÃ³ng hai láº§n) vÃ  lÃ  má»™t trong nhá»¯ng lá»—i
lá»—i an toÃ n bá»™ nhá»› mÃ  chÃºng ta Ä‘Ã£ Ä‘á» cáº­p Ä‘áº¿n trÆ°á»›c Ä‘Ã¢y. Giáº£i phÃ³ng bá»™ nhá»›
hai láº§n cÃ³ thá»ƒ dáº«n Ä‘áº¿n sai sÃ³t trong tá»• chá»©c bá»™ nhá»›, vÃ  cÃ³ kháº£ nÄƒng dáº«n Ä‘áº¿n
cÃ¡c lá»— há»•ng báº£o máº­t.</p>
<p>Äá»ƒ Ä‘áº£m báº£o an toÃ n cho bá»™ nhá»›, sau dÃ²ng <code>let s2 = s1;</code>, Rust coi <code>s1</code> lÃ 
khÃ´ng cÃ²n giÃ¡ trá»‹. Do Ä‘Ã³, Rust khÃ´ng cáº§n giáº£i phÃ³ng báº¥t cá»© thá»© gÃ¬ khi <code>s1</code> ra
ra khá»i pháº¡m vi. Xem Ä‘iá»u gÃ¬ sáº½ xáº£y ra khi báº¡n cá»‘ gáº¯ng sá»­ dá»¥ng <code>s1</code> sau khi <code>s2</code>
Ä‘Æ°á»£c táº¡o; nÃ³ sáº½ khÃ´ng hoáº¡t Ä‘á»™ng:</p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span>    let s1 = String::from("hello");
    let s2 = s1;

    println!("{s1}, world!");
<span class="boring">}</span></code></pre>
<p>Báº¡n sáº½ gáº·p lá»—i nhÆ° tháº¿ nÃ y vÃ¬ Rust ngÄƒn báº¡n sá»­ dá»¥ng tham chiáº¿u khÃ´ng há»£p lá»‡:</p>
<pre><code class="language-console">$ cargo run
   Compiling ownership v0.1.0 (file:///projects/ownership)
error[E0382]: borrow of moved value: `s1`
 --&gt; src/main.rs:5:15
  |
2 |     let s1 = String::from("hello");
  |         -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait
3 |     let s2 = s1;
  |              -- value moved here
4 |
5 |     println!("{s1}, world!");
  |               ^^^^ value borrowed here after move
  |
  = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)
help: consider cloning the value if the performance cost is acceptable
  |
3 |     let s2 = s1.clone();
  |                ++++++++

For more information about this error, try `rustc --explain E0382`.
error: could not compile `ownership` (bin "ownership") due to 1 previous error
</code></pre>
<p>Náº¿u báº¡n Ä‘Ã£ nghe cÃ¡c thuáº­t ngá»¯ <em>shallow copy</em> (sao chÃ©p cáº¡n) vÃ  <em>deep copy</em>
(sao chÃ©p sÃ¢u) khi lÃ m viá»‡c vá»›i cÃ¡c ngÃ´n ngá»¯ khÃ¡c, viá»‡c sao chÃ©p con trá»,
Ä‘á»™ dÃ i vÃ  dung lÆ°á»£ng mÃ  khÃ´ng sao chÃ©p dá»¯ liá»‡u cÃ³ thá»ƒ giá»‘ng nhÆ° táº¡o má»™t
shallow copy. NhÆ°ng vÃ¬ Rust cÅ©ng vÃ´ hiá»‡u hÃ³a biáº¿n Ä‘áº§u tiÃªn, thay vÃ¬ Ä‘Æ°á»£c gá»i lÃ 
báº£n sao nÃ´ng, nÃ³ Ä‘Æ°á»£c gá»i lÃ  <em>move</em> (di chuyá»ƒn). Trong vÃ­ dá»¥ nÃ y, chÃºng ta
sáº½ nÃ³i ráº±ng <code>s1</code> Ä‘Ã£ Ä‘Æ°á»£c <em>move</em> vÃ o <code>s2</code>. VÃ¬ váº­y, nhá»¯ng gÃ¬ thá»±c sá»± xáº£y ra
Ä‘Æ°á»£c thá»ƒ hiá»‡n trong HÃ¬nh 4-4.</p>
<p><img alt="Ba báº£ng: báº£ng s1 vÃ  s2 Ä‘áº¡i diá»‡n cho cÃ¡c chuá»—i Ä‘Ã³ trÃªn
stack tÆ°Æ¡ng á»©ng vÃ  cáº£ hai Ä‘á»u trá» Ä‘áº¿n cÃ¹ng má»™t dá»¯ liá»‡u chuá»—i trÃªn heap.
Báº£ng s1 chuyá»ƒn sang mÃ u xÃ¡m vÃ¬ s1 khÃ´ng cÃ²n giÃ¡ trá»‹; chá»‰ s2 cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ
truy cáº­p dá»¯ liá»‡u heap." src="img/trpl04-04.svg" class="center" style="width:
50%;" /></p>
<p><span class="caption">HÃ¬nh 4-4: Biá»ƒu diá»…n trong bá»™ nhá»› sau khi <code>s1</code> Ä‘Æ°á»£c
vÃ´ hiá»‡u</span></p>
<p>Äiá»u nÃ y giÃºp giáº£i quyáº¿t váº¥n Ä‘á» cá»§a chÃºng ta! Vá»›i chá»‰ <code>s2</code> há»£p lá»‡, khi vÆ°á»£t ra
pháº¡m vi, chá»‰ cÃ³ nÃ³ pháº£i giáº£i phÃ³ng bá»™ nhá»›, vÃ  chá»‰ váº­y lÃ  Ä‘á»§.</p>
<p>NgoÃ i ra, cÃ³ má»™t lá»±a chá»n thiáº¿t káº¿ Ä‘Æ°á»£c ngá»¥ Ã½ bá»Ÿi Ä‘iá»u nÃ y: Rust sáº½ khÃ´ng bao giá»
tá»± Ä‘á»™ng táº¡o cÃ¡c báº£n sao dá»¯ liá»‡u â€œsÃ¢uâ€ cá»§a báº¡n. Do Ä‘Ã³, báº¥t ká»³ thao tÃ¡c <em>tá»± Ä‘á»™ng</em>
sao chÃ©p Ä‘á»u cÃ³ thá»ƒ Ä‘Æ°á»£c coi lÃ  khÃ´ng tá»‘n kÃ©m vá» hiá»‡u suáº¥t hoáº¡t Ä‘á»™ng.</p>
<!-- Old heading. Do not remove or links may break. -->
<p><a id="ways-variables-and-data-interact-clone"></a></p>
<h4 id="cÃ¡c-biáº¿n-vÃ -tÆ°Æ¡ng-tÃ¡c-dá»¯-liá»‡u-vá»›i-clone"><a class="header" href="#cÃ¡c-biáº¿n-vÃ -tÆ°Æ¡ng-tÃ¡c-dá»¯-liá»‡u-vá»›i-clone">CÃ¡c biáº¿n vÃ  tÆ°Æ¡ng tÃ¡c dá»¯ liá»‡u vá»›i Clone</a></h4>
<p>Náº¿u chÃºng tÃ´i <em>thá»±c sá»±</em> muá»‘n sao chÃ©p cáº£ dá»¯ liá»‡u trÃªn heap cá»§a <code>String</code>, khÃ´ng chá»‰
dá»¯ liá»‡u trÃªn stack, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng má»™t phÆ°Æ¡ng phÃ¡p phá»• biáº¿n gá»i lÃ  <code>clone</code> (nhÃ¢n báº£n).
ChÃºng ta sáº½ tháº£o luáº­n vá» cÃº phÃ¡p trong ChÆ°Æ¡ng 5, nhÆ°ng bá»Ÿi vÃ¬ cÃ¡c phÆ°Æ¡ng thá»©c kiá»ƒu nÃ y
lÃ  má»™t tÃ­nh nÄƒng phá»• biáº¿n trong nhiá»u ngÃ´n ngá»¯ láº­p trÃ¬nh, báº¡n cÃ³ thá»ƒ Ä‘Ã£ nhÃ¬n tháº¥y chÃºng trÆ°á»›c Ä‘Ã¢y.</p>
<p>ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ vá» phÆ°Æ¡ng thá»©c <code>clone</code> Ä‘ang hoáº¡t Ä‘á»™ng:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let s1 = String::from("hello");
    let s2 = s1.clone();

    println!("s1 = {s1}, s2 = {s2}");
<span class="boring">}</span></code></pre></pre>
<p>CÃ¡ch nÃ y hoáº¡t Ä‘á»™ng hoÃ n toÃ n tá»‘t vÃ  táº¡o ra hÃ nh vi nhÆ° trong HÃ¬nh 4-3,
khi mÃ  dá»¯ liá»‡u trÃªn heap <em>thá»±c sá»±</em> Ä‘Æ°á»£c sao chÃ©p.</p>
<p>Khi báº¡n tháº¥y lá»‡nh gá»i Ä‘áº¿n <code>clone</code>, báº¡n sáº½ biáº¿t ráº±ng má»™t sá»‘ code tÃ¹y biáº¿n Ä‘ang Ä‘Æ°á»£c
Ä‘Æ°á»£c thá»±c hiá»‡n vÃ  code Ä‘Ã³ cÃ³ thá»ƒ tá»‘n kÃ©m. ÄÃ³ cÅ©ng lÃ  má»™t chá»‰ dáº«n trá»±c quan cho tháº¥y
ráº±ng má»™t Ä‘iá»u gÃ¬ Ä‘Ã³ khÃ¡c Ä‘ang diá»…n ra.</p>
<p><a id="stack-only-data-copy"></a></p>
<h4 id="dá»¯-liá»‡u-trÃªn-stack-sao-chÃ©p"><a class="header" href="#dá»¯-liá»‡u-trÃªn-stack-sao-chÃ©p">Dá»¯ liá»‡u trÃªn stack: sao chÃ©p</a></h4>
<p>CÃ³ má»™t Ä‘iá»u tháº¯c máº¯c khÃ¡c mÃ  chÃºng ta chÆ°a nÃ³i Ä‘áº¿n. MÃ£ nÃ y sá»­ dá»¥ng
integer â€” lÃ  má»™t pháº§n Ä‘Æ°á»£c hiá»ƒn thá»‹ trong trong Listing 4-2 â€” cháº¡y Ä‘Æ°á»£c vÃ 
hoÃ n toÃ n há»£p lá»‡:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let x = 5;
    let y = x;

    println!("x = {x}, y = {y}");
<span class="boring">}</span></code></pre></pre>
<p>NhÆ°ng mÃ£ nÃ y dÆ°á»ng nhÆ° mÃ¢u thuáº«n vá»›i nhá»¯ng gÃ¬ chÃºng ta vá»«a há»c Ä‘Æ°á»£c: chÃºng ta khÃ´ng cÃ³ lá»i gá»i Ä‘áº¿n
<code>clone</code>, nhÆ°ng <code>x</code> váº«n há»£p lá»‡ vÃ  khÃ´ng Ä‘Æ°á»£c chuyá»ƒn vÃ o <code>y</code>.</p>
<p>Rust cÃ³ má»™t annotation (chÃº thÃ­ch) Ä‘áº·c biá»‡t gá»i lÃ  <code>Copy</code> mÃ  chÃºng ta cÃ³ thá»ƒ Ä‘áº·t trÃªn
cÃ¡c loáº¡i dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn stack, nhÆ° sá»‘ nguyÃªn (chÃºng ta sáº½ nÃ³i thÃªm vá»
annotation trong <a href="ch10-02-traits.html">ChÆ°Æ¡ng 10</a><!-- ignore -->). Náº¿u má»™t kiá»ƒu dá»¯ liá»‡u Ã¡p dá»¥ng
<code>Copy</code>, cÃ¡c biáº¿n sá»­ dá»¥ng nÃ³ khÃ´ng move mÃ  Ä‘Æ°á»£c copy má»™t cÃ¡ch bÃ¬nh thÆ°á»ng,
lÃ m cho chÃºng váº«n há»£p lá»‡ sau khi Ä‘Æ°á»£c gÃ¡n cho má»™t biáº¿n khÃ¡c.</p>
<p>Rust sáº½ khÃ´ng cho phÃ©p chÃºng ta Ä‘Ã¡nh dáº¥u má»™t kiá»ƒu báº±ng <code>Copy</code> náº¿u kiá»ƒu Ä‘Ã³ hoáº·c
báº¥t ká»³ thÃ nh pháº§n nÃ o cá»§a nÃ³, Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u <code>Drop</code>. Náº¿u kiá»ƒu dá»¯ liá»‡u cáº§n lÃ m má»™t
Ä‘iá»u gÃ¬ Ä‘Ã³ Ä‘áº·c biá»‡t khi giÃ¡ trá»‹ vÆ°á»£t quÃ¡ pháº¡m vi vÃ  chÃºng ta thÃªm chÃº thÃ­ch <code>Copy</code>
cho loáº¡i Ä‘Ã³, chÃºng tÃ´i sáº½ gáº·p lá»—i biÃªn dá»‹ch. Äá»ƒ tÃ¬m hiá»ƒu vá» cÃ¡ch thÃªm chÃº thÃ­ch <code>Copy</code>
vÃ o kiá»ƒu dá»¯ liá»‡u cá»§a báº¡n Ä‘á»ƒ thá»±c hiá»‡n trait, xem pháº§n <a href="appendix-03-derivable-traits.html">â€œDerivable Traitsâ€</a><!-- ignore -->
trong Phá»¥ lá»¥c C.</p>
<p>Váº­y, nhá»¯ng kiá»ƒu dá»¯ liá»‡u nÃ o thá»±c hiá»‡n Ä‘áº·c Ä‘iá»ƒm <code>Copy</code>? Äá»ƒ cháº¯c cháº¯n báº¡n cÃ³ thá»ƒ
kiá»ƒm tra tÃ i liá»‡u cá»§a loáº¡i dá»¯ liá»‡u Ä‘Ã³, nhÆ°ng theo nguyÃªn táº¯c chung, báº¥t ká»³ nhÃ³m kiá»ƒu dá»¯ liá»‡u
vÃ´ hÆ°á»›ng Ä‘Æ¡n giáº£n nÃ o cÃ¡c giÃ¡ trá»‹ cÃ³ thá»ƒ triá»ƒn khai <code>Copy</code> vÃ  khÃ´ng cÃ³ gÃ¬ yÃªu cáº§u phÃ¢n bá»• hoáº·c lÃ  má»™t sá»‘
dáº¡ng tÃ i nguyÃªn cÃ³ thá»ƒ triá»ƒn khai <code>Copy</code>. ÄÃ¢y lÃ  má»™t sá»‘ loáº¡i Ã¡p dá»¥ng <code>Copy</code>:</p>
<ul>
<li>Táº¥t cáº£ cÃ¡c loáº¡i sá»‘ nguyÃªn, cháº³ng háº¡n nhÆ° <code>u32</code>.</li>
<li>Kiá»ƒu Boolean, <code>bool</code>, vá»›i cÃ¡c giÃ¡ trá»‹ <code>true</code> vÃ  <code>false</code>.</li>
<li>Táº¥t cáº£ cÃ¡c loáº¡i dáº¥u pháº©y Ä‘á»™ng, cháº³ng háº¡n nhÆ° <code>f64</code>.</li>
<li>Loáº¡i kÃ½ tá»±, <code>char</code>.</li>
<li>Tuple, náº¿u chÃºng chá»‰ chá»©a cÃ¡c loáº¡i cÅ©ng Ã¡p dá»¥ng <code>Copy</code>. VÃ­ dá»¥,
<code>(i32, i32)</code> thá»±c hiá»‡n <code>Copy</code>, nhÆ°ng <code>(i32, String)</code> thÃ¬ khÃ´ng.</li>
</ul>
<p><a id="ownership-and-functions"></a></p>
<h3 id="ownership-vÃ -functions"><a class="header" href="#ownership-vÃ -functions">Ownership vÃ  Functions</a></h3>
<p>CÆ¡ cháº¿ chuyá»ƒn má»™t giÃ¡ trá»‹ cho má»™t hÃ m cÅ©ng tÆ°Æ¡ng tá»± nhÆ° khi gÃ¡n giÃ¡ trá»‹ cho má»™t biáº¿n.
Truyá»n má»™t biáº¿n cho má»™t hÃ m sáº½ move hoáº·c copy, giá»‘ng nhÆ° phÃ©p gÃ¡n. Liá»‡t kÃª 4-3 cÃ³ má»™t vÃ­
dá»¥ vá»›i má»™t sá»‘ annotation nÆ¡i cÃ¡c biáº¿n vÃ o vÃ  ra khá»i pháº¡m vi.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let s = String::from("hello");  // s comes into scope

    takes_ownership(s);             // s's value moves into the function...
                                    // ... and so is no longer valid here

    let x = 5;                      // x comes into scope

    makes_copy(x);                  // Because i32 implements the Copy trait,
                                    // x does NOT move into the function,
                                    // so it's okay to use x afterward.

} // Here, x goes out of scope, then s. However, because s's value was moved,
  // nothing special happens.

fn takes_ownership(some_string: String) { // some_string comes into scope
    println!("{some_string}");
} // Here, some_string goes out of scope and `drop` is called. The backing
  // memory is freed.

fn makes_copy(some_integer: i32) { // some_integer comes into scope
    println!("{some_integer}");
} // Here, some_integer goes out of scope. Nothing special happens.</code></pre></pre>
<p><span class="caption">Liá»‡t kÃª 4-3: CÃ¡c hÃ m vá»›i ownership vÃ  scope
annotated</span></p>
<p>Náº¿u chÃºng tÃ´i cá»‘ sá»­ dá»¥ng <code>s</code> sau lá»‡nh gá»i <code>takes_ownership</code>, Rust sáº½ Ä‘Æ°a ra má»™t
lá»—i biÃªn dá»‹ch. Nhá»¯ng kiá»ƒm tra tÄ©nh nÃ y báº£o vá»‡ chÃºng ta khá»i nhá»¯ng sai láº§m. Thá»­ thÃªm
code vÃ o <code>main</code> Ä‘á»ƒ sá»­ dá»¥ng <code>s</code> vÃ  <code>x</code> vÃ  xem báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng chÃºng á»Ÿ Ä‘Ã¢u vÃ  á»Ÿ Ä‘Ã¢u
cÃ¡c quy táº¯c ownership ngÄƒn cáº£n báº¡n lÃ m váº­y.</p>
<p><a id="return-values-and-scope"></a></p>
<h3 id="giÃ¡-trá»‹-tráº£-vá»-vÃ -scope"><a class="header" href="#giÃ¡-trá»‹-tráº£-vá»-vÃ -scope">GiÃ¡ trá»‹ tráº£ vá» vÃ  Scope</a></h3>
<p>CÃ¡c giÃ¡ trá»‹ tráº£ vá» cÅ©ng cÃ³ thá»ƒ chuyá»ƒn ownership. Liá»‡t kÃª 4-4 trÃ¬nh bÃ y má»™t vÃ­ dá»¥ vá» má»™t
hÃ m tráº£ vá» má»™t sá»‘ giÃ¡ trá»‹, vá»›i cÃ¡c annotation tÆ°Æ¡ng tá»± nhÆ° trong Liá»‡t kÃª 4-3.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let s1 = gives_ownership();        // gives_ownership moves its return
                                       // value into s1

    let s2 = String::from("hello");    // s2 comes into scope

    let s3 = takes_and_gives_back(s2); // s2 is moved into
                                       // takes_and_gives_back, which also
                                       // moves its return value into s3
} // Here, s3 goes out of scope and is dropped. s2 was moved, so nothing
  // happens. s1 goes out of scope and is dropped.

fn gives_ownership() -&gt; String {       // gives_ownership will move its
                                       // return value into the function
                                       // that calls it

    let some_string = String::from("yours"); // some_string comes into scope

    some_string                        // some_string is returned and
                                       // moves out to the calling
                                       // function
}

// This function takes a String and returns a String.
fn takes_and_gives_back(a_string: String) -&gt; String {
    // a_string comes into
    // scope

    a_string  // a_string is returned and moves out to the calling function
}</code></pre></pre>
<p><span class="caption">Listing 4-4: Chuyá»ƒn ownership cá»§a cÃ¡c giÃ¡ trá»‹ tráº£ vá»</span></p>
<p>Ownership cá»§a má»™t biáº¿n luÃ´n tuÃ¢n theo cÃ¹ng má»™t khuÃ´n máº«u: viá»‡c gÃ¡n giÃ¡ trá»‹ cho má»™t
biáº¿n khÃ¡c sáº½ move nÃ³. Khi má»™t biáº¿n bao gá»“m dá»¯ liá»‡u trÃªn heap náº±m ngoÃ i scope, giÃ¡ trá»‹
sáº½ bá»‹ <code>drop</code> trá»« khi ownership Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn sang má»™t biáº¿n khÃ¡c.</p>
<p>Khi Ä‘iá»u nÃ y hoáº¡t Ä‘á»™ng, viá»‡c láº¥y ownership vÃ  sau Ä‘Ã³ tráº£ láº¡i ownership vá»›i cÃ¡c
hÃ m sáº½ cÃ³ má»™t chÃºt táº» nháº¡t. Äiá»u gÃ¬ sáº½ xáº£y ra náº¿u chÃºng ta muá»‘n Ä‘á»ƒ má»™t hÃ m sá»­ dá»¥ng má»™t
giÃ¡ trá»‹ nhÆ°ng khÃ´ng láº¥y ownership? Tháº­t khÃ³ chá»‹u khi báº¥t cá»© thá»© gÃ¬ chÃºng ta truyá»n Ä‘i
cÅ©ng cáº§n pháº£i Ä‘Æ°á»£c tráº£ láº¡i náº¿u chÃºng ta muá»‘n sá»­ dá»¥ng láº¡i, chÆ°a ká»ƒ chÃºng ta cÃ²n pháº£i tráº£
vá» giÃ¡ trá»‹ cá»§a hÃ m.</p>
<p>Rust cho phÃ©p chÃºng ta tráº£ vá» nhiá»u giÃ¡ trá»‹ báº±ng cÃ¡ch sá»­ dá»¥ng tuple, nhÆ° trong Liá»‡t kÃª 4-5.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let s1 = String::from("hello");

    let (s2, len) = calculate_length(s1);

    println!("The length of '{s2}' is {len}.");
}

fn calculate_length(s: String) -&gt; (String, usize) {
    let length = s.len(); // len() returns the length of a String

    (s, length)
}</code></pre></pre>
<p><span class="caption">Liá»‡t kÃª 4-5: Tráº£ vá» ownership cá»§a cÃ¡c tham sá»‘</span></p>
<p>NhÆ°ng quáº£ lÃ  cÃ³ quÃ¡ nhiá»u thá»© cho má»™t khÃ¡i niá»‡m vá»‘n khÃ¡ phá»• biáº¿n. Tháº­t may máº¯n cho chÃºng ta,
Rust cÃ³ má»™t tÃ­nh nÄƒng cho phÃ©p sá»­ dá»¥ng má»™t giÃ¡ trá»‹ mÃ  khÃ´ng cáº§n
chuyá»ƒn quyá»n sá»Ÿ há»¯u, Ä‘Æ°á»£c gá»i lÃ  <em>reference</em> (tham chiáº¿u).</p>
<div style="break-before: page; page-break-before: always;"></div><p><a id="references-and-borrowing"></a></p>
<h2 id="references-and-borrowing-tham-chiáº¿u-vÃ -mÆ°á»£n"><a class="header" href="#references-and-borrowing-tham-chiáº¿u-vÃ -mÆ°á»£n">References and Borrowing (tham chiáº¿u vÃ  mÆ°á»£n)</a></h2>
<p>Váº¥n Ä‘á» vá»›i tuple code trong Liá»‡t kÃª 4-5 lÃ  chÃºng ta pháº£i tráº£ vá»
<code>String</code> cho hÃ m gá»i Ä‘á»ƒ váº«n cÃ³ thá»ƒ sá»­ dá»¥ng <code>String</code> sau khi gá»i
tá»›i <code>calculate_length</code>, vÃ¬ <code>String</code> Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn vÃ o
<code>calculate_length</code>. Äá»ƒ lÃ m Ä‘iá»u Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ cung cáº¥p má»™t reference (tham chiáº¿u)
Ä‘áº¿n giÃ¡ trá»‹ <code>String</code>.
Má»™t <em>tham chiáº¿u</em> giá»‘ng nhÆ° má»™t con trá» á»Ÿ chá»— nÃ³ lÃ  má»™t Ä‘á»‹a chá»‰ mÃ  chÃºng ta cÃ³ thá»ƒ theo dÃµi Ä‘á»ƒ truy cáº­p
dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i Ä‘á»‹a chá»‰ Ä‘Ã³; dá»¯ liá»‡u Ä‘Ã³ Ä‘Æ°á»£c sá»Ÿ há»¯u bá»Ÿi má»™t sá»‘ biáº¿n khÃ¡c.
NhÆ°ng khÃ´ng giá»‘ng con trá», má»™t reference Ä‘Æ°á»£c Ä‘áº£m báº£o trá» Ä‘áº¿n má»™t giÃ¡ trá»‹ há»£p lá»‡ cá»§a má»™t
kiá»ƒu cá»¥ thá»ƒ trong suá»‘t vÃ²ng Ä‘á»i cá»§a reference Ä‘Ã³.</p>
<p>ÄÃ¢y lÃ  cÃ¡ch báº¡n Ä‘á»‹nh nghÄ©a vÃ  sá»­ dá»¥ng hÃ m <code>calculate_length</code> Ä‘á»ƒ
cÃ³ tham chiáº¿u Ä‘áº¿n má»™t Ä‘á»‘i tÆ°á»£ng dÆ°á»›i dáº¡ng tham sá»‘ thay vÃ¬ láº¥y ownership cá»§a Ä‘á»‘i tÆ°á»£ng
sá»Ÿ há»¯u giÃ¡ trá»‹:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let s1 = String::from("hello");

    let len = calculate_length(&amp;s1);

    println!("The length of '{s1}' is {len}.");
}

fn calculate_length(s: &amp;String) -&gt; usize {
    s.len()
}</code></pre></pre>
<p>Äáº§u tiÃªn, lÆ°u Ã½ ráº±ng táº¥t cáº£ tuple code trong khai bÃ¡o biáº¿n vÃ 
giÃ¡ trá»‹ tráº£ vá» cá»§a hÃ m Ä‘Ã£ biáº¿n máº¥t. Thá»© hai, lÆ°u Ã½ ráº±ng chÃºng ta chuyá»ƒn <code>&amp;s1</code> vÃ o
<code>calculate_length</code> vÃ , theo Ä‘á»‹nh nghÄ©a cá»§a nÃ³, chÃºng ta láº¥y <code>&amp;String</code> thay vÃ¬
<code>String</code>. CÃ¡c dáº¥u &amp; nÃ y Ä‘áº¡i diá»‡n cho <em>reference</em> vÃ  chÃºng cho phÃ©p báº¡n tham chiáº¿u
Ä‘áº¿n má»™t giÃ¡ trá»‹ nÃ o Ä‘Ã³ mÃ  khÃ´ng sá»Ÿ há»¯u nÃ³. HÃ¬nh 4-5 mÃ´ táº£ khÃ¡i niá»‡m nÃ y.</p>
<img alt="&amp;Chuá»—i s chá»‰ vÃ o Chuá»—i s1" src="img/trpl04-05.svg" class="center" />
<p><span class="caption">HÃ¬nh 4-5: SÆ¡ Ä‘á»“ <code>&amp;String s</code> chá»‰ vÃ o <code>String s1</code></span></p>
<blockquote>
<p>LÆ°u Ã½: NgÆ°á»£c láº¡i vá»›i reference báº±ng cÃ¡ch sá»­ dá»¥ng <code>&amp;</code> lÃ  <em>dereferencing</em>, báº±ng cÃ¡ch
dÃ¹ng toÃ¡n tá»­ <code>*</code>. ChÃºng ta sáº½ tháº¥y má»™t sá»‘ cÃ´ng dá»¥ng cá»§a
toÃ¡n tá»­ dereference trong ChÆ°Æ¡ng 8 vÃ  tháº£o luáº­n chi tiáº¿t vá» dereference trong
ChÆ°Æ¡ng 15.</p>
</blockquote>
<p>HÃ£y cÃ¹ng xem ká»¹ hÆ¡n vá» lá»‡nh gá»i hÃ m á»Ÿ Ä‘Ã¢y:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let s1 = String::from("hello");

    let len = calculate_length(&amp;s1);
<span class="boring">
</span><span class="boring">    println!("The length of '{s1}' is {len}.");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn calculate_length(s: &amp;String) -&gt; usize {
</span><span class="boring">    s.len()
</span><span class="boring">}</span></code></pre></pre>
<p>CÃº phÃ¡p <code>&amp;s1</code> cho phÃ©p chÃºng ta táº¡o má»™t reference <em>tham chiáº¿u</em> Ä‘áº¿n giÃ¡ trá»‹ cá»§a <code>s1</code>
nhÆ°ng khÃ´ng sá»Ÿ há»¯u nÃ³. VÃ¬ khÃ´ng sá»Ÿ há»¯u nÃ³, giÃ¡ trá»‹ mÃ  nÃ³ trá» tá»›i sáº½
khÃ´ng bá»‹ drop khi tham chiáº¿u ngá»«ng Ä‘Æ°á»£c sá»­ dá»¥ng.</p>
<p>TÆ°Æ¡ng tá»± nhÆ° váº­y, chá»¯ kÃ½ cá»§a hÃ m sá»­ dá»¥ng <code>&amp;</code> Ä‘á»ƒ chá»‰ ra ráº±ng kiá»ƒu cá»§a
tham sá»‘ <code>s</code> lÃ  má»™t tham chiáº¿u. HÃ£y thÃªm má»™t sá»‘ annotation:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span><span class="boring">    let s1 = String::from("hello");
</span><span class="boring">
</span><span class="boring">    let len = calculate_length(&amp;s1);
</span><span class="boring">
</span><span class="boring">    println!("The length of '{s1}' is {len}.");
</span><span class="boring">}
</span><span class="boring">
</span>fn calculate_length(s: &amp;String) -&gt; usize { // s is a reference to a String
    s.len()
} // Here, s goes out of scope. But because s does not have ownership of what
  // it refers to, the String is not dropped.</code></pre></pre>
<p>Pháº¡m vi (scope) mÃ  biáº¿n <code>s</code> há»£p lá»‡ giá»‘ng nhÆ° báº¥t ká»³ pháº¡m vi cá»§a tham sá»‘ nÃ o,
nhÆ°ng giÃ¡ trá»‹ Ä‘Æ°á»£c trá» Ä‘áº¿n bá»Ÿi tham chiáº¿u khÃ´ng bá»‹ drop khi <code>s</code> ngá»«ng Ä‘Æ°á»£c sá»­ dá»¥ng
vÃ¬ <code>s</code> khÃ´ng cÃ³ ownership. Khi hÃ m sá»­ dá»¥ng tham sá»‘ dÆ°á»›i dáº¡ng tham chiáº¿u thay vÃ¬
biáº¿n thá»±c, chÃºng ta sáº½ khÃ´ng cáº§n tráº£ láº¡i cÃ¡c giÃ¡ trá»‹ Ä‘á»ƒ tráº£ láº¡i ownership, vÃ¬ chÃºng ta
chÆ°a bao giá» sá»Ÿ há»¯u chÃºng.</p>
<p>ChÃºng ta gá»i hÃ nh Ä‘á»™ng táº¡o má»™t reference lÃ  <em>borrowing</em> (mÆ°á»£n). Giá»‘ng nhÆ°
trong cuá»™c sá»‘ng thá»±c, náº¿u má»™t ngÆ°á»i sá»Ÿ há»¯u má»™t cÃ¡i gÃ¬ Ä‘Ã³, báº¡n cÃ³ thá»ƒ mÆ°á»£n nÃ³ tá»« há».
Khi báº¡n hoÃ n thÃ nh, báº¡n cÃ³ Ä‘á»ƒ tráº£ láº¡i. Báº¡n khÃ´ng sá»Ÿ há»¯u nÃ³.</p>
<p>Váº­y Ä‘iá»u gÃ¬ sáº½ xáº£y ra náº¿u chÃºng ta cá»‘ gáº¯ng sá»­a Ä‘á»•i thá»© gÃ¬ Ä‘Ã³ mÃ  chÃºng ta Ä‘ang mÆ°á»£n?
HÃ£y thá»­ mÃ£ trong Liá»‡t kÃª 4-6.</p>
<p>Spoiler alert: nÃ³ khÃ´ng hoáº¡t Ä‘á»™ng!</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let s = String::from("hello");

    change(&amp;s);
}

fn change(some_string: &amp;String) {
    some_string.push_str(", world");
}</code></pre>
<p><span class="caption">Listing 4-6: Cá»‘ gáº¯ng sá»­a Ä‘á»•i má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c borrow</span></p>
<p>ÄÃ¢y lÃ  lá»—i:</p>
<pre><code class="language-console">$ cargo run
   Compiling ownership v0.1.0 (file:///projects/ownership)
error[E0596]: cannot borrow `*some_string` as mutable, as it is behind a `&amp;` reference
 --&gt; src/main.rs:8:5
  |
8 |     some_string.push_str(", world");
  |     ^^^^^^^^^^^ `some_string` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable
  |
help: consider changing this to be a mutable reference
  |
7 | fn change(some_string: &amp;mut String) {
  |                         +++

For more information about this error, try `rustc --explain E0596`.
error: could not compile `ownership` (bin "ownership") due to 1 previous error
</code></pre>
<p>Giá»‘ng nhÆ° cÃ¡c biáº¿n lÃ  báº¥t biáº¿n theo máº·c Ä‘á»‹nh, cÃ¡c tham chiáº¿u cÅ©ng váº­y. Ta khÃ´ng
Ä‘Æ°á»£c phÃ©p sá»­a Ä‘á»•i thá»© gÃ¬ mÃ  ta cÃ³ má»™t reference Ä‘áº¿n.</p>
<h3 id="mutable-references-cÃ¡c-tham-chiáº¿u-cÃ³-thá»ƒ-thay-Ä‘á»•i"><a class="header" href="#mutable-references-cÃ¡c-tham-chiáº¿u-cÃ³-thá»ƒ-thay-Ä‘á»•i">Mutable References (CÃ¡c tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i)</a></h3>
<p>ChÃºng tÃ´i cÃ³ thá»ƒ sá»­a code tá»« Liá»‡t kÃª 4-6 Ä‘á»ƒ cho phÃ©p sá»­a Ä‘á»•i giÃ¡ trá»‹ Ä‘Æ°á»£c mÆ°á»£n,
chá»‰ vá»›i má»™t vÃ i Ä‘iá»u chá»‰nh nhá» sá»­ dá»¥ng * mutable reference *:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let mut s = String::from("hello");

    change(&amp;mut s);
}

fn change(some_string: &amp;mut String) {
    some_string.push_str(", world");
}</code></pre></pre>
<p>Äáº§u tiÃªn, chÃºng ta Ä‘á»•i <code>s</code> thÃ nh <code>mut</code>. Sau Ä‘Ã³, chÃºng ta táº¡o má»™t * mutable reference *
vá»›i <code>&amp;mut s</code> nÆ¡i ta gá»i hÃ m <code>change</code> vÃ  cáº­p nháº­t function Ä‘á»ƒ cháº¥p nháº­n mutable reference
vá»›i <code>some_string: &amp;mut String</code>. Äiá»u nÃ y giÃºp chá»‰ ra rÃµ rÃ ng ráº±ng hÃ m <code>change</code> sáº½ thay Ä‘á»•i
giÃ¡ trá»‹ mÃ  nÃ³ mÆ°á»£n.</p>
<p>CÃ¡c mutable reference cÃ³ má»™t háº¡n cháº¿ lá»›n: náº¿u báº¡n cÃ³ má»™t mutable reference tá»›i
má»™t giÃ¡ trá»‹, báº¡n khÃ´ng thá»ƒ cÃ³ thÃªm reference nÃ o khÃ¡c Ä‘áº¿n giÃ¡ trá»‹ Ä‘Ã³. Äoáº¡n code nÃ y
dÃ¹ng Ä‘á»ƒ ná»— lá»±c táº¡o hai tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i Ä‘áº¿n <code>s</code> sáº½ khÃ´ng thÃ nh cÃ´ng:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span>    let mut s = String::from("hello");

    let r1 = &amp;mut s;
    let r2 = &amp;mut s;

    println!("{r1}, {r2}");
<span class="boring">}</span></code></pre>
<p>VÃ  Ä‘Ã¢y lÃ  lá»—i:</p>
<pre><code class="language-console">$ cargo run
   Compiling ownership v0.1.0 (file:///projects/ownership)
error[E0499]: cannot borrow `s` as mutable more than once at a time
 --&gt; src/main.rs:5:14
  |
4 |     let r1 = &amp;mut s;
  |              ------ first mutable borrow occurs here
5 |     let r2 = &amp;mut s;
  |              ^^^^^^ second mutable borrow occurs here
6 |
7 |     println!("{r1}, {r2}");
  |               ---- first borrow later used here

For more information about this error, try `rustc --explain E0499`.
error: could not compile `ownership` (bin "ownership") due to 1 previous error
</code></pre>
<p>Lá»—i nÃ y nÃ³i ráº±ng code khÃ´ng há»£p lá»‡ vÃ¬ chÃºng ta khÃ´ng thá»ƒ mÆ°á»£n (borrow) <code>s</code> nhÆ°
má»™t mutable references nhiá»u hÆ¡n má»™t láº§n táº¡i má»™t thá»i Ä‘iá»ƒm. Mutable reference Ä‘áº§u tiÃªn
náº±m trong <code>r1</code> vÃ  pháº£i kÃ©o dÃ i cho Ä‘áº¿n khi nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng trong <code>println!</code>,
nhÆ°ng giá»¯a viá»‡c táº¡o ra mutable reference vÃ  cÃ¡ch sá»­ dá»¥ng nÃ³, chÃºng ta Ä‘Ã£ cá»‘ gáº¯ng táº¡o má»™t
mutable reference khÃ¡c trong <code>r2</code> vÃ  mÆ°á»£n cÃ¹ng dá»¯ liá»‡u vá»›i <code>r1</code>.</p>
<p>Háº¡n cháº¿ ngÄƒn nhiá»u tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i Ä‘áº¿n cÃ¹ng má»™t dá»¯ liá»‡u táº¡i
Ä‘á»“ng thá»i cho phÃ©p thay nhÆ°ng theo má»™t cÃ¡ch cÃ³ kiá»ƒm soÃ¡t. ÄÃ³ cÃ³ thá»ƒ lÃ  thá»©
mÃ  nhá»¯ng Rustacean má»›i cáº£m tháº¥y khÃ³ khÄƒn, vÃ¬ háº§u háº¿t cÃ¡c ngÃ´n ngá»¯ cho phÃ©p báº¡n
thay Ä‘á»•i dá»¯ liá»‡u báº¥t cá»© khi nÃ o báº¡n muá»‘n. Lá»£i Ã­ch cá»§a viá»‡c háº¡n cháº¿ nÃ y lÃ  Rust
cÃ³ thá»ƒ ngÄƒn cháº·n cÃ¡c <em>data race</em> táº¡i thá»i gian biÃªn dá»‹ch. Má»™t <em>data race</em>
tÆ°Æ¡ng tá»± nhÆ° má»™t race condition vÃ  xáº£y ra khi ba hÃ nh vi nÃ y xáº£y ra:</p>
<ul>
<li>Hai hoáº·c nhiá»u con trá» truy cáº­p cÃ¹ng má»™t dá»¯ liá»‡u táº¡i cÃ¹ng má»™t thá»i Ä‘iá»ƒm.</li>
<li>Ãt nháº¥t má»™t trong cÃ¡c con trá» Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ ghi vÃ o dá»¯ liá»‡u.</li>
<li>KhÃ´ng cÃ³ cÆ¡ cháº¿ nÃ o Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»“ng bá»™ hÃ³a quyá»n truy cáº­p vÃ o dá»¯ liá»‡u.</li>
</ul>
<p>CÃ¡c data race gÃ¢y ra hÃ nh vi khÃ´ng xÃ¡c Ä‘á»‹nh vÃ  cÃ³ thá»ƒ khÃ³ cháº©n Ä‘oÃ¡n cÅ©ng nhÆ° kháº¯c phá»¥c
khi báº¡n Ä‘ang cá»‘ theo dÃµi chÃºng khi cháº¡y chÆ°Æ¡ng trÃ¬nh; Rust ngÄƒn cháº·n váº¥n Ä‘á» nÃ y
báº±ng cÃ¡ch tá»« chá»‘i biÃªn dá»‹ch mÃ£ vá»›i cÃ¡c data race!</p>
<p>NhÆ° má»i khi, ta cÃ³ thá»ƒ sá»­ dá»¥ng dáº¥u ngoáº·c nhá»n Ä‘á»ƒ táº¡o má»™t scope má»›i, cho phÃ©p
nhiá»u tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i, chá»‰ lÃ  khÃ´ng pháº£i <em>Ä‘á»“ng thá»i</em>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let mut s = String::from("hello");

    {
        let r1 = &amp;mut s;
    } // r1 goes out of scope here, so we can make a new reference with no problems.

    let r2 = &amp;mut s;
<span class="boring">}</span></code></pre></pre>
<p>Rust thá»±c thi má»™t quy táº¯c tÆ°Æ¡ng tá»± cho viá»‡c káº¿t há»£p cÃ¡c mutable reference
vÃ  immutable reference.
MÃ£ nÃ y dáº«n Ä‘áº¿n má»™t lá»—i:</p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span>    let mut s = String::from("hello");

    let r1 = &amp;s; // no problem
    let r2 = &amp;s; // no problem
    let r3 = &amp;mut s; // BIG PROBLEM

    println!("{r1}, {r2}, and {r3}");
<span class="boring">}</span></code></pre>
<p>ÄÃ¢y lÃ  lá»—i:</p>
<pre><code class="language-console">$ cargo run
   Compiling ownership v0.1.0 (file:///projects/ownership)
error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
 --&gt; src/main.rs:6:14
  |
4 |     let r1 = &amp;s; // no problem
  |              -- immutable borrow occurs here
5 |     let r2 = &amp;s; // no problem
6 |     let r3 = &amp;mut s; // BIG PROBLEM
  |              ^^^^^^ mutable borrow occurs here
7 |
8 |     println!("{r1}, {r2}, and {r3}");
  |               ---- immutable borrow later used here

For more information about this error, try `rustc --explain E0502`.
error: could not compile `ownership` (bin "ownership") due to 1 previous error
</code></pre>
<p>Whew! ChÃºng ta <em>cÅ©ng</em> khÃ´ng thá»ƒ cÃ³ má»™t mutable reference trong khi cÃ³ má»™t
immutable reference chá»‰ Ä‘áº¿n cÃ¹ng giÃ¡ trá»‹.</p>
<p>NgÆ°á»i dÃ¹ng cá»§a má»™t immutable reference khÃ´ng mong Ä‘á»£i giÃ¡ trá»‹ Ä‘á»™t ngá»™t thay Ä‘á»•i
tá»« Ä‘Ã¢u Ä‘Ã³ bÃªn dÆ°á»›i! Tuy nhiÃªn, nhiá»u immutable reference Ä‘Æ°á»£c cho phÃ©p vÃ¬
má»i ngÆ°á»i chá»‰ Ä‘ang Ä‘á»c dá»¯ liá»‡u vÃ  khÃ´ng ai cÃ³ kháº£ nÄƒng áº£nh hÆ°á»Ÿng Ä‘áº¿n báº¥t ká»³ ai khÃ¡c.</p>
<p>LÆ°u Ã½ ráº±ng pháº¡m vi cá»§a tham chiáº¿u báº¯t Ä‘áº§u tá»« nÆ¡i nÃ³ Ä‘Æ°á»£c giá»›i thiá»‡u vÃ  tiáº¿p tá»¥c
cho Ä‘áº¿n láº§n cuá»‘i cÃ¹ng tham chiáº¿u Ä‘Ã³ Ä‘Æ°á»£c sá»­ dá»¥ng. VÃ­ dá»¥, mÃ£ nÃ y sáº½
biÃªn dá»‹ch bá»Ÿi vÃ¬ láº§n sá»­ dá»¥ng cuá»‘i cÃ¹ng cá»§a immutable reference, <code>println!</code>,
xáº£y ra trÆ°á»›c khi mutable reference Ä‘Æ°á»£c giá»›i thiá»‡u:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">fn main() {
</span>    let mut s = String::from("hello");

    let r1 = &amp;s; // no problem
    let r2 = &amp;s; // no problem
    println!("{r1} and {r2}");
    // Variables r1 and r2 will not be used after this point.

    let r3 = &amp;mut s; // no problem
    println!("{r3}");
<span class="boring">}</span></code></pre></pre>
<p>Pháº¡m vi cá»§a cÃ¡c tham chiáº¿u báº¥t biáº¿n (mutable reference) <code>r1</code> vÃ  <code>r2</code> káº¿t thÃºc sau <code>println!</code>
nÆ¡i chÃºng Ä‘Æ°á»£c sá»­ dá»¥ng láº§n cuá»‘i, trÆ°á»›c mutable reference <code>r3</code> Ä‘Æ°á»£c táº¡o.
CÃ¡c pháº¡m vi nÃ y khÃ´ng trÃ¹ng nhau, vÃ¬ váº­y code nÃ y Ä‘Æ°á»£c phÃ©p. kháº£ nÄƒng cá»§a
trÃ¬nh biÃªn dá»‹ch Ä‘á»ƒ bÃ¡o ráº±ng má»™t tham chiáº¿u khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng táº¡i má»™t thá»i Ä‘iá»ƒm trÆ°á»›c
khi káº¿t thÃºc scope Ä‘Æ°á»£c gá»i lÃ  <em>Non-Lexical Lifetimes</em> (viáº¿t táº¯t lÃ  NLL) vÃ  báº¡n
cÃ³ thá»ƒ Ä‘á»c thÃªm vá» nÃ³ trong <a href="https://doc.rust-lang.org/edition-guide/rust-2018/ownership-and-lifetimes/non-lexical-lifetimes.html">The Edition Guide</a>.</p>
<p>Máº·c dÃ¹ Ä‘Ã´i khi lá»—i borrow cÃ³ thá»ƒ gÃ¢y khÃ³ chá»‹u, hÃ£y nhá»› ráº±ng Ä‘Ã³ lÃ 
trÃ¬nh biÃªn dá»‹ch Rust Ä‘Ã£ sá»›m chá»‰ ra má»™t lá»—i tiá»m áº©n (táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch
so vá»›i thá»i gian cháº¡y) vÃ  cho báº¡n biáº¿t chÃ­nh xÃ¡c váº¥n Ä‘á» náº±m á»Ÿ Ä‘Ã¢u. Sau Ä‘Ã³, báº¡n khÃ´ng
pháº£i tÃ¬m ra lÃ½ do táº¡i sao dá»¯ liá»‡u cá»§a báº¡n khÃ´ng giá»‘ng nhÆ° báº¡n nghÄ©.</p>
<h3 id="dangling-references"><a class="header" href="#dangling-references">Dangling References</a></h3>
<p>Trong cÃ¡c ngÃ´n ngá»¯ cÃ³ con trá», ráº¥t dá»… táº¡o nháº§m <em>dangling pointer</em>â€“con trá»
tham chiáº¿u Ä‘áº¿n má»™t vá»‹ trÃ­ trong bá»™ nhá»› cÃ³ thá»ƒ Ä‘Ã£ Ä‘Æ°á»£c Ä‘Æ°á»£c cáº¥p cho má»™t code
khÃ¡câ€“báº±ng cÃ¡ch giáº£i phÃ³ng bá»™ nhá»› trong khi váº«n giá»¯ má»™t con trá» tá»›i
pháº§n bá»™ nhá»› Ä‘Ã³. NgÆ°á»£c láº¡i, trong Rust, trÃ¬nh biÃªn dá»‹ch Ä‘áº£m báº£o ráº±ng cÃ¡c tham chiáº¿u sáº½
khÃ´ng bao giá» lÃ  dangling reference: náº¿u báº¡n cÃ³ má»™t reference Ä‘áº¿n má»™t dá»¯ liá»‡u,
trÃ¬nh biÃªn dá»‹ch sáº½ Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u sáº½ khÃ´ng Ä‘i ra khá»i scope trÆ°á»›c reference Ä‘Ã³.</p>
<p>HÃ£y thá»­ táº¡o má»™t dangling reference Ä‘á»ƒ xem cÃ¡ch Rust ngÄƒn cháº·n chÃºng báº±ng má»™t
lá»—i biÃªn dá»‹ch:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let reference_to_nothing = dangle();
}

fn dangle() -&gt; &amp;String {
    let s = String::from("hello");

    &amp;s
}</code></pre>
<p>ÄÃ¢y lÃ  lá»—i:</p>
<pre><code class="language-console">$ cargo run
   Compiling ownership v0.1.0 (file:///projects/ownership)
error[E0106]: missing lifetime specifier
 --&gt; src/main.rs:5:16
  |
5 | fn dangle() -&gt; &amp;String {
  |                ^ expected named lifetime parameter
  |
  = help: this function's return type contains a borrowed value, but there is no value for it to be borrowed from
help: consider using the `'static` lifetime, but this is uncommon unless you're returning a borrowed value from a `const` or a `static`
  |
5 | fn dangle() -&gt; &amp;'static String {
  |                 +++++++
help: instead, you are more likely to want to return an owned value
  |
5 - fn dangle() -&gt; &amp;String {
5 + fn dangle() -&gt; String {
  |

error[E0515]: cannot return reference to local variable `s`
 --&gt; src/main.rs:8:5
  |
8 |     &amp;s
  |     ^^ returns a reference to data owned by the current function

Some errors have detailed explanations: E0106, E0515.
For more information about an error, try `rustc --explain E0106`.
error: could not compile `ownership` (bin "ownership") due to 2 previous errors
</code></pre>
<p>ThÃ´ng bÃ¡o lá»—i nÃ y Ä‘á» cáº­p Ä‘áº¿n má»™t tÃ­nh nÄƒng mÃ  chÃºng ta chÆ°a Ä‘á» cáº­p Ä‘áº¿n: lifetime
(thá»i gian sá»‘ng). Ta sáº½ tháº£o luáº­n chi tiáº¿t vá» lifetime trong ChÆ°Æ¡ng 10.
NhÆ°ng, náº¿u báº¡n bá» qua cÃ¡c pháº§n vá» lifetime, thÃ´ng bÃ¡o chá»©a chÃ¬a khÃ³a giáº£i
thÃ­ch táº¡i sao mÃ£ nÃ y láº¡i cÃ³ váº¥n Ä‘á»:</p>
<pre><code class="language-text">this function's return type contains a borrowed value, but there is no value
for it to be borrowed from
</code></pre>
<p>ChÃºng ta hÃ£y xem xÃ©t ká»¹ hÆ¡n chÃ­nh xÃ¡c nhá»¯ng gÃ¬ Ä‘ang xáº£y ra vÃ o má»—i bÆ°á»›c trong
code <code>dangle</code> cá»§a chÃºng ta:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span><span class="boring">    let reference_to_nothing = dangle();
</span><span class="boring">}
</span><span class="boring">
</span>fn dangle() -&gt; &amp;String { // dangle returns a reference to a String

    let s = String::from("hello"); // s is a new String

    &amp;s // we return a reference to the String, s
} // Here, s goes out of scope and is dropped, so its memory goes away.
  // Danger!</code></pre>
<p>VÃ¬ <code>s</code> Ä‘Æ°á»£c táº¡o bÃªn trong <code>dangle</code>, khi code cá»§a <code>dangle</code> káº¿t thÃºc,
<code>s</code> sáº½ Ä‘Æ°á»£c giáº£i phÃ³ng. NhÆ°ng chÃºng ta Ä‘Ã£ cá»‘ gáº¯ng tráº£ láº¡i má»™t tham chiáº¿u Ä‘áº¿n nÃ³.
Äiá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  tham chiáº¿u nÃ y sáº½ trá» Ä‘áº¿n má»™t <code>String</code> khÃ´ng há»£p lá»‡.
Äiá»u Ä‘Ã³ hoÃ n toÃ n khÃ´ng tá»‘t! Rust sáº½ khÃ´ng cho phÃ©p chÃºng ta lÃ m Ä‘iá»u nÃ y.</p>
<p>Giáº£i phÃ¡p á»Ÿ Ä‘Ã¢y lÃ  tráº£ vá» <code>String</code> trá»±c tiáº¿p:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span><span class="boring">    let string = no_dangle();
</span><span class="boring">}
</span><span class="boring">
</span>fn no_dangle() -&gt; String {
    let s = String::from("hello");

    s
}</code></pre></pre>
<p>Äiá»u nÃ y hoáº¡t Ä‘á»™ng mÃ  khÃ´ng cÃ³ báº¥t ká»³ váº¥n Ä‘á» gÃ¬. Ownership Ä‘Æ°á»£c chuyá»ƒn ra ngoÃ i, vÃ 
khÃ´ng cÃ³ biáº¿n nÃ o Ä‘Æ°á»£c giáº£i phÃ³ng.</p>
<h3 id="cÃ¡c-quy-táº¯c-vá»-tham-chiáº¿u"><a class="header" href="#cÃ¡c-quy-táº¯c-vá»-tham-chiáº¿u">CÃ¡c quy táº¯c vá» tham chiáº¿u</a></h3>
<p>HÃ£y tÃ³m táº¯t láº¡i nhá»¯ng gÃ¬ chÃºng ta Ä‘Ã£ tháº£o luáº­n vá» tham chiáº¿u:</p>
<ul>
<li>Táº¡i báº¥t ká»³ thá»i Ä‘iá»ƒm nÃ o, báº¡n cÃ³ thá»ƒ cÃ³ <em>hoáº·c</em> chá»‰ má»™t mutable reference <em>hoáº·c</em>
nhiá»u mutable reference.</li>
<li>Reference pháº£i luÃ´n há»£p lá»‡.</li>
</ul>
<p>Tiáº¿p theo, chÃºng ta sáº½ xem xÃ©t má»™t loáº¡i tham chiáº¿u khÃ¡c: slice.</p>
<div style="break-before: page; page-break-before: always;"></div><p><a id="the-slice-type"></a></p>
<h2 id="kiá»ƒu-slice"><a class="header" href="#kiá»ƒu-slice">Kiá»ƒu Slice</a></h2>
<p><em>Slice</em> cho phÃ©p báº¡n tham chiáº¿u má»™t chuá»—i cÃ¡c pháº§n tá»­ liá»n ká» trong má»™t collection
thay vÃ¬ toÃ n bá»™ collection. Má»™t slide lÃ  má»™t dáº¡ng reference, do Ä‘Ã³, nÃ³
khÃ´ng cÃ³ ownership.</p>
<p>ÄÃ¢y lÃ  má»™t váº¥n Ä‘á» láº­p trÃ¬nh nhá»: viáº¿t má»™t hÃ m nháº­n vÃ o má»™t chuá»—i
cÃ¡c tá»« Ä‘Æ°á»£c phÃ¢n tÃ¡ch báº±ng khoáº£ng tráº¯ng vÃ  tráº£ vá» tá»« Ä‘áº§u tiÃªn nÃ³ tÃ¬m tháº¥y trong chuá»—i Ä‘Ã³.
Náº¿u hÃ m khÃ´ng tÃ¬m tháº¥y khoáº£ng tráº¯ng trong chuá»—i, toÃ n bá»™ chuá»—i pháº£i lÃ 
má»™t tá»«, vÃ¬ váº­y toÃ n bá»™ chuá»—i sáº½ Ä‘Æ°á»£c tráº£ vá».</p>
<p>HÃ£y tÃ¬m hiá»ƒu cÃ¡ch chÃºng ta viáº¿t khai bÃ¡o hÃ m nÃ y mÃ  khÃ´ng cáº§n sá»­ dá»¥ng
slice, Ä‘á»ƒ hiá»ƒu váº¥n Ä‘á» mÃ  slice sáº½ giáº£i quyáº¿t:</p>
<pre><code class="language-rust ignore">fn first_word(s: &amp;String) -&gt; ?</code></pre>
<p>HÃ m <code>first_word</code> cÃ³ <code>&amp;String</code> lÃ m tham sá»‘. chÃºng tÃ´i khÃ´ng muá»‘n
ownership, vÃ¬ váº­y Ä‘iá»u nÃ y lÃ  tá»‘t. NhÆ°ng chÃºng ta nÃªn tráº£ vá» nhá»¯ng gÃ¬? ChÃºng ta
khÃ´ng thá»±c sá»± cÃ³ má»™t cÃ¡ch Ä‘á»ƒ nÃ³i vá» <em>pháº§n</em> cá»§a má»™t chuá»—i. Tuy nhiÃªn, chÃºng ta
cÃ³ thá»ƒ tráº£ vá» index cá»§a vá»‹ trÃ­ cuá»‘i tá»«, Ä‘Æ°á»£c biá»ƒu thá»‹ báº±ng khoáº£ng tráº¯ng. HÃ£y
thá»­ Ä‘iá»u Ä‘Ã³, nhÆ° trong Liá»‡t kÃª 4-7.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn first_word(s: &amp;String) -&gt; usize {
    let bytes = s.as_bytes();

    for (i, &amp;item) in bytes.iter().enumerate() {
        if item == b' ' {
            return i;
        }
    }

    s.len()
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p><span class="caption">Liá»‡t kÃª 4-7: HÃ m <code>first_word</code> tráº£ vá» má»™t
giÃ¡ trá»‹ byte index vÃ o tham sá»‘ <code>String</code></span></p>
<p>VÃ¬ chÃºng ta cáº§n Ä‘i qua tá»«ng pháº§n tá»­ <code>String</code> vÃ  kiá»ƒm tra xem
má»™t giÃ¡ trá»‹ cÃ³ lÃ  khoáº£ng tráº¯ng hay khÃ´ng, chÃºng ta sáº½ chuyá»ƒn
Ä‘á»•i <code>String</code> cá»§a mÃ¬nh thÃ nh má»™t máº£ng byte báº±ng cÃ¡ch sá»­ dá»¥ng
phÆ°Æ¡ng thá»©c <code>as_bytes</code>:</p>
<pre><code class="language-rust ignore"><span class="boring">fn first_word(s: &amp;String) -&gt; usize {
</span>    let bytes = s.as_bytes();
<span class="boring">
</span><span class="boring">    for (i, &amp;item) in bytes.iter().enumerate() {
</span><span class="boring">        if item == b' ' {
</span><span class="boring">            return i;
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    s.len()
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {}</span></code></pre>
<p>Tiáº¿p theo, chÃºng ta táº¡o má»™t iterator trÃªn máº£ng byte báº±ng phÆ°Æ¡ng thá»©c <code>iter</code>:</p>
<pre><code class="language-rust ignore"><span class="boring">fn first_word(s: &amp;String) -&gt; usize {
</span><span class="boring">    let bytes = s.as_bytes();
</span><span class="boring">
</span>    for (i, &amp;item) in bytes.iter().enumerate() {
<span class="boring">        if item == b' ' {
</span><span class="boring">            return i;
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    s.len()
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {}</span></code></pre>
<p>ChÃºng ta sáº½ tháº£o luáº­n chi tiáº¿t hÆ¡n vá» cÃ¡c iterator trong <a href="ch13-02-iterators.html">ChÆ°Æ¡ng 13</a><!-- ignore -->.
Hiá»‡n táº¡i, hÃ£y biáº¿t ráº±ng <code>iter</code> lÃ  má»™t phÆ°Æ¡ng thá»©c tráº£ vá» tá»«ng pháº§n tá»­ trong má»™t collection
vÃ  <code>enumerate</code> bao bá»c káº¿t quáº£ cá»§a <code>iter</code> vÃ  tráº£ vá» má»—i pháº§n tá»­ dÆ°á»›i dáº¡ng tuple.
Pháº§n tá»­ Ä‘áº§u tiÃªn cá»§a bá»™ dá»¯ liá»‡u Ä‘Æ°á»£c tráº£ vá» tá»«
<code>enumerate</code> lÃ  chá»‰ má»¥c vÃ  pháº§n tá»­ thá»© hai lÃ  tham chiáº¿u Ä‘áº¿n pháº§n tá»­.
Äiá»u nÃ y thuáº­n tiá»‡n hÆ¡n má»™t chÃºt so vá»›i viá»‡c tá»± tÃ­nh toÃ¡n index.</p>
<p>VÃ¬ phÆ°Æ¡ng thá»©c <code>enumerate</code> tráº£ vá» má»™t tuple, nÃªn chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c pattern (máº«u) Ä‘á»ƒ
há»§y tuple Ä‘Ã³. ChÃºng ta sáº½ tháº£o luáº­n nhiá»u hÆ¡n vá» cÃ¡c pattern trong <a href="ch06-02-match.html#patterns-that-bind-to-values">ChÆ°Æ¡ng
6</a><!-- ignore -->. Trong vÃ²ng láº·p <code>for</code>, chÃºng ta chá»‰ Ä‘á»‹nh má»™t pattern cÃ³ <code>i</code>
cho chá»‰ má»¥c trong tuple vÃ  <code>&amp;item</code> cho byte Ä‘Æ¡n trong tuple.
Bá»Ÿi vÃ¬ chÃºng tÃ´i nháº­n Ä‘Æ°á»£c tham chiáº¿u Ä‘áº¿n pháº§n tá»­ tá»« <code>.iter().enumerate()</code>, nÃªn chÃºng ta sá»­ dá»¥ng
<code>&amp;</code> trong pattern.</p>
<p>BÃªn trong vÃ²ng láº·p <code>for</code>, chÃºng ta tÃ¬m kiáº¿m byte Ä‘áº¡i diá»‡n cho khoáº£ng tráº¯ng báº±ng cÃ¡ch
sá»­ dá»¥ng cÃº phÃ¡p kÃ½ tá»± byte. Náº¿u tÃ¬m tháº¥y má»™t khoáº£ng trá»‘ng, chÃºng ta sáº½ tráº£ láº¡i vá»‹ trÃ­.
NgÆ°á»£c láº¡i, chÃºng tÃ´i tráº£ vá» Ä‘á»™ dÃ i cá»§a chuá»—i báº±ng cÃ¡ch sá»­ dá»¥ng <code>s.len()</code>:</p>
<pre><code class="language-rust ignore"><span class="boring">fn first_word(s: &amp;String) -&gt; usize {
</span><span class="boring">    let bytes = s.as_bytes();
</span><span class="boring">
</span><span class="boring">    for (i, &amp;item) in bytes.iter().enumerate() {
</span>        if item == b' ' {
            return i;
        }
    }

    s.len()
<span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {}</span></code></pre>
<p>BÃ¢y giá» chÃºng ta cÃ³ má»™t cÃ¡ch Ä‘á»ƒ tÃ¬m ra chá»‰ sá»‘ káº¿t thÃºc cá»§a tá»« Ä‘áº§u tiÃªn trong
chuá»—i, nhÆ°ng cÃ³ má»™t váº¥n Ä‘á». ChÃºng ta Ä‘ang tráº£ vá» má»™t <code>usize</code>, nhÆ°ng nÃ³
chá»‰ cÃ³ Ã½ nghÄ©a trong ngá»¯ cáº£nh cá»§a <code>&amp;String</code>. NÃ³i cÃ¡ch khÃ¡c,
bá»Ÿi vÃ¬ Ä‘Ã³ lÃ  má»™t giÃ¡ trá»‹ riÃªng biá»‡t tá»« <code>String</code>, nÃªn khÃ´ng cÃ³ gÃ¬ Ä‘áº£m báº£o ráº±ng nÃ³
váº«n sáº½ há»£p lá»‡ trong tÆ°Æ¡ng lai. HÃ£y xem xÃ©t chÆ°Æ¡ng trÃ¬nh trong Listing 4-8
sá»­ dá»¥ng hÃ m <code>first_word</code> tá»« Listing 4-7.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn first_word(s: &amp;String) -&gt; usize {
</span><span class="boring">    let bytes = s.as_bytes();
</span><span class="boring">
</span><span class="boring">    for (i, &amp;item) in bytes.iter().enumerate() {
</span><span class="boring">        if item == b' ' {
</span><span class="boring">            return i;
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    s.len()
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let mut s = String::from("hello world");

    let word = first_word(&amp;s); // word will get the value 5

    s.clear(); // this empties the String, making it equal to ""

    // word still has the value 5 here, but s no longer has any content that we
    // could meaningfully use with the value 5, so word is now totally invalid!
}</code></pre></pre>
<p><span class="caption">Listing 4-8: LÆ°u trá»¯ káº¿t quáº£ tá»« viá»‡c gá»i hÃ m
hÃ m <code>first_word</code> rá»“i thay Ä‘á»•i ná»™i dung <code>String</code></span></p>
<p>ChÆ°Æ¡ng trÃ¬nh nÃ y biÃªn dá»‹ch mÃ  khÃ´ng cÃ³ báº¥t ká»³ lá»—i nÃ o vÃ  cÅ©ng sáº½ váº­y náº¿u chÃºng ta sá»­ dá»¥ng <code>word</code>
sau khi gá»i <code>s.clear()</code>. Bá»Ÿi vÃ¬ <code>word</code> khÃ´ng Ä‘Æ°á»£c káº¿t ná»‘i vá»›i tráº¡ng thÃ¡i cá»§a <code>s</code>
hoÃ n toÃ n, <code>word</code> váº«n chá»©a giÃ¡ trá»‹ <code>5</code>. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng giÃ¡ trá»‹ <code>5</code> Ä‘Ã³ vá»›i
biáº¿n <code>s</code> Ä‘á»ƒ trÃ­ch xuáº¥t tá»« Ä‘áº§u tiÃªn, nhÆ°ng Ä‘Ã¢y sáº½ lÃ  má»™t lá»—i bá»Ÿi vÃ¬ ná»™i dung
cá»§a <code>s</code> Ä‘Ã£ thay Ä‘á»•i ká»ƒ tá»« khi chÃºng ta lÆ°u <code>5</code> trong <code>word</code>.</p>
<p>Viá»‡c pháº£i lo láº¯ng vá» index trong <code>word</code> khÃ´ng Ä‘á»“ng bá»™ vá»›i dá»¯ liá»‡u trong
<code>s</code> tháº­t chÃ¡n vÃ  dá»… bá»‹ lá»—i! Viá»‡c quáº£n lÃ½ cÃ¡c chá»‰ sá»‘ nÃ y tháº­m chÃ­ cÃ²n khÃ³ khÄƒn hÆ¡n náº¿u
chÃºng tÃ´i viáº¿t má»™t hÃ m <code>second_word</code>. Khai bÃ¡o cá»§a nÃ³ sáº½ pháº£i trÃ´ng nhÆ° tháº¿ nÃ y:</p>
<pre><code class="language-rust ignore">fn second_word(s: &amp;String) -&gt; (sá»­ dá»¥ng, sá»­ dá»¥ng) {</code></pre>
<p>BÃ¢y giá» chÃºng ta Ä‘ang theo dÃµi chá»‰ má»¥c báº¯t Ä‘áº§u <em>vÃ </em> káº¿t thÃºc, vÃ  chÃºng ta tháº­m chÃ­ cÃ²n cÃ³
cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c tÃ­nh toÃ¡n tá»« dá»¯ liá»‡u á»Ÿ má»™t tráº¡ng thÃ¡i cá»¥ thá»ƒ nhÆ°ng khÃ´ng bá»‹ rÃ ng buá»™c vá»›i
tráº¡ng thÃ¡i Ä‘Ã³. ChÃºng ta cÃ³ ba biáº¿n khÃ´ng liÃªn quan trÃ´i ná»•i xung quanh
cáº§n Ä‘Æ°á»£c giá»¯ Ä‘á»“ng bá»™ vá»›i nhau.</p>
<p>May máº¯n thay, Rust cÃ³ má»™t giáº£i phÃ¡p cho váº¥n Ä‘á» nÃ y: slide.</p>
<h3 id="string-slices"><a class="header" href="#string-slices">String Slices</a></h3>
<p>Má»™t <em>string slice</em> lÃ  má»™t tham chiáº¿u Ä‘áº¿n má»™t pháº§n cá»§a <code>String</code>, vÃ  nÃ³ trÃ´ng nhÆ° tháº¿ nÃ y:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let s = String::from("hello world");

    let hello = &amp;s[0..5];
    let world = &amp;s[6..11];
<span class="boring">}</span></code></pre></pre>
<p>Thay vÃ¬ reference Ä‘áº¿n toÃ n bá»™ <code>String</code>, <code>hello</code> lÃ  má»™t reference Ä‘áº¿n má»™t
pháº§n cá»§a <code>String</code>, Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong pháº§n <code>[0..5]</code>. ChÃºng ta táº¡o ra cÃ¡c slice
sá»­ dá»¥ng toÃ¡n tá»­ pháº¡m vi trong ngoáº·c báº±ng cÃ¡ch viáº¿t <code>[starting_index..ending_index]</code>,
trong Ä‘Ã³ <code>starting_index</code> lÃ  vá»‹ trÃ­ Ä‘áº§u tiÃªn trong slice vÃ  <code>ending_index</code> lÃ 
vá»‹ trÃ­ cuá»‘i cÃ¹ng + 1 trong slice. BÃªn trong, cáº¥u trÃºc dá»¯ liá»‡u slice
lÆ°u trá»¯ vá»‹ trÃ­ báº¯t Ä‘áº§u vÃ  Ä‘á»™ dÃ i cá»§a slice, tÆ°Æ¡ng á»©ng vá»›i <code>ending_index</code> trá»« <code>starting_index</code>.
VÃ¬ váº­y, trong trÆ°á»ng há»£p <code>let world = &amp;s[6..11];</code>, <code>world</code> sáº½ lÃ  má»™t slice chá»©a con trá» tá»›i
byte táº¡i index 6 cá»§a <code>s</code> vá»›i giÃ¡ trá»‹ Ä‘á»™ dÃ i lÃ  5.</p>
<p>HÃ¬nh 4-6 cho tháº¥y Ä‘iá»u nÃ y trong má»™t diagram.</p>
<img alt="world chá»©a con trá» tá»›i byte á»Ÿ chá»‰ sá»‘ 6 cá»§a String s vÃ  Ä‘á»™ dÃ i 5" src="img/trpl04-06.svg" class="center" style="width: 50%;" />
<p><span class="caption">HÃ¬nh 4-6: String slice tham chiáº¿u Ä‘áº¿n má»™t pháº§n cá»§a
<code>String</code></span></p>
<p>Vá»›i cÃº phÃ¡p pháº¡m vi <code>..</code> cá»§a Rust, náº¿u báº¡n muá»‘n báº¯t Ä‘áº§u tá»« chá»‰ sá»‘ 0, báº¡n cÃ³ thá»ƒ bá»
giÃ¡ trá»‹ trÆ°á»›c hai dáº¥u cháº¥m. NÃ³i cÃ¡ch khÃ¡c, chÃºng báº±ng nhau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s = String::from("hello");

let slice = &amp;s[0..2];
let slice = &amp;s[..2];
<span class="boring">}</span></code></pre></pre>
<p>TÆ°Æ¡ng tá»± nhÆ° váº­y, náº¿u slice cá»§a báº¡n bao gá»“m byte cuá»‘i cÃ¹ng cá»§a <code>String</code>, thÃ¬ báº¡n
cÃ³ thá»ƒ chá»‰ sá»‘ cuá»‘i. Äiá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  cÃ¡c lá»‡nh sau tÆ°Æ¡ng tá»± nhau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s = String::from("hello");

let len = s.len();

let slice = &amp;s[3..len];
let slice = &amp;s[3..];
<span class="boring">}</span></code></pre></pre>
<p>Báº¡n cÅ©ng cÃ³ thá»ƒ bá» cáº£ hai giÃ¡ trá»‹ Ä‘á»ƒ láº¥y má»™t pháº§n cá»§a toÃ n bá»™ chuá»—i:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s = String::from("hello");

let len = s.len();

let slice = &amp;s[0..len];
let slice = &amp;s[..];
<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>LÆ°u Ã½: Chá»‰ sá»‘ pháº¡m vi string slice pháº£i xuáº¥t hiá»‡n á»Ÿ vá»‹ trÃ­ lÃ  ranh giá»›i má»™t kÃ½ tá»± UTF-8 há»£p lá»‡.
Náº¿u báº¡n cá»‘ gáº¯ng táº¡o má»™t lÃ¡t cáº¯t chuá»—i á»Ÿ giá»¯a má»™t
kÃ½ tá»± multibyte, chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n sáº½ thoÃ¡t vá»›i má»™t lá»—i. Vá»›i má»¥c Ä‘Ã­ch
giá»›i thiá»‡u cÃ¡c string slice, chÃºng ta giáº£ sá»­ chá»‰ dÃ¹ng ASCII trong pháº§n nÃ y; Má»™t
tháº£o luáº­n ká»¹ lÆ°á»¡ng hÆ¡n vá» xá»­ lÃ½ UTF-8 cÃ³ trong <a href="ch08-02-strings.html#storing-utf-8-encoded-text-with-strings">â€œLÆ°u trá»¯ vÄƒn báº£n UTF-8 Encoded
vá»›i Stringâ€</a><!-- ignore --> pháº§n cá»§a ChÆ°Æ¡ng 8.</p>
</blockquote>
<p>Vá»›i táº¥t cáº£ nhá»¯ng thÃ´ng tin Ä‘Ã£ cÃ³, hÃ£y viáº¿t láº¡i <code>first_word</code> Ä‘á»ƒ tráº£ vá» má»™t
slice. Loáº¡i biá»ƒu thá»‹ â€œlÃ¡t cáº¯t chuá»—iâ€ Ä‘Æ°á»£c viáº¿t lÃ  <code>&amp;str</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn first_word(s: &amp;String) -&gt; &amp;str {
    let bytes = s.as_bytes();

    for (i, &amp;item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &amp;s[0..i];
        }
    }

    &amp;s[..]
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p>ChÃºng ta láº¥y chá»‰ má»¥c cho pháº§n cuá»‘i cá»§a tá»« giá»‘ng nhÆ° cÃ¡ch chÃºng ta Ä‘Ã£ lÃ m trong Liá»‡t kÃª
4-7, báº±ng cÃ¡ch tÃ¬m kiáº¿m sá»± xuáº¥t hiá»‡n Ä‘áº§u tiÃªn cá»§a khoáº£ng tráº¯ng. Khi tÃ¬m tháº¥y má»™t space, ta
tráº£ vá» má»™t string slice báº±ng cÃ¡ch sá»­ dá»¥ng pháº§n Ä‘áº§u cá»§a chuá»—i vÃ  index cá»§a space
nhÆ° cÃ¡c chá»‰ sá»‘ báº¯t Ä‘áº§u vÃ  káº¿t thÃºc.</p>
<p>BÃ¢y giá», khi gá»i <code>first_word</code>, chÃºng ta nháº­n láº¡i má»™t giÃ¡ trá»‹ duy nháº¥t Ä‘Æ°á»£c gáº¯n vá»›i
dá»¯ liá»‡u bÃªn dÆ°á»›i. GiÃ¡ trá»‹ Ä‘Æ°á»£c táº¡o thÃ nh tá»« má»™t tham chiáº¿u Ä‘áº¿n Ä‘iá»ƒm báº¯t Ä‘áº§u cá»§a
slice vÃ  sá»‘ pháº§n tá»­ trong slice.</p>
<p>Tráº£ vá» má»™t slice cÅ©ng sáº½ hoáº¡t Ä‘á»™ng Ä‘á»‘i vá»›i hÃ m <code>second_word</code>:</p>
<pre><code class="language-rust ignore">fn second_word(s: &amp;String) -&gt; &amp;str {</code></pre>
<p>BÃ¢y giá» chÃºng tÃ´i cÃ³ má»™t API Ä‘Æ¡n giáº£n, khÃ³ gÃ¢y ra ráº¯c rá»‘i hÆ¡n nhiá»u, vÃ¬
trÃ¬nh biÃªn dá»‹ch sáº½ Ä‘áº£m báº£o cÃ¡c tham chiáº¿u vÃ o <code>String</code> váº«n há»£p lá»‡. Nhá»›
lá»—i trong chÆ°Æ¡ng trÃ¬nh trong Liá»‡t kÃª 4-8, khi chÃºng ta láº¥y index Ä‘áº¿n cuá»‘i
tá»« Ä‘áº§u tiÃªn nhÆ°ng sau Ä‘Ã³ xÃ³a chuá»—i Ä‘á»ƒ index Ä‘Ã³ trá»Ÿ nÃªn khÃ´ng há»£p lá»‡? Äoáº¡n code Ä‘Ã³
khÃ´ng chÃ­nh xÃ¡c vá» máº·t logic nhÆ°ng khÃ´ng hiá»ƒn thá»‹ báº¥t ká»³ lá»—i ngay láº­p tá»©c nÃ o.
CÃ¡c váº¥n Ä‘á» sáº½ xuáº¥t hiá»‡n sau náº¿u chÃºng ta tiáº¿p tá»¥c cá»‘ gáº¯ng sá»­ dá»¥ng chá»‰ má»¥c tá»« Ä‘áº§u tiÃªn
vá»›i má»™t chuá»—i rá»—ng. CÃ¡c slide khiáº¿n lá»—i nÃ y khÃ´ng thá»ƒ xáº£y ra vÃ  cho ta biáº¿t
vá» cÃ¡c váº¥n Ä‘á» cá»§a code sá»›m hÆ¡n nhiá»u. Sá»­ dá»¥ng phiÃªn báº£n slide cá»§a <code>first_word</code> sáº½ táº¡o ra má»™t
lá»—i biÃªn dá»‹ch:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn first_word(s: &amp;String) -&gt; &amp;str {
</span><span class="boring">    let bytes = s.as_bytes();
</span><span class="boring">
</span><span class="boring">    for (i, &amp;item) in bytes.iter().enumerate() {
</span><span class="boring">        if item == b' ' {
</span><span class="boring">            return &amp;s[0..i];
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    &amp;s[..]
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let mut s = String::from("hello world");

    let word = first_word(&amp;s);

    s.clear(); // error!

    println!("the first word is: {word}");
}</code></pre>
<p>ÄÃ¢y lÃ  lá»—i biÃªn dá»‹ch:</p>
<pre><code class="language-console">$ cargo run
   Compiling ownership v0.1.0 (file:///projects/ownership)
error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
  --&gt; src/main.rs:18:5
   |
16 |     let word = first_word(&amp;s);
   |                           -- immutable borrow occurs here
17 |
18 |     s.clear(); // error!
   |     ^^^^^^^^^ mutable borrow occurs here
19 |
20 |     println!("the first word is: {word}");
   |                                  ------ immutable borrow later used here

For more information about this error, try `rustc --explain E0502`.
error: could not compile `ownership` (bin "ownership") due to 1 previous error
</code></pre>
<p>HÃ£y nhá»› láº¡i tá»« cÃ¡c quy táº¯c borrowing ráº±ng náº¿u ta cÃ³ má»™t immutable reference Ä‘áº¿n
má»™t cÃ¡i gÃ¬ Ä‘Ã³, ta cÅ©ng khÃ´ng thá»ƒ láº¥y má»™t mutable reference. Bá»Ÿi vÃ¬ <code>clear</code> cáº§n
cáº¯t bá»›t <code>String</code>, nÃ³ cáº§n láº¥y mutable reference. Lá»‡nh <code>println!</code> sau lá»‡nh gá»i <code>clear</code>
sá»­ dá»¥ng tham chiáº¿u trong <code>word</code>, vÃ¬ váº­y giÃ¡ trá»‹ immutable reference váº«n Ä‘ang
Ä‘Æ°á»£c sá»­ dá»¥ng táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³. Rust khÃ´ng cho phÃ©p thay Ä‘á»•i
tham chiáº¿u trong <code>clear</code> vÃ  immutable reference trong <code>word</code> cÃ¹ng lÃºc
vÃ  viá»‡c biÃªn dá»‹ch sáº½ khÃ´ng thÃ nh cÃ´ng. Rust khÃ´ng chá»‰ lÃ m cho API cá»§a chÃºng
ta dá»… sá»­ dá»¥ng hÆ¡n, mÃ  nÃ³ cÃ²n loáº¡i bá» toÃ n bá»™ cÃ¡c lá»—i táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch!</p>
<h4 id="string-literals-are-slices"><a class="header" href="#string-literals-are-slices">String Literals Are Slices</a></h4>
<p>Nhá»› láº¡i ráº±ng chÃºng ta Ä‘Ã£ nÃ³i vá» string literal Ä‘Æ°á»£c lÆ°u trá»¯ bÃªn trong dá»¯ liá»‡u nhá»‹ phÃ¢n. Hiá»‡n nay
mÃ  chÃºng ta biáº¿t vá» slice, chÃºng ta cÃ³ thá»ƒ hiá»ƒu Ä‘Ãºng vá» string literal:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s = "Hello, world!";
<span class="boring">}</span></code></pre></pre>
<p>Kiá»ƒu cá»§a <code>s</code> á»Ÿ Ä‘Ã¢y lÃ  <code>&amp;str</code>: Ä‘Ã³ lÃ  má»™t slice trá» Ä‘áº¿n má»™t Ä‘iá»ƒm cá»¥ thá»ƒ cá»§a giÃ¡ trá»‹
nhá»‹ phÃ¢n. ÄÃ¢y cÅ©ng lÃ  lÃ½ do táº¡i sao string literal lÃ  báº¥t biáº¿n; <code>&amp;str</code> lÃ  má»™t
immutable reference.</p>
<h4 id="string-slices-as-parameters"><a class="header" href="#string-slices-as-parameters">String Slices as Parameters</a></h4>
<p>Khi Ä‘Ã£ biáº¿t ráº±ng báº¡n cÃ³ thá»ƒ láº¥y slice cá»§a cÃ¡c literal vÃ  giÃ¡ trá»‹ cá»§a <code>String</code>, ta sáº½ tháº¥y thÃªm
má»™t cáº£i tiáº¿n ná»¯a trÃªn <code>first_word</code>, vÃ  Ä‘Ã¢y lÃ  chá»¯ kÃ½ cá»§a nÃ³:</p>
<pre><code class="language-rust ignore">fn first_word(s: &amp;String) -&gt; &amp;str {</code></pre>
<p>Má»™t Rustacean cÃ³ kinh nghiá»‡m hÆ¡n sáº½ viáº¿t chá»¯ kÃ½ nhÆ° trong Listing 4-9
vÃ¬ nÃ³ cho phÃ©p chÃºng ta sá»­ dá»¥ng cÃ¹ng má»™t chá»©c nÄƒng trÃªn cáº£ hai giÃ¡ trá»‹ <code>&amp;String</code>
vÃ  cÃ¡c giÃ¡ trá»‹ <code>&amp;str</code>.</p>
<pre><code class="language-rust ignore">fn first_word(s: &amp;str) -&gt; &amp;str {
<span class="boring">    let bytes = s.as_bytes();
</span><span class="boring">
</span><span class="boring">    for (i, &amp;item) in bytes.iter().enumerate() {
</span><span class="boring">        if item == b' ' {
</span><span class="boring">            return &amp;s[0..i];
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    &amp;s[..]
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let my_string = String::from("hello world");
</span><span class="boring">
</span><span class="boring">    // `first_word` works on slices of `String`s, whether partial or whole.
</span><span class="boring">    let word = first_word(&amp;my_string[0..6]);
</span><span class="boring">    let word = first_word(&amp;my_string[..]);
</span><span class="boring">    // `first_word` also works on references to `String`s, which are equivalent
</span><span class="boring">    // to whole slices of `String`s.
</span><span class="boring">    let word = first_word(&amp;my_string);
</span><span class="boring">
</span><span class="boring">    let my_string_literal = "hello world";
</span><span class="boring">
</span><span class="boring">    // `first_word` works on slices of string literals, whether partial or
</span><span class="boring">    // whole.
</span><span class="boring">    let word = first_word(&amp;my_string_literal[0..6]);
</span><span class="boring">    let word = first_word(&amp;my_string_literal[..]);
</span><span class="boring">
</span><span class="boring">    // Because string literals *are* string slices already,
</span><span class="boring">    // this works too, without the slice syntax!
</span><span class="boring">    let word = first_word(my_string_literal);
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 4-9: Cáº£i thiá»‡n chá»©c nÄƒng <code>first_word</code> báº±ng cÃ¡ch sá»­ dá»¥ng
má»™t slice cho kiá»ƒu cá»§a tham sá»‘ <code>s</code></span></p>
<p>Náº¿u chÃºng ta cÃ³ má»™t string slice, chÃºng ta cÃ³ thá»ƒ truyá»n nÃ³ trá»±c tiáº¿p. Náº¿u chÃºng ta cÃ³ <code>String</code>,
chÃºng ta cÃ³ thá»ƒ chuyá»ƒn má»™t slice cá»§a <code>String</code> hoáº·c tham chiáº¿u Ä‘áº¿n <code>String</code>. Sá»± linh hoáº¡t nÃ y
cho phÃ©p ta táº­n dá»¥ng <em>deref coercions</em>, má»™t tÃ­nh nÄƒng mÃ  chÃºng tÃ´i sáº½ Ä‘á» cáº­p trong
pháº§n <a href="ch15-02-deref.html#implicit-deref-coercions-with-functions-and-methods">â€œImplicit Deref Coercions with Functions and
Methodsâ€</a><!--ignore--> trong chÆ°Æ¡ng 15.
Viá»‡c xÃ¡c Ä‘á»‹nh má»™t function láº¥y má»™t string slice thay vÃ¬ tham chiáº¿u Ä‘áº¿n <code>String</code> giÃºp cho
API cá»§a chÃºng ta trá»Ÿ nÃªn tá»•ng quÃ¡t vÃ  há»¯u Ã­ch hÆ¡n mÃ  khÃ´ng lÃ m máº¥t báº¥t ká»³ tÃ­nh nÄƒng nÃ o:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn first_word(s: &amp;str) -&gt; &amp;str {
</span><span class="boring">    let bytes = s.as_bytes();
</span><span class="boring">
</span><span class="boring">    for (i, &amp;item) in bytes.iter().enumerate() {
</span><span class="boring">        if item == b' ' {
</span><span class="boring">            return &amp;s[0..i];
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    &amp;s[..]
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let my_string = String::from("hello world");

    // `first_word` works on slices of `String`s, whether partial or whole.
    let word = first_word(&amp;my_string[0..6]);
    let word = first_word(&amp;my_string[..]);
    // `first_word` also works on references to `String`s, which are equivalent
    // to whole slices of `String`s.
    let word = first_word(&amp;my_string);

    let my_string_literal = "hello world";

    // `first_word` works on slices of string literals, whether partial or
    // whole.
    let word = first_word(&amp;my_string_literal[0..6]);
    let word = first_word(&amp;my_string_literal[..]);

    // Because string literals *are* string slices already,
    // this works too, without the slice syntax!
    let word = first_word(my_string_literal);
}</code></pre></pre>
<h3 id="other-slices"><a class="header" href="#other-slices">Other Slices</a></h3>
<p>CÃ¡c string slice, nhÆ° báº¡n cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng, lÃ  dÃ nh riÃªng cho chuá»—i. NhÆ°ng cÅ©ng cÃ³ má»™t
loáº¡i slice tá»•ng quÃ¡t hÆ¡n, quÃ¡. HÃ£y xem xÃ©t máº£ng nÃ y:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let a = [1, 2, 3, 4, 5];
<span class="boring">}</span></code></pre></pre>
<p>CÅ©ng tÆ°Æ¡ng tá»± nhÆ° khi ta muá»‘n tham chiáº¿u Ä‘áº¿n má»™t pháº§n cá»§a chuá»—i, ta cÅ©ng cÃ³ thá»ƒ muá»‘n
tham chiáº¿u thÃ nh má»™t pháº§n cá»§a máº£ng. Khi Ä‘Ã³ ta sáº½ lÃ m nhÆ° váº­y nhÆ° tháº¿ nÃ y:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let a = [1, 2, 3, 4, 5];

let slice = &amp;a[1..3];

assert_eq!(slice, &amp;[2, 3]);
<span class="boring">}</span></code></pre></pre>
<p>Slice nÃ y cÃ³ kiá»ƒu <code>&amp;[i32]</code>. NÃ³ hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° cÃ¡c string slice, báº±ng cÃ¡ch
lÆ°u trá»¯ tham chiáº¿u Ä‘áº¿n pháº§n tá»­ Ä‘áº§u tiÃªn vÃ  Ä‘á»™ dÃ i. Báº¡n sáº½ sá»­ dá»¥ng kiá»ƒu
slice nÃ y cho táº¥t cáº£ cÃ¡c kiá»ƒu collection khÃ¡c. ChÃºng ta sáº½ tháº£o luáº­n vá» nhá»¯ng collection nÃ y
chi tiáº¿t hÆ¡n khi nÃ³i vá» vector trong ChÆ°Æ¡ng 8.</p>
<h2 id="tá»•ng-káº¿t-2"><a class="header" href="#tá»•ng-káº¿t-2">Tá»•ng káº¿t</a></h2>
<p>CÃ¡c khÃ¡i niá»‡m vá» ownership, borrowing vÃ  slice Ä‘áº£m báº£o an toÃ n cho bá»™ nhá»› trong
chÆ°Æ¡ng trÃ¬nh Rust táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch. NgÃ´n ngá»¯ Rust cho phÃ©p báº¡n kiá»ƒm soÃ¡t
viá»‡c sá»­ dá»¥ng bá»™ nhá»› giá»‘ng nhÆ° trong cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh há»‡ thá»‘ng khÃ¡c, nhÆ°ng cÃ³
owner cá»§a dá»¯ liá»‡u sáº½ tá»± Ä‘á»™ng giáº£i phÃ³ng dá»¯ liá»‡u Ä‘Ã³ khi owner vÆ°á»£t quÃ¡ pháº¡m vi,
cÃ³ nghÄ©a lÃ  báº¡n khÃ´ng pháº£i viáº¿t vÃ  debug thÃªm code Ä‘á»ƒ cÃ³ quyá»n kiá»ƒm soÃ¡t nÃ y.</p>
<p>Ownership áº£nh hÆ°á»Ÿng Ä‘áº¿n sá»‘ lÆ°á»£ng cÃ¡c pháº§n khÃ¡c cá»§a Rust khi hoáº¡t Ä‘á»™ng, vÃ¬ váº­y
chÃºng ta sáº½ nÃ³i vá» nhá»¯ng khÃ¡i niá»‡m nÃ y sÃ¢u hÆ¡n trong suá»‘t pháº§n cÃ²n láº¡i cá»§a cuá»‘n sÃ¡ch.
HÃ£y chuyá»ƒn sang ChÆ°Æ¡ng 5 vÃ  xem xÃ©t viá»‡c nhÃ³m cÃ¡c pháº§n dá»¯ liá»‡u láº¡i vá»›i nhau
trong má»™t <code>struct</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sá»­-dá»¥ng-struct-Ä‘á»ƒ-cáº¥u-trÃºc-dá»¯-liá»‡u-liÃªn-quan"><a class="header" href="#sá»­-dá»¥ng-struct-Ä‘á»ƒ-cáº¥u-trÃºc-dá»¯-liá»‡u-liÃªn-quan">Sá»­ dá»¥ng Struct Ä‘á»ƒ cáº¥u trÃºc dá»¯ liá»‡u liÃªn quan</a></h1>
<p><em>struct</em> hoáº·c <em>structure</em>, lÃ  má»™t kiá»ƒu dá»¯ liá»‡u tÃ¹y chá»‰nh cho phÃ©p báº¡n Ä‘Ã³ng gÃ³i
cÃ¹ng nhau vÃ  Ä‘áº·t tÃªn cho nhiá»u giÃ¡ trá»‹ cÃ³ liÃªn quan táº¡o nÃªn má»™t nhÃ³m cÃ³ Ã½ nghÄ©a. Náº¿u nhÆ°
báº¡n Ä‘Ã£ quen thuá»™c vá»›i má»™t ngÃ´n ngá»¯ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng, <em>struct</em> giá»‘ng nhÆ° má»™t
thuá»™c tÃ­nh dá»¯ liá»‡u cá»§a Ä‘á»‘i tÆ°á»£ng. Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ so sÃ¡nh vÃ  Ä‘á»‘i chiáº¿u cÃ¡c tuple
vá»›i struct Ä‘á»ƒ xÃ¢y dá»±ng dá»±a trÃªn nhá»¯ng gÃ¬ báº¡n Ä‘Ã£ biáº¿t vÃ  minh há»a khi nÃ o cÃ¡c struct
Ä‘Æ°á»£c sá»­ dá»¥ng tá»‘t hÆ¡n Ä‘á»ƒ nhÃ³m dá»¯ liá»‡u.</p>
<p>ChÃºng ta sáº½ trÃ¬nh bÃ y cÃ¡ch Ä‘á»‹nh nghÄ©a vÃ  khá»Ÿi táº¡o struct. ChÃºng ta sáº½ tháº£o luáº­n lÃ m tháº¿ nÃ o Ä‘á»ƒ
xÃ¡c Ä‘á»‹nh cÃ¡c function liÃªn quan, Ä‘áº·c biá»‡t lÃ  cÃ¡c function Ä‘Æ°á»£c gá»i lÃ 
<em>method</em>, Ä‘á»ƒ chá»‰ Ä‘á»‹nh hÃ nh vi Ä‘Æ°á»£c liÃªn káº¿t vá»›i kiá»ƒu struct. Struct vÃ  enums
(Ä‘Æ°á»£c tháº£o luáº­n trong ChÆ°Æ¡ng 6) lÃ  cÃ¡c khá»‘i xÃ¢y dá»±ng Ä‘á»ƒ táº¡o cÃ¡c kiá»ƒu dá»¯ liá»‡u má»›i trong
chÆ°Æ¡ng trÃ¬nh Ä‘á»ƒ táº­n dá»¥ng tá»‘i Ä‘a kháº£ nÄƒng kiá»ƒm tra kiá»ƒu trong thá»i gian biÃªn dá»‹ch cá»§a Rust.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="Äá»‹nh-nghÄ©a-vÃ -khá»Ÿi-táº¡o-cÃ¡c-cáº¥u-trÃºc"><a class="header" href="#Äá»‹nh-nghÄ©a-vÃ -khá»Ÿi-táº¡o-cÃ¡c-cáº¥u-trÃºc">Äá»‹nh nghÄ©a vÃ  khá»Ÿi táº¡o cÃ¡c cáº¥u trÃºc</a></h2>
<p>Struct (cáº¥u trÃºc) tÆ°Æ¡ng tá»± nhÆ° tuple, Ä‘Æ°á»£c tháº£o luáº­n trong pháº§n <a href="ch03-02-data-types.html#the-tuple-type">â€œThe Tuple Typeâ€</a><!--
ignore -->, trong Ä‘Ã³ cáº£ hai Ä‘á»u chá»©a nhá»¯ng giÃ¡ trá»‹ liÃªn quan. Giá»‘ng nhÆ° cÃ¡c tuple, cÃ¡c
cÃ¡c pháº§n cá»§a má»™t cáº¥u trÃºc cÃ³ thá»ƒ lÃ  cÃ¡c kiá»ƒu khÃ¡c nhau. KhÃ´ng giá»‘ng nhÆ° vá»›i tuple, trong má»™t cáº¥u trÃºc
báº¡n sáº½ Ä‘áº·t tÃªn cho tá»«ng pháº§n dá»¯ liá»‡u Ä‘á»ƒ hiá»ƒu rÃµ Ã½ nghÄ©a cá»§a cÃ¡c giÃ¡ trá»‹. Viá»‡c thÃªm tÃªn
cho nhá»¯ng thÃ nh pháº§n bÃªn trong giÃºp nÃ³ cÃ³ cáº¥u trÃºc linh hoáº¡t hÆ¡n tuple: báº¡n khÃ´ng cáº§n pháº£i dá»±a vÃ o
thá»© tá»± cá»§a dá»¯ liá»‡u Ä‘á»ƒ truy cáº­p vÃ o cÃ¡c giÃ¡ trá»‹ cá»§a má»™t instance (thá»ƒ hiá»‡n).</p>
<p>Äá»ƒ Ä‘á»‹nh nghÄ©a má»™t struct, chÃºng ta nháº­p tá»« khÃ³a <code>struct</code> vÃ  Ä‘áº·t tÃªn cho toÃ n bá»™ struct.
TÃªn cá»§a má»™t cáº¥u trÃºc pháº£i mÃ´ táº£ má»¥c Ä‘Ã­ch quan trá»ng nháº¥t cá»§a pháº§n dá»¯ liá»‡u nÃ³ chá»©a. Sau Ä‘Ã³, bÃªn trong dáº¥u
ngoáº·c nhá»n, chÃºng ta xÃ¡c Ä‘á»‹nh tÃªn vÃ  kiá»ƒu cá»§a cÃ¡c pháº§n dá»¯ liá»‡u mÃ  chÃºng tÃ´i gá»i lÃ  <em>field</em> (trÆ°á»ng).
VÃ­ dá»¥, Listing 5-1 cho tháº¥y má»™t struct lÆ°u trá»¯ thÃ´ng tin vá» tÃ i khoáº£n ngÆ°á»i dÃ¹ng.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct User {
    active: bool,
    username: String,
    email: String,
    sign_in_count: u64,
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p><span class="caption">Listing 5-1: Äá»‹nh nghÄ©a cáº¥u trÃºc <code>User</code></span></p>
<p>Äá»ƒ sá»­ dá»¥ng má»™t struct sau khi Ä‘Ã£ Ä‘á»‹nh nghÄ©a, chÃºng ta táº¡o má»™t <em>instance</em> cá»§a cáº¥u trÃºc Ä‘Ã³
báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh cÃ¡c giÃ¡ trá»‹ cá»¥ thá»ƒ cho tá»«ng trÆ°á»ng. ChÃºng tÃ´i táº¡o má»™t vÃ­ dá»¥ báº±ng cÃ¡ch
nÃªu tÃªn cá»§a cáº¥u trÃºc vÃ  sau Ä‘Ã³ thÃªm dáº¥u ngoáº·c nhá»n chá»©a cÃ¡c cáº·p <em>key:value</em>,
trong Ä‘Ã³ cÃ¡c key lÃ  tÃªn cá»§a cÃ¡c field vÃ  cÃ¡c value lÃ  dá»¯ liá»‡u chÃºng ta muá»‘n
lÆ°u trong cÃ¡c trÆ°á»ng Ä‘Ã³. ChÃºng ta khÃ´ng pháº£i chá»‰ Ä‘á»‹nh cÃ¡c field theo
cÃ¹ng thá»© tá»± mÃ  chÃºng ta Ä‘Ã£ khai bÃ¡o chÃºng trong cáº¥u trÃºc. NÃ³i cÃ¡ch khÃ¡c, má»™t
Ä‘á»‹nh nghÄ©a cáº¥u trÃºc giá»‘ng nhÆ° má»™t hÃ¬nh máº«u chung cho má»™t kiá»ƒu vÃ  cÃ¡c instance
gÃ¡n vÃ o trong hÃ¬nh máº«u Ä‘Ã³ cÃ¡c dá»¯ liá»‡u cá»¥ thá»ƒ Ä‘á»ƒ táº¡o cÃ¡c giÃ¡ trá»‹ cá»§a kiá»ƒu.
VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ khai bÃ¡o má»™t user cá»¥ thá»ƒ nhÆ° trong Listing 5-2.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct User {
</span><span class="boring">    active: bool,
</span><span class="boring">    username: String,
</span><span class="boring">    email: String,
</span><span class="boring">    sign_in_count: u64,
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let user1 = User {
        active: true,
        username: String::from("someusername123"),
        email: String::from("someone@example.com"),
        sign_in_count: 1,
    };
}</code></pre></pre>
<p><span class="caption">Listing 5-2: Táº¡o má»™t instance cá»§a cáº¥u trÃºc <code>User</code></span></p>
<p>Äá»ƒ láº¥y má»™t giÃ¡ trá»‹ cá»¥ thá»ƒ tá»« má»™t struct, chÃºng ta sá»­ dá»¥ng kÃ½ hiá»‡u dáº¥u cháº¥m. VÃ­ dá»¥, Ä‘á»ƒ
truy cáº­p Ä‘á»‹a chá»‰ email cá»§a user nÃ y, chÃºng ta sá»­ dá»¥ng <code>user1.email</code>. Náº¿u instance lÃ 
mutable (cÃ³ thá»ƒ thay Ä‘á»•i), chÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i má»™t giÃ¡ trá»‹ báº±ng cÃ¡ch sá»­ dá»¥ng
kÃ½ hiá»‡u dáº¥u cháº¥m vÃ  gÃ¡n vÃ o má»™t field cá»¥ thá»ƒ. Listing kÃª 5-3 cho tháº¥y cÃ¡ch
thay Ä‘á»•i giÃ¡ trá»‹ trong field <code>email</code> cá»§a má»™t mutable instance <code>User</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct User {
</span><span class="boring">    active: bool,
</span><span class="boring">    username: String,
</span><span class="boring">    email: String,
</span><span class="boring">    sign_in_count: u64,
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let mut user1 = User {
        active: true,
        username: String::from("someusername123"),
        email: String::from("someone@example.com"),
        sign_in_count: 1,
    };

    user1.email = String::from("anotheremail@example.com");
}</code></pre></pre>
<p><span class="caption">Listing 5-3: Thay Ä‘á»•i giÃ¡ trá»‹ trÆ°á»ng <code>email</code> cá»§a má»™t instance <code>User</code></span></p>
<p>LÆ°u Ã½ ráº±ng toÃ n bá»™ instance pháº£i mutable; Rust khÃ´ng cho phÃ©p chÃºng ta Ä‘Ã¡nh dáº¥u
chá»‰ má»™t sá»‘ trÆ°á»ng nháº¥t Ä‘á»‹nh lÃ  mutable. NhÆ° vá»›i báº¥t ká»³ biá»ƒu thá»©c nÃ o, chÃºng ta
cÃ³ thá»ƒ táº¡o má»™t instance má»›i cá»§a cáº¥u trÃºc vá»›i biá»ƒu thá»©c cuá»‘i cÃ¹ng trong thÃ¢n hÃ m
Ä‘á»ƒ tráº£ láº¡i má»™t cÃ¡ch rÃµ rÃ ng instance má»›i Ä‘Ã³.</p>
<p>Listing 5-4 biá»ƒu diá»…n má»™t hÃ m <code>build_user</code> tráº£ vá» má»™t instance kiá»ƒu <code>User</code> vá»›i
email vÃ  tÃªn ngÆ°á»i dÃ¹ng Ä‘Ã£ cho. TrÆ°á»ng <code>active</code> nháº­n giÃ¡ trá»‹ <code>true</code> vÃ 
<code>sign_in_count</code> nháº­n giÃ¡ trá»‹ <code>1</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct User {
</span><span class="boring">    active: bool,
</span><span class="boring">    username: String,
</span><span class="boring">    email: String,
</span><span class="boring">    sign_in_count: u64,
</span><span class="boring">}
</span><span class="boring">
</span>fn build_user(email: String, username: String) -&gt; User {
    User {
        active: true,
        username: username,
        email: email,
        sign_in_count: 1,
    }
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let user1 = build_user(
</span><span class="boring">        String::from("someone@example.com"),
</span><span class="boring">        String::from("someusername123"),
</span><span class="boring">    );
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 5-4: Má»™t hÃ m <code>build_user</code> nháº­n vÃ o má»™t email vÃ 
username vÃ  tráº£ vá» má»™t <code>User</code> instance</span></p>
<p>Sáº½ lÃ  cÃ³ nghÄ©a khi Ä‘áº·t tÃªn cÃ¡c tham sá»‘ cá»§a function vá»›i tÃªn trÃ¹ng vá»›i tÃªn cÃ¡c
trÆ°á»ng cá»§a struct, nhÆ°ng viá»‡c láº·p láº¡i cÃ¡c tÃªn nhÆ° <code>email</code> vÃ  <code>username</code> cÅ©ng sáº½
gÃ¢y nhÃ m chÃ¡n. Náº¿u struct cÃ³ thÃªm nhiá»u field ná»¯a, viá»‡c láº·p Ä‘i láº·p láº¡i chÃºng sáº½
cÃ²n gÃ¢y khÃ³ chá»‹u hÆ¡n. May thay, Rust cÃ³ má»™t cÃ¡ch viáº¿t ngáº¯n gá»n!</p>
<!-- Old heading. Do not remove or links may break. -->
<p><a id="using-the-field-init-shorthand-when-variables-and-fields-have-the-same-name"></a></p>
<h3 id="sá»­-dá»¥ng-cÃ¡ch-viáº¿t-khá»Ÿi-táº¡o-trÆ°á»ng-má»™t-cÃ¡ch-ngáº¯n-gá»n"><a class="header" href="#sá»­-dá»¥ng-cÃ¡ch-viáº¿t-khá»Ÿi-táº¡o-trÆ°á»ng-má»™t-cÃ¡ch-ngáº¯n-gá»n">Sá»­ dá»¥ng cÃ¡ch viáº¿t khá»Ÿi táº¡o trÆ°á»ng má»™t cÃ¡ch ngáº¯n gá»n</a></h3>
<p>VÃ¬ tÃªn tham sá»‘ vÃ  tÃªn trÆ°á»ng cá»§a cáº¥u trÃºc hoÃ n toÃ n giá»‘ng nhau trong
Listing 5-4, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃº phÃ¡p tá»‘c kÃ½ <em>field init</em> Ä‘á»ƒ viáº¿t láº¡i
<code>build_user</code> giÃºp nÃ³ hoáº¡t Ä‘á»™ng giá»‘ng há»‡t nhÆ°ng khÃ´ng cÃ³ sá»± láº·p láº¡i cá»§a
<code>username</code> vÃ  <code>email</code>, nhÆ° trong Listing 5-5.</p>
<p><span class="filename">TÃªn tá»‡p: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct User {
</span><span class="boring">    active: bool,
</span><span class="boring">    username: String,
</span><span class="boring">    email: String,
</span><span class="boring">    sign_in_count: u64,
</span><span class="boring">}
</span><span class="boring">
</span>fn build_user(email: String, username: String) -&gt; User {
    User {
        active: true,
        username,
        email,
        sign_in_count: 1,
    }
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let user1 = build_user(
</span><span class="boring">        String::from("someone@example.com"),
</span><span class="boring">        String::from("someusername123"),
</span><span class="boring">    );
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 5-5: HÃ m <code>build_user</code> sá»­ dá»¥ng cÃ¡ch viáº¿t táº¯t Ä‘á»ƒ khá»Ÿi táº¡o
vÃ¬ tham sá»‘ <code>username</code> vÃ  <code>email</code> cÃ³ cÃ¹ng tÃªn vá»›i field</span></p>
<p>á» Ä‘Ã¢y, chÃºng ta táº¡o má»™t instance má»›i cá»§a cáº¥u trÃºc <code>User</code>, cÃ³ field
tÃªn lÃ  <code>email</code>. ChÃºng ta muá»‘n Ä‘áº·t giÃ¡ trá»‹ cá»§a <code>email</code> thÃ nh giÃ¡ trá»‹ trong
tham sá»‘ <code>email</code> cá»§a hÃ m <code>build_user</code>. VÃ¬ trÆ°á»ng <code>email</code> vÃ 
tham sá»‘ <code>email</code> trÃ¹ng tÃªn ta chá»‰ cáº§n viáº¿t <code>email</code> lÃ  Ä‘Æ°á»£c
hÆ¡n <code>email: email</code>.</p>
<p><a id="creating-instances-from-other-instances-with-struct-update-syntax"></a></p>
<h3 id="táº¡o-instance-má»›i-tá»«-má»™t-instance-khÃ¡c-vá»›i-cÃº-phÃ¡p-cáº­p-nháº­t-cáº¥u-trÃºc"><a class="header" href="#táº¡o-instance-má»›i-tá»«-má»™t-instance-khÃ¡c-vá»›i-cÃº-phÃ¡p-cáº­p-nháº­t-cáº¥u-trÃºc">Táº¡o instance má»›i tá»« má»™t instance khÃ¡c vá»›i cÃº phÃ¡p cáº­p nháº­t cáº¥u trÃºc</a></h3>
<p>Má»™t thao tÃ¡c thÆ°á»ng lÃ m lÃ  táº¡o má»›i má»™t instance cá»§a Struct vá»›i háº§u háº¿t
cÃ¡c giÃ¡ trá»‹ tá»« má»™t phiÃªn báº£n khÃ¡c, vá»›i má»™t sá»‘ thay Ä‘á»•i. Báº¡n cÃ³ thá»ƒ lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng
<em>cÃº phÃ¡p cáº­p nháº­t cáº¥u trÃºc</em> (struct update syntax).</p>
<p>Äáº§u tiÃªn, trong Listing 5-6, chÃºng tÃ´i trÃ¬nh bÃ y cÃ¡ch táº¡o má»™t instance <code>User</code> má»›i trong <code>user2</code>
theo cÃ¡ch thÃ´ng thÆ°á»ng, khÃ´ng dÃ¹ng cÃº phÃ¡p cáº­p nháº­t. ChÃºng tÃ´i Ä‘áº·t má»™t giÃ¡ trá»‹ má»›i cho <code>email</code> nhÆ°ng
sá»­ dá»¥ng cÃ¹ng cÃ¡c giÃ¡ trá»‹ khÃ¡c tá»« <code>user1</code> mÃ  chÃºng ta Ä‘Ã£ táº¡o trong Listing 5-2.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct User {
</span><span class="boring">    active: bool,
</span><span class="boring">    username: String,
</span><span class="boring">    email: String,
</span><span class="boring">    sign_in_count: u64,
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    // --snip--
<span class="boring">
</span><span class="boring">    let user1 = User {
</span><span class="boring">        email: String::from("someone@example.com"),
</span><span class="boring">        username: String::from("someusername123"),
</span><span class="boring">        active: true,
</span><span class="boring">        sign_in_count: 1,
</span><span class="boring">    };
</span>
    let user2 = User {
        active: user1.active,
        username: user1.username,
        email: String::from("another@example.com"),
        sign_in_count: user1.sign_in_count,
    };
}</code></pre></pre>
<p><span class="caption">Listing 5-6: Táº¡o má»™t instance <code>User</code> má»›i dÃ¹ng giÃ¡ trá»‹ tá»«  <code>user1</code></span></p>
<p>Sá»­ dá»¥ng struct update syntax, chÃºng ta cÃ³ thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c cÃ¹ng má»¥c Ä‘Ã­ch vá»›i Ã­t code hÆ¡n, nhÆ° thá»ƒ
hiá»‡n trong Listing 5-7. CÃº phÃ¡p <code>..</code> chá»‰ Ä‘á»‹nh ráº±ng cÃ¡c trÆ°á»ng cÃ²n láº¡i khÃ´ng
Ä‘Æ°á»£c Ä‘áº·t rÃµ rÃ ng pháº£i cÃ³ cÃ¹ng giÃ¡ trá»‹ vá»›i cÃ¡c trÆ°á»ng trong instance Ä‘Ã£ cho.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct User {
</span><span class="boring">    active: bool,
</span><span class="boring">    username: String,
</span><span class="boring">    email: String,
</span><span class="boring">    sign_in_count: u64,
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    // --snip--
<span class="boring">
</span><span class="boring">    let user1 = User {
</span><span class="boring">        email: String::from("someone@example.com"),
</span><span class="boring">        username: String::from("someusername123"),
</span><span class="boring">        active: true,
</span><span class="boring">        sign_in_count: 1,
</span><span class="boring">    };
</span>
    let user2 = User {
        email: String::from("another@example.com"),
        ..user1
    };
}</code></pre></pre>
<p><span class="caption">Listing 5-7: Sá»­ dá»¥ng struct update syntax Ä‘á»ƒ Ä‘áº·t má»›i
giÃ¡ trá»‹ <code>email</code> cho instance <code>User</code> nhÆ°ng sá»­ dá»¥ng pháº§n cÃ²n láº¡i cá»§a cÃ¡c giÃ¡ trá»‹ tá»«
<code>user1</code></span></p>
<p>Äoáº¡n code trong Listing 5-7 cÅ©ng táº¡o má»™t instance trong <code>user2</code> vá»›i má»™t giÃ¡ trá»‹ khÃ¡c trong
<code>email</code> nhÆ°ng cÃ³ cÃ¹ng giÃ¡ trá»‹ trong <code>username</code>, <code>active</code>, vÃ  <code>sign_in_count</code> tá»«<code>user1</code>.
<code>..user1</code> pháº£i Ä‘Æ°á»£c viáº¿t cuá»‘i cÃ¹ng Ä‘á»ƒ chá»‰ Ä‘á»‹nh ráº±ng má»i trÆ°á»ng cÃ²n láº¡i sáº½ nháº­n giÃ¡ trá»‹ cá»§a chÃºng tá»«
cÃ¡c trÆ°á»ng tÆ°Æ¡ng á»©ng trong <code>user1</code>, nhÆ°ng chÃºng ta cÃ³ thá»ƒ chá»n chá»‰ Ä‘á»‹nh giÃ¡ trá»‹ cho
nhiá»u trÆ°á»ng nhÆ° chÃºng ta muá»‘n theo báº¥t ká»³ thá»© tá»± nÃ o, báº¥t ká»ƒ thá»© tá»± cá»§a chÃºng trong
Ä‘á»‹nh nghÄ©a cá»§a cáº¥u trÃºc.</p>
<p>LÆ°u Ã½ ráº±ng cÃº phÃ¡p cáº­p nháº­t cáº¥u trÃºc sá»­ dá»¥ng <code>=</code> nhÆ° má»™t phÃ©p gÃ¡n; Ä‘iá»u nÃ y lÃ  bá»Ÿi vÃ¬
nÃ³ di chuyá»ƒn dá»¯ liá»‡u, giá»‘ng nhÆ° chÃºng ta Ä‘Ã£ tháº¥y trong pháº§n <a href="ch04-01-what-is-ownership.html#variables-and-data-interacting-with-move">â€œVariables and Data Interacting with
Moveâ€</a><!-- ignore -->. Trong vÃ­ dá»¥ nÃ y, chÃºng ta khÃ´ng cÃ²n cÃ³ thá»ƒ sá»­ dá»¥ng
<code>user1</code> sau khi táº¡o <code>user2</code> vÃ¬ <code>String</code> trong TrÆ°á»ng <code>username</code> cá»§a <code>user1</code> Ä‘Ã£
Ä‘Æ°á»£c chuyá»ƒn vÃ o <code>user2</code>. Náº¿u chÃºng ta gÃ¡n <code>user2</code> má»™t giÃ¡ trá»‹ <code>String</code> má»›i cho cáº£ trÆ°á»ng <code>email</code>
vÃ  <code>username</code>, cÃ³ nghÄ©a lÃ  ta chá»‰ láº¥y <code>active</code> vÃ  <code>sign_in_count</code> tá»« <code>user1</code>, khi Ä‘Ã³
<code>user1</code> váº«n há»£p lá»‡ sau khi táº¡o <code>user2</code>. ÄÃ³ lÃ  vÃ¬ cáº£ hai <code>active</code> vÃ  <code>sign_in_count</code>
Ä‘á»u implement <code>Copy</code> trait, do váº­y cÃ¡c hÃ nh vi nhÆ° ta Ä‘Ã£ tháº£o luáº­ trong pháº§n
<a href="ch04-01-what-is-ownership.html#stack-only-data-copy">â€œStack-Only Data: Copyâ€</a><!-- ignore --> sáº½ Ä‘Æ°á»£c Ã¡p dá»¥ng.</p>
<p><a id="using-tuple-structs-without-named-fields-to-create-different-types"></a></p>
<h3 id="sá»­-dá»¥ng-tuple-struct-khÃ´ng-dÃ¹ng-cÃ¡c-trÆ°á»ng-Ä‘Æ°á»£c-Ä‘áº·t-tÃªn-Ä‘á»ƒ-táº¡o-cÃ¡c-kiá»ƒu-khÃ¡c"><a class="header" href="#sá»­-dá»¥ng-tuple-struct-khÃ´ng-dÃ¹ng-cÃ¡c-trÆ°á»ng-Ä‘Æ°á»£c-Ä‘áº·t-tÃªn-Ä‘á»ƒ-táº¡o-cÃ¡c-kiá»ƒu-khÃ¡c">Sá»­ dá»¥ng tuple struct khÃ´ng dÃ¹ng cÃ¡c trÆ°á»ng Ä‘Æ°á»£c Ä‘áº·t tÃªn Ä‘á»ƒ táº¡o cÃ¡c kiá»ƒu khÃ¡c</a></h3>
<p>Rust cÅ©ng há»— trá»£ cÃ¡c cáº¥u trÃºc trÃ´ng tÆ°Æ¡ng tá»± nhÆ° cÃ¡c tuple, Ä‘Æ°á»£c gá»i lÃ  <em>tuple structs</em>.
CÃ¡c tuple struct cho phÃ©p cung cáº¥p tÃªn cho cáº¥u trÃºc nhÆ°ng khÃ´ng cÃ³ cÃ¡c tÃªn Ä‘Æ°á»£c káº¿t há»£p vá»›i tá»«ng
trÆ°á»ng bÃªn trong struct; thay vÃ¬ váº­y, chÃºng chá»‰ cÃ³ cÃ¡c kiá»ƒu cho cÃ¡c field Ä‘Ã³.
CÃ¡c tuple struct ráº¥t há»¯u Ã­ch khi báº¡n muá»‘n Ä‘áº·t tÃªn cho toÃ n bá»™ tuple vÃ  biáº¿n nÃ³ thÃ nh
má»™t kiá»ƒu khÃ¡c vá»›i cÃ¡c tuple khÃ¡c, vÃ  khi Ä‘áº·t tÃªn cho tá»«ng field bÃªn trong struct
nhÆ° trong má»™t cáº¥u trÃºc thÃ´ng thÆ°á»ng sáº½ trá»Ÿ nÃªn dÃ i dÃ²ng hoáº·c dÆ° thá»«a.</p>
<p>Äá»ƒ Ä‘á»‹nh nghÄ©a tuple struct, hÃ£y báº¯t Ä‘áº§u vá»›i tá»« khÃ³a <code>struct</code> vÃ  tÃªn cáº¥u trÃºc
theo sau lÃ  cÃ¡c kiá»ƒu trong tuple. VÃ­ dá»¥, á»Ÿ Ä‘Ã¢y chÃºng ta Ä‘á»‹nh nghÄ©a vÃ  sá»­ dá»¥ng hai
tuple struct cÃ³ tÃªn <code>Color</code> vÃ  <code>Point</code>:</p>
<p>Rust cÅ©ng há»— trá»£ cÃ¡c cáº¥u trÃºc trÃ´ng giá»‘ng nhÆ° cÃ¡c bá»™ dá»¯ liá»‡u, Ä‘Æ°á»£c gá»i lÃ  <em>tuple structs</em>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct Color(i32, i32, i32);
struct Point(i32, i32, i32);

fn main() {
    let black = Color(0, 0, 0);
    let origin = Point(0, 0, 0);
}</code></pre></pre>
<p>LÆ°u Ã½ ráº±ng cÃ¡c giÃ¡ trá»‹ <code>black</code> vÃ  <code>origin</code> cÃ³ cÃ¡c kiá»ƒu khÃ¡c nhau vÃ¬ chÃºng
lÃ  instance cá»§a cÃ¡c tuple struct khÃ¡c nhau. Má»—i struct báº¡n Ä‘á»‹nh nghÄ©a mang kiá»ƒu riÃªng cá»§a nÃ³,
máº·c dÃ¹ cÃ¡c trÆ°á»ng trong struct cÃ³ thá»ƒ cÃ³ cÃ¹ng loáº¡i. VÃ­ dá»¥, má»™t hÃ m nháº­n tham sá»‘ kiá»ƒu <code>Color</code> khÃ´ng thá»ƒ nháº­n
<code>Point</code> lÃ m Ä‘á»‘i sá»‘, máº·c dÃ¹ cáº£ hai loáº¡i Ä‘á»u Ä‘Æ°á»£c táº¡o thÃ nh tá»« ba giÃ¡ trá»‹ <code>i32</code>.
Máº·t khÃ¡c, cÃ¡c instance tuple struct tÆ°Æ¡ng tá»± nhÆ° tuple á»Ÿ chá»— báº¡n cÃ³ thá»ƒ
há»§y struct chÃºng thÃ nh cÃ¡c pháº§n riÃªng láº» vÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng dáº¥u <code>.</code> theo sau
theo chá»‰ má»¥c Ä‘á»ƒ truy cáº­p tá»«ng giÃ¡ trá»‹ riÃªng.</p>
<h3 id="cÃ¡c-cáº¥u-trÃºc-unit-like-khÃ´ng-cÃ³-báº¥t-ká»³-trÆ°á»ng-nÃ o"><a class="header" href="#cÃ¡c-cáº¥u-trÃºc-unit-like-khÃ´ng-cÃ³-báº¥t-ká»³-trÆ°á»ng-nÃ o">CÃ¡c cáº¥u trÃºc Unit-Like khÃ´ng cÃ³ báº¥t ká»³ trÆ°á»ng nÃ o</a></h3>
<p>Báº¡n cÅ©ng cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c cáº¥u trÃºc khÃ´ng cÃ³ báº¥t ká»³ trÆ°á»ng nÃ o! ChÃºng Ä‘Æ°á»£c gá»i lÃ 
<em>unit-like struct</em> vÃ¬ chÃºng hoáº¡t Ä‘á»™ng tÆ°Æ¡ng tá»± nhÆ° <code>()</code>, kiá»ƒu Ä‘Æ¡n vá»‹
chÃºng ta Ä‘Ã£ Ä‘á» cáº­p trong pháº§n <a href="ch03-02-data-types.html#the-tuple-type">â€œThe Tuple Typeâ€</a><!-- ignore -->. Unit-like
struct cÃ³ thá»ƒ há»¯u Ã­ch khi báº¡n cáº§n triá»ƒn khai má»™t trait trÃªn má»™t sá»‘ kiá»ƒu nhÆ°ng khÃ´ng
cÃ³ báº¥t ká»³ dá»¯ liá»‡u nÃ o mÃ  báº¡n muá»‘n lÆ°u trá»¯ trong chÃ­nh kiá»ƒu Ä‘Ã³. ChÃºng ta sáº½ tháº£o luáº­n vá» trait
trong ChÆ°Æ¡ng 10. ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ vá» khai bÃ¡o vÃ  khá»Ÿi táº¡o má»™t unit struct
Ä‘Æ°á»£c Ä‘áº·t tÃªn lÃ  <code>AlwaysEqual</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct AlwaysEqual;

fn main() {
    let subject = AlwaysEqual;
}</code></pre></pre>
<p>Äá»ƒ Ä‘á»‹nh nghÄ©a <code>AlwaysEqual</code>, chÃºng ta sá»­ dá»¥ng tá»« khÃ³a <code>struct</code>, tÃªn chÃºng ta muá»‘n vÃ 
sau Ä‘Ã³ lÃ  dáº¥u cháº¥m pháº©y. KhÃ´ng cáº§n dáº¥u ngoáº·c nhá»n hoáº·c dáº¥u ngoáº·c Ä‘Æ¡n!
Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c má»™t instance vá» <code>AlwaysEqual</code> trong biáº¿n <code>subject</code>
theo cÃ¡ch tÆ°Æ¡ng tá»±: sá»­ dá»¥ng tÃªn chÃºng ta Ä‘Ã£ xÃ¡c Ä‘á»‹nh, khÃ´ng cÃ³ báº¥t ká»³ dáº¥u ngoáº·c
nhá»n hoáº·c dáº¥u ngoáº·c Ä‘Æ¡n nÃ o. HÃ£y tÆ°á»Ÿng tÆ°á»£ng ráº±ng sau nÃ y chÃºng tÃ´i sáº½ triá»ƒn khai
hÃ nh vi cho kiá»ƒu nÃ y sao cho má»i instance cá»§a <code>AlwaysEqual</code> luÃ´n báº±ng vá»›i má»i instance
cá»§a báº¥t ká»³ kiá»ƒu nÃ o khÃ¡c, cÃ³ láº½ Ä‘á»ƒ cÃ³ má»™t káº¿t quáº£ xÃ¡c Ä‘á»‹nh nháº±m má»¥c Ä‘Ã­ch thá»­ nghiá»‡m.
ChÃºng ta sáº½ khÃ´ng cáº§n báº¥t ká»³ dá»¯ liá»‡u nÃ o Ä‘á»ƒ thá»±c hiá»‡n hÃ nh vi Ä‘Ã³! Báº¡n sáº½ tháº¥y trong
ChÆ°Æ¡ng 10 cÃ¡ch Ä‘á»‹nh nghÄ©a cÃ¡c trait vÃ  triá»ƒn khai chÃºng trÃªn báº¥t ká»³ kiá»ƒu dá»¯ liá»‡u nÃ o,
ká»ƒ cáº£ cÃ¡c unit-like struct.</p>
<section class="note" aria-role="note">
<h3 id="sá»Ÿ-há»¯u-cá»§a-cÃ¡c-cáº¥u-trÃºc-dá»¯-liá»‡u"><a class="header" href="#sá»Ÿ-há»¯u-cá»§a-cÃ¡c-cáº¥u-trÃºc-dá»¯-liá»‡u">Sá»Ÿ há»¯u cá»§a cÃ¡c cáº¥u trÃºc dá»¯ liá»‡u</a></h3>
<p>Trong Ä‘á»‹nh nghÄ©a cáº¥u trÃºc <code>User</code> trong Listing 5-1, chÃºng ta Ä‘Ã£ sá»­ dá»¥ng kiá»ƒu <code>String</code>
type thay vÃ¬ kiá»ƒu string slice <code>&amp;str</code>. ÄÃ¢y lÃ  má»™t sá»± lá»±a chá»n cÃ³ chá»§ Ã½
bá»Ÿi vÃ¬ chÃºng ta muá»‘n má»—i instance cá»§a cáº¥u trÃºc nÃ y sá»Ÿ há»¯u táº¥t cáº£ dá»¯ liá»‡u cá»§a nÃ³ vÃ  cho
dá»¯ liá»‡u Ä‘Ã³ lÃ  há»£p lá»‡ miá»…n sao toÃ n bá»™ cáº¥u trÃºc lÃ  há»£p lá»‡.</p>
<p>CÃ¡c cáº¥u trÃºc cÅ©ng cÃ³ thá»ƒ lÆ°u trá»¯ cÃ¡c tham chiáº¿u Ä‘áº¿n dá»¯ liá»‡u thuá»™c sá»Ÿ há»¯u cá»§a má»™t thá»© gÃ¬ Ä‘Ã³
khÃ¡c, nhÆ°ng Ä‘á»ƒ lÃ m nhÆ° váº­y yÃªu cáº§u sá»­ dá»¥ng <em>lifetimes</em>, má»™t tÃ­nh nÄƒng cá»§a Rust mÃ  chÃºng ta sáº½
tháº£o luáº­n trong ChÆ°Æ¡ng 10. <em>lifetimes</em> Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u Ä‘Æ°á»£c tham chiáº¿u bá»Ÿi má»™t cáº¥u trÃºc
sáº½ lÃ  há»£p lá»‡ cÃ¹ng vá»›i chÃ­nh cáº¥u trÃºc Ä‘Ã³ . Giáº£ sá»­ báº¡n cá»‘ gáº¯ng lÆ°u trá»¯ má»™t tham chiáº¿u
trong má»™t cáº¥u trÃºc mÃ  khÃ´ng chá»‰ Ä‘á»‹nh thá»i gian tá»“n táº¡i giá»‘ng nhÆ° sau; chÃºng sáº½ khÃ´ng hoáº¡t Ä‘á»™ng:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<!-- CAN'T EXTRACT SEE https://github.com/rust-lang/mdBook/issues/1127 -->
<pre><code class="language-rust ignore does_not_compile">struct User {
    active: bool,
    username: &amp;str,
    email: &amp;str,
    sign_in_count: u64,
}

fn main() {
    let user1 = User {
        active: true,
        username: "someusername123",
        email: "someone@example.com",
        sign_in_count: 1,
    };
}</code></pre>
<p>TrÃ¬nh duyá»‡t sáº½ bÃ¡o lá»—i ráº±ng báº¡n cáº§n cÃ¡c khai bÃ¡o vá» lifetime:</p>
<pre><code class="language-console">$ cargo run
   Compiling structs v0.1.0 (file:///projects/structs)
error[E0106]: missing lifetime specifier
 --&gt; src/main.rs:3:15
  |
3 |     username: &amp;str,
  |               ^ expected named lifetime parameter
  |
help: consider introducing a named lifetime parameter
  |
1 ~ struct User&lt;'a&gt; {
2 |     active: bool,
3 ~     username: &amp;'a str,
  |

error[E0106]: missing lifetime specifier
 --&gt; src/main.rs:4:12
  |
4 |     email: &amp;str,
  |            ^ expected named lifetime parameter
  |
help: consider introducing a named lifetime parameter
  |
1 ~ struct User&lt;'a&gt; {
2 |     active: bool,
3 |     username: &amp;str,
4 ~     email: &amp;'a str,
  |

For more information about this error, try `rustc --explain E0106`.
error: could not compile `structs` due to 2 previous errors
</code></pre>
<p>Trong chÆ°Æ¡ng 10, chÃºng ta sáº½ tháº£o luáº­n cÃ¡ch sá»­a cÃ¡c lá»—i trÃªn, cho phÃ©p báº¡n
lÆ°u cÃ¡c tham chiáº¿u bÃªn trong cÃ¡c struct, nhÆ°ng hiá»‡n táº¡i, chÃºng ta sáº½ sá»­a cÃ¡c
lá»—i nÃ y báº±ng cÃ¡ch dÃ¹ng cÃ¡c kiá»ƒu Ä‘Æ°á»£c sá»Ÿ há»¯u nhÆ° <code>String</code> thay vÃ¬ dÃ¹ng tham
chiáº¿u nhÆ° <code>&amp;str</code>.</p>
</section>
<!-- manual-regeneration
for the error above
after running update-rustc.sh:
pbcopy < listings/ch05-using-structs-to-structure-related-data/no-listing-02-reference-in-struct/output.txt
paste above
add `> ` before every line -->
<div style="break-before: page; page-break-before: always;"></div><h2 id="má»™t-chÆ°Æ¡ng-trÃ¬nh-minh-há»a-sá»­-dá»¥ng-struct"><a class="header" href="#má»™t-chÆ°Æ¡ng-trÃ¬nh-minh-há»a-sá»­-dá»¥ng-struct">Má»™t ChÆ°Æ¡ng TrÃ¬nh Minh Há»a Sá»­ Dá»¥ng Struct</a></h2>
<p>Äá»ƒ hiá»ƒu khi nÃ o chÃºng ta nÃªn sá»­ dá»¥ng struct, hÃ£y viáº¿t má»™t chÆ°Æ¡ng trÃ¬nh tÃ­nh
diá»‡n tÃ­ch cá»§a má»™t hÃ¬nh chá»¯ nháº­t. ChÃºng ta sáº½ báº¯t Ä‘áº§u báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c
biáº¿n Ä‘Æ¡n, sau Ä‘Ã³ lÃ m láº¡i chÆ°Æ¡ng trÃ¬nh cho Ä‘áº¿n khi sá»­ dá»¥ng struct.</p>
<p>HÃ£y táº¡o má»™t dá»± Ã¡n binary má»›i vá»›i Cargo gá»i lÃ  <em>rectangles</em> Ä‘á»ƒ nháº­n chiá»u rá»™ng
vÃ  chiá»u cao cá»§a má»™t hÃ¬nh chá»¯ nháº­t Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh báº±ng pixel vÃ  tÃ­nh diá»‡n tÃ­ch
cá»§a hÃ¬nh chá»¯ nháº­t Ä‘Ã³. Code á»Ÿ Listing 5-8 hiá»ƒn thá»‹ má»™t chÆ°Æ¡ng trÃ¬nh ngáº¯n cÃ³ má»™t
cÃ¡ch lÃ m nhÆ° váº­y trong file <em>src/main.rs</em> cá»§a dá»± Ã¡n cá»§a chÃºng ta.</p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let width1 = 30;
    let height1 = 50;

    println!(
        "The area of the rectangle is {} square pixels.",
        area(width1, height1)
    );
}

fn area(width: u32, height: u32) -&gt; u32 {
    width * height
}</code></pre></pre>
<p><span class="caption">Listing 5-8: TÃ­nh diá»‡n tÃ­ch cá»§a hÃ¬nh chá»¯ nháº­t Ä‘Æ°á»£c chá»‰
Ä‘á»‹nh bá»Ÿi cÃ¡c biáº¿n chiá»u rá»™ng vÃ  chiá»u cao riÃªng láº»</span></p>
<p>Giá» cháº¡y chÆ°Æ¡ng trÃ¬nh nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng <code>cargo run</code>:</p>
<pre><code class="language-console">$ cargo run
   Compiling rectangles v0.1.0 (file:///projects/rectangles)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.42s
     Running `target/debug/rectangles`
The area of the rectangle is 1500 square pixels.
</code></pre>
<p>MÃ£ nÃ y thÃ nh cÃ´ng trong viá»‡c tÃ­nh diá»‡n tÃ­ch cá»§a hÃ¬nh chá»¯ nháº­t báº±ng cÃ¡ch gá»i hÃ m <code>area</code> vá»›i má»—i chiá»u, nhÆ°ng chÃºng ta cÃ³ thá»ƒ lÃ m thÃªm Ä‘á»ƒ lÃ m cho mÃ£ nÃ y rÃµ rÃ ng vÃ  dá»… Ä‘á»c hÆ¡n.</p>
<p>Váº¥n Ä‘á» cá»§a mÃ£ nÃ y rÃµ rÃ ng trong chá»¯ kÃ½ cá»§a <code>area</code>:</p>
<pre><code class="language-rust ignore"><span class="boring">fn main() {
</span><span class="boring">    let width1 = 30;
</span><span class="boring">    let height1 = 50;
</span><span class="boring">
</span><span class="boring">    println!(
</span><span class="boring">        "The area of the rectangle is {} square pixels.",
</span><span class="boring">        area(width1, height1)
</span><span class="boring">    );
</span><span class="boring">}
</span><span class="boring">
</span>fn area(width: u32, height: u32) -&gt; u32 {
<span class="boring">    width * height
</span><span class="boring">}</span></code></pre>
<p>HÃ m <code>area</code> Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ tÃ­nh diá»‡n tÃ­ch cá»§a má»™t hÃ¬nh chá»¯ nháº­t, nhÆ°ng hÃ m
mÃ  chÃºng ta Ä‘Ã£ viáº¿t cÃ³ hai tham sá»‘ vÃ  khÃ´ng rÃµ á»Ÿ Ä‘Ã¢u trong chÆ°Æ¡ng trÃ¬nh
cá»§a chÃºng ta ráº±ng cÃ¡c tham sá»‘ nÃ y cÃ³ liÃªn quan. Viá»‡c nhÃ³m chiá»u rá»™ng vÃ 
chiá»u cao láº¡i vá»›i nhau sáº½ lÃ m cho mÃ£ nÃ y dá»… Ä‘á»c vÃ  quáº£n lÃ½ hÆ¡n. ChÃºng ta
Ä‘Ã£ tháº£o luáº­n má»™t cÃ¡ch lÃ m nhÆ° váº­y trong <a href="ch03-02-data-types.html#the-tuple-type">â€œThe Tuple Typeâ€</a><!-- ignore -->
trong ChÆ°Æ¡ng 3: sá»­ dá»¥ng tuples.</p>
<h3 id="tÃ¡i-cáº¥u-trÃºc-vá»›i-tuple"><a class="header" href="#tÃ¡i-cáº¥u-trÃºc-vá»›i-tuple">TÃ¡i Cáº¥u TrÃºc vá»›i Tuple</a></h3>
<p>Listing 5-9 hiá»ƒn thá»‹ má»™t phiÃªn báº£n khÃ¡c cá»§a chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta sá»­ dá»¥ng tuple.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let rect1 = (30, 50);

    println!(
        "The area of the rectangle is {} square pixels.",
        area(rect1)
    );
}

fn area(dimensions: (u32, u32)) -&gt; u32 {
    dimensions.0 * dimensions.1
}</code></pre></pre>
<p><span class="caption">Listing 5-9: XÃ¡c Ä‘á»‹nh chiá»u rá»™ng vÃ  chiá»u cao cá»§a hÃ¬nh chá»¯ nháº­t báº±ng tuple</span></p>
<p>á» má»™t cÃ¡ch, chÆ°Æ¡ng trÃ¬nh nÃ y tá»‘t hÆ¡n. Tuple cho phÃ©p chÃºng ta thÃªm má»™t chÃºt
cáº¥u trÃºc vÃ  giá» Ä‘Ã¢y chÃºng ta chá»‰ Ä‘ang truyá»n má»™t Ä‘á»‘i sá»‘. NhÆ°ng theo má»™t cÃ¡ch khÃ¡c,
phiÃªn báº£n nÃ y láº¡i Ã­t rÃµ rÃ ng: tuples khÃ´ng Ä‘áº·t tÃªn cho cÃ¡c pháº§n tá»­ cá»§a chÃºng,
vÃ¬ váº­y chÃºng ta pháº£i sá»­ dá»¥ng chá»‰ má»¥c vÃ o cÃ¡c pháº§n cá»§a tuple, lÃ m cho phÃ©p tÃ­nh
toÃ¡n cá»§a chÃºng ta Ã­t rÃµ rÃ ng hÆ¡n.</p>
<p>Viá»‡c nháº§m láº«n giá»¯a chiá»u rá»™ng vÃ  chiá»u cao cÃ³ thá»ƒ khÃ´ng quan trá»ng Ä‘á»‘i
vá»›i viá»‡c tÃ­nh diá»‡n tÃ­ch, nhÆ°ng náº¿u chÃºng ta muá»‘n váº½ hÃ¬nh chá»¯ nháº­t
lÃªn mÃ n hÃ¬nh, Ä‘iá»u Ä‘Ã³ sáº½ quan trá»ng! ChÃºng ta sáº½ pháº£i nhá»› ráº±ng width
lÃ  chá»‰ má»¥c 0 cá»§a tuple vÃ  <code>height</code> lÃ  chá»‰ má»¥c <code>1</code> cá»§a tuple. Äiá»u nÃ y sáº½ lÃ m
cho ngÆ°á»i khÃ¡c khÃ³ khÄƒn hÆ¡n khi cá»‘ gáº¯ng hiá»ƒu vÃ  giá»¯ mÃ£ cá»§a chÃºng ta.
Bá»Ÿi vÃ¬ chÃºng ta chÆ°a truyá»n Ä‘áº¡t Ã½ nghÄ©a cá»§a dá»¯ liá»‡u trong mÃ£ cá»§a chÃºng ta,
viá»‡c giá»›i thiá»‡u lá»—i giá» Ä‘Ã¢y dá»… dÃ ng hÆ¡n.</p>
<h3 id="tÃ¡i-cáº¥u-trÃºc-vá»›i-structs-thÃªm-nhiá»u-Ã-nghÄ©a-hÆ¡n"><a class="header" href="#tÃ¡i-cáº¥u-trÃºc-vá»›i-structs-thÃªm-nhiá»u-Ã-nghÄ©a-hÆ¡n">TÃ¡i Cáº¥u TrÃºc vá»›i Structs: ThÃªm Nhiá»u Ã NghÄ©a HÆ¡n</a></h3>
<p>ChÃºng ta sá»­ dá»¥ng structs Ä‘á»ƒ thÃªm Ã½ nghÄ©a báº±ng cÃ¡ch Ä‘áº·t tÃªn cho dá»¯ liá»‡u. ChÃºng ta
cÃ³ thá»ƒ chuyá»ƒn Ä‘á»•i tuple chÃºng ta Ä‘ang sá»­ dá»¥ng thÃ nh má»™t struct cÃ³ tÃªn cho toÃ n bá»™
cÅ©ng nhÆ° tÃªn cho cÃ¡c pháº§n, nhÆ° thá»ƒ hiá»‡n trong Listing 5-10.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!(
        "The area of the rectangle is {} square pixels.",
        area(&amp;rect1)
    );
}

fn area(rectangle: &amp;Rectangle) -&gt; u32 {
    rectangle.width * rectangle.height
}</code></pre></pre>
<p><span class="caption">Listing 5-10: Äá»‹nh nghÄ©a má»™t struct <code>Rectangle</code></span></p>
<p>Here weâ€™ve defined a struct and named it <code>Rectangle</code>. Inside the curly
brackets, we defined the fields as <code>width</code> and <code>height</code>, both of which have
type <code>u32</code>. Then, in <code>main</code>, we created a particular instance of <code>Rectangle</code>
that has a width of <code>30</code> and a height of <code>50</code>.</p>
<p>Our <code>area</code> function is now defined with one parameter, which weâ€™ve named
<code>rectangle</code>, whose type is an immutable borrow of a struct <code>Rectangle</code>
instance. As mentioned in Chapter 4, we want to borrow the struct rather than
take ownership of it. This way, <code>main</code> retains its ownership and can continue
using <code>rect1</code>, which is the reason we use the <code>&amp;</code> in the function signature and
where we call the function.</p>
<p>The <code>area</code> function accesses the <code>width</code> and <code>height</code> fields of the <code>Rectangle</code>
instance (note that accessing fields of a borrowed struct instance does not
move the field values, which is why you often see borrows of structs). Our
function signature for <code>area</code> now says exactly what we mean: calculate the area
of <code>Rectangle</code>, using its <code>width</code> and <code>height</code> fields. This conveys that the
width and height are related to each other, and it gives descriptive names to
the values rather than using the tuple index values of <code>0</code> and <code>1</code>. This is a
win for clarity.</p>
<p>á» Ä‘Ã¢y, chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a má»™t struct vÃ  Ä‘áº·t tÃªn cho nÃ³ lÃ  <code>Rectangle</code>.
BÃªn trong dáº¥u ngoáº·c nhá»n, chÃºng ta Ä‘Ã£ xÃ¡c Ä‘á»‹nh cÃ¡c trÆ°á»ng lÃ  <code>width</code> vÃ  <code>height</code>,
cáº£ hai Ä‘á»u cÃ³ kiá»ƒu <code>u32</code>. Sau Ä‘Ã³, trong hÃ m <code>main</code>, chÃºng ta Ä‘Ã£ táº¡o má»™t instance
cá»¥ thá»ƒ cá»§a <code>Rectangle</code> cÃ³ chiá»u rá»™ng lÃ  <code>30</code> vÃ  chiá»u cao lÃ  <code>50</code>.</p>
<p>HÃ m <code>area</code> cá»§a chÃºng ta giá» Ä‘Ã¢y Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a vá»›i má»™t tham sá»‘, mÃ  chÃºng ta
Ä‘Ã£ Ä‘áº·t tÃªn lÃ  rectangle, kiá»ƒu dá»¯ liá»‡u cá»§a nÃ³ lÃ  má»™t borrow khÃ´ng thá»ƒ thay Ä‘á»•i
(immutable borrow) cá»§a má»™t thá»ƒ hiá»‡n cá»§a struct <code>Rectangle</code>. NhÆ° Ä‘Ã£ Ä‘á» cáº­p
trong ChÆ°Æ¡ng 4, chÃºng ta muá»‘n mÆ°á»£n (borrow) struct thay vÃ¬ sá»Ÿ há»¯u nÃ³. Äiá»u nÃ y
giÃºp cho hÃ m main giá»¯ quyá»n sá»Ÿ há»¯u vÃ  cÃ³ thá»ƒ tiáº¿p tá»¥c sá»­ dá»¥ng rect1, Ä‘Ã³ lÃ  lÃ½ do
chÃºng ta sá»­ dá»¥ng kÃ½ hiá»‡u &amp; trong chá»¯ kÃ½ hÃ m vÃ  á»Ÿ nÆ¡i chÃºng ta gá»i hÃ m.</p>
<p>HÃ m area truy cáº­p cÃ¡c trÆ°á»ng <code>width</code> vÃ  <code>height</code> cá»§a thá»ƒ hiá»‡n <code>Rectangle</code> (lÆ°u Ã½ ráº±ng
viá»‡c truy cáº­p cÃ¡c trÆ°á»ng cá»§a má»™t thá»ƒ hiá»‡n struct Ä‘Ã£ Ä‘Æ°á»£c mÆ°á»£n khÃ´ng di chuyá»ƒn
giÃ¡ trá»‹ trÆ°á»ng, Ä‘Ã³ lÃ  lÃ½ do táº¡i sao báº¡n thÆ°á»ng tháº¥y viá»‡c mÆ°á»£n struct). Chá»¯ kÃ½ hÃ m
cho area bÃ¢y giá» diá»…n Ä‘áº¡t Ä‘Ãºng Ã½ chÃºng ta: tÃ­nh diá»‡n tÃ­ch cá»§a <code>Rectangle</code>, sá»­ dá»¥ng
cÃ¡c trÆ°á»ng <code>width</code> vÃ  <code>height</code> cá»§a nÃ³. Äiá»u nÃ y truyá»n Ä‘áº¡t ráº±ng chiá»u rá»™ng vÃ  chiá»u cao
cÃ³ liÃªn quan Ä‘áº¿n nhau, vÃ  nÃ³ Ä‘áº·t tÃªn mÃ´ táº£ cho cÃ¡c giÃ¡ trá»‹ thay vÃ¬ sá»­ dá»¥ng chá»‰ má»¥c
tuple lÃ  <code>0</code> vÃ  <code>1</code>. Äiá»u nÃ y lÃ  má»™t chiáº¿n tháº¯ng vá» sá»± rÃµ rÃ ng.</p>
<h3 id="thÃªm-chá»©c-nÄƒng-há»¯u-Ãch-vá»›i-cÃ¡c-derived-traits"><a class="header" href="#thÃªm-chá»©c-nÄƒng-há»¯u-Ãch-vá»›i-cÃ¡c-derived-traits">ThÃªm Chá»©c NÄƒng Há»¯u Ãch vá»›i CÃ¡c Derived Traits</a></h3>
<p>Sáº½ há»¯u Ã­ch náº¿u chÃºng ta cÃ³ thá»ƒ in ra má»™t thá»ƒ hiá»‡n cá»§a <code>Rectangle</code> trong khi chÃºng ta
Ä‘ang gá»¡ lá»—i chÆ°Æ¡ng trÃ¬nh vÃ  xem giÃ¡ trá»‹ cá»§a táº¥t cáº£ cÃ¡c trÆ°á»ng. Äoáº¡n mÃ£ 5-11
thá»­ nghiá»‡m viá»‡c sá»­ dá»¥ng <a href="../std/macro.println.html">macro println!</a><!-- ignore --> nhÆ° chÃºng ta
Ä‘Ã£ sá»­ dá»¥ng trong cÃ¡c chÆ°Æ¡ng trÆ°á»›c Ä‘Ã³. Tuy nhiÃªn, Ä‘iá»u nÃ y sáº½ khÃ´ng hoáº¡t Ä‘á»™ng.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!("rect1 is {rect1}");
}</code></pre>
<p><span class="caption">Listing 5-11: Thá»­ in ra má»™t instance <code>Rectangle</code></span></p>
<p>Khi chÃºng ta biÃªn dá»‹ch mÃ£ nÃ y, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c má»™t lá»—i vá»›i thÃ´ng bÃ¡o chÃ­nh sau:</p>
<pre><code class="language-text">error[E0277]: `Rectangle` doesn't implement `std::fmt::Display`
</code></pre>
<p>Macro <code>println!</code> cÃ³ thá»ƒ thá»±c hiá»‡n nhiá»u loáº¡i Ä‘á»‹nh dáº¡ng, vÃ  theo máº·c Ä‘á»‹nh, dáº¥u ngoáº·c nhá»n
trong <code>println!</code> Ä‘á»u cho biáº¿t chÃºng ta muá»‘n sá»­ dá»¥ng Ä‘á»‹nh dáº¡ng Ä‘Æ°á»£c biáº¿t Ä‘áº¿n lÃ  <code>Display</code>:
Ä‘á»‹nh dáº¡ng Ä‘áº§u ra dÃ nh cho viá»‡c tiÃªu thá»¥ trá»±c tiáº¿p bá»Ÿi ngÆ°á»i dÃ¹ng cuá»‘i. CÃ¡c kiá»ƒu dá»¯ liá»‡u
nguyÃªn thá»§y mÃ  chÃºng ta Ä‘Ã£ tháº¥y cho Ä‘áº¿n nay máº·c Ä‘á»‹nh triá»ƒn khai Display vÃ¬ chá»‰ cÃ³ má»™t
cÃ¡ch báº¡n muá»‘n hiá»ƒn thá»‹ má»™t 1 hoáº·c báº¥t ká»³ loáº¡i nguyÃªn thá»§y nÃ o khÃ¡c cho ngÆ°á»i dÃ¹ng. NhÆ°ng vá»›i struct,
cÃ¡ch <code>println!</code> nÃªn Ä‘á»‹nh dáº¡ng Ä‘áº§u ra lÃ  khÃ´ng rÃµ rÃ ng hÆ¡n vÃ¬ cÃ³ nhiá»u kháº£ nÄƒng hiá»ƒn
thá»‹: báº¡n cÃ³ muá»‘n cÃ³ dáº¥u pháº©y hay khÃ´ng? Báº¡n muá»‘n in cÃ¡c dáº¥u ngoáº·c nhá»n khÃ´ng? Táº¥t
cáº£ cÃ¡c trÆ°á»ng cÃ³ nÃªn Ä‘Æ°á»£c hiá»ƒn thá»‹ khÃ´ng? Do sá»± mÆ¡ há»“ nÃ y, Rust khÃ´ng cá»‘ gáº¯ng Ä‘oÃ¡n xem
chÃºng ta muá»‘n gÃ¬, vÃ  structs khÃ´ng cÃ³ má»™t triá»ƒn khai Display Ä‘Æ°á»£c cung cáº¥p Ä‘á»ƒ sá»­ dá»¥ng
vá»›i <code>println!</code> vÃ  <code>{}</code> placeholder.</p>
<p>Náº¿u chÃºng ta tiáº¿p tá»¥c Ä‘á»c lá»—i, chÃºng ta sáº½ tháº¥y má»™t ghi chÃº há»¯u Ã­ch nÃ y:</p>
<pre><code class="language-text">   = help: the trait `std::fmt::Display` is not implemented for `Rectangle`
   = note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead
</code></pre>
<p>HÃ£y thá»­ nÃ³ xem! Lá»i gá»i macro <code>println!</code> bÃ¢y giá» sáº½ trÃ´ng nhÆ° <code>println!("rect1 is {:?}", rect1);</code>.
Äáº·t specifier <code>:?</code> bÃªn trong dáº¥u ngoáº·c nhá»n cho biáº¿t cho <code>println!</code> ráº±ng chÃºng ta muá»‘n
sá»­ dá»¥ng má»™t Ä‘á»‹nh dáº¡ng Ä‘áº§u ra Ä‘Æ°á»£c gá»i lÃ  <code>Debug</code>. Trait <code>Debug</code> cho phÃ©p chÃºng ta
in ra struct cá»§a mÃ¬nh má»™t cÃ¡ch há»¯u Ã­ch cho cÃ¡c nhÃ  phÃ¡t triá»ƒn Ä‘á»ƒ chÃºng ta cÃ³ thá»ƒ
tháº¥y giÃ¡ trá»‹ cá»§a nÃ³ trong khi chÃºng ta Ä‘ang gá»¡ lá»—i mÃ£ cá»§a mÃ¬nh.</p>
<p>BiÃªn dá»‹ch mÃ£ vá»›i thay Ä‘á»•i nÃ y. Cmn :D! ChÃºng ta váº«n gáº·p má»™t lá»—i:</p>
<pre><code class="language-text">error[E0277]: `Rectangle` doesn't implement `Debug`
</code></pre>
<p>NhÆ°ng má»™t láº§n ná»¯a, trÃ¬nh biÃªn dá»‹ch láº¡i cung cáº¥p cho chÃºng ta má»™t ghi chÃº há»¯u Ã­ch:</p>
<pre><code class="language-text">   = help: the trait `Debug` is not implemented for `Rectangle`
   = note: add `#[derive(Debug)]` to `Rectangle` or manually `impl Debug for Rectangle`
</code></pre>
<p>Rust <em>thá»±c sá»±</em> bao gá»“m chá»©c nÄƒng in ra thÃ´ng tin gá»¡ lá»—i, nhÆ°ng chÃºng ta pháº£i chá»n
má»™t cÃ¡ch tÆ°á»ng minh (opt in) Ä‘á»ƒ lÃ m cho chá»©c nÄƒng nÃ y cÃ³ sáºµn cho struct cá»§a chÃºng ta.
Äá»ƒ lÃ m Ä‘iá»u Ä‘Ã³, chÃºng ta thÃªm thuá»™c tÃ­nh bÃªn ngoÃ i <code>#[derive(Debug)]</code> ngay trÆ°á»›c
Ä‘á»‹nh nghÄ©a cá»§a struct, nhÆ° thá»ƒ hiá»‡n trong Äoáº¡n mÃ£ 5-12.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!("rect1 is {rect1:?}");
}</code></pre></pre>
<p><span class="caption">Listing 5-12: ThÃªm thuá»™c tÃ­nh Ä‘á»ƒ táº¡o ra <code>Debug</code> trait vÃ 
in ra instance cá»§a <code>Rectangle</code> sá»­ dá»¥ng Ä‘á»‹nh dáº¡ng gá»¡ lá»—i(Debug).</span></p>
<p>Now when we run the program, we wonâ€™t get any errors, and weâ€™ll see the
following output:</p>
<pre><code class="language-console">$ cargo run
   Compiling rectangles v0.1.0 (file:///projects/rectangles)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.48s
     Running `target/debug/rectangles`
rect1 is Rectangle { width: 30, height: 50 }
</code></pre>
<p>Tuyá»‡t vá»i! ÄÃ¢y khÃ´ng pháº£i lÃ  output Ä‘áº¹p nháº¥t, nhÆ°ng nÃ³ hiá»ƒn thá»‹ giÃ¡ trá»‹ cá»§a
táº¥t cáº£ cÃ¡c trÆ°á»ng cho thá»ƒ hiá»‡n nÃ y, Ä‘iá»u nÃ y cháº¯c cháº¯n sáº½ giÃºp trong quÃ¡ trÃ¬nh gá»¡ lá»—i.
Khi chÃºng ta cÃ³ cÃ¡c struct lá»›n hÆ¡n, viá»‡c cÃ³ output dá»… Ä‘á»c hÆ¡n má»™t chÃºt
sáº½ há»¯u Ã­ch; trong nhá»¯ng trÆ°á»ng há»£p Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng <code>{:#?}</code>
thay vÃ¬ <code>{:?}</code> trong chuá»—i <code>println!</code>. Trong vÃ­ dá»¥ nÃ y, sá»­ dá»¥ng kiá»ƒu <code>{:#?}</code> sáº½
xuáº¥t ra nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling rectangles v0.1.0 (file:///projects/rectangles)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.48s
     Running `target/debug/rectangles`
rect1 is Rectangle {
    width: 30,
    height: 50,
}
</code></pre>
<p>Má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ in ra má»™t giÃ¡ trá»‹ sá»­ dá»¥ng Ä‘á»‹nh dáº¡ng <code>Debug</code> lÃ  sá»­ dá»¥ng <a href="../std/macro.dbg.html">dbg!
macro</a><!-- ignore -->, nÃ³ láº¥y quyá»n sá»Ÿ há»¯u cá»§a má»™t biá»ƒu thá»©c (so vá»›i
<code>println!</code>, nÃ³ láº¥y má»™t tham chiáº¿u), in ra sá»‘ dÃ²ng vÃ  tÃªn tá»‡p cá»§a nÆ¡i cuá»™c gá»i
macro <code>dbg!</code> xuáº¥t hiá»‡n trong mÃ£ cá»§a báº¡n cÃ¹ng vá»›i giÃ¡ trá»‹ káº¿t quáº£ cá»§a biá»ƒu thá»©c
Ä‘Ã³ vÃ  tráº£ láº¡i quyá»n sá»Ÿ há»¯u cá»§a giÃ¡ trá»‹.</p>
<blockquote>
<p>LÆ°u Ã½: Gá»i macro <code>dbg!</code> in ra luá»“ng console lá»—i tiÃªu chuáº©n (<code>stderr</code>), khÃ¡c vá»›i
<code>println!</code>, nÃ³ in ra luá»“ng console Ä‘áº§u ra tiÃªu chuáº©n (<code>stdout</code>). ChÃºng ta sáº½
tháº£o luáº­n thÃªm vá» <code>stderr</code> vÃ  <code>stdout</code> trong pháº§n <a href="ch12-06-writing-to-stderr-instead-of-stdout.html">â€œViáº¿t cÃ¡c ThÃ´ng bÃ¡o Lá»—i vÃ o
Luá»“ng Lá»—i TiÃªu Chuáº©n Thay vÃ¬ Luá»“ng Äáº§u Ra TiÃªu Chuáº©nâ€ trong ChÆ°Æ¡ng 12</a><!-- ignore -->.</p>
</blockquote>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ trong Ä‘Ã³ chÃºng ta quan tÃ¢m Ä‘áº¿n giÃ¡ trá»‹ Ä‘Æ°á»£c gÃ¡n cho
trÆ°á»ng <code>width</code>, cÅ©ng nhÆ° giÃ¡ trá»‹ cá»§a toÃ n bá»™ struct trong <code>rect1</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024">#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let scale = 2;
    let rect1 = Rectangle {
        width: dbg!(30 * scale),
        height: 50,
    };

    dbg!(&amp;rect1);
}</code></pre></pre>
<p>ChÃºng ta cÃ³ thá»ƒ Ä‘áº·t <code>dbg!</code> xung quanh biá»ƒu thá»©c <code>30 * scale</code> vÃ , vÃ¬ <code>dbg!</code>
tráº£ láº¡i quyá»n sá»Ÿ há»¯u cá»§a giÃ¡ trá»‹ cá»§a biá»ƒu thá»©c, trÆ°á»ng <code>width</code> sáº½ cÃ³ giÃ¡ trá»‹
giá»‘ng nhÆ° khi chÃºng ta khÃ´ng cÃ³ lá»i gá»i <code>dbg!</code> á»Ÿ Ä‘Ã³. ChÃºng ta khÃ´ng muá»‘n
<code>dbg!</code> sá»Ÿ há»¯u <code>rect1</code>, nÃªn chÃºng ta sá»­ dá»¥ng má»™t tham chiáº¿u Ä‘áº¿n <code>rect1</code> trong
lá»i gá»i tiáº¿p theo. DÆ°á»›i Ä‘Ã¢y lÃ  Ä‘áº§u ra cá»§a vÃ­ dá»¥ nÃ y:</p>
<pre><code class="language-console">$ cargo run
   Compiling rectangles v0.1.0 (file:///projects/rectangles)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.61s
     Running `target/debug/rectangles`
[src/main.rs:10:16] 30 * scale = 60
[src/main.rs:14:5] &amp;rect1 = Rectangle {
    width: 60,
    height: 50,
}
</code></pre>
<p>We can see the first bit of output came from <em>src/main.rs</em> line 10 where weâ€™re
debugging the expression <code>30 * scale</code>, and its resultant value is <code>60</code> (the
<code>Debug</code> formatting implemented for integers is to print only their value). The
<code>dbg!</code> call on line 14 of <em>src/main.rs</em> outputs the value of <code>&amp;rect1</code>, which is
the <code>Rectangle</code> struct. This output uses the pretty <code>Debug</code> formatting of the
<code>Rectangle</code> type. The <code>dbg!</code> macro can be really helpful when youâ€™re trying to
figure out what your code is doing!</p>
<p>In addition to the <code>Debug</code> trait, Rust has provided a number of traits for us
to use with the <code>derive</code> attribute that can add useful behavior to our custom
types. Those traits and their behaviors are listed in <a href="appendix-03-derivable-traits.html">Appendix C</a><!--
ignore -->. Weâ€™ll cover how to implement these traits with custom behavior as
well as how to create your own traits in Chapter 10. There are also many
attributes other than <code>derive</code>; for more information, see <a href="../reference/attributes.html">the â€œAttributesâ€
section of the Rust Reference</a>.</p>
<p>Our <code>area</code> function is very specific: it only computes the area of rectangles.
It would be helpful to tie this behavior more closely to our <code>Rectangle</code> struct
because it wonâ€™t work with any other type. Letâ€™s look at how we can continue to
refactor this code by turning the <code>area</code> function into an <code>area</code> <em>method</em>
defined on our <code>Rectangle</code> type.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="method-syntax"><a class="header" href="#method-syntax">Method Syntax</a></h2>
<p><em>Methods</em> tÆ°Æ¡ng tá»± nhÆ° functions: chÃºng Ä‘Æ°á»£c khai bÃ¡o vá»›i tá»« khÃ³a <code>fn</code> vÃ  má»™t
tÃªn, chÃºng cÃ³ thá»ƒ cÃ³ parameters vÃ  má»™t return value, vÃ  chÃºng chá»©a má»™t sá»‘ code
Ä‘Æ°á»£c cháº¡y khi method Ä‘Æ°á»£c gá»i tá»« má»™t nÆ¡i khÃ¡c. KhÃ´ng giá»‘ng nhÆ° functions,
methods Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong ngá»¯ cáº£nh cá»§a má»™t struct (hoáº·c má»™t enum hoáº·c má»™t trait
object, chÃºng ta Ä‘á» cáº­p láº§n lÆ°á»£t trong <a href="ch06-00-enums.html">Chapter 6</a><!-- ignore --> vÃ  <a href="ch17-02-trait-objects.html">Chapter
17</a><!-- ignore -->), vÃ  parameter Ä‘áº§u tiÃªn cá»§a chÃºng luÃ´n lÃ 
<code>self</code>, Ä‘áº¡i diá»‡n cho instance cá»§a struct mÃ  method Ä‘ang Ä‘Æ°á»£c gá»i trÃªn Ä‘Ã³.</p>
<h3 id="defining-methods"><a class="header" href="#defining-methods">Defining Methods</a></h3>
<p>HÃ£y thay Ä‘á»•i function <code>area</code> Ä‘ang cÃ³ má»™t instance <code>Rectangle</code> lÃ m parameter
vÃ  thay vÃ o Ä‘Ã³ táº¡o má»™t method <code>area</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn struct <code>Rectangle</code>,
nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 5-13.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    fn area(&amp;self) -&gt; u32 {
        self.width * self.height
    }
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!(
        "The area of the rectangle is {} square pixels.",
        rect1.area()
    );
}</code></pre></pre>
<p><span class="caption">Listing 5-13: Äá»‹nh nghÄ©a má»™t method <code>area</code> trÃªn
<code>Rectangle</code> struct</span></p>
<p>Äá»ƒ Ä‘á»‹nh nghÄ©a function trong ngá»¯ cáº£nh cá»§a <code>Rectangle</code>, chÃºng ta báº¯t Ä‘áº§u má»™t
block <code>impl</code> (implementation) cho <code>Rectangle</code>. Má»i thá»© bÃªn trong block <code>impl</code>
nÃ y sáº½ Ä‘Æ°á»£c gáº¯n vá»›i type <code>Rectangle</code>. Sau Ä‘Ã³ chÃºng ta di chuyá»ƒn function <code>area</code>
vÃ o bÃªn trong cÃ¡c dáº¥u ngoáº·c nhá»n cá»§a <code>impl</code> vÃ  thay Ä‘á»•i parameter Ä‘áº§u tiÃªn (vÃ 
trong trÆ°á»ng há»£p nÃ y lÃ  parameter duy nháº¥t) thÃ nh <code>self</code> trong signature vÃ  á»Ÿ
má»i nÆ¡i trong body. Trong <code>main</code>, nÆ¡i chÃºng ta Ä‘Ã£ gá»i function <code>area</code> vÃ  truyá»n
<code>rect1</code> lÃ m má»™t argument, chÃºng ta cÃ³ thá»ƒ thay vÃ o Ä‘Ã³ sá»­ dá»¥ng <em>method syntax</em>
Ä‘á»ƒ gá»i method <code>area</code> trÃªn instance <code>Rectangle</code> cá»§a chÃºng ta. Method syntax
Ä‘Æ°á»£c viáº¿t sau má»™t instance: chÃºng ta thÃªm má»™t dáº¥u cháº¥m theo sau lÃ  tÃªn method,
dáº¥u ngoáº·c trÃ²n, vÃ  báº¥t ká»³ argument nÃ o.</p>
<p>Trong signature cá»§a <code>area</code>, chÃºng ta sá»­ dá»¥ng <code>&amp;self</code> thay vÃ¬ <code>rectangle: &amp;Rectangle</code>.
<code>&amp;self</code> thá»±c cháº¥t lÃ  dáº¡ng viáº¿t táº¯t cá»§a <code>self: &amp;Self</code>. BÃªn trong má»™t block <code>impl</code>,
type <code>Self</code> lÃ  má»™t alias cho type mÃ  block <code>impl</code> Ä‘Ã³ Ã¡p dá»¥ng. CÃ¡c method báº¯t buá»™c
pháº£i cÃ³ má»™t parameter tÃªn lÃ  <code>self</code> vá»›i type <code>Self</code> lÃ m parameter Ä‘áº§u tiÃªn, vÃ¬ váº­y
Rust cho phÃ©p báº¡n rÃºt gá»n Ä‘iá»u nÃ y chá»‰ cÃ²n tÃªn <code>self</code> á»Ÿ vá»‹ trÃ­ parameter Ä‘áº§u tiÃªn.
LÆ°u Ã½ ráº±ng chÃºng ta váº«n cáº§n sá»­ dá»¥ng dáº¥u <code>&amp;</code> phÃ­a trÆ°á»›c dáº¡ng viáº¿t táº¯t <code>self</code> Ä‘á»ƒ
chá»‰ ra ráº±ng method nÃ y mÆ°á»£n (borrow) instance <code>Self</code>, giá»‘ng nhÆ° cÃ¡ch chÃºng ta Ä‘Ã£
lÃ m vá»›i <code>rectangle: &amp;Rectangle</code>. CÃ¡c method cÃ³ thá»ƒ nháº­n quyá»n sá»Ÿ há»¯u cá»§a <code>self</code>,
mÆ°á»£n <code>self</code> má»™t cÃ¡ch báº¥t biáº¿n (immutable) nhÆ° chÃºng ta Ä‘Ã£ lÃ m á»Ÿ Ä‘Ã¢y, hoáº·c mÆ°á»£n
<code>self</code> má»™t cÃ¡ch kháº£ biáº¿n (mutable), giá»‘ng nhÆ° vá»›i báº¥t ká»³ parameter nÃ o khÃ¡c.</p>
<p>ChÃºng ta chá»n <code>&amp;self</code> á»Ÿ Ä‘Ã¢y vÃ¬ cÃ¹ng lÃ½ do Ä‘Ã£ dÃ¹ng <code>&amp;Rectangle</code> trong phiÃªn báº£n
function: chÃºng ta khÃ´ng muá»‘n láº¥y quyá»n sá»Ÿ há»¯u, vÃ  chá»‰ muá»‘n Ä‘á»c dá»¯ liá»‡u trong
struct chá»© khÃ´ng ghi vÃ o nÃ³. Náº¿u chÃºng ta muá»‘n thay Ä‘á»•i instance mÃ  method Ä‘Æ°á»£c
gá»i trÃªn Ä‘Ã³ nhÆ° má»™t pháº§n cÃ´ng viá»‡c cá»§a method, chÃºng ta sáº½ dÃ¹ng <code>&amp;mut self</code> lÃ m
parameter Ä‘áº§u tiÃªn. Viá»‡c cÃ³ má»™t method láº¥y quyá»n sá»Ÿ há»¯u cá»§a instance báº±ng cÃ¡ch
chá»‰ sá»­ dá»¥ng <code>self</code> lÃ m parameter Ä‘áº§u tiÃªn lÃ  khÃ¡ hiáº¿m; ká»¹ thuáº­t nÃ y thÆ°á»ng Ä‘Æ°á»£c
dÃ¹ng khi method biáº¿n Ä‘á»•i <code>self</code> thÃ nh má»™t thá»© gÃ¬ Ä‘Ã³ khÃ¡c vÃ  báº¡n muá»‘n ngÄƒn khÃ´ng
cho ngÆ°á»i gá»i tiáº¿p tá»¥c sá»­ dá»¥ng instance ban Ä‘áº§u sau khi quÃ¡ trÃ¬nh biáº¿n Ä‘á»•i káº¿t
thÃºc.</p>
<p>LÃ½ do chÃ­nh Ä‘á»ƒ sá»­ dá»¥ng methods thay vÃ¬ functions, ngoÃ i viá»‡c cung cáº¥p method
syntax vÃ  khÃ´ng pháº£i láº·p láº¡i type cá»§a <code>self</code> trong signature cá»§a má»—i method,
lÃ  Ä‘á»ƒ tá»• chá»©c mÃ£ nguá»“n. ChÃºng ta Ä‘Ã£ Ä‘áº·t táº¥t cáº£ nhá»¯ng gÃ¬ cÃ³ thá»ƒ lÃ m vá»›i má»™t
instance cá»§a má»™t type vÃ o trong má»™t block <code>impl</code> duy nháº¥t, thay vÃ¬ Ä‘á»ƒ nhá»¯ng
ngÆ°á»i dÃ¹ng mÃ£ cá»§a chÃºng ta trong tÆ°Æ¡ng lai pháº£i Ä‘i tÃ¬m cÃ¡c kháº£ nÄƒng cá»§a
<code>Rectangle</code> á»Ÿ nhiá»u vá»‹ trÃ­ khÃ¡c nhau trong thÆ° viá»‡n mÃ  chÃºng ta cung cáº¥p.</p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta cÃ³ thá»ƒ chá»n Ä‘áº·t cho má»™t method cÃ¹ng tÃªn vá»›i má»™t trong cÃ¡c
field cá»§a struct. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a má»™t method trÃªn <code>Rectangle</code>
mÃ  cÅ©ng cÃ³ tÃªn lÃ  <code>width</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Rectangle {
</span><span class="boring">    width: u32,
</span><span class="boring">    height: u32,
</span><span class="boring">}
</span><span class="boring">
</span>impl Rectangle {
    fn width(&amp;self) -&gt; bool {
        self.width &gt; 0
    }
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    if rect1.width() {
        println!("The rectangle has a nonzero width; it is {}", rect1.width);
    }
}</code></pre></pre>
<p>á» Ä‘Ã¢y, chÃºng ta chá»n Ä‘á»ƒ method <code>width</code> tráº£ vá» <code>true</code> náº¿u giÃ¡ trá»‹ trong field
<code>width</code> cá»§a instance lá»›n hÆ¡n <code>0</code>, vÃ  tráº£ vá» <code>false</code> náº¿u giÃ¡ trá»‹ lÃ  <code>0</code>: chÃºng ta
cÃ³ thá»ƒ sá»­ dá»¥ng má»™t field bÃªn trong má»™t method cÃ¹ng tÃªn cho báº¥t ká»³ má»¥c Ä‘Ã­ch nÃ o.
Trong <code>main</code>, khi chÃºng ta theo sau <code>rect1.width</code> báº±ng dáº¥u ngoáº·c trÃ²n, Rust hiá»ƒu
ráº±ng chÃºng ta Ä‘ang nÃ³i Ä‘áº¿n method <code>width</code>. Khi chÃºng ta khÃ´ng dÃ¹ng dáº¥u ngoáº·c
trÃ²n, Rust hiá»ƒu ráº±ng chÃºng ta Ä‘ang nÃ³i Ä‘áº¿n field <code>width</code>.</p>
<p>ThÆ°á»ng thÃ¬, nhÆ°ng khÃ´ng pháº£i lÃºc nÃ o cÅ©ng váº­y, khi chÃºng ta Ä‘áº·t cho má»™t method
cÃ¹ng tÃªn vá»›i má»™t field, chÃºng ta muá»‘n nÃ³ chá»‰ tráº£ vá» giÃ¡ trá»‹ cá»§a field Ä‘Ã³ vÃ 
khÃ´ng lÃ m gÃ¬ khÃ¡c. Nhá»¯ng method nhÆ° váº­y Ä‘Æ°á»£c gá»i lÃ  <em>getters</em>, vÃ  Rust khÃ´ng tá»±
Ä‘á»™ng triá»ƒn khai chÃºng cho cÃ¡c field cá»§a struct nhÆ° má»™t sá»‘ ngÃ´n ngá»¯ khÃ¡c.
Getters ráº¥t há»¯u Ã­ch vÃ¬ báº¡n cÃ³ thá»ƒ Ä‘á»ƒ field á»Ÿ cháº¿ Ä‘á»™ private nhÆ°ng method thÃ¬ á»Ÿ
cháº¿ Ä‘á»™ public, tá»« Ä‘Ã³ cho phÃ©p truy cáº­p chá»‰-Ä‘á»c (read-only) tá»›i field Ä‘Ã³ nhÆ° má»™t
pháº§n cá»§a public API cá»§a type. ChÃºng ta sáº½ tháº£o luáº­n vá» public vÃ  private lÃ  gÃ¬
vÃ  cÃ¡ch chá»‰ Ä‘á»‹nh má»™t field hoáº·c method lÃ  public hay private trong <a href="ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html#exposing-paths-with-the-pub-keyword">Chapter
7</a><!-- ignore -->.</p>
<section class="note" aria-role="note">
<h3 id="toÃ¡n-tá»­---á»Ÿ-Ä‘Ã¢u"><a class="header" href="#toÃ¡n-tá»­---á»Ÿ-Ä‘Ã¢u">ToÃ¡n tá»­ <code>-&gt;</code> á»Ÿ Ä‘Ã¢u?</a></h3>
<p>Trong C vÃ  C++, cÃ³ hai toÃ¡n tá»­ khÃ¡c nhau Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ gá»i method: báº¡n dÃ¹ng
<code>.</code> náº¿u gá»i method trá»±c tiáº¿p trÃªn object vÃ  dÃ¹ng <code>-&gt;</code> náº¿u gá»i method trÃªn
má»™t con trá» tá»›i object vÃ  cáº§n dereference con trá» trÆ°á»›c. NÃ³i cÃ¡ch khÃ¡c, náº¿u
<code>object</code> lÃ  má»™t con trá», thÃ¬ <code>object-&gt;something()</code> tÆ°Æ¡ng tá»± vá»›i
<code>(*object).something()</code>.</p>
<p>Rust khÃ´ng cÃ³ toÃ¡n tá»­ tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i <code>-&gt;</code>; thay vÃ o Ä‘Ã³, Rust cÃ³ má»™t tÃ­nh
nÄƒng gá»i lÃ  <em>automatic referencing and dereferencing</em>. Viá»‡c gá»i method lÃ 
má»™t trong sá»‘ Ã­t nhá»¯ng nÆ¡i trong Rust cÃ³ hÃ nh vi nÃ y.</p>
<p>CÃ¡ch hoáº¡t Ä‘á»™ng nhÆ° sau: khi báº¡n gá»i má»™t method vá»›i <code>object.something()</code>,
Rust sáº½ tá»± Ä‘á»™ng thÃªm <code>&amp;</code>, <code>&amp;mut</code>, hoáº·c <code>*</code> Ä‘á»ƒ <code>object</code> khá»›p vá»›i signature cá»§a
method. NÃ³i cÃ¡ch khÃ¡c, cÃ¡c cÃ¡ch gá»i sau lÃ  giá»‘ng nhau:</p>
<!-- CAN'T EXTRACT SEE BUG https://github.com/rust-lang/mdBook/issues/1127 -->
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[derive(Debug,Copy,Clone)]
</span><span class="boring">struct Point {
</span><span class="boring">    x: f64,
</span><span class="boring">    y: f64,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Point {
</span><span class="boring">   fn distance(&amp;self, other: &amp;Point) -&gt; f64 {
</span><span class="boring">       let x_squared = f64::powi(other.x - self.x, 2);
</span><span class="boring">       let y_squared = f64::powi(other.y - self.y, 2);
</span><span class="boring">
</span><span class="boring">       f64::sqrt(x_squared + y_squared)
</span><span class="boring">   }
</span><span class="boring">}
</span><span class="boring">let p1 = Point { x: 0.0, y: 0.0 };
</span><span class="boring">let p2 = Point { x: 5.0, y: 6.5 };
</span>p1.distance(&amp;p2);
(&amp;p1).distance(&amp;p2);
<span class="boring">}</span></code></pre></pre>
<p>CÃ¡ch gá»i Ä‘áº§u tiÃªn trÃ´ng gá»n gÃ ng hÆ¡n nhiá»u. HÃ nh vi tá»± Ä‘á»™ng reference nÃ y hoáº¡t
Ä‘á»™ng Ä‘Æ°á»£c lÃ  vÃ¬ cÃ¡c method cÃ³ má»™t receiver rÃµ rÃ ng â€” chÃ­nh lÃ  type cá»§a <code>self</code>.
Dá»±a vÃ o receiver vÃ  tÃªn cá»§a method, Rust cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh má»™t cÃ¡ch dá»©t khoÃ¡t
liá»‡u method Ä‘ang Ä‘á»c (<code>&amp;self</code>), thay Ä‘á»•i (<code>&amp;mut self</code>), hay tiÃªu thá»¥ (<code>self</code>).
Viá»‡c Rust lÃ m cho cÆ¡ cháº¿ mÆ°á»£n (borrowing) trá»Ÿ nÃªn ngáº§m Ä‘á»‹nh Ä‘á»‘i vá»›i receiver
cá»§a method lÃ  má»™t pháº§n quan trá»ng giÃºp mÃ´ hÃ¬nh ownership trá»Ÿ nÃªn dá»… dÃ¹ng hÆ¡n
trong thá»±c táº¿.</p>
</section>
<h3 id="methods-with-more-parameters"><a class="header" href="#methods-with-more-parameters">Methods with More Parameters</a></h3>
<p>HÃ£y thá»±c hÃ nh sá»­ dá»¥ng methods báº±ng cÃ¡ch triá»ƒn khai má»™t method thá»© hai trÃªn
struct <code>Rectangle</code>. Láº§n nÃ y, chÃºng ta muá»‘n má»™t instance cá»§a <code>Rectangle</code> nháº­n
má»™t instance khÃ¡c cá»§a <code>Rectangle</code> vÃ  tráº£ vá» <code>true</code> náº¿u <code>Rectangle</code> thá»© hai cÃ³
thá»ƒ náº±m hoÃ n toÃ n bÃªn trong <code>self</code> (tá»©c lÃ  <code>Rectangle</code> Ä‘áº§u tiÃªn); náº¿u khÃ´ng,
nÃ³ sáº½ tráº£ vá» <code>false</code>. NÃ³i cÃ¡ch khÃ¡c, sau khi chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a method
<code>can_hold</code>, chÃºng ta muá»‘n cÃ³ thá»ƒ viáº¿t chÆ°Æ¡ng trÃ¬nh nhÆ° Ä‘Æ°á»£c minh há»a trong
Listing 5-14.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };
    let rect2 = Rectangle {
        width: 10,
        height: 40,
    };
    let rect3 = Rectangle {
        width: 60,
        height: 45,
    };

    println!("Can rect1 hold rect2? {}", rect1.can_hold(&amp;rect2));
    println!("Can rect1 hold rect3? {}", rect1.can_hold(&amp;rect3));
}</code></pre>
<p><span class="caption">Listing 5-14: Sá»­ dá»¥ng method <code>can_hold</code> chÆ°a Ä‘Æ°á»£c viáº¿t</span></p>
<p>Káº¿t quáº£ mong Ä‘á»£i sáº½ trÃ´ng nhÆ° sau vÃ¬ cáº£ hai kÃ­ch thÆ°á»›c cá»§a <code>rect2</code> Ä‘á»u nhá» hÆ¡n
cÃ¡c kÃ­ch thÆ°á»›c cá»§a <code>rect1</code>, nhÆ°ng <code>rect3</code> thÃ¬ rá»™ng hÆ¡n <code>rect1</code>:</p>
<pre><code class="language-text">Can rect1 hold rect2? true
Can rect1 hold rect3? false
</code></pre>
<p>ChÃºng ta biáº¿t ráº±ng mÃ¬nh muá»‘n Ä‘á»‹nh nghÄ©a má»™t method, vÃ¬ váº­y nÃ³ sáº½ náº±m trong block
<code>impl Rectangle</code>. TÃªn method sáº½ lÃ  <code>can_hold</code>, vÃ  nÃ³ sáº½ nháº­n má»™t immutable borrow
cá»§a má»™t <code>Rectangle</code> khÃ¡c lÃ m parameter. ChÃºng ta cÃ³ thá»ƒ biáº¿t type cá»§a parameter
nÃ y báº±ng cÃ¡ch nhÃ¬n vÃ o Ä‘oáº¡n code gá»i method:
<code>rect1.can_hold(&amp;rect2)</code> truyá»n vÃ o <code>&amp;rect2</code>, tá»©c lÃ  má»™t immutable borrow tá»›i
<code>rect2</code>, má»™t instance cá»§a <code>Rectangle</code>. Äiá»u nÃ y lÃ  há»£p lÃ½ vÃ¬ chÃºng ta chá»‰ cáº§n
Ä‘á»c <code>rect2</code> (thay vÃ¬ ghi, Ä‘iá»u Ä‘Ã³ sáº½ yÃªu cáº§u má»™t mutable borrow), vÃ  chÃºng ta
muá»‘n <code>main</code> váº«n giá»¯ quyá»n sá»Ÿ há»¯u cá»§a <code>rect2</code> Ä‘á»ƒ cÃ³ thá»ƒ dÃ¹ng láº¡i nÃ³ sau khi gá»i
method <code>can_hold</code>. GiÃ¡ trá»‹ tráº£ vá» cá»§a <code>can_hold</code> sáº½ lÃ  má»™t Boolean, vÃ  pháº§n
triá»ƒn khai sáº½ kiá»ƒm tra xem chiá»u rá»™ng vÃ  chiá»u cao cá»§a <code>self</code> cÃ³ lá»›n hÆ¡n chiá»u
rá»™ng vÃ  chiá»u cao cá»§a <code>Rectangle</code> cÃ²n láº¡i hay khÃ´ng. HÃ£y thÃªm method <code>can_hold</code>
má»›i vÃ o block <code>impl</code> tá»« Listing 5-13, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 5-15.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Rectangle {
</span><span class="boring">    width: u32,
</span><span class="boring">    height: u32,
</span><span class="boring">}
</span><span class="boring">
</span>impl Rectangle {
    fn area(&amp;self) -&gt; u32 {
        self.width * self.height
    }

    fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool {
        self.width &gt; other.width &amp;&amp; self.height &gt; other.height
    }
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let rect1 = Rectangle {
</span><span class="boring">        width: 30,
</span><span class="boring">        height: 50,
</span><span class="boring">    };
</span><span class="boring">    let rect2 = Rectangle {
</span><span class="boring">        width: 10,
</span><span class="boring">        height: 40,
</span><span class="boring">    };
</span><span class="boring">    let rect3 = Rectangle {
</span><span class="boring">        width: 60,
</span><span class="boring">        height: 45,
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    println!("Can rect1 hold rect2? {}", rect1.can_hold(&amp;rect2));
</span><span class="boring">    println!("Can rect1 hold rect3? {}", rect1.can_hold(&amp;rect3));
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 5-15: Triá»ƒn khai method <code>can_hold</code> trÃªn
<code>Rectangle</code>, method nÃ y nháº­n má»™t instance <code>Rectangle</code> khÃ¡c lÃ m parameter</span></p>
<p>Khi chÃºng ta cháº¡y Ä‘oáº¡n code nÃ y vá»›i hÃ m <code>main</code> trong Listing 5-14, chÃºng ta sáº½
nháº­n Ä‘Æ°á»£c káº¿t quáº£ mong muá»‘n. Methods cÃ³ thá»ƒ nháº­n nhiá»u parameter; chÃºng ta chá»‰
cáº§n thÃªm chÃºng vÃ o signature sau parameter <code>self</code>, vÃ  cÃ¡c parameter Ä‘Ã³ hoáº¡t
Ä‘á»™ng giá»‘ng há»‡t nhÆ° parameter trong functions.</p>
<h3 id="associated-functions"><a class="header" href="#associated-functions">Associated Functions</a></h3>
<p>Táº¥t cáº£ cÃ¡c function Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a bÃªn trong má»™t block <code>impl</code> Ä‘á»u Ä‘Æ°á»£c gá»i lÃ 
<em>cÃ¡c associated functions</em> vÃ¬ chÃºng Ä‘Æ°á»£c gáº¯n vá»›i type Ä‘Æ°á»£c nÃªu sau tá»« khÃ³a
<code>impl</code>. ChÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c associated function khÃ´ng cÃ³ <code>self</code> lÃ m
parameter Ä‘áº§u tiÃªn (vÃ  do Ä‘Ã³ khÃ´ng pháº£i lÃ  methods), bá»Ÿi vÃ¬ chÃºng khÃ´ng cáº§n má»™t
instance cá»§a type Ä‘á»ƒ hoáº¡t Ä‘á»™ng. ChÃºng ta Ä‘Ã£ tá»«ng sá»­ dá»¥ng má»™t function nhÆ° váº­y:
function <code>String::from</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn type <code>String</code>.</p>
<p>CÃ¡c associated function khÃ´ng pháº£i lÃ  methods thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng lÃ m constructor
Ä‘á»ƒ tráº£ vá» má»™t instance má»›i cá»§a struct. ChÃºng thÆ°á»ng Ä‘Æ°á»£c Ä‘áº·t tÃªn lÃ  <code>new</code>, nhÆ°ng
<code>new</code> khÃ´ng pháº£i lÃ  má»™t tÃªn Ä‘áº·c biá»‡t vÃ  cÅ©ng khÃ´ng Ä‘Æ°á»£c tÃ­ch há»£p sáºµn trong ngÃ´n
ngá»¯. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ chá»n cung cáº¥p má»™t associated function tÃªn lÃ 
<code>square</code>, function nÃ y sáº½ nháº­n má»™t parameter kÃ­ch thÆ°á»›c vÃ  dÃ¹ng giÃ¡ trá»‹ Ä‘Ã³ cho
cáº£ chiá»u rá»™ng láº«n chiá»u cao, tá»« Ä‘Ã³ giÃºp viá»‡c táº¡o má»™t <code>Rectangle</code> hÃ¬nh vuÃ´ng trá»Ÿ
nÃªn dá»… dÃ ng hÆ¡n thay vÃ¬ pháº£i chá»‰ Ä‘á»‹nh cÃ¹ng má»™t giÃ¡ trá»‹ hai láº§n:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Rectangle {
</span><span class="boring">    width: u32,
</span><span class="boring">    height: u32,
</span><span class="boring">}
</span><span class="boring">
</span>impl Rectangle {
    fn square(size: u32) -&gt; Self {
        Self {
            width: size,
            height: size,
        }
    }
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let sq = Rectangle::square(3);
</span><span class="boring">}</span></code></pre></pre>
<p>Tá»« khÃ³a <code>Self</code> trong kiá»ƒu tráº£ vá» vÃ  trong body cá»§a function lÃ  alias cho type
xuáº¥t hiá»‡n sau tá»« khÃ³a <code>impl</code>, trong trÆ°á»ng há»£p nÃ y lÃ  <code>Rectangle</code>.</p>
<p>Äá»ƒ gá»i associated function nÃ y, chÃºng ta sá»­ dá»¥ng cÃº phÃ¡p <code>::</code> vá»›i tÃªn struct;
<code>let sq = Rectangle::square(3);</code> lÃ  má»™t vÃ­ dá»¥. Function nÃ y Ä‘Æ°á»£c Ä‘áº·t trong
namespace cá»§a struct: cÃº phÃ¡p <code>::</code> Ä‘Æ°á»£c dÃ¹ng cho cáº£ associated functions vÃ 
cÃ¡c namespace Ä‘Æ°á»£c táº¡o bá»Ÿi modules. ChÃºng ta sáº½ tháº£o luáº­n vá» modules trong
<a href="ch07-02-defining-modules-to-control-scope-and-privacy.html">Chapter 7</a><!-- ignore -->.</p>
<h3 id="multiple-impl-blocks"><a class="header" href="#multiple-impl-blocks">Multiple <code>impl</code> Blocks</a></h3>
<p>Má»—i struct Ä‘Æ°á»£c phÃ©p cÃ³ nhiá»u <code>impl</code> block. VÃ­ dá»¥, Listing
5-15 tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i Ä‘oáº¡n code Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 5-16, trong Ä‘Ã³
má»—i method náº±m trong má»™t <code>impl</code> block riÃªng.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Rectangle {
</span><span class="boring">    width: u32,
</span><span class="boring">    height: u32,
</span><span class="boring">}
</span><span class="boring">
</span>impl Rectangle {
    fn area(&amp;self) -&gt; u32 {
        self.width * self.height
    }
}

impl Rectangle {
    fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool {
        self.width &gt; other.width &amp;&amp; self.height &gt; other.height
    }
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let rect1 = Rectangle {
</span><span class="boring">        width: 30,
</span><span class="boring">        height: 50,
</span><span class="boring">    };
</span><span class="boring">    let rect2 = Rectangle {
</span><span class="boring">        width: 10,
</span><span class="boring">        height: 40,
</span><span class="boring">    };
</span><span class="boring">    let rect3 = Rectangle {
</span><span class="boring">        width: 60,
</span><span class="boring">        height: 45,
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    println!("Can rect1 hold rect2? {}", rect1.can_hold(&amp;rect2));
</span><span class="boring">    println!("Can rect1 hold rect3? {}", rect1.can_hold(&amp;rect3));
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 5-16: Viáº¿t láº¡i Listing 5-15 báº±ng cÃ¡ch sá»­ dá»¥ng nhiá»u <code>impl</code>
blocks</span></p>
<p>KhÃ´ng cÃ³ lÃ½ do báº¯t buá»™c nÃ o Ä‘á»ƒ tÃ¡ch cÃ¡c method nÃ y ra thÃ nh nhiá»u <code>impl</code> block
trong trÆ°á»ng há»£p nÃ y, nhÆ°ng Ä‘Ã¢y lÃ  cÃº phÃ¡p há»£p lá»‡. ChÃºng ta sáº½ tháº¥y má»™t trÆ°á»ng
há»£p mÃ  nhiá»u <code>impl</code> block trá»Ÿ nÃªn há»¯u Ã­ch á»Ÿ Chapter 10, nÆ¡i chÃºng ta tháº£o luáº­n
vá» generic types vÃ  traits.</p>
<h2 id="summary-1"><a class="header" href="#summary-1">Summary</a></h2>
<p>Struct cho phÃ©p báº¡n táº¡o ra cÃ¡c custom types cÃ³ Ã½ nghÄ©a Ä‘á»‘i vá»›i domain cá»§a báº¡n.
Báº±ng cÃ¡ch sá»­ dá»¥ng struct, báº¡n cÃ³ thá»ƒ giá»¯ cÃ¡c máº£nh dá»¯ liá»‡u liÃªn quan Ä‘Æ°á»£c gáº¯n
káº¿t vá»›i nhau vÃ  Ä‘áº·t tÃªn cho tá»«ng máº£nh Ä‘á»ƒ lÃ m cho code cá»§a báº¡n rÃµ rÃ ng hÆ¡n.
Trong cÃ¡c <code>impl</code> block, báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c function Ä‘Æ°á»£c liÃªn káº¿t vá»›i
type cá»§a mÃ¬nh, vÃ  methods lÃ  má»™t dáº¡ng associated function cho phÃ©p báº¡n chá»‰ rÃµ
hÃ nh vi mÃ  cÃ¡c instance cá»§a struct Ä‘Ã³ cÃ³.</p>
<p>NhÆ°ng struct khÃ´ng pháº£i lÃ  cÃ¡ch duy nháº¥t Ä‘á»ƒ báº¡n táº¡o custom types: hÃ£y chuyá»ƒn
sang feature enum cá»§a Rust Ä‘á»ƒ bá»• sung thÃªm má»™t cÃ´ng cá»¥ ná»¯a vÃ o toolbox cá»§a báº¡n.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="enums-and-pattern-matching"><a class="header" href="#enums-and-pattern-matching">Enums and Pattern Matching</a></h1>
<p>Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ xem xÃ©t <em>enumerations</em>, cÃ²n Ä‘Æ°á»£c gá»i lÃ  <em>enums</em>.
Enum cho phÃ©p Ä‘á»‹nh nghÄ©a má»™t kiá»ƒu dá»¯ liá»‡u báº±ng cÃ¡ch liá»‡t kÃª cÃ¡c biáº¿n thá»ƒ
(variant) cÃ³ thá»ƒ xáº£y ra. Äáº§u tiÃªn, chÃºng ta sáº½ Ä‘á»‹nh nghÄ©a vÃ  sá»­ dá»¥ng má»™t enum
qua Ä‘Ã³ sáº½ cho tháº¥y cÃ¡ch má»™t enum cÃ³ thá»ƒ mÃ£ hÃ³a dá»¯ liá»‡u. Tiáº¿p theo, chÃºng ta sáº½
khÃ¡m phÃ¡ má»™t enum Ä‘áº·c biá»‡t, gá»i lÃ  <code>Option</code>, thá»ƒ hiá»‡n cÃ³ thá»ƒ cÃ³ giÃ¡ trá»‹ hoáº·c
khÃ´ng cÃ³ giÃ¡ trá»‹. Sau Ä‘Ã³, chÃºng ta sáº½ xem xÃ©t cÃ¡ch cÃ¡c máº«u (pattern) Ä‘Æ°á»£c khá»›p
(match) vá»›i nhau trong biá»ƒu thá»©c <code>match</code> qua Ä‘Ã³ cho phÃ©p chÃºng ta cÃ³ thá»ƒ cháº¡y
cÃ¡c code khÃ¡c nhau phá»¥ thuá»™c vÃ o giÃ¡ trá»‹ cá»§a enum. Cuá»‘i cÃ¹ng, chÃºng ta sáº½ tÃ¬m
hiá»ƒu cÃ¡ch cáº¥u trÃºc <code>if let</code> lÃ  má»™t idiom tiá»‡n lá»£i vÃ  ngáº¯n gá»n khÃ¡c cÃ³ sáºµn Ä‘á»ƒ xá»­
lÃ½ cÃ¡c enum trong code.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="defining-an-enum"><a class="header" href="#defining-an-enum">Defining an Enum</a></h2>
<p>Trong khi struct cho phÃ©p báº¡n nhÃ³m cÃ¡c trÆ°á»ng dá»¯ liá»‡u liÃªn quan láº¡i vá»›i nhau,
vÃ­ dá»¥ nhÆ° <code>Rectangle</code> (hÃ¬nh chá»¯ nháº­t) sáº½ cÃ³ <code>width</code> (chiá»u rá»™ng) vÃ  <code>height</code>
(chiá»u dÃ i), enum cho phÃ©p báº¡n miÃªu táº£ má»™t táº­p há»£p chá»©a cÃ¡c giÃ¡ trá»‹ cÃ³ thá»ƒ xáº£y
ra. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ muá»‘n nÃ³i ráº±ng <code>Rectangle</code> lÃ  má»™t hÃ¬nh trong má»™t táº­p
há»£p cÃ¡c hÃ¬nh, bao gá»“m <code>Circle</code> (hÃ¬nh trÃ²n) vÃ  <code>Triangle</code> (tam giÃ¡c). Rust cho
phÃ©p chÃºng ta Ä‘á»‹nh nghÄ©a kiá»ƒu dá»¯ liá»‡u nÃ y báº±ng má»™t enum.</p>
<p>HÃ£y xem xÃ©t má»™t trÆ°á»ng há»£p mÃ  chÃºng ta cÃ³ thá»ƒ muá»‘n biá»ƒu diá»…n trong code vÃ  xem
táº¡i sao enum lÃ  há»¯u Ã­ch vÃ  phÃ¹ há»£p hÆ¡n struct trong trÆ°á»ng há»£p nÃ y. HÃ£y nÃ³i
ráº±ng chÃºng ta cáº§n lÃ m viá»‡c vá»›i Ä‘á»‹a chá»‰ IP. Hiá»‡n táº¡i, cÃ³ hai tiÃªu chuáº©n chÃ­nh
Ä‘Æ°á»£c sá»­ dá»¥ng cho Ä‘á»‹a chá»‰ IP: IPv4 vÃ  IPv6. VÃ¬ Ä‘Ã¢y lÃ  nhá»¯ng lá»±a chá»n duy nháº¥t
cho Ä‘á»‹a chá»‰ IP mÃ  chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta sáº½ gáº·p pháº£i, chÃºng ta cÃ³ thá»ƒ <em>liá»‡t
kÃª</em> (enumerate) táº¥t cáº£ cÃ¡c biáº¿n thá»ƒ cÃ³ thá»ƒ xáº£y ra, tÃªn <code>enum</code> cÅ©ng Ä‘Æ°á»£c Ä‘áº·t ra
tá»« enumerate.</p>
<p>Báº¥t ká»³ Ä‘á»‹a chá»‰ IP nÃ o Ä‘á»u cÃ³ thá»ƒ lÃ  Ä‘á»‹a chá»‰ IPv4 hoáº·c Ä‘á»‹a chá»‰ IPv6, nhÆ°ng khÃ´ng
thá»ƒ lÃ  cáº£ hai cÃ¹ng má»™t lÃºc. Äáº·c tÃ­nh nÃ y cá»§a Ä‘á»‹a chá»‰ IP khiáº¿n cho kiá»ƒu dá»¯ liá»‡u
enum phÃ¹ há»£p, vÃ¬ má»™t giÃ¡ trá»‹ enum chá»‰ cÃ³ thá»ƒ lÃ  má»™t trong cÃ¡c biáº¿n thá»ƒ cá»§a nÃ³.
Cáº£ Ä‘á»‹a chá»‰ IPv4 vÃ  Ä‘á»‹a chá»‰ IPv6 váº«n lÃ  Ä‘á»‹a chá»‰ cÆ¡ báº£n Ä‘á»u lÃ  Ä‘á»‹a chá»‰ IP, vÃ¬ váº­y
chÃºng nÃªn Ä‘Æ°á»£c xem nhÆ° cÃ¹ng má»™t kiá»ƒu dá»¯ liá»‡u khi code cáº§n xá»­ lÃ½ Ä‘á»‹a chá»‰ IP.</p>
<p>ChÃºng ta cÃ³ thá»ƒ biá»ƒu diá»…n khÃ¡i niá»‡m nÃ y trong code báº±ng cÃ¡ch Ä‘á»‹nh nghÄ©a má»™t
enum <code>IpAddrKind</code> vÃ  liá»‡t kÃª cÃ¡c loáº¡i cÃ³ thá»ƒ cÃ³ cá»§a Ä‘á»‹a chá»‰ IP, <code>V4</code> vÃ  <code>V6</code>.
ÄÃ¢y lÃ  cÃ¡c biáº¿n thá»ƒ cá»§a enum:</p>
<pre><pre class="playground"><code class="language-rust edition2024">enum IpAddrKind {
    V4,
    V6,
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let four = IpAddrKind::V4;
</span><span class="boring">    let six = IpAddrKind::V6;
</span><span class="boring">
</span><span class="boring">    route(IpAddrKind::V4);
</span><span class="boring">    route(IpAddrKind::V6);
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn route(ip_kind: IpAddrKind) {}</span></code></pre></pre>
<p><code>IpAddrKind</code> lÃ  má»™t kiá»ƒu dá»¯ liá»‡u tÃ¹y chá»‰nh mÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng á»Ÿ báº¥t ká»³
Ä‘Ã¢u trong code cá»§a mÃ¬nh.</p>
<h3 id="enum-values"><a class="header" href="#enum-values">Enum Values</a></h3>
<p>ChÃºng ta cÃ³ thá»ƒ táº¡o cÃ¡c thá»ƒ hiá»‡n (instance) cá»§a má»—i biáº¿n thá»ƒ cá»§a <code>IpAddrKind</code>
nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">enum IpAddrKind {
</span><span class="boring">    V4,
</span><span class="boring">    V6,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span>    let four = IpAddrKind::V4;
    let six = IpAddrKind::V6;
<span class="boring">
</span><span class="boring">    route(IpAddrKind::V4);
</span><span class="boring">    route(IpAddrKind::V6);
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn route(ip_kind: IpAddrKind) {}</span></code></pre></pre>
<p>LÆ°u Ã½ ráº±ng cÃ¡c biáº¿n thá»ƒ cá»§a enum Ä‘Æ°á»£c Ä‘áº·t trong namepsace cá»§a nÃ³, vÃ  chÃºng ta
sá»­ dá»¥ng hai dáº¥u hai cháº¥m Ä‘á»ƒ phÃ¢n tÃ¡ch chÃºng. Äiá»u nÃ y ráº¥t há»¯u Ã­ch bá»Ÿi vÃ¬ giá» cáº£
hai giÃ¡ trá»‹ <code>IpAddrKind::V4</code> vÃ  <code>IpAddrKind::V6</code> Ä‘á»u lÃ  cÃ¹ng má»™t kiá»ƒu:
<code>IpAddrKind</code>. ChÃºng ta cÃ³ thá»ƒ, vÃ­ dá»¥, Ä‘á»‹nh nghÄ©a má»™t hÃ m nháº­n báº¥t ká»³
<code>IpAddrKind</code> nÃ o:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">enum IpAddrKind {
</span><span class="boring">    V4,
</span><span class="boring">    V6,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let four = IpAddrKind::V4;
</span><span class="boring">    let six = IpAddrKind::V6;
</span><span class="boring">
</span><span class="boring">    route(IpAddrKind::V4);
</span><span class="boring">    route(IpAddrKind::V6);
</span><span class="boring">}
</span><span class="boring">
</span>fn route(ip_kind: IpAddrKind) {}</code></pre></pre>
<p>VÃ  chÃºng ta cÃ³ thá»ƒ gá»i hÃ m nÃ y vá»›i báº¥t ká»³ biáº¿n thá»ƒ nÃ o:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">enum IpAddrKind {
</span><span class="boring">    V4,
</span><span class="boring">    V6,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let four = IpAddrKind::V4;
</span><span class="boring">    let six = IpAddrKind::V6;
</span><span class="boring">
</span>    route(IpAddrKind::V4);
    route(IpAddrKind::V6);
<span class="boring">}
</span><span class="boring">
</span><span class="boring">fn route(ip_kind: IpAddrKind) {}</span></code></pre></pre>
<p>Sá»­ dá»¥ng enum cÃ³ nhiá»u lá»£i Ã­ch khÃ¡c. NghÄ© vá» kiá»ƒu Ä‘á»‹a chá»‰ IP cá»§a chÃºng ta, hiá»‡n
táº¡i chÃºng ta khÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ lÆ°u trá»¯ <em>dá»¯ liá»‡u</em> thá»±c sá»± cá»§a Ä‘á»‹a chá»‰ IP;
chÃºng ta chá»‰ biáº¿t nÃ³ lÃ  <em>loáº¡i</em> gÃ¬. VÃ¬ báº¡n má»›i há»c vá» struct trong chÆ°Æ¡ng 5, báº¡n
cÃ³ thá»ƒ muá»‘n giáº£i quyáº¿t váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng struct nhÆ° trong Listing
6-1.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    enum IpAddrKind {
        V4,
        V6,
    }

    struct IpAddr {
        kind: IpAddrKind,
        address: String,
    }

    let home = IpAddr {
        kind: IpAddrKind::V4,
        address: String::from("127.0.0.1"),
    };

    let loopback = IpAddr {
        kind: IpAddrKind::V6,
        address: String::from("::1"),
    };
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 6-1: LÆ°u trá»¯ dá»¯ liá»‡u vÃ  biáº¿n thá»ƒ <code>IpAddrKind</code> cá»§a
má»™t Ä‘á»‹a chá»‰ IP báº±ng cÃ¡ch sá»­ dá»¥ng má»™t <code>struct</code></span></p>
<p>á» Ä‘Ã¢y, chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a má»™t struct <code>IpAddr</code> cÃ³ hai trÆ°á»ng: má»™t trÆ°á»ng
<code>kind</code> cÃ³ kiá»ƒu <code>IpAddrKind</code> (enum mÃ  chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a trÆ°á»›c Ä‘Ã³) vÃ  má»™t
trÆ°á»ng <code>address</code> cÃ³ kiá»ƒu <code>String</code>. ChÃºng ta cÃ³ hai thá»ƒ hiá»‡n cá»§a struct nÃ y. Thá»©
nháº¥t lÃ  <code>home</code>, vÃ  nÃ³ cÃ³ giÃ¡ trá»‹ <code>IpAddrKind::V4</code> lÃ m giÃ¡ trá»‹ <code>kind</code> vá»›i dá»¯
liá»‡u Ä‘á»‹a chá»‰ liÃªn quan lÃ  <code>127.0.0.1</code>. Thá»ƒ hiá»‡n thá»© hai lÃ  <code>loopback</code>. NÃ³ cÃ³
biáº¿n thá»ƒ khÃ¡c cá»§a <code>IpAddrKind</code> lÃ m giÃ¡ trá»‹ <code>kind</code>, <code>V6</code>, vÃ  cÃ³ Ä‘á»‹a chá»‰ <code>::1</code>.
ChÃºng ta Ä‘Ã£ sá»­ dá»¥ng má»™t struct Ä‘á»ƒ gÃ³i gá»n cÃ¡c giÃ¡ trá»‹ <code>kind</code> vÃ  <code>address</code> láº¡i
vá»›i nhau, vÃ¬ váº­y giá» biáº¿n thá»ƒ Ä‘Æ°á»£c liÃªn káº¿t vá»›i giÃ¡ trá»‹.</p>
<p>Tuy nhiÃªn, biá»ƒu diá»…n cÃ¹ng má»™t khÃ¡i niá»‡m báº±ng cÃ¡ch sá»­ dá»¥ng chá»‰ má»™t enum sáº½ ngáº¯n
gá»n hÆ¡n: thay vÃ¬ má»™t enum bÃªn trong má»™t struct, chÃºng ta cÃ³ thá»ƒ Ä‘áº·t dá»¯ liá»‡u
trá»±c tiáº¿p vÃ o má»—i biáº¿n thá»ƒ enum. Äá»‹nh nghÄ©a má»›i cá»§a enum <code>IpAddr</code> nÃ³i ráº±ng cáº£
biáº¿n thá»ƒ <code>V4</code> vÃ  <code>V6</code> sáº½ cÃ³ cÃ¡c giÃ¡ trá»‹ <code>String</code> liÃªn quan:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    enum IpAddr {
        V4(String),
        V6(String),
    }

    let home = IpAddr::V4(String::from("127.0.0.1"));

    let loopback = IpAddr::V6(String::from("::1"));
<span class="boring">}</span></code></pre></pre>
<p>ChÃºng ta gáº¯n dá»¯ liá»‡u vÃ o má»—i biáº¿n thá»ƒ enum trá»±c tiáº¿p, vÃ¬ váº­y khÃ´ng cáº§n má»™t
struct bá»• sung. á» Ä‘Ã¢y cÅ©ng dá»… dÃ ng hÆ¡n Ä‘á»ƒ tháº¥y má»™t chi tiáº¿t khÃ¡c vá» cÃ¡ch hoáº¡t
Ä‘á»™ng cá»§a enum: tÃªn cá»§a má»—i biáº¿n thá»ƒ enum mÃ  chÃºng ta Ä‘á»‹nh nghÄ©a cÅ©ng trá»Ÿ thÃ nh
constructor táº¡o ra má»™t instance cá»§a enum. Trong Ä‘Ã³, <code>IpAddr::V4()</code> lÃ 
constructor nháº­n má»™t Ä‘á»‘i sá»‘ <code>String</code> vÃ  tráº£ vá» má»™t instance cá»§a kiá»ƒu <code>IpAddr</code>. Constructor nÃ y Ä‘Æ°á»£c tá»± Ä‘á»™ng Ä‘á»‹nh nghÄ©a khi Ä‘á»‹nh nghÄ©a enum.</p>
<p>Má»™t lá»£i Ã­ch khÃ¡c cá»§a viá»‡c sá»­ dá»¥ng enum thay vÃ¬ struct lÃ  má»—i biáº¿n thá»ƒ cÃ³ thá»ƒ cÃ³
cÃ¡c kiá»ƒu vÃ  sá»‘ lÆ°á»£ng dá»¯ liá»‡u liÃªn quan khÃ¡c nhau (á»Ÿ Ä‘Ã¢y nÃ³i vá» kiá»ƒá»§ cá»§a dá»¯ liá»‡u
Ä‘Æ°á»£c gáº¯n vÃ o enum, khÃ´ng pháº£i kiá»ƒu dá»¯ liá»‡u mÃ  enum thá»ƒ hiá»‡n). Äá»‹a chá»‰ IP phiÃªn
báº£n 4 sáº½ luÃ´n cÃ³ 4 thÃ nh pháº§n sá»‘ cÃ³ giÃ¡ trá»‹ tá»« 0 Ä‘áº¿n 255. Náº¿u chÃºng ta muá»‘n lÆ°u
trá»¯ Ä‘á»‹a chá»‰ <code>V4</code> dÆ°á»›i dáº¡ng 4 giÃ¡ trá»‹ <code>u8</code> nhÆ°ng váº«n muá»‘n biá»ƒu diá»…n Ä‘á»‹a chá»‰ <code>V6</code>
dÆ°á»›i dáº¡ng má»™t giÃ¡ trá»‹ <code>String</code>, chÃºng ta sáº½ khÃ´ng thá»ƒ lÃ m Ä‘Æ°á»£c vá»›i má»™t struct.
Enum xá»­ lÃ½ trÆ°á»ng há»£p nÃ y má»™t cÃ¡ch dá»… dÃ ng:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    enum IpAddr {
        V4(u8, u8, u8, u8),
        V6(String),
    }

    let home = IpAddr::V4(127, 0, 0, 1);

    let loopback = IpAddr::V6(String::from("::1"));
<span class="boring">}</span></code></pre></pre>
<p>ChÃºng ta Ä‘Ã£ cÃ³ thá»ƒ dÃ¹ng nhiá»u cÃ¡ch khÃ¡c nhau Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cáº¥u trÃºc dá»¯ liá»‡u Ä‘á»ƒ
lÆ°u trá»¯ Ä‘á»‹a chá»‰ IPv4 vÃ  IPv6. Tuy nhiÃªn, viá»‡c lÆ°u trá»¯ Ä‘á»‹a chá»‰ IP vÃ  mÃ£ hÃ³a loáº¡i
Ä‘á»‹a chá»‰ Ä‘Ã³ lÃ  ráº¥t phá»• biáº¿n nÃªn <a href="../std/net/enum.IpAddr.html">thÆ° viá»‡n chuáº©n cÃ³ má»™t Ä‘á»‹nh nghÄ©a cho chÃºng mÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng!</a><!-- ignore --> HÃ£y xem cÃ¡ch thÆ° viá»‡n chuáº©n
Ä‘á»‹nh nghÄ©a <code>IpAddr</code>: nÃ³ cÃ³ enum vÃ  cÃ¡c biáº¿n thá»ƒ mÃ  chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a vÃ  sá»­
dá»¥ng, nhÆ°ng nÃ³ nhÃºng dá»¯ liá»‡u Ä‘á»‹a chá»‰ bÃªn trong cÃ¡c biáº¿n thá»ƒ dÆ°á»›i dáº¡ng hai
struct khÃ¡c nhau, Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a khÃ¡c nhau cho má»—i biáº¿n thá»ƒ:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Ipv4Addr {
    // --snip--
}

struct Ipv6Addr {
    // --snip--
}

enum IpAddr {
    V4(Ipv4Addr),
    V6(Ipv6Addr),
}
<span class="boring">}</span></code></pre></pre>
<p>Äoáº¡n code nÃ y minh há»a ráº±ng báº¡n cÃ³ thá»ƒ Ä‘áº·t báº¥t ká»³ loáº¡i dá»¯ liá»‡u nÃ o bÃªn trong
má»™t biáº¿n thá»ƒ enum: chuá»—i, kiá»ƒu sá»‘, hoáº·c struct. Báº¡n cÅ©ng cÃ³ thá»ƒ bao gá»“m má»™t
enum khÃ¡c! NgoÃ i ra, cÃ¡c loáº¡i thÆ° viá»‡n chuáº©n thÆ°á»ng khÃ´ng phá»©c táº¡p hÆ¡n nhá»¯ng gÃ¬
báº¡n cÃ³ thá»ƒ táº¡o ra.</p>
<p>LÆ°u Ã½ ráº±ng ngay cáº£ khi thÆ° viá»‡n chuáº©n chá»©a má»™t Ä‘á»‹nh nghÄ©a cho <code>IpAddr</code>, chÃºng
ta váº«n cÃ³ thá»ƒ táº¡o vÃ  sá»­ dá»¥ng Ä‘á»‹nh nghÄ©a cá»§a riÃªng mÃ¬nh mÃ  khÃ´ng xung Ä‘á»™t vÃ¬
chÃºng ta chÆ°a Ä‘Æ°a Ä‘á»‹nh nghÄ©a cá»§a thÆ° viá»‡n chuáº©n vÃ o pháº¡m vi (scope) cá»§a mÃ¬nh.
ChÃºng ta sáº½ nÃ³i thÃªm vá» viá»‡c Ä‘Æ°a cÃ¡c loáº¡i vÃ o pháº¡m vi trong ChÆ°Æ¡ng 7.</p>
<p>HÃ£y cÃ¹ng nhÃ¬n vÃ o má»™t vÃ­ dá»¥ khÃ¡c vá» enum trong Listing 6-2: má»™t enum <code>Message</code>
cÃ³ cÃ¡c biáº¿n thá»ƒ lÆ°u trá»¯ cÃ¡c loáº¡i vÃ  sá»‘ lÆ°á»£ng khÃ¡c nhau cá»§a giÃ¡ trá»‹.</p>
<pre><pre class="playground"><code class="language-rust edition2024">enum Message {
    Quit,
    Move { x: i32, y: i32 },
    Write(String),
    ChangeColor(i32, i32, i32),
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p>Enum nÃ y cÃ³ 4 biáº¿n thá»ƒ vá»›i cÃ¡c loáº¡i khÃ¡c nhau:</p>
<ul>
<li><code>Quit</code> khÃ´ng cÃ³ dá»¯ liá»‡u nÃ o Ä‘Æ°á»£c gáº¯n vá»›i nÃ³.</li>
<li><code>Move</code> cÃ³ cÃ¡c trÆ°á»ng Ä‘Æ°á»£c Ä‘áº·t tÃªn giá»‘ng nhÆ° má»™t struct.</li>
<li><code>Write</code> bao gá»“m má»™t chuá»—i <code>String</code>.</li>
<li><code>ChangeColor</code> bao gá»“m 3 giÃ¡ trá»‹ <code>i32</code>.</li>
</ul>
<p>Äá»‹nh nghÄ©a má»™t enum vá»›i cÃ¡c biáº¿n thá»ƒ nhÆ° trong Listing 6-2 tÆ°Æ¡ng tá»± nhÆ° Ä‘á»‹nh
nghÄ©a cÃ¡c loáº¡i struct khÃ¡c, ngoáº¡i trá»« enum khÃ´ng sá»­ dá»¥ng tá»« khÃ³a <code>struct</code> vÃ 
táº¥t cáº£ cÃ¡c biáº¿n thá»ƒ Ä‘Æ°á»£c nhÃ³m láº¡i dÆ°á»›i loáº¡i <code>Message</code>. CÃ¡c struct sau cÃ³ thá»ƒ chá»©a cÃ¹ng dá»¯ liá»‡u vá»›i cÃ¡c biáº¿n thá»ƒ enum trÆ°á»›c Ä‘Ã³:</p>
<pre><pre class="playground"><code class="language-rust edition2024">struct QuitMessage; // unit struct
struct MoveMessage {
    x: i32,
    y: i32,
}
struct WriteMessage(String); // tuple struct
struct ChangeColorMessage(i32, i32, i32); // tuple struct
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p>NhÆ°ng náº¿u chÃºng ta sá»­ dá»¥ng cÃ¡c struct khÃ¡c, má»—i struct cÃ³ loáº¡i riÃªng, chÃºng ta
sáº½ khÃ´ng thá»ƒ dá»… dÃ ng Ä‘á»‹nh nghÄ©a má»™t hÃ m nháº­n báº¥t ká»³ loáº¡i tin nháº¯n nÃ o nhÆ° chÃºng
ta cÃ³ thá»ƒ vá»›i enum <code>Message</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong Listing 6-2, má»™t loáº¡i duy
nháº¥t.</p>
<p>CÃ³ má»™t Ä‘iá»ƒm tÆ°Æ¡ng Ä‘á»“ng ná»¯a giá»¯a enum vÃ  struct: giá»‘ng nhÆ° chÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh
nghÄ©a cÃ¡c phÆ°Æ¡ng thá»©c trÃªn struct sá»­ dá»¥ng <code>impl</code>, chÃºng ta cÅ©ng cÃ³ thá»ƒ Ä‘á»‹nh
nghÄ©a cÃ¡c phÆ°Æ¡ng thá»©c trÃªn enum. ÄÃ¢y lÃ  má»™t phÆ°Æ¡ng thá»©c cÃ³ tÃªn <code>call</code> mÃ  chÃºng
ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a trÃªn enum <code>Message</code> cá»§a chÃºng ta:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span><span class="boring">    enum Message {
</span><span class="boring">        Quit,
</span><span class="boring">        Move { x: i32, y: i32 },
</span><span class="boring">        Write(String),
</span><span class="boring">        ChangeColor(i32, i32, i32),
</span><span class="boring">    }
</span><span class="boring">
</span>    impl Message {
        fn call(&amp;self) {
            // method body would be defined here
        }
    }

    let m = Message::Write(String::from("hello"));
    m.call();
<span class="boring">}</span></code></pre></pre>
<p>Pháº§n thÃ¢n cá»§a phÆ°Æ¡ng thá»©c sáº½ sá»­ dá»¥ng <code>self</code> Ä‘á»ƒ láº¥y giÃ¡ trá»‹ mÃ  chÃºng ta khá»Ÿi
táº¡o. Trong vÃ­ dá»¥ nÃ y, chÃºng ta Ä‘Ã£ táº¡o má»™t biáº¿n <code>m</code> cÃ³ giÃ¡ trá»‹ <code>Message::Write(String::from("hello"))</code>, vÃ  giÃ¡ trá»‹ nÃ y cÅ©ng sáº½ lÃ  giÃ¡ trá»‹ cá»§a <code>self</code> mÃ 
phÆ°Æ¡ng thá»©c <code>call</code> sáº½ láº¥y ra khi <code>m.call()</code> cháº¡y.</p>
<p>HÃ£y xem má»™t enum khÃ¡c trong thÆ° viá»‡n chuáº©n ráº¥t phá»• biáº¿n vÃ  há»¯u Ã­ch: <code>Option</code>.</p>
<hr />
<h3 id="the-option-enum-and-its-advantages-over-null-values"><a class="header" href="#the-option-enum-and-its-advantages-over-null-values">The <code>Option</code> Enum and Its Advantages Over Null Values</a></h3>
<p>Pháº§n nÃ y sáº½ khÃ¡m phÃ¡ má»™t trÆ°á»ng há»£p sá»­ dá»¥ng cá»§a <code>Option</code>, má»™t enum Ä‘Æ°á»£c Ä‘á»‹nh
nghÄ©a bá»Ÿi thÆ° viá»‡n chuáº©n. Kiá»ƒu <code>Option</code> cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng trong nhiá»u tÃ¬nh huá»‘ng
mÃ  dá»¯ liá»‡u cÃ³ thá»ƒ lÃ  má»™t giÃ¡ trá»‹ hoáº·c khÃ´ng cÃ³ giÃ¡ trá»‹.</p>
<p>VÃ­ dá»¥, náº¿u báº¡n yÃªu cáº§u pháº§n tá»­ Ä‘áº§u tiÃªn cá»§a má»™t danh sÃ¡ch, báº¡n sáº½ nháº­n Ä‘Æ°á»£c má»™t
giÃ¡ trá»‹. Náº¿u báº¡n yÃªu cáº§u pháº§n tá»­ Ä‘áº§u tiÃªn cá»§a má»™t danh sÃ¡ch rá»—ng, báº¡n sáº½ khÃ´ng
nháº­n Ä‘Æ°á»£c gÃ¬. Biá»ƒu diá»…n khÃ¡i niá»‡m nÃ y trong há»‡ thá»‘ng kiá»ƒu cÃ³ nghÄ©a lÃ  trÃ¬nh
biÃªn dá»‹ch cÃ³ thá»ƒ kiá»ƒm tra xem báº¡n cÃ³ xá»­ lÃ½ táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p mÃ  báº¡n nÃªn xá»­
lÃ½ hay khÃ´ng; tÃ­nh nÄƒng nÃ y cÃ³ thá»ƒ ngÄƒn cháº·n cÃ¡c lá»—i ráº¥t phá»• biáº¿n trong cÃ¡c
ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c.</p>
<p>Thiáº¿t káº¿ ngÃ´n ngá»¯ láº­p trÃ¬nh thÆ°á»ng Ä‘Æ°á»£c xem nhÆ° lÃ  viá»‡c báº¡n sáº½ thÃªm vÃ o cÃ¡c
tÃ­nh nÄƒng nÃ o, nhÆ°ng cÃ¡c tÃ­nh nÄƒng báº¡n loáº¡i bá» cÅ©ng quan trá»ng. Rust khÃ´ng cÃ³
tÃ­nh nÄƒng null mÃ  nhiá»u ngÃ´n ngá»¯ khÃ¡c cÃ³. <em>Null</em> lÃ  má»™t giÃ¡ trá»‹ cÃ³ nghÄ©a lÃ 
khÃ´ng cÃ³ giÃ¡ trá»‹ nÃ o á»Ÿ Ä‘Ã³. Trong cÃ¡c ngÃ´n ngá»¯ cÃ³ null, cÃ¡c biáº¿n luÃ´n cÃ³ thá»ƒ á»Ÿ
má»™t trong hai tráº¡ng thÃ¡i: null hoáº·c khÃ´ng null.</p>
<p>VÃ o nÄƒm 2009, trong bÃ i trÃ¬nh bÃ y â€œNull References: The Billion Dollar
Mistakeâ€, Tony Hoare, ngÆ°á»i sÃ¡ng cháº¿ null, nÃ³i nhÆ° sau:</p>
<blockquote>
<p>TÃ´i gá»i nÃ³ lÃ  sai láº§m Ä‘áº¯t Ä‘á» hÃ ng tá»· Ä‘Ã´ la cá»§a tÃ´i. Táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³, tÃ´i
Ä‘ang thiáº¿t káº¿ há»‡ thá»‘ng kiá»ƒu tham chiáº¿u Ä‘áº§u tiÃªn cho má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh
hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng. Má»¥c tiÃªu cá»§a tÃ´i lÃ  Ä‘áº£m báº£o ráº±ng táº¥t cáº£ cÃ¡c tham chiáº¿u sáº½ Ä‘Æ°á»£c
an toÃ n, vá»›i kiá»ƒm tra Ä‘Æ°á»£c thá»±c hiá»‡n tá»± Ä‘á»™ng bá»Ÿi trÃ¬nh biÃªn dá»‹ch. NhÆ°ng tÃ´i
khÃ´ng thá»ƒ cÆ°á»¡ng láº¡i ná»—i náº£n lÃ²ng cá»§a tÃ´i Ä‘á»ƒ thÃªm vÃ o má»™t tham chiáº¿u null, chá»‰
vÃ¬ nÃ³ ráº¥t dá»… Ä‘á»ƒ triá»ƒn khai. Äiá»u nÃ y Ä‘Ã£ dáº«n Ä‘áº¿n hÃ ng ngÃ n lá»—i, thiá»‡t háº¡i vÃ 
há»ng hÃ³c há»‡ thá»‘ng, cÃ³ thá»ƒ Ä‘Ã£ gÃ¢y ra hÃ ng tá»· Ä‘Ã´ la sá»± cá»‘ trong 40 nÄƒm qua.</p>
</blockquote>
<p>Váº¥n Ä‘á» vá»›i cÃ¡c giÃ¡ trá»‹ null lÃ  náº¿u báº¡n cá»‘ gáº¯ng sá»­ dá»¥ng má»™t giÃ¡ trá»‹ null nhÆ° má»™t
giÃ¡ trá»‹ not-null, báº¡n sáº½ nháº­n Ä‘Æ°á»£c má»™t loáº¡i lá»—i nÃ o Ä‘Ã³. Bá»Ÿi vÃ¬ tÃ­nh cháº¥t nÃ y
null hoáº·c not-null ráº¥t phá»• biáº¿n, nÃ³ ráº¥t dá»… Ä‘á»ƒ gÃ¢y ra loáº¡i lá»—i nÃ y.</p>
<p>Tuy nhiÃªn, khÃ¡i niá»‡m mÃ  null Ä‘ang cá»‘ gáº¯ng biá»ƒu thá»‹ váº«n lÃ  má»™t khÃ¡i niá»‡m há»¯u
Ã­ch: má»™t null lÃ  má»™t giÃ¡ trá»‹ hiá»‡n táº¡i khÃ´ng há»£p lá»‡ hoáº·c váº¯ng máº·t vÃ¬ má»™t lÃ½ do
nÃ o Ä‘Ã³.</p>
<p>Váº¥n Ä‘á» thá»±c sá»± khÃ´ng pháº£i lÃ  vá»›i khÃ¡i niá»‡m mÃ  lÃ  vá»›i cÃ¡ch hiá»‡n thá»±c cá»¥ thá»ƒ cá»§a
null. VÃ¬ váº­y, Rust khÃ´ng cÃ³ null, nhÆ°ng nÃ³ cÃ³ má»™t dáº¡ng enum cÃ³ thá»ƒ  thá»ƒ hiá»‡n
ráº±ng giÃ¡ trá»‹ Ä‘ang váº¯ng máº·t. Enum nÃ y lÃ  <code>Option&lt;T&gt;</code>, vÃ  nÃ³ Ä‘Æ°á»£c <a href="../std/option/enum.Option.html">Ä‘á»‹nh nghÄ©a bá»Ÿi thÆ° viá»‡n chuáº©n</a><!-- ignore --> nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Option&lt;T&gt; {
    None,
    Some(T),
}
<span class="boring">}</span></code></pre></pre>
<p>Enum <code>Option&lt;T&gt;</code> ráº¥t há»¯u Ã­ch nÃªn nÃ³ Ä‘Æ°á»£c bao gá»“m trong prelude; báº¡n khÃ´ng cáº§n
pháº£i Ä‘Æ°a nÃ³ vÃ o scope má»™t cÃ¡ch tÆ°á»ng minh. CÃ¡c biáº¿n thá»ƒ cá»§a nÃ³ cÅ©ng Ä‘Æ°á»£c bao
gá»“m trong prelude: báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng <code>Some</code> vÃ  <code>None</code> trá»±c tiáº¿p mÃ  khÃ´ng cáº§n
tiá»n tá»‘ <code>Option::</code>. Enum <code>Option&lt;T&gt;</code> váº«n chá»‰ lÃ  má»™t enum thÃ´ng thÆ°á»ng, vÃ  <code>Some(T)</code> vÃ  <code>None</code> váº«n lÃ  cÃ¡c biáº¿n thá»ƒ cá»§a kiá»ƒu <code>Option&lt;T&gt;</code>.</p>
<p><code>&lt;T&gt;</code> lÃ  syntax cá»§a Rust mÃ  chÃºng ta chÆ°a nÃ³i Ä‘áº¿n. NÃ³ lÃ  má»™t tham sá»‘ kiá»ƒu
generic, vÃ  chÃºng ta sáº½ tÃ¬m hiá»ƒu vá» generic chi tiáº¿t hÆ¡n trong chÆ°Æ¡ng 10. Hiá»‡n
táº¡i, báº¡n chá»‰ cáº§n biáº¿t ráº±ng <code>&lt;T&gt;</code> cÃ³ nghÄ©a lÃ  biáº¿n thá»ƒ <code>Some</code> cá»§a enum <code>Option</code>
cÃ³ thá»ƒ chá»©a má»™t pháº§n dá»¯ liá»‡u cá»§a báº¥t ká»³ kiá»ƒu nÃ o, vÃ  má»—i kiá»ƒu cá»¥ thá»ƒ Ä‘Æ°á»£c sá»­
dá»¥ng thay tháº¿ cho <code>T</code> lÃ m cho kiá»ƒu <code>Option&lt;T&gt;</code> tá»•ng thá»ƒ trá»Ÿ thÃ nh má»™t kiá»ƒu
khÃ¡c. ÄÃ¢y lÃ  má»™t sá»‘ vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng giÃ¡ trá»‹ <code>Option</code> Ä‘á»ƒ chá»©a cÃ¡c kiá»ƒu sá»‘
vÃ  cÃ¡c kiá»ƒu chuá»—i:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let some_number = Some(5);
    let some_char = Some('e');

    let absent_number: Option&lt;i32&gt; = None;
<span class="boring">}</span></code></pre></pre>
<p>Kiá»ƒu cá»§a <code>some_number</code> lÃ  <code>Option&lt;i32&gt;</code>. Kiá»ƒu cá»§a <code>some_char</code> lÃ 
<code>Option&lt;char&gt;</code>, Ä‘Ã¢y lÃ  má»™t kiá»ƒu khÃ¡c. Rust cÃ³ thá»ƒ suy ra cÃ¡c kiá»ƒu nÃ y vÃ¬ chÃºng
ta Ä‘Ã£ chá»‰ Ä‘á»‹nh má»™t giÃ¡ trá»‹ bÃªn trong biáº¿n thá»ƒ <code>Some</code>. Äá»‘i vá»›i <code>absent_number</code>,
Rust yÃªu cáº§u chÃºng ta pháº£i gáº¯n nhÃ£n kiá»ƒu tá»•ng thá»ƒ <code>Option</code>: trÃ¬nh biÃªn dá»‹ch
khÃ´ng thá»ƒ suy ra kiá»ƒu mÃ  biáº¿n thá»ƒ <code>Some</code> sáº½ chá»©a báº±ng cÃ¡ch chá»‰ xem má»™t giÃ¡ trá»‹
<code>None</code>. á» Ä‘Ã¢y, chÃºng ta nÃ³i vá»›i Rust ráº±ng chÃºng ta muá»‘n <code>absent_number</code> cÃ³ kiá»ƒu
<code>Option&lt;i32&gt;</code>.</p>
<p>Khi chÃºng ta cÃ³ má»™t giÃ¡ trá»‹ <code>Some</code>, chÃºng ta biáº¿t ráº±ng cÃ³ má»™t giÃ¡ trá»‹ hiá»‡n cÃ³
vÃ  giÃ¡ trá»‹ Ä‘Ã³ Ä‘Æ°á»£c giá»¯ bÃªn trong <code>Some</code>. Khi chÃºng ta cÃ³ má»™t giÃ¡ trá»‹ <code>None</code>,
má»™t cÃ¡ch nÃ o Ä‘Ã³, nÃ³ cÃ³ nghÄ©a giá»‘ng nhÆ° null: chÃºng ta khÃ´ng cÃ³ má»™t giÃ¡ trá»‹ há»£p
lá»‡. Váº­y táº¡i sao  <code>Option&lt;T&gt;</code> tá»‘t hÆ¡n null?</p>
<p>Ngáº¯n gá»n mÃ  nÃ³i, vÃ¬ <code>Option&lt;T&gt;</code> vÃ  <code>T</code> (vá»›i <code>T</code> cÃ³ thá»ƒ lÃ  báº¥t ká»³ kiá»ƒu nÃ o) lÃ 
cÃ¡c kiá»ƒu khÃ¡c nhau, trÃ¬nh biÃªn dá»‹ch sáº½ khÃ´ng cho phÃ©p chÃºng ta sá»­ dá»¥ng má»™t giÃ¡
trá»‹ <code>Option&lt;T&gt;</code> nhÆ° lÃ  má»™t giÃ¡ trá»‹ há»£p lá»‡. VÃ­ dá»¥, Ä‘oáº¡n mÃ£ nÃ y sáº½ khÃ´ng biÃªn
dá»‹ch Ä‘Æ°á»£c vÃ¬ nÃ³ Ä‘ang cá»‘ gáº¯ng cá»™ng má»™t <code>i8</code> vá»›i má»™t <code>Option&lt;i8&gt;</code>:</p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span>    let x: i8 = 5;
    let y: Option&lt;i8&gt; = Some(5);

    let sum = x + y;
<span class="boring">}</span></code></pre>
<p>Náº¿u chÃºng ta cháº¡y Ä‘oáº¡n code nÃ y, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c má»™t thÃ´ng bÃ¡o lá»—i nhÆ°
sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling enums v0.1.0 (file:///projects/enums)
error[E0277]: cannot add `Option&lt;i8&gt;` to `i8`
 --&gt; src/main.rs:5:17
  |
5 |     let sum = x + y;
  |                 ^ no implementation for `i8 + Option&lt;i8&gt;`
  |
  = help: the trait `Add&lt;Option&lt;i8&gt;&gt;` is not implemented for `i8`
  = help: the following other types implement trait `Add&lt;Rhs&gt;`:
            `&amp;i8` implements `Add&lt;i8&gt;`
            `&amp;i8` implements `Add`
            `i8` implements `Add&lt;&amp;i8&gt;`
            `i8` implements `Add`

For more information about this error, try `rustc --explain E0277`.
error: could not compile `enums` (bin "enums") due to 1 previous error
</code></pre>
<p>ThÃ´ng bÃ¡o lá»—i nÃ y cÃ³ nghÄ©a lÃ  Rust khÃ´ng hiá»ƒu cÃ¡ch cá»™ng má»™t <code>i8</code> vÃ  má»™t
<code>Option&lt;i8&gt;</code>, vÃ¬ chÃºng lÃ  cÃ¡c kiá»ƒu khÃ¡c nhau. Khi chÃºng ta cÃ³ má»™t giÃ¡ trá»‹ cá»§a
má»™t kiá»ƒu nhÆ° <code>i8</code> trong Rust, trÃ¬nh biÃªn dá»‹ch sáº½ Ä‘áº£m báº£o ráº±ng chÃºng ta luÃ´n cÃ³
má»™t giÃ¡ trá»‹ há»£p lá»‡. ChÃºng ta cÃ³ thá»ƒ tiáº¿n hÃ nh má»™t cÃ¡ch tá»± tin mÃ  khÃ´ng cáº§n kiá»ƒm
tra null trÆ°á»›c khi sá»­ dá»¥ng giÃ¡ trá»‹ Ä‘Ã³. Chá»‰ khi chÃºng ta cÃ³ má»™t <code>Option&lt;i8&gt;</code>
(hoáº·c báº¥t ká»³ kiá»ƒu giÃ¡ trá»‹ nÃ o chÃºng ta Ä‘ang lÃ m viá»‡c vá»›i nÃ³) thÃ¬ chÃºng ta má»›i
pháº£i lo láº¯ng vá» viá»‡c cÃ³ thá»ƒ khÃ´ng cÃ³ má»™t giÃ¡ trá»‹, vÃ  trÃ¬nh biÃªn dá»‹ch sáº½ Ä‘áº£m báº£o
ráº±ng chÃºng ta xá»­ lÃ½ trÆ°á»ng há»£p Ä‘Ã³ trÆ°á»›c khi sá»­ dá»¥ng giÃ¡ trá»‹.</p>
<p>NÃ³i cÃ¡ch khÃ¡c, báº¡n pháº£i chuyá»ƒn Ä‘á»•i má»™t <code>Option&lt;T&gt;</code> thÃ nh má»™t <code>T</code> trÆ°á»›c khi báº¡n
cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c trÃªn <code>T</code>. ThÃ´ng thÆ°á»ng, Ä‘iá»u nÃ y giÃºp phÃ¡t hiá»‡n
má»™t trong nhá»¯ng váº¥n Ä‘á» phá»• biáº¿n nháº¥t vá»›i null: giáº£ Ä‘á»‹nh ráº±ng má»™t thá»© gÃ¬ Ä‘Ã³
khÃ´ng pháº£i lÃ  null khi nÃ³ thá»±c cháº¥t lÃ  null.</p>
<p>Giáº£m thiá»ƒu rá»§i ro cá»§a nhá»¯ng giáº£ Ä‘á»‹nh khÃ´ng Ä‘Ãºng vá» giÃ¡ trá»‹ not-null giÃºp báº¡n
tin tÆ°á»Ÿng hÆ¡n vÃ o code cá»§a mÃ¬nh. Äá»ƒ cÃ³ má»™t giÃ¡ trá»‹ cÃ³ thá»ƒ lÃ  null, báº¡n pháº£i
chá»n lá»±a má»™t cÃ¡ch rÃµ rÃ ng báº±ng cÃ¡ch Ä‘áº·t kiá»ƒu cá»§a giÃ¡ trá»‹ Ä‘Ã³ lÃ  <code>Option&lt;T&gt;</code>. Sau
Ä‘Ã³, khi báº¡n sá»­ dá»¥ng giÃ¡ trá»‹ Ä‘Ã³, báº¡n sáº½ buá»™c pháº£i xá»­ lÃ½ trÆ°á»ng há»£p khi giÃ¡ trá»‹
lÃ  null. Má»i nÆ¡i mÃ  má»™t giÃ¡ trá»‹ cÃ³ má»™t kiá»ƒu khÃ´ng pháº£i lÃ  <code>Option&lt;T&gt;</code>, báº¡n <em>cÃ³
thá»ƒ</em> an toÃ n giáº£ Ä‘á»‹nh ráº±ng giÃ¡ trá»‹ Ä‘Ã³ khÃ´ng pháº£i lÃ  null. ÄÃ¢y lÃ  má»™t quyáº¿t Ä‘á»‹nh
thiáº¿t káº¿ cÃ³ chá»§ Ä‘Ã­ch cá»§a Rust Ä‘á»ƒ giá»›i háº¡n sá»± lan truyá»n cá»§a null vÃ  tÄƒng tÃ­nh
an toÃ n cá»§a code Rust.</p>
<p>Do Ä‘Ã³, lÃ m tháº¿ nÃ o Ä‘á»ƒ báº¡n láº¥y giÃ¡ trá»‹ <code>T</code> ra khá»i má»™t biáº¿n thá»ƒ <code>Some</code> khi báº¡n
cÃ³ má»™t giÃ¡ trá»‹ cá»§a kiá»ƒu <code>Option&lt;T&gt;</code> Ä‘á»ƒ báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng giÃ¡ trá»‹ Ä‘Ã³? Enum
<code>Option&lt;T&gt;</code> cÃ³ má»™t sá»‘ phÆ°Æ¡ng thá»©c ráº¥t há»¯u Ã­ch trong má»™t sá»‘ tÃ¬nh huá»‘ng; báº¡n cÃ³
thá»ƒ kiá»ƒm tra chÃºng trong <a href="../std/option/enum.Option.html">tÃ i liá»‡u cá»§a nÃ³</a><!-- ignore -->. Quen thuá»™c vá»›i
cÃ¡c phÆ°Æ¡ng thá»©c trÃªn <code>Option&lt;T&gt;</code> sáº½ ráº¥t há»¯u Ã­ch trong hÃ nh trÃ¬nh cá»§a báº¡n vá»›i
Rust.</p>
<p>Tá»•ng quan mÃ  nÃ³i, Ä‘á»ƒ sá»­ dá»¥ng má»™t giÃ¡ trá»‹ <code>Option&lt;T&gt;</code>, báº¡n cáº§n cÃ³ code Ä‘á»ƒ xá»­ lÃ½
má»—i biáº¿n thá»ƒ. Báº¡n cáº§n má»™t code Ä‘á»ƒ cháº¡y chá»‰ khi báº¡n cÃ³ má»™t giÃ¡ trá»‹ <code>Some(T)</code>, vÃ 
code nÃ y Ä‘Æ°á»£c phÃ©p sá»­ dá»¥ng <code>T</code> bÃªn trong. Báº¡n cáº§n má»™t code khÃ¡c Ä‘á»ƒ cháº¡y náº¿u báº¡n
cÃ³ má»™t giÃ¡ trá»‹ <code>None</code> vÃ  code Ä‘Ã³ khÃ´ng cÃ³ má»™t giÃ¡ trá»‹ <code>T</code> nÃ o. Biá»ƒu thá»©c
<code>match</code> lÃ  má»™t cáº¥u trÃºc Ä‘iá»u khiá»ƒn sáº½ giÃºp báº¡n lÃ m Ä‘iá»u nÃ y khi Ä‘Æ°á»£c sá»­ dá»¥ng
vá»›i enum: nÃ³ sáº½ cháº¡y code khÃ¡c nhau tÃ¹y thuá»™c vÃ o biáº¿n thá»ƒ cá»§a enum mÃ  nÃ³ cÃ³,
vÃ  code Ä‘Ã³ cÃ³ thá»ƒ sá»­ dá»¥ng dá»¯ liá»‡u bÃªn trong giÃ¡ trá»‹ khá»›p vá»›i nÃ³.</p>
<div style="break-before: page; page-break-before: always;"></div><p><a id="the-match-control-flow-operator"></a></p>
<h2 id="the-match-control-flow-construct"><a class="header" href="#the-match-control-flow-construct">The <code>match</code> Control Flow Construct</a></h2>
<p>Rust cÃ³ má»™t cáº¥u trÃºc Ä‘iá»u khiá»ƒn ráº¥t máº¡nh gá»i lÃ  <code>match</code> cho phÃ©p báº¡n so sÃ¡nh
má»™t giÃ¡ trá»‹ vá»›i má»™t chuá»—i cÃ¡c máº«u (pattern) vÃ  sau Ä‘Ã³ thá»±c thi mÃ£ dá»±a trÃªn máº«u
nÃ o khá»›p. CÃ¡c pattern cÃ³ thá»ƒ Ä‘Æ°á»£c táº¡o thÃ nh tá»« cÃ¡c giÃ¡ trá»‹ literal, tÃªn biáº¿n,
wildcard vÃ  nhiá»u thá»© khÃ¡c; ChÆ°Æ¡ng 18 bao gá»“m táº¥t cáº£ cÃ¡c loáº¡i pattern khÃ¡c nhau
vÃ  nhá»¯ng gÃ¬ chÃºng lÃ m. Sá»©c máº¡nh cá»§a <code>match</code> Ä‘áº¿n tá»« sá»± biá»ƒu diá»…n cá»§a cÃ¡c máº«u vÃ 
sá»± cháº¯c cháº¯n cá»§a trÃ¬nh biÃªn dá»‹ch ráº±ng táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p cÃ³ thá»ƒ Ä‘Æ°á»£c xá»­ lÃ½.</p>
<p>HÃ£y nghÄ© vá» <code>match</code> giá»‘ng nhÆ° má»™t mÃ¡y sáº¯p xáº¿p tiá»n xu: cÃ¡c Ä‘á»“ng xu sáº½ trÆ°á»£t
xuá»‘ng má»™t Ä‘Æ°á»ng vá»›i cÃ¡c lá»— cÃ³ kÃ­ch thÆ°á»›c khÃ¡c nhau dá»c theo Ä‘Æ°á»ng, vÃ  má»—i tiá»n
xu sáº½ rÆ¡i vÃ o lá»— Ä‘áº§u tiÃªn nÃ³ gáº·p mÃ  nÃ³ vá»«a váº·n vÃ o. TÆ°Æ¡ng tá»± nhÆ° váº­y, cÃ¡c giÃ¡
trá»‹ Ä‘i qua láº§n lÆ°á»£t cÃ¡c pattern trong <code>match</code>, vÃ  á»Ÿ pattern Ä‘áº§u tiÃªn giÃ¡ trá»‹
â€œvá»«a váº·nâ€, giÃ¡ trá»‹ sáº½ rÆ¡i vÃ o code liÃªn quan Ä‘á»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng trong quÃ¡ trÃ¬nh
thá»±c thi.</p>
<p>NÃ³i vá» nhá»¯ng Ä‘á»“ng xu, hÃ£y sá»­ dá»¥ng chÃºng lÃ m vÃ­ dá»¥ vá»›i <code>match</code>! ChÃºng ta cÃ³ thá»ƒ
viáº¿t má»™t hÃ m mÃ  nháº­n vÃ o má»™t Ä‘á»“ng xu cá»§a Hoa Ká»³ báº¥t ká»³, tÆ°Æ¡ng tá»± nhÆ° mÃ¡y Ä‘áº¿m
tiá»n xu, hÃ m nÃ y sáº½ xÃ¡c Ä‘á»‹nh Ä‘á»“ng xu Ä‘Ã³ cÃ³ má»‡nh giÃ¡ lÃ  gÃ¬ vÃ  tráº£ vá» má»‡nh giÃ¡
cá»§a Ä‘á»“ng xu, vá»›i Ä‘Æ¡n vá»‹ lÃ  cent, nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y trong Listing 6-3.</p>
<pre><pre class="playground"><code class="language-rust edition2024">enum Coin {
    Penny,
    Nickel,
    Dime,
    Quarter,
}

fn value_in_cents(coin: Coin) -&gt; u8 {
    match coin {
        Coin::Penny =&gt; 1,
        Coin::Nickel =&gt; 5,
        Coin::Dime =&gt; 10,
        Coin::Quarter =&gt; 25,
    }
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p><span class="caption">Listing 6-3: Má»™t enum vÃ  má»™t biá»ƒu thá»©c <code>match</code> nháº­n cÃ¡c
biáº¿n thá»ƒ cá»§a enum nhÆ° lÃ  cÃ¡c pattern cá»§a nÃ³</span></p>
<p>CÃ¹ng lÃ m rÃµ <code>match</code> trong hÃ m <code>value_in_cents</code>. Äáº§u tiÃªn, chÃºng ta sáº½ liá»‡t kÃª
tá»« khÃ³a (keyword) <code>match</code> theo sau lÃ  má»™t biá»ƒu thá»©c, trong trÆ°á»ng há»£p nÃ y lÃ 
giÃ¡ trá»‹ <code>coin</code>. Äiá»u nÃ y cÃ³ váº» ráº¥t giá»‘ng vá»›i biá»ƒu thá»©c Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i <code>if</code>,
nhÆ°ng cÃ³ má»™t sá»± khÃ¡c biá»‡t lá»›n: vá»›i <code>if</code>, biá»ƒu thá»©c cáº§n tráº£ vá» má»™t giÃ¡ trá»‹
Boolean, nhÆ°ng á»Ÿ Ä‘Ã¢y, nÃ³ cÃ³ thá»ƒ tráº£ vá» báº¥t ká»³ kiá»ƒu dá»¯ liá»‡u nÃ o. Kiá»ƒu dá»¯ liá»‡u
cá»§a <code>coin</code> trong vÃ­ dá»¥ nÃ y lÃ  enum <code>Coin</code> mÃ  chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a á»Ÿ dÃ²ng Ä‘áº§u
tiÃªn.</p>
<p>Tiáº¿p theo Ä‘Ã³ lÃ  cÃ¡c nhÃ¡nh (arm) cá»§a <code>match</code>. Má»—i nhÃ¡nh nÃ y Ä‘á»u cÃ³ hai thÃ nh
pháº§n: pattern vÃ  code. ThÃ nh pháº§n Ä‘áº§u tiÃªn á»Ÿ Ä‘Ã¢y lÃ  pattern cÃ³ giÃ¡ trá»‹ lÃ 
<code>Coin::Penny</code> vÃ  sau Ä‘Ã³ lÃ  toÃ¡n tá»­ <code>=&gt;</code> phÃ¢n tÃ¡ch giá»¯a pattern vÃ  code Ä‘á»ƒ cháº¡y.
Code trong trÆ°á»ng há»£p nÃ y chá»‰ lÃ  giÃ¡ trá»‹ <code>1</code>. Má»—i nhÃ¡nh Ä‘Æ°á»£c phÃ¢n tÃ¡ch vá»›i
nhÃ¡nh tiáº¿p theo báº±ng dáº¥u pháº©y.</p>
<p>Khi biá»ƒu thá»©c <code>match</code> Ä‘Æ°á»£c thá»±c thi, nÃ³ sáº½ so sÃ¡nh giÃ¡ trá»‹ káº¿t quáº£ vá»›i pattern
cá»§a má»—i nhÃ¡nh, theo thá»© tá»±. Náº¿u má»™t pattern khá»›p vá»›i giÃ¡ trá»‹, code liÃªn quan
Ä‘áº¿n pattern Ä‘Ã³ sáº½ Ä‘Æ°á»£c thá»±c thi. Náº¿u pattern Ä‘Ã³ khÃ´ng khá»›p vá»›i giÃ¡ trá»‹, thá»±c
thi sáº½ tiáº¿p tá»¥c Ä‘áº¿n nhÃ¡nh tiáº¿p theo, giá»‘ng nhÆ° trong má»™t mÃ¡y sáº¯p xáº¿p tiá»n.
ChÃºng ta cÃ³ thá»ƒ cÃ³ bao nhiÃªu nhÃ¡nh cáº§n thiáº¿t: trong Listing 6-3, <code>match</code> cá»§a
chÃºng ta cÃ³ 4 nhÃ¡nh.</p>
<p>Äoáº¡n code liÃªn quan vá»›i má»—i nhÃ¡nh lÃ  má»™t biá»ƒu thá»©c (expression), vÃ  giÃ¡ trá»‹ káº¿t
quáº£ cá»§a biá»ƒu thá»©c trong nhÃ¡nh Ä‘Æ°á»£c khá»›p sáº½ lÃ  giÃ¡ trá»‹ Ä‘Æ°á»£c tráº£ vá» cho toÃ n bá»™
biá»ƒu thá»©c <code>match</code>.</p>
<p>ChÃºng ta thÆ°á»ng khÃ´ng sá»­ dá»¥ng dáº¥u ngoáº·c nhá»n náº¿u nhÃ¡nh cá»§a match cÃ³ Ä‘oáº¡n code
ngáº¯n, nhÆ° trong Listing 6-3, má»—i nhÃ¡nh chá»‰ tráº£ vá» má»™t giÃ¡ trá»‹. Náº¿u báº¡n muá»‘n
cháº¡y nhiá»u dÃ²ng code trong má»™t nhÃ¡nh cá»§a match, báº¡n pháº£i sá»­ dá»¥ng dáº¥u ngoáº·c
nhá»n, vÃ  dáº¥u pháº©y sau nhÃ¡nh lÃ  tÃ¹y chá»n. VÃ­ dá»¥, Ä‘oáº¡n code sau in ra â€œLucky
penny!â€ má»—i khi phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c gá»i vá»›i má»™t <code>Coin::Penny</code>, nhÆ°ng váº«n tráº£ vá»
giÃ¡ trá»‹ cuá»‘i cÃ¹ng cá»§a khá»‘i, <code>1</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">enum Coin {
</span><span class="boring">    Penny,
</span><span class="boring">    Nickel,
</span><span class="boring">    Dime,
</span><span class="boring">    Quarter,
</span><span class="boring">}
</span><span class="boring">
</span>fn value_in_cents(coin: Coin) -&gt; u8 {
  match coin {
      Coin::Penny =&gt; {
          println!("Lucky penny!");
          1
      }
      Coin::Nickel =&gt; 5,
      Coin::Dime =&gt; 10,
      Coin::Quarter =&gt; 25,
  }
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<hr />
<h3 id="patterns-that-bind-to-values"><a class="header" href="#patterns-that-bind-to-values">Patterns that Bind to Values</a></h3>
<p>Má»™t tÃ­nh nÄƒng há»¯u Ã­ch khÃ¡c cá»§a cÃ¡c nhÃ¡nh cá»§a match lÃ  chÃºng cÃ³ thá»ƒ gáº¯n vá»›i giÃ¡
trá»‹ khi khá»›p cá»§a pattern. ÄÃ¢y lÃ  cÃ¡ch chÃºng ta cÃ³ thá»ƒ trÃ­ch xuáº¥t cÃ¡c giÃ¡ trá»‹ tá»«
cÃ¡c biáº¿n thá»ƒ cá»§a enum.</p>
<p>Láº¥y vÃ­ dá»¥, hÃ£y thay Ä‘á»•i má»™t trong cÃ¡c biáº¿n thá»ƒ cá»§a enum Ä‘á»ƒ chá»©a dá»¯ liá»‡u bÃªn
trong nÃ³. Tá»« nÄƒm 1999 Ä‘áº¿n nÄƒm 2008, Hoa Ká»³ Ä‘Ãºc cÃ¡c Ä‘á»“ng 25 cent (Quater) cho 50
tiá»u bang vá»›i cÃ¡c thiáº¿t káº¿t máº·t bÃªn khÃ¡c nhau. CÃ¡c loáº¡i xu khÃ¡c khÃ´ng cÃ³ thiáº¿t
káº¿ riÃªng theo tiá»ƒu bang, vÃ¬ váº­y chá»‰ cÃ³ bá»™i Ä‘á»“ng 25 cent má»›i cÃ³ giÃ¡ trá»‹ bá»• sung
nÃ y. ChÃºng ta cÃ³ thá»ƒ thÃªm thÃ´ng tin nÃ y vÃ o <code>enum</code> báº±ng cÃ¡ch thay Ä‘á»•i biáº¿n thá»ƒ
<code>Quarter</code> Ä‘á»ƒ bao gá»“m má»™t giÃ¡ trá»‹ <code>UsState</code> Ä‘Æ°á»£c lÆ°u trá»¯ bÃªn trong nÃ³, nhÆ° chÃºng
ta Ä‘Ã£ lÃ m á»Ÿ Ä‘Ã¢y trong Listing 6-4.</p>
<pre><pre class="playground"><code class="language-rust edition2024">#[derive(Debug)] // so we can inspect the state in a minute
enum UsState {
  Alabama,
  Alaska,
  // --snip--
}

enum Coin {
  Penny,
  Nickel,
  Dime,
  Quarter(UsState),
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p><span class="caption">Listing 6-4: Má»™t <code>Coin</code> enum trong Ä‘Ã³ biáº¿n thá»ƒ <code>Quarter</code> cÅ©ng chá»©a má»™t giÃ¡ trá»‹ <code>UsState</code></span></p>
<p>HÃ£y tÆ°á»Ÿng tÆ°á»£ng ráº±ng má»™t ngÆ°á»i báº¡n Ä‘ang cá»‘ gáº¯ng thu tháº­p táº¥t cáº£ 50 dáº¡ng Ä‘á»“ng 25
cent nÃ y. Trong khi chÃºng ta chá»‰ sáº¯p xáº¿p theo loáº¡i Ä‘á»“ng, chÃºng ta cÅ©ng sáº½ gá»i
tÃªn cá»§a tiá»ƒu bang liÃªn quan trÃªn Ä‘á»“ng 25 cent Ä‘á»ƒ náº¿u Ä‘Ã³ lÃ  má»™t trong nhá»¯ng Ä‘á»“ng
25 cent mÃ  ngÆ°á»i báº¡n cá»§a chÃºng ta khÃ´ng cÃ³, anh áº¥y cÃ³ thá»ƒ thÃªm vÃ o bá»™ sÆ°u táº­p
cá»§a mÃ¬nh.</p>
<p>BÃªn trong biá»ƒu thá»©c <code>match</code> cho Ä‘oáº¡n code nÃ y, chÃºng ta thÃªm má»™t biáº¿n gá»i lÃ 
<code>state</code> vÃ o pattern khá»›p vá»›i cÃ¡c giÃ¡ trá»‹ cá»§a biáº¿n thá»ƒ <code>Coin::Quarter</code>. Khi má»™t
<code>Coin::Quarter</code> khá»›p, biáº¿n <code>state</code> sáº½ Ä‘Æ°á»£c gáº¯n vá»›i giÃ¡ trá»‹ cá»§a tiá»ƒu bang cá»§a
Ä‘á»“ng 25 cent Ä‘Ã³. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng <code>state</code> trong code strong
nhÃ¡nh nÃ y, nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#[derive(Debug)]
</span><span class="boring">enum UsState {
</span><span class="boring">    Alabama,
</span><span class="boring">    Alaska,
</span><span class="boring">    // --snip--
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">enum Coin {
</span><span class="boring">    Penny,
</span><span class="boring">    Nickel,
</span><span class="boring">    Dime,
</span><span class="boring">    Quarter(UsState),
</span><span class="boring">}
</span><span class="boring">
</span>fn value_in_cents(coin: Coin) -&gt; u8 {
  match coin {
      Coin::Penny =&gt; 1,
      Coin::Nickel =&gt; 5,
      Coin::Dime =&gt; 10,
      Coin::Quarter(state) =&gt; {
          println!("State quarter from {state:?}!");
          25
      }
  }
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    value_in_cents(Coin::Quarter(UsState::Alaska));
</span><span class="boring">}</span></code></pre></pre>
<p>Náº¿u chung ta gá»i hÃ m <code>value_in_cents(Coin::Quarter(UsState::Alaska))</code>, <code>coin</code>
sáº½ lÃ  <code>Coin::Quarter(UsState::Alaska)</code>. Khi chÃºng ta so sÃ¡nh giÃ¡ trá»‹ nÃ y vá»›i
má»—i nhÃ¡nh trong biá»ƒu thá»©c <code>match</code>, khÃ´ng cÃ³ nhÃ¡nh nÃ o khá»›p cho Ä‘áº¿n khi chÃºng ta
Ä‘áº¿n <code>Coin::Quarter(state)</code>. Táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³, biáº¿n <code>state</code> sáº½ lÃ  giÃ¡ trá»‹
<code>UsState::Alaska</code>. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng biáº¿n nÃ y trong biá»ƒu thá»©c <code>println!</code>,
vÃ¬ váº­y chÃºng ta cÃ³ thá»ƒ láº¥y ra giÃ¡ trá»‹ cá»§a tiá»ƒu bang bÃªn trong biáº¿n thá»ƒ
<code>Quarter</code> cá»§a <code>Coin</code> enum.</p>
<h3 id="matching-with-optiont"><a class="header" href="#matching-with-optiont">Matching with <code>Option&lt;T&gt;</code></a></h3>
<p>Trong pháº§n trÆ°á»›c, chÃºng ta muá»‘n láº¥y ra giÃ¡ trá»‹ <code>T</code> bÃªn trong <code>Some</code> khi sá»­ dá»¥ng
<code>Option&lt;T&gt;</code>; chÃºng ta cÅ©ng cÃ³ thá»ƒ xá»­ lÃ½ <code>Option&lt;T&gt;</code> báº±ng cÃ¡ch sá»­ dá»¥ng <code>match</code>
nhÆ° chÃºng ta Ä‘Ã£ lÃ m vá»›i <code>Coin</code> enum! Thay vÃ¬ so sÃ¡nh cÃ¡c Ä‘á»“ng, chÃºng ta sáº½ so
sÃ¡nh cÃ¡c biáº¿n thá»ƒ cá»§a <code>Option&lt;T&gt;</code>, nhÆ°ng cÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a biá»ƒu thá»©c
<code>match</code> váº«n giá»¯ nguyÃªn.</p>
<p>Giáº£ sá»­ chÃºng ta muá»‘n viáº¿t má»™t hÃ m mÃ  nháº­n vÃ o má»™t <code>Option&lt;i32&gt;</code> vÃ  náº¿u cÃ³ má»™t
giÃ¡ trá»‹ bÃªn trong, nÃ³ sáº½ cá»™ng thÃªm 1 vÃ o giÃ¡ trá»‹ Ä‘Ã³. Náº¿u khÃ´ng cÃ³ giÃ¡ trá»‹ bÃªn
trong, hÃ m sáº½ tráº£ vá» giÃ¡ trá»‹ <code>None</code> vÃ  khÃ´ng thá»±c hiá»‡n báº¥t ká»³ thao tÃ¡c nÃ o.</p>
<p>HÃ m nÃ y ráº¥t dá»… Ä‘á»ƒ viáº¿t, cáº£m Æ¡n <code>match</code>, vÃ  sáº½ trÃ´ng nhÆ° trong Listing 6-5.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
        match x {
            None =&gt; None,
            Some(i) =&gt; Some(i + 1),
        }
    }

    let five = Some(5);
    let six = plus_one(five);
    let none = plus_one(None);
<span class="boring">}</span></code></pre></pre>
<p>HÃ£y xem xÃ©t ká»¹ hÆ¡n vá» láº§n Ä‘áº§u tiÃªn chÃºng ta gá»i <code>plus_one</code>. Khi chÃºng ta gá»i
<code>plus_one(five)</code>, biáº¿n <code>x</code> trong thÃ¢n hÃ m <code>plus_one</code> sáº½ cÃ³ giÃ¡ trá»‹ <code>Some(5)</code>.
ChÃºng ta sau Ä‘Ã³ so sÃ¡nh nÃ³ vá»›i má»—i nhÃ¡nh trong biá»ƒu thá»©c <code>match</code>.</p>
<pre><code class="language-rust ignore"><span class="boring">fn main() {
</span><span class="boring">    fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
</span><span class="boring">        match x {
</span>            None =&gt; None,
<span class="boring">            Some(i) =&gt; Some(i + 1),
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    let five = Some(5);
</span><span class="boring">    let six = plus_one(five);
</span><span class="boring">    let none = plus_one(None);
</span><span class="boring">}</span></code></pre>
<p>GiÃ¡ trá»‹ <code>Some(5)</code> khÃ´ng khá»›p vá»›i máº«u <code>None</code>, vÃ¬ váº­y chÃºng ta tiáº¿p tá»¥c Ä‘áº¿n nhÃ¡nh
tiáº¿p theo.</p>
<pre><code class="language-rust ignore"><span class="boring">fn main() {
</span><span class="boring">    fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
</span><span class="boring">        match x {
</span><span class="boring">            None =&gt; None,
</span>            Some(i) =&gt; Some(i + 1),
<span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    let five = Some(5);
</span><span class="boring">    let six = plus_one(five);
</span><span class="boring">    let none = plus_one(None);
</span><span class="boring">}</span></code></pre>
<p><code>Some(5)</code> cÃ³ khá»›p vá»›i <code>Some(i)</code> khÃ´ng? VÃ¢ng, nÃ³ khá»›p! ChÃºng ta cÃ³ cÃ¹ng má»™t biáº¿n
thá»ƒ. <code>i</code> Ä‘Æ°á»£c gáº¯n vá»›i giÃ¡ trá»‹ bÃªn trong <code>Some</code>, vÃ¬ váº­y <code>i</code> cÃ³ giÃ¡ trá»‹ lÃ  <code>5</code>.
Sau Ä‘Ã³, code trong nhÃ¡nh <code>match</code> Ä‘Æ°á»£c thá»±c thi, vÃ¬ váº­y chÃºng ta cá»™ng thÃªm 1 vÃ o
giÃ¡ trá»‹ cá»§a <code>i</code> vÃ  táº¡o ra má»™t giÃ¡ trá»‹ <code>Some</code> má»›i vá»›i tá»•ng <code>6</code> bÃªn trong.</p>
<p>Giá» hÃ£y xem xÃ©t láº§n gá»i thá»© hai cá»§a <code>plus_one</code> trong Listing 6-5, khi <code>x</code> lÃ 
<code>None</code>. ChÃºng ta vÃ o <code>match</code> vÃ  so sÃ¡nh vá»›i nhÃ¡nh Ä‘áº§u tiÃªn.</p>
<pre><code class="language-rust ignore"><span class="boring">fn main() {
</span><span class="boring">    fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
</span><span class="boring">        match x {
</span>            None =&gt; None,
<span class="boring">            Some(i) =&gt; Some(i + 1),
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    let five = Some(5);
</span><span class="boring">    let six = plus_one(five);
</span><span class="boring">    let none = plus_one(None);
</span><span class="boring">}</span></code></pre>
<p>NÃ³ khá»›p! KhÃ´ng cÃ³ giÃ¡ trá»‹ Ä‘á»ƒ cá»™ng thÃªm, vÃ¬ váº­y chÆ°Æ¡ng trÃ¬nh dá»«ng láº¡i vÃ  tráº£ vá»
giÃ¡ trá»‹ <code>None</code> bÃªn pháº£i cá»§a <code>=&gt;</code>. VÃ¬ nhÃ¡nh Ä‘áº§u tiÃªn khá»›p, nÃªn cÃ¡c nhÃ¡nh khÃ¡c
khÃ´ng Ä‘Æ°á»£c so sÃ¡nh.</p>
<p>Káº¿t há»£p <code>match</code> vÃ  enums ráº¥t há»¯u Ã­ch trong nhiá»u tÃ¬nh huá»‘ng. Báº¡n sáº½ tháº¥y
pattern nÃ y nhiá»u trong mÃ£ Rust: <code>match</code> vá»›i má»™t enum, gáº¯n má»™t biáº¿n vá»›i dá»¯ liá»‡u
bÃªn trong, vÃ  sau Ä‘Ã³ thá»±c thi code dá»±a trÃªn nÃ³. Äáº§u tiÃªn nÃ³ cÃ³ váº» khÃ³ khÄƒn,
nhÆ°ng má»™t khi báº¡n quen vá»›i nÃ³, báº¡n sáº½ muá»‘n cÃ³ nÃ³ trong táº¥t cáº£ cÃ¡c ngÃ´n ngá»¯. NÃ³
luÃ´n Ä‘Æ°á»£c ngÆ°á»i dÃ¹ng Æ°a thÃ­ch.</p>
<h3 id="matches-are-exhaustive"><a class="header" href="#matches-are-exhaustive">Matches Are Exhaustive</a></h3>
<p>CÃ³ má»™t khÃ­a cáº¡nh khÃ¡c cá»§a <code>match</code> mÃ  chÃºng ta cáº§n tháº£o luáº­n: cÃ¡c pattern thuá»™c
cÃ¡c nhÃ¡nh pháº£i bao phá»§ táº¥t cáº£ cÃ¡c kháº£ nÄƒng. HÃ£y xem xÃ©t phiÃªn báº£n lá»—i cá»§a hÃ m
<code>plus_one</code> cá»§a chÃºng ta, nÃ³ sáº½ khÃ´ng biÃªn dá»‹ch Ä‘Æ°á»£c:</p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span>    fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
        match x {
            Some(i) =&gt; Some(i + 1),
        }
    }
<span class="boring">
</span><span class="boring">    let five = Some(5);
</span><span class="boring">    let six = plus_one(five);
</span><span class="boring">    let none = plus_one(None);
</span><span class="boring">}</span></code></pre>
<p>ChÃºng ta Ä‘Ã£ khÃ´ng xá»­ lÃ½ trÆ°á»ng há»£p <code>None</code>, vÃ¬ váº­y mÃ£ nÃ y sáº½ gÃ¢y ra má»™t lá»—i. May
máº¯n thay, Ä‘Ã³ lÃ  má»™t lá»—i mÃ  Rust biáº¿t cÃ¡ch phÃ¡t hiá»‡n. Náº¿u chÃºng ta cá»‘ gáº¯ng biÃªn
dá»‹ch mÃ£ nÃ y, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i nÃ y:</p>
<pre><code class="language-console">$ cargo run
   Compiling enums v0.1.0 (file:///projects/enums)
error[E0004]: non-exhaustive patterns: `None` not covered
 --&gt; src/main.rs:3:15
  |
3 |         match x {
  |               ^ pattern `None` not covered
  |
note: `Option&lt;i32&gt;` defined here
 --&gt; /rustc/4eb161250e340c8f48f66e2b929ef4a5bed7c181/library/core/src/option.rs:572:1
 ::: /rustc/4eb161250e340c8f48f66e2b929ef4a5bed7c181/library/core/src/option.rs:576:5
  |
  = note: not covered
  = note: the matched value is of type `Option&lt;i32&gt;`
help: ensure that all possible cases are being handled by adding a match arm with a wildcard pattern or an explicit pattern as shown
  |
4 ~             Some(i) =&gt; Some(i + 1),
5 ~             None =&gt; todo!(),
  |

For more information about this error, try `rustc --explain E0004`.
error: could not compile `enums` (bin "enums") due to 1 previous error
</code></pre>
<p>Rust biáº¿t ráº±ng chÃºng ta khÃ´ng bao phá»§ (cover) táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p cÃ³ thá»ƒ vÃ 
cÅ©ng biáº¿t pattern nÃ o chÃºng ta quÃªn! CÃ¡c <code>match</code> trong Rust lÃ  <em>Ä‘áº§y Ä‘á»§</em>
(exhaustive): chÃºng ta pháº£i bao phá»§ táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p Ä‘á»ƒ mÃ£ cÃ³ thá»ƒ há»£p lá»‡.
Äáº·c biá»‡t trong trÆ°á»ng há»£p cá»§a <code>Option&lt;T&gt;</code>, khi Rust ngÄƒn chÃºng ta quÃªn xá»­ lÃ½
trÆ°á»ng há»£p <code>None</code> má»™t cÃ¡ch rÃµ rÃ ng, nÃ³ báº£o vá»‡ chÃºng ta khá»i viá»‡c giáº£ Ä‘á»‹nh ráº±ng
chÃºng ta cÃ³ má»™t giÃ¡ trá»‹ khi chÃºng ta cÃ³ thá»ƒ cÃ³ null, vÃ¬ váº­y lá»—i tá»· Ä‘Ã´ Ä‘áº§u tiÃªn
Ä‘Æ°á»£c tháº£o luáº­n á»Ÿ trÃªn lÃ  khÃ´ng thá»ƒ xáº£y ra.</p>
<h3 id="catch-all-patterns-and-the-_-placeholder"><a class="header" href="#catch-all-patterns-and-the-_-placeholder">Catch-all Patterns and the <code>_</code> Placeholder</a></h3>
<p>Khi dÃ¹ng vá»›i enum, chÃºng ta cÅ©ng cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng Ä‘áº·c biá»‡t cho
má»™t vÃ i giÃ¡ trá»‹ cá»¥ thá»ƒ, nhÆ°ng vá»›i táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ khÃ¡c, chÃºng ta sáº½ thá»±c
hiá»‡n má»™t hÃ nh Ä‘á»™ng máº·c Ä‘á»‹nh. HÃ£y tÆ°á»Ÿng tÆ°á»£ng chÃºng ta Ä‘ang triá»ƒn khai má»™t trÃ²
chÆ¡i, náº¿u báº¡n tung xÃºc xáº¯c vÃ  nháº­n Ä‘Æ°á»£c 3, ngÆ°á»i chÆ¡i cá»§a báº¡n sáº½ khÃ´ng di
chuyá»ƒn, mÃ  thay vÃ o Ä‘Ã³ sáº½ nháº­n Ä‘Æ°á»£c má»™t chiáº¿c mÅ© Ä‘áº¹p. Náº¿u báº¡n tung xÃºc xáº¯c vÃ 
nháº­n Ä‘Æ°á»£c 7, ngÆ°á»i chÆ¡i cá»§a báº¡n sáº½ máº¥t má»™t chiáº¿c mÅ© Ä‘áº¹p. Vá»›i táº¥t cáº£ cÃ¡c giÃ¡ trá»‹
khÃ¡c, ngÆ°á»i chÆ¡i cá»§a báº¡n sáº½ di chuyá»ƒn sá»‘ lÆ°á»£ng Ã´ trÃªn bÃ n cá» tÆ°Æ¡ng á»©ng vá»›i giÃ¡
trá»‹ cá»§a xÃºc xáº¯c. ÄÃ¢y lÃ  má»™t <code>match</code> thá»±c hiá»‡n logic nÃ y, vá»›i káº¿t quáº£ cá»§a xÃºc
xáº¯c Ä‘Æ°á»£c cá»‘ Ä‘á»‹nh thay vÃ¬ má»™t giÃ¡ trá»‹ ngáº«u nhiÃªn, vÃ  táº¥t cáº£ cÃ¡c logic khÃ¡c Ä‘Æ°á»£c
biá»ƒu diá»…n bá»Ÿi cÃ¡c hÃ m mÃ  khÃ´ng cÃ³ thÃ¢n hÃ m vÃ¬ thá»±c sá»± triá»ƒn khai chÃºng náº±m
ngoÃ i pháº¡m vi cá»§a vÃ­ dá»¥ nÃ y:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let dice_roll = 9;
    match dice_roll {
        3 =&gt; add_fancy_hat(),
        7 =&gt; remove_fancy_hat(),
        other =&gt; move_player(other),
    }

    fn add_fancy_hat() {}
    fn remove_fancy_hat() {}
    fn move_player(num_spaces: u8) {}
<span class="boring">}</span></code></pre></pre>
<p>Vá»›i hai nhÃ¡nh Ä‘áº§u tiÃªn, cÃ¡c pattern lÃ  cÃ¡c giÃ¡ trá»‹ chÃ­nh xÃ¡c 3 vÃ  7. Vá»›i nhÃ¡nh
cuá»‘i cÃ¹ng bao gá»“m táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ khÃ¡c cÃ³ thá»ƒ, pattern lÃ  biáº¿n mÃ  chÃºng ta
Ä‘Ã£ chá»n Ä‘á»ƒ Ä‘áº·t tÃªn lÃ  <code>other</code>. Code cháº¡y cho nhÃ¡nh <code>other</code> sá»­ dá»¥ng biáº¿n báº±ng
cÃ¡ch truyá»n nÃ³ cho hÃ m <code>move_player</code>.</p>
<p>Code nÃ y sáº½ Ä‘Æ°á»£c biÃªn dá»‹ch, ngay cáº£ khi chÃºng ta khÃ´ng liá»‡t kÃª táº¥t cáº£ cÃ¡c giÃ¡
trá»‹ cÃ³ thá»ƒ cÃ³ cá»§a má»™t <code>u8</code>, vÃ¬ nhÃ¡nh cuá»‘i cÃ¹ng sáº½ khá»›p vá»›i táº¥t cáº£ cÃ¡c giÃ¡ trá»‹
khÃ´ng Ä‘Æ°á»£c liá»‡t kÃª cá»¥ thá»ƒ. Pattern nÃ y Ä‘Ã¡p á»©ng yÃªu cáº§u ráº±ng <code>match</code> pháº£i lÃ  Ä‘áº§y
Ä‘á»§. LÆ°u Ã½ ráº±ng chÃºng ta pháº£i Ä‘áº·t nhÃ¡nh cuá»‘i cÃ¹ng á»Ÿ cuá»‘i vÃ¬ cÃ¡c pattern Ä‘Æ°á»£c
khá»›p theo thá»© tá»±. Náº¿u chÃºng ta Ä‘áº·t nhÃ¡nh cuá»‘i cÃ¹ng á»Ÿ trÆ°á»›c, cÃ¡c nhÃ¡nh khÃ¡c sáº½
khÃ´ng bao giá» cháº¡y, vÃ¬ váº­y Rust sáº½ cáº£nh bÃ¡o chÃºng ta náº¿u chÃºng ta thÃªm cÃ¡c
nhÃ¡nh sau má»™t nhÃ¡nh cuá»‘i cÃ¹ng!</p>
<p>Rust cÅ©ng cÃ³ má»™t pattern mÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng khi chÃºng ta muá»‘n má»™t
pattern cuá»‘i cÃ¹ng nhÆ°ng khÃ´ng muá»‘n <em>sá»­ dá»¥ng</em> giÃ¡ trá»‹ trong pattern cuá»‘i cÃ¹ng:
<code>_</code> lÃ  má»™t pattern Ä‘áº·c biá»‡t mÃ  khá»›p vá»›i báº¥t ká»³ giÃ¡ trá»‹ nÃ o vÃ  khÃ´ng liÃªn káº¿t
vá»›i giÃ¡ trá»‹ Ä‘Ã³. Äiá»u nÃ y cho Rust biáº¿t chÃºng ta khÃ´ng sáº½ sá»­ dá»¥ng giÃ¡ trá»‹, vÃ¬
váº­y Rust sáº½ khÃ´ng cáº£nh bÃ¡o chÃºng ta vá» má»™t biáº¿n khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng.</p>
<p>CÃ¹ng thay Ä‘á»•i quy táº¯c cá»§a trÃ² chÆ¡i: bÃ¢y giá», náº¿u báº¡n tung xÃºc xáº¯c vÃ  nháº­n Ä‘Æ°á»£c
báº¥t ká»³ giÃ¡ trá»‹ nÃ o khÃ¡c ngoÃ i 3 hoáº·c 7, báº¡n pháº£i quay láº¡i. ChÃºng ta khÃ´ng cáº§n
ná»¯a sá»­ dá»¥ng giÃ¡ trá»‹ cuá»‘i cÃ¹ng, vÃ¬ váº­y chÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i code cá»§a chÃºng
ta Ä‘á»ƒ sá»­ dá»¥ng <code>_</code> thay vÃ¬ biáº¿n cÃ³ tÃªn lÃ  <code>other</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let dice_roll = 9;
    match dice_roll {
        3 =&gt; add_fancy_hat(),
        7 =&gt; remove_fancy_hat(),
        _ =&gt; reroll(),
    }

    fn add_fancy_hat() {}
    fn remove_fancy_hat() {}
    fn reroll() {}
<span class="boring">}</span></code></pre></pre>
<p>VÃ­ dá»¥ nÃ y cÅ©ng Ä‘Ã¡p á»©ng yÃªu cáº§u Ä‘áº§y Ä‘á»§ vÃ¬ chÃºng ta Ä‘ang tÆ°á»ng minh bá» qua táº¥t cáº£
cÃ¡c giÃ¡ trá»‹ khÃ¡c trong nhÃ¡nh cuá»‘i cÃ¹ng; chÃºng ta khÃ´ng bá» sÃ³t báº¥t ká»³ thá»© gÃ¬.</p>
<p>Cuá»‘i cÃ¹ng, chÃºng ta sáº½ thay Ä‘á»•i quy táº¯c cá»§a trÃ² chÆ¡i má»™t láº§n ná»¯a, sáº½ khÃ´ng cÃ³
gÃ¬ khÃ¡c xáº£y ra trong lÆ°á»£t cá»§a báº¡n náº¿u báº¡n tung xÃºc xáº¯c vÃ  nháº­n Ä‘Æ°á»£c báº¥t ká»³ giÃ¡
trá»‹ nÃ o khÃ¡c ngoÃ i 3 hoáº·c 7. ChÃºng ta cÃ³ thá»ƒ biá»ƒu diá»…n báº±ng cÃ¡ch sá»­ dá»¥ng giÃ¡
trá»‹ Ä‘Æ¡n vá»‹ (kiá»ƒu tuple trá»‘ng mÃ  chÃºng ta Ä‘Ã£ nÃ³i á»Ÿ pháº§n <a href="ch03-02-data-types.html#the-tuple-type">â€œThe Tuple Typeâ€</a><!-- ignore -->) lÃ m mÃ£ cho nhÃ¡nh <code>_</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let dice_roll = 9;
    match dice_roll {
        3 =&gt; add_fancy_hat(),
        7 =&gt; remove_fancy_hat(),
        _ =&gt; (),
    }

    fn add_fancy_hat() {}
    fn remove_fancy_hat() {}
<span class="boring">}</span></code></pre></pre>
<p>á» Ä‘Ã¢y, chÃºng ta Ä‘ang nÃ³i vá»›i Rust rÃµ rÃ ng ráº±ng chÃºng ta sáº½ khÃ´ng sá»­ dá»¥ng báº¥t ká»³
giÃ¡ trá»‹ nÃ o khÃ¡c khÃ´ng khá»›p vá»›i máº«u trong nhÃ¡nh trÆ°á»›c Ä‘Ã³, vÃ  chÃºng ta khÃ´ng
muá»‘n cháº¡y báº¥t ká»³ mÃ£ nÃ o trong trÆ°á»ng há»£p nÃ y.</p>
<p>Äá»ƒ cÃ³ thÃªm vá» cÃ¡c pattern vÃ  matching, chÃºng ta sáº½ tÃ¬m hiá»ƒu trong <a href="ch18-00-patterns.html">Chapter 18</a><!-- ignore -->. BÃ¢y giá», chÃºng ta sáº½ tiáº¿p tá»¥c vá»›i cÃº phÃ¡p
<code>if let</code>, nÃ³ cÃ³ thá»ƒ há»¯u Ã­ch trong cÃ¡c tÃ¬nh huá»‘ng mÃ  biá»ƒu thá»©c <code>match</code> cÃ³ váº» quÃ¡
dÃ i.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="concise-control-flow-with-if-let"><a class="header" href="#concise-control-flow-with-if-let">Concise Control Flow with <code>if let</code></a></h2>
<p>CÃº phÃ¡p <code>if let</code> cho phÃ©p báº¡n káº¿t há»£p <code>if</code> vÃ  <code>let</code> theo má»™t cÃ¡ch ngáº¯n gá»n hÆ¡n
Ä‘á»ƒ xá»­ lÃ½ cÃ¡c giÃ¡ trá»‹ khá»›p vá»›i má»™t pattern nháº¥t Ä‘á»‹nh trong khi bá» qua cÃ¡c
pattern cÃ²n láº¡i. HÃ£y xem xÃ©t chÆ°Æ¡ng trÃ¬nh trong Listing 6-6 vá»›i giÃ¡ trá»‹ Ä‘Æ°á»£c
khá»›p lÃ  kiá»ƒu <code>Option &lt;u8&gt;</code> trong biáº¿n <code>config_max</code> nhÆ°ng chÃºng ta chá»‰ muá»‘n thá»±c
thi code náº¿u giÃ¡ trá»‹ lÃ  biáº¿n thá»ƒ <code>Some</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let config_max = Some(3u8);
    match config_max {
        Some(max) =&gt; println!("The maximum is configured to be {max}"),
        _ =&gt; (),
    }
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 6-6: Má»™t <code>match</code> chá»‰ quan tÃ¢m Ä‘áº¿n viá»‡c thá»±c thi
code khi giÃ¡ trá»‹ lÃ  <code>Some</code></span></p>
<p>Náº¿u giÃ¡ trá»‹ lÃ  <code>Some</code>, chÃºng ta sáº½ in ra giÃ¡ trá»‹ trong biáº¿n thá»ƒ <code>Some</code> báº±ng
cÃ¡ch gÃ¡n giÃ¡ trá»‹ cho biáº¿n <code>max</code> trong pattern. ChÃºng ta khÃ´ng muá»‘n lÃ m gÃ¬ vá»›i
giÃ¡ trá»‹ <code>None</code>. Äá»ƒ thoáº£ mÃ£n biá»ƒu thá»©c <code>match</code>, chÃºng ta pháº£i thÃªm <code>_ =&gt; ()</code> sau
dÃ¹ chá»‰ xá»­ lÃ½ má»™t biáº¿n thá»ƒ, Ä‘iá»u nÃ y tháº­t phiá»n phá»©c khi thÃªm vÃ o code.</p>
<p>Thay vÃ o Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ viáº¿t code ngáº¯n gá»n hÆ¡n báº±ng cÃ¡ch sá»­ dá»¥ng <code>if let</code>.
Code dÆ°á»›i Ä‘Ã¢y sáº½ hoáº¡t Ä‘á»™ng tÆ°Æ¡ng tá»± nhÆ° <code>match</code> trong Listing 6-6:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let config_max = Some(3u8);
    if let Some(max) = config_max {
        println!("The maximum is configured to be {max}");
    }
<span class="boring">}</span></code></pre></pre>
<p>CÃº phÃ¡p <code>if let</code> sáº½ nháº­n má»™t pattern vÃ  má»™t biá»ƒu thá»©c Ä‘Æ°á»£c phÃ¢n tÃ¡ch báº±ng dáº¥u
báº±ng. NÃ³ hoáº¡t Ä‘á»™ng tÆ°Æ¡ng nhÆ° <code>match</code>, trong Ä‘Ã³ biá»ƒu thá»©c Ä‘Æ°á»£c gá»­i vÃ o <code>match</code>
vÃ  pattern lÃ  nhÃ¡nh Ä‘áº§u tiÃªn cá»§a nÃ³. Trong trÆ°á»ng há»£p nÃ y, pattern lÃ  <code>Some(max)</code>, vÃ  <code>max</code> Ä‘Æ°á»£c gÃ¡n cho giÃ¡ trá»‹ bÃªn trong <code>Some</code>. ChÃºng ta sau Ä‘Ã³ cÃ³ thá»ƒ sá»­
dá»¥ng <code>max</code> trong thÃ¢n cá»§a code block, <code>if let</code> cÅ©ng hoáº¡t Ä‘á»ng theo cÃ¡ch tÆ°Æ¡ng
tá»± nhÆ° chÃºng ta sá»­ dá»¥ng <code>max</code> trong nhÃ¡nh cá»§a <code>match</code>. Code trong block <code>if let</code> sáº½ khÃ´ng Ä‘Æ°á»£c cháº¡y náº¿u giÃ¡ trá»‹ khÃ´ng khá»›p vá»›i pattern.</p>
<p>Sá»­ dá»¥ng <code>if let</code> sáº½ Ã­t pháº£i gÃµ, Ã­t pháº£i thá»¥t lá», vÃ  Ã­t code dÃ i dÃ²ng kiá»ƒu máº«u
hÆ¡n. Tuy nhiÃªn, báº¡n sáº½ khÃ´ng Ä‘áº£m báº£o tÃ­nh kiá»ƒm tra Ä‘áº§y Ä‘á»§ nhÆ° <code>match</code>. Lá»±a chá»n
giá»¯a <code>match</code> vÃ  <code>if let</code> phá»¥ thuá»™c vÃ o báº¡n Ä‘ang lÃ m gÃ¬ trong trÆ°á»ng há»£p cá»¥ thá»ƒ
cá»§a báº¡n vÃ  liá»‡u cÃ³ Ä‘Ã¡ng Ä‘á»ƒ giáº£m thiá»ƒu code báº±ng cÃ¡ch bá» qua viá»‡c kiá»ƒm tra Ä‘áº§y
Ä‘á»§ hay khÃ´ng.</p>
<p>NÃ³i cÃ¡ch khÃ¡c, báº¡n cÃ³ thá»ƒ coi <code>if let</code> nhÆ° lÃ  cÃº phÃ¡p bá»• sung cho má»™t <code>match</code>
cÃ³ thá»ƒ cháº¡y code khi giÃ¡ trá»‹ khá»›p vá»›i má»™t pattern vÃ  sau Ä‘Ã³ bá» qua táº¥t cáº£ cÃ¡c
giÃ¡ trá»‹ khÃ¡c.</p>
<p>ChÃºng ta cÃ³ thá»ƒ thÃªm má»™t <code>else</code> vá»›i má»™t <code>if let</code>. Block code cá»§a <code>else</code> sáº½
giá»‘ng nhÆ° block code cá»§a <code>_</code> trong <code>match</code>. Nhá»› láº¡i Ä‘á»‹nh nghÄ©a enum <code>Coin</code>
trong Listing 6-4, trong Ä‘Ã³ biáº¿n thá»ƒ <code>Quarter</code> cÅ©ng cÃ³ má»™t giÃ¡ trá»‹ <code>UsState</code>.
Náº¿u chÃºng ta muá»‘n Ä‘áº¿m táº¥t cáº£ cÃ¡c xu khÃ´ng pháº£i lÃ  25 cent mÃ  chÃºng ta tháº¥y
trong khi cÅ©ng gá»i tÃªn tiá»ƒu bang cá»§a cÃ¡c xu 25 cent, chÃºng ta cÃ³ thá»ƒ lÃ m Ä‘Æ°á»£c
Ä‘iá»u Ä‘Ã³ vá»›i má»™t biá»ƒu thá»©c <code>match</code> nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#[derive(Debug)]
</span><span class="boring">enum UsState {
</span><span class="boring">    Alabama,
</span><span class="boring">    Alaska,
</span><span class="boring">    // --snip--
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">enum Coin {
</span><span class="boring">    Penny,
</span><span class="boring">    Nickel,
</span><span class="boring">    Dime,
</span><span class="boring">    Quarter(UsState),
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let coin = Coin::Penny;
</span>    let mut count = 0;
    match coin {
        Coin::Quarter(state) =&gt; println!("State quarter from {state:?}!"),
        _ =&gt; count += 1,
    }
<span class="boring">}</span></code></pre></pre>
<p>Hoáº·c chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng má»™t biá»ƒu thá»©c <code>if let</code> vÃ  <code>else</code> nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#[derive(Debug)]
</span><span class="boring">enum UsState {
</span><span class="boring">    Alabama,
</span><span class="boring">    Alaska,
</span><span class="boring">    // --snip--
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">enum Coin {
</span><span class="boring">    Penny,
</span><span class="boring">    Nickel,
</span><span class="boring">    Dime,
</span><span class="boring">    Quarter(UsState),
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let coin = Coin::Penny;
</span>    let mut count = 0;
    if let Coin::Quarter(state) = coin {
        println!("State quarter from {state:?}!");
    } else {
        count += 1;
    }
<span class="boring">}</span></code></pre></pre>
<p>Náº¿u báº¡n cÃ³ má»™t trÆ°á»ng há»£p trong Ä‘Ã³ chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n cÃ³ logic quÃ¡ dÃ i dÃ²ng
Ä‘á»ƒ biá»ƒu diá»…n báº±ng má»™t <code>match</code>, hÃ£y nhá»› Ä‘áº¿n <code>if let</code>.</p>
<h2 id="summary-2"><a class="header" href="#summary-2">Summary</a></h2>
<p>ChÃºng ta Ä‘Ã£ Ä‘i qua cÃ¡ch sá»­ dá»¥ng enum Ä‘á»ƒ táº¡o ra má»™t kiá»ƒu dá»¯ liá»‡u tÃ¹y chá»‰nh thá»ƒ
hiá»‡n má»™t giÃ¡ trá»‹ cÃ³ thá»ƒ cÃ³ bÃªn trong má»™t táº­p cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c liá»‡t kÃª. ChÃºng ta
Ä‘Ã£ tháº¥y cÃ¡ch thÆ° viá»‡n chuáº©n <code>Option&lt;T&gt;</code> giÃºp báº¡n sá»­ dá»¥ng há»‡ thá»‘ng kiá»ƒu (type
system) Ä‘á»ƒ ngÄƒn cháº·n lá»—i. Khi cÃ¡c giÃ¡ trá»‹ enum cÃ³ dá»¯ liá»‡u bÃªn trong chÃºng, báº¡n
cÃ³ thá»ƒ sá»­ dá»¥ng <code>match</code> hoáº·c <code>if let</code> Ä‘á»ƒ trÃ­ch xuáº¥t vÃ  sá»­ dá»¥ng cÃ¡c giÃ¡ trá»‹ Ä‘Ã³,
tÃ¹y thuá»™c vÃ o sá»‘ lÆ°á»£ng trÆ°á»ng há»£p báº¡n cáº§n xá»­ lÃ½.</p>
<p>ChÆ°Æ¡ng trÃ¬nh Rust cá»§a báº¡n cÃ³ thá»ƒ biá»ƒu diá»…n cÃ¡c khÃ¡i niá»‡m trong lÄ©nh vá»±c cá»§a báº¡n
báº±ng cÃ¡ch sá»­ dá»¥ng struct vÃ  enum. Táº¡o kiá»ƒu dá»¯ liá»‡u tÃ¹y chá»‰nh Ä‘á»ƒ sá»­ dá»¥ng trong
API vÃ  Ä‘áº£m báº£o an toÃ n kiá»ƒu dá»¯ liá»‡u: trÃ¬nh biÃªn dá»‹ch sáº½ Ä‘áº£m báº£o ráº±ng cÃ¡c hÃ m
cá»§a báº¡n chá»‰ nháº­n Ä‘Æ°á»£c cÃ¡c giÃ¡ trá»‹ cá»§a kiá»ƒu mÃ  má»—i hÃ m mong Ä‘á»£i.</p>
<p>Äá»ƒ cung cáº¥p má»™t API Ä‘Æ°á»£c tá»• chá»©c tá»‘t cho ngÆ°á»i dÃ¹ng, dá»… sá»­ dá»¥ng vÃ  chá»‰ tiáº¿t lá»™
chÃ­nh xÃ¡c nhá»¯ng gÃ¬ ngÆ°á»i dÃ¹ng cá»§a báº¡n sáº½ cáº§n, chÃºng ta sáº½ bÃ¢y giá» chuyá»ƒn sang
Rust module.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quáº£n-lÃ½-cÃ¡c-dá»±-Ã¡n-ngÃ y-cÃ ng-lá»›n-vá»›i-packages-crates-vÃ -modules"><a class="header" href="#quáº£n-lÃ½-cÃ¡c-dá»±-Ã¡n-ngÃ y-cÃ ng-lá»›n-vá»›i-packages-crates-vÃ -modules">Quáº£n lÃ½ cÃ¡c dá»± Ã¡n ngÃ y cÃ ng lá»›n vá»›i Packages, Crates, vÃ  Modules</a></h1>
<p>Khi báº¡n viáº¿t cÃ¡c chÆ°Æ¡ng trÃ¬nh lá»›n, viá»‡c tá»• chá»©c code cá»§a báº¡n sáº½ trá»Ÿ nÃªn cÃ ng
quan trá»ng hÆ¡n. Báº±ng cÃ¡ch nhÃ³m cÃ¡c tÃ­nh nÄƒng liÃªn quan vÃ  tÃ¡ch code vá»›i cÃ¡c
tÃ­nh nÄƒng khÃ¡c, báº¡n sáº½ biáº¿t Ä‘Æ°á»£c rÃµ rÃ ng tÃ­nh nÄƒng Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi code
nÃ o vÃ  nÆ¡i nÃ o Ä‘á»ƒ thay Ä‘á»•i má»™t tÃ­nh nÄƒng.</p>
<p>Nhá»¯ng chÆ°Æ¡ng trÃ¬nh chÃºng ta Ä‘Ã£ viáº¿t cho Ä‘áº¿n nay Ä‘á»u náº±m trong má»™t module trong
má»™t file. Khi dá»± Ã¡n lá»›n hÆ¡n, báº¡n nÃªn tá»• chá»©c code báº±ng cÃ¡ch chia nÃ³ thÃ nh nhiá»u
module vÃ  sau Ä‘Ã³ nhiá»u file. Má»™t gÃ³i (package) cÃ³ thá»ƒ chá»©a nhiá»u binary crate vÃ 
cÃ³ thá»ƒ cÃ³ thÃªm cÃ¡c crate thÆ° viá»‡n. Khi package lá»›n hÆ¡n, báº¡n cÃ³ thá»ƒ tÃ¡ch cÃ¡c
pháº§n ra thÃ nh cÃ¡c crate riÃªng biá»‡t trá»Ÿ thÃ nh cÃ¡c phá»¥ thuá»™c bÃªn ngoÃ i (external
dependencies). ChÆ°Æ¡ng nÃ y sáº½ Ä‘á» cáº­p táº¥t cáº£ cÃ¡c ká»¹ thuáº­t nÃ y. Äá»‘i vá»›i cÃ¡c dá»± Ã¡n
ráº¥t lá»›n bao gá»“m má»™t táº­p há»£p cÃ¡c package liÃªn quan vÃ  phÃ¡t triá»ƒn cÃ¹ng nhau,
Cargo cung cáº¥p  <em>workspaces</em>, chÃºng ta sáº½ xem nÃ³ trong pháº§n <a href="ch14-03-cargo-workspaces.html">â€œCargo Workspacesâ€</a><!-- ignore --> á»Ÿ chÆ°Æ¡ng 14.</p>
<p>ChÃºng ta cÅ©ng sáº½ tháº£o luáº­n vá» viá»‡c Ä‘Ã³ng gÃ³i code, cho phÃ©p báº¡n tÃ¡i sá»­ dá»¥ng code
á»Ÿ má»™t má»©c cao hÆ¡n: má»™t khi báº¡n Ä‘Ã£ triá»ƒn khai má»™t phÃ©p toÃ¡n, code khÃ¡c cÃ³ thá»ƒ
gá»i code cá»§a báº¡n thÃ´ng qua giao diá»‡n cÃ´ng khai (public interface) mÃ  khÃ´ng cáº§n
biáº¿t cÃ¡ch thá»©c code Ä‘Ã³ hoáº¡t Ä‘á»™ng bÃªn trong. CÃ¡ch báº¡n viáº¿t code xÃ¡c Ä‘á»‹nh pháº§n
nÃ o lÃ  cÃ´ng khai (public) Ä‘á»ƒ code khÃ¡c sá»­ dá»¥ng vÃ  pháº§n nÃ o riÃªng tÆ° (private)
chá»‰ code cá»§a báº¡n má»›i biáº¿t.</p>
<p>Má»™t khÃ¡i niá»‡m liÃªn quan lÃ  pháº¡m vi (scope): ngá»¯ cáº£nh (context) lá»“ng nhau trong
Ä‘Ã³ code Ä‘Æ°á»£c viáº¿t vá»›i má»™t táº­p cÃ¡c tÃªn Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a gá»i lÃ  â€œin scopeâ€. Khi
Ä‘á»c, viáº¿t vÃ  biÃªn dá»‹ch code, cÃ¡c láº­p trÃ¬nh viÃªn vÃ  trÃ¬nh biÃªn dá»‹ch cáº§n biáº¿t
liá»‡u má»™t tÃªn cá»¥ thá»ƒ táº¡i má»™t vá»‹ trÃ­ cá»¥ thá»ƒ cÃ³ pháº£i lÃ  má»™t biáº¿n, hÃ m, struct,
enum, module, háº±ng sá»‘, hay má»™t item khÃ¡c vÃ  item Ä‘Ã³ cÃ³ Ã½ nghÄ©a gÃ¬. Báº¡n cÃ³ thá»ƒ
táº¡o ra cÃ¡c scope vÃ  thay Ä‘á»•i cÃ¡c tÃªn trong scope hoáº·c ngoÃ i scope. Báº¡n khÃ´ng
thá»ƒ cÃ³ hai item cÃ¹ng tÃªn trong cÃ¹ng má»™t scope; luÃ´n cÃ³ sáºµn cÃ¡c cÃ´ng cá»¥ giÃºp báº¡n
giáº£i quyáº¿t xung Ä‘á»™t tÃªn.</p>
<p>Rust cÃ³ cÃ¡c tÃ­nh nÄƒng cho phÃ©p báº¡n quáº£n lÃ½ tá»• chá»©c code cá»§a báº¡n, bao gá»“m
Ä‘oáº¡n code nÃ o lÃ  public hay private, vÃ  tÃªn nÃ o sáº½ náº±m trong má»—i scope trong
chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n. Nhá»¯ng tÃ­nh nÄƒng nÃ y, thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  <em>module system</em>,
bao gá»“m:</p>
<ul>
<li><strong>Packages:</strong> Má»™t tÃ­nh nÄƒng cá»§a Cargo cho phÃ©p báº¡n xÃ¢y dá»±ng, kiá»ƒm tra vÃ  chia
sáº» cÃ¡c crate</li>
<li><strong>Crates:</strong> Má»™t cÃ¢y cá»§a cÃ¡c module táº¡o ra má»™t thÆ° viá»‡n (library) hoáº·c má»™t chÆ°Æ¡ng trÃ¬nh thá»±c thi (executable)</li>
<li><strong>Modules</strong> vÃ  <strong>use:</strong> Cho phÃ©p báº¡n kiá»ƒm soÃ¡t tá»• chá»©c, scope, vÃ  quyá»n riÃªng tÆ° cá»§a Ä‘Æ°á»ng dáº«n (paths)</li>
<li><strong>Paths:</strong> Má»™t cÃ¡ch Ä‘á»ƒ Ä‘áº·t tÃªn má»™t item, nhÆ° má»™t struct, hÃ m, hoáº·c module</li>
</ul>
<p>Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ tÃ¬m hiá»ƒu táº¥t cáº£ cÃ¡c tÃ­nh nÄƒng nÃ y, tháº£o luáº­n vá»
cÃ¡ch chÃºng tÆ°Æ¡ng tÃ¡c vá»›i nhau vÃ  giáº£i thÃ­ch cÃ¡ch sá»­ dá»¥ng chÃºng Ä‘á»ƒ quáº£n lÃ½ scope.
Cuá»‘i cÃ¹ng, báº¡n sáº½ cÃ³ má»™t cÃ¡i nhÃ¬n cháº¯c cháº¯n vá» module system vÃ  cÃ³ thá»ƒ lÃ m viá»‡c
vá»›i scope nhÆ° má»™t dÃ¢n chuyÃªn!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="packages-vÃ -crates"><a class="header" href="#packages-vÃ -crates">Packages vÃ  Crates</a></h2>
<p>Pháº§n Ä‘áº§u tiÃªn trong module system mÃ  chÃºng ta sáº½ tÃ¬m hiá»ƒu lÃ  packages vÃ  crates.</p>
<p>Má»™t <em>crate</em> lÃ  má»™t Ä‘oáº¡n code nhá» nháº¥t mÃ  Rust compiler xem xÃ©t. Ngay cáº£ khi báº¡n
cháº¡y <code>rustc</code> thay vÃ¬ <code>cargo</code> vÃ  truyá»n má»™t file nguá»“n code (nhÆ° chÃºng ta Ä‘Ã£ lÃ m
tá»« Ä‘áº§u trong pháº§n â€œWriting and Running a Rust Programâ€ cá»§a Chapter 1), compiler
sáº½ xem file Ä‘Ã³ lÃ  má»™t crate. Crates cÃ³ thá»ƒ chá»©a modules, vÃ  cÃ¡c modules cÃ³ thá»ƒ
Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong cÃ¡c file khÃ¡c mÃ  Ä‘Æ°á»£c compile cÃ¹ng vá»›i crate, nhÆ° chÃºng
ta sáº½ tháº¥y trong cÃ¡c pháº§n tiáº¿p theo.</p>
<p>Má»™t crate cÃ³ thá»ƒ cÃ³ má»™t trong hai dáº¡ng: má»™t binary crate hoáº·c má»™t library crate.
<em>Binary crates</em> lÃ  cÃ¡c chÆ°Æ¡ng trÃ¬nh báº¡n cÃ³ thá»ƒ compile thÃ nh má»™t executable mÃ 
báº¡n cÃ³ thá»ƒ cháº¡y, nhÆ° má»™t chÆ°Æ¡ng trÃ¬nh command-line hoáº·c má»™t server. Má»—i binary
crate Ä‘á»u pháº£i cÃ³ má»™t function gá»i lÃ  <code>main</code> mÃ  Ä‘á»‹nh nghÄ©a nhá»¯ng gÃ¬ sáº½ xáº£y ra
khi executable cháº¡y. Táº¥t cáº£ cÃ¡c crates mÃ  chÃºng ta Ä‘Ã£ táº¡o cho Ä‘áº¿n nay Ä‘á»u lÃ 
binary crates.</p>
<p><em>Library crates</em> khÃ´ng cÃ³ má»™t function <code>main</code> vÃ  khÃ´ng compile thÃ nh má»™t
executable. Thay vÃ o Ä‘Ã³, chÃºng Ä‘á»‹nh nghÄ©a cÃ¡c tÃ­nh nÄƒng Ä‘Æ°á»£c dÃ¹ng chung vá»›i
nhiá»u dá»± Ã¡n khÃ¡c. VÃ­ dá»¥, crate <code>rand</code> mÃ  chÃºng ta Ä‘Ã£ sá»­ dá»¥ng trong <a href="ch02-00-guessing-game-tutorial.html#generating-a-random-number">Chapter
2</a><!-- ignore --> cung cáº¥p cÃ¡c chá»©c nÄƒng Ä‘á»ƒ táº¡o ra cÃ¡c sá»‘ ngáº«u nhiÃªn.
Háº§u háº¿t thá»i gian khi Rustaceans (ngÆ°á»i dÃ¹ng Rust) nÃ³i â€œcrateâ€, há» Ä‘ang nÃ³i vá»
library crate, vÃ  há» sá»­ dá»¥ng â€œcrateâ€ thay tháº¿ cho khÃ¡i niá»‡m chung cá»§a má»™t
â€œlibraryâ€œ.</p>
<p><em>Crate root</em> lÃ  má»™t file nguá»“n mÃ  Rust compiler báº¯t Ä‘áº§u tá»« Ä‘Ã³ vÃ  táº¡o ra má»™t
root module cho crate cá»§a báº¡n (chÃºng ta sáº½ giáº£i thÃ­ch modules sÃ¢u hÆ¡n trong
pháº§n <a href="ch07-02-defining-modules-to-control-scope-and-privacy.html">â€œDefining Modules to Control Scope and Privacyâ€</a><!-- ignore -->).</p>
<p>Má»™t <em>package</em> lÃ  má»™t bÃ³ (bundle) cá»§a má»™t hoáº·c nhiá»u crates cung cáº¥p má»™t
táº­p há»£p cÃ¡c tÃ­nh nÄƒng. Má»™t package chá»©a má»™t file <em>Cargo.toml</em> mÃ´ táº£ cÃ¡ch
build cÃ¡c crates. Cargo thá»±c ra lÃ  má»™t package chá»©a binary crate
command-line mÃ  báº¡n Ä‘Ã£ sá»­ dá»¥ng Ä‘á»ƒ build code cá»§a mÃ¬nh. Package Cargo cÅ©ng
chá»©a má»™t library crate mÃ  binary crate phá»¥ thuá»™c vÃ o. CÃ¡c dá»± Ã¡n khÃ¡c cÃ³ thá»ƒ
phá»¥ thuá»™c vÃ o library crate cá»§a Cargo Ä‘á»ƒ sá»­ dá»¥ng cÃ¹ng logic vá»›i command-line
tool cá»§a Cargo.</p>
<p>Má»™t package cÃ³ thá»ƒ chá»©a bao nhiÃªu binary crates báº¡n muá»‘n, nhÆ°ng tá»‘i Ä‘a chá»‰ cÃ³
má»™t library crate. Má»™t package pháº£i chá»©a Ã­t nháº¥t má»™t crate, dÃ¹ Ä‘Ã³ lÃ  má»™t
library crate hay binary crate.</p>
<p>CÃ¹ng xem qua nhá»¯ng gÃ¬ sáº½ xáº£y ra khi chÃºng ta táº¡o má»™t package. Äáº§u tiÃªn, chÃºng ta
nháº­p lá»‡nh <code>cargo new</code>:</p>
<pre><code class="language-console">$ cargo new my-project
     Created binary (application) `my-project` package
$ ls my-project
Cargo.toml
src
$ ls my-project/src
main.rs
</code></pre>
<p>Sau khi chÃºng ta cháº¡y <code>cargo new</code>, chÃºng ta sá»­ dá»¥ng lá»‡nh <code>ls</code> Ä‘á»ƒ xem nhá»¯ng gÃ¬
Cargo táº¡o ra. Trong thÆ° má»¥c dá»± Ã¡n, cÃ³ má»™t file <em>Cargo.toml</em>, Ä‘á»‹nh nghÄ©a cho
chÃºng ta má»™t package. CÃ³ má»™t thÆ° má»¥c <em>src</em> chá»©a file <em>main.rs</em>. Má»Ÿ file <em>Cargo.toml</em>
trong trÃ¬nh soáº¡n tháº£o vÄƒn báº£n, vÃ  chÃº Ã½ ráº±ng khÃ´ng cÃ³ Ä‘á» cáº­p nÃ o Ä‘áº¿n
file <em>src/main.rs</em>. Cargo quy Æ°á»›c ráº±ng <em>src/main.rs</em> lÃ  crate root cá»§a
má»™t binary crate cÃ¹ng tÃªn vá»›i package. TÆ°Æ¡ng tá»±, Cargo biáº¿t ráº±ng náº¿u thÆ°
má»¥c package chá»©a file <em>src/lib.rs</em>, package chá»©a má»™t library crate vá»›i cÃ¹ng
tÃªn vá»›i package, vÃ  <em>src/lib.rs</em> lÃ  crate root cá»§a nÃ³. Cargo truyá»n file crate
root cho <code>rustc</code> Ä‘á»ƒ build library hoáº·c binary.</p>
<p>á» Ä‘Ã¢y, chÃºng ta cÃ³ má»™t package chá»‰ chá»©a file <em>src/main.rs</em>, cÃ³ nghÄ©a lÃ  nÃ³
chá»‰ chá»©a má»™t binary crate cÃ³ tÃªn lÃ  <code>my-project</code>. Náº¿u má»™t package chá»©a file
<em>src/main.rs</em> vÃ  <em>src/lib.rs</em>, nÃ³ cÃ³ hai crates: má»™t binary vÃ  má»™t library, cáº£
hai cÃ³ cÃ¹ng tÃªn vá»›i package. Má»™t package cÃ³ thá»ƒ cÃ³ nhiá»u binary crates báº±ng cÃ¡ch
Ä‘áº·t file trong thÆ° má»¥c <em>src/bin</em>: má»—i file sáº½ lÃ  má»™t binary crate riÃªng biá»‡t.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="Äá»‹nh-nghÄ©a-modules-Ä‘á»ƒ-kiá»ƒm-soÃ¡t-pháº¡m-vi-scope-vÃ -quyá»n-riÃªng-tÆ°-privacy"><a class="header" href="#Äá»‹nh-nghÄ©a-modules-Ä‘á»ƒ-kiá»ƒm-soÃ¡t-pháº¡m-vi-scope-vÃ -quyá»n-riÃªng-tÆ°-privacy">Äá»‹nh nghÄ©a Modules Ä‘á»ƒ kiá»ƒm soÃ¡t pháº¡m vi (scope) vÃ  quyá»n riÃªng tÆ° (privacy)</a></h2>
<p>Trong pháº§n nÃ y, chÃºng ta sáº½ nÃ³i vá» cÃ¡c module vÃ  cÃ¡c pháº§n khÃ¡c cá»§a module
system, Ä‘áº·c biá»‡t lÃ  <em>paths</em> nÃ³ cho phÃ©p báº¡n Ä‘áº·t tÃªn cÃ¡c items; tá»« khÃ³a <code>use</code> Ä‘á»ƒ
Ä‘Æ°a má»™t path vÃ o scope; vÃ  tá»« khÃ³a <code>pub</code> Ä‘á»ƒ lÃ m cÃ¡c items public. ChÃºng ta cÅ©ng
sáº½ tháº£o luáº­n vá» tá»« khÃ³a <code>as</code>, cÃ¡c packages bÃªn ngoÃ i, vÃ  toÃ¡n tá»­ glob.</p>
<p>Äáº§u tiÃªn, chÃºng ta sáº½ báº¯t Ä‘áº§u vá»›i má»™t danh sÃ¡ch cÃ¡c quy táº¯c Ä‘á»ƒ tham kháº£o dá»… dÃ ng
khi báº¡n tá»• chá»©c code cá»§a báº¡n trong tÆ°Æ¡ng lai. Sau Ä‘Ã³, chÃºng ta sáº½ giáº£i thÃ­ch má»—i
quy táº¯c má»™t cÃ¡ch chi tiáº¿t.</p>
<h3 id="modules-cheat-sheet"><a class="header" href="#modules-cheat-sheet">Modules Cheat Sheet</a></h3>
<p>ÄÃ¢y lÃ  má»™t báº£ng tÃ³m táº¯t vá» cÃ¡ch cÃ¡c module, paths, tá»« khÃ³a <code>use</code> vÃ  tá»« khÃ³a
<code>pub</code> hoáº¡t Ä‘á»™ng trong compiler, vÃ  cÃ¡ch háº§u háº¿t cÃ¡c láº­p trÃ¬nh viÃªn tá»• chá»©c code
cá»§a há». ChÃºng ta sáº½ Ä‘i qua cÃ¡c vÃ­ dá»¥ cá»§a má»—i quy táº¯c trong chÆ°Æ¡ng nÃ y, nhÆ°ng
Ä‘Ã¢y lÃ  má»™t nÆ¡i tuyá»‡t vá»i Ä‘á»ƒ tham kháº£o nhÆ° má»™t lá»i nháº¯c vá» cÃ¡ch cÃ¡c module hoáº¡t
Ä‘á»™ng.</p>
<ul>
<li><strong>Báº¯t Ä‘áº§u tá»« crate root</strong>: Khi biÃªn dá»‹ch má»™t crate, compiler sáº½ Ä‘áº§u tiÃªn tÃ¬m
trong file crate root (thÆ°á»ng lÃ  <em>src/lib.rs</em> cho má»™t crate library hoáº·c
<em>src/main.rs</em> cho má»™t crate binary).</li>
<li><strong>Äá»‹nh nghÄ©a module</strong>: Trong file crate root, báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c module
má»›i; nÃ³i cÃ¡ch khÃ¡c, báº¡n Ä‘á»‹nh nghÄ©a má»™t module â€œgardenâ€ vá»›i <code>mod garden;</code>.
Compiler sáº½ tÃ¬m kiáº¿m code cá»§a module trong nhá»¯ng nÆ¡i sau:
<ul>
<li>Trá»±c tiáº¿p, trá»±c tiáº¿p sau <code>mod garden</code>, trong dáº¥u ngoáº·c nhá»n thay vÃ¬ dáº¥u cháº¥m pháº©y</li>
<li>Trong file <em>src/garden.rs</em></li>
<li>Trong file <em>src/garden/mod.rs</em></li>
</ul>
</li>
<li><strong>Äá»‹nh nghÄ©a submodules</strong>: Trong báº¥t ká»³ file nÃ o khÃ¡c file crate root, báº¡n cÃ³
thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c submodules. VÃ­ dá»¥, báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a <code>mod vegetables;</code>
trong <em>src/garden.rs</em>. Compiler sáº½ tÃ¬m kiáº¿m code cá»§a submodule trong thÆ° má»¥c
cÃ³ tÃªn giá»‘ng vá»›i module cha trong nhá»¯ng nÆ¡i sau:
<ul>
<li>Trá»±c tiáº¿p, trá»±c tiáº¿p sau <code>mod vegetables</code>, trong dáº¥u ngoáº·c nhá»n thay vÃ¬ dáº¥u
cháº¥m pháº©y</li>
<li>Trong file <em>src/garden/vegetables.rs</em></li>
<li>Trong file <em>src/garden/vegetables/mod.rs</em></li>
</ul>
</li>
<li><strong>Path dáº«n Ä‘áº¿n code trong module</strong>: Má»™t khi má»™t module lÃ  má»™t pháº§n cá»§a crate,
báº¡n cÃ³ thá»ƒ tham chiáº¿u Ä‘áº¿n code trong module Ä‘Ã³ tá»« báº¥t ká»³ nÆ¡i nÃ o trong cÃ¹ng
crate, má»™t khi cÃ¡c quy táº¯c báº£o máº­t cho phÃ©p, báº±ng cÃ¡ch sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n
(path) Ä‘áº¿n code. VÃ­ dá»¥, má»™t kiá»ƒu <code>Asparagus</code> trong module vegetables cá»§a
garden sáº½ Ä‘Æ°á»£c tÃ¬m tháº¥y táº¡i <code>crate::garden::vegetables::Asparagus</code>.</li>
<li><strong>Private vs public</strong>: Code trong má»™t module máº·c Ä‘á»‹nh lÃ  private vá»›i cÃ¡c
module
cha cá»§a nÃ³. Äá»ƒ lÃ m cho má»™t module public, Ä‘á»‹nh nghÄ©a nÃ³ vá»›i <code>pub mod</code> thay vÃ¬
<code>mod</code>. Äá»ƒ lÃ m cho cÃ¡c item trong má»™t module public, sá»­ dá»¥ng <code>pub</code> trÆ°á»›c cÃ¡c
Ä‘á»‹nh nghÄ©a cá»§a chÃºng.</li>
<li><strong>Tá»« khÃ³a <code>use</code></strong>: Trong má»™t scope, tá»« khÃ³a <code>use</code> táº¡o cÃ¡c Ä‘Æ°á»ng dáº«n táº¯t Ä‘áº¿n
cÃ¡c
item Ä‘á»ƒ giáº£m thiá»ƒu sá»± láº·p láº¡i cá»§a cÃ¡c Ä‘Æ°á»ng dáº«n dÃ i. Trong báº¥t ká»³ scope nÃ o
cÃ³ thá»ƒ tham chiáº¿u Ä‘áº¿n <code>crate::garden::vegetables::Asparagus</code>, báº¡n cÃ³ thá»ƒ táº¡o
má»™t Ä‘Æ°á»ng dáº«n táº¯t vá»›i <code>use crate::garden::vegetables::Asparagus;</code> vÃ  tá»« Ä‘Ã³
báº¡n chá»‰ cáº§n viáº¿t <code>Asparagus</code> Ä‘á»ƒ sá»­ dá»¥ng kiá»ƒu Ä‘Ã³ trong scope.</li>
</ul>
<p>á» Ä‘Ã¢y chÃºng ta táº¡o má»™t crate nhá»‹ phÃ¢n cÃ³ tÃªn <code>backyard</code> Ä‘á»ƒ minh há»a cÃ¡c quy táº¯c
trÃªn. ThÆ° má»¥c cá»§a crate, cÅ©ng Ä‘Æ°á»£c Ä‘áº·t tÃªn lÃ  <code>backyard</code>, chá»©a cÃ¡c file vÃ 
thÆ° má»¥c sau:</p>
<pre><code class="language-text">backyard
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â”œâ”€â”€ garden
    â”‚Â Â  â””â”€â”€ vegetables.rs
    â”œâ”€â”€ garden.rs
    â””â”€â”€ main.rs
</code></pre>
<p>File crate root trong trÆ°á»ng há»£p nÃ y lÃ  <em>src/main.rs</em>, vÃ  nÃ³ chá»©a:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust noplayground ignore">use crate::garden::vegetables::Asparagus;

pub mod garden;

fn main() {
    let plant = Asparagus {};
    println!("I'm growing {plant:?}!");
}</code></pre>
<p>DÃ²ng <code>pub mod garden;</code> nÃ³i vá»›i trÃ¬nh biÃªn dá»‹ch ráº±ng hÃ£y thÃªm code mÃ  nÃ³ tÃ¬m
tháº¥y trong <em>src/garden.rs</em>, code lÃ :</p>
<p><span class="filename">Filename: src/garden.rs</span></p>
<pre><code class="language-rust noplayground ignore">pub mod vegetables;</code></pre>
<p>á» Ä‘Ã¢y, <code>pub mod vegetables;</code> cÃ³ nghÄ©a lÃ  code trong <em>src/garden/vegetables.rs</em>
cÅ©ng Ä‘Æ°á»£c bao gá»“m. Code Ä‘Ã³ lÃ :</p>
<pre><code class="language-rust noplayground ignore">#[derive(Debug)]
pub struct Asparagus {}</code></pre>
<p>BÃ¢y giá» hÃ£y Ä‘i vÃ o chi tiáº¿t cá»§a cÃ¡c quy táº¯c nÃ y vÃ  minh há»a chÃºng trong thá»±c táº¿!</p>
<h3 id="nhÃ³m-cÃ¡c-Ä‘oáº¡n-code-liÃªn-quan-vÃ o-modules"><a class="header" href="#nhÃ³m-cÃ¡c-Ä‘oáº¡n-code-liÃªn-quan-vÃ o-modules">NhÃ³m cÃ¡c Ä‘oáº¡n code liÃªn quan vÃ o Modules</a></h3>
<p><em>Modules</em> cho phÃ©p chÃºng ta tá»• chá»©c code trong má»™t crate Ä‘á»ƒ dá»… Ä‘á»c vÃ  tÃ¡i sá»­
dá»¥ng. Modules cÅ©ng cho phÃ©p chÃºng ta kiá»ƒm soÃ¡t <em>bÃ­ máº­t</em> cá»§a cÃ¡c item, vÃ¬ code
trong má»™t module lÃ  riÃªng tÆ° theo máº·c Ä‘á»‹nh. CÃ¡c item riÃªng tÆ° lÃ  ná»™i bá»™ vÃ 
khÃ´ng cÃ³ sáºµn cho viá»‡c sá»­ dá»¥ng bÃªn ngoÃ i. ChÃºng ta cÃ³ thá»ƒ Ä‘á»ƒ cÃ¡c modules vÃ  cÃ¡c
item bÃªn trong chÃºng lÃ  public, nÃ³ cho phÃ©p chÃºng ta sá»­ dá»¥ng chÃºng.</p>
<p>VÃ­ dá»¥, hÃ£y cÃ¹ng viáº¿t má»™t library crate cung cáº¥p cÃ¡c tÃ­nh nÄƒng cá»§a má»™t nhÃ  hÃ ng.
ChÃºng ta sáº½ Ä‘á»‹nh nghÄ©a cÃ¡c hÃ m nhÆ°ng Ä‘á»ƒ trá»‘ng cÃ¡c thÃ¢n hÃ m Ä‘á»ƒ táº­p trung vÃ o
cáº¥u trÃºc cá»§a code, thay vÃ¬ viá»‡c triá»ƒn khai má»™t nhÃ  hÃ ng.</p>
<p>Trong ngÃ nh áº©m thá»±c, má»™t sá»‘ bá»™ pháº­n cá»§a má»™t nhÃ  hÃ ng Ä‘Æ°á»£c gá»i lÃ  <em>front of
house</em> vÃ  má»™t sá»‘ khÃ¡c lÃ  <em>back of house</em>. Front of house lÃ  nÆ¡i khÃ¡ch hÃ ng Ä‘áº¿n;
bao gá»“m nÆ¡i chá»§ nhÃ  hÃ ng tiáº¿p khÃ¡ch, nhÃ¢n viÃªn phá»¥c vá»¥ nháº­n Ä‘Æ¡n Ä‘áº·t
hÃ ng vÃ  thanh toÃ¡n, vÃ  nhÃ¢n viÃªn pha cháº¿ lÃ m cÃ¡c loáº¡i Ä‘á»“ uá»‘ng. Back of house lÃ 
nÆ¡i náº¥u Äƒn vÃ  lÃ m báº¿p, nhÃ¢n viÃªn vá»‡ sinh dá»n dáº¹p, vÃ  quáº£n lÃ½ lÃ m viá»‡c hÃ nh
chÃ­nh.</p>
<p>Cáº¥u trÃºc crate cá»§a chÃºng ta theo cÃ¡ch nÃ y, chÃºng ta cÃ³ thá»ƒ tá»• chá»©c cÃ¡c hÃ m
cá»§a nÃ³ thÃ nh cÃ¡c modules lá»“ng nhau. Táº¡o má»™t library má»›i tÃªn <code>restaurant</code> báº±ng
cÃ¡ch cháº¡y <code>cargo new --lib restaurant</code>; sau Ä‘Ã³ nháº­p code trong Listing 7-1 vÃ o
<em>src/lib.rs</em> Ä‘á»ƒ Ä‘á»‹nh nghÄ©a má»™t sá»‘ modules vÃ  chá»¯ kÃ½ hÃ m. ÄÃ¢y lÃ  pháº§n front of
house:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">mod front_of_house {
    mod hosting {
        fn add_to_waitlist() {}

        fn seat_at_table() {}
    }

    mod serving {
        fn take_order() {}

        fn serve_order() {}

        fn take_payment() {}
    }
}</code></pre>
<p><span class="caption">Listing 7-1: Má»™t module <code>front_of_house</code> chá»©a cÃ¡c module
khÃ¡c sau Ä‘Ã³ chá»©a cÃ¡c hÃ m</span></p>
<p>ChÃºng ta Ä‘á»‹nh nghÄ©a má»™t module vá»›i tá»« khÃ³a <code>mod</code> theo sau bá»Ÿi tÃªn cá»§a module
(trong trÆ°á»ng há»£p nÃ y, <code>front_of_house</code>). ThÃ¢n cá»§a module sau Ä‘Ã³ Ä‘i vÃ o trong
dáº¥u ngoáº·c nhá»n. Trong cÃ¡c module, chÃºng ta cÃ³ thá»ƒ Ä‘áº·t cÃ¡c module khÃ¡c, nhÆ° trong
trÆ°á»ng há»£p nÃ y vá»›i cÃ¡c module <code>hosting</code> vÃ  <code>serving</code>. CÃ¡c module cÅ©ng cÃ³ thá»ƒ
chá»©a cÃ¡c Ä‘á»‹nh nghÄ©a cho cÃ¡c má»¥c khÃ¡c, cháº³ng háº¡n nhÆ° cÃ¡c cáº¥u trÃºc, cÃ¡c enum,
cÃ¡c háº±ng sá»‘, cÃ¡c trait, nhÆ° trong Listing 7-1â€”functions.</p>
<p>Báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c module, chÃºng ta cÃ³ thá»ƒ nhÃ³m cÃ¡c Ä‘á»‹nh nghÄ©a liÃªn quan nhau
vÃ o cÃ¹ng má»™t nhÃ³m vÃ  Ä‘áº·t tÃªn cho lÃ½ do Ä‘áº¡i diá»‡n cá»§a chÃºng. CÃ¡c láº­p trÃ¬nh viÃªn
sá»­ dá»¥ng code nÃ y cÃ³ thá»ƒ Ä‘iá»u hÆ°á»›ng code dá»±a trÃªn cÃ¡c nhÃ³m thay vÃ¬ pháº£i Ä‘á»c qua
táº¥t cáº£ cÃ¡c Ä‘á»‹nh nghÄ©a, lÃ m cho viá»‡c tÃ¬m kiáº¿m cÃ¡c Ä‘á»‹nh nghÄ©a liÃªn quan Ä‘áº¿n dá»…
dÃ ng hÆ¡n. CÃ¡c láº­p trÃ¬nh viÃªn thÃªm tÃ­nh nÄƒng má»›i vÃ o code nÃ y sáº½ biáº¿t nÆ¡i Ä‘á»ƒ
Ä‘áº·t giÃºp cho chÆ°Æ¡ng trÃ¬nh Ä‘Æ°á»£c tá»• chá»©c tá»‘t.</p>
<p>TrÆ°á»›c Ä‘Ã¢y, chÃºng ta Ä‘Ã£ nÃ³i ráº±ng <em>src/main.rs</em> vÃ  <em>src/lib.rs</em> Ä‘Æ°á»£c gá»i lÃ 
crate roots. ChÃºng tÃªn váº­y vÃ¬ ná»™i dung cá»§a báº¥t ká»³ má»™t trong hai tá»‡p nÃ y táº¡o
ra má»™t module Ä‘Æ°á»£c gá»i lÃ  <code>crate</code> á»Ÿ gá»‘c cá»§a cáº¥u trÃºc module cá»§a crate, Ä‘Æ°á»£c
gá»i lÃ  <em>module tree</em>.</p>
<p>Listing 7-2 cho tháº¥y module tree cho cáº¥u trÃºc trong Listing 7-1.</p>
<pre><code class="language-text">crate
 â””â”€â”€ front_of_house
     â”œâ”€â”€ hosting
     â”‚   â”œâ”€â”€ add_to_waitlist
     â”‚   â””â”€â”€ seat_at_table
     â””â”€â”€ serving
         â”œâ”€â”€ take_order
         â”œâ”€â”€ serve_order
         â””â”€â”€ take_payment
</code></pre>
<p><span class="caption">Listing 7-2: Module tree cho code trong Listing 7-1</span></p>
<p>CÃ¢y nÃ y cho tháº¥y cÃ¡ch cÃ¡c module lá»“ng nhau; vÃ­ dá»¥, <code>hosting</code> lá»“ng trong
<code>front_of_house</code>. CÃ¢y cÅ©ng cho tháº¥y ráº±ng má»™t sá»‘ module lÃ  <em>anh em (siblings)</em>
vá»›i nhau, nghÄ©a lÃ  chÃºng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong cÃ¹ng má»™t module; <code>hosting</code> vÃ 
<code>serving</code> lÃ  anh em cÃ¹ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong <code>front_of_house</code>. Náº¿u module A
Ä‘Æ°á»£c chá»©a bÃªn trong module B, chÃºng ta nÃ³i module A lÃ  <em>con (child)</em> cá»§a module
B vÃ  module B lÃ  <em>cha (parent)</em> cá»§a module A. LÆ°u Ã½ ráº±ng toÃ n bá»™ module tree
Ä‘Æ°á»£c gá»‘c dÆ°á»›i module ngáº§m Ä‘á»‹nh Ä‘Æ°á»£c gá»i lÃ  <code>crate</code>.</p>
<p>CÃ¢y module cÃ³ thá»ƒ liÃªn tÆ°á»Ÿng Ä‘áº¿n cÃ¢y thÆ° má»¥c cá»§a há»‡ thá»‘ng tá»‡p trÃªn mÃ¡y tÃ­nh cá»§a
báº¡n; Ä‘Ã¢y lÃ  má»™t so sÃ¡nh ráº¥t chÃ­nh xÃ¡c! Giá»‘ng nhÆ° cÃ¡c thÆ° má»¥c trong há»‡ thá»‘ng
tá»‡p, báº¡n sá»­ dá»¥ng module Ä‘á»ƒ tá»• chá»©c code cá»§a báº¡n. CÅ©ng giá»‘ng nhÆ° cÃ¡c tá»‡p trong
thÆ° má»¥c, chÃºng ta cáº§n má»™t cÃ¡ch Ä‘á»ƒ tÃ¬m module cá»§a chÃºng ta.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="paths-Ä‘á»ƒ-tham-chiáº¿u-Ä‘áº¿n-má»™t-item-trong-cÃ¢y-module"><a class="header" href="#paths-Ä‘á»ƒ-tham-chiáº¿u-Ä‘áº¿n-má»™t-item-trong-cÃ¢y-module">Paths Ä‘á»ƒ tham chiáº¿u Ä‘áº¿n má»™t item trong cÃ¢y Module</a></h2>
<p>Äá»ƒ chá»‰ cho Rust biáº¿t nÆ¡i tÃ¬m tháº¥y má»™t item trong cÃ¢y module, chÃºng ta sá»­ dá»¥ng
má»™t Ä‘Æ°á»ng dáº«n (path) tÆ°Æ¡ng tá»± nhÆ° chÃºng ta sá»­ dá»¥ng má»™t Ä‘Æ°á»ng dáº«n trong má»™t há»‡
thá»‘ng táº­p tin. Äá»ƒ gá»i má»™t hÃ m, chÃºng ta cáº§n biáº¿t Ä‘Æ°á»ng dáº«n cá»§a nÃ³.</p>
<p>Má»™t Ä‘Æ°á»ng dáº«n cÃ³ thá»ƒ cÃ³ hai dáº¡ng:</p>
<ul>
<li><em>ÄÆ°á»ng dáº«n tuyá»‡t Ä‘á»‘i (absolute path)</em> lÃ  Ä‘Æ°á»ng dáº«n Ä‘áº§y Ä‘á»§ báº¯t Ä‘áº§u tá»« má»™t
crate root; Ä‘á»‘i vá»›i code tá»« má»™t crate bÃªn ngoÃ i, Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i báº¯t Ä‘áº§u vá»›i
tÃªn crate, vÃ  Ä‘á»‘i vá»›i code tá»« crate hiá»‡n táº¡i, nÃ³ báº¯t Ä‘áº§u vá»›i tá»« khoÃ¡ <code>crate</code>.</li>
<li><em>ÄÆ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i (relative path)</em> báº¯t Ä‘áº§u tá»« module hiá»‡n táº¡i vÃ  sá»­ dá»¥ng
<code>self</code>, <code>super</code>, hoáº·c má»™t Ä‘á»‹nh danh (identifier) trong module hiá»‡n táº¡i.</li>
</ul>
<p>Cáº£ Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i vÃ  tÆ°Æ¡ng Ä‘á»‘i Ä‘á»u Ä‘Æ°á»£c theo sau bá»Ÿi má»™t hoáº·c nhiá»u Ä‘á»‹nh
danh (identifier) Ä‘Æ°á»£c phÃ¢n tÃ¡ch bá»Ÿi hai dáº¥u hai cháº¥m (<code>::</code>).</p>
<p>Trá»Ÿ láº¡i Listing 7-1, giáº£ sá»­ chÃºng ta muá»‘n gá»i hÃ m <code>add_to_waitlist</code>. Äiá»u nÃ y
tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i cÃ¢u há»i: Ä‘Æ°á»ng dáº«n cá»§a hÃ m <code>add_to_waitlist</code> lÃ  gÃ¬? Listing 7-3
chá»©a Listing 7-1 vá»›i má»™t sá»‘ module vÃ  hÃ m bá»‹ xÃ³a. ChÃºng ta sáº½ hiá»ƒn thá»‹ hai cÃ¡ch
gá»i hÃ m <code>add_to_waitlist</code> tá»« má»™t hÃ m má»›i <code>eat_at_restaurant</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a
trong crate root. HÃ m <code>eat_at_restaurant</code> lÃ  má»™t pháº§n cá»§a API cÃ´ng khai cá»§a
library crate cá»§a chÃºng ta, vÃ¬ váº­y chÃºng ta Ä‘Ã¡nh dáº¥u nÃ³ vá»›i tá»« khoÃ¡ <code>pub</code>.
Trong pháº§n <a href="ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html#exposing-paths-with-the-pub-keyword">â€œExposing Paths with the <code>pub</code> Keywordâ€</a><!-- ignore -->, chÃºng
ta sáº½ Ä‘i sÃ¢u vÃ o chi tiáº¿t hÆ¡n vá» <code>pub</code>. LÆ°u Ã½ ráº±ng vÃ­ dá»¥ nÃ y táº¡m thá»i sáº½ khÃ´ng
Ä‘Æ°á»£c biÃªn dá»‹ch; chÃºng ta sáº½ giáº£i thÃ­ch táº¡i trong Ã­t phÃºt ná»¯a.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">mod front_of_house {
    mod hosting {
        fn add_to_waitlist() {}
    }
}

pub fn eat_at_restaurant() {
    // Absolute path
    crate::front_of_house::hosting::add_to_waitlist();

    // Relative path
    front_of_house::hosting::add_to_waitlist();
}</code></pre>
<p><span class="caption">Listing 7-3: Gá»i hÃ m <code>add_to_waitlist</code> sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n
tuyá»‡t Ä‘á»‘i vÃ  tÆ°Æ¡ng Ä‘á»‘i</span></p>
<p>Láº§n Ä‘áº§u tiÃªn chÃºng ta gá»i hÃ m <code>add_to_waitlist</code> trong <code>eat_at_restaurant</code>, chÃºng
ta sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i. HÃ m <code>add_to_waitlist</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong cÃ¹ng
má»™t crate vá»›i <code>eat_at_restaurant</code>, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng
tá»« khoÃ¡ <code>crate</code> Ä‘á»ƒ báº¯t Ä‘áº§u má»™t Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i. Sau Ä‘Ã³, chÃºng ta sáº½ Ä‘i qua
tá»«ng tÃªn cá»§a cÃ¡c module cho Ä‘áº¿n khi chÃºng ta báº¯t gáº·p <code>add_to_waitlist</code>.
Báº¡n cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng má»™t há»‡ thá»‘ng tá»‡p tin vá»›i cÃ¹ng cáº¥u trÃºc: chÃºng ta sáº½ chá»‰
Ä‘á»‹nh Ä‘Æ°á»ng dáº«n <code>/front_of_house/hosting/add_to_waitlist</code> Ä‘á»ƒ cháº¡y chÆ°Æ¡ng trÃ¬nh
<code>add_to_waitlist</code>; sá»­ dá»¥ng tá»« khoÃ¡ <code>crate</code> Ä‘á»ƒ báº¯t Ä‘áº§u tá»« crate root giá»‘ng nhÆ°
sá»­ dá»¥ng <code>/</code> Ä‘á»ƒ báº¯t Ä‘áº§u tá»« thÆ° má»¥c gá»‘c cá»§a há»‡ thá»‘ng tá»‡p tin trong shell cá»§a báº¡n.</p>
<p>Láº§n thá»© hai chÃºng ta gá»i <code>add_to_waitlist</code> trong <code>eat_at_restaurant</code>, chÃºng ta
sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i. ÄÆ°á»ng dáº«n báº¯t Ä‘áº§u vá»›i <code>front_of_house</code>, tÃªn cá»§a
module Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a cÃ¹ng cáº¥p vá»›i module tree cá»§a <code>eat_at_restaurant</code>. á» Ä‘Ã¢y
Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i há»‡ thá»‘ng tá»‡p tin sáº½ lÃ  sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n
<code>front_of_house/hosting/add_to_waitlist</code>. Báº¯t Ä‘áº§u vá»›i tÃªn cá»§a module cÃ³ nghÄ©a
ráº±ng Ä‘Æ°á»ng dáº«n lÃ  tÆ°Æ¡ng Ä‘á»‘i.</p>
<p>Viá»‡c lá»±a chá»n sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i hay tuyá»‡t Ä‘á»‘i lÃ  má»™t quyáº¿t Ä‘á»‹nh báº¡n
sáº½ Ä‘Æ°a ra dá»±a trÃªn dá»± Ã¡n, vÃ  phá»¥ thuá»™c vÃ o viá»‡c báº¡n cÃ³ thá»ƒ di chuyá»ƒn
Ä‘á»‹nh nghÄ©a code cá»§a item riÃªng biá»‡t hay cÃ¹ng vá»›i code sá»­ dá»¥ng item. VÃ­ dá»¥, náº¿u
chÃºng ta di chuyá»ƒn module <code>front_of_house</code> vÃ  hÃ m <code>eat_at_restaurant</code> vÃ o má»™t
module cÃ³ tÃªn <code>customer_experience</code>, chÃºng ta sáº½ cáº§n cáº­p nháº­t Ä‘Æ°á»ng dáº«n tuyá»‡t
Ä‘á»‘i Ä‘áº¿n <code>add_to_waitlist</code>, nhÆ°ng Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i váº«n lÃ  há»£p lá»‡. Tuy nhiÃªn,
náº¿u chÃºng ta di chuyá»ƒn hÃ m <code>eat_at_restaurant</code> riÃªng biá»‡t vÃ o má»™t module cÃ³ tÃªn
<code>dining</code>, Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i Ä‘áº¿n <code>add_to_waitlist</code> váº«n giá»¯ nguyÃªn, nhÆ°ng Ä‘Æ°á»ng
dáº«n tÆ°Æ¡ng Ä‘á»‘i sáº½ cáº§n Ä‘Æ°á»£c cáº­p nháº­t. NhÃ¬n chung, chÃºng tÃ´i thÃ­ch dÃ¹ng Ä‘Æ°á»ng dáº«n
tuyá»‡t Ä‘á»‘i vÃ¬ nÃ³ cÃ³ thá»ƒ  giÃºp chÃºng tÃ´i di chuyá»ƒn code Ä‘á»‹nh nghÄ©a vÃ  code gá»i
item Ä‘á»™c láº­p vá»›i nhau.</p>
<p>HÃ£y thá»­ biÃªn dá»‹ch Listing 7-3 vÃ  tÃ¬m hiá»ƒu táº¡i sao nÃ³ váº«n chÆ°a biÃªn dá»‹ch Ä‘Æ°á»£c!
Lá»—i mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c Ä‘Æ°á»£c hiá»ƒn thá»‹ trong Listing 7-4.</p>
<pre><code class="language-console">$ cargo build
   Compiling restaurant v0.1.0 (file:///projects/restaurant)
error[E0603]: module `hosting` is private
 --&gt; src/lib.rs:9:28
  |
9 |     crate::front_of_house::hosting::add_to_waitlist();
  |                            ^^^^^^^  --------------- function `add_to_waitlist` is not publicly re-exported
  |                            |
  |                            private module
  |
note: the module `hosting` is defined here
 --&gt; src/lib.rs:2:5
  |
2 |     mod hosting {
  |     ^^^^^^^^^^^

error[E0603]: module `hosting` is private
  --&gt; src/lib.rs:12:21
   |
12 |     front_of_house::hosting::add_to_waitlist();
   |                     ^^^^^^^  --------------- function `add_to_waitlist` is not publicly re-exported
   |                     |
   |                     private module
   |
note: the module `hosting` is defined here
  --&gt; src/lib.rs:2:5
   |
2  |     mod hosting {
   |     ^^^^^^^^^^^

For more information about this error, try `rustc --explain E0603`.
error: could not compile `restaurant` (lib) due to 2 previous errors
</code></pre>
<p><span class="caption">Listing 7-4: Lá»—i biÃªn dá»‹ch tá»« viá»‡c biÃªn dá»‹ch code trong
Listing 7-3</span></p>
<p>CÃ¡c thÃ´ng bÃ¡o lá»—i nÃ³i ráº±ng module <code>hosting</code> lÃ  riÃªng tÆ°. NÃ³i cÃ¡ch khÃ¡c, chÃºng
ta cÃ³ Ä‘Ãºng Ä‘Æ°á»ng dáº«n cho module <code>hosting</code> vÃ  hÃ m <code>add_to_waitlist</code>, nhÆ°ng Rust
khÃ´ng cho phÃ©p chÃºng ta sá»­ dá»¥ng chÃºng vÃ¬ nÃ³ khÃ´ng cÃ³ quyá»n truy cáº­p vÃ o cÃ¡c
pháº§n riÃªng tÆ°. Trong Rust, táº¥t cáº£ cÃ¡c item (hÃ m, phÆ°Æ¡ng thá»©c, struct, enum,
module, vÃ  háº±ng sá»‘) lÃ  private Ä‘á»‘i vá»›i module cha theo máº·c Ä‘á»‹nh. Náº¿u báº¡n muá»‘n
táº¡o má»™t item nhÆ° má»™t hÃ m hoáº·c struct private, báº¡n cáº§n Ä‘áº·t nÃ³ trong má»™t module.</p>
<p>CÃ¡c item trong module cha khÃ´ng thá»ƒ sá»­ dá»¥ng cÃ¡c item private bÃªn trong module
con, nhÆ°ng cÃ¡c item trong module con cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c item trong cÃ¡c module
cha cá»§a nÃ³. Äiá»u nÃ y lÃ  vÃ¬ module Ä‘Ã£ gÃ³i cÃ¡c chi tiáº¿t code cá»§a nÃ³ vÃ  áº©n chÃºng Ä‘i
nhÆ°ng module con cÃ³ thá»ƒ tháº¥y Ä‘Æ°á»£c ngá»¯ cáº£nh mÃ  nÃ³ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. Äá»ƒ tiáº¿p tá»¥c
vá»›i vÃ­ dá»¥ cá»§a chÃºng ta, hÃ£y nghÄ© vá» quy táº¯c riÃªng tÆ° nhÆ° lÃ  má»™t phÃ²ng há»p cá»§a
má»™t nhÃ  hÃ ng: nhá»¯ng gÃ¬ xáº£y ra bÃªn trong phÃ²ng há»p lÃ  riÃªng tÆ° Ä‘á»‘i vá»›i khÃ¡ch hÃ ng
(tá»©c lÃ  há», khÃ¡ch hÃ ng, khÃ´ng thá»ƒ truy cáº­p vÃ o phÃ²ng há»p), nhÆ°ng quáº£n lÃ½ nhÃ 
hÃ ng cÃ³ thá»ƒ tháº¥y vÃ  lÃ m má»i thá»© trong nhÃ  hÃ ng mÃ  há» quáº£n lÃ½.</p>
<p>Rust Ä‘Ã£ chá»n Ä‘á»ƒ há»‡ thá»‘ng module hoáº¡t Ä‘á»™ng theo cÃ¡ch nÃ y Ä‘á»ƒ áº©n cÃ¡c chi tiáº¿t
code bÃªn trong má»™t cÃ¡ch máº·c Ä‘á»‹nh. Theo cÃ¡ch nÃ y, báº¡n biáº¿t Ä‘Æ°á»£c nhá»¯ng pháº§n cá»§a
code bÃªn trong mÃ  báº¡n cÃ³ thá»ƒ thay Ä‘á»•i mÃ  khÃ´ng lÃ m há»ng code bÃªn ngoÃ i. Tuy
nhiÃªn, Rust cÅ©ng cho phÃ©p báº¡n lá»±a chá»n Ä‘á»ƒ tiáº¿t lá»™ cÃ¡c pháº§n bÃªn trong cá»§a module
con Ä‘áº¿n cÃ¡c module cha bÃªn ngoÃ i báº±ng cÃ¡ch sá»­ dá»¥ng tá»« khÃ³a <code>pub</code> Ä‘á»ƒ táº¡o má»™t
item public.</p>
<h3 id="exposing-paths-vá»›i-tá»«-khÃ³a-pub"><a class="header" href="#exposing-paths-vá»›i-tá»«-khÃ³a-pub">Exposing Paths vá»›i tá»« khÃ³a <code>pub</code></a></h3>
<p>CÃ¹ng trá»Ÿ láº¡i lá»—i trong Listing 7-4 mÃ  nÃ³i cho chÃºng ta ráº±ng module <code>hosting</code>
lÃ  private. ChÃºng ta muá»‘n hÃ m <code>eat_at_restaurant</code> trong module cha cÃ³ thá»ƒ
truy cáº­p vÃ o hÃ m <code>add_to_waitlist</code> trong module con, vÃ¬ váº­y chÃºng ta Ä‘Ã¡nh dáº¥u
module <code>hosting</code> vá»›i tá»« khÃ³a <code>pub</code>, nhÆ° trong Listing 7-5.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">// ANCHOR: here
mod front_of_house {
    pub mod hosting {
        fn add_to_waitlist() {}
    }
}

// -- snip --
// ANCHOR_END: here
pub fn eat_at_restaurant() {
    // Absolute path
    crate::front_of_house::hosting::add_to_waitlist();

    // Relative path
    front_of_house::hosting::add_to_waitlist();
}</code></pre>
<p><span class="caption">Listing 7-5: ÄÃ¡nh dáº¥u module <code>hosting</code> lÃ  <code>pub</code> Ä‘á»ƒ sá»­
dá»¥ng nÃ³ tá»« <code>eat_at_restaurant</code></span></p>
<p>Ráº¥t tiáº¿c, code trong Listing 7-5 váº«n dáº«n Ä‘áº¿n lá»—i, nhÆ° trong Listing 7-6.</p>
<pre><code class="language-console">$ cargo build
   Compiling restaurant v0.1.0 (file:///projects/restaurant)
error[E0603]: function `add_to_waitlist` is private
  --&gt; src/lib.rs:10:37
   |
10 |     crate::front_of_house::hosting::add_to_waitlist();
   |                                     ^^^^^^^^^^^^^^^ private function
   |
note: the function `add_to_waitlist` is defined here
  --&gt; src/lib.rs:3:9
   |
3  |         fn add_to_waitlist() {}
   |         ^^^^^^^^^^^^^^^^^^^^

error[E0603]: function `add_to_waitlist` is private
  --&gt; src/lib.rs:13:30
   |
13 |     front_of_house::hosting::add_to_waitlist();
   |                              ^^^^^^^^^^^^^^^ private function
   |
note: the function `add_to_waitlist` is defined here
  --&gt; src/lib.rs:3:9
   |
3  |         fn add_to_waitlist() {}
   |         ^^^^^^^^^^^^^^^^^^^^

For more information about this error, try `rustc --explain E0603`.
error: could not compile `restaurant` (lib) due to 2 previous errors
</code></pre>
<p><span class="caption">Listing 7-6: Lá»—i cá»§a compiler khi build code trong
Listing 7-5</span></p>
<p>Äiá»u gÃ¬ Ä‘Ã£ xáº£y ra? Viá»‡c thÃªm tá»« khÃ³a <code>pub</code> trÆ°á»›c <code>mod hosting</code> lÃ m cho module
public. Vá»›i thay Ä‘á»•i nÃ y, náº¿u chÃºng ta cÃ³ thá»ƒ truy cáº­p <code>front_of_house</code>, chÃºng
ta cÃ³ thá»ƒ truy cáº­p <code>hosting</code>. NhÆ°ng <em>ná»™i dung</em> cá»§a <code>hosting</code> váº«n lÃ  private;
viá»‡c lÃ m module public khÃ´ng lÃ m cho ná»™i dung cá»§a nÃ³ public. Tá»« khÃ³a <code>pub</code> trÃªn
module chá»‰ cho phÃ©p code á»Ÿ module cha tham chiáº¿u Ä‘áº¿n nÃ³, khÃ´ng cho phÃ©p
truy cáº­p code bÃªn trong. VÃ¬ module lÃ  container, viá»‡c lÃ m cho module public;
khÃ´ng thá»±c sá»± giÃºp chÃºng ta viá»‡c gÃ¬, chÃºng ta cáº§n Ä‘i xa hÆ¡n vÃ  chá»n Ä‘á»ƒ lÃ m
public má»™t hoáº·c nhiá»u item bÃªn trong module.</p>
<p>Lá»—i trong Listing 7-6 nÃ³i ráº±ng hÃ m <code>add_to_waitlist</code> lÃ  private. Quy táº¯c
privacy Ã¡p dá»¥ng cho struct, enum, function, vÃ  method cÅ©ng nhÆ° module.</p>
<p>HÃ£y cÅ©ng lÃ m cho hÃ m <code>add_to_waitlist</code> public báº±ng cÃ¡ch thÃªm tá»« khÃ³a <code>pub</code>
trÆ°á»›c Ä‘á»‹nh nghÄ©a cá»§a nÃ³, nhÆ° trong Listing 7-7.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground test_harness">// ANCHOR: here
mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}
    }
}

// -- snip --
// ANCHOR_END: here
pub fn eat_at_restaurant() {
    // Absolute path
    crate::front_of_house::hosting::add_to_waitlist();

    // Relative path
    front_of_house::hosting::add_to_waitlist();
}</code></pre>
<p><span class="caption">Listing 7-7: ThÃªm tá»« khÃ³a <code>pub</code> vÃ o <code>mod hosting</code> vÃ 
<code>fn add_to_waitlist</code> Ä‘á»ƒ chÃºng ta gá»i hÃ m tá»« <code>eat_at_restaurant</code></span></p>
<p>BÃ¢y giá» code sáº½ compile! Äá»ƒ biáº¿t táº¡i sao thÃªm tá»« khÃ³a <code>pub</code> cho phÃ©p chÃºng ta
sá»­ dá»¥ng nhá»¯ng Ä‘Æ°á»ng dáº«n nÃ y trong <code>add_to_waitlist</code> vá»›i quy táº¯c privacy, hÃ£y
xem Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i vÃ  Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i.</p>
<p>Trong Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i, chÃºng ta báº¯t Ä‘áº§u vá»›i <code>crate</code>, gá»‘c cá»§a cÃ¢y module
cá»§a crate. Module <code>front_of_house</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong crate root. Khi
<code>front_of_house</code> khÃ´ng pháº£i lÃ  public, vÃ¬ hÃ m <code>eat_at_restaurant</code> Ä‘Æ°á»£c Ä‘á»‹nh
nghÄ©a trong cÃ¹ng má»™t module vá»›i <code>front_of_house</code> (tá»©c lÃ  <code>eat_at_restaurant</code>
vÃ  <code>front_of_house</code> lÃ  anh em), chÃºng ta cÃ³ thá»ƒ tham chiáº¿u Ä‘áº¿n <code>front_of_house</code>
tá»« <code>eat_at_restaurant</code>. Tiáº¿p theo lÃ  module <code>hosting</code> Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u vá»›i <code>pub</code>.
ChÃºng ta cÃ³ thá»ƒ truy cáº­p module cha cá»§a <code>hosting</code>, vÃ¬ váº­y chÃºng ta cÃ³ thá»ƒ truy
cáº­p <code>hosting</code>. Cuá»‘i cÃ¹ng, hÃ m <code>add_to_waitlist</code> Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u vá»›i <code>pub</code> vÃ  chÃºng
ta cÃ³ thá»ƒ truy cáº­p module cha cá»§a nÃ³, vÃ¬ váº­y cuá»™c gá»i hÃ m nÃ y hoáº¡t Ä‘á»™ng!</p>
<p>Trong Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i, logic lÃ  giá»‘ng nhÆ° Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i ngoáº¡i trá»«
bÆ°á»›c Ä‘áº§u tiÃªn: thay vÃ¬ báº¯t Ä‘áº§u tá»« crate root, Ä‘Æ°á»ng dáº«n báº¯t Ä‘áº§u tá»«
<code>front_of_house</code>. Module <code>front_of_house</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong cÃ¹ng má»™t module
vá»›i <code>eat_at_restaurant</code>, vÃ¬ váº­y Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i báº¯t Ä‘áº§u tá»« module mÃ 
<code>eat_at_restaurant</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a hoáº¡t Ä‘á»™ng. Sau Ä‘Ã³, vÃ¬ <code>hosting</code> vÃ 
<code>add_to_waitlist</code> Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u vá»›i <code>pub</code>, pháº§n cÃ²n láº¡i cá»§a Ä‘Æ°á»ng dáº«n hoáº¡t
Ä‘á»™ng, vÃ  cuá»™c gá»i hÃ m nÃ y lÃ  há»£p lá»‡!</p>
<p>Náº¿u báº¡n dá»± Ä‘á»‹nh chia sáº» library crate Ä‘á»ƒ cÃ¡c dá»± Ã¡n khÃ¡c cÃ³ thá»ƒ sá»­ dá»¥ng mÃ£ cá»§a
báº¡n, API cÃ´ng khai cá»§a báº¡n lÃ  interface mÃ  ngÆ°á»i dÃ¹ng cá»§a crate cá»§a báº¡n tÆ°Æ¡ng
tÃ¡c vá»›i mÃ£ cá»§a báº¡n. CÃ³ nhiá»u Ä‘iá»u cáº§n xem xÃ©t vá» viá»‡c quáº£n lÃ½ cÃ¡c thay Ä‘á»•i
trong API cÃ´ng khai cá»§a báº¡n Ä‘á»ƒ lÃ m cho viá»‡c phá»¥ thuá»™c vÃ o crate cá»§a báº¡n dá»… dÃ ng
hÆ¡n. Nhá»¯ng Ä‘iá»u nÃ y náº±m ngoÃ i pháº¡m vi cá»§a cuá»‘n sÃ¡ch nÃ y; náº¿u báº¡n quan tÃ¢m Ä‘áº¿n
chá»§ Ä‘á» nÃ y, hÃ£y xem <a href="https://rust-lang.github.io/api-guidelines/">The Rust API Guidelines</a>.</p>
<section class="note" aria-role="note">
<h4 id="best-practices-for-packages-with-a-binary-and-a-library"><a class="header" href="#best-practices-for-packages-with-a-binary-and-a-library">Best Practices for Packages with a Binary and a Library</a></h4>
<p>ChÃºng ta Ä‘Ã£ nÃ³i ráº±ng má»™t package cÃ³ thá»ƒ chá»©a cáº£ <em>src/main.rs</em> binary crate
root cÅ©ng nhÆ° <em>src/lib.rs</em> library crate root, vÃ  cáº£ hai crate sáº½ cÃ³ tÃªn
package máº·c Ä‘á»‹nh. ThÃ´ng thÆ°á»ng, cÃ¡c package dáº¡ng nÃ y sáº½ chá»©a Ä‘á»§ code trong
binary crate Ä‘á»ƒ khá»Ÿi Ä‘á»™ng má»™t chÆ°Æ¡ng trÃ¬nh thá»±c thi, code nÃ y sáº½ gá»i Ä‘áº¿n
code tron library crate. Äiá»u nÃ y cho phÃ©p cÃ¡c dá»± Ã¡n khÃ¡c cÃ³ thá»ƒ táº­n dá»¥ng
tá»‘i Ä‘a cÃ¡c chá»©c nÄƒng mÃ  package cung cáº¥p, vÃ¬ code trong library crate cÃ³ thá»ƒ
Ä‘Æ°á»£c chia sáº».</p>
<p>CÃ¢y module nÃªn Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong <em>src/lib.rs</em>. Sau Ä‘Ã³, báº¥t ká»³ item cÃ´ng
khai nÃ o cÅ©ng cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng trong binary crate báº±ng cÃ¡ch báº¯t Ä‘áº§u Ä‘Æ°á»ng
dáº«n vá»›i tÃªn cá»§a package. Binary crate trá»Ÿ thÃ nh má»™t ngÆ°á»i dÃ¹ng cá»§a library
crate giá»‘ng nhÆ° má»™t crate hoÃ n toÃ n bÃªn ngoÃ i sáº½ sá»­ dá»¥ng library crate: nÃ³
chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng API cÃ´ng khai. Äiá»u nÃ y giÃºp báº¡n thiáº¿t káº¿ má»™t API tá»‘t;
khÃ´ng chá»‰ lÃ  báº¡n lÃ  ngÆ°á»i viáº¿t, báº¡n cÅ©ng lÃ  ngÆ°á»i dÃ¹ng!</p>
<p>Trong <a href="ch12-00-an-io-project.html">Chapter 12</a><!-- ignore -->, chÃºng ta sáº½ minh há»a cÃ¡ch tá»• chá»©c
nÃ y vá»›i má»™t chÆ°Æ¡ng trÃ¬nh CLI sáº½ chá»©a cáº£ binary crate vÃ  library crate.</p>
</section>
<hr />
<h3 id="starting-relative-paths-with-super"><a class="header" href="#starting-relative-paths-with-super">Starting Relative Paths with <code>super</code></a></h3>
<p>ChÃºng ta cÃ³ thá»ƒ khai bÃ¡o Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i báº¯t Ä‘áº§u tá»« module cha, thay vÃ¬
module hiá»‡n táº¡i hoáº·c module gá»‘c, báº±ng cÃ¡ch sá»­ dá»¥ng <code>super</code> á»Ÿ Ä‘áº§u Ä‘Æ°á»ng dáº«n.
Äiá»u nÃ y giá»‘ng nhÆ° báº¯t Ä‘áº§u má»™t Ä‘Æ°á»ng dáº«n há»‡ thá»‘ng táº­p tin vá»›i cÃº phÃ¡p <code>..</code>.
Äiá»u nÃ y cho phÃ©p chÃºng ta tham chiáº¿u Ä‘áº¿n má»™t item mÃ  chÃºng ta biáº¿t náº±m trong
module cha, Ä‘iá»u nÃ y sáº½ giÃºp chÃºng ta dá»… dÃ ng sáº¯p xáº¿p láº¡i cÃ¢y module khi module
Ä‘Ã³ liÃªn quan gáº§n vá»›i module cha, nhÆ°ng module cha cÃ³ thá»ƒ Ä‘Æ°á»£c di chuyá»ƒn Ä‘áº¿n
má»™t nÆ¡i khÃ¡c trong cÃ¢y module má»™t lÃºc nÃ o Ä‘Ã³ trong tÆ°Æ¡ng lai.</p>
<p>Xem code trong Listing 7-8 mÃ´ hÃ¬nh hÃ³a tÃ¬nh huá»‘ng trong Ä‘Ã³ má»™t nhÃ  báº¿p sá»­a
lá»—i Ä‘Æ¡n hÃ ng vÃ  mang Ä‘áº¿n cho khÃ¡ch hÃ ng cÃ¡ nhÃ¢n. HÃ m <code>fix_incorrect_order</code>
Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong module <code>back_of_house</code> gá»i hÃ m <code>deliver_order</code> Ä‘Æ°á»£c Ä‘á»‹nh
nghÄ©a trong module cha báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh Ä‘Æ°á»ng dáº«n Ä‘áº¿n <code>deliver_order</code> báº¯t Ä‘áº§u
báº±ng <code>super</code>:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground test_harness">fn deliver_order() {}

mod back_of_house {
    fn fix_incorrect_order() {
        cook_order();
        super::deliver_order();
    }

    fn cook_order() {}
}</code></pre>
<p><span class="caption">Listing 7-8: Gá»i má»™t hÃ m sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i
báº¯t Ä‘áº§u báº±ng <code>super</code></span></p>
<p>HÃ m <code>fix_incorrect_order</code> náº±m trong module <code>back_of_house</code>, vÃ¬ váº­y chÃºng ta
cÃ³ thá»ƒ sá»­ dá»¥ng <code>super</code> Ä‘á»ƒ Ä‘i Ä‘áº¿n module cha cá»§a <code>back_of_house</code>, trong trÆ°á»ng
há»£p nÃ y lÃ  <code>crate</code>, gá»‘c. Tá»« Ä‘Ã³, chÃºng ta tÃ¬m kiáº¿m <code>deliver_order</code> vÃ  tÃ¬m tháº¥y
nÃ³. ChÃºng ta cho ráº±ng module <code>back_of_house</code> vÃ  hÃ m <code>deliver_order</code>
cÃ³ thá»ƒ á»Ÿ trong má»‘i quan há»‡ tÆ°Æ¡ng tá»± vÃ  Ä‘Æ°á»£c di chuyá»ƒn cÃ¹ng nhau dÃ¹
chÃºng ta quyáº¿t Ä‘á»‹nh tá»• chá»©c láº¡i cÃ¢y module cá»§a crate. Do Ä‘Ã³, chÃºng ta Ä‘Ã£ sá»­
dá»¥ng <code>super</code> Ä‘á»ƒ chÃºng ta sáº½ cÃ³ Ã­t chá»— cáº§n cáº­p nháº­t code trong tÆ°Æ¡ng lai náº¿u code
nÃ y Ä‘Æ°á»£c di chuyá»ƒn Ä‘áº¿n má»™t module khÃ¡c.</p>
<hr />
<h3 id="making-structs-and-enums-public"><a class="header" href="#making-structs-and-enums-public">Making Structs and Enums Public</a></h3>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng <code>pub</code> Ä‘á»ƒ Ä‘Ã¡nh dáº¥u struct vÃ  enum lÃ  public, nhÆ°ng
cÃ³ má»™t sá»‘ chi tiáº¿t khÃ¡c vá» cÃ¡ch sá»­ dá»¥ng <code>pub</code> vá»›i struct vÃ  enum. Náº¿u chÃºng ta
sá»­ dá»¥ng <code>pub</code> trÆ°á»›c má»™t Ä‘á»‹nh nghÄ©a struct, chÃºng ta sáº½ lÃ m public struct, nhÆ°ng
cÃ¡c trÆ°á»ng cá»§a struct váº«n sáº½ lÃ  private. ChÃºng ta cÃ³ thá»ƒ lÃ m public hoáº·c khÃ´ng
cho má»—i trÆ°á»ng má»™t cÃ¡ch riÃªng biá»‡t. Trong Listing 7-9, chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a
má»™t struct <code>back_of_house::Breakfast</code> public vá»›i má»™t trÆ°á»ng <code>toast</code> public
nhÆ°ng má»™t trÆ°á»ng <code>seasonal_fruit</code> private. Äiá»u nÃ y mÃ´ hÃ¬nh trÆ°á»ng há»£p trong
má»™t nhÃ  hÃ ng nÆ¡i khÃ¡ch hÃ ng cÃ³ thá»ƒ chá»n loáº¡i bÃ¡nh mÃ¬ mÃ  há» muá»‘n kÃ¨m theo má»™t
bá»¯a Äƒn, nhÆ°ng báº¿p trÆ°á»Ÿng quyáº¿t Ä‘á»‹nh loáº¡i quáº£ tÆ°Æ¡i sáº½ Ä‘i kÃ¨m theo bá»¯a Äƒn dá»±a
trÃªn mÃ¹a vÃ  hÃ ng tá»“n kho. CÃ¡c loáº¡i quáº£ tÆ°Æ¡i thay Ä‘á»•i nhanh chÃ³ng, vÃ¬ váº­y khÃ¡ch
hÃ ng khÃ´ng thá»ƒ chá»n loáº¡i quáº£ tÆ°Æ¡i hoáº·c tháº­m chÃ­ xem Ä‘Æ°á»£c loáº¡i quáº£ tÆ°Æ¡i mÃ  há» sáº½
nháº­n Ä‘Æ°á»£c.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">mod back_of_house {
    pub struct Breakfast {
        pub toast: String,
        seasonal_fruit: String,
    }

    impl Breakfast {
        pub fn summer(toast: &amp;str) -&gt; Breakfast {
            Breakfast {
                toast: String::from(toast),
                seasonal_fruit: String::from("peaches"),
            }
        }
    }
}

pub fn eat_at_restaurant() {
    // Order a breakfast in the summer with Rye toast.
    let mut meal = back_of_house::Breakfast::summer("Rye");
    // Change our mind about what bread we'd like.
    meal.toast = String::from("Wheat");
    println!("I'd like {} toast please", meal.toast);

    // The next line won't compile if we uncomment it; we're not allowed
    // to see or modify the seasonal fruit that comes with the meal.
    // meal.seasonal_fruit = String::from("blueberries");
}</code></pre>
<p><span class="caption">Listing 7-9: Má»™t struct vá»›i má»™t sá»‘ trÆ°á»ng public vÃ  má»™t
sá»‘ trÆ°á»ng private</span></p>
<p>Bá»Ÿi vÃ¬ trÆ°á»ng <code>toast</code> trong struct <code>back_of_house::Breakfast</code> lÃ  public, trong
<code>eat_at_restaurant</code> chÃºng ta cÃ³ thá»ƒ viáº¿t vÃ  Ä‘á»c trÆ°á»ng <code>toast</code> sá»­ dá»¥ng dáº¥u cháº¥m
. LÆ°u Ã½ ráº±ng chÃºng ta khÃ´ng thá»ƒ sá»­ dá»¥ng trÆ°á»ng <code>seasonal_fruit</code> trong
<code>eat_at_restaurant</code> vÃ¬ <code>seasonal_fruit</code> lÃ  private. HÃ£y thá»­ bá» comment dÃ²ng
sá»­a Ä‘á»•i giÃ¡ trá»‹ trÆ°á»ng <code>seasonal_fruit</code> Ä‘á»ƒ xem cÃ³ lá»—i gÃ¬ xáº£y ra!</p>
<p>NgoÃ i ra, lÆ°u Ã½ ráº±ng vÃ¬ <code>back_of_house::Breakfast</code> cÃ³ má»™t trÆ°á»ng private, struct
cáº§n pháº£i cung cáº¥p má»™t hÃ m liÃªn quan public Ä‘á»ƒ táº¡o má»™t instance cá»§a <code>Breakfast</code>
(chÃºng ta Ä‘Ã£ Ä‘áº·t tÃªn lÃ  <code>summer</code>). Náº¿u <code>Breakfast</code> khÃ´ng cÃ³ hÃ m nhÆ° váº­y, chÃºng
ta khÃ´ng thá»ƒ táº¡o má»™t instance cá»§a <code>Breakfast</code> trong <code>eat_at_restaurant</code> vÃ¬ chÃºng
ta khÃ´ng thá»ƒ thiáº¿t láº­p giÃ¡ trá»‹ cá»§a trÆ°á»ng private <code>seasonal_fruit</code> trong
<code>eat_at_restaurant</code>.</p>
<p>TrÃ¡i ngÆ°á»£c vá»›i struct, náº¿u chÃºng ta Ä‘áº·t má»™t enum lÃ  public, táº¥t cáº£ cÃ¡c variant
cá»§a nÃ³ sáº½ lÃ  public. ChÃºng ta chá»‰ cáº§n Ä‘áº·t <code>pub</code> trÆ°á»›c tá»« khÃ³a <code>enum</code>, nhÆ° trong
Listing 7-10.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">mod back_of_house {
    pub enum Appetizer {
        Soup,
        Salad,
    }
}

pub fn eat_at_restaurant() {
    let order1 = back_of_house::Appetizer::Soup;
    let order2 = back_of_house::Appetizer::Salad;
}</code></pre>
<p><span class="caption">Listing 7-10: ÄÃ¡nh dáº¥u má»™t enum lÃ  public sáº½ lÃ m cho táº¥t
cáº£ cÃ¡c variant cá»§a nÃ³ lÃ  public</span></p>
<p>Bá»Ÿi vÃ¬ chÃºng ta Ä‘Ã£ Ä‘Ã¡nh dáº¥u enum <code>Appetizer</code> lÃ  public, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng
variant <code>Soup</code> vÃ  <code>Salad</code> trong <code>eat_at_restaurant</code>.</p>
<p>Enum khÃ´ng cÃ³ Ã­ch gÃ¬ náº¿u cÃ¡c variant cá»§a nÃ³ khÃ´ng pháº£i lÃ  public; sáº½ ráº¥t phiá»n
phá»©c pháº£i Ä‘Ã¡nh dáº¥u táº¥t cáº£ cÃ¡c variant cá»§a enum vá»›i <code>pub</code> trong má»i trÆ°á»ng há»£p,
vÃ¬ váº­y máº·c Ä‘á»‹nh cho variant cá»§a enum lÃ  public. Struct thÆ°á»ng cÃ³ Ã­ch mÃ  khÃ´ng
cáº§n cÃ¡c trÆ°á»ng cá»§a nÃ³ lÃ  public, vÃ¬ váº­y cÃ¡c trÆ°á»ng cá»§a struct theo quy táº¯c chung
cá»§a má»i thá»© lÃ  private trá»« khi Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u vá»›i <code>pub</code>.</p>
<p>CÃ³ má»™t trÆ°á»ng há»£p ná»¯a liÃªn quan Ä‘áº¿n <code>pub</code> mÃ  chÃºng ta chÆ°a bÃ n Ä‘áº¿n, Ä‘Ã³ lÃ  tÃ­nh
nÄƒng cuá»‘i cÃ¹ng cá»§a module system: tá»« khÃ³a <code>use</code>. ChÃºng ta sáº½ bÃ n <code>use</code> má»™t mÃ¬nh
trÆ°á»›c, vÃ  sau Ä‘Ã³ chÃºng ta sáº½ hiá»ƒn thá»‹ cÃ¡ch káº¿t há»£p <code>pub</code> vÃ  <code>use</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="ÄÆ°a-paths-vÃ o-scope-báº±ng-tá»«-khÃ³a-use"><a class="header" href="#ÄÆ°a-paths-vÃ o-scope-báº±ng-tá»«-khÃ³a-use">ÄÆ°a Paths vÃ o Scope báº±ng tá»« khÃ³a <code>use</code></a></h2>
<p>Pháº£i viáº¿t ra Ä‘Æ°á»ng dáº«n Ä‘á»ƒ gá»i cÃ¡c hÃ m cÃ³ thá»ƒ cáº£m tháº¥y khÃ´ng tiá»‡n lá»£i vÃ  láº·p Ä‘i
láº·p láº¡i. Trong Listing 7-7, dÃ¹ chÃºng ta Ä‘Ã£ chá»n Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i hay tÆ°Æ¡ng
Ä‘á»‘i Ä‘áº¿n hÃ m <code>add_to_waitlist</code>, má»—i khi chÃºng ta muá»‘n gá»i <code>add_to_waitlist</code> chÃºng
ta pháº£i chá»‰ Ä‘á»‹nh <code>front_of_house</code> vÃ  <code>hosting</code> ná»¯a. May máº¯n thay, cÃ³ má»™t cÃ¡ch Ä‘á»ƒ
giáº£m bá»›t quÃ¡ trÃ¬nh nÃ y: chÃºng ta cÃ³ thá»ƒ táº¡o má»™t Ä‘Æ°á»ng dáº«n táº¯t vá»›i tá»« khÃ³a <code>use</code>
má»™t láº§n, vÃ  sau Ä‘Ã³ sá»­ dá»¥ng tÃªn ngáº¯n hÆ¡n á»Ÿ má»i nÆ¡i trong scope.</p>
<p>Trong Listing 7-11, chÃºng ta Ä‘Æ°a module <code>crate::front_of_house::hosting</code> vÃ o
scope cá»§a hÃ m <code>eat_at_restaurant</code> Ä‘á»ƒ chÃºng ta chá»‰ cáº§n chá»‰ Ä‘á»‹nh
<code>hosting::add_to_waitlist</code> Ä‘á»ƒ gá»i hÃ m <code>add_to_waitlist</code> trong
<code>eat_at_restaurant</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground test_harness">mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}
    }
}

use crate::front_of_house::hosting;

pub fn eat_at_restaurant() {
    hosting::add_to_waitlist();
}</code></pre>
<p><span class="caption">Listing 7-11: Mang má»™t module vÃ o scope vá»›i <code>use</code></span></p>
<p>ThÃªm <code>use</code> vÃ  Ä‘Æ°á»ng dáº«n trong má»™t scope giá»‘ng nhÆ° táº¡o má»™t liÃªn káº¿t tÆ°á»£ng trÆ°ng
trong há»‡ thá»‘ng tá»‡p. Báº±ng cÃ¡ch thÃªm <code>use crate::front_of_house::hosting</code> trong
crate root, <code>hosting</code> lÃ  má»™t tÃªn há»£p lá»‡ trong scope Ä‘Ã³, giá»‘ng nhÆ° module
<code>hosting</code> Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong crate root. ÄÆ°á»ng dáº«n Ä‘Æ°á»£c Ä‘Æ°a vÃ o scope
vá»›i <code>use</code> cÅ©ng kiá»ƒm tra quyá»n riÃªng tÆ°, giá»‘ng nhÆ° báº¥t ká»³ Ä‘Æ°á»ng dáº«n nÃ o khÃ¡c.</p>
<p>LÆ°u Ã½ ráº±ng <code>use</code> chá»‰ táº¡o Ä‘Æ°á»ng dáº«n táº¯t cho scope cá»¥ thá»ƒ mÃ  <code>use</code> xáº£y ra. Listing
7-12 di chuyá»ƒn hÃ m <code>eat_at_restaurant</code> vÃ o má»™t module con má»›i cÃ³ tÃªn
<code>customer</code>, Ä‘Ã³ lÃ  má»™t scope khÃ¡c vá»›i cÃ¢u lá»‡nh <code>use</code>, vÃ¬ váº­y ná»™i dung hÃ m sáº½ khÃ´ng Ä‘Æ°á»£c biÃªn dá»‹ch:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground test_harness does_not_compile ignore">mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}
    }
}

use crate::front_of_house::hosting;

mod customer {
    pub fn eat_at_restaurant() {
        hosting::add_to_waitlist();
    }
}</code></pre>
<p><span class="caption">Listing 7-12: Má»™t cÃ¢u lá»‡nh <code>use</code> chá»‰ Ã¡p dá»¥ng trong scope
nÃ³ Ä‘ang á»Ÿ</span></p>
<p>Lá»—i biÃªn dá»‹ch cho tháº¥y Ä‘Æ°á»ng dáº«n táº¯t khÃ´ng cÃ²n Ã¡p dá»¥ng trong module <code>customer</code>:</p>
<pre><code class="language-console">$ cargo build
   Compiling restaurant v0.1.0 (file:///projects/restaurant)
error[E0433]: failed to resolve: use of undeclared crate or module `hosting`
  --&gt; src/lib.rs:11:9
   |
11 |         hosting::add_to_waitlist();
   |         ^^^^^^^ use of undeclared crate or module `hosting`
   |
help: consider importing this module through its public re-export
   |
10 +     use crate::hosting;
   |

warning: unused import: `crate::front_of_house::hosting`
 --&gt; src/lib.rs:7:5
  |
7 | use crate::front_of_house::hosting;
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |
  = note: `#[warn(unused_imports)]` on by default

For more information about this error, try `rustc --explain E0433`.
warning: `restaurant` (lib) generated 1 warning
error: could not compile `restaurant` (lib) due to 1 previous error; 1 warning emitted
</code></pre>
<p>LÆ°u Ã½ ráº±ng cÃ²n cÃ³ má»™t cáº£nh bÃ¡o ráº±ng <code>use</code> khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng trong scope
cá»§a nÃ³! Äá»ƒ sá»­a váº¥n Ä‘á» nÃ y, di chuyá»ƒn <code>use</code> trong module <code>customer</code> ná»¯a, hoáº·c
tham chiáº¿u Ä‘áº¿n Ä‘Æ°á»ng dáº«n táº¯t trong module cha vá»›i <code>super::hosting</code> trong module
con <code>customer</code>.</p>
<h3 id="táº¡o-cÃ¡c-use-paths-theo-phong-cÃ¡ch-idiomatic"><a class="header" href="#táº¡o-cÃ¡c-use-paths-theo-phong-cÃ¡ch-idiomatic">Táº¡o cÃ¡c <code>use</code> Paths theo phong cÃ¡ch idiomatic</a></h3>
<p>Trong Listing 7-11, báº¡n cÃ³ thá»ƒ Ä‘Ã£ tháº¯c máº¯c táº¡i sao chÃºng ta chá»‰ Ä‘á»‹nh <code>use crate::front_of_house::hosting</code> vÃ  sau Ä‘Ã³ gá»i <code>hosting::add_to_waitlist</code> trong
<code>eat_at_restaurant</code> thay vÃ¬ chá»‰ Ä‘á»‹nh Ä‘Æ°á»ng dáº«n <code>use</code> Ä‘áº¿n hÃ m <code>add_to_waitlist</code>
Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c káº¿t quáº£ giá»‘ng nhÆ° trong Listing 7-13.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground test_harness">mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}
    }
}

use crate::front_of_house::hosting::add_to_waitlist;

pub fn eat_at_restaurant() {
    add_to_waitlist();
}</code></pre>
<p><span class="caption">Listing 7-13: ÄÆ°a hÃ m <code>add_to_waitlist</code> vÃ o scope vá»›i
<code>use</code>, Ä‘iá»u nÃ y khÃ´ng thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng</span></p>
<p>Máº·c dÃ¹ cáº£ Listing 7-11 vÃ  7-13 Ä‘á»u Ä‘áº¡t Ä‘Æ°á»£c cÃ¹ng má»™t nhiá»‡m vá»¥, Listing 7-11 lÃ 
cÃ¡ch há»£p lá»‡ Ä‘á»ƒ Ä‘Æ°a má»™t hÃ m vÃ o scope vá»›i <code>use</code>. ÄÆ°a module cha cá»§a hÃ m vÃ o scope
vá»›i <code>use</code> cÃ³ nghÄ©a lÃ  chÃºng ta pháº£i chá»‰ Ä‘á»‹nh module cha khi gá»i hÃ m. Chá»‰ Ä‘á»‹nh
module cha khi gá»i hÃ m lÃ m rÃµ rÃ ng ráº±ng hÃ m khÃ´ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a cá»¥c bá»™ trong
lÃºc váº«n giáº£m thiá»ƒu sá»± láº·p láº¡i cá»§a Ä‘Æ°á»ng dáº«n Ä‘áº§y Ä‘á»§. MÃ£ trong Listing 7-13 khÃ´ng
rÃµ rÃ ng vá» nÆ¡i <code>add_to_waitlist</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a.</p>
<p>Máº·t khÃ¡c, khi Ä‘Æ°a vÃ o struct, enum, vÃ  cÃ¡c má»¥c khÃ¡c vá»›i <code>use</code>, há»£p lÃ½ lÃ  chá»‰
Ä‘á»‹nh Ä‘Æ°á»ng dáº«n Ä‘áº§y Ä‘á»§. Listing 7-14 cho tháº¥y cÃ¡ch há»£p lÃ½ Ä‘á»ƒ Ä‘Æ°a struct <code>HashMap</code>
cá»§a thÆ° viá»‡n chuáº©n vÃ o scope cá»§a má»™t binary crate.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::collections::HashMap;

fn main() {
    let mut map = HashMap::new();
    map.insert(1, 2);
}</code></pre></pre>
<p><span class="caption">Listing 7-14: ÄÆ°a <code>HashMap</code> vÃ o scope má»™t cÃ¡ch há»£p lÃ½</span></p>
<p>KhÃ´ng cÃ³ lÃ½ do nÃ o máº¡nh máº½ Ä‘áº±ng sau quy táº¯c nÃ y: nÃ³ chá»‰ lÃ  quy Æ°á»›c Ä‘Ã£ xuáº¥t hiá»‡n
vÃ  má»i ngÆ°á»i Ä‘Ã£ quen vá»›i viá»‡c Ä‘á»c vÃ  viáº¿t mÃ£ Rust theo cÃ¡ch nÃ y.</p>
<p>Ngoáº¡i lá»‡ cho quy táº¯c nÃ y lÃ  náº¿u chÃºng ta Ä‘Æ°a hai má»¥c cÃ¹ng tÃªn vÃ o scope vá»›i
cÃ¢u lá»‡nh <code>use</code>, vÃ¬ Rust khÃ´ng cho phÃ©p Ä‘iá»u Ä‘Ã³. Listing 7-15 cho tháº¥y cÃ¡ch Ä‘á»ƒ
Ä‘Æ°a hai loáº¡i <code>Result</code> vÃ o scope mÃ  cÃ¹ng tÃªn nhÆ°ng module cha khÃ¡c nhau vÃ  cÃ¡ch
tham chiáº¿u Ä‘áº¿n chÃºng.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">use std::fmt;
use std::io;

fn function1() -&gt; fmt::Result {
    // --snip--
<span class="boring">    Ok(())
</span>}

fn function2() -&gt; io::Result&lt;()&gt; {
    // --snip--
<span class="boring">    Ok(())
</span>}</code></pre>
<p><span class="caption">Listing 7-15: ÄÆ°a hai loáº¡i cÃ¹ng tÃªn vÃ o scope cÃ¹ng má»™t
lÃºc yÃªu cáº§u sá»­ dá»¥ng module cha cá»§a chÃºng.</span></p>
<p>NhÆ° báº¡n cÃ³ thá»ƒ tháº¥y, sá»­ dá»¥ng module cha Ä‘á»ƒ phÃ¢n biá»‡t hai loáº¡i <code>Result</code>. Náº¿u
thay vÃ¬ Ä‘Ã³ chÃºng ta chá»‰ Ä‘á»‹nh <code>use std::fmt::Result</code> vÃ  <code>use std::io::Result</code>,
chÃºng ta sáº½ cÃ³ hai loáº¡i <code>Result</code> trong cÃ¹ng má»™t scope vÃ  Rust sáº½ khÃ´ng biáº¿t
chÃºng ta muá»‘n loáº¡i nÃ o khi chÃºng ta sá»­ dá»¥ng <code>Result</code>.</p>
<hr />
<h3 id="cung-cáº¥p-tÃªn-má»›i-báº±ng-tá»«-khÃ³a-as"><a class="header" href="#cung-cáº¥p-tÃªn-má»›i-báº±ng-tá»«-khÃ³a-as">Cung cáº¥p tÃªn má»›i báº±ng tá»« khÃ³a <code>as</code></a></h3>
<p>CÃ³ má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» Ä‘Æ°a hai loáº¡i cÃ¹ng tÃªn vÃ o cÃ¹ng má»™t scope
vá»›i <code>use</code>: sau Ä‘Æ°á»ng dáº«n, chÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh <code>as</code> vÃ  má»™t tÃªn cá»¥c bá»™ má»›i,
hoáº·c <em>bÃ­ danh</em>, cho loáº¡i. Listing 7-16 cho tháº¥y má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ viáº¿t code trong
Listing 7-15 báº±ng cÃ¡ch Ä‘á»•i tÃªn má»™t trong hai loáº¡i <code>Result</code> sá»­ dá»¥ng <code>as</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">use std::fmt::Result;
use std::io::Result as IoResult;

fn function1() -&gt; Result {
    // --snip--
<span class="boring">    Ok(())
</span>}

fn function2() -&gt; IoResult&lt;()&gt; {
    // --snip--
<span class="boring">    Ok(())
</span>}</code></pre>
<p><span class="caption">Listing 7-16: Äá»•i tÃªn má»™t loáº¡i khi nÃ³ Ä‘Æ°á»£c Ä‘Æ°a vÃ o scope
sá»­ dá»¥ng tá»« khÃ³a <code>as</code></span></p>
<p>Trong cÃ¢u lá»‡nh <code>use</code> thá»© hai, chÃºng ta Ä‘Ã£ chá»n tÃªn má»›i <code>IoResult</code> cho loáº¡i
<code>std::io::Result</code>, nÃ³ sáº½ khÃ´ng xung Ä‘á»™t vá»›i <code>Result</code> tá»« <code>std::fmt</code> mÃ  chÃºng ta
cÅ©ng Ä‘Ã£ Ä‘Æ°a vÃ o scope. Listing 7-15 vÃ  Listing 7-16 Ä‘Æ°á»£c xem lÃ  tiÃªu chuáº©n, vÃ¬
váº­y báº¡n cÃ³ thá»ƒ chá»n má»™t trong hai!</p>
<h3 id="re-exporting-names-with-pub-use"><a class="header" href="#re-exporting-names-with-pub-use">Re-exporting Names with <code>pub use</code></a></h3>
<p>Khi chÃºng ta dÃ¹ng tá»« khÃ³a <code>use</code>, tÃªn má»›i Ä‘Æ°á»£c Ä‘Æ°a vÃ o chá»‰ hiá»‡n diá»‡n bÃªn
trong scope mÃ  <code>use</code> Ä‘Æ°á»£c gá»i. Äá»ƒ cho phÃ©p code bÃªn ngoÃ i cÃ³ thá»ƒ gá»i Ä‘áº¿n tÃªn Ä‘Ã³
chÃºng ta cÃ³ thá»ƒ káº¿t há»£p <code>pub</code> vÃ  <code>use</code>. Ká»¹ thuáº­t nÃ y Ä‘Æ°á»£c gá»i lÃ 
<em>export láº¡i(re-exporting)</em> vÃ¬ chÃºng ta Ä‘ang Ä‘Æ°a má»™t item vÃ o scope nhÆ°ng cÅ©ng
lÃ m cho item Ä‘Ã³ cÃ³ sáºµn cho ngÆ°á»i khÃ¡c Ä‘á»ƒ Ä‘Æ°a vÃ o scope cá»§a há».</p>
<p>Listing 7-17 cho tháº¥y code trong Listing 7-11 vá»›i <code>use</code> trong module gá»‘c Ä‘Æ°á»£c
Ä‘á»•i thÃ nh <code>pub use</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground test_harness">mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}
    }
}

pub use crate::front_of_house::hosting;

pub fn eat_at_restaurant() {
    hosting::add_to_waitlist();
}</code></pre>
<p><span class="caption">Listing 7-17: LÃ m cho má»™t tÃªn cÃ³ sáºµn cho báº¥t ká»³ code nÃ o
Ä‘á»ƒ sá»­ dá»¥ng tá»« má»™t scope má»›i vá»›i <code>pub use</code></span></p>
<p>TrÆ°á»›c khi thay Ä‘á»•i nÃ y diá»…n ra, code bÃªn ngoÃ i pháº£i gá»i hÃ m <code>add_to_waitlist</code>
báº±ng cÃ¡ch sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n
<code>restaurant::front_of_house::hosting::add_to_waitlist()</code>. BÃ¢y giá» vÃ¬ <code>pub use</code>
Ä‘Ã£ export láº¡i module <code>hosting</code> tá»« module gá»‘c, code bÃªn ngoÃ i cÃ³ thá»ƒ sá»­ dá»¥ng
Ä‘Æ°á»ng dáº«n <code>restaurant::hosting::add_to_waitlist()</code> thay vÃ¬ Ä‘Æ°á»ng dáº«n cÅ©.</p>
<p>Re-exporting ráº¥t há»¯u Ã­ch khi cáº¥u trÃºc bÃªn trong code cá»§a báº¡n khÃ¡c vá»›i cÃ¡ch
láº­p trÃ¬nh viÃªn gá»i code cá»§a báº¡n sáº½ nghÄ© vá» domain. VÃ­ dá»¥, trong thÃ­ dá»¥ nhÃ  hÃ ng
á»Ÿ trÃªn, ngÆ°á»i Ä‘iá»u hÃ nh nhÃ  hÃ ng nghÄ© vá» â€œfront of houseâ€ vÃ  â€œback of houseâ€.
NhÆ°ng khÃ¡ch hÃ ng Ä‘áº¿n nhÃ  hÃ ng cÃ³ thá»ƒ khÃ´ng nghÄ© vá» cÃ¡c pháº§n cá»§a nhÃ  hÃ ng theo
cÃ¡ch Ä‘Ã³. Vá»›i <code>pub use</code>, chÃºng ta cÃ³ thá»ƒ viáº¿t code cá»§a mÃ¬nh vá»›i má»™t cáº¥u trÃºc
nhÆ°ng sáº½ cho tháº¥y má»™t cáº¥u trÃºc khÃ¡c. Viá»‡c lÃ m nhÆ° váº­y giÃºp code cá»§a chÃºng ta
Ä‘Æ°á»£c tá»• chá»©c tá»‘t cho cáº£ cÃ¡c láº­p trÃ¬nh viÃªn lÃ m viá»‡c trÃªn code cá»§a chÃºng ta vÃ 
cÃ¡c láº­p trÃ¬nh viÃªn gá»i code cá»§a chÃºng ta. ChÃºng ta sáº½ xem má»™t vÃ­ dá»¥ khÃ¡c vá»
<code>pub use</code> vÃ  cÃ¡ch nÃ³ áº£nh hÆ°á»Ÿng Ä‘áº¿n tÃ i liá»‡u cá»§a crate cá»§a báº¡n trong pháº§n
<a href="ch14-02-publishing-to-crates-io.html#exporting-a-convenient-public-api-with-pub-use">â€œExporting a Convenient Public API with <code>pub use</code>â€</a><!-- ignore --> cá»§a Chapter 14.</p>
<h3 id="re-exporting-names-vá»›i-pub-use"><a class="header" href="#re-exporting-names-vá»›i-pub-use">Re-exporting Names vá»›i <code>pub use</code></a></h3>
<p>Trong chÆ°Æ¡ng 2, chÃºng ta Ä‘Ã£ viáº¿t má»™t project Ä‘oÃ¡n sá»‘ sá»­ dá»¥ng má»™t package bÃªn
ngoÃ i gá»i lÃ  <code>rand</code> Ä‘á»ƒ láº¥y ra cÃ¡c sá»‘ ngáº«u nhiÃªn. Äá»ƒ sá»­ dá»¥ng <code>rand</code> trong
project cá»§a chÃºng ta, chÃºng ta Ä‘Ã£ thÃªm dÃ²ng nÃ y vÃ o <em>Cargo.toml</em>:</p>
<!-- When updating the version of `rand` used, also update the version of
`rand` used in these files so they all match:
* ch02-00-guessing-game-tutorial.md
* ch14-03-cargo-workspaces.md
-->
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">rand = "0.8.5"
</code></pre>
<p>ThÃªm <code>rand</code> lÃ m má»™t dependency trong <em>Cargo.toml</em> cho biáº¿t Cargo sáº½ táº£i vá»
package <code>rand</code> vÃ  báº¥t ká»³ dependencies nÃ o tá»« <a href="https://crates.io/">crates.io</a> vÃ 
cho phÃ©p <code>rand</code> cÃ³ sáºµn Ä‘á»ƒ dÃ¹ng trong project cá»§a chÃºng ta.</p>
<p>Sau Ä‘Ã³, Ä‘á»ƒ cho phÃ©p <code>rand</code> cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng trong scope cá»§a package,
chÃºng ta Ä‘Ã£ thÃªm má»™t dÃ²ng <code>use</code> báº¯t Ä‘áº§u vá»›i tÃªn cá»§a crate, <code>rand</code>, vÃ  liá»‡t kÃª
nhá»¯ng item mÃ  chÃºng ta muá»‘n cho phÃ©p sá»­ dá»¥ng trong scope. Nhá»› láº¡i trong pháº§n
<a href="ch02-00-guessing-game-tutorial.html#generating-a-random-number">â€œGenerating a Random Numberâ€</a><!-- ignore --> cá»§a chÆ°Æ¡ng 2, chÃºng ta Ä‘Ã£
import trait <code>Rng</code> vÃ o scope vÃ  gá»i hÃ m <code>rand::thread_rng</code>:</p>
<pre><code class="language-rust ignore"><span class="boring">use std::io;
</span><span class="boring">
</span>use rand::Rng;

fn main() {
<span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span>    let secret_number = rand::thread_rng().gen_range(1..=100);
<span class="boring">
</span><span class="boring">    println!("The secret number is: {secret_number}");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span><span class="boring">        .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">    println!("You guessed: {guess}");
</span>}</code></pre>
<p>ThÃ nh viÃªn cá»§a cá»™ng Ä‘á»“ng Rust Ä‘Ã£ lÃ m ráº¥t nhiá»u package cÃ³ sáºµn táº¡i
<a href="https://crates.io/">crates.io</a>, vÃ  Ä‘á»ƒ sá»­ dá»¥ng báº¥t ká»³ package nÃ o trong
package cá»§a báº¡n, báº¡n chá»‰ cáº§n lÃ m nhá»¯ng bÆ°á»›c tÆ°Æ¡ng tá»± nhÆ° trÃªn: liá»‡t kÃª chÃºng
trong file <em>Cargo.toml</em> cá»§a package vÃ  sá»­ dá»¥ng <code>use</code> Ä‘á»ƒ import cÃ¡c item tá»«
package Ä‘Ã³ vÃ o scope.</p>
<p>LÆ°u Ã½ ráº±ng thÆ° viá»‡n chuáº©n <code>std</code> cÅ©ng lÃ  má»™t crate bÃªn ngoÃ i package cá»§a chÃºng
ta. VÃ¬ thÆ° viá»‡n chuáº©n Ä‘Æ°á»£c cung cáº¥p cÃ¹ng vá»›i ngÃ´n ngá»¯ Rust, chÃºng ta khÃ´ng cáº§n
pháº£i thay Ä‘á»•i <em>Cargo.toml</em> Ä‘á»ƒ bao gá»“m <code>std</code>. NhÆ°ng chÃºng ta cáº§n pháº£i tham chiáº¿u
Ä‘áº¿n nÃ³ vá»›i <code>use</code> Ä‘á»ƒ import cÃ¡c item tá»« Ä‘Ã³ vÃ o scope cá»§a package cá»§a chÃºng ta.
VÃ­ dá»¥, vá»›i <code>HashMap</code> chÃºng ta sáº½ sá»­ dá»¥ng dÃ²ng nÃ y:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::collections::HashMap;
<span class="boring">}</span></code></pre></pre>
<p>ÄÃ¢y lÃ  má»™t Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i báº¯t Ä‘áº§u vá»›i <code>std</code>, tÃªn cá»§a crate thÆ° viá»‡n chuáº©n.</p>
<h3 id="sá»­-dá»¥ng-nested-paths-Ä‘á»ƒ-lÃ m-gá»n-cÃ¡c-danh-sÃ¡ch-use-lá»›n"><a class="header" href="#sá»­-dá»¥ng-nested-paths-Ä‘á»ƒ-lÃ m-gá»n-cÃ¡c-danh-sÃ¡ch-use-lá»›n">Sá»­ dá»¥ng Nested Paths Ä‘á»ƒ lÃ m gá»n cÃ¡c danh sÃ¡ch <code>use</code> lá»›n</a></h3>
<p>Náº¿u chÃºng ta sá»­ dá»¥ng nhiá»u item Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong cÃ¹ng má»™t crate hoáº·c cÃ¹ng
má»™t module, viá»‡c liá»‡t kÃª má»—i item trÃªn má»™t dÃ²ng riÃªng sáº½ chiáº¿m ráº¥t nhiá»u khÃ´ng
gian dá»c trong file cá»§a chÃºng ta. VÃ­ dá»¥, hai dÃ²ng <code>use</code> nÃ y chÃºng ta cÃ³ trong
game Ä‘oÃ¡n sá»‘ á»Ÿ Listing 2-4 import cÃ¡c item tá»« <code>std</code> vÃ o scope:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use rand::Rng;
</span>// --snip--
use std::cmp::Ordering;
use std::io;
// --snip--
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    let secret_number = rand::thread_rng().gen_range(1..=100);
</span><span class="boring">
</span><span class="boring">    println!("The secret number is: {secret_number}");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span><span class="boring">        .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">    println!("You guessed: {guess}");
</span><span class="boring">
</span><span class="boring">    match guess.cmp(&amp;secret_number) {
</span><span class="boring">        Ordering::Less =&gt; println!("Too small!"),
</span><span class="boring">        Ordering::Greater =&gt; println!("Too big!"),
</span><span class="boring">        Ordering::Equal =&gt; println!("You win!"),
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Thay vÃ¬ Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n lá»“ng nhau Ä‘á»ƒ import cÃ¡c item
cÃ¹ng vÃ o scope trong má»™t dÃ²ng. ChÃºng ta lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh pháº§n
chung cá»§a Ä‘Æ°á»ng dáº«n, theo sau bá»Ÿi hai dáº¥u hai cháº¥m, vÃ  sau Ä‘Ã³ lÃ  dáº¥u ngoáº·c nhá»n
xung quanh má»™t danh sÃ¡ch cÃ¡c pháº§n cá»§a Ä‘Æ°á»ng dáº«n khÃ¡c nhau, nhÆ° trong Listing
7-18.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use rand::Rng;
</span>// --snip--
use std::{cmp::Ordering, io};
// --snip--
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    let secret_number = rand::thread_rng().gen_range(1..=100);
</span><span class="boring">
</span><span class="boring">    println!("The secret number is: {secret_number}");
</span><span class="boring">
</span><span class="boring">    println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">    let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">    io::stdin()
</span><span class="boring">        .read_line(&amp;mut guess)
</span><span class="boring">        .expect("Failed to read line");
</span><span class="boring">
</span><span class="boring">    let guess: u32 = guess.trim().parse().expect("Please type a number!");
</span><span class="boring">
</span><span class="boring">    println!("You guessed: {guess}");
</span><span class="boring">
</span><span class="boring">    match guess.cmp(&amp;secret_number) {
</span><span class="boring">        Ordering::Less =&gt; println!("Too small!"),
</span><span class="boring">        Ordering::Greater =&gt; println!("Too big!"),
</span><span class="boring">        Ordering::Equal =&gt; println!("You win!"),
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 7-18: Khai bÃ¡o má»™t Ä‘Æ°á»ng dáº«n lá»“ng nhau Ä‘á»ƒ import
nhiá»u item cÃ¹ng vá»›i cÃ¹ng má»™t tiá»n tá»‘ vÃ o scope</span></p>
<p>Trong cÃ¡c chÆ°Æ¡ng trÃ¬nh lá»›n hÆ¡n, viá»‡c import nhiá»u item tá»« cÃ¹ng má»™t crate hoáº·c
module sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n lá»“ng nhau cÃ³ thá»ƒ giáº£m sá»‘ lÆ°á»£ng cÃ¡c dÃ²ng <code>use</code> riÃªng
biá»‡t ráº¥t nhiá»u.</p>
<p>ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng má»™t Ä‘Æ°á»ng dáº«n lá»“ng nhau á»Ÿ báº¥t ká»³ má»©c Ä‘á»™ nÃ o trong má»™t
Ä‘Æ°á»ng dáº«n, Ä‘iá»u nÃ y ráº¥t há»¯u Ã­ch khi káº¿t há»£p hai dÃ²ng <code>use</code> chia sáº» má»™t Ä‘Æ°á»ng
dáº«n con. VÃ­ dá»¥, Listing 7-19 cho tháº¥y hai dÃ²ng <code>use</code>: má»™t trong Ä‘Ã³ import
<code>std::io</code> vÃ o scope vÃ  má»™t trong Ä‘Ã³ import <code>std::io::Write</code> vÃ o scope.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">use std::io;
use std::io::Write;</code></pre>
<p><span class="caption">Listing 7-19: Hai dÃ²ng <code>use</code> trong Ä‘Ã³ má»™t lÃ  má»™t Ä‘Æ°á»ng
dáº«n con cá»§a Ä‘Æ°á»ng dáº«n khÃ¡c</span></p>
<p>Pháº§n chung cá»§a hai Ä‘Æ°á»ng dáº«n nÃ y lÃ  <code>std::io</code>, vÃ  Ä‘Ã³ lÃ  Ä‘Æ°á»ng dáº«n Ä‘áº§u tiÃªn
hoÃ n chá»‰nh. Äá»ƒ káº¿t há»£p hai Ä‘Æ°á»ng dáº«n nÃ y thÃ nh má»™t dÃ²ng <code>use</code>, chÃºng ta cÃ³ thá»ƒ
sá»­ dá»¥ng <code>self</code> trong Ä‘Æ°á»ng dáº«n lá»“ng nhau, nhÆ° trong Listing 7-20.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">use std::io::{self, Write};</code></pre>
<p><span class="caption">Listing 7-20: Káº¿t há»£p Ä‘Æ°á»ng dáº«n trong Listing 7-19 thÃ nh
má»™t dÃ²ng <code>use</code></span></p>
<p>DÃ²ng nÃ y import <code>std::io</code> vÃ  <code>std::io::Write</code> vÃ o scope.</p>
<h3 id="toÃ¡n-tá»­-glob"><a class="header" href="#toÃ¡n-tá»­-glob">ToÃ¡n tá»­ Glob</a></h3>
<p>Náº¿u chÃºng ta muá»‘n import <em>táº¥t cáº£</em> cÃ¡c má»¥c cÃ´ng khai Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong má»™t
Ä‘Æ°á»ng dáº«n vÃ o scope, chÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh Ä‘Æ°á»ng dáº«n Ä‘Ã³ theo sau bá»Ÿi toÃ¡n
tá»­ <code>*</code> glob:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::collections::*;
<span class="boring">}</span></code></pre></pre>
<p>DÃ²ng <code>use</code> nÃ y import táº¥t cáº£ cÃ¡c má»¥c cÃ´ng khai Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong
<code>std::collections</code> vÃ o scope hiá»‡n táº¡i. HÃ£y cáº©n tháº­n khi sá»­ dá»¥ng toÃ¡n tá»­ glob!
ToÃ¡n tá»­ glob cÃ³ thá»ƒ lÃ m cho viá»‡c biáº¿t Ä‘Æ°á»£c tÃªn nÃ o Ä‘ang trong scope vÃ  nÆ¡i má»™t
tÃªn Ä‘Æ°á»£c sá»­ dá»¥ng trong chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trá»Ÿ nÃªn khÃ³ khÄƒn
hÆ¡n.</p>
<p>ToÃ¡n tá»­ glob thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng khi kiá»ƒm thá»­ Ä‘á»ƒ import táº¥t cáº£ má»i thá»© dÆ°á»›i
kiá»ƒm thá»­ vÃ o module <code>tests</code>; chÃºng ta sáº½ nÃ³i vá» Ä‘iá»u Ä‘Ã³ trong pháº§n
<a href="ch11-01-writing-tests.html#how-to-write-tests">â€œHow to Write Testsâ€</a><!-- ignore --> trong ChÆ°Æ¡ng 11. ToÃ¡n tá»­
glob cÅ©ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘Ã´i khi lÃ  má»™t pháº§n cá»§a pattern prelude: xem
<a href="../std/prelude/index.html#other-preludes">documentation cá»§a thÆ° viá»‡n chuáº©n</a><!-- ignore --> Ä‘á»ƒ biáº¿t thÃªm thÃ´ng tin vá» pattern Ä‘Ã³.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="tÃ¡ch-modules-ra-cÃ¡c-file-khÃ¡c-nhau"><a class="header" href="#tÃ¡ch-modules-ra-cÃ¡c-file-khÃ¡c-nhau">TÃ¡ch Modules ra cÃ¡c file khÃ¡c nhau</a></h2>
<p>Cho Ä‘áº¿n nay, táº¥t cáº£ cÃ¡c vÃ­ dá»¥ trong chÆ°Æ¡ng nÃ y Ä‘á»u Ä‘á»‹nh nghÄ©a nhiá»u module
trong má»™t file. Khi cÃ¡c module trá»Ÿ nÃªn lá»›n, báº¡n cÃ³ thá»ƒ muá»‘n di chuyá»ƒn Ä‘á»‹nh
nghÄ©a cá»§a chÃºng sang má»™t file riÃªng Ä‘á»ƒ lÃ m cho code dá»… Ä‘iá»u hÆ°á»›ng hÆ¡n.</p>
<p>Láº¥y vÃ­ dá»¥, hÃ£y báº¯t Ä‘áº§u tá»« code trong Listing 7-17 cÃ³ nhiá»u module nhÃ  hÃ ng.
ChÃºng ta sáº½ trÃ­ch xuáº¥t cÃ¡c module thÃ nh cÃ¡c file thay vÃ¬ Ä‘á»‹nh nghÄ©a táº¥t cáº£ cÃ¡c
module trong file gá»‘c cá»§a crate. Trong trÆ°á»ng há»£p nÃ y, file gá»‘c cá»§a crate lÃ 
<em>src/lib.rs</em>, nhÆ°ng quy trÃ¬nh nÃ y cÅ©ng hoáº¡t Ä‘á»™ng vá»›i binary crate mÃ  file gá»‘c
cá»§a crate lÃ  <em>src/main.rs</em>.</p>
<p>Äáº§u tiÃªn, chÃºng ta sáº½ trÃ­ch xuáº¥t module <code>front_of_house</code> thÃ nh má»™t file riÃªng.
XÃ³a code bÃªn trong dáº¥u ngoáº·c nhá»n cho module <code>front_of_house</code>, chá»‰ Ä‘á»ƒ láº¡i
cÃ¢u lá»‡nh <code>mod front_of_house;</code>, vÃ¬ váº­y <em>src/lib.rs</em> sáº½ chá»©a code nhÆ° trong
Listing 7-21. LÆ°u Ã½ ráº±ng code nÃ y sáº½ khÃ´ng compile cho Ä‘áº¿n khi chÃºng ta táº¡o
file <em>src/front_of_house.rs</em> trong Listing 7-22.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">mod front_of_house;

pub use crate::front_of_house::hosting;

pub fn eat_at_restaurant() {
    hosting::add_to_waitlist();
}</code></pre>
<p><span class="caption">Listing 7-21: Äá»‹nh nghÄ©a module <code>front_of_house</code> mÃ 
thÃ¢n cá»§a nÃ³ sáº½ náº±m trong <em>src/front_of_house.rs</em></span></p>
<p>Tiáº¿p theo, Ä‘áº·t code bÃªn trong dáº¥u ngoáº·c nhá»n vÃ o má»™t file má»›i cÃ³ tÃªn
<em>src/front_of_house.rs</em>, nhÆ° trong Listing 7-22. Compiler sáº½ biáº¿t Ä‘á»ƒ tÃ¬m kiáº¿m
file nÃ y vÃ¬ nÃ³ Ä‘Ã£ gáº·p pháº£i Ä‘á»‹nh nghÄ©a module trong file gá»‘c cá»§a crate vá»›i tÃªn
<code>front_of_house</code>.</p>
<p><span class="filename">Filename: src/front_of_house.rs</span></p>
<pre><code class="language-rust ignore">pub mod hosting {
    pub fn add_to_waitlist() {}
}</code></pre>
<p><span class="caption">Listing 7-22: Äá»‹nh nghÄ©a bÃªn trong module <code>front_of_house</code>
trong <em>src/front_of_house.rs</em></span></p>
<p>LÆ°u Ã½ ráº±ng báº¡n chá»‰ cáº§n load má»™t file vá»›i cÃ¢u lá»‡nh <code>mod</code> <em>má»™t láº§n</em> trong
module tree cá»§a báº¡n. Má»™t khi compiler biáº¿t file nÃ y lÃ  má»™t pháº§n cá»§a project
(vÃ  biáº¿t vá»‹ trÃ­ cá»§a file trong module tree theo trÃ­ cá»§a cÃ¢u lá»‡nh <code>mod</code>), cÃ¡c
file khÃ¡c trong project cá»§a báº¡n sáº½ tham chiáº¿u Ä‘áº¿n code cá»§a file Ä‘Ã£ load sá»­ dá»¥ng
má»™t Ä‘Æ°á»ng dáº«n tá»›i nÆ¡i nÃ³, nhÆ° Ä‘Æ°á»£c Ä‘á» cáº­p trong pháº§n
<a href="ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html">â€œPaths for Referring to an Item in the Module Treeâ€</a><!-- ignore -->.
NÃ³i cÃ¡ch khÃ¡c, <code>mod</code> <em>khÃ´ng</em> lÃ  má»™t cÃ¢u lá»‡nh â€œincludeâ€ mÃ  báº¡n cÃ³ thá»ƒ Ä‘Ã£ tháº¥y
trong cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c.</p>
<p>Tiáº¿p theo, chÃºng ta sáº½ trÃ­ch xuáº¥t module <code>hosting</code> ra má»™t file riÃªng. QuÃ¡ trÃ¬nh
khÃ¡c má»™t chÃºt vÃ¬ <code>hosting</code> lÃ  má»™t module con cá»§a <code>front_of_house</code>, khÃ´ng pháº£i
lÃ  module gá»‘c. ChÃºng ta sáº½ Ä‘áº·t file cho <code>hosting</code> vÃ o má»™t thÆ° má»¥c má»›i cÃ³ tÃªn
lÃ  module cha cá»§a nÃ³ trong module tree, trong trÆ°á»ng há»£p nÃ y
<em>src/front_of_house/</em>.</p>
<p>Äá»ƒ báº¯t Ä‘áº§u di chuyá»ƒn <code>hosting</code>, chÃºng ta sáº½ thay Ä‘á»•i <em>src/front_of_house.rs</em>
Ä‘á»ƒ chá»‰ chá»©a Ä‘á»‹nh nghÄ©a cá»§a module <code>hosting</code>:</p>
<p><span class="filename">Filename: src/front_of_house.rs</span></p>
<pre><code class="language-rust ignore">pub mod hosting;</code></pre>
<p>Sau Ä‘Ã³, chÃºng ta sáº½ táº¡o má»™t thÆ° má»¥c <em>src/front_of_house</em> vÃ  má»™t file
<em>hosting.rs</em> Ä‘á»ƒ chá»©a cÃ¡c Ä‘á»‹nh nghÄ©a Ä‘Æ°á»£c táº¡o trong module <code>hosting</code>:</p>
<p><span class="filename">Filename: src/front_of_house/hosting.rs</span></p>
<pre><code class="language-rust ignore">pub fn add_to_waitlist() {}</code></pre>
<p>Náº¿u chÃºng ta Ä‘áº·t <em>hosting.rs</em> trong thÆ° má»¥c <em>src</em>, compiler sáº½ mong Ä‘á»£i code
<em>hosting.rs</em> náº±m trong module <code>hosting</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a á»Ÿ crate root, chá»›
khÃ´ng pháº£i lÃ  má»™t module con cá»§a module <code>front_of_house</code>. Quy táº¯c cá»§a
compiler vá» viá»‡c kiá»ƒm tra cÃ¡c file Ä‘á»ƒ tÃ¬m code cá»§a cÃ¡c module cÃ³ nghÄ©a lÃ  cÃ¡c
thÆ° má»¥c vÃ  cÃ¡c file sáº½ gáº§n vá»›i module tree hÆ¡n.</p>
<section class="note" aria-role="note">
<h3 id="alternate-file-paths"><a class="header" href="#alternate-file-paths">Alternate File Paths</a></h3>
<p>Äáº¿n Ä‘Ã¢y chÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu vá» Ä‘Æ°á»ng dáº«n file mÃ  Rust compiler sá»­ dá»¥ng,
nhÆ°ng Rust cÅ©ng há»— trá»£ má»™t kiá»ƒu cÅ© hÆ¡n cá»§a Ä‘Æ°á»ng dáº«n file. Vá»›i má»™t module
Ä‘Æ°á»£c Ä‘áº·t tÃªn lÃ  <code>front_of_house</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a á»Ÿ crate root, compiler sáº½
tÃ¬m code cá»§a module trong:</p>
<ul>
<li><em>src/front_of_house.rs</em> (nhÆ° chÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu)</li>
<li><em>src/front_of_house/mod.rs</em> (kiá»ƒu cÅ©, Ä‘Æ°á»ng dáº«n váº«n Ä‘Æ°á»£c há»— trá»£)</li>
</ul>
<p>Vá»›i má»™t module Ä‘Æ°á»£c Ä‘áº·t tÃªn lÃ  <code>hosting</code> lÃ  má»™t module con cá»§a
<code>front_of_house</code>, compiler sáº½ tÃ¬m code cá»§a module trong:</p>
<ul>
<li><em>src/front_of_house/hosting.rs</em> (nhÆ° chÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu)</li>
<li><em>src/front_of_house/hosting/mod.rs</em> (kiá»ƒu cÅ©, Ä‘Æ°á»ng dáº«n váº«n Ä‘Æ°á»£c há»— trá»£)</li>
</ul>
<p>Náº¿u báº¡n sá»­ dá»¥ng cáº£ hai kiá»ƒu Ä‘Æ°á»ng dáº«n cho cÃ¹ng má»™t module, báº¡n sáº½ nháº­n Ä‘Æ°á»£c
má»™t lá»—i tá»« compiler. Sá»­ dá»¥ng cáº£ hai kiá»ƒu Ä‘Æ°á»ng dáº«n cho cÃ¡c module khÃ¡c nhau
trong cÃ¹ng má»™t dá»± Ã¡n Ä‘Æ°á»£c cho phÃ©p, nhÆ°ng cÃ³ thá»ƒ gÃ¢y khÃ³ hiá»ƒu cho nhá»¯ng ngÆ°á»i
lÃ m viá»‡c trÃªn dá»± Ã¡n.</p>
<p>Äiá»ƒm yáº¿u chÃ­nh cá»§a kiá»ƒu Ä‘Æ°á»ng dáº«n sá»­ dá»¥ng cÃ¡c file cÃ³ tÃªn <em>mod.rs</em> lÃ  dá»± Ã¡n
cá»§a báº¡n cÃ³ thá»ƒ káº¿t thÃºc vá»›i nhiá»u file cÃ³ tÃªn <em>mod.rs</em>, cÃ³ thá»ƒ gÃ¢y khÃ³ hiá»ƒu
khi báº¡n má»Ÿ chÃºng cÃ¹ng lÃºc trong trÃ¬nh soáº¡n tháº£o.</p>
</section>
<p>ChÃºng ta Ä‘Ã£ chuyá»ƒn code cá»§a má»—i module vÃ o má»™t file riÃªng biá»‡t, vÃ  cÃ¢y module
váº«n giá»¯ nguyÃªn. CÃ¡c lá»i gá»i hÃ m trong <code>eat_at_restaurant</code> váº«n hoáº¡t Ä‘á»™ng mÃ  khÃ´ng
cáº§n sá»­a Ä‘á»•i gÃ¬, ngay cáº£ khi cÃ¡c Ä‘á»‹nh nghÄ©a Ä‘Æ°á»£c Ä‘áº·t trong cÃ¡c file khÃ¡c nhau.
Ká»¹ thuáº­t nÃ y cho phÃ©p báº¡n chuyá»ƒn cÃ¡c module sang cÃ¡c file má»›i khi chÃºng tÄƒng
kÃ­ch thÆ°á»›c.</p>
<p>LÆ°u Ã½ ráº±ng cÃ¢u lá»‡nh <code>pub use crate::front_of_house::hosting</code> trong <em>src/lib.rs</em>
cÅ©ng khÃ´ng thay Ä‘á»•i, vÃ  <code>use</code> cÅ©ng khÃ´ng áº£nh hÆ°á»Ÿng gÃ¬ Ä‘áº¿n viá»‡c file nÃ o Ä‘Æ°á»£c
biÃªn dá»‹ch lÃ  má»™t pháº§n cá»§a crate. CÃ¢u lá»‡nh <code>mod</code> khai bÃ¡o module, vÃ  Rust sáº½ tÃ¬m
file cÃ³ cÃ¹ng tÃªn vá»›i module Ä‘á»ƒ tÃ¬m code cá»§a module Ä‘Ã³.</p>
<h2 id="summary-3"><a class="header" href="#summary-3">Summary</a></h2>
<p>Rust cho phÃ©p báº¡n chia má»™t package thÃ nh nhiá»u crate vÃ  má»™t crate thÃ nh cÃ¡c
module Ä‘á»ƒ báº¡n cÃ³ thá»ƒ tham chiáº¿u Ä‘áº¿n cÃ¡c item Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong má»™t module
tá»« má»™t module khÃ¡c. Báº¡n cÃ³ thá»ƒ lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh Ä‘Æ°á»ng dáº«n tuyá»‡t
Ä‘á»‘i hoáº·c tÆ°Æ¡ng Ä‘á»‘i. Nhá»¯ng Ä‘Æ°á»ng dáº«n nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘Æ°a vÃ o scope báº±ng
lá»‡nh <code>use</code> Ä‘á»ƒ báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng má»™t Ä‘Æ°á»ng dáº«n ngáº¯n hÆ¡n cho nhiá»u láº§n sá»­ dá»¥ng
cá»§a item trong scope Ä‘Ã³. Code cá»§a module máº·c Ä‘á»‹nh lÃ  private, nhÆ°ng báº¡n cÃ³
thá»ƒ lÃ m cÃ¡c item public báº±ng cÃ¡ch thÃªm tá»« khÃ³a <code>pub</code>.</p>
<p>Trong chÆ°Æ¡ng tiáº¿p theo, chÃºng ta sáº½ xem má»™t sá»‘ cáº¥u trÃºc dá»¯ liá»‡u táº­p há»£p trong
thÆ° viá»‡n chuáº©n mÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng trong code cá»§a báº¡n Ä‘Æ°á»£c tá»• chá»©c má»™t cÃ¡ch
rÃµ rÃ ng.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nhá»¯ng-táº­p-há»£p-thÃ´ng-dá»¥ng"><a class="header" href="#nhá»¯ng-táº­p-há»£p-thÃ´ng-dá»¥ng">Nhá»¯ng táº­p há»£p thÃ´ng dá»¥ng</a></h1>
<p>ThÆ° viá»‡n chuáº©n cá»§a Rust bao gá»“m má»™t lÆ°á»£ng lá»›n cáº¥u trÃºc dá»¯ liá»‡u ráº¥t há»¯u dá»¥ng Ä‘Æ°á»£c gá»i lÃ 
<em>táº­p há»£p</em>. Háº§u háº¿t cÃ¡c kiá»ƒu dá»¯ liá»‡u khÃ¡c Ä‘áº¡i diá»‡n cho má»™t giÃ¡ trá»‹ cá»¥ thá»ƒ nÃ o Ä‘Ã³, nhÆ°ng
nhá»¯ng táº­p há»£p nÃ y cÃ³ thá»ƒ chá»©a nhiá»u loáº¡i giÃ¡ trá»‹. KhÃ´ng giá»‘ng nhÆ° máº£ng (array) Ä‘Æ°á»£c dá»±ng sáºµn vÃ  loáº¡i dá»¯ liá»‡u tÃ­ch há»£p (tuple), dá»¯ liá»‡u mÃ  cÃ¡c táº­p há»£p nÃ y trá» tá»›i Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn vÃ¹ng heap, cÃ³ nghÄ©a lÃ  táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch sáº½ khÃ´ng cáº§n pháº£i biáº¿t lÆ°á»£ng dá»¯ liá»‡u nhÆ° tháº¿ nÃ o, nÃ³ cÃ³ thá»ƒ tÄƒng lÃªn hoáº·c giáº£m láº¡i khi cháº¡y chÆ°Æ¡ng trÃ¬nh. Má»—i loáº¡i táº­p há»£p cÃ³ nhá»¯ng kháº£ nÄƒng, chi phÃ­ tiÃªu tá»‘n tÃ i nguyÃªn khÃ¡c nhau, vÃ  Ä‘á»ƒ chá»n Ä‘Æ°á»£c má»™t loáº¡i phÃ¹ há»£p vá»›i tÃ¬nh huá»‘ng sá»­ dá»¥ng cá»§a báº¡n lÃ  cáº£ má»™t ká»¹ nÄƒng báº¡n cáº§n pháº£i phÃ¡t triá»ƒn liÃªn tá»¥c theo thá»i gian. Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ tháº£o luáº­n vá» ba loáº¡i táº­p há»£p Ä‘Æ°á»£c sá»­ dá»¥ng ráº¥t thÆ°á»ng xuyÃªn trong cÃ¡c chÆ°Æ¡ng trÃ¬nh Rust:</p>
<ul>
<li>Má»™t <em>vector</em> cho phÃ©p báº¡n lÆ°u trá»¯ má»™t sá»‘ giÃ¡ trá»‹ cÃ³ thá»ƒ thay Ä‘á»•i náº±m gáº§n cáº¡nh nhau.</li>
<li>Má»™t <em>string</em> lÃ  má»™t táº­p há»£p cÃ¡c kÃ½ tá»±. ChÃºng ta Ä‘Ã£ Ä‘á» cáº­p Ä‘áº¿n loáº¡i <code>String</code>
trÆ°á»›c Ä‘Ã¢y, nhÆ°ng trong chÆ°Æ¡ng nÃ y chÃºng ta sáº½ nÃ³i sÃ¢u hÆ¡n vá» nÃ³.</li>
<li>Má»™t <em>hash map</em> cho phÃ©p báº¡n liÃªn káº¿t má»™t giÃ¡ trá»‹ vá»›i má»™t khÃ³a cá»¥ thá»ƒ. NÃ³ lÃ  má»™t
triá»ƒn khai (implement) cá»¥ thá»ƒ cá»§a cáº¥u trÃºc dá»¯ liá»‡u tá»•ng quÃ¡t hÆ¡n Ä‘Æ°á»£c gá»i lÃ  <em>map</em>.</li>
</ul>
<p>Äá»ƒ tÃ¬m hiá»ƒu vá» cÃ¡c loáº¡i táº­p há»£p khÃ¡c Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n tiÃªu chuáº©n,
xem <a href="../std/collections/index.html">tÃ i liá»‡u hÆ°á»›ng dáº«n</a>.</p>
<p>ChÃºng ta cÅ©ng sáº½ tháº£o luáº­n vá» cÃ¡ch táº¡o vÃ  cáº­p nháº­t vector, string vÃ  hash map,
cÅ©ng nhÆ° nhá»¯ng gÃ¬ lÃ m cho má»—i thá»© trá»Ÿ nÃªn Ä‘áº·c biá»‡t.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="lÆ°u-danh-sÃ¡ch-giÃ¡-trá»‹-báº±ng-vector"><a class="header" href="#lÆ°u-danh-sÃ¡ch-giÃ¡-trá»‹-báº±ng-vector">LÆ°u danh sÃ¡ch giÃ¡ trá»‹ báº±ng Vector</a></h2>
<p>Loáº¡i táº­p há»£p Ä‘áº§u tiÃªn chÃºng ta sáº½ xem xÃ©t lÃ  <code>Vec&lt;T&gt;</code>, cÃ²n Ä‘Æ°á»£c gá»i lÃ  <em>vector</em>.
Vector cho phÃ©p báº¡n lÆ°u trá»¯ nhiá»u giÃ¡ trá»‹ trong má»™t cáº¥u trÃºc dá»¯ liá»‡u Ä‘Æ¡n láº» mÃ  nÃ³
Ä‘áº·t táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ náº±m cáº¡nh nhau trong bá»™ nhá»›. Vector chá»‰ cÃ³ thá»ƒ lÆ°u trá»¯ cÃ¡c giÃ¡ trá»‹
cÃ¹ng loáº¡i. ChÃºng há»¯u Ã­ch khi báº¡n cÃ³ má»™t danh sÃ¡ch cÃ¡c háº¡ng má»¥c, cháº³ng háº¡n nhÆ°
nhá»¯ng dÃ²ng vÄƒn báº£n trong má»™t táº­p tin hoáº·c giÃ¡ cáº£ cá»§a cÃ¡c máº·t hÃ ng trong giá» hÃ ng.</p>
<h3 id="táº¡o-má»›i-vector"><a class="header" href="#táº¡o-má»›i-vector">Táº¡o má»›i Vector</a></h3>
<p>Äá»ƒ táº¡o má»›i má»™t vector rá»—ng, chÃºng ta thá»±c thi hÃ m <code>Vec::new</code>, nhÆ° hiá»ƒn thá»‹ trong má»¥c 8-1</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let v: Vec&lt;i32&gt; = Vec::new();
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-1: Táº¡o má»›i vector rá»—ng Ä‘á»ƒ lÆ°u trá»¯ giÃ¡ trá»‹ loáº¡i <code>i32</code></span></p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta Ä‘Ã£ cÃ³ thÃªm chÃº thÃ­ch kiá»ƒu dá»¯ liá»‡u á»Ÿ Ä‘Ã¢y. Bá»Ÿi vÃ¬ náº¿u khÃ´ng chÃ¨n báº¥t ká»³
giÃ¡ trá»‹ nÃ o vÃ o vector nÃ y, Rust sáº½ khÃ´ng biáº¿t loáº¡i pháº§n tá»­ nÃ o chÃºng ta dá»± Ä‘á»‹nh lÆ°u vÃ o.
ÄÃ¢y lÃ  Ä‘iá»ƒm quan trá»ng. Vector Ä‘Æ°á»£c triá»ƒn khai báº±ng cÃ¡ch sá»­ dá»¥ng kiá»ƒu generic;
chÃºng tÃ´i sáº½ trÃ¬nh bÃ y cÃ¡ch sá»­ dá»¥ng generic vá»›i kiá»ƒu dá»¯ liá»‡u riÃªng cá»§a báº¡n trong ChÆ°Æ¡ng 10.
Hiá»‡n táº¡i, chá»‰ cáº§n biáº¿t ráº±ng kiá»ƒu <code>Vec&lt;T&gt;</code> Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n chuáº©n, nÃ³ cÃ³ thá»ƒ chá»©a
báº¥t ká»³ kiá»ƒu dá»¯ liá»‡u nÃ o cÅ©ng Ä‘Æ°á»£c. Khi táº¡o má»™t vector Ä‘á»ƒ chá»©a má»™t kiá»ƒu dá»¯ liá»‡u cá»¥ thá»ƒ
nÃ o Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh chÃºng bÃªn trong dáº¥u ngoáº·c nhá»n (<code>&lt;&gt;</code>).
Trong má»¥c 8-1, chÃºng ta Ä‘Ã£ khai bÃ¡o vá»›i Rust ráº±ng <code>Vec&lt;T&gt;</code> trong <code>v</code> sáº½ chá»©a cÃ¡c pháº§n tá»­ cá»§a kiá»ƒu <code>i32</code>.</p>
<p>ThÃ´ng thÆ°á»ng hÆ¡n, khi báº¡n táº¡o má»™t <code>Vec&lt;T&gt;</code> vá»›i cÃ¡c giÃ¡ trá»‹ khá»Ÿi táº¡o, Rust sáº½ suy ra
kiá»ƒu dá»¯ liá»‡u cá»§a giÃ¡ trá»‹ báº¡n muá»‘n lÆ°u trá»¯ vÃ o, vÃ¬ váº­y hiáº¿m khi báº¡n pháº£i khai bÃ¡o chÃº thÃ­ch
kiá»ƒu dá»¯ liá»‡u tháº¿ nÃ y. Rust cung cáº¥p macro <code>vec!</code> má»™t cÃ¡ch tiá»‡n dá»¥ng, nÃ³ sáº½ táº¡o ra má»™t
vector má»›i chá»©a cÃ¡c giÃ¡ trá»‹ báº¡n cung cáº¥p cho nÃ³. Má»¥c 8-2 táº¡o ra má»™t
<code>Vec&lt;i32&gt;</code> chá»©a cÃ¡c giÃ¡ trá»‹ <code>1</code>, <code>2</code> vÃ  <code>3</code>. Kiá»ƒu sá»‘ nguyÃªn lÃ  <code>i32</code>
bá»Ÿi vÃ¬ Ä‘Ã³ lÃ  kiá»ƒu sá»‘ nguyÃªn máº·c Ä‘á»‹nh nhÆ° chÃºng ta Ä‘Ã£ tháº£o luáº­n trong <a href="ch03-02-data-types.html#data-types">â€œKiá»ƒu dá»¯ liá»‡uâ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 3.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let v = vec![1, 2, 3];
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-2: Táº¡o má»›i vector cÃ³ chá»©a dá»¯ liá»‡u</span></p>
<p>VÃ¬ chÃºng ta Ä‘Ã£ khá»Ÿi táº¡o cÃ¡c giÃ¡ trá»‹ ban Ä‘áº§u lÃ  kiá»ƒu dá»¯ liá»‡u <code>i32</code>, nÃªn Rust cÃ³ thá»ƒ suy ra ráº±ng kiá»ƒu dá»¯ liá»‡u cá»§a <code>v</code> lÃ  <code>Vec&lt;i32&gt;</code>, nÃªn viá»‡c chÃº thÃ­ch kiá»ƒu dá»¯ liá»‡u lÃ  khÃ´ng cáº§n thiáº¿t ná»¯a. Tiáº¿p theo, chÃºng ta sáº½ xem xÃ©t cÃ¡ch Ä‘á»ƒ sá»­a Ä‘á»•i má»™t vector.</p>
<h3 id="cáº­p-nháº­t-vector"><a class="header" href="#cáº­p-nháº­t-vector">Cáº­p nháº­t Vector</a></h3>
<p>Äá»ƒ táº¡o má»™t vector vÃ  sau Ä‘Ã³ thÃªm cÃ¡c pháº§n tá»­ vÃ o nÃ³, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>push</code>,
nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ trong má»¥c 8-3.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let mut v = Vec::new();

    v.push(5);
    v.push(6);
    v.push(7);
    v.push(8);
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-3: Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>push</code> Ä‘á»ƒ thÃªm giÃ¡ trá»‹ vÃ o vector</span></p>
<p>NhÆ° vá»›i báº¥t ká»³ biáº¿n nÃ o, náº¿u chÃºng ta muá»‘n cÃ³ thá»ƒ thay Ä‘á»•i giÃ¡ trá»‹ cá»§a nÃ³, chÃºng ta cáº§n
lÃ m cho nÃ³ cÃ³ thá»ƒ thay Ä‘á»•i báº±ng cÃ¡ch sá»­ dá»¥ng tá»« khÃ³a <code>mut</code>, nhÆ° Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 3.
CÃ¡c con sá»‘ chÃºng tÃ´i Ä‘áº·t bÃªn trong táº¥t cáº£ Ä‘á»u thuá»™c loáº¡i <code>i32</code> vÃ  Rust suy ra Ä‘iá»u nÃ y
tá»« dá»¯ liá»‡u, vÃ¬ váº­y chÃºng ta khÃ´ng cáº§n chÃº thÃ­ch <code>Vec&lt;i32&gt;</code>.</p>
<h3 id="truy-xuáº¥t-cÃ¡c-pháº§n-tá»­-cá»§a-vector"><a class="header" href="#truy-xuáº¥t-cÃ¡c-pháº§n-tá»­-cá»§a-vector">Truy xuáº¥t cÃ¡c pháº§n tá»­ cá»§a Vector</a></h3>
<p>CÃ³ hai cÃ¡ch Ä‘á»ƒ tham chiáº¿u má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c lÆ°u trá»¯ trong má»™t vector: thÃ´ng qua chá»‰ má»¥c (index) hoáº·c
sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>get</code>. Trong cÃ¡c vÃ­ dá»¥ sau, chÃºng tÃ´i Ä‘Ã£ thÃªm chÃº thÃ­ch kiá»ƒu cá»§a nhá»¯ng
giÃ¡ trá»‹ Ä‘Æ°á»£c tráº£ vá» tá»« cÃ¡c hÃ m nÃ y Ä‘á»ƒ lÃ m rÃµ nghÄ©a hÆ¡n.</p>
<p>Má»¥c 8-4 thá»ƒ hiá»‡n cáº£ hai phÆ°Æ¡ng phÃ¡p truy cáº­p giÃ¡ trá»‹ trong má»™t vector, vá»›i cÃº phÃ¡p index vÃ  phÆ°Æ¡ng thá»©c <code>get</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let v = vec![1, 2, 3, 4, 5];

    let third: &amp;i32 = &amp;v[2];
    println!("The third element is {third}");

    let third: Option&lt;&amp;i32&gt; = v.get(2);
    match third {
        Some(third) =&gt; println!("The third element is {third}"),
        None =&gt; println!("There is no third element."),
    }
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-4: Sá»­ dá»¥ng cÃº phÃ¡p index hoáº·c phÆ°Æ¡ng thá»©c <code>get</code> Ä‘á»ƒ truy cáº­p má»™t pháº§n tá»­ trong vector</span></p>
<p>LÆ°u Ã½ má»™t vÃ i chi tiáº¿t á»Ÿ Ä‘Ã¢y. ChÃºng ta sá»­ dá»¥ng giÃ¡ trá»‹ index lÃ  <code>2</code> Ä‘á»ƒ láº¥y pháº§n tá»­ thá»© ba
bá»Ÿi vÃ¬ cÃ¡c pháº§n tá»­ cá»§a vector Ä‘Æ°á»£c láº­p theo cÃ¡ch Ä‘Ã¡nh sá»‘ chá»‰ má»¥c (index), báº¯t Ä‘áº§u tá»« sá»‘ 0.
Sá»­ dá»¥ng <code>&amp;</code> vÃ  <code>[]</code> sáº½ cung cáº¥p cho chÃºng ta má»™t tham chiáº¿u Ä‘áº¿n pháº§n tá»­ táº¡i giÃ¡ trá»‹
index chá»‰ Ä‘á»‹nh. Khi chÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>get</code> vá»›i Ä‘á»‘i sá»‘ index chá»‰ Ä‘á»‹nh,
chÃºng ta nháº­n Ä‘Æ°á»£c má»™t <code>Option&lt;&amp;T&gt;</code> mÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng vá»›i <code>match</code>.</p>
<p>LÃ½ do Rust cung cáº¥p hai cÃ¡ch nÃ y Ä‘á»ƒ tham chiáº¿u Ä‘áº¿n má»™t pháº§n tá»­ lÃ  vÃ¬ báº¡n cÃ³ thá»ƒ
lá»±a chá»n cÃ¡ch thá»©c chÆ°Æ¡ng trÃ¬nh hoáº¡t Ä‘á»™ng khi báº¡n cá»‘ sá»­ dá»¥ng má»™t giÃ¡ trá»‹ index bÃªn ngoÃ i
pháº¡m vi cá»§a cÃ¡c pháº§n tá»­ hiá»‡n cÃ³. VÃ­ dá»¥, hÃ£y xem Ä‘iá»u gÃ¬ sáº½ xáº£y ra khi chÃºng ta cÃ³
má»™t vector gá»“m 5 pháº§n tá»­ vÃ  sau Ä‘Ã³ chÃºng ta cá»‘ Ã½ truy cáº­p má»™t pháº§n tá»­ á»Ÿ index 100
vá»›i má»—i cÃ¡ch, nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ trong má»¥c 8-5.</p>
<pre><pre class="playground"><code class="language-rust should_panic panics edition2024"><span class="boring">fn main() {
</span>    let v = vec![1, 2, 3, 4, 5];

    let does_not_exist = &amp;v[100];
    let does_not_exist = v.get(100);
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-5: Cá»‘ gáº¯ng truy cáº­p pháº§n tá»­ táº¡i index 100 trong vector chá»‰ cÃ³ 5 pháº§n tá»­</span></p>
<p>Khi chÃºng ta cháº¡y Ä‘oáº¡n mÃ£ nÃ y, phÆ°Æ¡ng thá»©c sá»­ dá»¥ng index <code>[]</code> Ä‘áº§u tiÃªn sáº½ khiáº¿n chÆ°Æ¡ng trÃ¬nh bá»‹ lá»—i
bá»Ÿi vÃ¬ nÃ³ tham chiáº¿u Ä‘áº¿n má»™t pháº§n tá»­ khÃ´ng tá»“n táº¡i. PhÆ°Æ¡ng phÃ¡p nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng tá»‘t nháº¥t khi báº¡n
muá»‘n chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n gáº·p sá»± cá»‘ náº¿u cÃ³ ná»— lá»±c truy cáº­p vÃ o má»™t pháº§n tá»­ sau pháº§n tá»­ cuá»‘i vector.</p>
<p>Khi phÆ°Æ¡ng thá»©c <code>get</code> Ä‘Æ°á»£c truyá»n vÃ o má»™t chá»‰ má»¥c index náº±m ngoÃ i vector, nÃ³ sáº½ tráº£ vá» <code>None</code>
mÃ  khÃ´ng bá»‹ lá»—i. Báº¡n sáº½ sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p nÃ y náº¿u viá»‡c truy cáº­p má»™t pháº§n tá»­ náº±m ngoÃ i pháº¡m vi cá»§a vector cÃ³ thá»ƒ thá»‰nh thoáº£ng xáº£y ra trong cÃ¡c tÃ¬nh huá»‘ng bÃ¬nh thÆ°á»ng. Khi Ä‘Ã³, báº¡n sáº½ cÃ³ logic Ä‘á»ƒ xá»­ lÃ½ cáº£ hai trÆ°á»ng há»£p <code>Some(&amp;element)</code> hoáº·c <code>None</code>, nhÆ° Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 6. VÃ­ dá»¥, chá»‰ má»¥c index cÃ³ thá»ƒ phÃ¡t sinh tá»« má»™t ngÆ°á»i nháº­p liá»‡u chá»‰ sá»‘ Ä‘Ã³. Náº¿u há» vÃ´ tÃ¬nh nháº­p má»™t sá»‘ quÃ¡ lá»›n, thÃ¬ chÆ°Æ¡ng trÃ¬nh nháº­n giÃ¡ trá»‹ tráº£ vá» lÃ  <code>None</code>, khi Ä‘Ã³ báº¡n cÃ³ thá»ƒ cho ngÆ°á»i dÃ¹ng biáº¿t cÃ³ bao nhiÃªu pháº§n tá»­ trong vector hiá»‡n táº¡i vÃ  cho há» má»™t cÆ¡ há»™i khÃ¡c Ä‘á»ƒ nháº­p láº¡i giÃ¡ trá»‹ há»£p lá»‡. Äiá»u Ä‘Ã³ sáº½ thÃ¢n thiá»‡n vá»›i ngÆ°á»i dÃ¹ng hÆ¡n, hÆ¡n lÃ  lÃ m há»ng chÆ°Æ¡ng trÃ¬nh do lá»—i Ä‘Ã¡nh mÃ¡y!</p>
<p>Khi chÆ°Æ¡ng trÃ¬nh cÃ³ tham chiáº¿u há»£p lá»‡, trÃ¬nh kiá»ƒm tra mÆ°á»£n tham chiáº¿u (borrow) thá»±c thi
cÃ¡c quy táº¯c vá» quyá»n sá»Ÿ há»¯u (ownership) vÃ  nhá»¯ng quy táº¯c vá» mÆ°á»£n tham chiáº¿u (Ä‘Æ°á»£c Ä‘á» cáº­p
trong ChÆ°Æ¡ng 4) Ä‘á»ƒ Ä‘áº£m báº£o tham chiáº¿u nÃ y vÃ  má»i tham chiáº¿u khÃ¡c Ä‘áº¿n ná»™i dung cá»§a vector
váº«n há»£p lá»‡. Nháº¯c láº¡i quy táº¯c vá» tráº¡ng thÃ¡i, báº¡n khÃ´ng thá»ƒ cÃ³ cÃ¹ng tráº¡ng thÃ¡i: tham chiáº¿u
cÃ³ thá»ƒ thay Ä‘á»•i (mutable) vÃ  tham chiáº¿u báº¥t biáº¿n (immutable) trong cÃ¹ng má»™t pháº¡m vi.
Quy táº¯c Ä‘Ã³ Ã¡p dá»¥ng trong má»¥c 8-6, trong Ä‘Ã³ chÃºng ta giá»¯ má»™t tham chiáº¿u immutable Ä‘áº¿n
pháº§n tá»­ Ä‘áº§u tiÃªn trong má»™t vector vÃ  cá»‘ gáº¯ng thÃªm má»™t pháº§n tá»­ vÃ o cuá»‘i. ChÆ°Æ¡ng trÃ¬nh
nÃ y cÅ©ng sáº½ khÃ´ng cháº¡y Ä‘Æ°á»£c náº¿u chÃºng ta cá»‘ tham chiáº¿u Ä‘áº¿n pháº§n tá»­ nÃ y sau Ä‘Ã³ trong hÃ m sau:</p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span>    let mut v = vec![1, 2, 3, 4, 5];

    let first = &amp;v[0];

    v.push(6);

    println!("The first element is: {first}");
<span class="boring">}</span></code></pre>
<p><span class="caption">Má»¥c 8-6: Cá»‘ gáº¯ng thÃªm má»™t pháº§n tá»­ vÃ o vector trong khi Ä‘ang
giá»¯ tham chiáº¿u Ä‘áº¿n má»™t pháº§n tá»­ </span></p>
<p>BiÃªn dá»‹ch Ä‘oáº¡n mÃ£ nÃ y sáº½ bá»‹ lá»—i:</p>
<pre><code class="language-console">$ cargo run
   Compiling collections v0.1.0 (file:///projects/collections)
error[E0502]: cannot borrow `v` as mutable because it is also borrowed as immutable
 --&gt; src/main.rs:6:5
  |
4 |     let first = &amp;v[0];
  |                  - immutable borrow occurs here
5 |
6 |     v.push(6);
  |     ^^^^^^^^^ mutable borrow occurs here
7 |
8 |     println!("The first element is: {first}");
  |                                     ------- immutable borrow later used here

For more information about this error, try `rustc --explain E0502`.
error: could not compile `collections` (bin "collections") due to 1 previous error
</code></pre>
<p>Äoáº¡n mÃ£ trong má»¥c 8-6 cÃ³ thá»ƒ trÃ´ng giá»‘ng nhÆ°: táº¡i sao má»™t tham chiáº¿u Ä‘áº¿n pháº§n tá»­
Ä‘áº§u tiÃªn pháº£i quan tÃ¢m Ä‘áº¿n nhá»¯ng thay Ä‘á»•i á»Ÿ cuá»‘i vector? Lá»—i nÃ y lÃ  do cÃ¡ch hoáº¡t
Ä‘á»™ng cá»§a vector: vÃ¬ vector Ä‘áº·t cÃ¡c giÃ¡ trá»‹ cáº¡nh nhau trong bá»™ nhá»›, viá»‡c thÃªm má»™t
pháº§n tá»­ má»›i vÃ o cuá»‘i vector cÃ³ thá»ƒ yÃªu cáº§u cáº¥p phÃ¡t bá»™ nhá»› má»›i, náº¿u khÃ´ng cÃ³ Ä‘á»§
chá»— Ä‘á»ƒ Ä‘áº·t táº¥t cáº£ cÃ¡c pháº§n tá»­ bÃªn cáº¡nh nhau táº¡i nÆ¡i mÃ  vector hiá»‡n Ä‘ang Ä‘Æ°á»£c lÆ°u
trá»¯, thÃ¬ nÃ³ sáº½ sao chÃ©p táº¥t cáº£ cÃ¡c pháº§n tá»­ cÅ© vÃ o khÃ´ng gian má»›i trong bá»™ nhá»›.
Trong trÆ°á»ng há»£p Ä‘Ã³, tham chiáº¿u Ä‘áº¿n pháº§n tá»­ Ä‘áº§u tiÃªn sáº½ trá» Ä‘áº¿n bá»™ nhá»› Ä‘Ã£ bá»‹ giáº£i
phÃ³ng. CÃ¡c quy táº¯c mÆ°á»£n tham chiáº¿u sáº½ ngÄƒn cáº£n cÃ¡c chÆ°Æ¡ng trÃ¬nh káº¿t thÃºc trong tÃ¬nh huá»‘ng Ä‘Ã³.</p>
<blockquote>
<p>LÆ°u Ã½: Äá»ƒ biáº¿t thÃªm vá» chi tiáº¿t triá»ƒn khai cá»§a kiá»ƒu <code>Vec&lt;T&gt;</code>, hÃ£y tham kháº£o <a href="../nomicon/vec/vec.html">â€œThe
Rustonomiconâ€</a>.</p>
</blockquote>
<h3 id="duyá»‡t-qua-nhá»¯ng-giÃ¡-trá»‹-trong-vector"><a class="header" href="#duyá»‡t-qua-nhá»¯ng-giÃ¡-trá»‹-trong-vector">Duyá»‡t qua nhá»¯ng giÃ¡ trá»‹ trong Vector</a></h3>
<p>Äá»ƒ truy cáº­p láº§n lÆ°á»£t tá»«ng pháº§n tá»­ trong má»™t vector, chÃºng ta sáº½ láº·p qua táº¥t cáº£ cÃ¡c
pháº§n tá»­ thay vÃ¬ sá»­ dá»¥ng cÃ¡c chá»‰ má»¥c Ä‘á»ƒ truy cáº­p tá»«ng pháº§n tá»­ má»™t. Má»¥c 8-7 thá»ƒ hiá»‡n
cÃ¡ch sá»­ dá»¥ng vÃ²ng láº·p <code>for</code> Ä‘á»ƒ nháº­n cÃ¡c tham chiáº¿u immutable Ä‘áº¿n tá»«ng pháº§n tá»­
trong má»™t vector cÃ³ kiá»ƒu giÃ¡ trá»‹ <code>i32</code> vÃ  in chÃºng ra.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let v = vec![100, 32, 57];
    for i in &amp;v {
        println!("{i}");
    }
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-7: In tá»«ng pháº§n tá»­ trong má»™t vector báº±ng cÃ¡ch láº·p qua cÃ¡c
pháº§n tá»­ sá»­ dá»¥ng má»™t vÃ²ng láº·p <code>for</code></span></p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ láº·p qua cÃ¡c tham chiáº¿u mutable Ä‘áº¿n tá»«ng pháº§n tá»­ trong má»™t vector
mutable Ä‘á»ƒ thá»±c hiá»‡n thay Ä‘á»•i Ä‘á»‘i vá»›i táº¥t cáº£ cÃ¡c pháº§n tá»­. VÃ²ng láº·p <code>for</code> trong má»¥c 8-8
sáº½ thÃªm <code>50</code> vÃ o má»—i pháº§n tá»­.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let mut v = vec![100, 32, 57];
    for i in &amp;mut v {
        *i += 50;
    }
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-8: Láº·p qua cÃ¡c tham chiáº¿u mutable Ä‘áº¿n tá»«ng pháº§n tá»­ trong
má»™t vector</span></p>
<p>Äá»ƒ thay Ä‘á»•i giÃ¡ trá»‹ mÃ  tham chiáº¿u mutable Ä‘ang tham chiáº¿u Ä‘áº¿n, chÃºng ta pháº£i sá»­ dá»¥ng
toÃ¡n tá»­ tham chiáº¿u giÃ¡ trá»‹ <code>*</code> Ä‘á»ƒ Ä‘i Ä‘áº¿n giÃ¡ trá»‹ mÃ  <code>i</code> Ä‘ang trá»Ÿ tá»›i trÆ°á»›c khi chÃºng
ta cÃ³ thá»ƒ sá»­ dá»¥ng toÃ¡n tá»­ <code>+=</code>. ChÃºng ta sáº½ nÃ³i thÃªm vá» toÃ¡n tá»­ tham chiáº¿u giÃ¡ trá»‹
trong pháº§n <a href="ch15-02-deref.html#following-the-pointer-to-the-value-with-the-dereference-operator">â€œTheo con trá» Ä‘áº¿n giÃ¡ trá»‹ vá»›i toÃ¡n tá»­ tham chiáº¿u derefâ€</a><!-- ignore -->
cá»§a ChÆ°Æ¡ng 15.</p>
<p>Duyá»‡t qua má»™t vector, cho dÃ¹ lÃ  loáº¡i immutable hoáº·c mutable, Ä‘á»u an toÃ n vá»›i cÃ¡c quy
táº¯c cá»§a trÃ¬nh kiá»ƒm tra mÆ°á»£n tham chiáº¿u. Náº¿u chÃºng tÃ´i cá»‘ thá»­ chÃ¨n hoáº·c xÃ³a cÃ¡c má»¥c
trong pháº§n thÃ¢n cá»§a vÃ²ng láº·p <code>for</code> á»Ÿ má»¥c 8-7 vÃ  má»¥c 8-8, chÃºng tÃ´i sáº½ gáº·p lá»—i trÃ¬nh
biÃªn dá»‹ch tÆ°Æ¡ng tá»± nhÆ° lá»—i mÃ  chÃºng tÃ´i gáº·p pháº£i vá»›i Ä‘oáº¡n mÃ£ trong má»¥c 8-6. Tham chiáº¿u
Ä‘áº¿n vector mÃ  vÃ²ng láº·p <code>for</code> Ä‘ang náº¯m giá»¯ sáº½ ngÄƒn cáº£n viá»‡c sá»­a Ä‘á»•i Ä‘á»“ng thá»i toÃ n bá»™ vector.</p>
<h3 id="sá»­-dá»¥ng-enum-Ä‘á»ƒ-lÆ°u-nhiá»u-kiá»ƒu-dá»¯-liá»‡u"><a class="header" href="#sá»­-dá»¥ng-enum-Ä‘á»ƒ-lÆ°u-nhiá»u-kiá»ƒu-dá»¯-liá»‡u">Sá»­ dá»¥ng Enum Ä‘á»ƒ lÆ°u nhiá»u kiá»ƒu dá»¯ liá»‡u</a></h3>
<p>CÃ¡c vector chá»‰ cÃ³ thá»ƒ lÆ°u trá»¯ cÃ¡c giÃ¡ trá»‹ cÃ³ cÃ¹ng kiá»ƒu dá»¯ liá»‡u. Äiá»u nÃ y cÃ³ thá»ƒ gÃ¢y báº¥t tiá»‡n;
cháº¯c cháº¯n cÃ³ nhá»¯ng trÆ°á»ng há»£p sá»­ dá»¥ng cáº§n lÆ°u trá»¯ má»™t danh sÃ¡ch cÃ¡c háº¡ng má»¥c cÃ³ kiá»ƒu dá»¯ liá»‡u
khÃ¡c loáº¡i nhau. May máº¯n thay, cÃ¡c biáº¿n thá»ƒ (variants) cá»§a má»™t enum Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a dÆ°á»›i cÃ¹ng
má»™t kiá»ƒu enum, vÃ¬ váº­y khi chÃºng ta cáº§n má»™t cÃ¡i nÃ o Ä‘Ã³ Ä‘á»ƒ Ä‘áº¡i diá»‡n cho cÃ¡c pháº§n tá»­ cÃ³ kiá»ƒu dá»¯
liá»‡u khÃ¡c nhau, chÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a vÃ  sá»­ dá»¥ng má»™t enum!</p>
<p>VÃ­ dá»¥: chÃºng ta muá»‘n nháº­n cÃ¡c giÃ¡ trá»‹ tá»« má»™t dÃ²ng trong báº£ng tÃ­nh, trong Ä‘Ã³ má»™t sá»‘ cá»™t cá»§a
dÃ²ng Ä‘Ã³ chá»©a sá»‘ nguyÃªn, sá»‘ dáº¥u cháº¥m Ä‘á»™ng vÃ  chuá»—i. ChÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a má»™t enum mÃ 
cÃ¡c biáº¿n thá»ƒ cá»§a nÃ³ sáº½ chá»©a cÃ¡c kiá»ƒu giÃ¡ trá»‹ khÃ¡c nhau vÃ  táº¥t cáº£ cÃ¡c biáº¿n thá»ƒ enum sáº½ Ä‘Æ°á»£c
coi lÃ  cÃ¹ng má»™t kiá»ƒu: kiá»ƒu cá»§a enum. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ táº¡o má»™t vector Ä‘á»ƒ chá»©a enum
Ä‘Ã³ vÃ  cuá»‘i cÃ¹ng, chá»©a cÃ¡c kiá»ƒu dá»¯ liá»‡u khÃ¡c nhau. ChÃºng tÃ´i Ä‘Ã£ biá»ƒu diá»…n Ä‘iá»u nÃ y trong má»¥c 8-9.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    enum SpreadsheetCell {
        Int(i32),
        Float(f64),
        Text(String),
    }

    let row = vec![
        SpreadsheetCell::Int(3),
        SpreadsheetCell::Text(String::from("blue")),
        SpreadsheetCell::Float(10.12),
    ];
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-9: Äá»‹nh nghÄ©a má»™t <code>enum</code> lÆ°u giÃ¡ trá»‹ cá»§a
nhá»¯ng kiá»ƒu dá»¯ liá»‡u khÃ¡c nhau trong má»™t vector</span></p>
<p>Rust cáº§n biáº¿t nhá»¯ng kiá»ƒu dá»¯ liá»‡u nÃ o sáº½ cÃ³ trong vector táº¡i thá»i Ä‘iá»ƒm
biÃªn dá»‹ch Ä‘á»ƒ nÃ³ biáº¿t chÃ­nh xÃ¡c sáº½ cáº§n bao nhiÃªu bá»™ nhá»› trÃªn heap Ä‘á»ƒ lÆ°u
trá»¯ má»—i pháº§n tá»­. ChÃºng ta cÅ©ng pháº£i rÃµ rÃ ng vá» nhá»¯ng kiá»ƒu dá»¯ liá»‡u Ä‘Æ°á»£c phÃ©p
trong vector nÃ y. Náº¿u Rust cho phÃ©p má»™t vector chá»©a báº¥t ká»³ kiá»ƒu dá»¯ liá»‡u nÃ o,
sáº½ cÃ³ kháº£ nÄƒng má»™t hoáº·c nhiá»u kiá»ƒu dá»¯ liá»‡u sáº½ gÃ¢y ra lá»—i vá»›i cÃ¡c phÃ©p toÃ¡n
Ä‘Æ°á»£c thá»±c hiá»‡n trÃªn cÃ¡c pháº§n tá»­ cá»§a vector. Sá»­ dá»¥ng má»™t enum cá»™ng vá»›i
má»™t biá»ƒu thá»©c <code>match</code> cÃ³ nghÄ©a lÃ  Rust sáº½ Ä‘áº£m báº£o táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch ráº±ng
má»i trÆ°á»ng há»£p cÃ³ kháº£ nÄƒng xáº£y ra Ä‘á»u Ä‘Æ°á»£c xá»­ lÃ½, nhÆ° Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 6.</p>
<p>Náº¿u báº¡n khÃ´ng biáº¿t Ä‘áº§y Ä‘á»§ táº­p há»£p cÃ¡c loáº¡i dá»¯ liá»‡u mÃ  má»™t chÆ°Æ¡ng trÃ¬nh
sáº½ nháº­n Ä‘Æ°á»£c táº¡i thá»i Ä‘iá»ƒm thá»±c thi Ä‘á»ƒ lÆ°u trá»¯ trong má»™t vector, thÃ¬ ká»¹ thuáº­t enum
sáº½ khÃ´ng hoáº¡t Ä‘á»™ng tá»‘t. Thay vÃ o Ä‘Ã³, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng má»™t Ä‘á»‘i tÆ°á»£ng Ä‘áº·c táº£ (trait),
mÃ  chÃºng ta sáº½ Ä‘á» cáº­p trong ChÆ°Æ¡ng 17.</p>
<p>BÃ¢y giá» chÃºng ta Ä‘Ã£ tháº£o luáº­n vá» má»™t sá»‘ cÃ¡ch phá»• biáº¿n nháº¥t Ä‘á»ƒ sá»­ dá»¥ng vector, hÃ£y
há»› xem láº¡i <a href="../std/vec/struct.Vec.html">tÃ i liá»‡u API</a><!-- ignore --> Ä‘á»ƒ biáº¿t thÃªm nhiá»u phÆ°Æ¡ng thá»©c
há»¯u Ã­ch Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong <code>Vec&lt;T&gt;</code> bá»Ÿi thÆ° viá»‡n chuáº©n. VÃ­ dá»¥, ngoÃ i <code>push</code>,
má»™t phÆ°Æ¡ng thá»©c <code>pop</code> sáº½ loáº¡i bá» vÃ  tráº£ vá» pháº§n tá»­ cuá»‘i cÃ¹ng.</p>
<h3 id="loáº¡i-bá»-má»™t-vector-cÅ©ng-sáº½-giáº£i-phÃ³ng-luÃ´n-cÃ¡c-pháº§n-tá»­-cá»§a-nÃ³"><a class="header" href="#loáº¡i-bá»-má»™t-vector-cÅ©ng-sáº½-giáº£i-phÃ³ng-luÃ´n-cÃ¡c-pháº§n-tá»­-cá»§a-nÃ³">Loáº¡i bá» má»™t vector cÅ©ng sáº½ giáº£i phÃ³ng luÃ´n cÃ¡c pháº§n tá»­ cá»§a nÃ³</a></h3>
<p>Giá»‘ng nhÆ° báº¥t ká»³ <code>struct</code> nÃ o khÃ¡c, má»™t vector Ä‘Æ°á»£c giáº£i phÃ³ng khi nÃ³ ra khá»i pháº¡m vi, nhÆ°
Ä‘Æ°á»£c chÃº thÃ­ch trong má»¥c 8-10.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    {
        let v = vec![1, 2, 3, 4];

        // do stuff with v
    } // &lt;- v goes out of scope and is freed here
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-10: Chá»‰ ra nÆ¡i mÃ  vector vÃ  cÃ¡c pháº§n tá»­ cá»§a nÃ³ bá»‹ giáº£i phÃ³ng</span></p>
<p>Khi vector bá»‹ loáº¡i bá», táº¥t cáº£ ná»™i dung cá»§a nÃ³ cÅ©ng bá»‹ loáº¡i bá», cÃ³ nghÄ©a lÃ  cÃ¡c sá»‘ nguyÃªn mÃ  nÃ³ giá»¯ sáº½ bá»‹ xÃ³a sáº¡ch.
TrÃ¬nh kiá»ƒm tra mÆ°á»£n tham chiáº¿u sáº½ Ä‘áº£m báº£o ráº±ng báº¥t ká»³ tham chiáº¿u nÃ o Ä‘áº¿n ná»™i dung cá»§a vector chá»‰
Ä‘Æ°á»£c sá»­ dá»¥ng khi chÃ­nh vector Ä‘Ã³ cÃ²n há»£p lá»‡.</p>
<p>HÃ£y chuyá»ƒn sang loáº¡i táº­p há»£p tiáº¿p theo: <code>String</code>!</p>
<div style="break-before: page; page-break-before: always;"></div><p><a id="storing-utf-8-encoded-text-with-strings"></a></p>
<h2 id="lÆ°u-trá»¯-vÄƒn-báº£n-Ä‘Æ°á»£c-mÃ£-hÃ³a-utf-8-báº±ng-chuá»—i-string"><a class="header" href="#lÆ°u-trá»¯-vÄƒn-báº£n-Ä‘Æ°á»£c-mÃ£-hÃ³a-utf-8-báº±ng-chuá»—i-string">LÆ°u trá»¯ vÄƒn báº£n Ä‘Æ°á»£c mÃ£ hÃ³a UTF-8 báº±ng chuá»—i (String)</a></h2>
<p>ChÃºng ta Ä‘Ã£ nÃ³i vá» chuá»—i trong ChÆ°Æ¡ng 4, nhÆ°ng bÃ¢y giá» chÃºng ta sáº½ xem xÃ©t chÃºng sÃ¢u hÆ¡n. Nhá»¯ng tÃ­n Ä‘á»“ má»›i cá»§a Rust thÆ°á»ng bá»‹ máº¯c káº¹t khi lÃ m viá»‡c vá»›i string vÃ¬ ba lÃ½ do: Rust cÃ³ xu hÆ°á»›ng tÃ¬m ra cÃ¡c lá»—i cÃ³ kháº£ nÄƒng xáº£y ra, chuá»—i lÃ  má»™t cáº¥u trÃºc dá»¯ liá»‡u phá»©c táº¡p hÆ¡n nhiá»u láº­p trÃ¬nh viÃªn nghÄ© vÃ  thá»© ba lÃ  vá» UTF-8. Nhá»¯ng yáº¿u tá»‘ nÃ y káº¿t há»£p theo cÃ¡ch cÃ³ váº» khÃ³ khÄƒn khi báº¡n hiá»ƒu theo cÃ¡ch cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c.</p>
<p>ChÃºng ta sáº½ tháº£o luáº­n vá» string theo khÃ­a cáº¡nh cÃ¡c táº­p há»£p bá»Ÿi vÃ¬ string Ä‘Æ°á»£c triá»ƒn khai dÆ°á»›i dáº¡ng táº­p há»£p cÃ¡c byte, Ä‘Æ°á»£c thÃªm vÃ o má»™t sá»‘ phÆ°Æ¡ng thá»©c Ä‘á»ƒ cung cáº¥p chá»©c nÄƒng há»¯u Ã­ch khi cÃ¡c byte Ä‘Ã³ Ä‘Æ°á»£c diá»…n dá»‹ch thÃ nh vÄƒn báº£n. Trong pháº§n nÃ y, chÃºng ta sáº½ nÃ³i vá» cÃ¡c thao tÃ¡c trÃªn <code>String</code> mÃ  má»i loáº¡i táº­p há»£p Ä‘á»u cÃ³, cháº³ng háº¡n nhÆ° táº¡o, cáº­p nháº­t vÃ  truy xuáº¥t. ChÃºng ta cÅ©ng sáº½ tháº£o luáº­n vá» nhá»¯ng cÃ¡ch mÃ  má»™t <code>String</code> khÃ¡c vá»›i cÃ¡c táº­p há»£p khÃ¡c, cá»¥ thá»ƒ lÃ  cÃ¡ch láº­p chá»‰ má»¥c index trong <code>String</code> lÃ  phá»©c táº¡p bá»Ÿi sá»± khÃ¡c biá»‡t giá»¯a cÃ¡ch con ngÆ°á»i vÃ  mÃ¡y tÃ­nh diá»…n giáº£i dá»¯ liá»‡u <code>String</code>.</p>
<h3 id="string-lÃ -gÃ¬"><a class="header" href="#string-lÃ -gÃ¬">String lÃ  gÃ¬?</a></h3>
<p>TrÆ°á»›c tiÃªn, chÃºng ta sáº½ xÃ¡c Ä‘á»‹nh nhá»¯ng gÃ¬ chÃºng ta hiá»ƒu vá» khÃ¡i niá»‡m <em>string</em>. Rust chá»‰ cÃ³ má»™t kiá»ƒu chuá»—i trong pháº§n lÃµi cá»§a ngÃ´n ngá»¯, Ä‘Ã³ lÃ  Ä‘oáº¡n chuá»—i <code>str</code> thÆ°á»ng Ä‘Æ°á»£c tháº¥y á»Ÿ dáº¡ng mÆ°á»£n tham chiáº¿u <code>&amp;str</code>. Trong ChÆ°Æ¡ng 4, chÃºng ta Ä‘Ã£ nÃ³i vá» <em>string slices</em>, lÃ  cÃ¡c tham chiáº¿u Ä‘áº¿n má»™t sá»‘ dá»¯ liá»‡u chuá»—i mÃ£ hÃ³a UTF-8 Ä‘Æ°á»£c lÆ°u trá»¯ á»Ÿ má»™t nÆ¡i nÃ o Ä‘Ã³. VÃ­ dá»¥: cÃ¡c chuá»—i kÃ½ tá»± Ä‘Æ°á»£c lÆ°u trá»¯ cá»‘ Ä‘á»‹nh trong táº­p tin nhá»‹ phÃ¢n cá»§a chÆ°Æ¡ng trÃ¬nh vÃ  do Ä‘Ã³ Ä‘Æ°á»£c gá»i lÃ  cÃ¡c Ä‘oáº¡n chuá»—i (string slices).</p>
<p>Loáº¡i <code>String</code>, Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n tiÃªu chuáº©n cá»§a Rust thay vÃ¬ Ä‘Æ°á»£c láº­p trÃ¬nh nhÆ° lÃ  thÃ nh pháº§n lÃµi cá»§a ngÃ´n ngá»¯, lÃ  loáº¡i chuá»—i Ä‘Æ°á»£c mÃ£ hÃ³a UTF-8 cÃ³ thá»ƒ tÄƒng kÃ­ch cá»¡, cÃ³ thá»ƒ thay Ä‘á»•i, cÃ³ thá»ƒ sá»Ÿ há»¯u. Khi cÃ¡c tÃ­n Ä‘á»“ Rust Ä‘á» cáº­p Ä‘áº¿n â€œstringsâ€ trong Rust, há» cÃ³ thá»ƒ Ä‘ang Ä‘á» cáº­p Ä‘áº¿n cáº£ 2 loáº¡i <code>String</code> hoáº·c <code>&amp;str</code>, khÃ´ng chá»‰ lÃ  má»™t loáº¡i cá»¥ thá»ƒ trong 2 loáº¡i Ä‘Ã³. Máº·c dÃ¹ pháº§n nÃ y chá»§ yáº¿u nÃ³i vá» <code>String</code>, nhÆ°ng cáº£ hai loáº¡i Ä‘á»u Ä‘Æ°á»£c sá»­ dá»¥ng nhiá»u trong thÆ° viá»‡n tiÃªu chuáº©n cá»§a Rust vÃ  cáº£ <code>String</code> vÃ  <code>&amp;str</code> Ä‘á»u Ä‘Æ°á»£c mÃ£ hÃ³a UTF-8.</p>
<h3 id="táº¡o-má»›i-má»™t-string"><a class="header" href="#táº¡o-má»›i-má»™t-string">Táº¡o má»›i má»™t String</a></h3>
<p>Nhiá»u thao tÃ¡c tÆ°Æ¡ng tá»± cÃ³ sáºµn trong <code>Vec&lt;T&gt;</code> cÅ©ng cÃ³ sáºµn vá»›i <code>String</code>, bá»Ÿi vÃ¬ <code>String</code> thá»±c sá»± bá»c láº¡i má»™t vector kiá»ƒu byte vÃ  cÃ³ bá»• sung thÃªm sá»± Ä‘áº£m báº£o, sá»± háº¡n cháº¿ vÃ  kháº£ nÄƒng lÆ°u trá»¯. VÃ­ dá»¥ vá» má»™t hÃ m hoáº¡t Ä‘á»™ng theo cÃ¹ng má»™t cÃ¡ch vá»›i <code>Vec&lt;T&gt;</code> vÃ  <code>String</code> lÃ  hÃ m <code>new</code> Ä‘á»ƒ táº¡o má»™t Ä‘á»‘i tÆ°á»£ng má»›i, Ä‘Æ°á»£c thá»ƒ hiá»‡n trong má»¥c 8-11.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let mut s = String::new();
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-11: Táº¡o má»›i má»™t <code>String</code> rá»—ng.</span></p>
<p>DÃ²ng nÃ y táº¡o má»™t má»›i má»™t chuá»—i rá»—ng cÃ³ tÃªn lÃ  <code>s</code>, sau Ä‘Ã³ chÃºng ta cÃ³ thá»ƒ táº£i dá»¯ liá»‡u vÃ o. ThÃ´ng thÆ°á»ng, chÃºng ta sáº½ cÃ³ dá»¯ liá»‡u khá»Ÿi táº¡o mÃ  chÃºng ta muá»‘n báº¯t Ä‘áº§u. Äá»ƒ lÃ m Ä‘iá»u nÃ y, chÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>to_string</code>, cÃ³ sáºµn trÃªn báº¥t ká»³ kiá»ƒu nÃ o triá»ƒn khai Ä‘á»‘i tÆ°á»£ng Ä‘áº·c táº£ <code>Display</code>, nhÆ° cÃ¡c kÃ½ tá»± chuá»—i thá»±c hiá»‡n. Má»¥c 8-12 cho tháº¥y hai vÃ­ dá»¥.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let data = "initial contents";

    let s = data.to_string();

    // The method also works on a literal directly:
    let s = "initial contents".to_string();
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-12: DÃ¹ng phÆ°Æ¡ng thá»©c <code>to_string</code> Ä‘á»ƒ táº¡o má»›i <code>String</code> tá»« má»™t chuá»—i kÃ½ tá»±</span></p>
<p>Äoáº¡n mÃ£ nÃ y táº¡o má»™t string chá»©a <code>initial contents</code>.</p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ dÃ¹ng hÃ m <code>String::from</code> Ä‘á»ƒ táº¡o má»™t <code>String</code> tá»« chuá»—i kÃ½ tá»±. Äoáº¡n code á»Ÿ má»¥c 8-13 tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i Ä‘oáº¡n code cá»§a má»¥c 8-12 sá»­ dá»¥ng <code>to_string</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let s = String::from("initial contents");
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-13: DÃ¹ng hÃ m <code>String::from</code> Ä‘á»ƒ táº¡o má»™t <code>String</code> tá»« má»™t chuá»—i kÃ½ tá»±</span></p>
<p>Bá»Ÿi vÃ¬ chuá»—i Ä‘Æ°á»£c sá»­ dá»¥ng cho ráº¥t nhiá»u thá»©, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng nhiá»u API chung khÃ¡c nhau cho chuá»—i, cung cáº¥p cho chÃºng ta ráº¥t nhiá»u tÃ¹y chá»n. Má»™t sá»‘ trong Ä‘Ã³ cÃ³ váº» thá»«a, nhÆ°ng chÃºng Ä‘á»u cÃ³ vá»‹ trÃ­ cá»§a chÃºng! Trong trÆ°á»ng há»£p nÃ y, <code>String::from</code> vÃ  <code>to_string</code> lÃ m tÆ°Æ¡ng tá»± nhau, vÃ¬ váº­y báº¡n chá»n cÃ¡i nÃ o lÃ  do phong cÃ¡ch vÃ  tÃ­nh dá»… Ä‘á»c cá»§a chÆ°Æ¡ng trÃ¬nh.</p>
<p>HÃ£y nhá»› ráº±ng chuá»—i cÆ¡ báº£n Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng UTF-8, vÃ¬ váº­y chÃºng cÃ³ thá»ƒ bao gá»“m báº¥t ká»³ dá»¯ liá»‡u nÃ o Ä‘Æ°á»£c mÃ£ hÃ³a Ä‘Ãºng cÃ¡ch, nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ trong má»¥c 8-14.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let hello = String::from("Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…");
    let hello = String::from("DobrÃ½ den");
    let hello = String::from("Hello");
    let hello = String::from("×©×œ×•×");
    let hello = String::from("à¤¨à¤®à¤¸à¥à¤¤à¥‡");
    let hello = String::from("ã“ã‚“ã«ã¡ã¯");
    let hello = String::from("ì•ˆë…•í•˜ì„¸ìš”");
    let hello = String::from("ä½ å¥½");
    let hello = String::from("OlÃ¡");
    let hello = String::from("Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ");
    let hello = String::from("Hola");
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-14: LÆ°u cÃ¡c lá»i chÃ o báº±ng nhiá»u ngÃ´n ngá»¯ khÃ¡c nhau trong chuá»—i</span></p>
<p>Táº¥t cáº£ Ä‘á»u lÃ  <code>String</code> há»£p lá»‡.</p>
<h3 id="cáº­p-nháº­t-má»™t-string"><a class="header" href="#cáº­p-nháº­t-má»™t-string">Cáº­p nháº­t má»™t String</a></h3>
<p>Má»™t <code>String</code> cÃ³ kháº£ nÄƒng tÄƒng kÃ­ch thÆ°á»›c vÃ  ná»™i dung cá»§a nÃ³ cÃ³ thá»ƒ thay Ä‘á»•i, nÃ³ giá»‘ng nhÆ° ná»™i dung cá»§a <code>Vec&lt;T&gt;</code> náº¿u báº¡n Ä‘Æ°a nhiá»u dá»¯ liá»‡u hÆ¡n vÃ o Ä‘Ã³. NgoÃ i ra, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng toÃ¡n tá»­ <code>+</code> hoáº·c macro <code>format!</code> Ä‘á»ƒ ná»‘i cÃ¡c giÃ¡ trá»‹ <code>String</code> má»™t cÃ¡ch thuáº­n tiá»‡n.</p>
<h4 id="thÃªm-vÃ o-cuá»‘i-append-chuá»—i-báº±ng-push_str-vÃ -push"><a class="header" href="#thÃªm-vÃ o-cuá»‘i-append-chuá»—i-báº±ng-push_str-vÃ -push">ThÃªm vÃ o cuá»‘i (append) chuá»—i báº±ng <code>push_str</code> vÃ  <code>push</code></a></h4>
<p>ChÃºng ta cÃ³ thá»ƒ tÄƒng kÃ­ch thÆ°á»›c má»™t <code>String</code> báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>push_str</code> Ä‘á»ƒ ná»‘i thÃªm má»™t Ä‘oáº¡n chuá»—i, nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ trong má»¥c 8-15.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let mut s = String::from("foo");
    s.push_str("bar");
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-15: Ná»‘i chuá»—i vÃ o má»™t <code>String</code> sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>push_str</code></span></p>
<p>Sau hai dÃ²ng nÃ y, <code>s</code> sáº½ chá»©a <code>foobar</code>. PhÆ°Æ¡ng thá»©c <code>push_str</code> cÃ³ tham sá»‘ lÃ  má»™t Ä‘oáº¡n chuá»—i (<code>&amp;str</code>) vÃ¬ chÃºng ta khÃ´ng nháº¥t thiáº¿t chiáº¿m quyá»n sá»Ÿ há»¯u tham sá»‘ Ä‘Ã³. VÃ­ dá»¥, trong mÃ£ trong má»¥c 8-16, chÃºng ta muá»‘n cÃ³ thá»ƒ sá»­ dá»¥ng láº¡i <code>s2</code> sau khi thÃªm ná»™i dung cá»§a nÃ³ vÃ o <code>s1</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let mut s1 = String::from("foo");
    let s2 = "bar";
    s1.push_str(s2);
    println!("s2 is {s2}");
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-16: Sá»­ dá»¥ng láº¡i má»™t Ä‘oáº¡n chuá»—i sau khi thÃªm ná»™i dung cá»§a nÃ³ vÃ o má»™t <code>String</code> khÃ¡c</span></p>
<p>Náº¿u phÆ°Æ¡ng thá»©c <code>push_str</code> chiáº¿m quyá»n sá»Ÿ há»¯u cá»§a <code>s2</code>, chÃºng ta sáº½ khÃ´ng thá»ƒ in giÃ¡ trá»‹ cá»§a nÃ³ táº¡i dÃ²ng cuá»‘i. Tuy nhiÃªn, Ä‘oáº¡n mÃ£ nÃ y hoáº¡t Ä‘á»™ng nhÆ° mong Ä‘á»£i!</p>
<p>PhÆ°Æ¡ng thá»©c <code>push</code> nháº­n kÃ½ tá»± Ä‘Æ¡n lÃ m tham sá»‘ vÃ  thÃªm nÃ³ vÃ o <code>String</code>. Má»¥c 8-17 thÃªm kÃ½ tá»± â€œlâ€ vÃ o má»™t <code>String</code> báº±ng phÆ°Æ¡ng thá»©c <code>push</code></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let mut s = String::from("lo");
    s.push('l');
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-17: ThÃªm má»™t kÃ½ tá»± vÃ o giÃ¡ trá»‹ <code>String</code> báº±ng cÃ¡ch dÃ¹ng phÆ°Æ¡ng thá»©c <code>push</code></span></p>
<p>Káº¿t quáº£ lÃ , <code>s</code> sáº½ chá»©a <code>lol</code>.</p>
<p><a id="concatenation-with-the--operator-or-the-format-macro"></a></p>
<h4 id="ná»‘i-chuá»—i-vá»›i-toÃ¡n-tá»­--hoáº·c-macro-format"><a class="header" href="#ná»‘i-chuá»—i-vá»›i-toÃ¡n-tá»­--hoáº·c-macro-format">Ná»‘i chuá»—i vá»›i toÃ¡n tá»­ <code>+</code> hoáº·c macro <code>format!</code></a></h4>
<p>ThÃ´ng thÆ°á»ng, báº¡n sáº½ muá»‘n káº¿t há»£p hai chuá»—i hiá»‡n cÃ³. CÃ³ má»™t cÃ¡ch Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y lÃ  dÃ¹ng toÃ¡n tá»­ <code>+</code>, Ä‘Æ°á»£c thá»ƒ hiá»‡n á»Ÿ má»¥c 8-18</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let s1 = String::from("Hello, ");
    let s2 = String::from("world!");
    let s3 = s1 + &amp;s2; // note s1 has been moved here and can no longer be used
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-18: dÃ¹ng toÃ¡n tá»­ <code>+</code> Ä‘á»ƒ káº¿t há»£p hai chuá»—i thÃ nh má»™t chuá»—i má»›i</span></p>
<p>Chuá»—i <code>s3</code> sáº½ chá»©a <code>Hello, world!</code>. LÃ½ do <code>s1</code> khÃ´ng cÃ²n há»£p lá»‡ ná»¯a sau khi thÃªm vÃ  lÃ½ do chÃºng ta sá»­ dá»¥ng tham chiáº¿u Ä‘áº¿n <code>s2</code> cÃ³ liÃªn quan Ä‘áº¿n phÆ°Æ¡ng thá»©c bÃªn dÆ°á»›i thá»±c sá»± cá»§a toÃ¡n tá»­ <code>+</code>. ToÃ¡n tá»­ <code>+</code> sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>add</code>, cÃ³ cÃ¡ch biá»ƒu diá»…n trÃ´ng giá»‘ng nhÆ° sau:</p>
<pre><code class="language-rust ignore">fn add(self, s: &amp;str) -&gt; String {</code></pre>
<p>Trong thÆ° viá»‡n chuáº©n, báº¡n sáº½ tháº¥y <code>add</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a báº±ng cÃ¡ch sá»­ dá»¥ng generic vÃ  cÃ¡c loáº¡i liÃªn quan. á» Ä‘Ã¢y, chÃºng ta Ä‘Ã£ thay tháº¿ báº±ng cÃ¡c loáº¡i cá»¥ thá»ƒ, Ä‘Ã³ lÃ  Ä‘iá»u xáº£y ra khi chÃºng ta gá»i phÆ°Æ¡ng thá»©c nÃ y báº±ng cÃ¡c giÃ¡ trá»‹ <code>String</code>. ChÃºng ta sáº½ tháº£o luáº­n vá» generic trong ChÆ°Æ¡ng 10. ThÃ´ng qua phÆ°Æ¡ng thá»©c bÃªn dÆ°á»›i nÃ y, sáº½ cho chÃºng ta nhá»¯ng manh má»‘i Ä‘á»ƒ hiá»ƒu vá» nhá»¯ng Ä‘iá»ƒm phá»©c táº¡p cá»§a toÃ¡n tá»­ <code>+</code>.</p>
<p>Äáº§u tiÃªn, <code>s2</code> cÃ³ dáº¥u <code>&amp;</code>, nghÄ©a lÃ  chÃºng ta Ä‘ang thÃªm má»™t <em>tham chiáº¿u</em> cá»§a chuá»—i thá»© hai vÃ o chuá»—i Ä‘áº§u tiÃªn. Äiá»u nÃ y lÃ  do tham sá»‘ <code>s</code> trong hÃ m <code>add</code>: chÃºng ta chá»‰ cÃ³ thá»ƒ thÃªm má»™t kiá»ƒu <code>&amp;str</code> vÃ o má»™t <code>String</code>; chÃºng ta khÃ´ng thá»ƒ thÃªm hai giÃ¡ trá»‹ <code>String</code> láº¡i vá»›i nhau. NhÆ°ng chá» Ä‘Ã£ - kiá»ƒu cá»§a <code>&amp;s2</code> lÃ  <code>&amp;String</code>, khÃ´ng pháº£i lÃ  <code>&amp;str</code> nhÆ° Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong tham sá»‘ thá»© hai cá»§a <code>add</code>. Váº­y táº¡i sao Ä‘oáº¡n code cá»§a má»¥c 8-18 biÃªn dá»‹ch Ä‘Æ°á»£c?</p>
<p>LÃ½ do chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng <code>&amp;s2</code> trong lá»‡nh gá»i tá»›i <code>add</code> lÃ  trÃ¬nh biÃªn dá»‹ch cÃ³ thá»ƒ <em>Ã©p kiá»ƒu</em> Ä‘á»‘i sá»‘ <code>&amp;String</code> thÃ nh má»™t <code>&amp;str</code>. Khi chÃºng ta gá»i phÆ°Æ¡ng thá»©c <code>add</code>, Rust sá»­ dá»¥ng má»™t <em>Ã©p kiá»ƒu tá»± Ä‘á»™ng</em>, mÃ  cá»¥ thá»ƒ á»Ÿ Ä‘Ã¢y sáº½ biáº¿n<code>&amp;s2</code> thÃ nh <code>&amp;s2[..]</code>. ChÃºng ta sáº½ tháº£o luáº­n sÃ¢u hÆ¡n vá» Ã©p kiá»ƒu tá»± Ä‘á»™ng trong ChÆ°Æ¡ng 15. Bá»Ÿi vÃ¬ <code>add</code> khÃ´ng chiáº¿m quyá»n sá»Ÿ há»¯u tham sá»‘ <code>s</code> nÃªn <code>s2</code> sáº½ váº«n lÃ  má»™t <code>String</code> há»£p lá»‡ sau thao tÃ¡c nÃ y.</p>
<p>Thá»© hai, chÃºng ta cÃ³ thá»ƒ tháº¥y trong phÆ°Æ¡ng thá»©c Ä‘áº¡i diá»‡n ráº±ng, <code>add</code> chiáº¿m quyá»n sá»Ÿ há»¯u <code>self</code> bá»Ÿi vÃ¬ <code>self</code> <em>khÃ´ng</em> cÃ³ dáº¥u <code>&amp;</code>. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  quyá»n sá»Ÿ há»¯u cá»§a <code>s1</code> trong má»¥c 8-18 sáº½ Ä‘Æ°á»£c chuyá»ƒn vÃ o lá»‡nh gá»i <code>add</code> vÃ  sáº½ khÃ´ng cÃ²n há»£p lá»‡ sau lá»i gá»i Ä‘Ã³ ná»¯a. VÃ¬ váº­y, máº·c dÃ¹ <code>let s3 = s1 + &amp; s2;</code> cÃ³ váº» nhÆ° nÃ³ sáº½ sao chÃ©p cáº£ hai chuá»—i vÃ  táº¡o má»™t chuá»—i má»›i, nhÆ°ng cÃ¢u lá»‡nh nÃ y thá»±c sá»± chiáº¿m quyá»n sá»Ÿ há»¯u cá»§a biáº¿n <code>s1</code>, thÃªm vÃ o cuá»‘i ná»™i dung báº£n sao cá»§a <code>s2</code> vÃ  sau Ä‘Ã³ tráº£ vá» tham chiáº¿u quyá»n sá»Ÿ há»¯u cá»§a káº¿t quáº£. NÃ³i cÃ¡ch khÃ¡c, cÃ³ váº» nhÆ° nÃ³ Ä‘ang táº¡o ra ráº¥t nhiá»u báº£n sao nhÆ°ng khÃ´ng pháº£i váº­y; viá»‡c thá»±c hiá»‡n hiá»‡u quáº£ hÆ¡n sao chÃ©p.</p>
<p>Náº¿u chÃºng ta cáº§n ná»‘i nhiá»u chuá»—i, hÃ nh vi cá»§a toÃ¡n tá»­ <code>+</code> sáº½ khÃ³ sá»­ dá»¥ng:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let s1 = String::from("tic");
    let s2 = String::from("tac");
    let s3 = String::from("toe");

    let s = s1 + "-" + &amp;s2 + "-" + &amp;s3;
<span class="boring">}</span></code></pre></pre>
<p>LÃºc nÃ y, <code>s</code> sáº½ lÃ  <code>tic-tac-toe</code>. Vá»›i cÃ¡c kÃ½ tá»± <code>+</code> vÃ  <code>"</code>, ráº¥t khÃ³ Ä‘á»ƒ biáº¿t Ä‘iá»u gÃ¬ Ä‘ang xáº£y ra. Thay vÃ o Ä‘Ã³, Ä‘á»ƒ káº¿t há»£p nhá»¯ng chuá»—i phá»©c táº¡p hÆ¡n, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng macro <code>format!</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let s1 = String::from("tic");
    let s2 = String::from("tac");
    let s3 = String::from("toe");

    let s = format!("{s1}-{s2}-{s3}");
<span class="boring">}</span></code></pre></pre>
<p>MÃ£ nÃ y cÅ©ng thiáº¿t láº­p <code>s</code> thÃ nh <code>tic-tac-toe</code>. Macro <code>format!</code> hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° <code>println!</code>, nhÆ°ng thay vÃ¬ in káº¿t quáº£ ra mÃ n hÃ¬nh, nÃ³ tráº£ vá» má»™t <code>String</code> kÃ¨m vá»›i ná»™i dung. PhiÃªn báº£n cá»§a Ä‘oáº¡n mÃ£ sá»­ dá»¥ng <code>format!</code> dá»… Ä‘á»c hÆ¡n nhiá»u vÃ  mÃ£ Ä‘Æ°á»£c táº¡o bá»Ÿi macro <code>format!</code> sá»­ dá»¥ng cÃ¡c tham chiáº¿u Ä‘á»ƒ lá»‡nh gá»i nÃ y khÃ´ng chiáº¿m quyá»n sá»Ÿ há»¯u báº¥t ká»³ tham sá»‘ nÃ o cá»§a nÃ³.</p>
<h3 id="chá»‰-má»¥c-index-Ä‘áº¿n-string"><a class="header" href="#chá»‰-má»¥c-index-Ä‘áº¿n-string">Chá»‰ má»¥c index Ä‘áº¿n String</a></h3>
<p>Trong nhiá»u ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c, truy cáº­p Ä‘áº¿n cÃ¡c kÃ½ tá»± riÃªng láº» trong má»™t chuá»—i báº±ng cÃ¡ch tham chiáº¿u theo chá»‰ má»¥c lÃ  má»™t thao tÃ¡c há»£p lá»‡ vÃ  phá»• biáº¿n. Tuy nhiÃªn, náº¿u báº¡n cá»‘ truy cáº­p cÃ¡c pháº§n cá»§a <code>String</code> báº±ng cÃº phÃ¡p chá»‰ má»¥c index trong Rust, báº¡n sáº½ gáº·p lá»—i. Xem xÃ©t mÃ£ khÃ´ng há»£p lá»‡ trong má»¥c 8-19.</p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span>    let s1 = String::from("hi");
    let h = s1[0];
<span class="boring">}</span></code></pre>
<p><span class="caption">Má»¥c 8-19: Cá»‘ dÃ¹ng cÃº phÃ¡p index trong String</span></p>
<p>Äoáº¡n mÃ£ nÃ y sáº½ tráº£ vá» káº¿t quáº£ lá»—i sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling collections v0.1.0 (file:///projects/collections)
error[E0277]: the type `str` cannot be indexed by `{integer}`
 --&gt; src/main.rs:3:16
  |
3 |     let h = s1[0];
  |                ^ string indices are ranges of `usize`
  |
  = note: you can use `.chars().nth()` or `.bytes().nth()`
          for more information, see chapter 8 in The Book: &lt;https://doc.rust-lang.org/book/ch08-02-strings.html#indexing-into-strings&gt;
  = help: the trait `SliceIndex&lt;str&gt;` is not implemented for `{integer}`
          but trait `SliceIndex&lt;[_]&gt;` is implemented for `usize`
  = help: for that trait implementation, expected `[_]`, found `str`
  = note: required for `String` to implement `Index&lt;{integer}&gt;`

For more information about this error, try `rustc --explain E0277`.
error: could not compile `collections` (bin "collections") due to 1 previous error
</code></pre>
<p>Lá»—i vÃ  ghi chÃº vá» viá»‡c lá»—i nÃ y lÃ : chuá»—i trong Rust khÃ´ng há»— trá»£ chá»‰ má»¥c index. NhÆ°ng táº¡i sao khÃ´ng? Äá»ƒ tráº£ lá»i cÃ¢u há»i Ä‘Ã³, chÃºng ta cáº§n tháº£o luáº­n vá» cÃ¡ch Rust lÆ°u trá»¯ cÃ¡c chuá»—i trong bá»™ nhá»›.</p>
<h4 id="mÃ´-táº£-cÃ¡ch-hoáº¡t-Ä‘á»™ng-bÃªn-trong"><a class="header" href="#mÃ´-táº£-cÃ¡ch-hoáº¡t-Ä‘á»™ng-bÃªn-trong">MÃ´ táº£ cÃ¡ch hoáº¡t Ä‘á»™ng bÃªn trong</a></h4>
<p><code>String</code> lÃ  má»™t kiá»ƒu bá»c láº¡i kiá»ƒu <code>Vec&lt;u8&gt;</code>. HÃ£y xem xÃ©t má»™t sá»‘ chuá»—i UTF-8 Ä‘Æ°á»£c mÃ£ hÃ³a Ä‘Ãºng cÃ¡ch tá»« má»¥c 8-14. Äáº§u tiÃªn lÃ  dÃ²ng nÃ y:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span><span class="boring">    let hello = String::from("Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…");
</span><span class="boring">    let hello = String::from("DobrÃ½ den");
</span><span class="boring">    let hello = String::from("Hello");
</span><span class="boring">    let hello = String::from("×©×œ×•×");
</span><span class="boring">    let hello = String::from("à¤¨à¤®à¤¸à¥à¤¤à¥‡");
</span><span class="boring">    let hello = String::from("ã“ã‚“ã«ã¡ã¯");
</span><span class="boring">    let hello = String::from("ì•ˆë…•í•˜ì„¸ìš”");
</span><span class="boring">    let hello = String::from("ä½ å¥½");
</span><span class="boring">    let hello = String::from("OlÃ¡");
</span><span class="boring">    let hello = String::from("Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ");
</span>    let hello = String::from("Hola");
<span class="boring">}</span></code></pre></pre>
<p>Trong trÆ°á»ng há»£p nÃ y, <code>len</code> sáº½ lÃ  4, cÃ³ nghÄ©a lÃ  vector lÆ°u trá»¯ chuá»—i â€œHolaâ€ dÃ i 4 byte. Má»—i chá»¯ cÃ¡i nÃ y chiáº¿m 1 byte khi Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng UTF-8. Tuy nhiÃªn, dÃ²ng sau Ä‘Ã¢y cÃ³ thá»ƒ lÃ m báº¡n ngáº¡c nhiÃªn. (LÆ°u Ã½ ráº±ng chuá»—i nÃ y báº¯t Ä‘áº§u báº±ng chá»¯ cÃ¡i Cyrillic viáº¿t hoa Ze, khÃ´ng pháº£i sá»‘ 3 trong tiáº¿ng áº¢ Ráº­p)</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span><span class="boring">    let hello = String::from("Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…");
</span><span class="boring">    let hello = String::from("DobrÃ½ den");
</span><span class="boring">    let hello = String::from("Hello");
</span><span class="boring">    let hello = String::from("×©×œ×•×");
</span><span class="boring">    let hello = String::from("à¤¨à¤®à¤¸à¥à¤¤à¥‡");
</span><span class="boring">    let hello = String::from("ã“ã‚“ã«ã¡ã¯");
</span><span class="boring">    let hello = String::from("ì•ˆë…•í•˜ì„¸ìš”");
</span><span class="boring">    let hello = String::from("ä½ å¥½");
</span><span class="boring">    let hello = String::from("OlÃ¡");
</span>    let hello = String::from("Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ");
<span class="boring">    let hello = String::from("Hola");
</span><span class="boring">}</span></code></pre></pre>
<p>Khi Ä‘Æ°á»£c há»i chuá»—i dÃ i bao nhiÃªu, báº¡n cÃ³ thá»ƒ tráº£ lá»i lÃ  12. Thá»±c táº¿, cÃ¢u tráº£ lá»i cá»§a Rust lÃ  24: Ä‘Ã³ lÃ  sá»‘ byte cáº§n thiáº¿t Ä‘á»ƒ mÃ£ hÃ³a â€œĞ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµâ€ trong UTF-8, bá»Ÿi vÃ¬ má»—i giÃ¡ trá»‹ vÃ´ hÆ°á»›ng Unicode trong chuá»—i Ä‘Ã³ chiáº¿m 2 byte dung lÆ°á»£ng lÆ°u trá»¯ . Do Ä‘Ã³, má»™t chá»‰ má»¥c index trá» Ä‘áº¿n cÃ¡c byte cá»§a chuá»—i sáº½ khÃ´ng pháº£i lÃºc nÃ o cÅ©ng tÆ°Æ¡ng á»©ng vá»›i má»™t giÃ¡ trá»‹ vÃ´ hÆ°á»›ng Unicode há»£p lá»‡. Äá»ƒ chá»©ng minh, hÃ£y xem xÃ©t mÃ£ Rust khÃ´ng há»£p lá»‡ nÃ y:</p>
<pre><code class="language-rust ignore does_not_compile">let hello = "Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ";
let answer = &amp;hello[0];</code></pre>
<p>Báº¡n biáº¿t ráº±ng <code>cÃ¢u tráº£ lá»i</code> cá»§a chá»¯ cÃ¡i Ä‘áº§u tiÃªn sáº½ khÃ´ng pháº£i lÃ  <code>Ğ—</code>. Khi Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng UTF-8, byte Ä‘áº§u tiÃªn cá»§a <code>Ğ—</code> lÃ  <code>208</code> vÃ  byte thá»© hai lÃ  <code>151</code>, vÃ¬ váº­y, cÃ³ váº» nhÆ° <code>cÃ¢u tráº£ lá»i</code> trÃªn thá»±c táº¿ pháº£i lÃ  <code>208</code>, nhÆ°ng <code>208</code> khÃ´ng pháº£i lÃ  kÃ½ tá»± há»£p lá»‡ theo riÃªng nÃ³. Tráº£ vá» <code>208</code> cÃ³ thá»ƒ khÃ´ng pháº£i lÃ  nhá»¯ng gÃ¬ ngÆ°á»i dÃ¹ng muá»‘n náº¿u há» yÃªu cáº§u kÃ½ tá»± Ä‘áº§u tiÃªn cá»§a chuá»—i nÃ y; tuy nhiÃªn, Ä‘Ã³ lÃ  dá»¯ liá»‡u duy nháº¥t mÃ  Rust cÃ³ á»Ÿ chá»‰ má»¥c byte sá»‘ 0. NgÆ°á»i dÃ¹ng thÆ°á»ng khÃ´ng muá»‘n giÃ¡ trá»‹ byte Ä‘Æ°á»£c tráº£ vá», ngay cáº£ khi chuá»—i chá»‰ chá»©a cÃ¡c chá»¯ cÃ¡i Latinh: náº¿u <code>&amp;"hello"[0]</code> lÃ  mÃ£ há»£p lá»‡ tráº£ vá» giÃ¡ trá»‹ byte, nÃ³ sáº½ tráº£ vá» <code>104</code>, khÃ´ng pháº£i <code>h</code>.</p>
<p>VÃ¬ váº­y, Ä‘á»ƒ trÃ¡nh tráº£ vá» má»™t giÃ¡ trá»‹ khÃ´ng mong muá»‘n vÃ  gÃ¢y ra cÃ¡c lá»—i mÃ  cÃ³ thá»ƒ khÃ´ng Ä‘Æ°á»£c phÃ¡t hiá»‡n ngay láº­p tá»©c, cÃ¢u tráº£ lá»i lÃ : Rust khÃ´ng biÃªn dá»‹ch mÃ£ nÃ y gÃ¬ háº¿t vÃ  ngÄƒn cháº·n sá»± hiá»ƒu láº§m sá»›m trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn.</p>
<h4 id="byte-giÃ¡-trá»‹-vÃ´-hÆ°á»›ng-scalar-vÃ -cÃ¡c-cá»¥m-kÃ½-tá»±-káº¿t-há»£p-grapheme-Ã”i-trá»i"><a class="header" href="#byte-giÃ¡-trá»‹-vÃ´-hÆ°á»›ng-scalar-vÃ -cÃ¡c-cá»¥m-kÃ½-tá»±-káº¿t-há»£p-grapheme-Ã”i-trá»i">Byte, giÃ¡ trá»‹ vÃ´ hÆ°á»›ng (scalar) vÃ  cÃ¡c cá»¥m kÃ½ tá»± káº¿t há»£p (grapheme)! Ã”i trá»i!</a></h4>
<p>Má»™t Ä‘iá»ƒm khÃ¡c vá» UTF-8 lÃ  trÃªn thá»±c táº¿ cÃ³ ba cÃ¡ch liÃªn quan Ä‘á»ƒ xem xÃ©t chuá»—i tá»« quan Ä‘iá»ƒm cá»§a Rust: dÆ°á»›i dáº¡ng byte, giÃ¡ trá»‹ vÃ´ hÆ°á»›ng (scalar) vÃ  cá»¥m kÃ½ tá»± káº¿t há»£p (grapheme) (thá»© gáº§n nháº¥t vá»›i nhá»¯ng gÃ¬ chÃºng ta gá»i lÃ  <em>chá»¯ cÃ¡i</em>).</p>
<p>Náº¿u chÃºng ta nhÃ¬n vÃ o tá»« tiáº¿ng Hindi â€œà¤¨à¤®à¤¸à¥à¤¤à¥‡â€ Ä‘Æ°á»£c viáº¿t báº±ng chá»¯ viáº¿t Devanagari, nÃ³ Ä‘Æ°á»£c lÆ°u trá»¯ dÆ°á»›i dáº¡ng vector cá»§a cÃ¡c giÃ¡ trá»‹ <code>u8</code> trÃ´ng giá»‘ng nhÆ° sau:</p>
<pre><code class="language-text">[224, 164, 168, 224, 164, 174, 224, 164, 184, 224, 165, 141, 224, 164, 164,
224, 165, 135]
</code></pre>
<p>ÄÃ³ lÃ  18 byte vÃ  lÃ  cÃ¡ch mÃ¡y tÃ­nh cuá»‘i cÃ¹ng lÆ°u trá»¯ dá»¯ liá»‡u nÃ y. Náº¿u chÃºng ta xem chÃºng dÆ°á»›i dáº¡ng giÃ¡ trá»‹ vÃ´ hÆ°á»›ng Unicode, lÃ  kiá»ƒu <code>char</code> cá»§a Rust, thÃ¬ nhá»¯ng byte Ä‘Ã³ trÃ´ng nhÆ° tháº¿ nÃ y:</p>
<pre><code class="language-text">['à¤¨', 'à¤®', 'à¤¸', 'à¥', 'à¤¤', 'à¥‡']
</code></pre>
<p>CÃ³ sÃ¡u giÃ¡ trá»‹ <code>char</code> á»Ÿ Ä‘Ã¢y, nhÆ°ng giÃ¡ trá»‹ thá»© tÆ° vÃ  thá»© sÃ¡u khÃ´ng pháº£i lÃ  chá»¯ cÃ¡i thá»±c sá»±: chÃºng lÃ  nhá»¯ng dáº¥u phá»¥ khÃ´ng cÃ³ Ã½ nghÄ©a náº¿u Ä‘á»©ng riÃªng. Cuá»‘i cÃ¹ng, náº¿u chÃºng ta xem chÃºng dÆ°á»›i dáº¡ng cÃ¡c cá»¥m kÃ½ tá»± káº¿t há»£p (grapheme), chÃºng ta sáº½ hiá»ƒu má»™t ngÆ°á»i sáº½ gá»i bá»‘n chá»¯ cÃ¡i táº¡o nÃªn tá»« tiáº¿ng Hindi:</p>
<pre><code class="language-text">["à¤¨", "à¤®", "à¤¸à¥", "à¤¤à¥‡"]
</code></pre>
<p>Rust cung cáº¥p nhá»¯ng cÃ¡ch khÃ¡c nhau Ä‘á»ƒ diá»…n giáº£i dá»¯ liá»‡u chuá»—i thÃ´ mÃ  mÃ¡y tÃ­nh lÆ°u trá»¯ Ä‘á»ƒ má»—i chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ chá»n cÃ¡ch diá»…n giáº£i mÃ  nÃ³ cáº§n, báº¥t ká»ƒ dá»¯ liá»‡u Ä‘Ã³ báº±ng ngÃ´n ngá»¯ con ngÆ°á»i nÃ o.</p>
<p>LÃ½ do cuá»‘i cÃ¹ng lÃ  Rust khÃ´ng cho phÃ©p chÃºng ta láº­p chá»‰ má»¥c cho <code>String</code> Ä‘á»ƒ truy cáº­p má»™t kÃ½ tá»± lÃ , cÃ¡c hoáº¡t Ä‘á»™ng láº­p chá»‰ má»¥c Ä‘Æ°á»£c xem lÃ  luÃ´n máº¥t chi phÃ­ thá»i gian khÃ´ng Ä‘á»•i (O(1)). NhÆ°ng khÃ´ng thá»ƒ Ä‘áº£m báº£o hiá»‡u suáº¥t Ä‘Ã³ báº±ng <code>String</code>, vÃ¬ Rust sáº½ pháº£i láº·p qua háº¿t cÃ¡c ná»™i dung tá»« Ä‘áº§u chuá»—i Ä‘áº¿n vá»‹ trÃ­ index chá»‰ Ä‘á»‹nh Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xem cÃ³ bao nhiÃªu kÃ½ tá»± há»£p lá»‡.</p>
<h3 id="cáº¯t-chuá»—i"><a class="header" href="#cáº¯t-chuá»—i">Cáº¯t chuá»—i</a></h3>
<p>Láº­p chá»‰ má»¥c cho má»™t chuá»—i thÆ°á»ng lÃ  má»™t Ã½ tÆ°á»Ÿng tá»“i vÃ¬ nÃ³ khÃ´ng biáº¿t rÃµ kiá»ƒu tráº£ vá» cá»§a thao tÃ¡c láº¥y giÃ¡ trá»‹ theo index trong chuá»—i lÃ  gÃ¬: giÃ¡ trá»‹ byte, kÃ½ tá»±, má»™t cá»¥m grapheme hay má»™t Ä‘oáº¡n chuá»—i. Do Ä‘Ã³, náº¿u báº¡n thá»±c sá»± cáº§n sá»­ dá»¥ng cÃ¡c chá»‰ sá»‘ Ä‘á»ƒ táº¡o cÃ¡c Ä‘oáº¡n chuá»—i, Rust yÃªu cáº§u báº¡n pháº£i cá»¥ thá»ƒ hÆ¡n ná»¯a.</p>
<p>Thay vÃ¬ láº­p chá»‰ má»¥c báº±ng cÃ¡ch sá»­ dá»¥ng <code>[]</code> vá»›i má»™t sá»‘ Ä‘Æ¡n láº», báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng <code>[]</code> vá»›i má»™t dÃ£y pháº¡m vi Ä‘á»ƒ táº¡o má»™t Ä‘oáº¡n chuá»—i chá»©a cÃ¡c byte cá»¥ thá»ƒ:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let hello = "Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ";

let s = &amp;hello[0..4];
<span class="boring">}</span></code></pre></pre>
<p>á» Ä‘Ã¢y, <code>s</code> sáº½ lÃ  má»™t <code>&amp;str</code> chá»©a 4 byte Ä‘áº§u tiÃªn cá»§a chuá»—i.
TrÆ°á»›c Ä‘Ã³, chÃºng tÃ´i Ä‘Ã£ Ä‘á» cáº­p ráº±ng má»—i kÃ½ tá»± nÃ y lÃ  2 byte, cÃ³ nghÄ©a lÃ  <code>s</code> sáº½ lÃ  <code>Ğ—Ğ´</code>.</p>
<p>Náº¿u chÃºng ta cá»‘ thá»­ cáº¯t chuá»—i chá»‰ má»™t pháº§n byte cá»§a má»™t kÃ½ tá»±, Ä‘áº¡i loáº¡i má»™t thá»© gÃ¬ Ä‘Ã³ nhÆ° <code>&amp;hello[0..1]</code>, Rust sáº½ gÃ¢y lá»—i lÃºc cháº¡y giá»‘ng nhÆ° trÆ°á»ng há»£p dÃ¹ng chá»‰ má»¥c index khÃ´ng há»£p lá»‡ truy cáº­p pháº§n tá»­ trong má»™t vector:</p>
<pre><code class="language-console">$ cargo run
   Compiling collections v0.1.0 (file:///projects/collections)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.43s
     Running `target/debug/collections`

thread 'main' panicked at src/main.rs:4:19:
byte index 1 is not a char boundary; it is inside 'Ğ—' (bytes 0..2) of `Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ`
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>Báº¡n nÃªn sá»­ dá»¥ng cÃ¡c dÃ£y pháº¡m vi Ä‘á»ƒ táº¡o cÃ¡c Ä‘oáº¡n chuá»—i má»™t cÃ¡ch tháº­n trá»ng, vÃ¬ lÃ m nhÆ° váº­y cÃ³ thá»ƒ lÃ m há»ng chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n.</p>
<h3 id="cÃ¡ch-duyá»‡t-qua-cÃ¡c-pháº§n-tá»­-cá»§a-chuá»—i"><a class="header" href="#cÃ¡ch-duyá»‡t-qua-cÃ¡c-pháº§n-tá»­-cá»§a-chuá»—i">CÃ¡ch duyá»‡t qua cÃ¡c pháº§n tá»­ cá»§a chuá»—i</a></h3>
<p>CÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ thao tÃ¡c trÃªn cÃ¡c pháº§n cá»§a chuá»—i lÃ  pháº£i rÃµ rÃ ng vá» viá»‡c báº¡n mong muá»‘n: kiá»ƒu kÃ½ tá»± hay kiá»ƒu byte. Äá»‘i vá»›i cÃ¡c giÃ¡ trá»‹ vÃ´ hÆ°á»›ng Unicode riÃªng láº», hÃ£y sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>chars</code>. Viá»‡c gá»i <code>chars</code> trÃªn â€œĞ—Ğ´â€ sáº½ tÃ¡ch chuá»—i ra vÃ  tráº£ vá» hai giÃ¡ trá»‹ kiá»ƒu <code>char</code> vÃ  báº¡n cÃ³ thá»ƒ láº·p qua káº¿t quáº£ nÃ y Ä‘á»ƒ truy cáº­p tá»«ng pháº§n tá»­:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>for c in "Ğ—Ğ´".chars() {
    println!("{c}");
}
<span class="boring">}</span></code></pre></pre>
<p>Äoáº¡n mÃ£ nÃ y sáº½ in ra nhÆ° sau:</p>
<pre><code class="language-text">Ğ—
Ğ´
</code></pre>
<p>NgoÃ i ra, phÆ°Æ¡ng thá»©c <code>bytes</code> tráº£ vá» tá»«ng byte thÃ´, cÃ³ thá»ƒ phÃ¹ há»£p vá»›i lÄ©nh vá»±c cá»§a báº¡n:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>for b in "Ğ—Ğ´".bytes() {
    println!("{b}");
}
<span class="boring">}</span></code></pre></pre>
<p>Äoáº¡n mÃ£ nÃ y sáº½ in ra bá»‘n byte Ä‘Ã£ táº¡o nÃªn chuá»—i nÃ y:</p>
<pre><code class="language-text">208
151
208
180
</code></pre>
<p>NhÆ°ng hÃ£y nhá»› ráº±ng cÃ¡c giÃ¡ trá»‹ vÃ´ hÆ°á»›ng Unicode há»£p lá»‡ cÃ³ thá»ƒ Ä‘Æ°á»£c táº¡o thÃ nh tá»« nhiá»u hÆ¡n 1 byte.</p>
<p>Viá»‡c láº¥y cÃ¡c cá»¥m kÃ½ tá»± káº¿t há»£p (grapheme) tá»« chuá»—i giá»‘ng nhÆ° vá»›i chá»¯ viáº¿t Devanagari ráº¥t phá»©c táº¡p, vÃ¬ váº­y chá»©c nÄƒng nÃ y khÃ´ng cung cáº¥p sáºµn trong thÆ° viá»‡n chuáº©n. CÃ³ nhiá»u thÆ° viá»‡n cÃ³ sáºµn trÃªn <a href="https://crates.io/">crates.io</a><!-- ignore --> náº¿u báº¡n cáº§n nhá»¯ng chá»©c nÄƒng nÃ y.</p>
<h3 id="kiá»ƒu-chuá»—i-khÃ´ng-Ä‘Æ¡n-giáº£n-nhÆ°-váº­y"><a class="header" href="#kiá»ƒu-chuá»—i-khÃ´ng-Ä‘Æ¡n-giáº£n-nhÆ°-váº­y">Kiá»ƒu chuá»—i khÃ´ng Ä‘Æ¡n giáº£n nhÆ° váº­y</a></h3>
<p>TÃ³m láº¡i, kiá»ƒu chuá»—i ráº¥t phá»©c táº¡p. CÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c nhau táº¡o ra cÃ¡c lá»±a chá»n khÃ¡c nhau vá» cÃ¡ch thá»ƒ hiá»‡n sá»± phá»©c táº¡p cho láº­p trÃ¬nh viÃªn. Rust Ä‘Ã£ chá»n viá»‡c xá»­ lÃ½ chÃ­nh xÃ¡c dá»¯ liá»‡u <code>String</code> lÃ m hÃ nh vi máº·c Ä‘á»‹nh cho táº¥t cáº£ cÃ¡c chÆ°Æ¡ng trÃ¬nh Rust, Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  cÃ¡c láº­p trÃ¬nh viÃªn pháº£i suy nghÄ© nhiá»u hÆ¡n vá» viá»‡c xá»­ lÃ½ dá»¯ liá»‡u UTF-8 tá»« trÆ°á»›c. Sá»± Ä‘Ã¡nh Ä‘á»•i nÃ y cho tháº¥y kiá»ƒu chuá»—i cÃ³ tÃ­nh phá»©c táº¡p hÆ¡n cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c, nhÆ°ng nÃ³ láº¡i giÃºp báº¡n khá»i pháº£i xá»­ lÃ½ cÃ¡c lá»—i liÃªn quan Ä‘áº¿n cÃ¡c kÃ½ tá»± khÃ´ng pháº£i ASCII sau nÃ y trong vÃ²ng Ä‘á»i phÃ¡t triá»ƒn cá»§a mÃ¬nh.</p>
<p>Tin tá»‘t lÃ  thÆ° viá»‡n chuáº©n cung cáº¥p ráº¥t nhiá»u chá»©c nÄƒng Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn cÃ¡c loáº¡i <code>String</code> vÃ  <code>&amp;str</code> Ä‘á»ƒ giÃºp xá»­ lÃ½ cÃ¡c tÃ¬nh huá»‘ng phá»©c táº¡p nÃ y má»™t cÃ¡ch chÃ­nh xÃ¡c. Nhá»› xem tÃ i liá»‡u Ä‘á»ƒ biáº¿t cÃ¡c phÆ°Æ¡ng thá»©c há»¯u Ã­ch nhÆ° <code>contains</code> Ä‘á»ƒ tÃ¬m kiáº¿m trong má»™t chuá»—i vÃ  <code>replace</code> Ä‘á»ƒ thay tháº¿ cÃ¡c pháº§n cá»§a má»™t chuá»—i báº±ng má»™t chuá»—i khÃ¡c.</p>
<p>HÃ£y chuyá»ƒn sang má»™t thá»© Ã­t phá»©c táº¡p hÆ¡n má»™t chÃºt: báº£n Ä‘á»“ bÄƒm!</p>
<div style="break-before: page; page-break-before: always;"></div><p><a id="accessing-values-in-a-hash-map"></a></p>
<h2 id="lÆ°u-trá»¯-khÃ³a-vá»›i-giÃ¡-trá»‹-liÃªn-káº¿t-trong-báº£n-Ä‘á»“-bÄƒm-hash-map"><a class="header" href="#lÆ°u-trá»¯-khÃ³a-vá»›i-giÃ¡-trá»‹-liÃªn-káº¿t-trong-báº£n-Ä‘á»“-bÄƒm-hash-map">LÆ°u trá»¯ khÃ³a vá»›i giÃ¡ trá»‹ liÃªn káº¿t trong báº£n Ä‘á»“ bÄƒm (Hash Map)</a></h2>
<p>Pháº§n táº­p há»£p cuá»‘i cÃ¹ng trong bá»™ cÃ¡c táº­p há»£p phá»• biáº¿n lÃ  <em>báº£n Ä‘á»“ bÄƒm</em>. Kiá»ƒu <code>HashMap&lt;K,V&gt;</code> lÆ°u trá»¯ Ã¡nh xáº¡ cÃ¡c khÃ³a kiá»ƒu <code>K</code> tá»›i cÃ¡c giÃ¡ trá»‹ kiá»ƒu <code>V</code> báº±ng cÃ¡ch sá»­ dá»¥ng <em>hÃ m bÄƒm</em>, xÃ¡c Ä‘á»‹nh cÃ¡ch nÃ³ thiáº¿t Ä‘áº·t khÃ³a vÃ  giÃ¡ trá»‹ vÃ o bá»™ nhá»›. Nhiá»u ngÃ´n ngá»¯ láº­p trÃ¬nh há»— trá»£ loáº¡i cáº¥u trÃºc dá»¯ liá»‡u nÃ y, nhÆ°ng chÃºng thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng vá»›i má»™t cÃ¡i tÃªn khÃ¡c, cháº³ng háº¡n nhÆ° bÄƒm (hash), báº£n Ä‘á»“ (map), Ä‘á»‘i tÆ°á»£ng (object), báº£ng bÄƒm (hash table), tá»« Ä‘iá»ƒn (dictionary) hoáº·c máº£ng káº¿t há»£p, chá»‰ nÃªu ra má»™t vÃ i cÃ¡i tÃªn vÃ­ dá»¥ nhÆ° váº­y.</p>
<p>Báº£n Ä‘á»“ bÄƒm ráº¥t há»¯u Ã­ch khi báº¡n muá»‘n tra cá»©u dá»¯ liá»‡u khÃ´ng pháº£i báº±ng cÃ¡ch sá»­ dá»¥ng chá»‰ má»¥c index nhÆ° báº¡n cÃ³ thá»ƒ lÃ m vá»›i vector, mÃ  báº±ng cÃ¡ch sá»­ dá»¥ng má»™t khÃ³a cÃ³ thá»ƒ lÃ  báº¥t ká»³ loáº¡i nÃ o. VÃ­ dá»¥: trong má»™t trÃ² chÆ¡i, báº¡n cÃ³ thá»ƒ theo dÃµi Ä‘iá»ƒm sá»‘ cá»§a má»—i Ä‘á»™i trong má»™t báº£n Ä‘á»“ bÄƒm trong Ä‘Ã³ má»—i khÃ³a lÃ  tÃªn cá»§a Ä‘á»™i vÃ  cÃ¡c giÃ¡ trá»‹ lÃ  Ä‘iá»ƒm sá»‘ cá»§a má»—i Ä‘á»™i. TÆ°Æ¡ng á»©ng vá»›i tÃªn má»™t Ä‘á»™i, báº¡n cÃ³ thá»ƒ láº¥y Ä‘iá»ƒm cá»§a Ä‘á»™i Ä‘Ã³.</p>
<p>ChÃºng ta sáº½ xem xÃ©t API cÆ¡ báº£n cá»§a báº£n Ä‘á»“ bÄƒm trong pháº§n nÃ y, cÃ³ nhiá»u tÃ­nh nÄƒng bá»• sung khÃ¡c Ä‘ang áº©n trong cÃ¡c hÃ m Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong <code>HashMap&lt;K,V&gt;</code> bá»Ÿi thÆ° viá»‡n chuáº©n. NhÆ° má»i khi, hÃ£y tham kháº£o tÃ i liá»‡u thÆ° viá»‡n tiÃªu chuáº©n Ä‘á»ƒ biáº¿t thÃªm thÃ´ng tin.</p>
<h3 id="táº¡o-má»›i-má»™t-báº£n-Ä‘á»“-bÄƒm-hash-map"><a class="header" href="#táº¡o-má»›i-má»™t-báº£n-Ä‘á»“-bÄƒm-hash-map">Táº¡o má»›i má»™t báº£n Ä‘á»“ bÄƒm (hash map)</a></h3>
<p>Má»™t cÃ¡ch Ä‘á»ƒ táº¡o má»™t báº£n Ä‘á»“ bÄƒm rá»—ng lÃ  sá»­ dá»¥ng <code>new</code> vÃ  thÃªm cÃ¡c pháº§n tá»­ báº±ng <code>insert</code>. Trong má»¥c 8-20, chÃºng ta Ä‘ang theo dÃµi Ä‘iá»ƒm sá»‘ cá»§a hai Ä‘á»™i cÃ³ tÃªn lÃ  <em>Blue</em> vÃ  <em>Yellow</em>. Äá»™i Blue báº¯t Ä‘áº§u vá»›i 10 Ä‘iá»ƒm vÃ  Ä‘á»™i Yellow báº¯t Ä‘áº§u vá»›i 50 Ä‘iá»ƒm.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    use std::collections::HashMap;

    let mut scores = HashMap::new();

    scores.insert(String::from("Blue"), 10);
    scores.insert(String::from("Yellow"), 50);
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-20: Táº¡o má»›i báº£n Ä‘á»“ bÄƒm vÃ  chÃ¨n vÃ i cáº·p khÃ³a-giÃ¡ trá»‹</span></p>
<p>LÆ°u Ã½ ráº±ng trÆ°á»›c tiÃªn chÃºng ta cáº§n <code>use</code> báº£n Ä‘á»“ bÄƒm <code>HashMap</code> tá»« bá»™ táº­p há»£p cá»§a thÆ° viá»‡n chuáº©n. Trong sá»‘ ba bá»™ sÆ°u táº­p phá»• biáº¿n cá»§a chÃºng ta, loáº¡i nÃ y Ã­t Ä‘Æ°á»£c sá»­ dá»¥ng nháº¥t, vÃ¬ váº­y nÃ³ khÃ´ng Ä‘Æ°á»£c Ä‘Æ°a vÃ o nhÆ° nhá»¯ng tÃ­nh nÄƒng tá»± Ä‘á»™ng trong pháº¡m vi cá»§a prelude (cÃ³ thá»ƒ hiá»ƒu lÃ  cÃ¡c thÆ° viá»‡n Ä‘Ã­nh sáºµn khi compile, chá»‰ cáº§n sá»­ dá»¥ng mÃ  khÃ´ng cáº§n khai bÃ¡o tÆ°á»ng minh). Báº£n Ä‘á»“ bÄƒm cÅ©ng Ã­t há»— trá»£ hÆ¡n tá»« thÆ° viá»‡n chuáº©n; cháº³ng háº¡n nhÆ° khÃ´ng cÃ³ macro tÃ­ch há»£p sáºµn Ä‘á»ƒ táº¡o chÃºng.</p>
<p>CÅ©ng giá»‘ng nhÆ° vector, báº£n Ä‘á»“ bÄƒm lÆ°u trá»¯ dá»¯ liá»‡u cá»§a chÃºng trÃªn heap. <code>HashMap</code> nÃ y cÃ³ cÃ¡c khÃ³a kiá»ƒu <code>String</code> vÃ  cÃ¡c giÃ¡ trá»‹ kiá»ƒu <code>i32</code>. Giá»‘ng nhÆ° vector, báº£n Ä‘á»“ bÄƒm lÃ  Ä‘á»“ng nháº¥t: táº¥t cáº£ cÃ¡c khÃ³a pháº£i cÃ³ cÃ¹ng kiá»ƒu vá»›i nhau vÃ  táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ pháº£i cÃ³ cÃ¹ng kiá»ƒu.</p>
<h3 id="truy-cáº­p-giÃ¡-trá»‹-cá»§a-báº£n-Ä‘á»“-bÄƒm-hash-map"><a class="header" href="#truy-cáº­p-giÃ¡-trá»‹-cá»§a-báº£n-Ä‘á»“-bÄƒm-hash-map">Truy cáº­p giÃ¡ trá»‹ cá»§a báº£n Ä‘á»“ bÄƒm (hash map)</a></h3>
<p>ChÃºng ta cÃ³ thá»ƒ láº¥y má»™t giÃ¡ trá»‹ tá»« báº£n Ä‘á»“ bÄƒm báº±ng cÃ¡ch cung cáº¥p khÃ³a cá»§a nÃ³ cho phÆ°Æ¡ng thá»©c <code>get</code>, nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ trong má»¥c 8-21.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    use std::collections::HashMap;

    let mut scores = HashMap::new();

    scores.insert(String::from("Blue"), 10);
    scores.insert(String::from("Yellow"), 50);

    let team_name = String::from("Blue");
    let score = scores.get(&amp;team_name).copied().unwrap_or(0);
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-21: Truy cáº­p Ä‘iá»ƒm sá»‘ cá»§a Ä‘á»™i Blue lÆ°u trong báº£n Ä‘á»“ bÄƒm</span></p>
<p>á» Ä‘Ã¢y, <code>score</code> sáº½ cÃ³ giÃ¡ trá»‹ Ä‘Æ°á»£c liÃªn káº¿t vá»›i Ä‘á»™i Blue vÃ  káº¿t quáº£ sáº½ lÃ  <code>10</code>. PhÆ°Æ¡ng thá»©c <code>get</code> tráº£ vá» má»™t <code>Option&lt;&amp;V&gt;</code>; náº¿u khÃ´ng cÃ³ giÃ¡ trá»‹ nÃ o cho khÃ³a Ä‘Ã³ trong báº£n Ä‘á»“ bÄƒm, <code>get</code> sáº½ tráº£ vá» <code>None</code>. ChÆ°Æ¡ng trÃ¬nh nÃ y sáº½ cáº§n pháº£i xá»­ lÃ½ <code>Option</code> báº±ng cÃ¡ch gá»i <code>unsrap_or</code> Ä‘á»ƒ Ä‘áº·t <code>score</code> thÃ nh 0 náº¿u <code>scores</code> khÃ´ng cÃ³ pháº§n tá»­ nÃ o tÆ°Æ¡ng á»©ng vá»›i khÃ³a.</p>
<p>ChÃºng ta cÃ³ thá»ƒ láº·p qua tá»«ng cáº·p khÃ³a/giÃ¡ trá»‹ trong báº£n Ä‘á»“ bÄƒm theo cÃ¡ch tÆ°Æ¡ng tá»± nhÆ° khi chÃºng ta lÃ m vá»›i vector, báº±ng cÃ¡ch sá»­ dá»¥ng vÃ²ng láº·p <code>for</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    use std::collections::HashMap;

    let mut scores = HashMap::new();

    scores.insert(String::from("Blue"), 10);
    scores.insert(String::from("Yellow"), 50);

    for (key, value) in &amp;scores {
        println!("{key}: {value}");
    }
<span class="boring">}</span></code></pre></pre>
<p>Äoáº¡n code nÃ y sáº½ in ra tá»«ng cáº·p theo thá»© tá»± tÃ¹y Ã½:</p>
<pre><code class="language-text">Yellow: 50
Blue: 10
</code></pre>
<h3 id="báº£n-Ä‘á»“-bÄƒm-vÃ -quyá»n-sá»Ÿ-há»¯u-ownership"><a class="header" href="#báº£n-Ä‘á»“-bÄƒm-vÃ -quyá»n-sá»Ÿ-há»¯u-ownership">Báº£n Ä‘á»“ bÄƒm vÃ  quyá»n sá»Ÿ há»¯u (ownership)</a></h3>
<p>Äá»‘i vá»›i nhá»¯ng kiá»ƒu dá»¯ liá»‡u triá»ƒn khai tá»« Ä‘á»‘i tÆ°á»£ng Ä‘áº·c táº£ <code>Copy</code>, nhÆ° <code>i32</code>, cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c sao chÃ©p vÃ o báº£n Ä‘á»“ bÄƒm. Äá»‘i vá»›i cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c sá»Ÿ há»¯u nhÆ° <code>String</code>, cÃ¡c giÃ¡ trá»‹ sáº½ Ä‘Æ°á»£c di chuyá»ƒn vÃ  báº£n Ä‘á»“ bÄƒm sáº½ lÃ  chá»§ sá»Ÿ há»¯u cá»§a cÃ¡c giÃ¡ trá»‹ Ä‘Ã³, nhÆ° Ä‘Æ°á»£c minh há»a trong má»¥c 8-22.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    use std::collections::HashMap;

    let field_name = String::from("Favorite color");
    let field_value = String::from("Blue");

    let mut map = HashMap::new();
    map.insert(field_name, field_value);
    // field_name and field_value are invalid at this point, try using them and
    // see what compiler error you get!
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-22: CÃ¡c khÃ³a vÃ  giÃ¡ trá»‹ thuá»™c sá»Ÿ há»¯u cá»§a
báº£n Ä‘á»“ bÄƒm sau khi chÃºng Ä‘Æ°á»£c thÃªm vÃ o</span></p>
<p>ChÃºng ta khÃ´ng thá»ƒ sá»­ dá»¥ng cÃ¡c biáº¿n <code>field_name</code> vÃ  <code>field_value</code> sau khi chÃºng Ä‘Æ°á»£c chuyá»ƒn vÃ o báº£n Ä‘á»“ bÄƒm vá»›i lá»‡nh gá»i <code>insert</code>.</p>
<p>Náº¿u chÃºng ta thÃªm tham chiáº¿u (Ä‘áº¿n cÃ¡c giÃ¡ trá»‹) vÃ o báº£n Ä‘á»“ bÄƒm, thÃ¬ giÃ¡ trá»‹ sáº½ khÃ´ng Ä‘Æ°á»£c chuyá»ƒn vÃ o báº£n Ä‘á»“ bÄƒm. CÃ¡c giÃ¡ trá»‹ mÃ  cÃ¡c tham chiáº¿u trá» Ä‘áº¿n pháº£i há»£p lá»‡ Ã­t nháº¥t lÃ  trong thá»i gian báº£n Ä‘á»“ bÄƒm váº«n cÃ²n há»£p lá»‡. ChÃºng ta sáº½ nÃ³i thÃªm vá» nhá»¯ng váº¥n Ä‘á» nÃ y trong pháº§n <a href="ch10-03-lifetime-syntax.html#validating-references-with-lifetimes">â€œXÃ¡c thá»±c tham chiáº¿u vá»›i vÃ²ng Ä‘á»i (lifetime)â€</a><!-- ignore --> á»Ÿ ChÆ°Æ¡ng 10.</p>
<h3 id="cáº­p-nháº­t-báº£n-Ä‘á»“-bÄƒm"><a class="header" href="#cáº­p-nháº­t-báº£n-Ä‘á»“-bÄƒm">Cáº­p nháº­t báº£n Ä‘á»“ bÄƒm</a></h3>
<p>Máº·c dÃ¹ sá»‘ lÆ°á»£ng cáº·p khÃ³a-giÃ¡ trá»‹ cÃ³ thá»ƒ tÄƒng lÃªn, nhÆ°ng má»—i khÃ³a duy nháº¥t chá»‰ cÃ³ thá»ƒ cÃ³ má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c liÃªn káº¿t vá»›i nÃ³ táº¡i má»™t thá»i Ä‘iá»ƒm (Ä‘iá»u nÃ y khÃ´ng Ã¡p dá»¥ng ngÆ°á»£c láº¡i: vÃ­ dá»¥: cáº£ Ä‘á»™i Blue vÃ  Ä‘á»™i Yellow Ä‘á»u cÃ³ thá»ƒ cÃ³ giÃ¡ trá»‹ 10 Ä‘Æ°á»£c lÆ°u trá»¯ trong báº£n Ä‘á»“ bÄƒm <code>scores</code>).</p>
<p>Khi báº¡n muá»‘n thay Ä‘á»•i dá»¯ liá»‡u trong báº£n Ä‘á»“ bÄƒm, báº¡n pháº£i quyáº¿t Ä‘á»‹nh cÃ¡ch xá»­ lÃ½ trÆ°á»ng há»£p khi má»™t khÃ³a Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n giÃ¡ trá»‹. Báº¡n cÃ³ thá»ƒ thay tháº¿ giÃ¡ trá»‹ cÅ© báº±ng giÃ¡ trá»‹ má»›i, cÃ³ nghÄ©a lÃ  hoÃ n toÃ n bá» qua giÃ¡ trá»‹ cÅ©. Báº¡n cÃ³ thá»ƒ giá»¯ giÃ¡ trá»‹ cÅ© vÃ  bá» qua giÃ¡ trá»‹ má»›i, chá»‰ thÃªm giÃ¡ trá»‹ má»›i náº¿u khÃ³a <em>khÃ´ng</em> cÃ³ giÃ¡ trá»‹. Hoáº·c báº¡n cÃ³ thá»ƒ káº¿t há»£p giÃ¡ trá»‹ cÅ© vÃ  giÃ¡ trá»‹ má»›i. HÃ£y xem cÃ¡ch thá»±c hiá»‡n tá»«ng Ä‘iá»u nÃ y!</p>
<h4 id="ghi-Ä‘Ã¨-má»™t-giÃ¡-trá»‹"><a class="header" href="#ghi-Ä‘Ã¨-má»™t-giÃ¡-trá»‹">Ghi Ä‘Ã¨ má»™t giÃ¡ trá»‹</a></h4>
<p>Náº¿u chÃºng ta thÃªm má»™t khÃ³a-giÃ¡ trá»‹ vÃ o má»™t báº£n Ä‘á»“ bÄƒm vÃ  sau Ä‘Ã³ láº¡i chÃ¨n thÃªm cÃ¹ng má»™t khÃ³a Ä‘Ã³ báº±ng má»™t giÃ¡ trá»‹ khÃ¡c, thÃ¬ giÃ¡ trá»‹ Ä‘Æ°á»£c liÃªn káº¿t vá»›i khÃ³a Ä‘Ã³ sáº½ bá»‹ thay tháº¿. Máº·c dÃ¹ mÃ£ trong má»¥c 8-23 gá»i <code>insert</code> hai láº§n, nhÆ°ng báº£n Ä‘á»“ bÄƒm sáº½ chá»‰ chá»©a má»™t cáº·p khÃ³a-giÃ¡ trá»‹ vÃ¬ chÃºng ta Ä‘ang chÃ¨n giÃ¡ trá»‹ cho khÃ³a cá»§a Ä‘á»™i Blue cáº£ hai láº§n.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    use std::collections::HashMap;

    let mut scores = HashMap::new();

    scores.insert(String::from("Blue"), 10);
    scores.insert(String::from("Blue"), 25);

    println!("{scores:?}");
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-23: Thay tháº¿ giÃ¡ trá»‹ lÆ°u trá»¯ báº±ng khÃ³a cá»¥ thá»ƒ</span></p>
<p>Äoáº¡n mÃ£ nÃ y sáº½ in <code>{"Blue": 25}</code>. GiÃ¡ trá»‹ ban Ä‘áº§u cá»§a <code>10</code> Ä‘Ã£ bá»‹ ghi Ä‘Ã¨</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="only-inserting-a-value-if-the-key-has-no-value"></a></p>
<h4 id="thÃªm-khÃ³a-giÃ¡-trá»‹-náº¿u-khÃ³a-chÆ°a-tá»“n-táº¡i"><a class="header" href="#thÃªm-khÃ³a-giÃ¡-trá»‹-náº¿u-khÃ³a-chÆ°a-tá»“n-táº¡i">ThÃªm khÃ³a-giÃ¡ trá»‹ náº¿u khÃ³a chÆ°a tá»“n táº¡i</a></h4>
<p>ThÃ´ng thÆ°á»ng, Ä‘á»ƒ kiá»ƒm tra xem má»™t khÃ³a cá»¥ thá»ƒ Ä‘Ã£ tá»“n táº¡i trong báº£n Ä‘á»“ bÄƒm vá»›i má»™t giÃ¡ trá»‹ hay chÆ°a, chÃºng ta sáº½ thá»±c hiá»‡n thao tÃ¡c sau: náº¿u khÃ³a tá»“n táº¡i trong báº£n Ä‘á»“ bÄƒm, giÃ¡ trá»‹ hiá»‡n cÃ³ sáº½ váº«n nhÆ° cÅ©, náº¿u khÃ³a khÃ´ng tá»“n táº¡i, hÃ£y chÃ¨n khÃ³a vÃ  giÃ¡ trá»‹ cho nÃ³.</p>
<p>Báº£n Ä‘á»“ bÄƒm cÃ³ má»™t API Ä‘áº·c biá»‡t cho Ä‘iá»u nÃ y Ä‘Æ°á»£c gá»i lÃ  <code>entry</code>, nÃ³ cÃ³ tham sá»‘ lÃ  khÃ³a báº¡n muá»‘n kiá»ƒm tra. GiÃ¡ trá»‹ tráº£ vá» cá»§a phÆ°Æ¡ng thá»©c <code>entry</code> lÃ  má»™t enum Ä‘Æ°á»£c gá»i lÃ  <code>Entry</code> Ä‘áº¡i diá»‡n cho má»™t giÃ¡ trá»‹ cÃ³ thá»ƒ tá»“n táº¡i hoáº·c khÃ´ng. Giáº£ sá»­ chÃºng ta muá»‘n kiá»ƒm tra xem khÃ³a cá»§a Ä‘á»™i Yellow cÃ³ giÃ¡ trá»‹ liÃªn káº¿t vá»›i nÃ³ hay khÃ´ng. Náº¿u khÃ´ng, chÃºng ta muá»‘n chÃ¨n giÃ¡ trá»‹ 50 vÃ  lÃ m Ä‘iá»u tÆ°Æ¡ng tá»± vá»›i cho Ä‘á»™i Blue. Sá»­ dá»¥ng API <code>entry</code>, Ä‘oáº¡n mÃ£ trÃ´ng giá»‘ng nhÆ° má»¥c 8-24.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    use std::collections::HashMap;

    let mut scores = HashMap::new();
    scores.insert(String::from("Blue"), 10);

    scores.entry(String::from("Yellow")).or_insert(50);
    scores.entry(String::from("Blue")).or_insert(50);

    println!("{scores:?}");
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-24: DÃ¹ng phÆ°Æ¡ng thá»©c <code>entry</code> Ä‘á»ƒ chá»‰ thÃªm vÃ o náº¿u key khÃ´ng tá»“n táº¡i giÃ¡ trá»‹ nÃ o</span></p>
<p>PhÆ°Æ¡ng thá»©c <code>or_insert</code> trÃªn <code>Entry</code> Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh Ä‘á»ƒ tráº£ vá» má»™t tham chiáº¿u mutable tham chiáº¿u Ä‘áº¿n giÃ¡ trá»‹ cho khÃ³a <code>Entry</code> tÆ°Æ¡ng á»©ng náº¿u khÃ³a Ä‘Ã³ tá»“n táº¡i, vÃ  náº¿u khÃ´ng thÃ¬ hÃ£y thiáº¿t láº­p giÃ¡ trá»‹ cá»§a tham sá»‘ cho khÃ³a nÃ y vÃ  tráº£ vá» má»™t tham chiáº¿u mutable tham chiáº¿u tá»›i giÃ¡ trá»‹ má»›i. Ká»¹ thuáº­t nÃ y gá»n hÆ¡n nhiá»u so vá»›i viá»‡c tá»± viáº¿t logic, vÃ  ngoÃ i ra nÃ³ hoáº¡t Ä‘á»™ng Ä‘á»™c Ä‘Ã¡o hÆ¡n vá»›i trÃ¬nh kiá»ƒm tra mÆ°á»£n tham chiáº¿u.</p>
<p>Cháº¡y Ä‘oáº¡n mÃ£ trong má»¥c 8-24 sáº½ in ra <code>{" Yellow ": 50," Blue ": 10}</code>. Lá»‡nh gá»i <code>entry</code> Ä‘áº§u tiÃªn sáº½ chÃ¨n khÃ³a cho Ä‘á»™i Yellow vá»›i giÃ¡ trá»‹ 50 vÃ¬ Ä‘á»™i Yellow chÆ°a cÃ³ giÃ¡ trá»‹. Láº§n gá»i <code>entry</code> thá»© hai sáº½ khÃ´ng thay Ä‘á»•i báº£n Ä‘á»“ bÄƒm vÃ¬ Ä‘á»™i Blue Ä‘Ã£ cÃ³ giÃ¡ trá»‹ 10 sáºµn.</p>
<h4 id="cáº­p-nháº­t-giÃ¡-trá»‹-dá»±a-trÃªn-giÃ¡-trá»‹-cÅ©"><a class="header" href="#cáº­p-nháº­t-giÃ¡-trá»‹-dá»±a-trÃªn-giÃ¡-trá»‹-cÅ©">Cáº­p nháº­t giÃ¡ trá»‹ dá»±a trÃªn giÃ¡ trá»‹ cÅ©</a></h4>
<p>Má»™t trÆ°á»ng há»£p sá»­ dá»¥ng phá»• biáº¿n khÃ¡c cho báº£n Ä‘á»“ bÄƒm lÃ  tÃ¬m kiáº¿m giÃ¡ trá»‹ cá»§a khÃ³a vÃ  sau Ä‘Ã³ cáº­p nháº­t nÃ³ dá»±a trÃªn giÃ¡ trá»‹ cÅ©. VÃ­ dá»¥: má»¥c 8-25 lÃ  Ä‘oáº¡n code xá»­ lÃ½ Ä‘áº¿m sá»‘ láº§n xuáº¥t hiá»‡n cá»§a má»—i tá»« trong má»™t vÄƒn báº£n. ChÃºng ta sá»­ dá»¥ng báº£n Ä‘á»“ bÄƒm sá»­ dá»¥ng má»—i tá»« ngá»¯ lÃ m khÃ³a vÃ  tÄƒng giÃ¡ trá»‹ Ä‘á»ƒ theo dÃµi sá»‘ láº§n xuáº¥t hiá»‡n cá»§a chÃºng. Náº¿u Ä‘Ã¢y lÃ  láº§n Ä‘áº§u tiÃªn chÃºng ta nhÃ¬n tháº¥y má»™t tá»«, trÆ°á»›c tiÃªn chÃºng ta sáº½ thiáº¿t láº­p giÃ¡ trá»‹ lÃ  0.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    use std::collections::HashMap;

    let text = "hello world wonderful world";

    let mut map = HashMap::new();

    for word in text.split_whitespace() {
        let count = map.entry(word).or_insert(0);
        *count += 1;
    }

    println!("{map:?}");
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Má»¥c 8-25: Äáº¿m sá»‘ láº§n xuáº¥t hiá»‡n cá»§a cÃ¡c tá»« ngá»¯ báº±ng cÃ¡ch sá»­ dá»¥ng báº£n Ä‘á»“ bÄƒm lÆ°u trá»¯ cÃ¡c tá»« vÃ  sá»‘ Ä‘áº¿m</span></p>
<p>Äoáº¡n mÃ£ nÃ y sáº½ in ra <code>{"world": 2, "hello": 1, "wonderful": 1}</code>. Báº¡n cÃ³ thá»ƒ tháº¥y cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹ giá»‘ng nhau Ä‘Æ°á»£c in theo má»™t thá»© tá»± khÃ¡c nhau: nhá»› láº¡i tá»« pháº§n <a href="ch08-03-hash-maps.html#accessing-values-in-a-hash-map">â€œTruy cáº­p giÃ¡ trá»‹ cá»§a báº£n Ä‘á»“ bÄƒmâ€</a><!-- ignore --> mÃ  viá»‡c láº·p qua báº£n Ä‘á»“ bÄƒm diá»…n ra theo thá»© tá»± tÃ¹y Ã½.</p>
<p>PhÆ°Æ¡ng thá»©c <code>split_whitespace</code> tráº£ vá» má»™t bá»™ láº·p duyá»‡t qua cÃ¡c Ä‘oáº¡n nhá» Ä‘Æ°á»£c phÃ¢n tÃ¡ch báº±ng khoáº£ng tráº¯ng cá»§a giÃ¡ trá»‹ trong <code>text</code>. PhÆ°Æ¡ng thá»©c <code>or_insert</code> tráº£ vá» má»™t tham chiáº¿u mutable (<code>&amp;mut V</code>) trá» Ä‘áº¿n giÃ¡ trá»‹ cho khÃ³a Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh. á» Ä‘Ã¢y chÃºng ta lÆ°u trá»¯ tham chiáº¿u mutable Ä‘Ã³ trong biáº¿n <code>count</code>, vÃ¬ váº­y Ä‘á»ƒ gÃ¡n cho giÃ¡ trá»‹ Ä‘Ã³, trÆ°á»›c tiÃªn chÃºng ta pháº£i bá» tham chiáº¿u (deref) <code>count</code> báº±ng cÃ¡ch sá»­ dá»¥ng dáº¥u hoa thá»‹ (<code>*</code>). Tham chiáº¿u mutable sáº½ náº±m ngoÃ i pháº¡m vi á»Ÿ cuá»‘i vÃ²ng láº·p <code>for</code>, vÃ¬ váº­y táº¥t cáº£ nhá»¯ng thay Ä‘á»•i nÃ y Ä‘á»u an toÃ n vÃ  Ä‘Æ°á»£c cÃ¡c quy táº¯c mÆ°á»£n tham chiáº¿u cho phÃ©p.</p>
<h3 id="hÃ m-bÄƒm"><a class="header" href="#hÃ m-bÄƒm">HÃ m bÄƒm</a></h3>
<p>Theo máº·c Ä‘á»‹nh, <code>HashMap</code> sá»­ dá»¥ng má»™t hÃ m bÄƒm Ä‘Æ°á»£c gá»i lÃ  <em>SipHash</em> cÃ³ thá»ƒ cung cáº¥p kháº£ nÄƒng chá»‘ng láº¡i cÃ¡c cuá»™c táº¥n cÃ´ng Tá»« chá»‘i Dá»‹ch vá»¥ (DoS) liÃªn quan Ä‘áº¿n cÃ¡c báº£ng bÄƒm<sup class="footnote-reference" id="fr-siphash-1"><a href="#footnote-siphash">1</a></sup><!-- ignore -->. ÄÃ¢y khÃ´ng pháº£i lÃ  thuáº­t toÃ¡n bÄƒm nhanh nháº¥t hiá»‡n cÃ³, nhÆ°ng viá»‡c Ä‘Ã¡nh Ä‘á»•i hiá»‡u suáº¥t Ä‘á»ƒ mang láº¡i báº£o máº­t tá»‘t hÆ¡n cÅ©ng lÃ  Ä‘iá»u Ä‘Ã¡ng giÃ¡. Náº¿u báº¡n kiá»ƒm tra cÃ¡c Ä‘oáº¡n mÃ£ cá»§a mÃ¬nh vÃ  nháº­n tháº¥y ráº±ng hÃ m bÄƒm máº·c Ä‘á»‹nh quÃ¡ cháº­m so vá»›i má»¥c Ä‘Ã­ch cá»§a báº¡n, báº¡n cÃ³ thá»ƒ chuyá»ƒn sang má»™t hÃ m khÃ¡c báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh má»™t bá»™ bÄƒm (hasher) khÃ¡c. Má»™t <em>hasher</em> lÃ  má»™t kiá»ƒu triá»ƒn khai cá»§a Ä‘á»‘i tÆ°á»£ng Ä‘áº·c táº£ (trait) <code>BuildHasher</code>. ChÃºng ta sáº½ nÃ³i vá» cÃ¡c trait vÃ  cÃ¡ch triá»ƒn khai chÃºng trong ChÆ°Æ¡ng 10. Báº¡n khÃ´ng nháº¥t thiáº¿t pháº£i triá»ƒn khai hÃ m bÄƒm cá»§a riÃªng mÃ¬nh tá»« Ä‘áº§u; <a href="https://crates.io/">crates.io</a><!-- ignore --> cÃ³ cÃ¡c thÆ° viá»‡n Ä‘Æ°á»£c chia sáº» bá»Ÿi nhá»¯ng ngÆ°á»i dÃ¹ng Rust khÃ¡c cung cáº¥p nhiá»u bá»™ bÄƒm cho ráº¥t nhiá»u thuáº­t toÃ¡n bÄƒm thÃ´ng dá»¥ng.</p>
<h2 id="tá»•ng-káº¿t-láº¡i"><a class="header" href="#tá»•ng-káº¿t-láº¡i">Tá»•ng káº¿t láº¡i</a></h2>
<p>Vector, chuá»—i vÃ  báº£n Ä‘á»“ bÄƒm cung cáº¥p má»™t lÆ°á»£ng lá»›n chá»©c nÄƒng cáº§n thiáº¿t trong cÃ¡c chÆ°Æ¡ng trÃ¬nh khi báº¡n cáº§n lÆ°u trá»¯, truy cáº­p vÃ  sá»­a Ä‘á»•i dá»¯ liá»‡u. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ bÃ i táº­p báº¡n nÃªn trang bá»‹ Ä‘á»ƒ giáº£i quyáº¿t:</p>
<ul>
<li>Cho má»™t danh sÃ¡ch cÃ¡c sá»‘ nguyÃªn, hÃ£y sá»­ dá»¥ng má»™t vector vÃ  tráº£ vá» giÃ¡ trá»‹ trung vá»‹ (khi Ä‘Æ°á»£c sáº¯p
xáº¿p, giÃ¡ trá»‹ á»Ÿ vá»‹ trÃ­ giá»¯a) vÃ  mode cá»§a (giÃ¡ trá»‹ xuáº¥t hiá»‡n thÆ°á»ng xuyÃªn nháº¥t; báº£n Ä‘á»“ bÄƒm sáº½ há»¯u Ã­ch trÆ°á»ng há»£p nÃ y) cá»§a danh sÃ¡ch.</li>
<li>Chuyá»ƒn Ä‘á»•i chuá»—i sang pig latin. Phá»¥ Ã¢m Ä‘áº§u tiÃªn cá»§a má»—i tá»« Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n cuá»‘i tá»« vÃ  â€œayâ€
Ä‘Æ°á»£c thÃªm vÃ o, vÃ¬ váº­y â€œfirstâ€ trá»Ÿ thÃ nh â€œirst-fayâ€. Thay vÃ o Ä‘Ã³, nhá»¯ng tá»« báº¯t Ä‘áº§u báº±ng má»™t nguyÃªn Ã¢m sáº½ Ä‘Æ°á»£c thÃªm â€œhayâ€ vÃ o cuá»‘i (â€œappleâ€ trá»Ÿ thÃ nh â€œapple-hayâ€). HÃ£y ghi nhá»› cÃ¡c chi tiáº¿t vá» mÃ£ hÃ³a UTF-8!</li>
<li>Sá»­ dá»¥ng báº£n Ä‘á»“ bÄƒm vÃ  vector, táº¡o giao diá»‡n vÄƒn báº£n Ä‘á»ƒ cho phÃ©p ngÆ°á»i dÃ¹ng thÃªm tÃªn nhÃ¢n viÃªn vÃ o
má»™t phÃ²ng ban trong cÃ´ng ty. VÃ­ dá»¥: â€œThÃªm Sally vÃ o Ká»¹ thuáº­tâ€ hoáº·c â€œThÃªm Amir vÃ o BÃ¡n hÃ ngâ€. Sau Ä‘Ã³, cho phÃ©p ngÆ°á»i dÃ¹ng truy xuáº¥t danh sÃ¡ch táº¥t cáº£ nhá»¯ng ngÆ°á»i trong má»™t bá»™ pháº­n hoáº·c táº¥t cáº£ nhá»¯ng ngÆ°á»i trong cÃ´ng ty theo tá»«ng bá»™ pháº­n, Ä‘Æ°á»£c sáº¯p xáº¿p theo thá»© tá»± báº£ng chá»¯ cÃ¡i.</li>
</ul>
<p>TÃ i liá»‡u API thÆ° viá»‡n tiÃªu chuáº©n mÃ´ táº£ cÃ¡c phÆ°Æ¡ng thá»©c mÃ  vector, chuá»—i vÃ  báº£n Ä‘á»“ bÄƒm cÃ³, sáº½ há»¯u Ã­ch cho cÃ¡c bÃ i táº­p nÃ y!</p>
<p>ChÃºng ta Ä‘ang tiáº¿n Ä‘áº¿n cÃ¡c chÆ°Æ¡ng trÃ¬nh phá»©c táº¡p hÆ¡n, mÃ  trong Ä‘Ã³ cÃ¡c thao tÃ¡c cÃ³ thá»ƒ bá»‹ lá»—i, vÃ¬ váº­y, Ä‘Ã¢y lÃ  thá»i Ä‘iá»ƒm hoÃ n háº£o Ä‘á»ƒ tháº£o luáº­n vá» viá»‡c xá»­ lÃ½ lá»—i. ChÃºng ta sáº½ lÃ m Ä‘iá»u Ä‘Ã³ tiáº¿p theo!</p>
<hr>
<ol class="footnote-definition"><li id="footnote-siphash">
<p><a href="https://en.wikipedia.org/wiki/SipHash">https://en.wikipedia.org/wiki/SipHash</a> <a href="#fr-siphash-1">â†©</a></p>
</li>
</ol><div style="break-before: page; page-break-before: always;"></div><h1 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h1>
<p>Lá»—i (error) lÃ  má»™t sá»± thá»±c táº¿ trong láº­p trÃ¬nh, vÃ¬ váº­y Rust cÃ³ nhiá»u tÃ­nh nÄƒng Ä‘á»ƒ
xá»­ lÃ½ cÃ¡c tÃ¬nh huá»‘ng mÃ  cÃ³ thá»ƒ xáº£y ra lá»—i. Trong nhiá»u trÆ°á»ng há»£p, Rust yÃªu cáº§u
báº¡n pháº£i nháº­n thá»©c Ä‘Æ°á»£c kháº£ nÄƒng xáº£y ra lá»—i vÃ  thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng nÃ o Ä‘Ã³
trÆ°á»›c khi code cá»§a báº¡n Ä‘Æ°á»£c biÃªn dá»‹ch. YÃªu cáº§u nÃ y lÃ m cho chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n
trá»Ÿ nÃªn bá»n bá»‰ hÆ¡n báº±ng cÃ¡ch Ä‘áº£m báº£o ráº±ng báº¡n sáº½ phÃ¡t hiá»‡n lá»—i vÃ  xá»­ lÃ½ chÃºng
Ä‘Ãºng cÃ¡ch trÆ°á»›c khi báº¡n Ä‘Ã£ triá»ƒn khai code cá»§a mÃ¬nh vÃ o mÃ´i trÆ°á»ng production!</p>
<p>Rust phÃ¢n loáº¡i lá»—i thÃ nh hai loáº¡i chÃ­nh: lá»—i <em>khÃ´i phá»¥c Ä‘Æ°á»£c</em> (recoverable) vÃ 
lá»—i <em>khÃ´ng khÃ´i phá»¥c Ä‘Æ°á»£c</em> (unrecoverable). VÃ­ dá»¥ vá» lá»—i khÃ´i phá»¥c Ä‘Æ°á»£c lÃ  lá»—i
<em>khÃ´ng tÃ¬m tháº¥y tá»‡p</em> (file not found), chÃºng ta cÃ³ thá»ƒ chá»‰ cáº§n bÃ¡o cho ngÆ°á»i
dÃ¹ng biáº¿t vá» lá»—i nÃ y vÃ  thá»­ láº¡i thao tÃ¡c. Lá»—i khÃ´ng khÃ´i phá»¥c Ä‘Æ°á»£c luÃ´n lÃ  dáº¥u
hiá»‡u cá»§a bug, vÃ­ dá»¥ nhÆ° truy cáº­p má»™t vá»‹ trÃ­ náº±m ngoÃ i pháº¡m vi cá»§a má»™t máº£ng, vÃ 
vÃ¬ váº­y chÃºng ta muá»‘n ngay láº­p tá»©c dá»«ng chÆ°Æ¡ng trÃ¬nh.</p>
<p>Háº§u háº¿t cÃ¡c ngÃ´n ngá»¯ khÃ´ng phÃ¢n biá»‡t giá»¯a hai loáº¡i lá»—i nÃ y vÃ  xá»­ lÃ½ cáº£ hai theo
cÃ¹ng má»™t cÃ¡ch, sá»­ dá»¥ng cÃ¡c cÆ¡ cháº¿ nhÆ° ngoáº¡i lá»‡ (exceptions). Rust khÃ´ng cÃ³
ngoáº¡i lá»‡. Thay vÃ o Ä‘Ã³, nÃ³ cÃ³ kiá»ƒu <code>Result&lt;T, E&gt;</code> cho lá»—i khÃ´i phá»¥c Ä‘Æ°á»£c vÃ 
biá»ƒu thá»©c <code>panic!</code> dá»«ng viá»‡c thá»±c thi khi chÆ°Æ¡ng trÃ¬nh gáº·p lá»—i khÃ´ng khÃ´i phá»¥c
Ä‘Æ°á»£c. ChÆ°Æ¡ng nÃ y sáº½ báº¯t Ä‘áº§u báº±ng viá»‡c gá»i <code>panic!</code> vÃ  sau Ä‘Ã³ sáº½ nÃ³i vá» viá»‡c
tráº£ vá» giÃ¡ trá»‹ <code>Result&lt;T, E&gt;</code>. NgoÃ i ra, chÃºng ta sáº½ khÃ¡m phÃ¡ cÃ¡c Ä‘iá»u cáº§n
xem xÃ©t khi quyáº¿t Ä‘á»‹nh cÃ³ nÃªn cá»‘ gáº¯ng khÃ´i phá»¥c lá»—i hay dá»«ng viá»‡c thá»±c thi.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="cÃ¡c-lá»—i-khÃ´ng-thá»ƒ-khÃ´i-phá»¥c-vá»›i-panic"><a class="header" href="#cÃ¡c-lá»—i-khÃ´ng-thá»ƒ-khÃ´i-phá»¥c-vá»›i-panic">CÃ¡c lá»—i khÃ´ng thá»ƒ khÃ´i phá»¥c vá»›i <code>panic!</code></a></h2>
<p>Thá»‰nh thoáº£ng, nhá»¯ng Ä‘iá»u tá»“i tá»‡ xáº£y ra trong code cá»§a báº¡n, vÃ  khÃ´ng cÃ³ gÃ¬ báº¡n
cÃ³ thá»ƒ lÃ m vá»›i nÃ³. Trong nhá»¯ng trÆ°á»ng há»£p nÃ y, Rust cÃ³ macro <code>panic!</code>. Trong
thá»±c táº¿ cÃ³ hai cÃ¡ch Ä‘á»ƒ gÃ¢y ra má»™t panic: báº±ng cÃ¡ch thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng mÃ 
code cá»§a báº¡n gÃ¢y ra má»™t panic (nhÆ° truy cáº­p má»™t máº£ng vÆ°á»£t quÃ¡ pháº¡m vi) hoáº·c báº±ng
cÃ¡ch gá»i trá»±c tiáº¿p macro <code>panic!</code>. Trong cáº£ hai trÆ°á»ng há»£p, chÃºng ta gÃ¢y ra má»™t
panic trong chÆ°Æ¡ng trÃ¬nh cá»§a mÃ¬nh. Máº·c Ä‘á»‹nh, nhá»¯ng panic nÃ y sáº½ in ra má»™t thÃ´ng
bÃ¡o lá»—i, unwind, dá»n dáº¹p stack, vÃ  thoÃ¡t. Báº±ng má»™t biáº¿n mÃ´i trÆ°á»ng, báº¡n cÅ©ng cÃ³
thá»ƒ cho Rust hiá»ƒn thá»‹ call stack khi má»™t panic xáº£y ra Ä‘á»ƒ dá»… dÃ ng theo dÃµi nguá»“n
gá»‘c cá»§a panic.</p>
<section class="note" aria-role="note">
<h3 id="unwinding-stack-hoáº·c-aborting-Ä‘á»ƒ-pháº£n-há»“i-má»™t-panic"><a class="header" href="#unwinding-stack-hoáº·c-aborting-Ä‘á»ƒ-pháº£n-há»“i-má»™t-panic">Unwinding Stack hoáº·c Aborting Ä‘á»ƒ pháº£n há»“i má»™t Panic</a></h3>
<p>Máº·c Ä‘á»‹nh, khi má»™t panic xáº£y ra, chÆ°Æ¡ng trÃ¬nh báº¯t Ä‘áº§u <em>unwinding</em>, nghÄ©a lÃ 
Rust Ä‘i lÃªn stack vÃ  dá»n dáº¹p dá»¯ liá»‡u tá»« má»—i hÃ m nÃ³ gáº·p. Tuy nhiÃªn, Ä‘i ngÆ°á»£c
láº¡i vÃ  dá»n dáº¹p dá»¯ liá»‡u trong tá»«ng hÃ m, viá»‡c Ä‘i nguoc láº¡i vÃ  dá»n dáº¹p lÃ  má»™t
cÃ´ng viá»‡c ráº¥t náº·ng. Do Ä‘Ã³, Rust cho phÃ©p báº¡n chá»n cÃ¡ch thay tháº¿ lÃ  <em>aborting</em>
ngÆ°ng ngay láº­p tá»©c, nghÄ©a lÃ  káº¿t thÃºc chÆ°Æ¡ng trÃ¬nh mÃ  khÃ´ng dá»n dáº¹p.</p>
<p>Bá»™ nhá»› mÃ  chÆ°Æ¡ng trÃ¬nh Ä‘ang sá»­ dá»¥ng sáº½ cáº§n Ä‘Æ°á»£c dá»n dáº¹p bá»Ÿi há»‡ Ä‘iá»u hÃ nh. Náº¿u
trong dá»± Ã¡n cá»§a báº¡n cáº§n táº¡o ra má»™t binary nhá» nháº¥t cÃ³ thá»ƒ, báº¡n cÃ³ thá»ƒ chuyá»ƒn
tá»« unwinding sang aborting khi má»™t panic xáº£y ra báº±ng cÃ¡ch thÃªm
<code>panic = 'abort'</code> vÃ o cÃ¡c pháº§n <code>[profile]</code> phÃ¹ há»£p trong file <em>Cargo.toml</em>
cá»§a báº¡n. VÃ­ dá»¥, náº¿u báº¡n muá»‘n abort khi má»™t panic xáº£y ra trong cháº¿ Ä‘á»™ release,
thÃªm vÃ o Ä‘oáº¡n sau:</p>
<pre><code class="language-toml">[profile.release]
panic = 'abort'
</code></pre>
</section>
<p>HÃ£y thá»­ gá»i <code>panic!</code> trong má»™t chÆ°Æ¡ng trÃ¬nh Ä‘Æ¡n giáº£n:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust should_panic panics edition2024">fn main() {
    panic!("crash and burn");
}</code></pre></pre>
<p>Khi báº¡n cháº¡y chÆ°Æ¡ng trÃ¬nh, báº¡n sáº½ tháº¥y giá»‘ng nhÆ° tháº¿ nÃ y:</p>
<pre><code class="language-console">$ cargo run
   Compiling panic v0.1.0 (file:///projects/panic)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.25s
     Running `target/debug/panic`

thread 'main' panicked at src/main.rs:2:5:
crash and burn
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>Gá»i <code>panic!</code> sáº½ gÃ¢y ra thÃ´ng bÃ¡o lá»—i Ä‘Æ°á»£c chá»©a trong 2 dÃ²ng cuá»‘i cÃ¹ng. DÃ²ng
Ä‘áº§u tiÃªn hiá»ƒn thá»‹ thÃ´ng bÃ¡o panic cá»§a chÃºng ta vÃ  nÆ¡i xáº£y ra panic trong code
: <em>src/main.rs:2:5</em> cho tháº¥y Ä‘Ã³ lÃ  dÃ²ng thá»© hai, kÃ½ tá»± thá»© nÄƒm cá»§a file
<em>src/main.rs</em> cá»§a chÃºng ta.</p>
<p>Trong trÆ°á»ng há»£p nÃ y, dÃ²ng Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh lÃ  má»™t pháº§n cá»§a code cá»§a chÃºng ta,
vÃ  náº¿u chÃºng ta Ä‘i Ä‘áº¿n dÃ²ng Ä‘Ã³, chÃºng ta sáº½ tháº¥y gá»i macro <code>panic!</code>. Trong
trÆ°á»ng há»£p khÃ¡c, gá»i <code>panic!</code> cÃ³ thá»ƒ náº±m trong code mÃ  chÃºng ta dÃ¹ng,
vÃ  tÃªn file vÃ  sá»‘ dÃ²ng Ä‘Æ°á»£c bÃ¡o bá»Ÿi thÃ´ng bÃ¡o lá»—i sáº½ lÃ  code cá»§a ngÆ°á»i khÃ¡c
nÆ¡i <code>panic!</code> macro Ä‘Æ°á»£c gá»i. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng backtrace cá»§a cÃ¡c
hÃ m mÃ  <code>panic!</code> Ä‘Æ°á»£c gá»i Ä‘á»ƒ tÃ¬m ra pháº§n cá»§a code cá»§a chÃºng ta gÃ¢y ra váº¥n Ä‘á».
ChÃºng ta sáº½ tháº£o luáº­n vá» backtrace chi tiáº¿t hÆ¡n á»Ÿ pháº§n tiáº¿p theo.</p>
<h3 id="using-a-panic-backtrace"><a class="header" href="#using-a-panic-backtrace">Using a <code>panic!</code> Backtrace</a></h3>
<p>CÃ¹ng nhÃ¬n vÃ o vÃ­ dá»¥ khÃ¡c Ä‘á»ƒ xem nÃ³ trÃ´ng nhÆ° tháº¿ nÃ o khi má»™t <code>panic!</code> Ä‘Æ°á»£c gá»i
tá»« má»™t thÆ° viá»‡n vÃ¬ má»™t lá»—i trong code cá»§a chÃºng ta thay vÃ¬ tá»« code cá»§a chÃºng
ta gá»i macro trá»±c tiáº¿p. Listing 9-1 cÃ³ má»™t sá»‘ code mÃ  cá»‘ gáº¯ng truy cáº­p má»™t
index trong má»™t vector ngoÃ i pháº¡m vi cá»§a cÃ¡c index há»£p lá»‡.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust should_panic panics edition2024">fn main() {
    let v = vec![1, 2, 3];

    v[99];
}</code></pre></pre>
<p><span class="caption">Listing 9-1: Cá»‘ gáº¯ng truy cáº­p má»™t pháº§n tá»­ ngoÃ i pháº¡m vi
cá»§a má»™t vector, Ä‘iá»u nÃ y sáº½ gÃ¢y ra má»™t gá»i Ä‘áº¿n <code>panic!</code></span></p>
<p>Táº¡i Ä‘Ã¢y, chÃºng ta cá»‘ gáº¯ng truy cáº­p pháº§n tá»­ thá»© 100 cá»§a vector cá»§a chÃºng ta
(pháº§n tá»­ nÃ y á»Ÿ index 99 vÃ¬ index báº¯t Ä‘áº§u tá»« 0), nhÆ°ng vector chá»‰ cÃ³ 3 pháº§n tá»­.
Trong trÆ°á»ng há»£p nÃ y, Rust sáº½ panic. Sá»­ dá»¥ng <code>[]</code> Ä‘Æ°á»£c dá»± kiáº¿n sáº½ tráº£ vá» má»™t
pháº§n tá»­, nhÆ°ng náº¿u chÃºng ta truyá»n má»™t index khÃ´ng há»£p lá»‡, khÃ´ng cÃ³ pháº§n tá»­
nÃ o mÃ  Rust cÃ³ thá»ƒ tráº£ vá».</p>
<p>Trong C, cá»‘ gáº¯ng Ä‘á»c ngoÃ i pháº¡m vi cá»§a má»™t cáº¥u trÃºc dá»¯ liá»‡u lÃ  hÃ nh vi khÃ´ng
xÃ¡c Ä‘á»‹nh. Báº¡n cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c báº¥t cá»© thá»© gÃ¬ á»Ÿ vá»‹ trÃ­ trong bá»™ nhá»› tÆ°Æ¡ng á»©ng
vá»›i pháº§n tá»­ Ä‘Ã³ trong cáº¥u trÃºc dá»¯ liá»‡u, ngay cáº£ khi bá»™ nhá»› khÃ´ng thuá»™c vá» cáº¥u
trÃºc Ä‘Ã³. Äiá»u nÃ y Ä‘Æ°á»£c gá»i lÃ  má»™t <em>buffer overread</em> vÃ  cÃ³ thá»ƒ dáº«n Ä‘áº¿n cÃ¡c
lá»— há»•ng báº£o máº­t náº¿u má»™t káº» táº¥n cÃ´ng cÃ³ thá»ƒ Ä‘iá»u khiá»ƒn index má»™t cÃ¡ch nÃ o Ä‘Ã³ Ä‘á»ƒ
Ä‘á»c dá»¯ liá»‡u mÃ  há» khÃ´ng nÃªn Ä‘Æ°á»£c phÃ©p Ä‘á»c Ä‘Æ°á»£c lÆ°u trá»¯ sau cáº¥u trÃºc dá»¯ liá»‡u.</p>
<p>Äá»ƒ báº£o vá»‡ chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n khá»i loáº¡i lá»— há»•ng nÃ y, náº¿u báº¡n cá»‘ gáº¯ng Ä‘á»c má»™t
pháº§n tá»­ á»Ÿ má»™t index khÃ´ng tá»“n táº¡i, Rust sáº½ dá»«ng thá»±c thi vÃ  tá»« chá»‘i tiáº¿p tá»¥c.
HÃ£y thá»­ vÃ  xem:</p>
<pre><code class="language-console">$ cargo run
   Compiling panic v0.1.0 (file:///projects/panic)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.27s
     Running `target/debug/panic`

thread 'main' panicked at src/main.rs:4:6:
index out of bounds: the len is 3 but the index is 99
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>Lá»—i nÃ y chá»‰ ra ráº±ng táº¡i dÃ²ng 4 cá»§a <code>main.rs</code> chÃºng ta cá»‘ gáº¯ng truy cáº­p index 99.
DÃ²ng chÃº thÃ­ch tiáº¿p theo cho chÃºng ta biáº¿t ráº±ng chÃºng ta cÃ³ thá»ƒ thiáº¿t láº­p biáº¿n
mÃ´i trÆ°á»ng <code>RUST_BACKTRACE</code> Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c má»™t backtrace chÃ­nh xÃ¡c vá» nhá»¯ng gÃ¬ Ä‘Ã£
xáº£y ra Ä‘á»ƒ gÃ¢y ra lá»—i. Má»™t <em>backtrace</em> lÃ  má»™t danh sÃ¡ch táº¥t cáº£ cÃ¡c hÃ m Ä‘Ã£ Ä‘Æ°á»£c
gá»i Ä‘á»ƒ Ä‘áº¿n Ä‘iá»ƒm nÃ y. Backtrace trong Rust hoáº¡t Ä‘á»™ng nhÆ° cÃ¡c ngÃ´n ngá»¯ khÃ¡c:
Ä‘iá»u quan trá»ng Ä‘á»ƒ Ä‘á»c backtrace lÃ  báº¯t Ä‘áº§u tá»« Ä‘áº§u vÃ  Ä‘á»c cho Ä‘áº¿n khi báº¡n tháº¥y
cÃ¡c táº­p tin báº¡n Ä‘Ã£ viáº¿t. ÄÃ³ lÃ  Ä‘iá»ƒm code nguá»‘n cá»§a váº¥n Ä‘á». CÃ¡c dÃ²ng trÃªn Ä‘iá»ƒm Ä‘Ã³
lÃ  code cá»§a báº¡n Ä‘Ã£ gá»i; cÃ¡c dÃ²ng dÆ°á»›i lÃ  code gá»i Ä‘áº¿n code cá»§a báº¡n. Nhá»¯ng dÃ²ng
trÆ°á»›c vÃ  sau cÃ³ thá»ƒ bao gá»“m code Rust cÆ¡ báº£n, thÆ° viá»‡n chuáº©n hoáº·c cÃ¡c thÆ° viá»‡n
Ä‘Æ°á»£c sá»­ dá»¥ng. HÃ£y thá»­ láº¥y má»™t backtrace báº±ng cÃ¡ch thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng
<code>RUST_BACKTRACE</code> thÃ nh báº¥t ká»³ giÃ¡ trá»‹ nÃ o khÃ¡c 0. Listing 9-2 hiá»ƒn thá»‹ káº¿t quáº£
tÆ°Æ¡ng tá»± nhÆ° báº¡n sáº½ tháº¥y.</p>
<!-- manual-regeneration
cd listings/ch09-error-handling/listing-09-01
RUST_BACKTRACE=1 cargo run
copy the backtrace output below
check the backtrace number mentioned in the text below the listing
-->
<pre><code class="language-console">$ RUST_BACKTRACE=1 cargo run
thread 'main' panicked at 'index out of bounds: the len is 3 but the index is 99', src/main.rs:4:5
stack backtrace:
   0: rust_begin_unwind
             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/std/src/panicking.rs:483
   1: core::panicking::panic_fmt
             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/core/src/panicking.rs:85
   2: core::panicking::panic_bounds_check
             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/core/src/panicking.rs:62
   3: &lt;usize as core::slice::index::SliceIndex&lt;[T]&gt;&gt;::index
             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/core/src/slice/index.rs:255
   4: core::slice::index::&lt;impl core::ops::index::Index&lt;I&gt; for [T]&gt;::index
             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/core/src/slice/index.rs:15
   5: &lt;alloc::vec::Vec&lt;T&gt; as core::ops::index::Index&lt;I&gt;&gt;::index
             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/alloc/src/vec.rs:1982
   6: panic::main
             at ./src/main.rs:4
   7: core::ops::function::FnOnce::call_once
             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/core/src/ops/function.rs:227
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre>
<p><span class="caption">Listing 9-2: Backtrace Ä‘Æ°á»£c táº¡o ra bá»Ÿi má»™t cuá»™c gá»i
<code>panic!</code> Ä‘Æ°á»£c hiá»ƒn thá»‹ khi biáº¿n mÃ´i trÆ°á»ng <code>RUST_BACKTRACE</code> Ä‘Æ°á»£c thiáº¿t láº­p</span></p>
<p>Nhiá»u ouput Ä‘Æ°á»£c in ra! Ouput cá»¥ thá»ƒ báº¡n tháº¥y cÃ³ thá»ƒ khÃ¡c nhau tÃ¹y thuá»™c vÃ o
há»‡ Ä‘iá»u hÃ nh vÃ  phiÃªn báº£n Rust cá»§a báº¡n. Äá»ƒ cÃ³ Ä‘Æ°á»£c backtraces vá»›i thÃ´ng tin
nÃ y, cÃ¡c kÃ½ hiá»‡u gá»¡ lá»—i pháº£i Ä‘Æ°á»£c báº­t. KÃ½ hiá»‡u gá»¡ lá»—i Ä‘Æ°á»£c báº­t máº·c Ä‘á»‹nh khi sá»­
dá»¥ng <code>cargo build</code> hoáº·c <code>cargo run</code> mÃ  khÃ´ng cÃ³ cá» <code>--release</code>, nhÆ° chÃºng tÃ´i
Ä‘Ã£ cÃ³ á»Ÿ Ä‘Ã¢y.</p>
<p>Trong ouput trong Listing 9-2, dÃ²ng 6 cá»§a backtrace chá»‰ Ä‘áº¿n dÃ²ng trong dá»± Ã¡n
cá»§a chÃºng ta gÃ¢y ra váº¥n Ä‘á»: dÃ²ng 4 cá»§a <em>src/main.rs</em>. Náº¿u chÃºng ta khÃ´ng muá»‘n
chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta bá»‹ panic, chÃºng ta nÃªn báº¯t Ä‘áº§u Ä‘iá»u tra táº¡i vá»‹ trÃ­
Ä‘Æ°á»£c chá»‰ Ä‘áº¿n bá»Ÿi dÃ²ng Ä‘áº§u tiÃªn nÃ³i vá» má»™t tá»‡p mÃ  chÃºng ta Ä‘Ã£ viáº¿t. Trong
Listing 9-1, khi chÃºng ta cÃ³ Ã½ Ä‘á»‹nh viáº¿t mÃ£ sáº½ bá»‹ panic, cÃ¡ch Ä‘á»ƒ sá»­a lá»—i panic
lÃ  khÃ´ng yÃªu cáº§u má»™t pháº§n tá»­ ngoÃ i pháº¡m vi cá»§a cÃ¡c chá»‰ sá»‘ vector. Khi mÃ£ cá»§a
báº¡n bá»‹ panic trong tÆ°Æ¡ng lai, báº¡n sáº½ cáº§n pháº£i suy nghÄ© vá» hÃ nh Ä‘á»™ng mÃ£ Ä‘ang
thá»±c hiá»‡n vá»›i giÃ¡ trá»‹ nÃ o Ä‘á»ƒ gÃ¢y ra panic vÃ  mÃ£ nÃªn lÃ m gÃ¬ thay tháº¿.</p>
<p>ChÃºng ta sáº½ quay láº¡i <code>panic!</code> vÃ  khi nÃ o chÃºng ta nÃªn vÃ  khÃ´ng nÃªn sá»­ dá»¥ng
<code>panic!</code> Ä‘á»ƒ xá»­ lÃ½ cÃ¡c Ä‘iá»u kiá»‡n lá»—i trong pháº§n <a href="ch09-03-to-panic-or-not-to-panic.html#to-panic-or-not-to-panic">â€œTo <code>panic!</code> or Not to
<code>panic!</code>â€</a><!-- ignore --> sau trong chÆ°Æ¡ng nÃ y.
Tiáº¿p theo, chÃºng ta sáº½ xem cÃ¡ch khÃ´i phá»¥c lá»—i báº±ng cÃ¡ch sá»­ dá»¥ng <code>Result</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="recoverable-errors-with-result"><a class="header" href="#recoverable-errors-with-result">Recoverable Errors with <code>Result</code></a></h2>
<p>Háº§u háº¿t cÃ¡c lá»—i khÃ´ng Ä‘á»§ nghiÃªm trá»ng Ä‘á»ƒ yÃªu cáº§u chÆ°Æ¡ng trÃ¬nh dá»«ng hoÃ n toÃ n.
ÄÃ´i khi, khi má»™t hÃ m tháº¥t báº¡i, nÃ³ lÃ  vÃ¬ má»™t lÃ½ do mÃ  báº¡n cÃ³ thá»ƒ dá»… dÃ ng diá»…n
giáº£i vÃ  pháº£n á»©ng. VÃ­ dá»¥, náº¿u báº¡n cá»‘ gáº¯ng má»Ÿ má»™t tá»‡p vÃ  hoáº¡t Ä‘á»™ng tháº¥t báº¡i bá»Ÿi
vÃ¬ tá»‡p khÃ´ng tá»“n táº¡i, báº¡n cÃ³ thá»ƒ muá»‘n táº¡o tá»‡p thay vÃ¬ káº¿t thÃºc quÃ¡ trÃ¬nh.</p>
<p>Nháº¯c láº¡i tá»« <a href="ch02-00-guessing-game-tutorial.html#handling-potential-failure-with-the-result-type">â€œHandling Potential Failure with the <code>Result</code>
Typeâ€</a><!-- ignore --> trong ChÆ°Æ¡ng 2 ráº±ng <code>Result</code> enum Ä‘Æ°á»£c
Ä‘á»‹nh nghÄ©a lÃ  cÃ³ hai biáº¿n thá»ƒ, <code>Ok</code> vÃ  <code>Err</code>, nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Result&lt;T, E&gt; {
    Ok(T),
    Err(E),
}
<span class="boring">}</span></code></pre></pre>
<p><code>T</code> vÃ  <code>E</code> lÃ  cÃ¡c tham sá»‘ kiá»ƒu generic: chÃºng ta sáº½ tháº£o luáº­n vá» generic ká»¹
hÆ¡n trong ChÆ°Æ¡ng 10. Báº¡n cáº§n biáº¿t ngay bÃ¢y giá» lÃ  <code>T</code> biá»ƒu diá»…n kiá»ƒu cá»§a giÃ¡
trá»‹ sáº½ Ä‘Æ°á»£c tráº£ vá» trong trÆ°á»ng há»£p thÃ nh cÃ´ng trong biáº¿n thá»ƒ <code>Ok</code>, vÃ  <code>E</code>
biá»ƒu diá»…n kiá»ƒu cá»§a lá»—i sáº½ Ä‘Æ°á»£c tráº£ vá» trong trÆ°á»ng há»£p tháº¥t báº¡i trong biáº¿n
thá»ƒ <code>Err</code>. Bá»Ÿi vÃ¬ <code>Result</code> cÃ³ cÃ¡c tham sá»‘ kiá»ƒu generic nÃ y, chÃºng ta cÃ³ thá»ƒ sá»­
dá»¥ng kiá»ƒu <code>Result</code> vÃ  cÃ¡c hÃ m Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn nÃ³ trong nhiá»u tÃ¬nh huá»‘ng
khÃ¡c nhau mÃ  giÃ¡ trá»‹ thÃ nh cÃ´ng vÃ  giÃ¡ trá»‹ lá»—i mÃ  chÃºng ta muá»‘n tráº£ vá» cÃ³ thá»ƒ
khÃ¡c nhau.</p>
<p>CÃ¹ng gá»i má»™t hÃ m mÃ  tráº£ vá» má»™t giÃ¡ trá»‹ <code>Result</code> bá»Ÿi vÃ¬ hÃ m cÃ³ thá»ƒ tháº¥t báº¡i.
Trong Listing 9-3 chÃºng ta cá»‘ gáº¯ng má»Ÿ má»™t tá»‡p.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::fs::File;

fn main() {
    let greeting_file_result = File::open("hello.txt");
}</code></pre></pre>
<p><span class="caption">Listing 9-3: Má»Ÿ má»™t tá»‡p</span></p>
<p>Kiá»ƒu tráº£ vá» cá»§a <code>File::open</code> lÃ  <code>Result&lt;T, E&gt;</code>. Tham sá»‘ kiá»ƒu generic <code>T</code>
Ä‘Æ°á»£c Ä‘iá»n vÃ o bá»Ÿi hiá»‡n thá»±c <code>File::open</code> vá»›i kiá»ƒu cá»§a giÃ¡ trá»‹ khi gá»i thÃ nh
cÃ´ng lÃ  <code>std::fs::File</code>, Ä‘Ã³ lÃ  má»™t file handle. Kiá»ƒu cá»§a <code>E</code> Ä‘Æ°á»£c sá»­ dá»¥ng trong
giÃ¡ vÃ  giÃ¡ trá»‹ lá»—i lÃ  <code>std::io::Error</code>. Kiá»ƒu tráº£ vá» nÃ y cÃ³ nghÄ©a lÃ  lá»i gá»i Ä‘áº¿n
<code>File::open</code> cÃ³ thá»ƒ thÃ nh cÃ´ng vÃ  tráº£ vá» má»™t file handle mÃ  chÃºng ta cÃ³ thá»ƒ
Ä‘á»c hoáº·c ghi. Lá»i gá»i hÃ m cÅ©ng cÃ³ thá»ƒ tháº¥t báº¡i: vÃ­ dá»¥, tá»‡p cÃ³ thá»ƒ khÃ´ng tá»“n táº¡i,
hoáº·c chÃºng ta cÃ³ thá»ƒ khÃ´ng cÃ³ quyá»n truy cáº­p tá»‡p. HÃ m <code>File::open</code> cáº§n pháº£i cÃ³
má»™t cÃ¡ch Ä‘á»ƒ cho chÃºng ta biáº¿t nÃ³ Ä‘Ã£ thÃ nh cÃ´ng hay tháº¥t báº¡i vÃ  cÃ¹ng lÃºc cho
chÃºng ta má»™t file handle hoáº·c thÃ´ng tin vá» lá»—i. ThÃ´ng tin nÃ y chÃ­nh lÃ  nhá»¯ng
gÃ¬ enum <code>Result</code> truyá»n táº£i.</p>
<p>Trong trÆ°á»ng há»£p <code>File::open</code> thÃ nh cÃ´ng, giÃ¡ trá»‹ trong biáº¿n
<code>greeting_file_result</code> sáº½ lÃ  má»™t thá»ƒ hiá»‡n cá»§a <code>Ok</code> chá»©a má»™t file handle. Trong
trÆ°á»ng há»£p nÃ³ tháº¥t báº¡i, giÃ¡ trá»‹ trong <code>greeting_file_result</code> sáº½ lÃ  má»™t thá»ƒ hiá»‡n
cá»§a <code>Err</code> chá»©a thÃªm thÃ´ng tin vá» loáº¡i lá»—i Ä‘Ã£ xáº£y ra.</p>
<p>ChÃºng ta cáº§n thÃªm vÃ o code trong Listing 9-3 Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng khÃ¡c
nhau tÃ¹y thuá»™c vÃ o giÃ¡ trá»‹ mÃ  <code>File::open</code> tráº£ vá». Listing 9-4 cho tháº¥y má»™t
cÃ¡ch Ä‘á»ƒ xá»­ lÃ½ <code>Result</code> sá»­ dá»¥ng má»™t cÃ´ng cá»¥ cÆ¡ báº£n, biá»ƒu thá»©c <code>match</code> mÃ  chÃºng
ta Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 6.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust should_panic edition2024">use std::fs::File;

fn main() {
    let greeting_file_result = File::open("hello.txt");

    let greeting_file = match greeting_file_result {
        Ok(file) =&gt; file,
        Err(error) =&gt; panic!("Problem opening the file: {error:?}"),
    };
}</code></pre></pre>
<p><span class="caption">Listing 9-4: Sá»­ dá»¥ng biá»ƒu thá»©c <code>match</code> Ä‘á»ƒ xá»­ lÃ½ cÃ¡c
thá»ƒ hiá»‡n <code>Result</code> cÃ³ thá»ƒ Ä‘Æ°á»£c tráº£ vá»</span></p>
<p>ChÃº Ã½ ráº±ng, giá»‘ng nhÆ° enum <code>Option</code>, enum <code>Result</code> vÃ  cÃ¡c biáº¿n thá»ƒ cá»§a nÃ³ Ä‘Ã£
Ä‘Æ°á»£c Ä‘Æ°a vÃ o scope bá»Ÿi prelude, vÃ¬ váº­y chÃºng ta khÃ´ng cáº§n chá»‰ Ä‘á»‹nh <code>Result::</code>
trÆ°á»›c cÃ¡c biáº¿n thá»ƒ <code>Ok</code> vÃ  <code>Err</code> trong cÃ¡c nhÃ¡nh cá»§a <code>match</code>.</p>
<p>Khi káº¿t quáº£ lÃ  <code>Ok</code>, code nÃ y sáº½ tráº£ vá» giÃ¡ trá»‹ ná»™i bá»™ <code>file</code> bÃªn trong biáº¿n
thá»ƒ <code>Ok</code>, vÃ  chÃºng ta sau Ä‘Ã³ gÃ¡n giÃ¡ trá»‹ file handle Ä‘Ã³ cho biáº¿n
<code>greeting_file</code>. Sau <code>match</code>, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng file handle Ä‘á»ƒ Ä‘á»c hoáº·c
ghi.</p>
<p>NhÃ¡nh cÃ²n láº¡i cá»§a <code>match</code> xá»­ lÃ½ trÆ°á»ng há»£p chÃºng ta nháº­n Ä‘Æ°á»£c má»™t giÃ¡ trá»‹ <code>Err</code>
tá»« <code>File::open</code>. Trong vÃ­ dá»¥ nÃ y, chÃºng ta Ä‘Ã£ chá»n gá»i macro <code>panic!</code>. Náº¿u
khÃ´ng cÃ³ tá»‡p nÃ o cÃ³ tÃªn <em>hello.txt</em> trong thÆ° má»¥c hiá»‡n táº¡i cá»§a chÃºng ta vÃ  chÃºng
ta cháº¡y mÃ£ nÃ y, chÃºng ta sáº½ tháº¥y Ä‘áº§u ra sau tá»« macro <code>panic!</code>:</p>
<pre><code class="language-console">$ cargo run
   Compiling error-handling v0.1.0 (file:///projects/error-handling)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.73s
     Running `target/debug/error-handling`

thread 'main' panicked at src/main.rs:8:23:
Problem opening the file: Os { code: 2, kind: NotFound, message: "No such file or directory" }
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>NhÆ° thÆ°á»ng lá»‡, output nÃ y cho chÃºng ta biáº¿t chÃ­nh xÃ¡c lá»—i lÃ  gÃ¬.</p>
<h3 id="sá»­-dá»¥ng-matching-vá»›i-cÃ¡c-lá»—i-khÃ¡c-nhau"><a class="header" href="#sá»­-dá»¥ng-matching-vá»›i-cÃ¡c-lá»—i-khÃ¡c-nhau">Sá»­ dá»¥ng Matching vá»›i cÃ¡c lá»—i khÃ¡c nhau</a></h3>
<p>Code trong Listing 9-4 sáº½ <code>panic!</code> báº¥t ká»ƒ lÃ½ do nÃ o mÃ  <code>File::open</code> tháº¥t báº¡i.
Tuy nhiÃªn, chÃºng ta muá»‘n thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng khÃ¡c nhau cho cÃ¡c lÃ½ do tháº¥t
báº¡i khÃ¡c nhau: náº¿u <code>File::open</code> tháº¥t báº¡i vÃ¬ tá»‡p khÃ´ng tá»“n táº¡i, chÃºng ta muá»‘n
táº¡o tá»‡p vÃ  tráº£ vá» handle Ä‘áº¿n tá»‡p má»›i. Náº¿u <code>File::open</code> tháº¥t báº¡i vÃ¬ báº¥t ká»³ lÃ½
do nÃ o khÃ¡c - vÃ­ dá»¥, vÃ¬ chÃºng ta khÃ´ng cÃ³ quyá»n má»Ÿ tá»‡p - chÃºng ta váº«n muá»‘n mÃ£
<code>panic!</code> theo cÃ¡ch giá»‘ng nhÆ° trong Listing 9-4. Äá»ƒ lÃ m Ä‘iá»u nÃ y, chÃºng ta thÃªm
má»™t biá»ƒu thá»©c <code>match</code> bÃªn trong, Ä‘Æ°á»£c hiá»ƒn thá»‹ trong Listing 9-5.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<!-- ignore this test because otherwise it creates hello.txt which causes other
tests to fail lol -->
<pre><code class="language-rust ignore">use std::fs::File;
use std::io::ErrorKind;

fn main() {
    let greeting_file_result = File::open("hello.txt");

    let greeting_file = match greeting_file_result {
        Ok(file) =&gt; file,
        Err(error) =&gt; match error.kind() {
            ErrorKind::NotFound =&gt; match File::create("hello.txt") {
                Ok(fc) =&gt; fc,
                Err(e) =&gt; panic!("Problem creating the file: {e:?}"),
            },
            _ =&gt; {
                panic!("Problem opening the file: {error:?}");
            }
        },
    };
}</code></pre>
<p><span class="caption">Listing 9-5: Xá»­ lÃ½ cÃ¡c loáº¡i lá»—i khÃ¡c nhau theo cÃ¡c cÃ¡ch
khÃ¡c nhau</span></p>
<p>Kiá»ƒu cá»§a giÃ¡ trá»‹ mÃ  <code>File::open</code> tráº£ vá» bÃªn trong biáº¿n <code>Err</code> lÃ  <code>io::Error</code>,
má»™t struct Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n chuáº©n. Struct nÃ y cÃ³ má»™t phÆ°Æ¡ng thá»©c
<code>kind</code> mÃ  chÃºng ta cÃ³ thá»ƒ gá»i Ä‘á»ƒ láº¥y má»™t giÃ¡ trá»‹ <code>io::ErrorKind</code>. Enum
<code>io::ErrorKind</code> Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n chuáº©n vÃ  cÃ³ cÃ¡c biáº¿n thá»ƒ biá»ƒu
thá»‹ cÃ¡c loáº¡i lá»—i khÃ¡c nhau cÃ³ thá»ƒ xáº£y ra tá»« má»™t hoáº¡t Ä‘á»™ng <code>io</code>. Biáº¿n thá»ƒ mÃ 
chÃºng ta muá»‘n sá»­ dá»¥ng lÃ  <code>ErrorKind::NotFound</code>, biá»ƒu thá»‹ tá»‡p mÃ  chÃºng ta Ä‘ang
cá»‘ gáº¯ng má»Ÿ khÃ´ng tá»“n táº¡i. Do Ä‘Ã³, chÃºng ta <code>match</code> trÃªn <code>greeting_file_result</code>,
nhÆ°ng chÃºng ta cÅ©ng cÃ³ má»™t <code>match</code> bÃªn trong trÃªn <code>error.kind()</code>.</p>
<p>Äiá»u kiá»‡n mÃ  chÃºng ta muá»‘n kiá»ƒm tra trong <code>match</code> bÃªn trong lÃ  liá»‡u giÃ¡ trá»‹
tráº£ vá» bá»Ÿi <code>error.kind()</code> cÃ³ pháº£i lÃ  biáº¿n thá»ƒ <code>NotFound</code> cá»§a enum <code>ErrorKind</code>.
Náº¿u cÃ³, chÃºng ta cá»‘ gáº¯ng táº¡o tá»‡p vá»›i <code>File::create</code>. Tuy nhiÃªn, vÃ¬
<code>File::create</code> cÅ©ng cÃ³ thá»ƒ tháº¥t báº¡i, chÃºng ta cáº§n má»™t biáº¿n thá»ƒ thá»© hai trong
biá»ƒu thá»©c <code>match</code> bÃªn trong. Khi tá»‡p khÃ´ng thá»ƒ Ä‘Æ°á»£c táº¡o, má»™t thÃ´ng bÃ¡o lá»—i
khÃ¡c Ä‘Æ°á»£c in ra. Biáº¿n thá»ƒ thá»© hai cá»§a <code>match</code> bÃªn ngoÃ i váº«n giá»¯ nguyÃªn, vÃ¬ váº­y
chÆ°Æ¡ng trÃ¬nh sáº½ bá»‹ panic vá»›i báº¥t ká»³ lá»—i nÃ o ngoÃ i lá»—i tá»‡p thiáº¿u.</p>
<section class="note" aria-role="note">
<h3 id="alternatives-to-using-match-with-resultt-e"><a class="header" href="#alternatives-to-using-match-with-resultt-e">Alternatives to Using <code>match</code> with <code>Result&lt;T, E&gt;</code></a></h3>
<p>CÃ³ quÃ¡ nhiá»u <code>match</code>! Biá»ƒu thá»©c <code>match</code> ráº¥t há»¯u Ã­ch nhÆ°ng váº«n lÃ  má»™t biá»ƒu thá»©c
cÆ¡ báº£n. Trong ChÆ°Æ¡ng 13, báº¡n sáº½ tÃ¬m hiá»ƒu vá» closures, Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i nhiá»u
phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn <code>Result&lt;T, E&gt;</code>. Nhá»¯ng phÆ°Æ¡ng thá»©c nÃ y cÃ³ thá»ƒ
ngáº¯n gá»n hÆ¡n so vá»›i viá»‡c sá»­ dá»¥ng <code>match</code> khi xá»­ lÃ½ giÃ¡ trá»‹ <code>Result&lt;T, E&gt;</code>
trong code cá»§a báº¡n</p>
<p>VÃ­ dá»¥, Ä‘Ã¢y lÃ  má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ viáº¿t cÃ¹ng má»™t logic nhÆ° trong Listing 9-5,
láº§n nÃ y sá»­ dá»¥ng closures vÃ  phÆ°Æ¡ng thá»©c <code>unwrap_or_else</code>:</p>
<!-- CAN'T EXTRACT SEE https://github.com/rust-lang/mdBook/issues/1127 -->
<pre><code class="language-rust ignore">use std::fs::File;
use std::io::ErrorKind;

fn main() {
    let greeting_file = File::open("hello.txt").unwrap_or_else(|error| {
        if error.kind() == ErrorKind::NotFound {
            File::create("hello.txt").unwrap_or_else(|error| {
                panic!("Problem creating the file: {:?}", error);
            })
        } else {
            panic!("Problem opening the file: {:?}", error);
        }
    });
}</code></pre>
<p>Máº·c dÃ¹ code nÃ y cÃ³ cÃ¹ng hÃ nh vi nhÆ° Listing 9-5, nÃ³ khÃ´ng chá»©a báº¥t ká»³ biá»ƒu
thá»©c <code>match</code> nÃ o vÃ  dá»… Ä‘á»c hÆ¡n. Quay láº¡i vÃ­ dá»¥ nÃ y sau khi báº¡n Ä‘Ã£ Ä‘á»c ChÆ°Æ¡ng
13, vÃ  tÃ¬m kiáº¿m phÆ°Æ¡ng thá»©c <code>unwrap_or_else</code> trong tÃ i liá»‡u thÆ° viá»‡n chuáº©n.
Nhiá»u phÆ°Æ¡ng thá»©c khÃ¡c cÃ³ thá»ƒ  lÃ m ngáº¯n gá»n cÃ¡c biá»ƒu thá»©c <code>match</code> lá»“ng nhau
lá»›n khi báº¡n Ä‘ang xá»­ lÃ½ cÃ¡c lá»—i.</p>
</section>
<hr />
<h3 id="shortcuts-for-panic-on-error-unwrap-and-expect"><a class="header" href="#shortcuts-for-panic-on-error-unwrap-and-expect">Shortcuts for Panic on Error: <code>unwrap</code> and <code>expect</code></a></h3>
<p>Sá»­ dá»¥ng <code>match</code> thÆ°á»ng tá»‘t, nhÆ°ng nÃ³ cÃ³ thá»ƒ ráº¥t dÃ i dÃ²ng vÃ  khÃ³ hiá»ƒu.
Kiá»ƒu <code>Result&lt;T, E&gt;</code> cÃ³ nhiá»u phÆ°Æ¡ng thá»©c trá»£ giÃºp Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn nÃ³ Ä‘á»ƒ
thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ cá»¥ thá»ƒ hÆ¡n. PhÆ°Æ¡ng thá»©c <code>unwrap</code> lÃ  má»™t phÆ°Æ¡ng thá»©c táº¯t
Ä‘Æ°á»£c thá»±c hiá»‡n giá»‘ng nhÆ° biá»ƒu thá»©c <code>match</code> mÃ  chÃºng ta Ä‘Ã£ viáº¿t trong Listing
9-4. Náº¿u giÃ¡ trá»‹ <code>Result</code> lÃ  biáº¿n <code>Ok</code>, <code>unwrap</code> sáº½ tráº£ vá» giÃ¡ trá»‹ bÃªn trong
biáº¿n <code>Ok</code>. Náº¿u <code>Result</code> lÃ  biáº¿n <code>Err</code>, <code>unwrap</code> sáº½ gá»i macro <code>panic!</code> giÃºp
chÃºng ta. ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ vá» <code>unwrap</code> hoáº¡t Ä‘á»™ng:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust should_panic edition2024">use std::fs::File;

fn main() {
    let greeting_file = File::open("hello.txt").unwrap();
}</code></pre></pre>
<p>Náº¿u chÃºng ta cháº¡y code nÃ y mÃ  khÃ´ng cÃ³ file <em>hello.txt</em>, chÃºng ta sáº½ tháº¥y má»™t
thÃ´ng bÃ¡o lá»—i tá»« lá»‡nh <code>panic!</code> mÃ  phÆ°Æ¡ng thá»©c <code>unwrap</code> gá»i:</p>
<!-- manual-regeneration
cd listings/ch09-error-handling/no-listing-04-unwrap
cargo run
copy and paste relevant text
-->
<pre><code class="language-text">thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Error {
repr: Os { code: 2, message: "No such file or directory" } }',
src/libcore/result.rs:906:4
</code></pre>
<p>TÆ°Æ¡ng tá»±, phÆ°Æ¡ng thá»©c <code>expect</code> cho phÃ©p chÃºng ta chá»n thÃ´ng bÃ¡o lá»—i <code>panic!</code>.
Sá»­ dá»¥ng <code>expect</code> thay vÃ¬ <code>unwrap</code> vÃ  cung cáº¥p cÃ¡c thÃ´ng bÃ¡o lá»—i tá»‘t cÃ³ thá»ƒ
truyá»n Ä‘áº¡t Ã½ Ä‘á»‹nh cá»§a báº¡n vÃ  lÃ m cho viá»‡c tÃ¬m nguyÃªn nhÃ¢n cá»§a má»™t lá»—i dá»… dÃ ng
hÆ¡n. CÃº phÃ¡p cá»§a <code>expect</code> nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust should_panic edition2024">use std::fs::File;

fn main() {
    let greeting_file = File::open("hello.txt")
        .expect("hello.txt should be included in this project");
}</code></pre></pre>
<p>ChÃºng ta sá»­ dá»¥ng <code>expect</code> theo cÃ¡ch giá»‘ng nhÆ° <code>unwrap</code>: Ä‘á»ƒ tráº£ vá» file handle
hoáº·c gá»i macro <code>panic!</code>. ThÃ´ng bÃ¡o lá»—i Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi <code>expect</code> trong lá»‡nh
<code>panic!</code> sáº½ lÃ  tham sá»‘ mÃ  chÃºng ta truyá»n cho <code>expect</code>, thay vÃ¬ thÃ´ng bÃ¡o lá»—i
máº·c Ä‘á»‹nh cá»§a <code>panic!</code> mÃ  <code>unwrap</code> sá»­ dá»¥ng. ÄÃ¢y lÃ  cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ng:</p>
<!-- manual-regeneration
cd listings/ch09-error-handling/no-listing-05-expect
cargo run
copy and paste relevant text
-->
<pre><code class="language-text">thread 'main' panicked at 'hello.txt should be included in this project: Error
{ repr: Os { code: 2, message: "No such file or directory" } }',
src/libcore/result.rs:906:4
</code></pre>
<p>Trong code á»Ÿ production, háº§u háº¿t Rustaceans (ngÆ°á»i dÃ¹ng Rust) chá»n
<code>expect</code> thay vÃ¬ <code>unwrap</code> vÃ  cung cáº¥p thÃªm thÃ´ng tin vá» táº¡i sao cÃ¡c hoáº¡t Ä‘á»™ng
Ä‘Æ°á»£c mong Ä‘á»£i lÃ  luÃ´n thÃ nh cÃ´ng. Äiá»u Ä‘Ã³ cho phÃ©p báº¡n cÃ³ thÃªm thÃ´ng tin Ä‘á»ƒ
sá»­ dá»¥ng trong quÃ¡ trÃ¬nh debug náº¿u nhÆ° cÃ¡c giáº£ Ä‘á»‹nh cá»§a báº¡n bá»‹ chá»©ng minh sai.</p>
<hr />
<h3 id="propagating-errors"><a class="header" href="#propagating-errors">Propagating Errors</a></h3>
<p>Khi má»™t hÃ m thá»±c thi gá»i má»™t thá»© gÃ¬ Ä‘Ã³ cÃ³ thá»ƒ gÃ¢y ra lá»—i, thay vÃ¬ xá»­ lÃ½ lá»—i
trong hÃ m thá»±c thi, báº¡n cÃ³ thá»ƒ tráº£ vá» lá»—i cho code gá»i hÃ m Ä‘á»ƒ nÃ³ cÃ³ thá»ƒ quyáº¿t
Ä‘á»‹nh lÃ m gÃ¬. Äiá»u nÃ y Ä‘Æ°á»£c gá»i lÃ  <em>propagating (lan truyá»n)</em> lá»—i vÃ  cho phÃ©p
code gá»i Ä‘áº¿n hÃ m cÃ³ thá»ƒ quyáº¿t Ä‘á»‹nh xá»­ lÃ½ lá»—i theo cÃ¡ch nÃ o mÃ  nÃ³ thÃ­ch hÆ¡n.</p>
<p>VÃ­ dá»¥, Listing 9-6 cho tháº¥y má»™t hÃ m Ä‘á»c username tá»« má»™t file. Náº¿u file khÃ´ng
tá»“n táº¡i hoáº·c khÃ´ng thá»ƒ Ä‘á»c Ä‘Æ°á»£c, hÃ m nÃ y sáº½ tráº£ vá» lá»—i Ä‘Ã³ cho code gá»i hÃ m.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<!-- Deliberately not using rustdoc_include here; the `main` function in the
file panics. We do want to include it for reader experimentation purposes, but
don't want to include it for rustdoc testing purposes. -->
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::fs::File;
use std::io::{self, Read};

fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {
    let username_file_result = File::open("hello.txt");

    let mut username_file = match username_file_result {
        Ok(file) =&gt; file,
        Err(e) =&gt; return Err(e),
    };

    let mut username = String::new();

    match username_file.read_to_string(&amp;mut username) {
        Ok(_) =&gt; Ok(username),
        Err(e) =&gt; Err(e),
    }
}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 9-6: Má»™t hÃ m tráº£ vá» lá»—i cho code gá»i hÃ m sá»­ dá»¥ng
<code>match</code></span></p>
<p>HÃ m nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c viáº¿t ngáº¯n gá»n hÆ¡n, nhÆ°ng chÃºng ta sáº½ báº¯t Ä‘áº§u báº±ng cÃ¡ch
viáº¿t nÃ³ má»™t cÃ¡ch thá»§ cÃ´ng Ä‘á»ƒ khÃ¡m phÃ¡ vá» xá»­ lÃ½ lá»—i; á»Ÿ cuá»‘i, chÃºng ta sáº½ cho
tháº¥y cÃ¡ch viáº¿t ngáº¯n gá»n hÆ¡n. HÃ£y xem kiá»ƒu tráº£ vá» cá»§a hÃ m trÆ°á»›c tiÃªn:
<code>Result&lt;String, io::Error&gt;</code>. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  hÃ m tráº£ vá» má»™t giÃ¡ trá»‹ cá»§a
kiá»ƒu <code>Result&lt;T, E&gt;</code> vá»›i tham sá»‘ <code>T</code> Ä‘Æ°á»£c Ä‘iá»n vÃ o vá»›i kiá»ƒu cá»¥ thá»ƒ <code>String</code>,
vÃ  kiá»ƒu <code>E</code> Ä‘Æ°á»£c Ä‘iá»n vÃ o vá»›i kiá»ƒu cá»¥ thá»ƒ <code>io::Error</code>.</p>
<p>Náº¿u hÃ m nÃ y thÃ nh cÃ´ng mÃ  khÃ´ng cÃ³ váº¥n Ä‘á» gÃ¬, code gá»i hÃ m nÃ y sáº½ nháº­n Ä‘Æ°á»£c
má»™t giÃ¡ trá»‹ <code>Ok</code> chá»©a má»™t <code>String</code> - username mÃ  hÃ m nÃ y Ä‘á»c tá»« file. Náº¿u hÃ m
nÃ y gáº·p báº¥t ká»³ váº¥n Ä‘á» nÃ o, code gá»i hÃ m sáº½ nháº­n Ä‘Æ°á»£c má»™t giÃ¡ trá»‹ <code>Err</code> chá»©a má»™t
thá»ƒ hiá»‡n cá»§a <code>io::Error</code> chá»©a thÃ´ng tin chi tiáº¿t vá» váº¥n Ä‘á». ChÃºng ta chá»n
<code>io::Error</code> lÃ  kiá»ƒu tráº£ vá» cá»§a hÃ m nÃ y vÃ¬ Ä‘Ã³ chÃ­nh lÃ  kiá»ƒu cá»§a giÃ¡ trá»‹ lá»—i
tráº£ vá» tá»« cáº£ hai hoáº¡t Ä‘á»™ng mÃ  chÃºng ta gá»i trong thÃ¢n hÃ m nÃ y cÃ³ thá»ƒ gáº·p lá»—i:
hÃ m <code>File::open</code> vÃ  phÆ°Æ¡ng thá»©c <code>read_to_string</code>.</p>
<p>ThÃ¢n hÃ m báº¯t Ä‘áº§u báº±ng cÃ¡ch gá»i hÃ m <code>File::open</code>. Sau Ä‘Ã³ chÃºng ta xá»­ lÃ½ giÃ¡ trá»‹
<code>Result</code> vá»›i má»™t <code>match</code> giá»‘ng nhÆ° <code>match</code> trong Listing 9-4. Náº¿u <code>File::open</code>
thÃ nh cÃ´ng, file handle trong biáº¿n máº«u <code>file</code> trá»Ÿ thÃ nh giÃ¡ trá»‹ trong biáº¿n
<code>username_file</code> vÃ  hÃ m tiáº¿p tá»¥c. Trong trÆ°á»ng há»£p <code>Err</code>, thay vÃ¬ gá»i <code>panic!</code>,
chÃºng ta sá»­ dá»¥ng tá»« khÃ³a <code>return</code> Ä‘á»ƒ tráº£ vá» sá»›m vÃ  tráº£ vá» giÃ¡ trá»‹ lá»—i tá»«
<code>File::open</code>, giá» Ä‘Ã¢y trong biáº¿n máº«u <code>e</code>, vá» code gá»i hÃ m nhÆ° lÃ  giÃ¡ trá»‹ lá»—i
cá»§a hÃ m nÃ y.</p>
<p>NÃªn náº¿u chÃºng ta cÃ³ má»™t file handle trong <code>username_file</code>,
chÃºng ta sáº½ táº¡o má»™t biáº¿n kiÃªu <code>String</code> má»›i vá»›i tÃªn <code>username</code>
vÃ  gá»i phÆ°Æ¡ng thá»©c <code>read_to_string</code> cá»§a
file handle trong <code>username_file</code> Ä‘á»ƒ Ä‘á»c ná»™i dung cá»§a file vÃ o <code>username</code>.
PhÆ°Æ¡ng thá»©c <code>read_to_string</code> cÅ©ng tráº£ vá» má»™t <code>Result</code> vÃ¬ nÃ³ cÃ³ thá»ƒ gáº·p lá»—i,
dÃ¹ <code>File::open</code> Ä‘Ã£ thÃ nh cÃ´ng. VÃ¬ váº­y chÃºng ta cáº§n má»™t <code>match</code> khÃ¡c Ä‘á»ƒ xá»­ lÃ½
<code>Result</code>: náº¿u <code>read_to_string</code> thÃ nh cÃ´ng, thÃ¬ hÃ m cá»§a chÃºng ta Ä‘Ã£ thÃ nh cÃ´ng,
vÃ  chÃºng ta tráº£ vá» username tá»« file hiá»‡n táº¡i trong <code>username</code> Ä‘Æ°á»£c bá»c trong
má»™t <code>Ok</code>. Náº¿u <code>read_to_string</code> gáº·p lá»—i, chÃºng ta tráº£ vá» giÃ¡ trá»‹ lá»—i theo cÃ¡ch
giá»‘ng nhÆ° chÃºng ta tráº£ vá» giÃ¡ trá»‹ lá»—i trong <code>match</code> xá»­ lÃ½ giÃ¡ trá»‹ tráº£ vá» cá»§a
<code>File::open</code>. Tuy nhiÃªn, chÃºng ta khÃ´ng cáº§n pháº£i nÃ³i rÃµ <code>return</code>, vÃ¬ Ä‘Ã¢y lÃ 
biá»ƒu thá»©c cuá»‘i cÃ¹ng trong hÃ m.</p>
<p>Äoáº¡n code gá»i hÃ m nÃ y sáº½ xá»­ lÃ½ viá»‡c nháº­n Ä‘Æ°á»£c má»™t giÃ¡ trá»‹ <code>Ok</code> chá»©a má»™t username
hoáº·c má»™t giÃ¡ trá»‹ <code>Err</code> chá»©a má»™t <code>io::Error</code>. NÃ³ phá»¥ thuá»™c vÃ o code gá»i hÃ m Ä‘á»ƒ
quyáº¿t Ä‘á»‹nh lÃ m gÃ¬ vá»›i nhá»¯ng giÃ¡ trá»‹ nÃ y. Náº¿u code gá»i hÃ m nháº­n Ä‘Æ°á»£c má»™t giÃ¡ trá»‹
<code>Err</code>, nÃ³ cÃ³ thá»ƒ gá»i <code>panic!</code> vÃ  crash chÆ°Æ¡ng trÃ¬nh, sá»­ dá»¥ng má»™t username máº·c
Ä‘á»‹nh, hoáº·c tÃ¬m kiáº¿m username tá»« má»™t nÆ¡i khÃ¡c ngoÃ i file, vÃ­ dá»¥. ChÃºng ta khÃ´ng
cÃ³ Ä‘á»§ thÃ´ng tin vá» viá»‡c code gá»i hÃ m thá»±c sá»± muá»‘n lÃ m gÃ¬, vÃ¬ váº­y chÃºng ta truyá»n
táº¥t cáº£ thÃ´ng tin thÃ nh cÃ´ng hoáº·c lá»—i lÃªn trÃªn Ä‘á»ƒ code gá»i hÃ m xá»­ lÃ½ phÃ¹ há»£p.</p>
<p>PhÆ°Æ¡ng phÃ¡p truyá»n lá»—i nÃ y ráº¥t phá»• biáº¿n trong Rust, vÃ¬ váº­y Rust cung cáº¥p
phÃ©p toÃ¡n dáº¥u há»i <code>?</code> Ä‘á»ƒ lÃ m cho viá»‡c nÃ y dá»… dÃ ng hÆ¡n.</p>
<h4 id="a-shortcut-for-propagating-errors-the--operator"><a class="header" href="#a-shortcut-for-propagating-errors-the--operator">A Shortcut for Propagating Errors: the <code>?</code> Operator</a></h4>
<p>Listing 9-7 chá»‰ ra má»™t cÃ¡ch code cá»§a <code>read_username_from_file</code> cÃ³ cÃ¹ng chá»©c
nÄƒng nhÆ° trong Listing 9-6, nhÆ°ng cÃ¡ch code nÃ y sá»­ dá»¥ng phÃ©p toÃ¡n <code>?</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<!-- Deliberately not using rustdoc_include here; the `main` function in the
file panics. We do want to include it for reader experimentation purposes, but
don't want to include it for rustdoc testing purposes. -->
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::fs::File;
use std::io::{self, Read};

fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {
    let mut username_file = File::open("hello.txt")?;
    let mut username = String::new();
    username_file.read_to_string(&amp;mut username)?;
    Ok(username)
}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 9-7: Má»™t hÃ m tráº£ vá» lá»—i cho code gá»i hÃ m sá»­ dá»¥ng
phÃ©p toÃ¡n <code>?</code></span></p>
<p>PhÃ©p toÃ¡n <code>?</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a Ä‘á»ƒ hoáº¡t Ä‘á»™ng gáº§n nhÆ° giá»‘ng nhÆ° cÃ¡c biá»ƒu thá»©c
<code>match</code> mÃ  chÃºng ta Ä‘á»‹nh nghÄ©a Ä‘á»ƒ xá»­ lÃ½ cÃ¡c giÃ¡ trá»‹ <code>Result</code> trong Listing
9-6. Náº¿u giÃ¡ trá»‹ cá»§a <code>Result</code> lÃ  <code>Ok</code>, giÃ¡ trá»‹ bÃªn trong <code>Ok</code> sáº½ Ä‘Æ°á»£c tráº£ vá»
tá»« biá»ƒu thá»©c nÃ y, vÃ  chÆ°Æ¡ng trÃ¬nh sáº½ tiáº¿p tá»¥c. Náº¿u giÃ¡ trá»‹ lÃ  <code>Err</code>, <code>Err</code> sáº½
Ä‘Æ°á»£c tráº£ vá» tráº£ vá» sá»›m vÃ  káº¿t thÃºc hÃ m, giá»‘ng cÃ¡ch chÃºng ta dÃ¹ng <code>return</code>.</p>
<p>CÃ³ má»™t sá»± khÃ¡c biá»‡t giá»¯a viá»‡c biá»ƒu thá»©c <code>match</code> tá»« Listing 9-6 lÃ m gÃ¬ vÃ  viá»‡c
phÃ©p toÃ¡n <code>?</code> lÃ m gÃ¬: cÃ¡c giÃ¡ trá»‹ lá»—i mÃ  cÃ³ phÃ©p toÃ¡n <code>?</code> Ä‘Æ°á»£c gá»i sáº½ Ä‘i qua
hÃ m <code>from</code>, Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong trait <code>From</code> cá»§a thÆ° viá»‡n chuáº©n, Ä‘Æ°á»£c sá»­
dá»¥ng Ä‘á»ƒ chuyá»ƒn Ä‘á»•i giÃ¡ trá»‹ tá»« má»™t kiá»ƒu thÃ nh má»™t kiá»ƒu khÃ¡c. Khi phÃ©p toÃ¡n <code>?</code>
gá»i hÃ m <code>from</code>, kiá»ƒu lá»—i nháº­n Ä‘Æ°á»£c sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh kiá»ƒu lá»—i Ä‘Æ°á»£c Ä‘á»‹nh
nghÄ©a trong kiá»ƒu tráº£ vá» cá»§a hÃ m hiá»‡n táº¡i. Äiá»u nÃ y ráº¥t há»¯u Ã­ch khi má»™t hÃ m tráº£
vá» má»™t kiá»ƒu lá»—i Ä‘á»ƒ biá»ƒu diá»…n táº¥t cáº£ cÃ¡c cÃ¡ch mÃ  má»™t hÃ m cÃ³ thá»ƒ tháº¥t báº¡i, ngay cáº£
khi cÃ¡c pháº§n cÃ³ thá»ƒ tháº¥t báº¡i vÃ¬ nhiá»u lÃ½ do khÃ¡c nhau.</p>
<p>VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i hÃ m <code>read_username_from_file</code> trong Listing
9-7 Ä‘á»ƒ tráº£ vá» má»™t kiá»ƒu lá»—i tÃ¹y chá»‰nh Ä‘Æ°á»£c Ä‘áº·t tÃªn lÃ  <code>OurError</code> mÃ  chÃºng ta
Ä‘á»‹nh nghÄ©a. Náº¿u chÃºng ta cÅ©ng Ä‘á»‹nh nghÄ©a <code>impl From&lt;io::Error&gt; for OurError</code>
Ä‘á»ƒ táº¡o má»™t thá»ƒ hiá»‡n cá»§a <code>OurError</code> tá»« má»™t <code>io::Error</code>, thÃ¬ phÃ©p toÃ¡n <code>?</code> sáº½
gá»i <code>from</code> vÃ  chuyá»ƒn Ä‘á»•i kiá»ƒu lá»—i mÃ  khÃ´ng cáº§n thÃªm báº¥t kÃ¬ Ä‘oáº¡n mÃ£ nÃ o vÃ o
hÃ m.</p>
<p>Trong ngá»¯ cáº£nh cá»§a Listing 9-7, phÃ©p toÃ¡n <code>?</code> á»Ÿ cuá»‘i lá»i gá»i <code>File::open</code> sáº½
tráº£ vá» giÃ¡ trá»‹ bÃªn trong má»™t <code>Ok</code> cho biáº¿n <code>username_file</code>. Náº¿u xáº£y ra lá»—i,
phÃ©p toÃ¡n <code>?</code> sáº½ tráº£ vá» sá»›m vÃ  tráº£ báº¥t kÃ¬ giÃ¡ trá»‹ <code>Err</code> nÃ o
cho code gá»i hÃ m. Äiá»u Ä‘Ã³ cÅ©ng Ä‘Æ°á»£c Ã¡p dá»¥ng cho phÃ©p toÃ¡n <code>?</code> á»Ÿ cuá»‘i lá»i gá»i
<code>read_to_string</code>.</p>
<p>PhÃ©p toÃ¡n <code>?</code> loáº¡i bá» ráº¥t nhiá»u Ä‘oáº¡n mÃ£ láº·p Ä‘i vÃ  lÃ m cho viá»‡c triá»ƒn khai hÃ m
trá»Ÿ nÃªn Ä‘Æ¡n giáº£n hÆ¡n. ChÃºng ta cÃ³ thá»ƒ rÃºt ngáº¯n Ä‘oáº¡n mÃ£ nÃ y thÃªm báº±ng cÃ¡ch
liÃªn tiáº¿p gá»i cÃ¡c phÆ°Æ¡ng thá»©c ngay sau phÃ©p toÃ¡n <code>?</code>, nhÆ° trong Listing 9-8.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<!-- Deliberately not using rustdoc_include here; the `main` function in the
file panics. We do want to include it for reader experimentation purposes, but
don't want to include it for rustdoc testing purposes. -->
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::fs::File;
use std::io::{self, Read};

fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {
    let mut username = String::new();

    File::open("hello.txt")?.read_to_string(&amp;mut username)?;

    Ok(username)
}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 9-8: LiÃªn tiáº¿p gá»i cÃ¡c phÆ°Æ¡ng thá»©c sau phÃ©p toÃ¡n
<code>?</code></span></p>
<p>ChÃºng ta táº¡o má»™t biáº¿n <code>String</code> tÃªn <code>username</code> á»Ÿ Ä‘áº§u hÃ m; pháº§n Ä‘Ã³ khÃ´ng
thay Ä‘á»•i. Thay vÃ¬ táº¡o má»™t biáº¿n <code>username_file</code>, chÃºng ta liÃªn tiáº¿p gá»i phÆ°Æ¡ng
thá»©c <code>read_to_string</code> trá»±c tiáº¿p trÃªn káº¿t quáº£ cá»§a <code>File::open("hello.txt")?</code>.
ChÃºng ta váº«n cÃ³ má»™t <code>?</code> á»Ÿ cuá»‘i lá»i gá»i <code>read_to_string</code> vÃ  chÃºng ta váº«n tráº£ vá»
má»™t giÃ¡ trá»‹ <code>Ok</code> chá»©a <code>username</code> khi cáº£ <code>File::open</code> vÃ  <code>read_to_string</code>
thÃ nh cÃ´ng thay vÃ¬ tráº£ vá» lá»—i. Chá»©c nÄƒng váº«n giá»‘ng nhÆ° trong Listing 9-6 vÃ 
Listing 9-7; Ä‘Ã¢y chá»‰ lÃ  má»™t cÃ¡ch khÃ¡c, dá»… dÃ¹ng hÆ¡n Ä‘á»ƒ viáº¿t nÃ³.</p>
<p>Listing 9-9 cho tháº¥y má»™t cÃ¡ch Ä‘á»ƒ lÃ m cho Ä‘oáº¡n mÃ£ nÃ y ngáº¯n hÆ¡n báº±ng cÃ¡ch sá»­
dá»¥ng <code>fs::read_to_string</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<!-- Deliberately not using rustdoc_include here; the `main` function in the
file panics. We do want to include it for reader experimentation purposes, but
don't want to include it for rustdoc testing purposes. -->
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::fs;
use std::io;

fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {
    fs::read_to_string("hello.txt")
}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 9-9: Sá»­ dá»¥ng <code>fs::read_to_string</code> thay vÃ¬ má»Ÿ vÃ 
sau Ä‘Ã³ Ä‘á»c file</span></p>
<p>Äá»c má»™t file vÃ o má»™t chuá»—i lÃ  má»™t thao tÃ¡c ráº¥t phá»• biáº¿n, vÃ¬ váº­y thÆ° viá»‡n chuáº©n
cung cáº¥p má»™t hÃ m tiá»‡n lá»£i <code>fs::read_to_string</code> Ä‘á»ƒ má»Ÿ file, táº¡o má»™t <code>String</code>
má»›i, Ä‘á»c ná»™i dung cá»§a file, Ä‘áº·t ná»™i dung vÃ o <code>String</code> Ä‘Ã³ vÃ  tráº£ vá» nÃ³. ÄÆ°Æ¡ng
nhiÃªn, sá»­ dá»¥ng <code>fs::read_to_string</code> khÃ´ng cho chÃºng ta cÆ¡ há»™i Ä‘á»ƒ giáº£i thÃ­ch
táº¥t cáº£ cÃ¡c xá»­ lÃ½ lá»—i, vÃ¬ váº­y chÃºng ta Ä‘Ã£ lÃ m theo cÃ¡ch dÃ i hÆ¡n trÆ°á»›c.</p>
<hr />
<h4 id="where-the--operator-can-be-used"><a class="header" href="#where-the--operator-can-be-used">Where The <code>?</code> Operator Can Be Used</a></h4>
<p>ToÃ¡n tá»­ <code>?</code> chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng trong cÃ¡c hÃ m mÃ  kiá»ƒu tráº£ vá» lÃ  tÆ°Æ¡ng
thÃ­ch vá»›i giÃ¡ trá»‹ mÃ  <code>?</code> Ä‘Æ°á»£c sá»­ dá»¥ng. Äiá»u nÃ y lÃ  bá»Ÿi vÃ¬ toÃ¡n tá»­ <code>?</code> Ä‘Æ°á»£c Ä‘á»‹nh
nghÄ©a Ä‘á»ƒ thá»±c hiá»‡n má»™t yÃªu cáº§u tráº£ vá» sá»›m cá»§a má»™t giÃ¡ trá»‹ ra khá»i hÃ m,
cÃ¹ng má»™t cÃ¡ch nhÆ° biá»ƒu thá»©c <code>match</code> mÃ  chÃºng ta Ä‘á»‹nh nghÄ©a trong Listing 9-6.
Trong Listing 9-6, <code>match</code> sá»­ dá»¥ng má»™t giÃ¡ trá»‹ <code>Result</code>, vÃ  tráº£ vá» sá»›m má»™t giÃ¡
trá»‹ <code>Err(e)</code>. Kiá»ƒu tráº£ vá» cá»§a hÃ m pháº£i lÃ  má»™t <code>Result</code> Ä‘á»ƒ nÃ³ tÆ°Æ¡ng thÃ­ch vá»›i
tráº£ vá» sá»›m cá»§a lá»‡nh <code>return</code>.</p>
<p>Trong Listing 9-10, hÃ£y xem lá»—i mÃ  chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c náº¿u chÃºng ta sá»­ dá»¥ng
toÃ¡n tá»­ <code>?</code> trong má»™t hÃ m <code>main</code> vá»›i kiá»ƒu tráº£ vá» khÃ´ng tÆ°Æ¡ng thÃ­ch vá»›i kiá»ƒu cá»§a
giÃ¡ trá»‹ mÃ  chÃºng ta sá»­ dá»¥ng <code>?</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">use std::fs::File;

fn main() {
    let greeting_file = File::open("hello.txt")?;
}</code></pre>
<p><span class="caption">Listing 9-10: Cá»‘ gáº¯ng sá»­ dá»¥ng <code>?</code> trong hÃ m <code>main</code> tráº£
vá» <code>()</code> sáº½ khÃ´ng biÃªn dá»‹ch Ä‘Æ°á»£c</span></p>
<p>Äoáº¡n code nÃ y má»Ÿ má»™t file, cÃ³ thá»ƒ sáº½ tháº¥t báº¡i. ToÃ¡n tá»­ <code>?</code> theo sau giÃ¡ trá»‹
<code>Result</code> Ä‘Æ°á»£c tráº£ vá» bá»Ÿi <code>File::open</code>, nhÆ°ng hÃ m <code>main</code> nÃ y cÃ³ kiá»ƒu tráº£ vá» lÃ 
<code>()</code>, khÃ´ng pháº£i <code>Result</code>. Khi chÃºng ta biÃªn dá»‹ch Ä‘oáº¡n code nÃ y, chÃºng ta sáº½
nháº­n Ä‘Æ°á»£c lá»—i nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling error-handling v0.1.0 (file:///projects/error-handling)
error[E0277]: the `?` operator can only be used in a function that returns `Result` or `Option` (or another type that implements `FromResidual`)
 --&gt; src/main.rs:4:48
  |
3 | fn main() {
  | --------- this function should return `Result` or `Option` to accept `?`
4 |     let greeting_file = File::open("hello.txt")?;
  |                                                ^ cannot use the `?` operator in a function that returns `()`
  |
  = help: the trait `FromResidual&lt;Result&lt;Infallible, std::io::Error&gt;&gt;` is not implemented for `()`
help: consider adding return type
  |
3 ~ fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
4 |     let greeting_file = File::open("hello.txt")?;
5 +     Ok(())
  |

For more information about this error, try `rustc --explain E0277`.
error: could not compile `error-handling` (bin "error-handling") due to 1 previous error
</code></pre>
<p>Lá»—i nÃ y chá»‰ ra ráº±ng chÃºng ta chá»‰ Ä‘Æ°á»£c phÃ©p sá»­ dá»¥ng toÃ¡n tá»­ <code>?</code> trong má»™t hÃ m
tráº£ vá» <code>Result</code>, <code>Option</code>, hoáº·c má»™t kiá»ƒu khÃ¡c mÃ  nÃ³ triá»ƒn khai <code>FromResidual</code>.</p>
<p>Äá»ƒ sá»­a lá»—i, chÃºng ta cÃ³ hai lá»±a chá»n. Lá»±a chá»n Ä‘áº§u tiÃªn lÃ  thay Ä‘á»•i kiá»ƒu tráº£ vá»
cá»§a hÃ m Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch vá»›i giÃ¡ trá»‹ mÃ  chÃºng ta Ä‘ang sá»­ dá»¥ng toÃ¡n tá»­ <code>?</code>
trong khi khÃ´ng cÃ³ giá»›i háº¡n nÃ o ngÄƒn cáº£n Ä‘iá»u Ä‘Ã³. CÃ¡ch khÃ¡c lÃ  sá»­ dá»¥ng má»™t
<code>match</code> hoáº·c má»™t trong cÃ¡c phÆ°Æ¡ng thá»©c cá»§a <code>Result&lt;T, E&gt;</code> Ä‘á»ƒ xá»­ lÃ½
<code>Result&lt;T, E&gt;</code> theo cÃ¡ch phÃ¹ há»£p.</p>
<p>Lá»—i cÃ²n nÃ³i ráº±ng <code>?</code> cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i giÃ¡ trá»‹ <code>Option&lt;T&gt;</code> cÅ©ng nhÆ° váº­y.
Giá»‘ng nhÆ° sá»­ dá»¥ng <code>?</code> trÃªn <code>Result</code>, chÃºng ta chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng <code>?</code> trÃªn
<code>Option</code> trong má»™t hÃ m tráº£ vá» <code>Option</code>. HÃ nh vi cá»§a toÃ¡n tá»­ <code>?</code> khi Ä‘Æ°á»£c gá»i
trÃªn má»™t <code>Option&lt;T&gt;</code> tÆ°Æ¡ng tá»± nhÆ° hÃ nh vi cá»§a nÃ³ khi Ä‘Æ°á»£c gá»i trÃªn má»™t
<code>Result&lt;T, E&gt;</code>: náº¿u giÃ¡ trá»‹ lÃ  <code>None</code>, <code>None</code> sáº½ Ä‘Æ°á»£c tráº£ vá» sá»›m tá»« hÃ m táº¡i
Ä‘iá»ƒm Ä‘Ã³. Náº¿u giÃ¡ trá»‹ lÃ  <code>Some</code>, giÃ¡ trá»‹ bÃªn trong <code>Some</code>
sáº½ lÃ  giÃ¡ trá»‹ káº¿t quáº£ cá»§a biá»ƒu thá»©c vÃ  hÃ m sáº½ tiáº¿p tá»¥c. Listing 9-11 cÃ³ má»™t
vÃ­ dá»¥ vá» má»™t hÃ m tÃ¬m kÃ½ tá»± cuá»‘i cÃ¹ng cá»§a dÃ²ng Ä‘áº§u tiÃªn trong vÄƒn báº£n cho trÆ°á»›c:</p>
<pre><pre class="playground"><code class="language-rust edition2024">fn last_char_of_first_line(text: &amp;str) -&gt; Option&lt;char&gt; {
    text.lines().next()?.chars().last()
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    assert_eq!(
</span><span class="boring">        last_char_of_first_line("Hello, world\nHow are you today?"),
</span><span class="boring">        Some('d')
</span><span class="boring">    );
</span><span class="boring">
</span><span class="boring">    assert_eq!(last_char_of_first_line(""), None);
</span><span class="boring">    assert_eq!(last_char_of_first_line("\nhi"), None);
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 9-11: Sá»­ dá»¥ng toÃ¡n tá»­ <code>?</code> trÃªn má»™t giÃ¡ trá»‹
<code>Option&lt;T&gt;</code></span></p>
<p>HÃ m nÃ y tráº£ vá» <code>Option&lt;char&gt;</code> vÃ¬ cÃ³ thá»ƒ cÃ³ má»™t kÃ½ tá»± á»Ÿ Ä‘Ã³, nhÆ°ng cÅ©ng cÃ³ thá»ƒ
khÃ´ng cÃ³. Code nÃ y láº¥y Ä‘oáº¡n chuá»—i <code>text</code> vÃ  gá»i phÆ°Æ¡ng thá»©c <code>lines</code> trÃªn nÃ³,
nÃ³ sáº½ tráº£ vá» má»™t iterator (vÃ²ng láº·p) trÃªn cÃ¡c dÃ²ng trong chuá»—i. VÃ¬ hÃ m nÃ y muá»‘n
xem xÃ©t dÃ²ng Ä‘áº§u tiÃªn, nÃ³ gá»i <code>next</code> trÃªn iterator Ä‘á»ƒ láº¥y giÃ¡ trá»‹ Ä‘áº§u tiÃªn tá»«
iterator. Náº¿u <code>text</code> lÃ  má»™t chuá»—i rá»—ng, cuá»™c gá»i <code>next</code> nÃ y sáº½ tráº£ vá» <code>None</code>,
trong trÆ°á»ng há»£p nÃ y chÃºng ta sá»­ dá»¥ng <code>?</code> Ä‘á»ƒ dá»«ng vÃ  tráº£ vá» <code>None</code> tá»«
<code>last_char_of_first_line</code>. Náº¿u <code>text</code> khÃ´ng pháº£i lÃ  má»™t chuá»—i rá»—ng, <code>next</code> sáº½
tráº£ vá» má»™t giÃ¡ trá»‹ <code>Some</code> chá»©a má»™t Ä‘oáº¡n chuá»—i cá»§a dÃ²ng Ä‘áº§u tiÃªn trong <code>text</code>.</p>
<p><code>?</code> trÃ­ch xuáº¥t Ä‘oáº¡n chuá»—i, vÃ  chÃºng ta cÃ³ thá»ƒ gá»i <code>chars</code> trÃªn Ä‘oáº¡n chuá»—i Ä‘Ã³ Ä‘á»ƒ
láº¥y má»™t iterator (vÃ²ng láº·p) cá»§a cÃ¡c kÃ½ tá»± trong Ä‘oáº¡n chuá»—i. ChÃºng ta quan tÃ¢m
Ä‘áº¿n kÃ½ tá»± cuá»‘i cÃ¹ng trong dÃ²ng Ä‘áº§u tiÃªn nÃ y, vÃ¬ váº­y chÃºng ta gá»i <code>last</code> Ä‘á»ƒ
tráº£ vá» item cuá»‘i cÃ¹ng trong iterator. ÄÃ¢y lÃ  má»™t <code>Option</code> vÃ¬ cÃ³ thá»ƒ dÃ²ng Ä‘áº§u
tiÃªn lÃ  má»™t chuá»—i rá»—ng, vÃ­ dá»¥ náº¿u <code>text</code> báº¯t Ä‘áº§u vá»›i má»™t dÃ²ng tráº¯ng nhÆ°ng cÃ³
cÃ¡c kÃ½ tá»± trÃªn cÃ¡c dÃ²ng khÃ¡c, nhÆ° trong <code>"\nhi"</code>. Tuy nhiÃªn, náº¿u cÃ³ má»™t kÃ½ tá»±
cuá»‘i cÃ¹ng trÃªn dÃ²ng Ä‘áº§u tiÃªn, nÃ³ sáº½ Ä‘Æ°á»£c tráº£ vá» trong biáº¿n <code>Some</code>. ToÃ¡n tá»­ <code>?</code>
á»Ÿ giá»¯a cung cáº¥p cho chÃºng ta má»™t cÃ¡ch ngáº¯n gá»n Ä‘á»ƒ biá»ƒu thá»‹ logic nÃ y, cho phÃ©p
chÃºng ta thá»±c hiá»‡n hÃ m trong má»™t dÃ²ng. Náº¿u chÃºng ta khÃ´ng thá»ƒ sá»­ dá»¥ng toÃ¡n tá»­
<code>?</code> trÃªn <code>Option</code>, chÃºng ta sáº½ pháº£i thá»±c hiá»‡n logic nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng nhiá»u
phÆ°Æ¡ng thá»©c gá»i hÆ¡n hoáº·c má»™t biá»ƒu thá»©c <code>match</code>.</p>
<p>LÆ°u Ã½ ráº±ng báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng toÃ¡n tá»­ <code>?</code> trÃªn má»™t <code>Result</code> trong má»™t hÃ m tráº£
vá» <code>Result</code>, vÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng toÃ¡n tá»­ <code>?</code> trÃªn má»™t <code>Option</code> trong má»™t hÃ m
tráº£ vá» <code>Option</code>, nhÆ°ng báº¡n khÃ´ng thá»ƒ káº¿t há»£p vÃ  phá»‘i há»£p. ToÃ¡n tá»­ <code>?</code> sáº½ khÃ´ng
tá»± Ä‘á»™ng chuyá»ƒn Ä‘á»•i má»™t <code>Result</code> thÃ nh má»™t <code>Option</code> hoáº·c ngÆ°á»£c láº¡i; trong nhá»¯ng
trÆ°á»ng há»£p Ä‘Ã³, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c nhÆ° phÆ°Æ¡ng thá»©c <code>ok</code> trÃªn
<code>Result</code> hoáº·c phÆ°Æ¡ng thá»©c <code>ok_or</code> trÃªn <code>Option</code> Ä‘á»ƒ thá»±c hiá»‡n chuyá»ƒn Ä‘á»•i má»™t cÃ¡ch
rÃµ rÃ ng.</p>
<p>Hiá»‡n táº¡i, táº¥t cáº£ cÃ¡c hÃ m <code>main</code> mÃ  chÃºng ta Ä‘Ã£ sá»­ dá»¥ng tráº£ vá» <code>()</code>. HÃ m <code>main</code>
Ä‘áº·c biá»‡t bá»Ÿi vÃ¬ nÃ³ lÃ  Ä‘iá»ƒm vÃ o (entry point) vÃ  ra cá»§a cÃ¡c chÆ°Æ¡ng trÃ¬nh thá»±c
thi, vÃ  cÃ³ nhá»¯ng háº¡n cháº¿ vá» kiá»ƒu tráº£ vá» cá»§a nÃ³ Ä‘á»ƒ cÃ¡c chÆ°Æ¡ng trÃ¬nh hoáº¡t Ä‘á»™ng
nhÆ° mong Ä‘á»£i.</p>
<p>May máº¯n thay, <code>main</code> cÅ©ng cÃ³ thá»ƒ tráº£ vá» má»™t <code>Result&lt;(), E&gt;</code>. Listing 9-12 cÃ³
code tá»« Listing 9-10 nhÆ°ng Ä‘Ã£ thay Ä‘á»•i kiá»ƒu tráº£ vá» cá»§a <code>main</code> thÃ nh
<code>Result&lt;(), Box&lt;dyn Error&gt;&gt;</code> vÃ  thÃªm má»™t giÃ¡ trá»‹ tráº£ vá» <code>Ok(())</code> vÃ o cuá»‘i.
Code nÃ y sáº½ bÃ¢y giá» Ä‘Æ°á»£c biÃªn dá»‹ch:</p>
<pre><code class="language-rust ignore">use std::error::Error;
use std::fs::File;

fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let greeting_file = File::open("hello.txt")?;

    Ok(())
}</code></pre>
<p><span class="caption">Listing 9-12: Äá»•i <code>main</code> Ä‘á»ƒ tráº£ vá» <code>Result&lt;(), E&gt;</code> cho
phÃ©p sá»­ dá»¥ng toÃ¡n tá»­ <code>?</code> trÃªn cÃ¡c giÃ¡ trá»‹ <code>Result</code></span></p>
<p>Kiá»ƒu <code>Box&lt;dyn Error&gt;</code> lÃ  má»™t <em>trait object</em>, mÃ  chÃºng ta sáº½ nÃ³i vá» nÃ³ trong
pháº§n <a href="ch17-02-trait-objects.html#using-trait-objects-that-allow-for-values-of-different-types">â€œUsing Trait Objects that Allow for Values of Different
Typesâ€</a><!-- ignore --> trong ChÆ°Æ¡ng 17. Hiá»‡n táº¡i, báº¡n cÃ³ thá»ƒ
Ä‘á»c <code>Box&lt;dyn Error&gt;</code> lÃ  â€œbáº¥t ká»³ loáº¡i lá»—i nÃ oâ€. Sá»­ dá»¥ng <code>?</code> trÃªn má»™t giÃ¡ trá»‹
<code>Result</code> trong má»™t hÃ m <code>main</code> vá»›i kiá»ƒu lá»—i <code>Box&lt;dyn Error&gt;</code> Ä‘Æ°á»£c cho phÃ©p,
bá»Ÿi vÃ¬ nÃ³ cho phÃ©p báº¥t ká»³ giÃ¡ trá»‹ <code>Err</code> nÃ o Ä‘Æ°á»£c tráº£ vá» sá»›m. DÃ¹ cho pháº§n thÃ¢n
cá»§a hÃ m <code>main</code> nÃ y sáº½ chá»‰ tráº£ vá» lá»—i cá»§a kiá»ƒu <code>std::io::Error</code>, báº±ng cÃ¡ch
xÃ¡c Ä‘á»‹nh <code>Box&lt;dyn Error&gt;</code>, kiá»ƒu nÃ y sáº½ tiáº¿p tá»¥c Ä‘Ãºng ngay cáº£ khi thÃªm code
mÃ  tráº£ vá» cÃ¡c lá»—i khÃ¡c vÃ o pháº§n thÃ¢n cá»§a <code>main</code>.</p>
<p>Khi hÃ m <code>main</code> tráº£ vá» <code>Result&lt;(), E&gt;</code>, chÆ°Æ¡ng trÃ¬nh sáº½ thoÃ¡t vá»›i má»™t giÃ¡
trá»‹ <code>0</code> náº¿u <code>main</code> tráº£ vá» <code>Ok(())</code> vÃ  sáº½ thoÃ¡t vá»›i má»™t giÃ¡ trá»‹ khÃ¡c khÃ´ng
pháº£i <code>0</code> náº¿u <code>main</code> tráº£ vá» má»™t giÃ¡ trá»‹ <code>Err</code>. CÃ¡c chÆ°Æ¡ng trÃ¬nh Ä‘Æ°á»£c viáº¿t báº±ng
C tráº£ vá» cÃ¡c sá»‘ nguyÃªn khi thoÃ¡t: cÃ¡c chÆ°Æ¡ng trÃ¬nh thoÃ¡t thÃ nh cÃ´ng tráº£ vá»
sá»‘ nguyÃªn <code>0</code>, vÃ  cÃ¡c chÆ°Æ¡ng trÃ¬nh bá»‹ lá»—i tráº£ vá» má»™t sá»‘ nguyÃªn khÃ¡c khÃ´ng
pháº£i <code>0</code>. Rust cÅ©ng tráº£ vá» cÃ¡c sá»‘ nguyÃªn tá»« cÃ¡c chÆ°Æ¡ng trÃ¬nh Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch
vá»›i quy Æ°á»›c nÃ y.</p>
<p>HÃ m <code>main</code> cÃ³ thá»ƒ tráº£ vá» báº¥t ká»³ kiá»ƒu nÃ o thá»±c thi <a href="../std/process/trait.Termination.html">the
<code>std::process::Termination</code> trait</a><!-- ignore -->, mÃ  chá»©a má»™t
hÃ m <code>report</code> tráº£ vá» má»™t <code>ExitCode</code>. HÃ£y xem tÃ i liá»‡u thÆ° viá»‡n chuáº©n Ä‘á»ƒ biáº¿t
thÃªm thÃ´ng tin vá» viá»‡c thá»±c thi trait <code>Termination</code> cho cÃ¡c kiá»ƒu cá»§a báº¡n.</p>
<p>BÃ¢y giá» chÃºng ta Ä‘Ã£ tháº£o luáº­n vá» chi tiáº¿t vá» viá»‡c gá»i <code>panic!</code> hoáº·c tráº£ vá»
<code>Result</code>, hÃ£y trá»Ÿ láº¡i vá» chá»§ Ä‘á» lÃ m tháº¿ nÃ o Ä‘á»ƒ quyáº¿t Ä‘á»‹nh sá»­ dá»¥ng cÃ¡i nÃ o
trong cÃ¡c trÆ°á»ng há»£p cá»¥ thá»ƒ.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="to-panic-or-not-to-panic"><a class="header" href="#to-panic-or-not-to-panic">To <code>panic!</code> or Not to <code>panic!</code></a></h2>
<p>Khi nÃ o báº¡n nÃªn dÃ¹ng <code>panic</code> vÃ  khi nÃ o nÃªn return vá» <code>Result</code>? Khi code panic,
thÃ¬ khÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ khÃ´i phá»¥c láº¡i. Báº¡n cÃ³ thá»ƒ dÃ¹ng <code>panic</code> cho báº¥t ká»³
trÆ°á»ng há»£p lá»—i nÃ o, dÃ¹ cÃ³ thá»ƒ khÃ´i phá»¥c láº¡i hay khÃ´ng, nhÆ°ng báº¡n sáº½ pháº£i Ä‘Æ°a ra
quyáº¿t Ä‘á»‹nh ráº±ng má»™t trÆ°á»ng há»£p lÃ  khÃ´ng thá»ƒ khÃ´i phá»¥c láº¡i Ä‘Æ°á»£c, Ä‘á»‘i vá»›i code gá»i
hÃ m. Khi báº¡n chá»n tráº£ vá» má»™t giÃ¡ trá»‹ <code>Result</code>, báº¡n sáº½ cho phÃ©p code gá»i hÃ m cÃ³
cÃ¡c lá»±a chá»n. Code gá»i hÃ m cÃ³ thá»ƒ chá»n cÃ¡ch khÃ´i phá»¥c láº¡i má»™t cÃ¡ch phÃ¹ há»£p vá»›i
trÆ°á»ng há»£p cá»§a nÃ³, hoáº·c nÃ³ cÃ³ thá»ƒ quyáº¿t Ä‘á»‹nh ráº±ng má»™t giÃ¡ trá»‹ <code>Err</code> trong trÆ°á»ng
há»£p nÃ y lÃ  khÃ´ng thá»ƒ khÃ´i phá»¥c láº¡i Ä‘Æ°á»£c, vÃ¬ váº­y nÃ³ cÃ³ thá»ƒ gá»i <code>panic</code> vÃ  chuyá»ƒn
má»™t lá»—i cÃ³ thá»ƒ khÃ´i phá»¥c láº¡i thÃ nh má»™t lá»—i khÃ´ng thá»ƒ khÃ´i phá»¥c láº¡i. Do Ä‘Ã³, tráº£
vá» má»™t giÃ¡ trá»‹ <code>Result</code> lÃ  má»™t lá»±a chá»n máº·c Ä‘á»‹nh tá»‘t khi báº¡n Ä‘á»‹nh nghÄ©a má»™t hÃ m
cÃ³ thá»ƒ gÃ¢y lá»—i.</p>
<p>Trong cÃ¡c trÆ°á»ng há»£p nhÆ° vÃ­ dá»¥, code prototype, vÃ  cÃ¡c test code, thÃ¬ viáº¿t code
dÃ¹ng <code>panic</code> thay vÃ¬ tráº£ vá» má»™t giÃ¡ trá»‹ <code>Result</code> lÃ  phÃ¹ há»£p hÆ¡n. ChÃºng ta sáº½ tÃ¬m
hiá»ƒu táº¡i sao nhÆ° váº­y, sau Ä‘Ã³ tháº£o luáº­n vá» cÃ¡c trÆ°á»ng há»£p mÃ  compiler khÃ´ng thá»ƒ
biáº¿t Ä‘Æ°á»£c ráº±ng viá»‡c gÃ¢y lá»—i lÃ  khÃ´ng thá»ƒ, nhÆ°ng báº¡n lÃ  má»™t con ngÆ°á»i cÃ³ thá»ƒ.
ChÆ°Æ¡ng nÃ y sáº½ káº¿t thÃºc vá»›i má»™t sá»‘ hÆ°á»›ng dáº«n chung vá» cÃ¡ch quyáº¿t Ä‘á»‹nh cÃ³ nÃªn dÃ¹ng
<code>panic</code> trong code cá»§a thÆ° viá»‡n hay khÃ´ng.</p>
<h3 id="examples-prototype-code-and-tests"><a class="header" href="#examples-prototype-code-and-tests">Examples, Prototype Code, and Tests</a></h3>
<p>Khi báº¡n viáº¿t má»™t vÃ­ dá»¥ Ä‘á»ƒ minh hoáº¡ má»™t khÃ¡i niá»‡m nÃ o Ä‘Ã³, viá»‡c bao gá»“m code xá»­ lÃ½
lá»—i ká»¹ lÆ°á»¡ng cÅ©ng cÃ³ thá»ƒ lÃ m cho vÃ­ dá»¥ kÃ©m rÃµ rÃ ng hÆ¡n. Trong má»™t vÃ­ dá»¥,
dá»… hiá»ƒu ráº±ng gá»i Ä‘áº¿n má»™t phÆ°Æ¡ng thá»©c nhÆ° <code>unwrap</code> cÃ³ thá»ƒ gÃ¢y lá»—i
panic giá»‘ng nhÆ° lÃ  má»™t báº£n thay tháº¿ cho cÃ¡ch báº¡n muá»‘n á»©ng dá»¥ng cá»§a báº¡n xá»­ lÃ½
lá»—i, mÃ  cÃ³ thá»ƒ khÃ¡c nhau vá»›i cÃ¡c pháº§n khÃ¡c trong code cá»§a báº¡n.</p>
<p>TÆ°Æ¡ng tá»±, phÆ°Æ¡ng thá»©c <code>unwrap</code> vÃ  <code>expect</code> ráº¥t há»¯u Ã­ch khi Ä‘ang prototype,
trÆ°á»›c khi báº¡n Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ quyáº¿t Ä‘á»‹nh cÃ¡ch xá»­ lÃ½ lá»—i. ChÃºng Ä‘á»ƒ láº¡i cÃ¡c dáº¥u
chá»‰ rÃµ rÃ ng trong code cá»§a báº¡n khi báº¡n Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ lÃ m cho chÆ°Æ¡ng trÃ¬nh
cá»§a báº¡n máº¡nh cá»©ng cÃ¡p hÆ¡n.</p>
<p>Náº¿u má»™t phÆ°Æ¡ng thá»©c gá»i tháº¥t báº¡i trong má»™t test, báº¡n sáº½ muá»‘n toÃ n bá»™ test tháº¥t
báº¡i, ngay cáº£ khi phÆ°Æ¡ng thá»©c Ä‘Ã³ khÃ´ng pháº£i lÃ  chá»©c nÄƒng Ä‘ang Ä‘Æ°á»£c test. Bá»Ÿi
vÃ¬ <code>panic!</code> lÃ  cÃ¡ch Ä‘á»ƒ má»™t test Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  tháº¥t báº¡i, viá»‡c gá»i <code>unwrap</code>
hoáº·c <code>expect</code> chÃ­nh lÃ  nhá»¯ng gÃ¬ nÃªn xáº£y ra.</p>
<h3 id="cases-in-which-you-have-more-information-than-the-compiler"><a class="header" href="#cases-in-which-you-have-more-information-than-the-compiler">Cases in Which You Have More Information Than the Compiler</a></h3>
<p>Sáº½ lÃ  cháº¥p nháº­n Ä‘Æ°á»£c náº¿u báº¡n gá»i <code>unwrap</code> hoáº·c <code>expect</code> khi báº¡n cÃ³ má»™t logic
khÃ¡c mÃ  Ä‘áº£m báº£o <code>Result</code> sáº½ cÃ³ má»™t giÃ¡ trá»‹ <code>Ok</code>, nhÆ°ng logic nÃ y khÃ´ng pháº£i lÃ 
má»™t thá»© mÃ  compiler hiá»ƒu Ä‘Æ°á»£c. Báº¡n váº«n sáº½ cÃ³ má»™t giÃ¡ trá»‹ <code>Result</code> mÃ  báº¡n cáº§n
pháº£i xá»­ lÃ½: báº¥t ká»³ hoáº¡t Ä‘á»™ng nÃ o báº¡n Ä‘ang gá»i váº«n cÃ³ thá»ƒ tháº¥t báº¡i, ngay cáº£
khi nÃ³ lÃ  vÃ´ lÃ½ trong trÆ°á»ng há»£p cá»¥ thá»ƒ cá»§a báº¡n. Náº¿u báº¡n cÃ³ thá»ƒ Ä‘áº£m báº£o báº±ng
cÃ¡ch thá»§ cÃ´ng kiá»ƒm tra code mÃ  báº¡n sáº½ khÃ´ng bao giá» cÃ³ má»™t biáº¿n thá»ƒ <code>Err</code>, thÃ¬
nÃ³ lÃ  hoÃ n toÃ n cháº¥p nháº­n Ä‘Æ°á»£c Ä‘á»ƒ gá»i <code>unwrap</code>, vÃ  cÃ²n tá»‘t hÆ¡n lÃ  viáº¿t lÃ½ do
báº¡n nghÄ© báº¡n sáº½ khÃ´ng bao giá» cÃ³ má»™t biáº¿n thá»ƒ <code>Err</code> trong vÄƒn báº£n <code>expect</code>.
ÄÃ¢y lÃ  má»™t vÃ­ dá»¥:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    use std::net::IpAddr;

    let home: IpAddr = "127.0.0.1"
        .parse()
        .expect("Hardcoded IP address should be valid");
<span class="boring">}</span></code></pre></pre>
<p>ChÃºng ta Ä‘ang táº¡o má»™t instance <code>IpAddr</code> báº±ng cÃ¡ch truyá»n vÃ o má»™t chuá»—i cá»‘ Ä‘á»‹nh
(hardcode). ChÃºng ta cÃ³ thá»ƒ tháº¥y <code>127.0.0.1</code> lÃ  má»™t Ä‘á»‹a chá»‰ IP há»£p lá»‡, do Ä‘Ã³
viá»‡c sá»­ dá»¥ng <code>expect</code> á»Ÿ Ä‘Ã¢y lÃ  cháº¥p nháº­n Ä‘Æ°á»£c. Tuy nhiÃªn, viá»‡c cÃ³ má»™t chuá»—i há»£p
lá»‡ cá»‘ Ä‘á»‹nh khÃ´ng thay Ä‘á»•i kiá»ƒu tráº£ vá» cá»§a phÆ°Æ¡ng thá»©c <code>parse</code>: chÃºng ta váº«n
nháº­n Ä‘Æ°á»£c má»™t giÃ¡ trá»‹ <code>Result</code>, vÃ  compiler váº«n sáº½ yÃªu cáº§u chÃºng ta xá»­ lÃ½
<code>Result</code> nhÆ° nÃ³ cÃ³ thá»ƒ cÃ³ biáº¿n thá»ƒ <code>Err</code> vÃ¬ compiler khÃ´ng Ä‘á»§ thÃ´ng minh Ä‘á»ƒ
nhÃ¬n tháº¥y ráº±ng chuá»—i nÃ y luÃ´n luÃ´n lÃ  má»™t Ä‘á»‹a chá»‰ IP há»£p lá»‡. Náº¿u chuá»—i Ä‘á»‹a chá»‰
IP Ä‘Æ°á»£c láº¥y tá»« ngÆ°á»i dÃ¹ng thay vÃ¬ Ä‘Æ°á»£c cá»‘ Ä‘á»‹nh trong chÆ°Æ¡ng trÃ¬nh vÃ  do Ä‘Ã³
<em>cÃ³ thá»ƒ</em> cÃ³ má»™t kháº£ nÄƒng tháº¥t báº¡i, chÃºng ta sáº½ cháº¯c cháº¯n muá»‘n xá»­ lÃ½ <code>Result</code> má»™t
cÃ¡ch linh hoáº¡t hÆ¡n. Viá»‡c nháº¯c nhá»Ÿ ráº±ng giáº£ Ä‘á»‹nh nÃ y lÃ  Ä‘á»‹a chá»‰ IP Ä‘Æ°á»£c cá»‘ Ä‘á»‹nh
sáº½ lÃ m chÃºng ta thay Ä‘á»•i <code>expect</code> thÃ nh má»™t cÃ¡ch xá»­ lÃ½ lá»—i tá»‘t hÆ¡n náº¿u trong
tÆ°Æ¡ng lai, chÃºng ta cáº§n láº¥y Ä‘á»‹a chá»‰ IP tá»« má»™t nguá»“n khÃ¡c thay vÃ¬ Ä‘á»‹a chá»‰ IP cá»‘
Ä‘á»‹nh.</p>
<h3 id="guidelines-for-error-handling"><a class="header" href="#guidelines-for-error-handling">Guidelines for Error Handling</a></h3>
<p>Sáº½ tá»‘t hÆ¡n náº¿u code cá»§a báº¡n gá»i <code>panic!</code> khi cÃ³ thá»ƒ code cá»§a báº¡n sáº½ gáº·p má»™t
tráº¡ng thÃ¡i khÃ´ng tá»‘t. Trong ngá»¯ cáº£nh nÃ y, má»™t
<em>tráº¡ng thÃ¡i khÃ´ng tá»‘t (bad state)</em> lÃ  khi má»™t giáº£ Ä‘á»‹nh (assumption),
báº£o Ä‘áº£m (guarantee), há»£p Ä‘á»“ng (contract), hoáº·c báº¥t biáº¿n (invariant) nÃ o Ä‘Ã³ Ä‘Ã£
bá»‹ phÃ¡ vá»¡, nhÆ° khi cÃ¡c giÃ¡ trá»‹ khÃ´ng há»£p lá»‡, giÃ¡ trá»‹ trÃ¡i ngÆ°á»£c, hoáº·c cÃ¡c giÃ¡
trá»‹ bá»‹ thiáº¿u Ä‘Æ°á»£c truyá»n vÃ o code cá»§a báº¡n - cá»™ng vá»›i má»™t hoáº·c nhiá»u trong nhá»¯ng
Ä‘iá»u sau:</p>
<ul>
<li>Tráº¡ng thÃ¡i khÃ´ng tá»‘t nÃ y lÃ  má»™t Ä‘iá»u khÃ´ng mong Ä‘á»£i, khÃ¡c vá»›i Ä‘iá»u cÃ³ thá»ƒ
xáº£y ra thÆ°á»ng xuyÃªn, nhÆ° ngÆ°á»i dÃ¹ng nháº­p dá»¯ liá»‡u sai Ä‘á»‹nh dáº¡ng.</li>
<li>Code cá»§a báº¡n sau Ä‘iá»ƒm nÃ y cáº§n pháº£i cháº¯c ráº±ng nÃ³ khÃ´ng muá»‘n trong tráº¡ng thÃ¡i
khÃ´ng tá»‘t nÃ y, thay vÃ¬ kiá»ƒm tra váº¥n Ä‘á» nÃ y á»Ÿ má»—i bÆ°á»›c.</li>
<li>KhÃ´ng cÃ³ má»™t cÃ¡ch nÃ o Ä‘á»ƒ encode thÃ´ng tin nÃ y trong cÃ¡c kiá»ƒu mÃ  báº¡n sá»­ dá»¥ng.
ChÃºng ta sáº½ lÃ m vÃ­ dá»¥ vá» Ä‘iá»u nÃ y trong pháº§n <a href="ch17-03-oo-design-patterns.html#encoding-states-and-behavior-as-types">â€œEncoding States and Behavior
as Typesâ€</a><!-- ignore --> cá»§a chÆ°Æ¡ng 17.</li>
</ul>
<p>Náº¿u ai Ä‘Ã³ gá»i code cá»§a báº¡n vÃ  truyá»n vÃ o cÃ¡c giÃ¡ trá»‹ khÃ´ng cÃ³ Ã½ nghÄ©a, tá»‘t nháº¥t
lÃ  tráº£ vá» má»™t lá»—i náº¿u báº¡n cÃ³ thá»ƒ Ä‘á»ƒ ngÆ°á»i dÃ¹ng thÆ° viá»‡n cÃ³ thá»ƒ quyáº¿t Ä‘á»‹nh há»
muá»‘n lÃ m gÃ¬ trong trÆ°á»ng há»£p Ä‘Ã³. Tuy nhiÃªn, trong trÆ°á»ng há»£p tiáº¿p tá»¥c cÃ³ thá»ƒ
khÃ´ng an toÃ n hoáº·c cÃ³ háº¡i, lá»±a chá»n tá»‘t nháº¥t cÃ³ thá»ƒ lÃ  gá»i <code>panic!</code> vÃ  thÃ´ng
bÃ¡o cho ngÆ°á»i sá»­ dá»¥ng thÆ° viá»‡n cá»§a báº¡n vá» lá»—i trong code cá»§a há» Ä‘á»ƒ há» cÃ³ thá»ƒ
sá»­a chá»¯a trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn. TÆ°Æ¡ng tá»±, <code>panic!</code> thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng náº¿u
báº¡n Ä‘ang gá»i code bÃªn ngoÃ i mÃ  báº¡n khÃ´ng kiá»ƒm soÃ¡t Ä‘Æ°á»£c vÃ  nÃ³ tráº£ vá» má»™t tráº¡ng
thÃ¡i khÃ´ng há»£p lá»‡ mÃ  báº¡n khÃ´ng thá»ƒ sá»­a Ä‘Æ°á»£c.</p>
<p>Tuy nhiÃªn, khi tháº¥t báº¡i lÃ  cÃ³ thá»ƒ dá»± Ä‘oÃ¡n Ä‘Æ°á»£c, sáº½ thÃ­ch há»£p hÆ¡n Ä‘á»ƒ tráº£ vá» má»™t
<code>Result</code> hÆ¡n lÃ  gá»i má»™t <code>panic!</code>. VÃ­ dá»¥ bao gá»“m má»™t bá»™ phÃ¢n tÃ­ch Ä‘Æ°á»£c cung cáº¥p
dá»¯ liá»‡u bá»‹ lá»—i hoáº·c má»™t yÃªu cáº§u HTTP tráº£ vá» má»™t tráº¡ng thÃ¡i cho tháº¥y báº¡n Ä‘Ã£ Ä‘áº¡t
giá»›i háº¡n tá»‘c Ä‘á»™. Trong nhá»¯ng trÆ°á»ng há»£p nÃ y, tráº£ vá» má»™t <code>Result</code> cho tháº¥y tháº¥t
báº¡i lÃ  má»™t kháº£ nÄƒng Ä‘Æ°á»£c dá»± Ä‘oÃ¡n ráº±ng code gá»i pháº£i quyáº¿t Ä‘á»‹nh cÃ¡ch xá»­ lÃ½.</p>
<p>Khi code cá»§a báº¡n thá»±c hiá»‡n má»™t hoáº¡t Ä‘á»™ng cÃ³ thá»ƒ  táº¡o ra rá»§i ro cho ngÆ°á»i dÃ¹ng
náº¿u nÃ³ Ä‘Æ°á»£c gá»i báº±ng cÃ¡ch sá»­ dá»¥ng giÃ¡ trá»‹ khÃ´ng há»£p lá»‡, code cá»§a báº¡n nÃªn kiá»ƒm
tra giÃ¡ trá»‹ há»£p lá»‡ trÆ°á»›c vÃ  gá»i <code>panic!</code> náº¿u giÃ¡ trá»‹ khÃ´ng há»£p lá»‡. Äiá»u nÃ y
chá»§ yáº¿u lÃ  vÃ¬ lÃ½ do an toÃ n: cá»‘ gáº¯ng thá»±c hiá»‡n cÃ¡c hoáº¡t Ä‘á»™ng trÃªn dá»¯ liá»‡u khÃ´ng
há»£p lá»‡ cÃ³ thá»ƒ tiáº¿p cáº­n code cá»§a báº¡n vá»›i cÃ¡c lá»— há»•ng báº£o máº­t. ÄÃ¢y lÃ  lÃ½ do chÃ­nh
táº¡i sao thÆ° viá»‡n chuáº©n sáº½ gá»i <code>panic!</code> náº¿u báº¡n cá»‘ gáº¯ng truy cáº­p bá»™ nhá»› ngoÃ i
pháº¡m vi: cá»‘ gáº¯ng truy cáº­p bá»™ nhá»› khÃ´ng thuá»™c cáº¥u trÃºc dá»¯ liá»‡u hiá»‡n táº¡i lÃ  má»™t
váº¥n Ä‘á» báº£o máº­t phá»• biáº¿n. CÃ¡c hÃ m thÆ°á»ng cÃ³ <em>há»£p Ä‘á»“ng (contract)</em>: hÃ nh vi cá»§a
chÃºng chá»‰ Ä‘Æ°á»£c Ä‘áº£m báº£o náº¿u Ä‘áº§u vÃ o Ä‘Ã¡p á»©ng cÃ¡c yÃªu cáº§u nháº¥t Ä‘á»‹nh. Gá»i <code>panic!</code>
khi vi pháº¡m há»£p Ä‘á»“ng lÃ  há»£p lÃ½ bá»Ÿi vÃ¬ vi pháº¡m há»£p Ä‘á»“ng luÃ´n luÃ´n chá»‰ ra lá»—i á»Ÿ
phÃ­a gá»i vÃ  nÃ³ khÃ´ng pháº£i lÃ  má»™t loáº¡i lá»—i báº¡n muá»‘n code gá»i pháº£i xá»­ lÃ½ má»™t cÃ¡ch
rÃµ rÃ ng. Thá»±c ra, khÃ´ng cÃ³ cÃ¡ch nÃ o cho code gá»i phá»¥c há»“i; ngÆ°á»i láº­p trÃ¬nh viÃªn
gá»i cáº§n pháº£i sá»­a code. Há»£p Ä‘á»“ng cho má»™t hÃ m, Ä‘áº·c biá»‡t lÃ  khi má»™t vi pháº¡m sáº½ gÃ¢y
ra <code>panic!</code>, nÃªn Ä‘Æ°á»£c giáº£i thÃ­ch trong tÃ i liá»‡u API cho hÃ m Ä‘Ã³.</p>
<p>Tuy nhiÃªn, cÃ³ nhiá»u kiá»ƒm tra lá»—i trong táº¥t cáº£ cÃ¡c hÃ m cá»§a báº¡n sáº½ ráº¥t dÃ i dÃ²ng
vÃ  phiá»n phá»©c. May máº¯n thay, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng há»‡ thá»‘ng kiá»ƒu cá»§a Rust (vÃ  vÃ¬
váº­y lÃ  kiá»ƒm tra kiá»ƒu Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi trÃ¬nh biÃªn dá»‹ch) Ä‘á»ƒ thá»±c hiá»‡n nhiá»u
kiá»ƒm tra cho báº¡n. Náº¿u hÃ m cá»§a báº¡n cÃ³ má»™t kiá»ƒu cá»¥ thá»ƒ lÃ m tham sá»‘, báº¡n cÃ³ thá»ƒ
tiáº¿p tá»¥c vá»›i logic code cá»§a mÃ¬nh biáº¿t ráº±ng trÃ¬nh biÃªn dá»‹ch Ä‘Ã£ Ä‘áº£m báº£o báº¡n cÃ³ má»™t
giÃ¡ trá»‹ há»£p lá»‡. VÃ­ dá»¥, náº¿u báº¡n cÃ³ má»™t kiá»ƒu thay vÃ¬ má»™t <code>Option</code>, chÆ°Æ¡ng trÃ¬nh
cá»§a báº¡n mong Ä‘á»£i sáº½ <em>cÃ³ gÃ¬ Ä‘Ã³</em> thay vÃ¬ <em>khÃ´ng cÃ³ gÃ¬</em>. Code cá»§a báº¡n sau Ä‘Ã³ khÃ´ng
cáº§n pháº£i xá»­ lÃ½ hai trÆ°á»ng há»£p cho cÃ¡c biáº¿n thá»ƒ <code>Some</code> vÃ  <code>None</code>: nÃ³ sáº½ chá»‰ cÃ³
má»™t trÆ°á»ng há»£p cho viá»‡c cháº¯c cháº¯n cÃ³ má»™t giÃ¡ trá»‹. Code cá»‘ gáº¯ng truyá»n khÃ´ng cÃ³
gÃ¬ cho hÃ m cá»§a báº¡n sáº½ khÃ´ng thá»ƒ biÃªn dá»‹ch, vÃ¬ váº­y hÃ m cá»§a báº¡n khÃ´ng cáº§n pháº£i
kiá»ƒm tra trÆ°á»ng há»£p Ä‘Ã³ khi cháº¡y. Má»™t vÃ­ dá»¥ khÃ¡c lÃ  sá»­ dá»¥ng má»™t kiá»ƒu sá»‘ nguyÃªn
khÃ´ng dáº¥u nhÆ° <code>u32</code>, Ä‘áº£m báº£o tham sá»‘ khÃ´ng bao giá» Ã¢m.</p>
<h3 id="creating-custom-types-for-validation"><a class="header" href="#creating-custom-types-for-validation">Creating Custom Types for Validation</a></h3>
<p>Láº¥y Ã½ tÆ°á»Ÿng sá»­ dá»¥ng há»‡ thá»‘ng kiá»ƒu Rust Ä‘á»ƒ Ä‘áº£m báº£o chÃºng ta cÃ³ má»™t giÃ¡ trá»‹ há»£p
lá»‡, hÆ¡n ná»¯a lÃ  táº¡o má»™t kiá»ƒu tÃ¹y chá»‰nh cho viá»‡c xÃ¡c thá»±c. Nhá»› láº¡i trÃ² chÆ¡i Ä‘oÃ¡n
sá»‘ trong ChÆ°Æ¡ng 2 trong Ä‘Ã³ code cá»§a chÃºng ta yÃªu cáº§u ngÆ°á»i dÃ¹ng Ä‘oÃ¡n má»™t sá»‘
giá»¯a 1 vÃ  100. ChÃºng ta khÃ´ng bao giá» xÃ¡c thá»±c ráº±ng Ä‘oÃ¡n cá»§a ngÆ°á»i dÃ¹ng náº±m
giá»¯a hai sá»‘ nÃ y trÆ°á»›c khi kiá»ƒm tra nÃ³ vá»›i sá»‘ bÃ­ máº­t cá»§a chÃºng ta; chÃºng ta chá»‰
xÃ¡c thá»±c ráº±ng Ä‘oÃ¡n lÃ  dÆ°Æ¡ng. Trong trÆ°á»ng há»£p nÃ y, háº­u quáº£ khÃ´ng quÃ¡ nghiÃªm
trá»ng: output cá»§a chÃºng ta cÃ³ thá»ƒ â€œQuÃ¡ caoâ€ hoáº·c â€œQuÃ¡ tháº¥pâ€ váº«n sáº½ chÃ­nh xÃ¡c. NhÆ°ng nÃ³ sáº½ lÃ  má»™t sá»± cáº£i thiá»‡n cÃ³ Ã­ch Ä‘á»ƒ hÆ°á»›ng dáº«n ngÆ°á»i dÃ¹ng Ä‘áº¿n cÃ¡c Ä‘oÃ¡n há»£p
lá»‡ vÃ  cÃ³ hÃ nh vi khÃ¡c nhau khi ngÆ°á»i dÃ¹ng Ä‘oÃ¡n má»™t sá»‘ náº±m ngoÃ i pháº¡m vi so vá»›i
khi ngÆ°á»i dÃ¹ng nháº­p, vÃ­ dá»¥, cÃ¡c chá»¯ cÃ¡i thay vÃ¬ sá»‘.</p>
<p>Má»™t cÃ¡ch Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y lÃ  phÃ¢n tÃ­ch Ä‘oÃ¡n dÆ°á»›i dáº¡ng <code>i32</code> thay vÃ¬ chá»‰ <code>u32</code> Ä‘á»ƒ
cho phÃ©p cÃ¡c sá»‘ Ã¢m, vÃ  sau Ä‘Ã³ thÃªm má»™t kiá»ƒm tra cho sá»‘ náº±m trong pháº¡m vi, nhÆ°
sau:</p>
<pre><code class="language-rust ignore"><span class="boring">use rand::Rng;
</span><span class="boring">use std::cmp::Ordering;
</span><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    let secret_number = rand::thread_rng().gen_range(1..=100);
</span><span class="boring">
</span>    loop {
        // --snip--

<span class="boring">        println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">        let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">        io::stdin()
</span><span class="boring">            .read_line(&amp;mut guess)
</span><span class="boring">            .expect("Failed to read line");
</span><span class="boring">
</span>        let guess: i32 = match guess.trim().parse() {
            Ok(num) =&gt; num,
            Err(_) =&gt; continue,
        };

        if guess &lt; 1 || guess &gt; 100 {
            println!("The secret number will be between 1 and 100.");
            continue;
        }

        match guess.cmp(&amp;secret_number) {
            // --snip--
<span class="boring">            Ordering::Less =&gt; println!("Too small!"),
</span><span class="boring">            Ordering::Greater =&gt; println!("Too big!"),
</span><span class="boring">            Ordering::Equal =&gt; {
</span><span class="boring">                println!("You win!");
</span><span class="boring">                break;
</span><span class="boring">            }
</span><span class="boring">        }
</span>    }
<span class="boring">}</span></code></pre>
<p>DÃ²ng <code>if</code> kiá»ƒm tra xem giÃ¡ trá»‹ cá»§a chÃºng ta cÃ³ náº±m ngoÃ i pháº¡m vi hay khÃ´ng, nÃ³i
vá»›i ngÆ°á»i dÃ¹ng vá» váº¥n Ä‘á» nÃ y, vÃ  gá»i <code>continue</code> Ä‘á»ƒ báº¯t Ä‘áº§u vÃ²ng láº·p tiáº¿p theo
vÃ  yÃªu cáº§u má»™t Ä‘oÃ¡n khÃ¡c. Sau dÃ²ng <code>if</code>, chÃºng ta cÃ³ thá»ƒ tiáº¿p tá»¥c vá»›i cÃ¡c
sá»± so sÃ¡nh giá»¯a <code>guess</code> vÃ  sá»‘ bÃ­ máº­t biáº¿t ráº±ng <code>guess</code> náº±m giá»¯a 1 vÃ  100.</p>
<p>Tuy nhiÃªn, Ä‘Ã¢y khÃ´ng pháº£i lÃ  má»™t giáº£i phÃ¡p tá»‘i Æ°u: náº¿u nÃ³ lÃ  ráº¥t quan trá»ng
cho chÆ°Æ¡ng trÃ¬nh chá»‰ hoáº¡t Ä‘á»™ng trÃªn cÃ¡c giÃ¡ trá»‹ giá»¯a 1 vÃ  100, vÃ  nÃ³ cÃ³ nhiá»u
hÃ m vá»›i yÃªu cáº§u nÃ y, cÃ³ má»™t kiá»ƒm tra nhÆ° tháº¿ nÃ y trong má»—i hÃ m sáº½ lÃ  má»™t viá»‡c
nhÃ m chÃ¡n (vÃ  cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u suáº¥t (performance)).</p>
<p>Thay vÃ o Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ táº¡o má»™t kiá»ƒu má»›i vÃ  Ä‘áº·t cÃ¡c xÃ¡c thá»±c trong má»™t
hÃ m Ä‘á»ƒ táº¡o má»™t thá»ƒ hiá»‡n cá»§a kiá»ƒu thay vÃ¬ láº·p láº¡i cÃ¡c xÃ¡c thá»±c á»Ÿ má»i nÆ¡i. ÄÃ³
lÃ m cho an toÃ n cho cÃ¡c hÃ m sá»­ dá»¥ng kiá»ƒu má»›i trong chá»¯ kÃ½ cá»§a chÃºng vÃ  tin tÆ°á»Ÿng
vÃ o cÃ¡c giÃ¡ trá»‹ mÃ  chÃºng nháº­n Ä‘Æ°á»£c. Listing 9-13 cho tháº¥y má»™t cÃ¡ch Ä‘á»ƒ Ä‘á»‹nh nghÄ©a
má»™t kiá»ƒu <code>Guess</code> sáº½ chá»‰ táº¡o má»™t thá»ƒ hiá»‡n cá»§a <code>Guess</code> náº¿u hÃ m <code>new</code> nháº­n Ä‘Æ°á»£c má»™t
giÃ¡ trá»‹ giá»¯a 1 vÃ  100.</p>
<!-- Deliberately not using rustdoc_include here; the `main` function in the
file requires the `rand` crate. We do want to include it for reader
experimentation purposes, but don't want to include it for rustdoc testing
purposes. -->
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 9-13: Má»™t kiá»ƒu <code>Guess</code> sáº½ chá»‰ tiáº¿p tá»¥c vá»›i cÃ¡c
giÃ¡ trá»‹ giá»¯a 1 vÃ  100</span></p>
<p>Äáº§u tiÃªn, chÃºng ta Ä‘á»‹nh nghÄ©a má»™t struct cÃ³ tÃªn <code>Guess</code> cÃ³ má»™t trÆ°á»ng cÃ³ tÃªn
<code>value</code> chá»©a má»™t <code>i32</code>. ÄÃ¢y lÃ  nÆ¡i sá»‘ sáº½ Ä‘Æ°á»£c lÆ°u trá»¯.</p>
<p>Sau Ä‘Ã³ chÃºng ta hiá»‡n thÆ°c má»™t hÃ m <code>new</code> trÃªn <code>Guess</code> Ä‘á»ƒ táº¡o cÃ¡c instance
cá»§a <code>Guess</code>. HÃ m <code>new</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a Ä‘á»ƒ cÃ³ má»™t tham sá»‘ cÃ³ tÃªn <code>value</code> cá»§a kiá»ƒu
<code>i32</code> vÃ  tráº£ vá» má»™t <code>Guess</code>. Code trong thÃ¢n hÃ m <code>new</code> kiá»ƒm tra <code>value</code> Ä‘á»ƒ cháº¯c
cháº¯n nÃ³ náº±m trong khoáº£ng tá»« 1 Ä‘áº¿n 100. Náº¿u <code>value</code> khÃ´ng Ä‘áº¡t Ä‘Æ°á»£c Ä‘iá»u kiá»‡n nÃ y,
chÃºng ta sáº½ gá»i má»™t <code>panic!</code>, Ä‘Ã³ sáº½ thÃ´ng bÃ¡o cho ngÆ°á»i láº­p trÃ¬nh viÃªn Ä‘ang viáº¿t
code gá»i hÃ m nÃ y ráº±ng há» cÃ³ má»™t lá»—i mÃ  há» cáº§n pháº£i sá»­a, vÃ¬ táº¡o má»™t <code>Guess</code> vá»›i
<code>value</code> náº±m ngoÃ i pháº¡m vi nÃ y sáº½ vi pháº¡m há»£p Ä‘á»“ng mÃ  <code>Guess::new</code> Ä‘ang phá»¥ thuá»™c
vÃ o. CÃ¡c Ä‘iá»u kiá»‡n mÃ  <code>Guess::new</code> cÃ³ thá»ƒ gÃ¢y ra <code>panic!</code> nÃªn Ä‘Æ°á»£c tháº£o luáº­n
trong tÃ i liá»‡u API cá»§a nÃ³; chÃºng ta sáº½ tháº£o luáº­n vá» cÃ¡c quy Æ°á»›c vá» tÃ i liá»‡u
trong chÆ°Æ¡ng 14. Náº¿u <code>value</code> Ä‘áº¡t Ä‘Æ°á»£c Ä‘iá»u kiá»‡n nÃ y, chÃºng ta sáº½ táº¡o má»™t
<code>Guess</code> má»›i vá»›i trÆ°á»ng <code>value</code> Ä‘Æ°á»£c thiáº¿t láº­p thÃ nh tham sá»‘ <code>value</code> vÃ  tráº£ vá»
<code>Guess</code>.</p>
<p>Tiáº¿p theo, chÃºng ta hiá»‡n thá»±c má»™t phÆ°Æ¡ng thá»©c cÃ³ tÃªn <code>value</code> mÃ  mÆ°á»£n <code>self</code>,
khÃ´ng cÃ³ báº¥t ká»³ tham sá»‘ nÃ o khÃ¡c, vÃ  tráº£ vá» má»™t <code>i32</code>. Loáº¡i phÆ°Æ¡ng thá»©c nÃ y
Ä‘Ã´i khi Ä‘Æ°á»£c gá»i lÃ  <em>getter</em>, vÃ¬ má»¥c Ä‘Ã­ch cá»§a nÃ³ lÃ  Ä‘á»ƒ láº¥y má»™t sá»‘ dá»¯ liá»‡u tá»«
cÃ¡c trÆ°á»ng cá»§a nÃ³. PhÆ°Æ¡ng thá»©c cÃ´ng khai nÃ y lÃ  cáº§n thiáº¿t vÃ¬ trÆ°á»ng <code>value</code> cá»§a
<code>Guess</code> struct lÃ  riÃªng tÆ°. Quan trá»ng lÃ  trÆ°á»ng <code>value</code> pháº£i lÃ  riÃªng tÆ° Ä‘á»ƒ
code sá»­ dá»¥ng <code>Guess</code> struct khÃ´ng Ä‘Æ°á»£c phÃ©p thiáº¿t láº­p <code>value</code> trá»±c tiáº¿p: code
bÃªn ngoÃ i module <em>pháº£i</em> sá»­ dá»¥ng hÃ m <code>Guess::new</code> Ä‘á»ƒ táº¡o má»™t thá»ƒ hiá»‡n cá»§a
<code>Guess</code>, vÃ¬ váº­y Ä‘áº£m báº£o ráº±ng khÃ´ng cÃ³ cÃ¡ch nÃ o cho má»™t <code>Guess</code> cÃ³ má»™t <code>value</code>
mÃ  chÆ°a Ä‘Æ°á»£c kiá»ƒm tra bá»Ÿi cÃ¡c Ä‘iá»u kiá»‡n trong hÃ m <code>Guess::new</code>.</p>
<p>Má»™t hÃ m cÃ³ má»™t tham sá»‘ hoáº·c tráº£ vá» chá»‰ cÃ¡c sá»‘ tá»« 1 Ä‘áº¿n 100 cÃ³ thá»ƒ sau Ä‘Ã³ khai
bÃ¡o trong chá»¯ kÃ½ (signature) cá»§a nÃ³ ráº±ng nÃ³ nháº­n hoáº·c tráº£ vá» má»™t <code>Guess</code> thay
vÃ¬ má»™t <code>i32</code> vÃ  khÃ´ng cáº§n pháº£i lÃ m báº¥t ká»³ kiá»ƒm tra bá»• sung nÃ o trong thÃ¢n hÃ m
cá»§a nÃ³.</p>
<h2 id="summary-4"><a class="header" href="#summary-4">Summary</a></h2>
<p>Xá»­ lÃ½ lá»—i trong Rust Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ giÃºp báº¡n viáº¿t mÃ£ cÃ³ tÃ­nh á»•n Ä‘á»‹nh cao hÆ¡n.
<code>panic!</code> macro cho biáº¿t ráº±ng chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n Ä‘ang á»Ÿ má»™t tráº¡ng thÃ¡i nÃ³ khÃ´ng
thá»ƒ xá»­ lÃ½ vÃ  cho phÃ©p báº¡n nÃ³i vá»›i quÃ¡ trÃ¬nh dá»«ng thay vÃ¬ cá»‘ gáº¯ng tiáº¿p tá»¥c vá»›i
giÃ¡ trá»‹ khÃ´ng há»£p lá»‡ hoáº·c khÃ´ng chÃ­nh xÃ¡c. <code>Result</code> enum sá»­ dá»¥ng há»‡ thá»‘ng kiá»ƒu
cá»§a Rust Ä‘á»ƒ chá»‰ ra ráº±ng cÃ¡c hoáº¡t Ä‘á»™ng cÃ³ thá»ƒ tháº¥t báº¡i má»™t cÃ¡ch mÃ  mÃ£ cá»§a báº¡n cÃ³
thá»ƒ khÃ´i phá»¥c Ä‘Æ°á»£c. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng <code>Result</code> Ä‘á»ƒ nÃ³i vá»›i mÃ£ gá»i mÃ£ cá»§a báº¡n
ráº±ng nÃ³ cáº§n pháº£i xá»­ lÃ½ thÃ nh cÃ´ng hoáº·c tháº¥t báº¡i cÃ³ thá»ƒ xáº£y ra. Sá»­ dá»¥ng <code>panic!</code>
vÃ  <code>Result</code> trong cÃ¡c tÃ¬nh huá»‘ng phÃ¹ há»£p sáº½ lÃ m mÃ£ cá»§a báº¡n á»•n Ä‘á»‹nh hÆ¡n Ä‘á»‘i vá»›i
cÃ¡c váº¥n Ä‘á» khÃ´ng thá»ƒ trÃ¡nh Ä‘Æ°á»£c.</p>
<p>BÃ¢y giá» báº¡n Ä‘Ã£ tháº¥y cÃ¡c cÃ¡ch sá»­ dá»¥ng há»¯u Ã­ch mÃ  thÆ° viá»‡n chuáº©n sá»­ dá»¥ng vá»›i
<code>Option</code> vÃ  <code>Result</code> enum, chÃºng ta sáº½ nÃ³i vá» cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a generics vÃ 
cÃ¡ch báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng chÃºng trong mÃ£ cá»§a báº¡n.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cÃ¡c-kiá»ƒu-generic-traits-vÃ -lifetimes"><a class="header" href="#cÃ¡c-kiá»ƒu-generic-traits-vÃ -lifetimes">CÃ¡c Kiá»ƒu Generic, Traits, vÃ  Lifetimes</a></h1>
<p>Má»i ngÃ´n ngá»¯ láº­p trÃ¬nh Ä‘á»u cÃ³ cÃ¡c cÃ´ng cá»¥ Ä‘á»ƒ xá»­ lÃ½ má»™t cÃ¡ch hiá»‡u quáº£ viá»‡c
trÃ¹ng láº·p cÃ¡c khÃ¡i niá»‡m. Trong Rust, má»™t trong nhá»¯ng cÃ´ng cá»¥ nhÆ° váº­y lÃ  <em>generics</em>:
cÃ¡c Ä‘áº¡i diá»‡n trá»«u tÆ°á»£ng cho cÃ¡c kiá»ƒu cá»¥ thá»ƒ hoáº·c cÃ¡c thuá»™c tÃ­nh khÃ¡c. ChÃºng ta
cÃ³ thá»ƒ biá»ƒu diá»…n hÃ nh vi cá»§a generics hoáº·c cÃ¡ch chÃºng liÃªn quan Ä‘áº¿n cÃ¡c generics
khÃ¡c mÃ  khÃ´ng cáº§n biáº¿t Ä‘iá»u gÃ¬ sáº½ thay tháº¿ chÃºng khi biÃªn dá»‹ch vÃ  cháº¡y code.</p>
<p>CÃ¡c hÃ m cÃ³ thá»ƒ cháº¥p nháº­n tham sá»‘ cá»§a má»™t loáº¡i generic nÃ o Ä‘Ã³, thay vÃ¬ má»™t
loáº¡i cá»¥ thá»ƒ nhÆ° i32 hoáº·c String, giá»‘ng nhÆ° cÃ¡ch má»™t hÃ m cháº¥p nháº­n tham sá»‘
vá»›i giÃ¡ trá»‹ khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘á»ƒ cháº¡y cÃ¹ng code trÃªn nhiá»u giÃ¡ trá»‹ cá»¥ thá»ƒ khÃ¡c nhau.
TrÃªn thá»±c táº¿, chÃºng ta Ä‘Ã£ sá»­ dá»¥ng generics trong ChÆ°Æ¡ng 6 vá»›i <code>Option&lt;T&gt;</code>,
ChÆ°Æ¡ng 8 vá»›i <code>Vec&lt;T&gt;</code> vÃ  <code>HashMap&lt;K, V&gt;</code>, vÃ  ChÆ°Æ¡ng 9 vá»›i <code>Result&lt;T, E&gt;</code>. Trong
chÆ°Æ¡ng nÃ y, báº¡n sáº½ khÃ¡m phÃ¡ cÃ¡ch Ä‘á»‹nh nghÄ©a cÃ¡c kiá»ƒu, hÃ m, vÃ  phÆ°Æ¡ng thá»©c cá»§a
riÃªng báº¡n vá»›i generics!</p>
<p>Äáº§u tiÃªn, chÃºng ta sáº½ xem xÃ©t cÃ¡ch trÃ­ch xuáº¥t má»™t hÃ m Ä‘á»ƒ giáº£m sá»± trÃ¹ng láº·p code.
Sau Ä‘Ã³, chÃºng ta sáº½ sá»­ dá»¥ng cÃ¹ng má»™t ká»¹ thuáº­t Ä‘á»ƒ táº¡o ra má»™t hÃ m generic tá»« hai
hÃ m khÃ¡c nhau chá»‰ á»Ÿ cÃ¡c kiá»ƒu tham sá»‘ cá»§a chÃºng. ChÃºng ta cÅ©ng sáº½ giáº£i thÃ­ch
cÃ¡ch sá»­ dá»¥ng generic types trong Ä‘á»‹nh nghÄ©a struct vÃ  enum.</p>
<p>Sau Ä‘Ã³, báº¡n sáº½ tÃ¬m hiá»ƒu cÃ¡ch sá»­ dá»¥ng <em>traits</em> Ä‘á»ƒ Ä‘á»‹nh nghÄ©a hÃ nh vi má»™t
cÃ¡ch generic. Báº¡n cÃ³ thá»ƒ káº¿t há»£p <em>traits</em> vá»›i generic types Ä‘á»ƒ rÃ ng buá»™c má»™t kiá»ƒu
generic chá»‰ cháº¥p nháº­n nhá»¯ng kiá»ƒu cÃ³ má»™t hÃ nh vi cá»¥ thá»ƒ, chá»© khÃ´ng pháº£i chá»‰ lÃ  báº¥t ká»³ kiá»ƒu nÃ o.</p>
<p>Cuá»‘i cÃ¹ng, chÃºng ta sáº½ tháº£o luáº­n vá» lifetimes: má»™t dáº¡ng cá»§a generics cung
cáº¥p thÃ´ng tin cho trÃ¬nh biÃªn dá»‹ch vá» cÃ¡ch cÃ¡c tham chiáº¿u liÃªn quan Ä‘áº¿n nhau.
Lifetimes cho phÃ©p chÃºng ta cung cáº¥p Ä‘á»§ thÃ´ng tin cho trÃ¬nh biÃªn dá»‹ch vá» giÃ¡
trá»‹ Ä‘Æ°á»£c mÆ°á»£n Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng tham chiáº¿u sáº½ há»£p lá»‡ trong nhiá»u tÃ¬nh huá»‘ng hÆ¡n
so vá»›i viá»‡c khÃ´ng cÃ³ sá»± giÃºp Ä‘á»¡ cá»§a chÃºng ta.</p>
<h2 id="loáº¡i-bá»-sá»±-trÃ¹ng-láº·p-báº±ng-cÃ¡ch-trÃ­ch-xuáº¥t-má»™t-hÃ m"><a class="header" href="#loáº¡i-bá»-sá»±-trÃ¹ng-láº·p-báº±ng-cÃ¡ch-trÃ­ch-xuáº¥t-má»™t-hÃ m">Loáº¡i bá» Sá»± TrÃ¹ng Láº·p báº±ng CÃ¡ch TrÃ­ch Xuáº¥t Má»™t HÃ m</a></h2>
<p>Generics cho phÃ©p chÃºng ta thay tháº¿ cÃ¡c kiá»ƒu cá»¥ thá»ƒ báº±ng má»™t Ä‘á»‹a chá»‰ giá»¯ chá»—
Ä‘áº¡i diá»‡n cho nhiá»u kiá»ƒu Ä‘á»ƒ loáº¡i bá» sá»± trÃ¹ng láº·p code. TrÆ°á»›c khi nháº£y vÃ o cÃº phÃ¡p
generics, chÃºng ta hÃ£y xem cÃ¡ch loáº¡i bá» sá»± trÃ¹ng láº·p má»™t cÃ¡ch khÃ´ng liÃªn quan Ä‘áº¿n
generic types báº±ng cÃ¡ch trÃ­ch xuáº¥t má»™t hÃ m thay tháº¿ cÃ¡c giÃ¡ trá»‹ cá»¥ thá»ƒ báº±ng má»™t
Ä‘á»‹a chá»‰ giá»¯ chá»— Ä‘áº¡i diá»‡n cho nhiá»u giÃ¡ trá»‹. Sau Ä‘Ã³, chÃºng ta sáº½ Ã¡p dá»¥ng cÃ¹ng má»™t
ká»¹ thuáº­t Ä‘á»ƒ trÃ­ch xuáº¥t má»™t hÃ m generic! Báº±ng cÃ¡ch xem xÃ©t cÃ¡ch nháº­n diá»‡n code trÃ¹ng
láº·p cÃ³ thá»ƒ trÃ­ch xuáº¥t thÃ nh má»™t hÃ m, báº¡n sáº½ báº¯t Ä‘áº§u nháº­n ra code trÃ¹ng láº·p cÃ³ thá»ƒ
sá»­ dá»¥ng generics.</p>
<p>ChÃºng ta báº¯t Ä‘áº§u vá»›i má»™t chÆ°Æ¡ng trÃ¬nh ngáº¯n trong Listing 10-1 Ä‘á»ƒ tÃ¬m sá»‘ lá»›n
nháº¥t trong má»™t danh sÃ¡ch.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let mut largest = &amp;number_list[0];

    for number in &amp;number_list {
        if number &gt; largest {
            largest = number;
        }
    }

    println!("The largest number is {largest}");
<span class="boring">    assert_eq!(*largest, 100);
</span>}</code></pre></pre>
<p><span class="caption">Listing 10-1: TÃ¬m sá»‘ lá»›n nháº¥t trong má»™t danh sÃ¡ch cÃ¡c sá»‘</span></p>
<p>ChÃºng ta lÆ°u trá»¯ má»™t danh sÃ¡ch cÃ¡c sá»‘ nguyÃªn trong biáº¿n <code>number_list</code> vÃ  Ä‘áº·t má»™t tham
chiáº¿u Ä‘áº¿n sá»‘ Ä‘áº§u tiÃªn trong danh sÃ¡ch vÃ o má»™t biáº¿n cÃ³ tÃªn lÃ  <code>largest</code>. Sau Ä‘Ã³, chÃºng
ta láº·p qua táº¥t cáº£ cÃ¡c sá»‘ trong danh sÃ¡ch, vÃ  náº¿u sá»‘ hiá»‡n táº¡i lá»›n hÆ¡n sá»‘ Ä‘Æ°á»£c lÆ°u
trá»¯ trong <code>largest</code>, thay tháº¿ tham chiáº¿u trong biáº¿n Ä‘Ã³. Tuy nhiÃªn, náº¿u sá»‘ hiá»‡n táº¡i
nhá» hÆ¡n hoáº·c báº±ng sá»‘ lá»›n nháº¥t Ä‘Ã£ tháº¥y cho Ä‘áº¿n nay, biáº¿n khÃ´ng thay Ä‘á»•i vÃ  code di
chuyá»ƒn Ä‘áº¿n sá»‘ tiáº¿p theo trong danh sÃ¡ch. Sau khi xem xÃ©t táº¥t cáº£ cÃ¡c sá»‘ trong danh sÃ¡ch,
<code>largest</code> nÃªn tham chiáº¿u Ä‘áº¿n sá»‘ lá»›n nháº¥t, trong trÆ°á»ng há»£p nÃ y lÃ  100.</p>
<p>BÃ¢y giá», chÃºng ta Ä‘Ã£ Ä‘Æ°á»£c giao nhiá»‡m vá»¥ tÃ¬m sá»‘ lá»›n nháº¥t trong hai danh sÃ¡ch khÃ¡c nhau
cá»§a cÃ¡c sá»‘. Äá»ƒ lÃ m Ä‘iá»u nÃ y, chÃºng ta cÃ³ thá»ƒ chá»n sao chÃ©p code trong Listing 10-1
vÃ  sá»­ dá»¥ng cÃ¹ng má»™t logic á»Ÿ hai nÆ¡i khÃ¡c nhau trong chÆ°Æ¡ng trÃ¬nh, nhÆ° Ä‘Æ°á»£c thá»ƒ
hiá»‡n trong Listing 10-2.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let mut largest = &amp;number_list[0];

    for number in &amp;number_list {
        if number &gt; largest {
            largest = number;
        }
    }

    println!("The largest number is {largest}");

    let number_list = vec![102, 34, 6000, 89, 54, 2, 43, 8];

    let mut largest = &amp;number_list[0];

    for number in &amp;number_list {
        if number &gt; largest {
            largest = number;
        }
    }

    println!("The largest number is {largest}");
}</code></pre></pre>
<p><span class="caption">Listing 10-2: Code tÃ¬m sá»‘ lá»›n nháº¥t trong hai
danh sÃ¡ch sá»‘</span></p>
<p>Máº·c dÃ¹ code nÃ y hoáº¡t Ä‘á»™ng, nhÆ°ng sao chÃ©p code lÃ  cÃ´ng viá»‡c nhÃ m chÃ¡n vÃ  dá»… gÃ¢y lá»—i.
ChÃºng ta cÅ©ng pháº£i nhá»› cáº­p nháº­t code á»Ÿ nhiá»u nÆ¡i khi chÃºng ta muá»‘n thay Ä‘á»•i nÃ³.</p>
<p>Äá»ƒ loáº¡i bá» sá»± trÃ¹ng láº·p nÃ y, chÃºng ta sáº½ táº¡o ra má»™t sá»± trá»«u tÆ°á»£ng báº±ng
cÃ¡ch Ä‘á»‹nh nghÄ©a má»™t hÃ m hoáº¡t Ä‘á»™ng trÃªn báº¥t ká»³ danh sÃ¡ch sá»‘ nguyÃªn nÃ o
Ä‘Æ°á»£c truyá»n vÃ o má»™t tham sá»‘. Giáº£i phÃ¡p nÃ y lÃ m cho code cá»§a chÃºng ta rÃµ rÃ ng
hÆ¡n vÃ  cho phÃ©p chÃºng ta diá»…n Ä‘áº¡t khÃ¡i niá»‡m tÃ¬m sá»‘ lá»›n nháº¥t trong má»™t danh
sÃ¡ch má»™t cÃ¡ch trá»«u tÆ°á»£ng.</p>
<p>Trong Listing 10-3, chÃºng ta trÃ­ch xuáº¥t code tÃ¬m sá»‘ lá»›n nháº¥t vÃ o má»™t hÃ m cÃ³ tÃªn
lÃ  <code>largest</code>. Sau Ä‘Ã³, chÃºng ta gá»i hÃ m Ä‘á»ƒ tÃ¬m sá»‘ lá»›n nháº¥t trong hai danh sÃ¡ch
tá»« Listing 10-2. ChÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng hÃ m trÃªn báº¥t ká»³ danh sÃ¡ch i32
nÃ o khÃ¡c chÃºng ta cÃ³ thá»ƒ cÃ³ trong tÆ°Æ¡ng lai.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn largest(list: &amp;[i32]) -&gt; &amp;i32 {
    let mut largest = &amp;list[0];

    for item in list {
        if item &gt; largest {
            largest = item;
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest(&amp;number_list);
    println!("The largest number is {result}");
<span class="boring">    assert_eq!(*result, 100);
</span>
    let number_list = vec![102, 34, 6000, 89, 54, 2, 43, 8];

    let result = largest(&amp;number_list);
    println!("The largest number is {result}");
<span class="boring">    assert_eq!(*result, 6000);
</span>}</code></pre></pre>
<p><span class="caption">Listing 10-3: Abstracted trá»«u tÆ°á»£ng Ä‘á»ƒ tÃ¬m sá»‘ lá»›n nháº¥t
trong hai danh sÃ¡ch</span></p>
<p>HÃ m <code>largest</code> cÃ³ má»™t tham sá»‘ cÃ³ tÃªn lÃ  list, biá»ƒu thá»‹ cho báº¥t ká»³ slice cá»¥ thá»ƒ nÃ o
cá»§a giÃ¡ trá»‹ <code>i32</code> mÃ  chÃºng ta cÃ³ thá»ƒ truyá»n vÃ o hÃ m. Do Ä‘Ã³, khi chÃºng ta gá»i hÃ m,
code cháº¡y trÃªn cÃ¡c giÃ¡ trá»‹ cá»¥ thá»ƒ mÃ  chÃºng ta truyá»n vÃ o.</p>
<p>TÃ³m láº¡i, dÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c bÆ°á»›c chÃºng ta Ä‘Ã£ thá»±c hiá»‡n Ä‘á»ƒ thay Ä‘á»•i code tá»« Listing 10-2
thÃ nh Listing 10-3:</p>
<ol>
<li>XÃ¡c Ä‘á»‹nh code trÃ¹ng láº·p.</li>
<li>TrÃ­ch xuáº¥t code trÃ¹ng láº·p vÃ o pháº§n thÃ¢n cá»§a hÃ m vÃ  chá»‰ Ä‘á»‹nh cÃ¡c giÃ¡ trá»‹ Ä‘áº§u vÃ o
vÃ  giÃ¡ trá»‹ tráº£ vá» cá»§a code Ä‘Ã³ trong chá»¯ kÃ½ hÃ m.</li>
<li>Cáº­p nháº­t hai trÆ°á»ng há»£p cá»§a code trÃ¹ng láº·p Ä‘á»ƒ gá»i hÃ m thay vÃ¬.
Tiáº¿p theo, chÃºng ta sáº½ sá»­ dá»¥ng nhá»¯ng bÆ°á»›c tÆ°Æ¡ng tá»± vá»›i generics Ä‘á»ƒ giáº£m sá»± trÃ¹ng
láº·p code. Giá»‘ng nhÆ° cÃ¡ch pháº§n thÃ¢n hÃ m cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng trÃªn má»™t list trá»«u tÆ°á»£ng thay vÃ¬ cÃ¡c
giÃ¡ trá»‹ cá»¥ thá»ƒ, generics cho phÃ©p code hoáº¡t Ä‘á»™ng trÃªn cÃ¡c loáº¡i trá»«u tÆ°á»£ng.</li>
</ol>
<p>VÃ­ dá»¥, giáº£ sá»­ chÃºng ta cÃ³ hai hÃ m: má»™t hÃ m tÃ¬m pháº§n tá»­ lá»›n nháº¥t trong má»™t slice
giÃ¡ trá»‹ <code>i32</code> vÃ  má»™t hÃ m tÃ¬m pháº§n tá»­ lá»›n nháº¥t trong má»™t slice giÃ¡ trá»‹ <code>char</code>.
LÃ m tháº¿ nÃ o Ä‘á»ƒ loáº¡i bá» sá»± trÃ¹ng láº·p Ä‘Ã³? HÃ£y cÃ¹ng tÃ¬m hiá»ƒu nhÃ©!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="cÃ¡c-kiá»ƒu-dá»¯-liá»‡u-generic"><a class="header" href="#cÃ¡c-kiá»ƒu-dá»¯-liá»‡u-generic">CÃ¡c kiá»ƒu dá»¯ liá»‡u Generic</a></h2>
<p>ChÃºng ta sá»­ dá»¥ng generics Ä‘á»ƒ táº¡o Ä‘á»‹nh nghÄ©a cho cÃ¡c má»¥c nhÆ° chá»¯ kÃ½ hÃ m hoáº·c
cÃ¡c struct, mÃ  chÃºng ta sau Ä‘Ã³ cÃ³ thá»ƒ sá»­ dá»¥ng vá»›i nhiá»u loáº¡i dá»¯ liá»‡u cá»¥ thá»ƒ
khÃ¡c nhau. HÃ£y trÆ°á»›c háº¿t xem cÃ¡ch Ä‘á»‹nh nghÄ©a hÃ m, struct, enum vÃ  cÃ¡c phÆ°Æ¡ng
thá»©c báº±ng generics. Sau Ä‘Ã³, chÃºng ta sáº½ tháº£o luáº­n vá» cÃ¡ch generics áº£nh hÆ°á»Ÿng
Ä‘áº¿n hiá»‡u suáº¥t cá»§a code.</p>
<h3 id="trong-Äá»‹nh-nghÄ©a-hÃ m"><a class="header" href="#trong-Äá»‹nh-nghÄ©a-hÃ m">Trong Äá»‹nh nghÄ©a HÃ m</a></h3>
<p>Khi Ä‘á»‹nh nghÄ©a má»™t hÃ m sá»­ dá»¥ng generics, chÃºng ta Ä‘áº·t generics trong chá»¯ kÃ½
cá»§a hÃ m nÆ¡i chÃºng ta thÆ°á»ng chá»‰ Ä‘á»‹nh loáº¡i dá»¯ liá»‡u cá»§a cÃ¡c tham sá»‘ vÃ  giÃ¡ trá»‹
tráº£ vá». Viá»‡c nÃ y lÃ m cho code cá»§a chÃºng ta linh hoáº¡t hÆ¡n vÃ  cung cáº¥p thÃªm chá»©c
nÄƒng cho ngÆ°á»i gá»i hÃ m cá»§a chÃºng ta trong khi ngÄƒn cháº·n viá»‡c trÃ¹ng láº·p code.</p>
<p>Tiáº¿p tá»¥c vá»›i hÃ m <code>largest</code> cá»§a chÃºng ta, Listing 10-4 hiá»ƒn thá»‹ hai hÃ m cáº£ hai
Ä‘á»u tÃ¬m giÃ¡ trá»‹ lá»›n nháº¥t trong má»™t slice. Sau Ä‘Ã³, chÃºng ta sáº½ káº¿t há»£p chÃºng
thÃ nh má»™t hÃ m duy nháº¥t sá»­ dá»¥ng generics.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn largest_i32(list: &amp;[i32]) -&gt; &amp;i32 {
    let mut largest = &amp;list[0];

    for item in list {
        if item &gt; largest {
            largest = item;
        }
    }

    largest
}

fn largest_char(list: &amp;[char]) -&gt; &amp;char {
    let mut largest = &amp;list[0];

    for item in list {
        if item &gt; largest {
            largest = item;
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest_i32(&amp;number_list);
    println!("The largest number is {result}");
<span class="boring">    assert_eq!(*result, 100);
</span>
    let char_list = vec!['y', 'm', 'a', 'q'];

    let result = largest_char(&amp;char_list);
    println!("The largest char is {result}");
<span class="boring">    assert_eq!(*result, 'y');
</span>}</code></pre></pre>
<p><span class="caption">Listing 10-4: Two functions that differ only in their
names and the types in their signatures</span></p>
<p>HÃ m <code>largest_i32</code> lÃ  hÃ m chÃºng ta Ä‘Ã£ trÃ­ch xuáº¥t á»Ÿ Listing 10-3 Ä‘á»ƒ tÃ¬m giÃ¡ trá»‹
lá»›n nháº¥t cá»§a <code>i32</code> trong má»™t slice. HÃ m <code>largest_char</code> tÃ¬m giÃ¡ trá»‹ lá»›n nháº¥t cá»§a <code>char</code>
trong má»™t slice. Cáº£ hai hÃ m cÃ³ cÃ¹ng code nguá»“n, vÃ¬ váº­y hÃ£y loáº¡i bá» sá»± trÃ¹ng láº·p
báº±ng cÃ¡ch giá»›i thiá»‡u má»™t tham sá»‘ kiá»ƒu generic trong má»™t hÃ m duy nháº¥t.</p>
<p>Äá»ƒ tham sá»‘ hÃ³a cÃ¡c loáº¡i trong má»™t hÃ m má»›i, chÃºng ta cáº§n Ä‘áº·t tÃªn tham sá»‘ kiá»ƒu,
giá»‘ng nhÆ° chÃºng ta lÃ m vá»›i cÃ¡c tham sá»‘ giÃ¡ trá»‹ cá»§a má»™t hÃ m. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng
báº¥t ká»³ Ä‘á»‹nh danh nÃ o lÃ m tÃªn tham sá»‘ kiá»ƒu. NhÆ°ng chÃºng ta sáº½ sá»­ dá»¥ng <code>T</code> vÃ¬ theo
quy Æ°á»›c, tÃªn tham sá»‘ kiá»ƒu trong Rust ngáº¯n gá»n, thÆ°á»ng chá»‰ lÃ  má»™t chá»¯ cÃ¡i, vÃ 
quy Æ°á»›c Ä‘áº·t tÃªn kiá»ƒu cá»§a Rust lÃ  CamelCase. RÃºt gá»n tá»« â€œtype,â€ <code>T</code> lÃ  lá»±a chá»n
máº·c Ä‘á»‹nh cá»§a háº§u háº¿t cÃ¡c láº­p trÃ¬nh viÃªn Rust.</p>
<p>Khi chÃºng ta sá»­ dá»¥ng má»™t tham sá»‘ trong thÃ¢n cá»§a hÃ m, chÃºng ta pháº£i khai bÃ¡o tÃªn
tham sá»‘ trong chá»¯ kÃ½ Ä‘á»ƒ trÃ¬nh biÃªn dá»‹ch biáº¿t nghÄ©a cá»§a tÃªn Ä‘Ã³ lÃ  gÃ¬. TÆ°Æ¡ng tá»±, khi
chÃºng ta sá»­ dá»¥ng tÃªn tham sá»‘ kiá»ƒu trong chá»¯ kÃ½ hÃ m, chÃºng ta pháº£i khai bÃ¡o tÃªn
tham sá»‘ kiá»ƒu trÆ°á»›c khi sá»­ dá»¥ng nÃ³. Äá»ƒ Ä‘á»‹nh nghÄ©a hÃ m generic <code>largest</code>, Ä‘áº·t khai
bÃ¡o tÃªn kiá»ƒu bÃªn trong dáº¥u ngoáº·c nhá»n, <code>&lt;&gt;</code>, giá»¯a tÃªn hÃ m vÃ  danh sÃ¡ch tham sá»‘, nhÆ° sau:</p>
<pre><code class="language-rust ignore">fn largest&lt;T&gt;(list: &amp;[T]) -&gt; &amp;T {</code></pre>
<p>ChÃºng ta Ä‘á»c Ä‘á»‹nh nghÄ©a nÃ y nhÆ° sau: hÃ m <code>largest</code> lÃ  generic qua má»™t loáº¡i T
nÃ o Ä‘Ã³. HÃ m nÃ y cÃ³ má»™t tham sá»‘ cÃ³ tÃªn lÃ  <code>list</code>, lÃ  má»™t slice cá»§a cÃ¡c giÃ¡ trá»‹
kiá»ƒu <code>T</code>. HÃ m <code>largest</code> sáº½ tráº£ vá» má»™t tham chiáº¿u Ä‘áº¿n má»™t giÃ¡ trá»‹ cÃ¹ng kiá»ƒu <code>T</code>.</p>
<p>Listing 10-5 cho tháº¥y Ä‘á»‹nh nghÄ©a hÃ m <code>largest</code> káº¿t há»£p sá»­ dá»¥ng kiá»ƒu dá»¯ liá»‡u
generic trong chá»¯ kÃ½ cá»§a nÃ³. Listing cÅ©ng cho tháº¥y cÃ¡ch chÃºng ta cÃ³ thá»ƒ gá»i
hÃ m vá»›i má»™t slice cá»§a giÃ¡ trá»‹ <code>i32</code> hoáº·c giÃ¡ trá»‹ <code>char</code>. LÆ°u Ã½ ráº±ng Ä‘oáº¡n code nÃ y
chÆ°a thá»ƒ biÃªn dá»‹ch Ä‘Æ°á»£c, nhÆ°ng chÃºng ta sáº½ sá»­a nÃ³ sau trong chÆ°Æ¡ng nÃ y.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn largest&lt;T&gt;(list: &amp;[T]) -&gt; &amp;T {
    let mut largest = &amp;list[0];

    for item in list {
        if item &gt; largest {
            largest = item;
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest(&amp;number_list);
    println!("The largest number is {result}");

    let char_list = vec!['y', 'm', 'a', 'q'];

    let result = largest(&amp;char_list);
    println!("The largest char is {result}");
}</code></pre>
<p><span class="caption">Listing 10-5: HÃ m <code>largest</code> sá»­ dá»¥ng cÃ¡c tham sá»‘ kiá»ƒu
generic; code nÃ y hiá»‡n chÆ°a thá»ƒ biÃªn dá»‹ch Ä‘Æ°á»£c</span></p>
<p>Náº¿u chÃºng ta biÃªn dá»‹ch Ä‘oáº¡n code nÃ y ngay bÃ¢y giá», chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i nÃ y:</p>
<pre><code class="language-console">$ cargo run
   Compiling chapter10 v0.1.0 (file:///projects/chapter10)
error[E0369]: binary operation `&gt;` cannot be applied to type `&amp;T`
 --&gt; src/main.rs:5:17
  |
5 |         if item &gt; largest {
  |            ---- ^ ------- &amp;T
  |            |
  |            &amp;T
  |
help: consider restricting type parameter `T` with trait `PartialOrd`
  |
1 | fn largest&lt;T: std::cmp::PartialOrd&gt;(list: &amp;[T]) -&gt; &amp;T {
  |             ++++++++++++++++++++++

For more information about this error, try `rustc --explain E0369`.
error: could not compile `chapter10` (bin "chapter10") due to 1 previous error
</code></pre>
<p>Pháº§n trá»£ giÃºp chá»‰ Ä‘áº¿n <code>std::cmp::PartialOrd</code>, Ä‘Ã³ lÃ  má»™t <em>trait</em>, vÃ  chÃºng ta
sáº½ nÃ³i vá» cÃ¡c traits trong pháº§n tiáº¿p theo. Hiá»‡n táº¡i, hÃ£y biáº¿t ráº±ng lá»—i nÃ y
nÃ³i ráº±ng thÃ¢n cá»§a <code>largest</code> khÃ´ng hoáº¡t Ä‘á»™ng vá»›i táº¥t cáº£ cÃ¡c loáº¡i <code>T</code> cÃ³ thá»ƒ cÃ³.
VÃ¬ chÃºng ta muá»‘n so sÃ¡nh giÃ¡ trá»‹ cá»§a kiá»ƒu <code>T</code> trong thÃ¢n hÃ m, chÃºng ta chá»‰ cÃ³
thá»ƒ sá»­ dá»¥ng cÃ¡c loáº¡i mÃ  giÃ¡ trá»‹ cá»§a chÃºng cÃ³ thá»ƒ Ä‘Æ°á»£c so sÃ¡nh. Äá»ƒ kÃ­ch hoáº¡t so
sÃ¡nh, thÆ° viá»‡n chuáº©n cÃ³ trait <code>std::cmp::PartialOrd</code> mÃ  báº¡n cÃ³ thá»ƒ triá»ƒn khai cho
cÃ¡c loáº¡i (xem Phá»¥ lá»¥c C Ä‘á»ƒ biáº¿t thÃªm vá» trait nÃ y). Báº±ng cÃ¡ch tuÃ¢n theo gá»£i Ã½
cá»§a vÄƒn báº£n trá»£ giÃºp, chÃºng ta giá»›i háº¡n cÃ¡c loáº¡i há»£p lá»‡ cho <code>T</code> chá»‰ Ä‘áº¿n nhá»¯ng
loáº¡i triá»ƒn khai PartialOrd, vÃ  vÃ­ dá»¥ nÃ y sáº½ biÃªn dá»‹ch Ä‘Æ°á»£c, vÃ¬ thÆ° viá»‡n chuáº©n
triá»ƒn khai <code>PartialOrd</code> cho cáº£ <code>i32</code> vÃ  <code>char</code>.</p>
<h3 id="trong-cÃ¡c-Äá»‹nh-nghÄ©a-struct"><a class="header" href="#trong-cÃ¡c-Äá»‹nh-nghÄ©a-struct">Trong CÃ¡c Äá»‹nh NghÄ©a Struct</a></h3>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c structs Ä‘á»ƒ sá»­ dá»¥ng má»™t tham sá»‘ kiá»ƒu generic
trong má»™t hoáº·c nhiá»u trÆ°á»ng báº±ng cÃº phÃ¡p <code>&lt;&gt;</code>. Listing 10-6 Ä‘á»‹nh nghÄ©a má»™t
struct <code>Point&lt;T&gt;</code> Ä‘á»ƒ chá»©a cÃ¡c giÃ¡ trá»‹ tá»a Ä‘á»™ <code>x</code> vÃ  <code>y</code> cá»§a báº¥t ká»³ kiá»ƒu nÃ o.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct Point&lt;T&gt; {
    x: T,
    y: T,
}

fn main() {
    let integer = Point { x: 5, y: 10 };
    let float = Point { x: 1.0, y: 4.0 };
}</code></pre></pre>
<p><span class="caption">Listing 10-6: Má»™t struct <code>Point&lt;T&gt;</code> chá»©a cÃ¡c giÃ¡ trá»‹ x
vÃ  y cá»§a kiá»ƒu <code>T</code></span></p>
<p>CÃº phÃ¡p sá»­ dá»¥ng generics trong Ä‘á»‹nh nghÄ©a struct tÆ°Æ¡ng tá»± nhÆ° cÃº phÃ¡p
Ä‘Æ°á»£c sá»­ dá»¥ng trong Ä‘á»‹nh nghÄ©a hÃ m. TrÆ°á»›c tiÃªn, chÃºng ta khai bÃ¡o tÃªn
cá»§a tham sá»‘ kiá»ƒu bÃªn trong dáº¥u ngoáº·c nhá»n ngay sau tÃªn cá»§a struct. Sau
Ä‘Ã³, chÃºng ta sá»­ dá»¥ng kiá»ƒu generic trong Ä‘á»‹nh nghÄ©a struct á»Ÿ nhá»¯ng nÆ¡i
chÃºng ta thÃ´ng thÆ°á»ng sáº½ chá»‰ Ä‘á»‹nh kiá»ƒu dá»¯ liá»‡u cá»¥ thá»ƒ.</p>
<p>LÆ°u Ã½ ráº±ng vÃ¬ chÃºng ta Ä‘Ã£ sá»­ dá»¥ng chá»‰ má»™t kiá»ƒu generic Ä‘á»ƒ Ä‘á»‹nh nghÄ©a <code>Point&lt;T&gt;</code>,
Ä‘á»‹nh nghÄ©a nÃ y nÃ³i ráº±ng struct <code>Point&lt;T&gt;</code> lÃ  generic trÃªn má»™t loáº¡i <code>T</code>, vÃ  cÃ¡c
trÆ°á»ng <code>x</code> vÃ  <code>y</code> Ä‘á»u lÃ  cÃ¹ng má»™t kiá»ƒu Ä‘Ã³, báº¥t ká»ƒ kiá»ƒu Ä‘Ã³ lÃ  gÃ¬. Náº¿u chÃºng ta
táº¡o má»™t thá»ƒ hiá»‡n cá»§a <code>Point&lt;T&gt;</code> cÃ³ giÃ¡ trá»‹ cá»§a cÃ¡c kiá»ƒu khÃ¡c nhau, nhÆ° trong
Listing 10-7, code nguá»“n cá»§a chÃºng ta sáº½ khÃ´ng biÃªn dá»‹ch Ä‘Æ°á»£c.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">struct Point&lt;T&gt; {
    x: T,
    y: T,
}

fn main() {
    let wont_work = Point { x: 5, y: 4.0 };
}</code></pre>
<p><span class="caption">Listing 10-7: CÃ¡c trÆ°á»ng <code>x</code> and <code>y</code> pháº£i cÃ³ cÃ¹ng kiá»ƒu vÃ¬ chÃºng
sá»­ dá»¥ng cÃ¹ng kiá»ƒu generic T</span></p>
<p>Trong vÃ­ dá»¥ nÃ y, khi chÃºng ta gÃ¡n giÃ¡ trá»‹ sá»‘ nguyÃªn 5 cho <code>x</code>, chÃºng ta thÃ´ng
bÃ¡o cho trÃ¬nh biÃªn dá»‹ch biáº¿t ráº±ng kiá»ƒu generic T sáº½ lÃ  má»™t sá»‘ nguyÃªn cho
instance nÃ y cá»§a <code>Point&lt;T&gt;</code>. Sau Ä‘Ã³, khi chÃºng ta chá»‰ Ä‘á»‹nh giÃ¡ trá»‹ 4.0 cho
<code>y</code>, mÃ  chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a cÃ³ cÃ¹ng kiá»ƒu vá»›i x, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c má»™t
lá»—i khÃ´ng khá»›p kiá»ƒu nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling chapter10 v0.1.0 (file:///projects/chapter10)
error[E0308]: mismatched types
 --&gt; src/main.rs:7:38
  |
7 |     let wont_work = Point { x: 5, y: 4.0 };
  |                                      ^^^ expected integer, found floating-point number

For more information about this error, try `rustc --explain E0308`.
error: could not compile `chapter10` (bin "chapter10") due to 1 previous error
</code></pre>
<p>To define a <code>Point</code> struct where <code>x</code> and <code>y</code> are both generics but could have
different types, we can use multiple generic type parameters. For example, in
Listing 10-8, we change the definition of <code>Point</code> to be generic over types <code>T</code>
and <code>U</code> where <code>x</code> is of type <code>T</code> and <code>y</code> is of type <code>U</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct Point&lt;T, U&gt; {
    x: T,
    y: U,
}

fn main() {
    let both_integer = Point { x: 5, y: 10 };
    let both_float = Point { x: 1.0, y: 4.0 };
    let integer_and_float = Point { x: 5, y: 4.0 };
}</code></pre></pre>
<p><span class="caption">Listing 10-8: Má»™t struct <code>Point&lt;T, U&gt;</code> generic trÃªn hai
kiá»ƒu Ä‘á»ƒ <code>x</code> vÃ  <code>y</code> cÃ³ thá»ƒ lÃ  giÃ¡ trá»‹ cá»§a cÃ¡c kiá»ƒu khÃ¡c nhau</span></p>
<p>BÃ¢y giá» táº¥t cáº£ cÃ¡c thá»ƒ hiá»‡n cá»§a <code>Point</code> Ä‘Æ°á»£c hiá»ƒn thá»‹ Ä‘á»u Ä‘Æ°á»£c cháº¥p nháº­n!
Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng nhiá»u tham sá»‘ kiá»ƒu generic trong Ä‘á»‹nh nghÄ©a cÃ ng nhiá»u
cÃ ng tá»‘t, nhÆ°ng sá»­ dá»¥ng quÃ¡ nhiá»u cÃ³ thá»ƒ lÃ m cho code nguá»“n cá»§a báº¡n khÃ³ Ä‘á»c.
Náº¿u báº¡n phÃ¡t hiá»‡n báº¡n cáº§n nhiá»u kiá»ƒu generic trong code nguá»“n cá»§a mÃ¬nh,
Ä‘iá»u nÃ y cÃ³ thá»ƒ lÃ  dáº¥u hiá»‡u cho tháº¥y code nguá»“n cá»§a báº¡n cáº§n Ä‘Æ°á»£c tá»• chá»©c
láº¡i thÃ nh cÃ¡c pháº§n nhá» hÆ¡n.</p>
<h3 id="trong-Äá»‹nh-nghÄ©a-enum"><a class="header" href="#trong-Äá»‹nh-nghÄ©a-enum">Trong Äá»‹nh NghÄ©a Enum</a></h3>
<p>NhÆ° chÃºng ta Ä‘Ã£ lÃ m vá»›i cÃ¡c struct, chÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c enum Ä‘á»ƒ giá»¯
cÃ¡c kiá»ƒu dá»¯ liá»‡u chung trong cÃ¡c biáº¿n khÃ¡c nhau cá»§a chÃºng. HÃ£y xem xÃ©t
láº¡i enum <code>Option&lt;T&gt;</code> mÃ  thÆ° viá»‡n chuáº©n cung cáº¥p, mÃ  chÃºng ta Ä‘Ã£ sá»­ dá»¥ng trong ChÆ°Æ¡ng 6:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Option&lt;T&gt; {
    Some(T),
    None,
}
<span class="boring">}</span></code></pre></pre>
<p>BÃ¢y giá», Ä‘á»‹nh nghÄ©a nÃ y sáº½ rÃµ hÆ¡n Ä‘á»‘i vá»›i báº¡n. NhÆ° báº¡n cÃ³ thá»ƒ tháº¥y, enum <code>Option&lt;T&gt;</code>
lÃ  chung cho kiá»ƒu T vÃ  cÃ³ hai biáº¿n thá»ƒ: Some, giá»¯ má»™t giÃ¡ trá»‹ cá»§a kiá»ƒu T, vÃ 
má»™t biáº¿n thá»ƒ None khÃ´ng giá»¯ báº¥t ká»³ giÃ¡ trá»‹ nÃ o. Báº±ng cÃ¡ch sá»­ dá»¥ng enum <code>Option&lt;T&gt;</code>,
chÃºng ta cÃ³ thá»ƒ diá»…n Ä‘áº¡t khÃ¡i niá»‡m trá»«u tÆ°á»£ng cá»§a giÃ¡ trá»‹ tÃ¹y chá»n, vÃ  do enum
Option<T> lÃ  chung, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng trá»«u tÆ°á»£ng nÃ y khÃ´ng phá»¥ thuá»™c vÃ o
kiá»ƒu giÃ¡ trá»‹ tÃ¹y chá»n lÃ  gÃ¬.</p>
<p>Enum cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng nhiá»u kiá»ƒu chung. Äá»‹nh nghÄ©a enum Result mÃ  chÃºng ta sá»­
dá»¥ng trong ChÆ°Æ¡ng 9 lÃ  má»™t vÃ­ dá»¥:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Result&lt;T, E&gt; {
    Ok(T),
    Err(E),
}
<span class="boring">}</span></code></pre></pre>
<p>Enum Result lÃ  chung cho hai kiá»ƒu T vÃ  E, vÃ  cÃ³ hai biáº¿n thá»ƒ: Ok, giá»¯ má»™t giÃ¡
trá»‹ cá»§a kiá»ƒu T, vÃ  Err, giá»¯ má»™t giÃ¡ trá»‹ cá»§a kiá»ƒu E. Äá»‹nh nghÄ©a nÃ y lÃ m cho
viá»‡c sá»­ dá»¥ng enum Result thuáº­n lá»£i á»Ÿ báº¥t ká»³ nÆ¡i nÃ o chÃºng ta cÃ³ má»™t hoáº¡t Ä‘á»™ng cÃ³
thá»ƒ thÃ nh cÃ´ng (tráº£ vá» má»™t giÃ¡ trá»‹ cá»§a má»™t kiá»ƒu T) hoáº·c tháº¥t báº¡i (tráº£ vá» má»™t lá»—i
cá»§a má»™t kiá»ƒu E). Trong thá»±c táº¿, Ä‘Ã¢y lÃ  Ä‘iá»u chÃºng ta Ä‘Ã£ sá»­ dá»¥ng Ä‘á»ƒ má»Ÿ má»™t táº­p tin
trong Listing 9-3, trong Ä‘Ã³ T Ä‘Æ°á»£c Ä‘iá»n báº±ng kiá»ƒu std::fs::File khi táº­p tin Ä‘Æ°á»£c
má»Ÿ thÃ nh cÃ´ng vÃ  E Ä‘Æ°á»£c Ä‘iá»n báº±ng kiá»ƒu std::io::Error khi cÃ³ váº¥n Ä‘á» khi má»Ÿ táº­p tin.</p>
<p>Khi báº¡n nháº­n diá»‡n cÃ¡c tÃ¬nh huá»‘ng trong code cá»§a báº¡n vá»›i nhiá»u Ä‘á»‹nh nghÄ©a struct hoáº·c
enum khÃ¡c nhau chá»‰ khÃ¡c nhau á»Ÿ cÃ¡c kiá»ƒu giÃ¡ trá»‹ chÃºng giá»¯, báº¡n cÃ³ thá»ƒ trÃ¡nh sá»±
trÃ¹ng láº·p báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c kiá»ƒu chung.</p>
<h3 id="trong-Äá»‹nh-nghÄ©a-phÆ°Æ¡ng-thá»©c"><a class="header" href="#trong-Äá»‹nh-nghÄ©a-phÆ°Æ¡ng-thá»©c">Trong Äá»‹nh NghÄ©a PhÆ°Æ¡ng Thá»©c</a></h3>
<p>ChÃºng ta cÃ³ thá»ƒ triá»ƒn khai cÃ¡c phÆ°Æ¡ng thá»©c trÃªn cÃ¡c struct vÃ  enums (nhÆ° chÃºng
ta Ä‘Ã£ lÃ m trong ChÆ°Æ¡ng 5) vÃ  sá»­ dá»¥ng cÃ¡c kiá»ƒu generic trong Ä‘á»‹nh nghÄ©a cá»§a chÃºng
cÅ©ng. Listing 10-9 hiá»ƒn thá»‹ struct <code>Point&lt;T&gt;</code> mÃ  chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong
Listing 10-6 vá»›i má»™t phÆ°Æ¡ng thá»©c cÃ³ tÃªn lÃ  <code>x</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct Point&lt;T&gt; {
    x: T,
    y: T,
}

impl&lt;T&gt; Point&lt;T&gt; {
    fn x(&amp;self) -&gt; &amp;T {
        &amp;self.x
    }
}

fn main() {
    let p = Point { x: 5, y: 10 };

    println!("p.x = {}", p.x());
}</code></pre></pre>
<p><span clas	s="caption">Listing 10-9: Triá»ƒn khai má»™t phÆ°Æ¡ng thá»©c cÃ³ tÃªn <code>x</code> trÃªn cáº¥u trÃºc
<code>Point&lt;T&gt;</code> sáº½ tráº£ vá» má»™t tham chiáº¿u Ä‘áº¿n trÆ°á»ng <code>x</code> kiá»ƒu <code>T</code>.</span></p>
<p>á» Ä‘Ã¢y, chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a má»™t phÆ°Æ¡ng thá»©c cÃ³ tÃªn x trÃªn <code>Point&lt;T&gt;</code> tráº£ vá» má»™t
tham chiáº¿u Ä‘áº¿n dá»¯ liá»‡u trong trÆ°á»ng <code>x</code>.</p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta pháº£i khai bÃ¡o <code>T</code> ngay sau <code>impl</code> Ä‘á»ƒ chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng <code>T</code>
Ä‘á»ƒ chá»‰ Ä‘á»‹nh ráº±ng chÃºng ta Ä‘ang triá»ƒn khai cÃ¡c phÆ°Æ¡ng thá»©c trÃªn kiá»ƒu <code>Point&lt;T&gt;</code>. Báº±ng
cÃ¡ch khai bÃ¡o <code>T</code> lÃ m má»™t loáº¡i generic sau impl, Rust cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh ráº±ng kiá»ƒu
trong ngoáº·c nhá»n á»Ÿ <code>Point</code> lÃ  má»™t kiá»ƒu generic thay vÃ¬ má»™t kiá»ƒu cá»¥ thá»ƒ. ChÃºng ta
cÃ³ thá»ƒ chá»n má»™t tÃªn khÃ¡c cho tham sá»‘ generic nÃ y so vá»›i tham sá»‘ generic Ä‘Æ°á»£c
khai bÃ¡o trong Ä‘á»‹nh nghÄ©a struct, nhÆ°ng viá»‡c sá»­ dá»¥ng cÃ¹ng má»™t tÃªn lÃ  phá»• biáº¿n.
CÃ¡c phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c viáº¿t trong má»™t <code>impl</code> khai bÃ¡o tham sá»‘ generic sáº½ Ä‘Æ°á»£c Ä‘á»‹nh
nghÄ©a cho báº¥t ká»³ thá»ƒ hiá»‡n nÃ o cá»§a kiá»ƒu Ä‘Ã³, khÃ´ng phá»¥ thuá»™c vÃ o kiá»ƒu cá»¥ thá»ƒ nÃ o
thay tháº¿ cho kiá»ƒu generic.</p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh rÃ ng buá»™c trÃªn cÃ¡c kiá»ƒu generic khi Ä‘á»‹nh nghÄ©a
cÃ¡c phÆ°Æ¡ng thá»©c trÃªn kiá»ƒu. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ triá»ƒn khai cÃ¡c phÆ°Æ¡ng thá»©c
chá»‰ trÃªn cÃ¡c thá»ƒ hiá»‡n <code>Point&lt;f32&gt;</code> thay vÃ¬ trÃªn cÃ¡c thá»ƒ hiá»‡n <code>Point&lt;T&gt;</code> vá»›i báº¥t ká»³
kiá»ƒu generic nÃ o. Trong Listing 10-10, chÃºng ta sá»­ dá»¥ng kiá»ƒu cá»¥ thá»ƒ <code>f32</code>, cÃ³
nghÄ©a lÃ  chÃºng ta khÃ´ng khai bÃ¡o báº¥t ká»³ kiá»ƒu nÃ o sau impl.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct Point&lt;T&gt; {
</span><span class="boring">    x: T,
</span><span class="boring">    y: T,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl&lt;T&gt; Point&lt;T&gt; {
</span><span class="boring">    fn x(&amp;self) -&gt; &amp;T {
</span><span class="boring">        &amp;self.x
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>impl Point&lt;f32&gt; {
    fn distance_from_origin(&amp;self) -&gt; f32 {
        (self.x.powi(2) + self.y.powi(2)).sqrt()
    }
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let p = Point { x: 5, y: 10 };
</span><span class="boring">
</span><span class="boring">    println!("p.x = {}", p.x());
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 10-10: Má»™t khá»‘i <code>impl</code> chá»‰ Ã¡p dá»¥ng cho má»™t struct
vá»›i má»™t kiá»ƒu cá»¥ thá»ƒ cho tham sá»‘ kiá»ƒu generic <code>T</code>.</span></p>
<p>MÃ£ nÃ y cÃ³ nghÄ©a lÃ  kiá»ƒu <code>Point&lt;f32&gt;</code> sáº½ cÃ³ má»™t phÆ°Æ¡ng thá»©c <code>distance_from_origin</code>;
cÃ¡c phiÃªn báº£n khÃ¡c cá»§a <code>Point&lt;T&gt;</code> nÆ¡i <code>T</code> khÃ´ng pháº£i lÃ  kiá»ƒu f32 sáº½ khÃ´ng cÃ³ phÆ°Æ¡ng thá»©c
nÃ y Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. PhÆ°Æ¡ng thá»©c nÃ y Ä‘o lÆ°á»ng khoáº£ng cÃ¡ch tá»« Ä‘iá»ƒm cá»§a chÃºng ta
Ä‘áº¿n Ä‘iá»ƒm táº¡i tá»a Ä‘á»™ (0.0, 0.0) vÃ  sá»­ dá»¥ng cÃ¡c phÃ©p toÃ¡n toÃ¡n há»c chá»‰ cÃ³ sáºµn cho
cÃ¡c kiá»ƒu sá»‘ thá»±c.</p>
<p>CÃ¡c tham sá»‘ kiá»ƒu generic trong Ä‘á»‹nh nghÄ©a struct khÃ´ng luÃ´n giá»‘ng nhau so vá»›i cÃ¡c
tham sá»‘ kiá»ƒu báº¡n sá»­ dá»¥ng trong cÃ¡c chá»¯ kÃ½ phÆ°Æ¡ng thá»©c cá»§a cÃ¹ng struct Ä‘Ã³. MÃ£ á»Ÿ
Listing 10-11 sá»­ dá»¥ng cÃ¡c kiá»ƒu generic <code>X1</code> vÃ  <code>Y1</code> cho struct <code>Point</code> vÃ  <code>X2</code> <code>Y2</code> cho
chá»¯ kÃ½ phÆ°Æ¡ng thá»©c mixup Ä‘á»ƒ lÃ m cho vÃ­ dá»¥ trá»Ÿ nÃªn rÃµ rÃ ng hÆ¡n. PhÆ°Æ¡ng thá»©c nÃ y
táº¡o má»™t thá»ƒ hiá»‡n má»›i cá»§a <code>Point</code> vá»›i giÃ¡ trá»‹ x tá»« <code>self</code> <code>Point</code> (kiá»ƒu <code>X1</code>) vÃ  giÃ¡ trá»‹
<code>y</code> tá»« <code>Point</code> Ä‘Æ°á»£c chuyá»ƒn vÃ o (kiá»ƒu <code>Y2</code>).</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct Point&lt;X1, Y1&gt; {
    x: X1,
    y: Y1,
}

impl&lt;X1, Y1&gt; Point&lt;X1, Y1&gt; {
    fn mixup&lt;X2, Y2&gt;(self, other: Point&lt;X2, Y2&gt;) -&gt; Point&lt;X1, Y2&gt; {
        Point {
            x: self.x,
            y: other.y,
        }
    }
}

fn main() {
    let p1 = Point { x: 5, y: 10.4 };
    let p2 = Point { x: "Hello", y: 'c' };

    let p3 = p1.mixup(p2);

    println!("p3.x = {}, p3.y = {}", p3.x, p3.y);
}</code></pre></pre>
<p><span class="caption">Listing 10-11: Má»™t phÆ°Æ¡ng thá»©c sá»­ dá»¥ng cÃ¡c kiá»ƒu generic
khÃ¡c so vá»›i Ä‘á»‹nh nghÄ©a struct cá»§a nÃ³.</span></p>
<p>Trong <code>main</code>, chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a má»™t <code>Point</code> cÃ³ kiá»ƒu <code>i32</code> cho <code>x</code> (giÃ¡ trá»‹ lÃ  <code>5</code>)
vÃ  kiá»ƒu <code>f64</code> cho <code>y</code> (giÃ¡ trá»‹ lÃ  <code>10.4</code>). Biáº¿n <code>p2</code> lÃ  má»™t struct <code>Point</code> cÃ³ má»™t chuá»—i
(â€œHelloâ€) cho <code>x</code> vÃ  má»™t kÃ½ tá»± (c) cho <code>y</code>. Gá»i mixup trÃªn p1 vá»›i Ä‘á»‘i sá»‘ lÃ  <code>p2</code>
cho chÃºng ta <code>p3</code>, nÆ¡i cÃ³ kiá»ƒu <code>i32</code> cho <code>x</code>, vÃ¬ <code>x</code> Ä‘áº¿n tá»« <code>p1</code>. Biáº¿n <code>p3</code> sáº½ cÃ³ kiá»ƒu
char cho <code>y</code>, vÃ¬ <code>y</code> Ä‘áº¿n tá»« <code>p2</code>. Cuá»™c gá»i macro println! sáº½ in ra <code>p3.x = 5, p3.y = c</code>.</p>
<p>Má»¥c Ä‘Ã­ch cá»§a vÃ­ dá»¥ nÃ y lÃ  Ä‘á»ƒ minh há»a má»™t tÃ¬nh huá»‘ng trong Ä‘Ã³ má»™t sá»‘ tham
sá»‘ generic Ä‘Æ°á»£c khai bÃ¡o vá»›i <code>impl</code> vÃ  má»™t sá»‘ Ä‘Æ°á»£c khai bÃ¡o vá»›i Ä‘á»‹nh nghÄ©a
phÆ°Æ¡ng thá»©c. á» Ä‘Ã¢y, cÃ¡c tham sá»‘ generic <code>X1</code> vÃ  <code>Y1</code> Ä‘Æ°á»£c khai bÃ¡o sau impl vÃ¬
chÃºng Ä‘i kÃ¨m vá»›i Ä‘á»‹nh nghÄ©a <code>struct</code>. CÃ¡c tham sá»‘ generic <code>X2</code> vÃ  <code>Y2</code> Ä‘Æ°á»£c
khai bÃ¡o sau <code>fn mixup</code>, vÃ¬ chÃºng chá»‰ liÃªn quan Ä‘áº¿n phÆ°Æ¡ng thá»©c.</p>
<h3 id="hiá»‡u-nÄƒng-cá»§a-code-sá»­-dá»¥ng-generic"><a class="header" href="#hiá»‡u-nÄƒng-cá»§a-code-sá»­-dá»¥ng-generic">Hiá»‡u nÄƒng cá»§a code sá»­ dá»¥ng Generic</a></h3>
<p>Báº¡n cÃ³ thá»ƒ tá»± há»i liá»‡u cÃ³ chi phÃ­ thá»i gian cháº¡y khi sá»­ dá»¥ng cÃ¡c tham sá»‘ kiá»ƒu
generic hay khÃ´ng. Tin tá»‘t lÃ  viá»‡c sá»­ dá»¥ng cÃ¡c kiá»ƒu generic sáº½ khÃ´ng lÃ m
chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n cháº¡y cháº­m hÆ¡n so vá»›i viá»‡c sá»­ dá»¥ng cÃ¡c kiá»ƒu cá»¥ thá»ƒ.</p>
<p>Rust Ä‘áº¡t Ä‘Æ°á»£c Ä‘iá»u nÃ y báº±ng cÃ¡ch thá»±c hiá»‡n <em>monomorphization</em> cá»§a mÃ£ nguá»“n
sá»­ dá»¥ng generics trong quÃ¡ trÃ¬nh biÃªn dá»‹ch. <em>Monomorphization</em> lÃ  quÃ¡ trÃ¬nh
chuyá»ƒn Ä‘á»•i mÃ£ nguá»“n generic thÃ nh mÃ£ nguá»“n cá»¥ thá»ƒ báº±ng cÃ¡ch Ä‘iá»n vÃ o cÃ¡c kiá»ƒu cá»¥
thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng khi biÃªn dá»‹ch. Trong quÃ¡ trÃ¬nh nÃ y, trÃ¬nh biÃªn dá»‹ch thá»±c hiá»‡n
theo chiá»u ngÆ°á»£c láº¡i so vá»›i cÃ¡c bÆ°á»›c chÃºng ta Ä‘Ã£ sá»­ dá»¥ng Ä‘á»ƒ táº¡o hÃ m generic
trong Listing 10-5: trÃ¬nh biÃªn dá»‹ch xem xÃ©t táº¥t cáº£ cÃ¡c Ä‘iá»ƒm mÃ  mÃ£ nguá»“n generic
Ä‘Æ°á»£c gá»i vÃ  táº¡o mÃ£ nguá»“n cho cÃ¡c kiá»ƒu cá»¥ thá»ƒ mÃ  mÃ£ nguá»“n generic Ä‘Æ°á»£c gá»i vá»›i.</p>
<p>HÃ£y xem cÃ¡ch Ä‘iá»u nÃ y hoáº¡t Ä‘á»™ng báº±ng cÃ¡ch sá»­ dá»¥ng generic <code>Option&lt;T&gt;</code> enum tá»«
thÆ° viá»‡n chuáº©n:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let integer = Some(5);
let float = Some(5.0);
<span class="boring">}</span></code></pre></pre>
<p>Khi Rust biÃªn dá»‹ch mÃ£ nguá»“n nÃ y, nÃ³ thá»±c hiá»‡n monomorphization.
Trong quÃ¡ trÃ¬nh Ä‘Ã³, trÃ¬nh biÃªn dá»‹ch Ä‘á»c cÃ¡c giÃ¡ trá»‹ Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng
trong cÃ¡c trÆ°á»ng há»£p cá»§a <code>Option&lt;T&gt;</code> vÃ  xÃ¡c Ä‘á»‹nh hai loáº¡i <code>Option&lt;T&gt;</code>: má»™t
lÃ  <code>i32</code> vÃ  má»™t lÃ  <code>f64</code>. Do Ä‘Ã³, nÃ³ má»Ÿ rá»™ng Ä‘á»‹nh nghÄ©a generic cá»§a <code>Option&lt;T&gt;</code>
thÃ nh hai Ä‘á»‹nh nghÄ©a Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a cho <code>i32</code> vÃ  <code>f64</code>, thay tháº¿ Ä‘á»‹nh nghÄ©a
generic báº±ng nhá»¯ng Ä‘á»‹nh nghÄ©a cá»¥ thá»ƒ nÃ y.</p>
<p>PhiÃªn báº£n Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a báº±ng monomorphization cá»§a mÃ£ nguá»“n trÃ´ng
giá»‘ng nhÆ° sau (trÃ¬nh biÃªn dá»‹ch sá»­ dá»¥ng tÃªn khÃ¡c vá»›i nhá»¯ng gÃ¬ chÃºng ta sá»­
dá»¥ng á»Ÿ Ä‘Ã¢y cho má»¥c Ä‘Ã­ch minh há»a):</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">enum Option_i32 {
    Some(i32),
    None,
}

enum Option_f64 {
    Some(f64),
    None,
}

fn main() {
    let integer = Option_i32::Some(5);
    let float = Option_f64::Some(5.0);
}</code></pre></pre>
<p>Cáº¥u trÃºc tá»•ng quÃ¡t Option<T> Ä‘Æ°á»£c thay tháº¿ báº±ng cÃ¡c Ä‘á»‹nh nghÄ©a cá»¥ thá»ƒ Ä‘Æ°á»£c
táº¡o ra bá»Ÿi trÃ¬nh biÃªn dá»‹ch. VÃ¬ Rust biÃªn dá»‹ch mÃ£ tá»•ng quÃ¡t thÃ nh mÃ£ xÃ¡c Ä‘á»‹nh
kiá»ƒu trong tá»«ng trÆ°á»ng há»£p cá»¥ thá»ƒ, nÃªn chÃºng ta khÃ´ng pháº£i chá»‹u chi phÃ­
thá»±c thi táº¡i thá»i gian cháº¡y khi sá»­ dá»¥ng generics. Khi mÃ£ Ä‘Æ°á»£c thá»±c thi,
nÃ³ hoáº¡t Ä‘á»™ng giá»‘ng há»‡t nhÆ° thá»ƒ chÃºng ta Ä‘Ã£ sao chÃ©p tá»«ng Ä‘á»‹nh nghÄ©a thá»§ cÃ´ng.
QuÃ¡ trÃ¬nh Ä‘Æ¡n hÃ¬nh hÃ³a (monomorphization) khiáº¿n generics cá»§a Rust cá»±c ká»³
hiá»‡u quáº£ khi cháº¡y.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="traits-Äá»‹nh-nghÄ©a-hÃ nh-vi-chung"><a class="header" href="#traits-Äá»‹nh-nghÄ©a-hÃ nh-vi-chung">Traits: Äá»‹nh nghÄ©a HÃ nh vi Chung</a></h2>
<p>Má»™t <em>trait</em> Ä‘á»‹nh nghÄ©a cÃ¡c chá»©c nÄƒng mÃ  má»™t type cá»¥ thá»ƒ cÃ³ vÃ  cÃ³ thá»ƒ chia sáº»
vá»›i cÃ¡c type khÃ¡c. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng traits Ä‘á»ƒ Ä‘á»‹nh nghÄ©a hÃ nh vi
chung theo cÃ¡ch trá»«u tÆ°á»£ng. ChÃºng ta cÃ³ thá»ƒ dÃ¹ng <em>trait bounds</em> Ä‘á»ƒ chá»‰ Ä‘á»‹nh
ráº±ng má»™t generic type cÃ³ thá»ƒ lÃ  báº¥t ká»³ type nÃ o mÃ  cÃ³ hÃ nh vi nháº¥t Ä‘á»‹nh.</p>
<blockquote>
<p>LÆ°u Ã½: Traits tÆ°Æ¡ng tá»± nhÆ° má»™t tÃ­nh nÄƒng thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  <em>interfaces</em>
trong cÃ¡c ngÃ´n ngá»¯ khÃ¡c, máº·c dÃ¹ cÃ³ má»™t sá»‘ khÃ¡c biá»‡t.</p>
</blockquote>
<h3 id="defining-a-trait"><a class="header" href="#defining-a-trait">Defining a Trait</a></h3>
<p>HÃ nh vi cá»§a má»™t type bao gá»“m cÃ¡c method mÃ  chÃºng ta cÃ³ thá»ƒ gá»i trÃªn type Ä‘Ã³.
CÃ¡c type khÃ¡c nhau chia sáº» cÃ¹ng má»™t hÃ nh vi náº¿u chÃºng ta cÃ³ thá»ƒ gá»i cÃ¹ng
má»™t phÆ°Æ¡ng thá»©c trÃªn táº¥t cáº£ cÃ¡c type Ä‘Ã³. Äá»‹nh nghÄ©a trait lÃ  má»™t cÃ¡ch Ä‘á»ƒ
nhÃ³m cÃ¡c method signature láº¡i vá»›i nhau nháº±m xÃ¡c Ä‘á»‹nh má»™t táº­p há»£p hÃ nh vi
cáº§n thiáº¿t Ä‘á»ƒ thá»±c hiá»‡n má»™t má»¥c Ä‘Ã­ch nÃ o Ä‘Ã³.</p>
<p>VÃ­ dá»¥, giáº£ sá»­ chÃºng ta cÃ³ nhiá»u struct lÆ°u trá»¯ cÃ¡c loáº¡i vÃ  lÆ°á»£ng text khÃ¡c
nhau: má»™t struct <code>NewsArticle</code> chá»©a má»™t bÃ i bÃ¡o Ä‘Æ°á»£c lÆ°u trá»¯ á»Ÿ má»™t Ä‘á»‹a
Ä‘iá»ƒm cá»¥ thá»ƒ, vÃ  má»™t <code>Tweet</code> cÃ³ tá»‘i Ä‘a 280 kÃ½ tá»± cÃ¹ng vá»›i metadata chá»‰
ra Ä‘Ã³ lÃ  tweet má»›i, retweet, hay tráº£ lá»i má»™t tweet khÃ¡c.</p>
<p>ChÃºng ta muá»‘n táº¡o má»™t media aggregator library crate tÃªn lÃ  <code>aggregator</code>
cÃ³ thá»ƒ hiá»ƒn thá»‹ tÃ³m táº¯t dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c lÆ°u trong má»™t instance cá»§a
<code>NewsArticle</code> hoáº·c <code>Tweet</code>. Äá»ƒ lÃ m Ä‘iá»u nÃ y, chÃºng ta cáº§n má»™t báº£n tÃ³m
táº¯t tá»« má»—i type, vÃ  chÃºng ta sáº½ yÃªu cáº§u báº£n tÃ³m táº¯t Ä‘Ã³ báº±ng cÃ¡ch gá»i
method <code>summarize</code> trÃªn má»™t instance. Listing 10-12 hiá»ƒn thá»‹ Ä‘á»‹nh nghÄ©a
cá»§a má»™t public <code>Summary</code> trait biá»ƒu thá»‹ hÃ nh vi nÃ y.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub trait Summary {
    fn summarize(&amp;self) -&gt; String;
}</code></pre>
<p><span class="caption">Listing 10-12: Má»™t <code>Summary</code> trait bao gá»“m hÃ nh vi Ä‘Æ°á»£c
cung cáº¥p bá»Ÿi method <code>summarize</code></span></p>
<p>á» Ä‘Ã¢y, chÃºng ta khai bÃ¡o má»™t trait báº±ng tá»« khÃ³a <code>trait</code> vÃ  sau Ä‘Ã³ lÃ  tÃªn
cá»§a trait, trong trÆ°á»ng há»£p nÃ y lÃ  <code>Summary</code>. ChÃºng ta cÅ©ng khai bÃ¡o trait
lÃ  <code>pub</code> Ä‘á»ƒ cÃ¡c crate phá»¥ thuá»™c vÃ o crate nÃ y cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng trait,
nhÆ° chÃºng ta sáº½ tháº¥y trong má»™t vÃ i vÃ­ dá»¥. BÃªn trong cáº·p ngoáº·c nhá»n, chÃºng
ta khai bÃ¡o cÃ¡c method signature mÃ´ táº£ hÃ nh vi cá»§a cÃ¡c type triá»ƒn khai trait
nÃ y, trong trÆ°á»ng há»£p nÃ y lÃ  <code>fn summarize(&amp;self) -&gt; String</code>.</p>
<p>Sau method signature, thay vÃ¬ cung cáº¥p pháº§n implementation bÃªn trong cáº·p
ngoáº·c nhá»n, chÃºng ta dÃ¹ng dáº¥u cháº¥m pháº©y. Má»—i type triá»ƒn khai trait nÃ y
pháº£i cung cáº¥p hÃ nh vi riÃªng cho thÃ¢n cá»§a method. Compiler sáº½ Ä‘áº£m báº£o ráº±ng
báº¥t ká»³ type nÃ o cÃ³ trait <code>Summary</code> sáº½ cÃ³ method <code>summarize</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a
vá»›i signature chÃ­nh xÃ¡c nhÆ° váº­y.</p>
<p>Má»™t trait cÃ³ thá»ƒ cÃ³ nhiá»u method trong thÃ¢n cá»§a nÃ³: cÃ¡c method signature
Ä‘Æ°á»£c liá»‡t kÃª tá»«ng dÃ²ng má»™t vÃ  má»—i dÃ²ng káº¿t thÃºc báº±ng dáº¥u cháº¥m pháº©y.</p>
<h3 id="triá»ƒn-khai-trait-trÃªn-má»™t-type"><a class="header" href="#triá»ƒn-khai-trait-trÃªn-má»™t-type">Triá»ƒn khai Trait trÃªn má»™t Type</a></h3>
<p>BÃ¢y giá» chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a cÃ¡c signature mong muá»‘n cá»§a cÃ¡c method trong
trait <code>Summary</code>, chÃºng ta cÃ³ thá»ƒ triá»ƒn khai nÃ³ trÃªn cÃ¡c type trong media
aggregator cá»§a mÃ¬nh. Listing 10-13 hiá»ƒn thá»‹ má»™t triá»ƒn khai cá»§a trait
<code>Summary</code> trÃªn struct <code>NewsArticle</code> sá»­ dá»¥ng headline, author vÃ  location
Ä‘á»ƒ táº¡o giÃ¡ trá»‹ tráº£ vá» cá»§a <code>summarize</code>. Äá»‘i vá»›i struct <code>Tweet</code>, chÃºng ta
Ä‘á»‹nh nghÄ©a <code>summarize</code> lÃ  username theo sau lÃ  toÃ n bá»™ ná»™i dung tweet,
giáº£ sá»­ ná»™i dung tweet Ä‘Ã£ bá»‹ giá»›i háº¡n tá»‘i Ä‘a 280 kÃ½ tá»±.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">pub trait Summary {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String;
</span><span class="boring">}
</span><span class="boring">
</span>pub struct NewsArticle {
    pub headline: String,
    pub location: String,
    pub author: String,
    pub content: String,
}

impl Summary for NewsArticle {
    fn summarize(&amp;self) -&gt; String {
        format!("{}, by {} ({})", self.headline, self.author, self.location)
    }
}

pub struct SocialPost {
    pub username: String,
    pub content: String,
    pub reply: bool,
    pub repost: bool,
}

impl Summary for SocialPost {
    fn summarize(&amp;self) -&gt; String {
        format!("{}: {}", self.username, self.content)
    }
}</code></pre>
<p><span class="caption">Listing 10-13: Triá»ƒn khai trait <code>Summary</code> trÃªn cÃ¡c type
<code>NewsArticle</code> vÃ  <code>Tweet</code></span></p>
<p>Triá»ƒn khai má»™t trait trÃªn má»™t type tÆ°Æ¡ng tá»± nhÆ° triá»ƒn khai cÃ¡c method
thÆ°á»ng. Sá»± khÃ¡c biá»‡t lÃ  sau <code>impl</code>, chÃºng ta Ä‘áº·t tÃªn trait muá»‘n triá»ƒn khai,
sau Ä‘Ã³ dÃ¹ng tá»« khÃ³a <code>for</code>, vÃ  rá»“i chá»‰ Ä‘á»‹nh tÃªn cá»§a type mÃ  chÃºng ta muá»‘n
triá»ƒn khai trait cho. BÃªn trong khá»‘i <code>impl</code>, chÃºng ta Ä‘áº·t cÃ¡c method
signature mÃ  Ä‘á»‹nh nghÄ©a trait Ä‘Ã£ Ä‘á»‹nh nghÄ©a. Thay vÃ¬ thÃªm dáº¥u cháº¥m pháº©y
sau má»—i signature, chÃºng ta dÃ¹ng cáº·p ngoáº·c nhá»n vÃ  Ä‘iá»n pháº§n thÃ¢n cá»§a
method vá»›i hÃ nh vi cá»¥ thá»ƒ mÃ  chÃºng ta muá»‘n cÃ¡c method cá»§a trait cÃ³ trÃªn
type cá»¥ thá»ƒ Ä‘Ã³.</p>
<p>BÃ¢y giá» khi thÆ° viá»‡n Ä‘Ã£ triá»ƒn khai trait <code>Summary</code> trÃªn <code>NewsArticle</code> vÃ 
<code>Tweet</code>, ngÆ°á»i dÃ¹ng cá»§a crate cÃ³ thá»ƒ gá»i cÃ¡c method cá»§a trait trÃªn cÃ¡c
instance cá»§a <code>NewsArticle</code> vÃ  <code>Tweet</code> theo cÃ¹ng cÃ¡ch chÃºng ta gá»i cÃ¡c
method thÆ°á»ng. Sá»± khÃ¡c biá»‡t duy nháº¥t lÃ  ngÆ°á»i dÃ¹ng pháº£i Ä‘Æ°a trait vÃ o
scope cÅ©ng nhÆ° cÃ¡c type. DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ vá» cÃ¡ch má»™t binary crate cÃ³
thá»ƒ sá»­ dá»¥ng thÆ° viá»‡n <code>aggregator</code> cá»§a chÃºng ta:</p>
<pre><code class="language-rust ignore">use aggregator::{SocialPost, Summary};

fn main() {
    let post = SocialPost {
        username: String::from("horse_ebooks"),
        content: String::from(
            "of course, as you probably already know, people",
        ),
        reply: false,
        repost: false,
    };

    println!("1 new post: {}", post.summarize());
}</code></pre>
<p>Äoáº¡n code nÃ y in ra <code>1 new tweet: horse_ebooks: of course, as you probably already know, people</code>.</p>
<p>CÃ¡c crate khÃ¡c phá»¥ thuá»™c vÃ o crate <code>aggregator</code> cÅ©ng cÃ³ thá»ƒ Ä‘Æ°a trait <code>Summary</code>
vÃ o scope Ä‘á»ƒ triá»ƒn khai <code>Summary</code> trÃªn cÃ¡c type cá»§a riÃªng há». Má»™t háº¡n cháº¿ cáº§n
lÆ°u Ã½ lÃ  chÃºng ta chá»‰ cÃ³ thá»ƒ triá»ƒn khai má»™t trait trÃªn má»™t type náº¿u Ã­t nháº¥t
má»™t trong trait hoáº·c type lÃ  local vá»›i crate cá»§a chÃºng ta. VÃ­ dá»¥, chÃºng ta
cÃ³ thá»ƒ triá»ƒn khai cÃ¡c trait trong standard library nhÆ° <code>Display</code> trÃªn má»™t
type tÃ¹y chá»‰nh nhÆ° <code>Tweet</code> nhÆ° má»™t pháº§n cá»§a chá»©c nÄƒng crate <code>aggregator</code> cá»§a
chÃºng ta, vÃ¬ type <code>Tweet</code> lÃ  local vá»›i crate <code>aggregator</code> cá»§a chÃºng ta. ChÃºng
ta cÅ©ng cÃ³ thá»ƒ triá»ƒn khai <code>Summary</code> trÃªn <code>Vec&lt;T&gt;</code> trong crate <code>aggregator</code> cá»§a
chÃºng ta, vÃ¬ trait <code>Summary</code> lÃ  local vá»›i crate <code>aggregator</code>.</p>
<p>NhÆ°ng chÃºng ta khÃ´ng thá»ƒ triá»ƒn khai cÃ¡c trait bÃªn ngoÃ i trÃªn cÃ¡c type bÃªn ngoÃ i.
VÃ­ dá»¥, chÃºng ta khÃ´ng thá»ƒ triá»ƒn khai trait <code>Display</code> trÃªn <code>Vec&lt;T&gt;</code> trong crate
<code>aggregator</code> cá»§a chÃºng ta, vÃ¬ <code>Display</code> vÃ  <code>Vec&lt;T&gt;</code> Ä‘á»u Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong
standard library vÃ  khÃ´ng pháº£i lÃ  local vá»›i crate <code>aggregator</code>. Háº¡n cháº¿ nÃ y
lÃ  má»™t pháº§n cá»§a má»™t Ä‘áº·c tÃ­nh gá»i lÃ  <em>coherence</em>, vÃ  cá»¥ thá»ƒ hÆ¡n lÃ  <em>orphan rule</em>,
Ä‘Æ°á»£c gá»i nhÆ° váº­y vÃ¬ type cha khÃ´ng cÃ³ máº·t. Quy táº¯c nÃ y Ä‘áº£m báº£o ráº±ng code cá»§a
ngÆ°á»i khÃ¡c khÃ´ng thá»ƒ phÃ¡ vá»¡ code cá»§a báº¡n vÃ  ngÆ°á»£c láº¡i. Náº¿u khÃ´ng cÃ³ quy táº¯c nÃ y,
hai crate cÃ³ thá»ƒ triá»ƒn khai cÃ¹ng má»™t trait cho cÃ¹ng má»™t type, vÃ  Rust sáº½ khÃ´ng
biáº¿t triá»ƒn khai nÃ o Ä‘á»ƒ sá»­ dá»¥ng.</p>
<h3 id="default-implementations"><a class="header" href="#default-implementations">Default Implementations</a></h3>
<p>ÄÃ´i khi sáº½ há»¯u Ã­ch khi cÃ³ hÃ nh vi máº·c Ä‘á»‹nh cho má»™t sá»‘ hoáº·c táº¥t cáº£ cÃ¡c method
trong má»™t trait thay vÃ¬ yÃªu cáº§u pháº£i triá»ƒn khai táº¥t cáº£ cÃ¡c method trÃªn má»i type.
Khi Ä‘Ã³, khi triá»ƒn khai trait trÃªn má»™t type cá»¥ thá»ƒ, chÃºng ta cÃ³ thá»ƒ giá»¯ nguyÃªn
hoáº·c ghi Ä‘Ã¨ hÃ nh vi máº·c Ä‘á»‹nh cá»§a tá»«ng method.</p>
<p>Trong Listing 10-14, chÃºng ta xÃ¡c Ä‘á»‹nh má»™t chuá»—i máº·c Ä‘á»‹nh cho method <code>summarize</code>
cá»§a trait <code>Summary</code> thay vÃ¬ chá»‰ Ä‘á»‹nh nghÄ©a chá»¯ kÃ½ cá»§a method, nhÆ° chÃºng ta Ä‘Ã£
lÃ m trong Listing 10-12.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub trait Summary {
    fn summarize(&amp;self) -&gt; String {
        String::from("(Read more...)")
    }
}
<span class="boring">
</span><span class="boring">pub struct NewsArticle {
</span><span class="boring">    pub headline: String,
</span><span class="boring">    pub location: String,
</span><span class="boring">    pub author: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Summary for NewsArticle {}
</span><span class="boring">
</span><span class="boring">pub struct SocialPost {
</span><span class="boring">    pub username: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">    pub reply: bool,
</span><span class="boring">    pub repost: bool,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Summary for SocialPost {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String {
</span><span class="boring">        format!("{}: {}", self.username, self.content)
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 10-14: Äá»‹nh nghÄ©a trait <code>Summary</code> vá»›i
cÃ i Ä‘áº·t máº·c Ä‘á»‹nh cho method <code>summarize</code></span></p>
<p>Äá»ƒ sá»­ dá»¥ng cÃ i Ä‘áº·t máº·c Ä‘á»‹nh Ä‘á»ƒ tÃ³m táº¯t cÃ¡c instance cá»§a <code>NewsArticle</code>, chÃºng ta
xÃ¡c Ä‘á»‹nh má»™t <code>impl</code> block rá»—ng vá»›i <code>impl Summary for NewsArticle {}</code>.</p>
<p>Máº·c dÃ¹ bÃ¢y giá» chÃºng ta khÃ´ng cÃ²n Ä‘á»‹nh nghÄ©a method <code>summarize</code> trá»±c tiáº¿p trÃªn
<code>NewsArticle</code>, chÃºng ta Ä‘Ã£ cung cáº¥p má»™t cÃ i Ä‘áº·t máº·c Ä‘á»‹nh vÃ  chá»‰ Ä‘á»‹nh ráº±ng
<code>NewsArticle</code> triá»ƒn khai trait <code>Summary</code>. Káº¿t quáº£ lÃ , chÃºng ta váº«n cÃ³ thá»ƒ gá»i
method <code>summarize</code> trÃªn má»™t instance cá»§a <code>NewsArticle</code>, nhÆ° sau:</p>
<pre><code class="language-rust ignore"><span class="boring">use aggregator::{self, NewsArticle, Summary};
</span><span class="boring">
</span><span class="boring">fn main() {
</span>    let article = NewsArticle {
        headline: String::from("Penguins win the Stanley Cup Championship!"),
        location: String::from("Pittsburgh, PA, USA"),
        author: String::from("Iceburgh"),
        content: String::from(
            "The Pittsburgh Penguins once again are the best \
             hockey team in the NHL.",
        ),
    };

    println!("New article available! {}", article.summarize());
<span class="boring">}</span></code></pre>
<p>MÃ£ nÃ y sáº½ in ra <code>New article available! (Read more...)</code>.</p>
<p>Viá»‡c táº¡o má»™t cÃ i Ä‘áº·t máº·c Ä‘á»‹nh khÃ´ng yÃªu cáº§u chÃºng ta thay Ä‘á»•i gÃ¬ vá»
cÃ¡ch triá»ƒn khai trait <code>Summary</code> trÃªn <code>Tweet</code> trong Listing 10-13. LÃ½ do lÃ  cÃº phÃ¡p
Ä‘á»ƒ ghi Ä‘Ã¨ má»™t cÃ i Ä‘áº·t máº·c Ä‘á»‹nh giá»‘ng há»‡t cÃº phÃ¡p Ä‘á»ƒ triá»ƒn khai má»™t method cá»§a
trait mÃ  khÃ´ng cÃ³ cÃ i Ä‘áº·t máº·c Ä‘á»‹nh.</p>
<p>CÃ¡c cÃ i Ä‘áº·t máº·c Ä‘á»‹nh cÃ³ thá»ƒ gá»i cÃ¡c method khÃ¡c trong cÃ¹ng má»™t trait, ngay cáº£
khi cÃ¡c method Ä‘Ã³ khÃ´ng cÃ³ cÃ i Ä‘áº·t máº·c Ä‘á»‹nh. Theo cÃ¡ch nÃ y, má»™t trait cÃ³ thá»ƒ
cung cáº¥p nhiá»u chá»©c nÄƒng há»¯u Ã­ch vÃ  chá»‰ yÃªu cáº§u ngÆ°á»i triá»ƒn khai Ä‘á»‹nh nghÄ©a
má»™t pháº§n nhá» trong sá»‘ Ä‘Ã³. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a trait <code>Summary</code>
cÃ³ má»™t method <code>summarize_author</code> mÃ  báº¯t buá»™c pháº£i triá»ƒn khai, rá»“i sau Ä‘Ã³
Ä‘á»‹nh nghÄ©a method <code>summarize</code> cÃ³ cÃ i Ä‘áº·t máº·c Ä‘á»‹nh gá»i Ä‘áº¿n <code>summarize_author</code>:</p>
<pre><code class="language-rust noplayground">pub trait Summary {
    fn summarize_author(&amp;self) -&gt; String;

    fn summarize(&amp;self) -&gt; String {
        format!("(Read more from {}...)", self.summarize_author())
    }
}
<span class="boring">
</span><span class="boring">pub struct SocialPost {
</span><span class="boring">    pub username: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">    pub reply: bool,
</span><span class="boring">    pub repost: bool,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Summary for SocialPost {
</span><span class="boring">    fn summarize_author(&amp;self) -&gt; String {
</span><span class="boring">        format!("@{}", self.username)
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Äá»ƒ sá»­ dá»¥ng phiÃªn báº£n <code>Summary</code> nÃ y, chÃºng ta chá»‰ cáº§n Ä‘á»‹nh nghÄ©a <code>summarize_author</code>
khi triá»ƒn khai trait trÃªn má»™t kiá»ƒu:</p>
<pre><code class="language-rust ignore"><span class="boring">pub trait Summary {
</span><span class="boring">    fn summarize_author(&amp;self) -&gt; String;
</span><span class="boring">
</span><span class="boring">    fn summarize(&amp;self) -&gt; String {
</span><span class="boring">        format!("(Read more from {}...)", self.summarize_author())
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct SocialPost {
</span><span class="boring">    pub username: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">    pub reply: bool,
</span><span class="boring">    pub repost: bool,
</span><span class="boring">}
</span><span class="boring">
</span>impl Summary for SocialPost {
    fn summarize_author(&amp;self) -&gt; String {
        format!("@{}", self.username)
    }
}</code></pre>
<p>Sau khi chÃºng ta Ä‘á»‹nh nghÄ©a <code>summarize_author</code>,
chÃºng ta cÃ³ thá»ƒ gá»i <code>summarize</code> trÃªn cÃ¡c instance cá»§a struct <code>Tweet</code>,
vÃ  implementation máº·c Ä‘á»‹nh cá»§a <code>summarize</code> sáº½ gá»i Ä‘á»‹nh nghÄ©a cá»§a <code>summarize_author</code> mÃ  chÃºng ta Ä‘Ã£ cung cáº¥p.
Bá»Ÿi vÃ¬ chÃºng ta Ä‘Ã£ triá»ƒn khai <code>summarize_author</code>, trait <code>Summary</code>
Ä‘Ã£ cung cáº¥p cho chÃºng ta hÃ nh vi cá»§a phÆ°Æ¡ng thá»©c <code>summarize</code> mÃ  khÃ´ng yÃªu cáº§u pháº£i viáº¿t thÃªm báº¥t ká»³ code nÃ o.</p>
<pre><code class="language-rust ignore"><span class="boring">use aggregator::{self, SocialPost, Summary};
</span><span class="boring">
</span><span class="boring">fn main() {
</span>    let post = SocialPost {
        username: String::from("horse_ebooks"),
        content: String::from(
            "of course, as you probably already know, people",
        ),
        reply: false,
        repost: false,
    };

    println!("1 new post: {}", post.summarize());
<span class="boring">}</span></code></pre>
<p>MÃ£ nÃ y in ra <code>1 new tweet: (Read more from @horse_ebooks...)</code>.</p>
<p>LÆ°u Ã½ ráº±ng khÃ´ng thá»ƒ gá»i triá»ƒn khai máº·c Ä‘á»‹nh tá»« má»™t triá»ƒn khai ghi Ä‘Ã¨ cá»§a cÃ¹ng phÆ°Æ¡ng thá»©c Ä‘Ã³.</p>
<h3 id="traits-nhÆ°-tham-sá»‘"><a class="header" href="#traits-nhÆ°-tham-sá»‘">Traits nhÆ° Tham Sá»‘</a></h3>
<p>BÃ¢y giá» báº¡n Ä‘Ã£ biáº¿t cÃ¡ch Ä‘á»‹nh nghÄ©a vÃ  triá»ƒn khai traits, chÃºng ta cÃ³ thá»ƒ khÃ¡m phÃ¡ cÃ¡ch sá»­ dá»¥ng traits Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c hÃ m nháº­n nhiá»u loáº¡i khÃ¡c nhau. ChÃºng ta sáº½ sá»­ dá»¥ng trait <code>Summary</code> mÃ  chÃºng ta Ä‘Ã£ triá»ƒn khai trÃªn cÃ¡c kiá»ƒu <code>NewsArticle</code> vÃ  <code>Tweet</code> trong Listing 10-13 Ä‘á»ƒ Ä‘á»‹nh nghÄ©a má»™t hÃ m <code>notify</code> gá»i phÆ°Æ¡ng thá»©c <code>summarize</code> trÃªn tham sá»‘ <code>item</code> cá»§a nÃ³, mÃ  lÃ  má»™t kiá»ƒu nÃ o Ä‘Ã³ triá»ƒn khai trait <code>Summary</code>. Äá»ƒ lÃ m Ä‘iá»u nÃ y, chÃºng ta sá»­ dá»¥ng cÃº phÃ¡p <code>impl Trait</code>, nhÆ° sau:</p>
<pre><code class="language-rust ignore"><span class="boring">pub trait Summary {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct NewsArticle {
</span><span class="boring">    pub headline: String,
</span><span class="boring">    pub location: String,
</span><span class="boring">    pub author: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Summary for NewsArticle {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String {
</span><span class="boring">        format!("{}, by {} ({})", self.headline, self.author, self.location)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct SocialPost {
</span><span class="boring">    pub username: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">    pub reply: bool,
</span><span class="boring">    pub repost: bool,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Summary for SocialPost {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String {
</span><span class="boring">        format!("{}: {}", self.username, self.content)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>pub fn notify(item: &amp;impl Summary) {
    println!("Breaking news! {}", item.summarize());
}</code></pre>
<p>Thay vÃ¬ má»™t kiá»ƒu cá»¥ thá»ƒ cho tham sá»‘ <code>item</code>, chÃºng ta chá»‰ Ä‘á»‹nh tá»« khÃ³a <code>impl</code> vÃ  tÃªn trait.
Tham sá»‘ nÃ y cháº¥p nháº­n báº¥t ká»³ kiá»ƒu nÃ o triá»ƒn khai trait Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh.
Trong thÃ¢n hÃ m <code>notify</code>, chÃºng ta cÃ³ thá»ƒ gá»i báº¥t ká»³ phÆ°Æ¡ng thá»©c nÃ o trÃªn <code>item</code> mÃ  Ä‘áº¿n tá»« trait <code>Summary</code>,
cháº³ng háº¡n nhÆ° <code>summarize</code>. ChÃºng ta cÃ³ thá»ƒ gá»i <code>notify</code> vÃ  truyá»n vÃ o báº¥t ká»³ thá»ƒ hiá»‡n nÃ o cá»§a <code>NewsArticle</code> hoáº·c <code>Tweet</code>.
MÃ£ gá»i hÃ m vá»›i báº¥t ká»³ kiá»ƒu nÃ o khÃ¡c, cháº³ng háº¡n nhÆ° <code>String</code> hoáº·c <code>i32</code>,
sáº½ khÃ´ng biÃªn dá»‹ch vÃ¬ cÃ¡c kiá»ƒu Ä‘Ã³ khÃ´ng triá»ƒn khai <code>Summary</code>.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="fixing-the-largest-function-with-trait-bounds"></a></p>
<h4 id="cÃº-phÃ¡p-trait-bound"><a class="header" href="#cÃº-phÃ¡p-trait-bound">CÃº phÃ¡p Trait Bound</a></h4>
<p>CÃº phÃ¡p <code>impl Trait</code> hoáº¡t Ä‘á»™ng cho cÃ¡c trÆ°á»ng há»£p Ä‘Æ¡n giáº£n nhÆ°ng thá»±c ra lÃ  cÃº phÃ¡p ngáº¯n gá»n cho má»™t dáº¡ng dÃ i hÆ¡n Ä‘Æ°á»£c gá»i lÃ  <em>trait bound</em>; nÃ³ trÃ´ng nhÆ° sau:</p>
<pre><code class="language-rust ignore">pub fn notify&lt;T: Summary&gt;(item: &amp;T) {
    println!("Breaking news! {}", item.summarize());
}</code></pre>
<p>PhiÃªn báº£n dÃ i hÆ¡n nÃ y tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i vÃ­ dá»¥ trong pháº§n trÆ°á»›c nhÆ°ng chi tiáº¿t hÆ¡n.
ChÃºng ta Ä‘áº·t rÃ ng buá»™c trait cÃ¹ng vá»›i khai bÃ¡o cá»§a tham sá»‘ kiá»ƒu generic ngay sau dáº¥u hai cháº¥m vÃ  bÃªn trong dáº¥u ngoáº·c nhá»n (<code>&lt;&gt;</code>).</p>
<p>CÃº phÃ¡p <code>impl Trait</code> tiá»‡n lá»£i vÃ  giÃºp viáº¿t code ngáº¯n gá»n hÆ¡n trong nhá»¯ng trÆ°á»ng há»£p Ä‘Æ¡n giáº£n,
trong khi cÃº phÃ¡p rÃ ng buá»™c trait Ä‘áº§y Ä‘á»§ cÃ³ thá»ƒ diá»…n Ä‘áº¡t sá»± phá»©c táº¡p hÆ¡n trong cÃ¡c trÆ°á»ng há»£p khÃ¡c.
VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ cÃ³ hai tham sá»‘ thá»±c thi <code>Summary</code>. Viá»‡c lÃ m nÃ y vá»›i cÃº phÃ¡p <code>impl Trait</code> sáº½ trÃ´ng nhÆ° sau:</p>
<pre><code class="language-rust ignore">pub fn notify(item1: &amp;impl Summary, item2: &amp;impl Summary) {</code></pre>
<p>Viá»‡c sá»­ dá»¥ng <code>impl Trait</code> lÃ  phÃ¹ há»£p náº¿u chÃºng ta muá»‘n hÃ m nÃ y cho phÃ©p <code>item1</code> vÃ 
<code>item2</code> cÃ³ cÃ¡c kiá»ƒu khÃ¡c nhau (miá»…n lÃ  cáº£ hai kiá»ƒu Ä‘á»u thá»±c thi <code>Summary</code>). Tuy nhiÃªn, náº¿u
chÃºng ta muá»‘n buá»™c cáº£ hai tham sá»‘ pháº£i cÃ¹ng kiá»ƒu, thÃ¬ pháº£i sá»­ dá»¥ng trait bound, nhÆ° sau:</p>
<pre><code class="language-rust ignore">pub fn notify&lt;T: Summary&gt;(item1: &amp;T, item2: &amp;T) {</code></pre>
<p>Kiá»ƒu generic <code>T</code> Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh lÃ m kiá»ƒu cá»§a cÃ¡c tham sá»‘ <code>item1</code> vÃ  <code>item2</code> giá»›i háº¡n hÃ m sao cho kiá»ƒu cá»¥ thá»ƒ cá»§a giÃ¡ trá»‹ Ä‘Æ°á»£c truyá»n vÃ o <code>item1</code> vÃ  <code>item2</code> pháº£i giá»‘ng nhau.</p>
<h4 id="chá»‰-Ä‘á»‹nh-nhiá»u-rÃ ng-buá»™c-trait-vá»›i-cÃº-phÃ¡p-"><a class="header" href="#chá»‰-Ä‘á»‹nh-nhiá»u-rÃ ng-buá»™c-trait-vá»›i-cÃº-phÃ¡p-">Chá»‰ Ä‘á»‹nh nhiá»u rÃ ng buá»™c trait vá»›i cÃº phÃ¡p <code>+</code></a></h4>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh nhiá»u hÆ¡n má»™t rÃ ng buá»™c trait. Giáº£ sá»­ chÃºng ta muá»‘n <code>notify</code> sá»­ dá»¥ng cáº£ Ä‘á»‹nh dáº¡ng hiá»ƒn thá»‹ láº«n tÃ³m táº¯t trÃªn <code>item</code>: chÃºng ta chá»‰ Ä‘á»‹nh trong Ä‘á»‹nh nghÄ©a <code>notify</code> ráº±ng <code>item</code> pháº£i thá»±c thi cáº£ <code>Display</code> vÃ  <code>Summary</code>. ChÃºng ta cÃ³ thá»ƒ lÃ m Ä‘iá»u nÃ y báº±ng cÃº phÃ¡p <code>+</code>:</p>
<pre><code class="language-rust ignore">pub fn notify(item: &amp;(impl Summary + Display)) {</code></pre>
<p>CÃº phÃ¡p <code>+</code> cÅ©ng há»£p lá»‡ vá»›i cÃ¡c rÃ ng buá»™c trait trÃªn cÃ¡c kiá»ƒu generic:</p>
<pre><code class="language-rust ignore">pub fn notify&lt;T: Summary + Display&gt;(item: &amp;T) {</code></pre>
<p>Vá»›i hai rÃ ng buá»™c trait Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh, thÃ¢n cá»§a <code>notify</code> cÃ³ thá»ƒ gá»i <code>summarize</code> vÃ  sá»­ dá»¥ng <code>{}</code> Ä‘á»ƒ Ä‘á»‹nh dáº¡ng <code>item</code>.</p>
<h4 id="rÃ ng-buá»™c-trait-rÃµ-rÃ ng-hÆ¡n-vá»›i-cÃ¢u-lá»‡nh-where"><a class="header" href="#rÃ ng-buá»™c-trait-rÃµ-rÃ ng-hÆ¡n-vá»›i-cÃ¢u-lá»‡nh-where">RÃ ng buá»™c trait rÃµ rÃ ng hÆ¡n vá»›i cÃ¢u lá»‡nh <code>where</code></a></h4>
<p>Sá»­ dá»¥ng quÃ¡ nhiá»u rÃ ng buá»™c trait cÅ©ng cÃ³ nhÆ°á»£c Ä‘iá»ƒm. Má»—i kiá»ƒu generic cÃ³ cÃ¡c rÃ ng buá»™c trait riÃªng, vÃ¬ váº­y cÃ¡c hÃ m vá»›i nhiá»u tham sá»‘ kiá»ƒu generic cÃ³ thá»ƒ chá»©a ráº¥t nhiá»u thÃ´ng tin rÃ ng buá»™c trait giá»¯a tÃªn hÃ m vÃ  danh sÃ¡ch tham sá»‘, lÃ m cho chá»¯ kÃ½ hÃ m khÃ³ Ä‘á»c. VÃ¬ lÃ½ do nÃ y, Rust cÃ³ cÃº phÃ¡p thay tháº¿ Ä‘á»ƒ chá»‰ Ä‘á»‹nh rÃ ng buá»™c trait bÃªn trong má»™t cÃ¢u lá»‡nh <code>where</code> sau chá»¯ kÃ½ hÃ m. Thay vÃ¬ viáº¿t nhÆ° sau:</p>
<pre><code class="language-rust ignore">fn some_function&lt;T: Display + Clone, U: Clone + Debug&gt;(t: &amp;T, u: &amp;U) -&gt; i32 {</code></pre>
<p>we can use a <code>where</code> clause, like this:</p>
<pre><code class="language-rust ignore">fn some_function&lt;T, U&gt;(t: &amp;T, u: &amp;U) -&gt; i32
where
    T: Display + Clone,
    U: Clone + Debug,
{
<span class="boring">    unimplemented!()
</span><span class="boring">}</span></code></pre>
<p>Chá»¯ kÃ½ cá»§a hÃ m nÃ y gá»n gÃ ng hÆ¡n: tÃªn hÃ m, danh sÃ¡ch tham sá»‘ vÃ  kiá»ƒu tráº£ vá» Ä‘Æ°á»£c Ä‘áº·t gáº§n nhau,
tÆ°Æ¡ng tá»± nhÆ° má»™t hÃ m khÃ´ng cÃ³ nhiá»u rÃ ng buá»™c trait.</p>
<h3 id="tráº£-vá»-cÃ¡c-kiá»ƒu-thá»±c-thi-trait"><a class="header" href="#tráº£-vá»-cÃ¡c-kiá»ƒu-thá»±c-thi-trait">Tráº£ vá» cÃ¡c kiá»ƒu thá»±c thi trait</a></h3>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng cÃº phÃ¡p <code>impl Trait</code> á»Ÿ vá»‹ trÃ­ tráº£ vá» Ä‘á»ƒ tráº£ vá» má»™t giÃ¡ trá»‹ cá»§a kiá»ƒu nÃ o Ä‘Ã³ thá»±c thi má»™t trait, nhÆ° minh há»a sau:</p>
<pre><code class="language-rust ignore"><span class="boring">pub trait Summary {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct NewsArticle {
</span><span class="boring">    pub headline: String,
</span><span class="boring">    pub location: String,
</span><span class="boring">    pub author: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Summary for NewsArticle {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String {
</span><span class="boring">        format!("{}, by {} ({})", self.headline, self.author, self.location)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct SocialPost {
</span><span class="boring">    pub username: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">    pub reply: bool,
</span><span class="boring">    pub repost: bool,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Summary for SocialPost {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String {
</span><span class="boring">        format!("{}: {}", self.username, self.content)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn returns_summarizable() -&gt; impl Summary {
    SocialPost {
        username: String::from("horse_ebooks"),
        content: String::from(
            "of course, as you probably already know, people",
        ),
        reply: false,
        repost: false,
    }
}</code></pre>
<p>Báº±ng cÃ¡ch sá»­ dá»¥ng <code>impl Summary</code> cho kiá»ƒu tráº£ vá», chÃºng ta chá»‰ Ä‘á»‹nh ráº±ng hÃ m <code>returns_summarizable</code>
tráº£ vá» má»™t kiá»ƒu nÃ o Ä‘Ã³ thá»±c thi trait <code>Summary</code> mÃ  khÃ´ng cáº§n Ä‘áº·t tÃªn kiá»ƒu cá»¥ thá»ƒ. Trong trÆ°á»ng há»£p nÃ y,
<code>returns_summarizable</code> tráº£ vá» má»™t <code>Tweet</code>, nhÆ°ng mÃ£ gá»i hÃ m nÃ y khÃ´ng cáº§n biáº¿t Ä‘iá»u Ä‘Ã³.</p>
<p>Kháº£ nÄƒng chá»‰ Ä‘á»‹nh kiá»ƒu tráº£ vá» chá»‰ dá»±a trÃªn trait mÃ  nÃ³ thá»±c thi Ä‘áº·c biá»‡t há»¯u Ã­ch trong bá»‘i cáº£nh closures vÃ  iterators, Ä‘Æ°á»£c Ä‘á» cáº­p trong ChÆ°Æ¡ng 13. Closures vÃ  iterators táº¡o ra cÃ¡c kiá»ƒu mÃ  chá»‰ trÃ¬nh biÃªn dá»‹ch biáº¿t hoáº·c cÃ¡c kiá»ƒu ráº¥t dÃ i Ä‘á»ƒ chá»‰ Ä‘á»‹nh. CÃº phÃ¡p <code>impl Trait</code> cho phÃ©p báº¡n chá»‰ Ä‘á»‹nh má»™t cÃ¡ch ngáº¯n gá»n ráº±ng má»™t hÃ m tráº£ vá» má»™t kiá»ƒu nÃ o Ä‘Ã³ thá»±c thi trait <code>Iterator</code> mÃ  khÃ´ng cáº§n viáº¿t ra kiá»ƒu ráº¥t dÃ i.</p>
<p>Tuy nhiÃªn, báº¡n chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng <code>impl Trait</code> náº¿u tráº£ vá» má»™t kiá»ƒu duy nháº¥t. VÃ­ dá»¥, Ä‘oáº¡n mÃ£ nÃ y tráº£ vá» hoáº·c má»™t <code>NewsArticle</code> hoáº·c má»™t <code>Tweet</code> vá»›i kiá»ƒu tráº£ vá» Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh lÃ  <code>impl Summary</code> sáº½ khÃ´ng hoáº¡t Ä‘á»™ng:</p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">pub trait Summary {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct NewsArticle {
</span><span class="boring">    pub headline: String,
</span><span class="boring">    pub location: String,
</span><span class="boring">    pub author: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Summary for NewsArticle {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String {
</span><span class="boring">        format!("{}, by {} ({})", self.headline, self.author, self.location)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct SocialPost {
</span><span class="boring">    pub username: String,
</span><span class="boring">    pub content: String,
</span><span class="boring">    pub reply: bool,
</span><span class="boring">    pub repost: bool,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Summary for SocialPost {
</span><span class="boring">    fn summarize(&amp;self) -&gt; String {
</span><span class="boring">        format!("{}: {}", self.username, self.content)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn returns_summarizable(switch: bool) -&gt; impl Summary {
    if switch {
        NewsArticle {
            headline: String::from(
                "Penguins win the Stanley Cup Championship!",
            ),
            location: String::from("Pittsburgh, PA, USA"),
            author: String::from("Iceburgh"),
            content: String::from(
                "The Pittsburgh Penguins once again are the best \
                 hockey team in the NHL.",
            ),
        }
    } else {
        SocialPost {
            username: String::from("horse_ebooks"),
            content: String::from(
                "of course, as you probably already know, people",
            ),
            reply: false,
            repost: false,
        }
    }
}</code></pre>
<p>Viá»‡c tráº£ vá» hoáº·c má»™t <code>NewsArticle</code> hoáº·c má»™t <code>Tweet</code> khÃ´ng Ä‘Æ°á»£c phÃ©p do cÃ¡c háº¡n cháº¿ liÃªn quan Ä‘áº¿n cÃ¡ch cÃº phÃ¡p <code>impl Trait</code> Ä‘Æ°á»£c triá»ƒn khai trong trÃ¬nh biÃªn dá»‹ch. ChÃºng ta sáº½ Ä‘á» cáº­p cÃ¡ch viáº¿t má»™t hÃ m vá»›i hÃ nh vi nÃ y trong pháº§n <a href="ch17-02-trait-objects.html#using-trait-objects-that-allow-for-values-of-different-types">â€œSá»­ dá»¥ng Trait Objects cho cÃ¡c giÃ¡ trá»‹ cÃ³ kiá»ƒu khÃ¡c nhauâ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 17.</p>
<h3 id="sá»­-dá»¥ng-rÃ ng-buá»™c-trait-Ä‘á»ƒ-triá»ƒn-khai-phÆ°Æ¡ng-thá»©c-cÃ³-Ä‘iá»u-kiá»‡n"><a class="header" href="#sá»­-dá»¥ng-rÃ ng-buá»™c-trait-Ä‘á»ƒ-triá»ƒn-khai-phÆ°Æ¡ng-thá»©c-cÃ³-Ä‘iá»u-kiá»‡n">Sá»­ dá»¥ng rÃ ng buá»™c trait Ä‘á»ƒ triá»ƒn khai phÆ°Æ¡ng thá»©c cÃ³ Ä‘iá»u kiá»‡n</a></h3>
<p>Báº±ng cÃ¡ch sá»­ dá»¥ng rÃ ng buá»™c trait vá»›i má»™t khá»‘i <code>impl</code> sá»­ dá»¥ng tham sá»‘ kiá»ƒu generic, chÃºng ta cÃ³ thá»ƒ triá»ƒn khai phÆ°Æ¡ng thá»©c cÃ³ Ä‘iá»u kiá»‡n cho cÃ¡c kiá»ƒu thá»±c thi cÃ¡c trait Ä‘Ã£ chá»‰ Ä‘á»‹nh. VÃ­ dá»¥, kiá»ƒu <code>Pair&lt;T&gt;</code> trong Listing 10-15 luÃ´n triá»ƒn khai hÃ m <code>new</code> Ä‘á»ƒ tráº£ vá» má»™t thá»ƒ hiá»‡n má»›i cá»§a <code>Pair&lt;T&gt;</code> (nhá»› láº¡i tá»« pháº§n <a href="ch05-03-method-syntax.html#defining-methods">â€œÄá»‹nh nghÄ©a phÆ°Æ¡ng thá»©câ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 5 ráº±ng <code>Self</code> lÃ  bÃ­ danh cho kiá»ƒu cá»§a khá»‘i <code>impl</code>, trong trÆ°á»ng há»£p nÃ y lÃ  <code>Pair&lt;T&gt;</code>). NhÆ°ng trong khá»‘i <code>impl</code> tiáº¿p theo, <code>Pair&lt;T&gt;</code> chá»‰ triá»ƒn khai phÆ°Æ¡ng thá»©c <code>cmp_display</code> náº¿u kiá»ƒu bÃªn trong <code>T</code> thá»±c thi trait <code>PartialOrd</code> cho phÃ©p so sÃ¡nh <em>vÃ </em> trait <code>Display</code> cho phÃ©p in ra.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">use std::fmt::Display;

struct Pair&lt;T&gt; {
    x: T,
    y: T,
}

impl&lt;T&gt; Pair&lt;T&gt; {
    fn new(x: T, y: T) -&gt; Self {
        Self { x, y }
    }
}

impl&lt;T: Display + PartialOrd&gt; Pair&lt;T&gt; {
    fn cmp_display(&amp;self) {
        if self.x &gt;= self.y {
            println!("The largest member is x = {}", self.x);
        } else {
            println!("The largest member is y = {}", self.y);
        }
    }
}</code></pre>
<p><span class="caption">Listing 10-15: Triá»ƒn khai phÆ°Æ¡ng thá»©c cÃ³ Ä‘iá»u kiá»‡n trÃªn má»™t kiá»ƒu generic tÃ¹y thuá»™c vÃ o rÃ ng buá»™c trait</span></p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ triá»ƒn khai má»™t trait cÃ³ Ä‘iá»u kiá»‡n cho báº¥t ká»³ kiá»ƒu nÃ o thá»±c thi má»™t trait khÃ¡c. CÃ¡c triá»ƒn khai cá»§a má»™t trait trÃªn báº¥t ká»³ kiá»ƒu nÃ o thá»a mÃ£n cÃ¡c rÃ ng buá»™c trait Ä‘Æ°á»£c gá»i lÃ  <em>blanket implementations</em> vÃ  Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i trong thÆ° viá»‡n chuáº©n cá»§a Rust. VÃ­ dá»¥, thÆ° viá»‡n chuáº©n triá»ƒn khai trait <code>ToString</code> trÃªn báº¥t ká»³ kiá»ƒu nÃ o thá»±c thi trait <code>Display</code>. Khá»‘i <code>impl</code> trong thÆ° viá»‡n chuáº©n trÃ´ng tÆ°Æ¡ng tá»± nhÆ° Ä‘oáº¡n mÃ£ nÃ y:</p>
<pre><code class="language-rust ignore">impl&lt;T: Display&gt; ToString for T {
    // --snip--
}</code></pre>
<p>VÃ¬ thÆ° viá»‡n chuáº©n cÃ³ triá»ƒn khai blanket nÃ y, chÃºng ta cÃ³ thá»ƒ gá»i phÆ°Æ¡ng thá»©c <code>to_string</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a bá»Ÿi trait <code>ToString</code> trÃªn báº¥t ká»³ kiá»ƒu nÃ o thá»±c thi trait <code>Display</code>. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ chuyá»ƒn cÃ¡c sá»‘ nguyÃªn thÃ nh giÃ¡ trá»‹ <code>String</code> tÆ°Æ¡ng á»©ng nhÆ° sau vÃ¬ cÃ¡c sá»‘ nguyÃªn thá»±c thi <code>Display</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s = 3.to_string();
<span class="boring">}</span></code></pre></pre>
<p>CÃ¡c triá»ƒn khai blanket xuáº¥t hiá»‡n trong tÃ i liá»‡u cá»§a trait á»Ÿ pháº§n â€œImplementorsâ€.</p>
<p>Traits vÃ  rÃ ng buá»™c trait cho phÃ©p chÃºng ta viáº¿t code sá»­ dá»¥ng tham sá»‘ kiá»ƒu generic Ä‘á»ƒ giáº£m sá»± trÃ¹ng láº·p, Ä‘á»“ng thá»i chá»‰ Ä‘á»‹nh cho trÃ¬nh biÃªn dá»‹ch ráº±ng chÃºng ta muá»‘n kiá»ƒu generic cÃ³ hÃ nh vi cá»¥ thá»ƒ. TrÃ¬nh biÃªn dá»‹ch sau Ä‘Ã³ cÃ³ thá»ƒ sá»­ dá»¥ng thÃ´ng tin rÃ ng buá»™c trait Ä‘á»ƒ kiá»ƒm tra ráº±ng táº¥t cáº£ cÃ¡c kiá»ƒu cá»¥ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i code cá»§a chÃºng ta cung cáº¥p hÃ nh vi Ä‘Ãºng. Trong cÃ¡c ngÃ´n ngá»¯ kiá»ƒu Ä‘á»™ng, chÃºng ta sáº½ nháº­n lá»—i táº¡i thá»i Ä‘iá»ƒm cháº¡y náº¿u gá»i má»™t phÆ°Æ¡ng thá»©c trÃªn kiá»ƒu khÃ´ng Ä‘á»‹nh nghÄ©a phÆ°Æ¡ng thá»©c Ä‘Ã³. NhÆ°ng Rust chuyá»ƒn cÃ¡c lá»—i nÃ y sang thá»i Ä‘iá»ƒm biÃªn dá»‹ch, buá»™c chÃºng ta pháº£i sá»­a lá»—i trÆ°á»›c khi code cÃ³ thá»ƒ cháº¡y. ThÃªm vÃ o Ä‘Ã³, chÃºng ta khÃ´ng pháº£i viáº¿t code kiá»ƒm tra hÃ nh vi táº¡i thá»i Ä‘iá»ƒm cháº¡y vÃ¬ Ä‘Ã£ kiá»ƒm tra á»Ÿ thá»i Ä‘iá»ƒm biÃªn dá»‹ch. Viá»‡c nÃ y cáº£i thiá»‡n hiá»‡u nÄƒng mÃ  khÃ´ng pháº£i hy sinh tÃ­nh linh hoáº¡t cá»§a generic.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="xÃ¡c-thá»±c-references-vá»›i-lifetimes"><a class="header" href="#xÃ¡c-thá»±c-references-vá»›i-lifetimes">XÃ¡c thá»±c References vá»›i Lifetimes</a></h2>
<p>Lifetimes lÃ  má»™t loáº¡i generic khÃ¡c mÃ  chÃºng ta Ä‘Ã£ sá»­ dá»¥ng. Thay vÃ¬ Ä‘áº£m báº£o ráº±ng má»™t kiá»ƒu cÃ³ hÃ nh vi nhÆ° mong muá»‘n, lifetimes Ä‘áº£m báº£o ráº±ng cÃ¡c reference há»£p lá»‡ trong suá»‘t thá»i gian chÃºng ta cáº§n.</p>
<p>Má»™t chi tiáº¿t mÃ  chÃºng ta chÆ°a tháº£o luáº­n trong pháº§n <a href="ch04-02-references-and-borrowing.html#references-and-borrowing">â€œReferences and Borrowingâ€</a><!-- ignore --> á»Ÿ ChÆ°Æ¡ng 4 lÃ  má»—i reference trong Rust cÃ³ má»™t <em>lifetime</em>, tá»©c lÃ  pháº¡m vi mÃ  reference Ä‘Ã³ há»£p lá»‡. Pháº§n lá»›n thá»i gian, lifetimes lÃ  áº©n vÃ  Ä‘Æ°á»£c suy luáº­n, giá»‘ng nhÆ° háº§u háº¿t thá»i gian, cÃ¡c kiá»ƒu cÅ©ng Ä‘Æ°á»£c suy luáº­n. ChÃºng ta chá»‰ cáº§n chÃº thÃ­ch kiá»ƒu khi cÃ³ nhiá»u kiá»ƒu kháº£ thi. TÆ°Æ¡ng tá»±, chÃºng ta pháº£i chÃº thÃ­ch lifetimes khi cÃ¡c lifetimes cá»§a references cÃ³ thá»ƒ liÃªn quan theo nhiá»u cÃ¡ch khÃ¡c nhau. Rust yÃªu cáº§u chÃºng ta chÃº thÃ­ch cÃ¡c má»‘i quan há»‡ nÃ y báº±ng cÃ¡c tham sá»‘ lifetime generic Ä‘á»ƒ Ä‘áº£m báº£o cÃ¡c reference thá»±c táº¿ Ä‘Æ°á»£c sá»­ dá»¥ng táº¡i runtime cháº¯c cháº¯n há»£p lá»‡.</p>
<p>ChÃº thÃ­ch lifetimes tháº­m chÃ­ cÃ²n khÃ´ng pháº£i lÃ  má»™t khÃ¡i niá»‡m mÃ  háº§u háº¿t cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c cÃ³, vÃ¬ váº­y Ä‘iá»u nÃ y sáº½ cáº£m tháº¥y láº¡. Máº·c dÃ¹ chÃºng ta sáº½ khÃ´ng bao quÃ¡t toÃ n bá»™ lifetimes trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ tháº£o luáº­n cÃ¡c cÃ¡ch phá»• biáº¿n mÃ  báº¡n cÃ³ thá»ƒ gáº·p cÃº phÃ¡p lifetime Ä‘á»ƒ báº¡n quen vá»›i khÃ¡i niá»‡m nÃ y.</p>
<h3 id="ngÄƒn-ngá»«a-dangling-references-vá»›i-lifetimes"><a class="header" href="#ngÄƒn-ngá»«a-dangling-references-vá»›i-lifetimes">NgÄƒn ngá»«a Dangling References vá»›i Lifetimes</a></h3>
<p>Má»¥c tiÃªu chÃ­nh cá»§a lifetimes lÃ  ngÄƒn ngá»«a <em>dangling references</em>, lÃ  nhá»¯ng reference khiáº¿n chÆ°Æ¡ng trÃ¬nh tham chiáº¿u Ä‘áº¿n dá»¯ liá»‡u khÃ¡c dá»¯ liá»‡u mÃ  nÃ³ dá»± Ä‘á»‹nh tham chiáº¿u. Xem xÃ©t chÆ°Æ¡ng trÃ¬nh trong Listing 10-16, cÃ³ má»™t pháº¡m vi bÃªn ngoÃ i vÃ  má»™t pháº¡m vi bÃªn trong.</p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let r;

    {
        let x = 5;
        r = &amp;x;
    }

    println!("r: {r}");
}</code></pre>
<p><span class="caption">Listing 10-16: Má»™t ná»— lá»±c sá»­ dá»¥ng reference mÃ  giÃ¡ trá»‹ cá»§a nÃ³ Ä‘Ã£ ra khá»i pháº¡m vi</span></p>
<blockquote>
<p>LÆ°u Ã½: CÃ¡c vÃ­ dá»¥ trong Listings 10-16, 10-17 vÃ  10-23 khai bÃ¡o biáº¿n mÃ  khÃ´ng gÃ¡n giÃ¡ trá»‹ ban Ä‘áº§u, vÃ¬ váº­y tÃªn biáº¿n tá»“n táº¡i trong pháº¡m vi bÃªn ngoÃ i. NhÃ¬n sÆ¡ qua, Ä‘iá»u nÃ y cÃ³ váº» mÃ¢u thuáº«n vá»›i viá»‡c Rust khÃ´ng cÃ³ giÃ¡ trá»‹ null. Tuy nhiÃªn, náº¿u chÃºng ta cá»‘ sá»­ dá»¥ng má»™t biáº¿n trÆ°á»›c khi gÃ¡n giÃ¡ trá»‹, chÃºng ta sáº½ nháº­n lá»—i táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch, Ä‘iá»u nÃ y chá»©ng tá» Rust thá»±c sá»± khÃ´ng cho phÃ©p giÃ¡ trá»‹ null.</p>
</blockquote>
<p>Pháº¡m vi bÃªn ngoÃ i khai bÃ¡o má»™t biáº¿n tÃªn <code>r</code> mÃ  khÃ´ng cÃ³ giÃ¡ trá»‹ ban Ä‘áº§u, vÃ  pháº¡m vi bÃªn trong khai bÃ¡o má»™t biáº¿n tÃªn <code>x</code> vá»›i giÃ¡ trá»‹ khá»Ÿi táº¡o lÃ  5. BÃªn trong pháº¡m vi bÃªn trong, chÃºng ta cá»‘ gáº¯ng gÃ¡n giÃ¡ trá»‹ cá»§a <code>r</code> lÃ m reference tá»›i <code>x</code>. Sau Ä‘Ã³ pháº¡m vi bÃªn trong káº¿t thÃºc, vÃ  chÃºng t</p>
<pre><code class="language-console">$ cargo run
   Compiling chapter10 v0.1.0 (file:///projects/chapter10)
error[E0597]: `x` does not live long enough
 --&gt; src/main.rs:6:13
  |
5 |         let x = 5;
  |             - binding `x` declared here
6 |         r = &amp;x;
  |             ^^ borrowed value does not live long enough
7 |     }
  |     - `x` dropped here while still borrowed
8 |
9 |     println!("r: {r}");
  |                  --- borrow later used here

For more information about this error, try `rustc --explain E0597`.
error: could not compile `chapter10` (bin "chapter10") due to 1 previous error
</code></pre>
<p>Variable <code>x</code> khÃ´ng â€œsá»‘ng Ä‘á»§ lÃ¢uâ€ (live long enough). LÃ½ do lÃ  <code>x</code> sáº½ ra khá»i scope khi inner scope káº¿t thÃºc á»Ÿ line 7. NhÆ°ng <code>r</code> váº«n há»£p lá»‡ trong outer scope; vÃ¬ pháº¡m vi cá»§a nÃ³ lá»›n hÆ¡n, ta nÃ³i ráº±ng nÃ³ â€œsá»‘ng lÃ¢u hÆ¡nâ€ (lives longer). Náº¿u Rust cho phÃ©p code nÃ y cháº¡y, <code>r</code> sáº½ tham chiáº¿u Ä‘áº¿n memory Ä‘Ã£ bá»‹ giáº£i phÃ³ng khi <code>x</code> ra khá»i scope, vÃ  má»i thao tÃ¡c vá»›i <code>r</code> sáº½ khÃ´ng Ä‘Ãºng. Váº­y Rust lÃ m sao biáº¿t code nÃ y khÃ´ng há»£p lá»‡? NÃ³ dÃ¹ng borrow checker.</p>
<h3 id="the-borrow-checker"><a class="header" href="#the-borrow-checker">The Borrow Checker</a></h3>
<p>Compiler cá»§a Rust cÃ³ má»™t <em>borrow checker</em> dÃ¹ng Ä‘á»ƒ so sÃ¡nh cÃ¡c scope vÃ  xÃ¡c Ä‘á»‹nh xem táº¥t cáº£ cÃ¡c borrow cÃ³ há»£p lá»‡ hay khÃ´ng. Listing 10-17 hiá»ƒn thá»‹ cÃ¹ng Ä‘oáº¡n code vá»›i Listing 10-16 nhÆ°ng cÃ³ chÃº thÃ­ch thá»ƒ hiá»‡n lifetimes cá»§a cÃ¡c biáº¿n.</p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let r;                // ---------+-- 'a
                          //          |
    {                     //          |
        let x = 5;        // -+-- 'b  |
        r = &amp;x;           //  |       |
    }                     // -+       |
                          //          |
    println!("r: {r}");   //          |
}                         // ---------+</code></pre>
<p><span class="caption">Listing 10-17: ChÃº thÃ­ch lifetimes cá»§a <code>r</code> vÃ  <code>x</code>, láº§n lÆ°á»£t lÃ  <code>'a</code> vÃ  <code>'b</code></span></p>
<p>á» Ä‘Ã¢y, chÃºng ta Ä‘Ã£ chÃº thÃ­ch lifetime cá»§a <code>r</code> vá»›i <code>'a</code> vÃ  lifetime cá»§a <code>x</code> vá»›i <code>'b</code>. NhÆ° báº¡n tháº¥y, block <code>'b</code> bÃªn trong nhá» hÆ¡n nhiá»u so vá»›i block <code>'a</code> bÃªn ngoÃ i. Táº¡i thá»i Ä‘iá»ƒm compile, Rust so sÃ¡nh kÃ­ch thÆ°á»›c cá»§a hai lifetime vÃ  nháº­n tháº¥y <code>r</code> cÃ³ lifetime <code>'a</code> nhÆ°ng tham chiáº¿u tá»›i memory cÃ³ lifetime <code>'b</code>. ChÆ°Æ¡ng trÃ¬nh bá»‹ tá»« chá»‘i vÃ¬ <code>'b</code> ngáº¯n hÆ¡n <code>'a</code>: giÃ¡ trá»‹ mÃ  reference trá» tá»›i khÃ´ng sá»‘ng lÃ¢u báº±ng reference.</p>
<p>Listing 10-18 sá»­a code Ä‘á»ƒ khÃ´ng cÃ²n dangling reference vÃ  compile mÃ  khÃ´ng cÃ³ lá»—i.</p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let x = 5;            // ----------+-- 'b
                          //           |
    let r = &amp;x;           // --+-- 'a  |
                          //   |       |
    println!("r: {r}");   //   |       |
                          // --+       |
}                         // ----------+</code></pre></pre>
<p><span class="caption">Listing 10-18: Má»™t reference há»£p lá»‡ vÃ¬ dá»¯ liá»‡u cÃ³ lifetime dÃ i hÆ¡n reference</span></p>
<p>á» Ä‘Ã¢y, <code>x</code> cÃ³ lifetime <code>'b</code>, trong trÆ°á»ng há»£p nÃ y lá»›n hÆ¡n <code>'a</code>. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  <code>r</code> cÃ³ thá»ƒ tham chiáº¿u tá»›i <code>x</code> vÃ¬ Rust biáº¿t reference trong <code>r</code> sáº½ luÃ´n há»£p lá»‡ khi <code>x</code> cÃ²n há»£p lá»‡.</p>
<p>BÃ¢y giá», khi báº¡n Ä‘Ã£ hiá»ƒu nÆ¡i lifetimes cá»§a cÃ¡c reference náº±m vÃ  cÃ¡ch Rust phÃ¢n tÃ­ch lifetimes Ä‘á»ƒ Ä‘áº£m báº£o reference luÃ´n há»£p lá»‡, hÃ£y cÃ¹ng khÃ¡m phÃ¡ generic lifetimes cá»§a tham sá»‘ vÃ  giÃ¡ trá»‹ tráº£ vá» trong ngá»¯ cáº£nh cá»§a cÃ¡c hÃ m.</p>
<h3 id="generic-lifetimes-trong-functions"><a class="header" href="#generic-lifetimes-trong-functions">Generic Lifetimes trong Functions</a></h3>
<p>ChÃºng ta sáº½ viáº¿t má»™t hÃ m tráº£ vá» string slice dÃ i hÆ¡n trong hai string slice. HÃ m nÃ y sáº½ nháº­n hai string slice vÃ  tráº£ vá» má»™t string slice duy nháº¥t. Sau khi triá»ƒn khai hÃ m <code>longest</code>, code trong Listing 10-19 sáº½ in ra <code>The longest string is abcd</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">fn main() {
    let string1 = String::from("abcd");
    let string2 = "xyz";

    let result = longest(string1.as_str(), string2);
    println!("The longest string is {result}");
}</code></pre>
<p><span class="caption">Listing 10-19: Má»™t hÃ m <code>main</code> gá»i hÃ m <code>longest</code> Ä‘á»ƒ tÃ¬m string slice dÃ i hÆ¡n trong hai string slice</span></p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta muá»‘n hÃ m nháº­n string slices, lÃ  references, thay vÃ¬ strings, vÃ¬ chÃºng ta khÃ´ng muá»‘n hÃ m <code>longest</code> chiáº¿m quyá»n sá»Ÿ há»¯u cÃ¡c tham sá»‘. Tham kháº£o pháº§n <a href="ch04-03-slices.html#string-slices-as-parameters">â€œString Slices as Parametersâ€</a><!-- ignore --> trong ChÆ°Æ¡ng 4 Ä‘á»ƒ tÃ¬m hiá»ƒu thÃªm lÃ½ do táº¡i sao cÃ¡c tham sá»‘ trong Listing 10-19 lÃ  nhá»¯ng tham sá»‘ chÃºng ta muá»‘n sá»­ dá»¥ng.</p>
<p>Náº¿u cá»‘ gáº¯ng triá»ƒn khai hÃ m <code>longest</code> nhÆ° trong Listing 10-20, code sáº½ khÃ´ng compile.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span><span class="boring">    let string1 = String::from("abcd");
</span><span class="boring">    let string2 = "xyz";
</span><span class="boring">
</span><span class="boring">    let result = longest(string1.as_str(), string2);
</span><span class="boring">    println!("The longest string is {result}");
</span><span class="boring">}
</span><span class="boring">
</span>fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str {
    if x.len() &gt; y.len() { x } else { y }
}</code></pre>
<p><span class="caption">Listing 10-20: Má»™t triá»ƒn khai cá»§a hÃ m <code>longest</code> tráº£ vá» string slice dÃ i hÆ¡n trong hai string slice nhÆ°ng chÆ°a compile</span></p>
<p>Thay vÃ o Ä‘Ã³, chÃºng ta nháº­n Ä‘Æ°á»£c lá»—i sau liÃªn quan Ä‘áº¿n lifetimes:</p>
<pre><code class="language-console">$ cargo run
   Compiling chapter10 v0.1.0 (file:///projects/chapter10)
error[E0106]: missing lifetime specifier
 --&gt; src/main.rs:9:33
  |
9 | fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str {
  |               ----     ----     ^ expected named lifetime parameter
  |
  = help: this function's return type contains a borrowed value, but the signature does not say whether it is borrowed from `x` or `y`
help: consider introducing a named lifetime parameter
  |
9 | fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;'a str) -&gt; &amp;'a str {
  |           ++++     ++          ++          ++

For more information about this error, try `rustc --explain E0106`.
error: could not compile `chapter10` (bin "chapter10") due to 1 previous error
</code></pre>
<p>HÆ°á»›ng dáº«n lá»—i cho tháº¥y kiá»ƒu tráº£ vá» cáº§n má»™t generic lifetime parameter vÃ¬ Rust khÃ´ng biáº¿t reference Ä‘Æ°á»£c tráº£ vá» trá» tá»›i <code>x</code> hay <code>y</code>. Thá»±c ra, chÃºng ta cÅ©ng khÃ´ng biáº¿t, vÃ¬ block <code>if</code> trong thÃ¢n hÃ m tráº£ vá» reference tá»›i <code>x</code> vÃ  block <code>else</code> tráº£ vá» reference tá»›i <code>y</code>!</p>
<p>Khi Ä‘á»‹nh nghÄ©a hÃ m nÃ y, chÃºng ta khÃ´ng biáº¿t cÃ¡c giÃ¡ trá»‹ cá»¥ thá»ƒ sáº½ Ä‘Æ°á»£c truyá»n vÃ o hÃ m, nÃªn khÃ´ng biáº¿t block <code>if</code> hay <code>else</code> sáº½ Ä‘Æ°á»£c thá»±c thi. ChÃºng ta cÅ©ng khÃ´ng biáº¿t concrete lifetimes cá»§a cÃ¡c reference Ä‘Æ°á»£c truyá»n vÃ o, nÃªn khÃ´ng thá»ƒ quan sÃ¡t cÃ¡c scope nhÆ° trong Listings 10-17 vÃ  10-18 Ä‘á»ƒ xÃ¡c Ä‘á»‹nh reference tráº£ vá» cÃ³ luÃ´n há»£p lá»‡ hay khÃ´ng. Borrow checker cÅ©ng khÃ´ng thá»ƒ xÃ¡c Ä‘á»‹nh, vÃ¬ nÃ³ khÃ´ng biáº¿t lifetimes cá»§a <code>x</code> vÃ  <code>y</code> liÃªn quan tháº¿ nÃ o tá»›i lifetime cá»§a giÃ¡ trá»‹ tráº£ vá». Äá»ƒ sá»­a lá»—i nÃ y, chÃºng ta sáº½ thÃªm generic lifetime parameters Ä‘á»ƒ Ä‘á»‹nh nghÄ©a má»‘i quan há»‡ giá»¯a cÃ¡c reference, giÃºp borrow checker thá»±c hiá»‡n phÃ¢n tÃ­ch.</p>
<h3 id="lifetime-annotation-syntax"><a class="header" href="#lifetime-annotation-syntax">Lifetime Annotation Syntax</a></h3>
<p>Lifetime annotations khÃ´ng thay Ä‘á»•i thá»i gian sá»‘ng (lifetime) cá»§a báº¥t ká»³ reference nÃ o. Thay vÃ o Ä‘Ã³, chÃºng mÃ´ táº£ má»‘i quan há»‡ giá»¯a lifetimes cá»§a nhiá»u reference vá»›i nhau mÃ  khÃ´ng áº£nh hÆ°á»Ÿng tá»›i lifetimes. CÅ©ng nhÆ° hÃ m cÃ³ thá»ƒ nháº­n báº¥t ká»³ kiá»ƒu nÃ o khi chá»¯ kÃ½ khai bÃ¡o generic type parameter, hÃ m cÃ³ thá»ƒ nháº­n reference vá»›i báº¥t ká»³ lifetime nÃ o báº±ng cÃ¡ch khai bÃ¡o generic lifetime parameter.</p>
<p>Lifetime annotations cÃ³ cÃº phÃ¡p hÆ¡i khÃ¡c thÆ°á»ng: tÃªn cÃ¡c lifetime parameter pháº£i báº¯t Ä‘áº§u báº±ng apostrophe (<code>'</code>) vÃ  thÆ°á»ng viáº¿t thÆ°á»ng, ngáº¯n, giá»‘ng nhÆ° generic types. Háº§u háº¿t má»i ngÆ°á»i dÃ¹ng <code>'a</code> cho lifetime annotation Ä‘áº§u tiÃªn. ChÃºng ta Ä‘áº·t lifetime parameter annotation sau <code>&amp;</code> cá»§a reference, dÃ¹ng khoáº£ng tráº¯ng Ä‘á»ƒ tÃ¡ch annotation khá»i type cá»§a reference.</p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ vÃ­ dá»¥: reference tá»›i <code>i32</code> mÃ  khÃ´ng cÃ³ lifetime parameter, reference tá»›i <code>i32</code> cÃ³ lifetime parameter tÃªn <code>'a</code>, vÃ  mutable reference tá»›i <code>i32</code> cÅ©ng cÃ³ lifetime <code>'a</code>.</p>
<pre><code class="language-rust ignore">&amp;i32        // a reference
&amp;'a i32     // a reference with an explicit lifetime
&amp;'a mut i32 // a mutable reference with an explicit lifetime</code></pre>
<p>Má»™t lifetime annotation Ä‘Æ¡n láº» khÃ´ng cÃ³ nhiá»u Ã½ nghÄ©a, vÃ¬ cÃ¡c annotation nÃ y nháº±m chá»‰ cho Rust cÃ¡ch cÃ¡c generic lifetime parameter cá»§a nhiá»u reference liÃªn quan vá»›i nhau. HÃ£y xem cÃ¡ch cÃ¡c lifetime annotation liÃªn quan trong ngá»¯ cáº£nh cá»§a hÃ m <code>longest</code>.</p>
<h3 id="lifetime-annotations-trong-function-signatures"><a class="header" href="#lifetime-annotations-trong-function-signatures">Lifetime Annotations trong Function Signatures</a></h3>
<p>Äá»ƒ sá»­ dá»¥ng lifetime annotations trong chá»¯ kÃ½ hÃ m, chÃºng ta cáº§n khai bÃ¡o cÃ¡c generic <em>lifetime</em> parameters trong dáº¥u ngoáº·c nhá»n giá»¯a tÃªn hÃ m vÃ  danh sÃ¡ch tham sá»‘, giá»‘ng nhÆ° cÃ¡ch chÃºng ta lÃ m vá»›i cÃ¡c generic <em>type</em> parameters.</p>
<p>ChÃºng ta muá»‘n chá»¯ kÃ½ biá»ƒu diá»…n rÃ ng buá»™c sau: reference tráº£ vá» sáº½ há»£p lá»‡ chá»«ng nÃ o cáº£ hai tham sá»‘ cÃ²n há»£p lá»‡. ÄÃ¢y lÃ  má»‘i quan há»‡ giá»¯a lifetimes cá»§a cÃ¡c tham sá»‘ vÃ  giÃ¡ trá»‹ tráº£ vá». ChÃºng ta sáº½ Ä‘áº·t tÃªn lifetime lÃ  <code>'a</code> vÃ  thÃªm nÃ³ vÃ o tá»«ng reference, nhÆ° trong Listing 10-21.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span><span class="boring">    let string1 = String::from("abcd");
</span><span class="boring">    let string2 = "xyz";
</span><span class="boring">
</span><span class="boring">    let result = longest(string1.as_str(), string2);
</span><span class="boring">    println!("The longest string is {result}");
</span><span class="boring">}
</span><span class="boring">
</span>fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;'a str) -&gt; &amp;'a str {
    if x.len() &gt; y.len() { x } else { y }
}</code></pre></pre>
<p><span class="caption">Listing 10-21: Äá»‹nh nghÄ©a hÃ m <code>longest</code> chá»‰ Ä‘á»‹nh ráº±ng táº¥t cáº£ reference trong chá»¯ kÃ½ pháº£i cÃ³ cÃ¹ng lifetime <code>'a</code></span></p>
<p>Code nÃ y sáº½ compile vÃ  cho káº¿t quáº£ nhÆ° mong muá»‘n khi sá»­ dá»¥ng vá»›i hÃ m <code>main</code> trong Listing 10-19.</p>
<p>Chá»¯ kÃ½ hÃ m bÃ¢y giá» cho Rust biáº¿t ráº±ng vá»›i má»™t lifetime <code>'a</code>, hÃ m nháº­n hai tham sá»‘, cáº£ hai Ä‘á»u lÃ  string slices sá»‘ng Ã­t nháº¥t báº±ng lifetime <code>'a</code>. Chá»¯ kÃ½ hÃ m cÅ©ng cho Rust biáº¿t ráº±ng string slice Ä‘Æ°á»£c tráº£ vá» tá»« hÃ m sáº½ sá»‘ng Ã­t nháº¥t báº±ng lifetime <code>'a</code>. Thá»±c táº¿, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  lifetime cá»§a reference tráº£ vá» bá»Ÿi hÃ m <code>longest</code> sáº½ báº±ng lifetime nhá» hÆ¡n trong hai lifetimes cá»§a cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c tham chiáº¿u bá»Ÿi cÃ¡c tham sá»‘ cá»§a hÃ m. ÄÃ¢y lÃ  má»‘i quan há»‡ mÃ  chÃºng ta muá»‘n Rust sá»­ dá»¥ng khi phÃ¢n tÃ­ch code nÃ y.</p>
<p>HÃ£y nhá»› ráº±ng, khi chÃºng ta chá»‰ Ä‘á»‹nh cÃ¡c lifetime parameters trong chá»¯ kÃ½ hÃ m nÃ y, chÃºng ta khÃ´ng thay Ä‘á»•i lifetime cá»§a báº¥t ká»³ giÃ¡ trá»‹ nÃ o Ä‘Æ°á»£c truyá»n vÃ o hoáº·c tráº£ vá». Thay vÃ o Ä‘Ã³, chÃºng ta chá»‰ Ä‘á»‹nh ráº±ng borrow checker sáº½ tá»« chá»‘i báº¥t ká»³ giÃ¡ trá»‹ nÃ o khÃ´ng tuÃ¢n thá»§ cÃ¡c rÃ ng buá»™c nÃ y. LÆ°u Ã½ ráº±ng hÃ m <code>longest</code> khÃ´ng cáº§n biáº¿t chÃ­nh xÃ¡c <code>x</code> vÃ  <code>y</code> sáº½ sá»‘ng bao lÃ¢u, chá»‰ cáº§n biáº¿t ráº±ng má»™t scope nÃ o Ä‘Ã³ cÃ³ thá»ƒ thay tháº¿ cho <code>'a</code> Ä‘á»ƒ thá»a mÃ£n chá»¯ kÃ½ nÃ y.</p>
<p>Khi chÃº thÃ­ch lifetimes trong functions, cÃ¡c annotation Ä‘áº·t trong chá»¯ kÃ½ hÃ m, khÃ´ng pháº£i trong thÃ¢n hÃ m. CÃ¡c lifetime annotation trá»Ÿ thÃ nh má»™t pháº§n cá»§a há»£p Ä‘á»“ng cá»§a hÃ m, giá»‘ng nhÆ° cÃ¡c kiá»ƒu trong chá»¯ kÃ½. Viá»‡c chá»¯ kÃ½ hÃ m chá»©a há»£p Ä‘á»“ng vá» lifetime giÃºp Rust compiler phÃ¢n tÃ­ch code dá»… dÃ ng hÆ¡n. Náº¿u cÃ³ váº¥n Ä‘á» vá»›i cÃ¡ch má»™t hÃ m Ä‘Æ°á»£c annotation hoáº·c cÃ¡ch nÃ³ Ä‘Æ°á»£c gá»i, lá»—i cá»§a compiler sáº½ chá»‰ ra chÃ­nh xÃ¡c pháº§n code vÃ  cÃ¡c rÃ ng buá»™c. Náº¿u Rust compiler tá»± suy luáº­n nhiá»u hÆ¡n vá» má»‘i quan há»‡ cÃ¡c lifetime, compiler cÃ³ thá»ƒ chá»‰ ra lá»—i cÃ¡ch nguyÃªn nhÃ¢n nhiá»u bÆ°á»›c, khÃ³ xÃ¡c Ä‘á»‹nh.</p>
<p>Khi truyá»n cÃ¡c reference cá»¥ thá»ƒ vÃ o <code>longest</code>, lifetime cá»¥ thá»ƒ thay tháº¿ cho <code>'a</code> lÃ  pháº§n scope cá»§a <code>x</code> chá»“ng láº¥n vá»›i scope cá»§a <code>y</code>. NÃ³i cÃ¡ch khÃ¡c, generic lifetime <code>'a</code> sáº½ nháº­n lifetime cá»¥ thá»ƒ báº±ng lifetime nhá» hÆ¡n giá»¯a <code>x</code> vÃ  <code>y</code>. VÃ¬ chÃºng ta Ä‘Ã£ chÃº thÃ­ch reference tráº£ vá» vá»›i cÃ¹ng lifetime <code>'a</code>, reference tráº£ vá» cÅ©ng sáº½ há»£p lá»‡ trong khoáº£ng thá»i gian báº±ng lifetime nhá» hÆ¡n giá»¯a <code>x</code> vÃ  <code>y</code>.</p>
<p>HÃ£y xem cÃ¡ch cÃ¡c lifetime annotation giá»›i háº¡n hÃ m <code>longest</code> khi truyá»n vÃ o cÃ¡c reference cÃ³ lifetimes khÃ¡c nhau. Listing 10-22 lÃ  má»™t vÃ­ dá»¥ Ä‘Æ¡n giáº£n.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let string1 = String::from("long string is long");

    {
        let string2 = String::from("xyz");
        let result = longest(string1.as_str(), string2.as_str());
        println!("The longest string is {result}");
    }
}
<span class="boring">
</span><span class="boring">fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;'a str) -&gt; &amp;'a str {
</span><span class="boring">    if x.len() &gt; y.len() { x } else { y }
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 10-22: Sá»­ dá»¥ng hÃ m <code>longest</code> vá»›i cÃ¡c reference tá»›i cÃ¡c giÃ¡ trá»‹ <code>String</code> cÃ³ lifetimes cá»¥ thá»ƒ khÃ¡c nhau</span></p>
<p>Trong vÃ­ dá»¥ nÃ y, <code>string1</code> há»£p lá»‡ cho Ä‘áº¿n cuá»‘i outer scope, <code>string2</code> há»£p lá»‡ cho Ä‘áº¿n cuá»‘i inner scope, vÃ  <code>result</code> tham chiáº¿u tá»›i má»™t giÃ¡ trá»‹ há»£p lá»‡ cho Ä‘áº¿n cuá»‘i inner scope. Cháº¡y code nÃ y, báº¡n sáº½ tháº¥y borrow checker cháº¥p nháº­n; code sáº½ compile vÃ  in ra <code>The longest string is long string is long</code>.</p>
<p>Tiáº¿p theo, hÃ£y thá»­ má»™t vÃ­ dá»¥ cho tháº¥y lifetime cá»§a reference trong <code>result</code> pháº£i lÃ  lifetime nhá» hÆ¡n trong hai tham sá»‘. ChÃºng ta sáº½ chuyá»ƒn khai bÃ¡o biáº¿n <code>result</code> ra ngoÃ i inner scope nhÆ°ng váº«n Ä‘á»ƒ viá»‡c gÃ¡n giÃ¡ trá»‹ cho <code>result</code> bÃªn trong scope vá»›i <code>string2</code>. Sau Ä‘Ã³, chÃºng ta sáº½ di chuyá»ƒn <code>println!</code> sá»­ dá»¥ng <code>result</code> ra ngoÃ i inner scope, sau khi inner scope káº¿t thÃºc. Code trong Listing 10-23 sáº½ khÃ´ng compile.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let string1 = String::from("long string is long");
    let result;
    {
        let string2 = String::from("xyz");
        result = longest(string1.as_str(), string2.as_str());
    }
    println!("The longest string is {result}");
}
<span class="boring">
</span><span class="boring">fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;'a str) -&gt; &amp;'a str {
</span><span class="boring">    if x.len() &gt; y.len() { x } else { y }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 10-23: Cá»‘ gáº¯ng sá»­ dá»¥ng <code>result</code> sau khi <code>string2</code> Ä‘Ã£ ra khá»i scope</span></p>
<p>Khi cá»‘ compile code nÃ y, chÃºng ta nháº­n Ä‘Æ°á»£c lá»—i sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling chapter10 v0.1.0 (file:///projects/chapter10)
error[E0597]: `string2` does not live long enough
 --&gt; src/main.rs:6:44
  |
5 |         let string2 = String::from("xyz");
  |             ------- binding `string2` declared here
6 |         result = longest(string1.as_str(), string2.as_str());
  |                                            ^^^^^^^ borrowed value does not live long enough
7 |     }
  |     - `string2` dropped here while still borrowed
8 |     println!("The longest string is {result}");
  |                                     -------- borrow later used here

For more information about this error, try `rustc --explain E0597`.
error: could not compile `chapter10` (bin "chapter10") due to 1 previous error
</code></pre>
<p>Lá»—i cho tháº¥y Ä‘á»ƒ <code>result</code> há»£p lá»‡ cho cÃ¢u lá»‡nh <code>println!</code>, <code>string2</code> cáº§n pháº£i há»£p lá»‡ cho Ä‘áº¿n cuá»‘i outer scope. Rust biáº¿t Ä‘iá»u nÃ y vÃ¬ chÃºng ta Ä‘Ã£ chÃº thÃ­ch lifetimes cá»§a cÃ¡c tham sá»‘ vÃ  giÃ¡ trá»‹ tráº£ vá» cá»§a hÃ m báº±ng cÃ¹ng lifetime parameter <code>'a</code>.</p>
<p>LÃ  con ngÆ°á»i, chÃºng ta cÃ³ thá»ƒ nhÃ¬n vÃ o code nÃ y vÃ  tháº¥y ráº±ng <code>string1</code> dÃ i hÆ¡n <code>string2</code>, do Ä‘Ã³ <code>result</code> sáº½ chá»©a reference tá»›i <code>string1</code>. VÃ¬ <code>string1</code> váº«n chÆ°a ra khá»i scope, reference tá»›i <code>string1</code> sáº½ há»£p lá»‡ cho cÃ¢u lá»‡nh <code>println!</code>. Tuy nhiÃªn, compiler khÃ´ng thá»ƒ tháº¥y reference nÃ y há»£p lá»‡ trong trÆ°á»ng há»£p nÃ y. ChÃºng ta Ä‘Ã£ nÃ³i vá»›i Rust ráº±ng lifetime cá»§a reference tráº£ vá» tá»« hÃ m <code>longest</code> báº±ng lifetime nhá» hÆ¡n trong hai reference Ä‘Æ°á»£c truyá»n vÃ o. Do Ä‘Ã³, borrow checker sáº½ khÃ´ng cho phÃ©p code trong Listing 10-23 vÃ¬ cÃ³ kháº£ nÄƒng chá»©a reference khÃ´ng há»£p lá»‡.</p>
<p>HÃ£y thá»­ thiáº¿t káº¿ thÃªm cÃ¡c thÃ­ nghiá»‡m thay Ä‘á»•i giÃ¡ trá»‹ vÃ  lifetimes cá»§a cÃ¡c reference Ä‘Æ°á»£c truyá»n vÃ o hÃ m <code>longest</code> vÃ  cÃ¡ch reference tráº£ vá» Ä‘Æ°á»£c sá»­ dá»¥ng. ÄÆ°a ra giáº£ thuyáº¿t vá» viá»‡c thÃ­ nghiá»‡m cÃ³ vÆ°á»£t qua borrow checker hay khÃ´ng trÆ°á»›c khi compile; sau Ä‘Ã³ kiá»ƒm tra xem báº¡n cÃ³ Ä‘Ãºng khÃ´ng!</p>
<h3 id="nghÄ©-theo-hÆ°á»›ng-lifetimes"><a class="header" href="#nghÄ©-theo-hÆ°á»›ng-lifetimes">NghÄ© theo hÆ°á»›ng Lifetimes</a></h3>
<p>CÃ¡ch báº¡n cáº§n chá»‰ Ä‘á»‹nh lifetime parameters phá»¥ thuá»™c vÃ o viá»‡c hÃ m cá»§a báº¡n lÃ m gÃ¬. VÃ­ dá»¥, náº¿u chÃºng ta thay Ä‘á»•i implementation cá»§a hÃ m <code>longest</code> Ä‘á»ƒ luÃ´n tráº£ vá» tham sá»‘ Ä‘áº§u tiÃªn thay vÃ¬ string slice dÃ i nháº¥t, chÃºng ta sáº½ khÃ´ng cáº§n chá»‰ Ä‘á»‹nh lifetime cho tham sá»‘ <code>y</code>. Code</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span><span class="boring">    let string1 = String::from("abcd");
</span><span class="boring">    let string2 = "efghijklmnopqrstuvwxyz";
</span><span class="boring">
</span><span class="boring">    let result = longest(string1.as_str(), string2);
</span><span class="boring">    println!("The longest string is {result}");
</span><span class="boring">}
</span><span class="boring">
</span>fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;str) -&gt; &amp;'a str {
    x
}</code></pre></pre>
<p>ChÃºng ta Ä‘Ã£ chá»‰ Ä‘á»‹nh lifetime parameter <code>'a</code> cho tham sá»‘ <code>x</code> vÃ  kiá»ƒu tráº£ vá», nhÆ°ng khÃ´ng cho tham sá»‘ <code>y</code>, vÃ¬ lifetime cá»§a <code>y</code> khÃ´ng cÃ³ má»‘i quan há»‡ nÃ o vá»›i lifetime cá»§a <code>x</code> hoáº·c giÃ¡ trá»‹ tráº£ vá».</p>
<p>Khi tráº£ vá» má»™t reference tá»« má»™t hÃ m, lifetime parameter cá»§a kiá»ƒu tráº£ vá» cáº§n khá»›p vá»›i lifetime parameter cá»§a má»™t trong cÃ¡c tham sá»‘. Náº¿u reference tráº£ vá» <em>khÃ´ng</em> tham chiáº¿u tá»›i má»™t trong cÃ¡c tham sá»‘, nÃ³ pháº£i tham chiáº¿u tá»›i má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c táº¡o bÃªn trong hÃ m nÃ y. Tuy nhiÃªn, Ä‘iá»u nÃ y sáº½ táº¡o ra dangling reference vÃ¬ giÃ¡ trá»‹ sáº½ ra khá»i scope khi hÃ m káº¿t thÃºc. Xem xÃ©t triá»ƒn khai hÃ m <code>longest</code> dÆ°á»›i Ä‘Ã¢y sáº½ khÃ´ng compile:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span><span class="boring">    let string1 = String::from("abcd");
</span><span class="boring">    let string2 = "xyz";
</span><span class="boring">
</span><span class="boring">    let result = longest(string1.as_str(), string2);
</span><span class="boring">    println!("The longest string is {result}");
</span><span class="boring">}
</span><span class="boring">
</span>fn longest&lt;'a&gt;(x: &amp;str, y: &amp;str) -&gt; &amp;'a str {
    let result = String::from("really long string");
    result.as_str()
}</code></pre>
<p>á» Ä‘Ã¢y, máº·c dÃ¹ chÃºng ta Ä‘Ã£ chá»‰ Ä‘á»‹nh lifetime parameter <code>'a</code> cho kiá»ƒu tráº£ vá», implementation nÃ y váº«n khÃ´ng compile vÃ¬ lifetime cá»§a giÃ¡ trá»‹ tráº£ vá» khÃ´ng liÃªn quan gÃ¬ Ä‘áº¿n lifetime cá»§a cÃ¡c tham sá»‘. DÆ°á»›i Ä‘Ã¢y lÃ  thÃ´ng bÃ¡o lá»—i mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c:</p>
<pre><code class="language-console">$ cargo run
   Compiling chapter10 v0.1.0 (file:///projects/chapter10)
error[E0515]: cannot return value referencing local variable `result`
  --&gt; src/main.rs:11:5
   |
11 |     result.as_str()
   |     ------^^^^^^^^^
   |     |
   |     returns a value referencing data owned by the current function
   |     `result` is borrowed here

For more information about this error, try `rustc --explain E0515`.
error: could not compile `chapter10` (bin "chapter10") due to 1 previous error
</code></pre>
<p>Váº¥n Ä‘á» lÃ  <code>result</code> ra khá»i scope vÃ  bá»‹ giáº£i phÃ³ng khi hÃ m <code>longest</code> káº¿t thÃºc. ChÃºng ta láº¡i cá»‘ gáº¯ng tráº£ vá» reference tá»›i <code>result</code> tá»« hÃ m. KhÃ´ng cÃ³ cÃ¡ch nÃ o chá»‰ Ä‘á»‹nh lifetime parameters Ä‘á»ƒ thay Ä‘á»•i dangling reference nÃ y, vÃ  Rust sáº½ khÃ´ng cho phÃ©p táº¡o dangling reference. Trong trÆ°á»ng há»£p nÃ y, cÃ¡ch sá»­a tá»‘t nháº¥t lÃ  tráº£ vá» má»™t kiá»ƒu dá»¯ liá»‡u owned thay vÃ¬ reference, Ä‘á»ƒ hÃ m gá»i chá»‹u trÃ¡ch nhiá»‡m giáº£i phÃ³ng giÃ¡ trá»‹.</p>
<p>Cuá»‘i cÃ¹ng, cÃº phÃ¡p lifetime lÃ  Ä‘á»ƒ káº¿t ná»‘i cÃ¡c lifetimes cá»§a cÃ¡c tham sá»‘ vÃ  giÃ¡ trá»‹ tráº£ vá» cá»§a hÃ m. Khi cÃ¡c lifetimes Ä‘Æ°á»£c káº¿t ná»‘i, Rust cÃ³ Ä‘á»§ thÃ´ng tin Ä‘á»ƒ cho phÃ©p cÃ¡c thao tÃ¡c an toÃ n vá»›i bá»™ nhá»› vÃ  ngÄƒn cÃ¡c thao tÃ¡c táº¡o ra dangling pointer hoáº·c vi pháº¡m an toÃ n bá»™ nhá»›.</p>
<h3 id="lifetime-annotations-trong-struct-definitions"><a class="header" href="#lifetime-annotations-trong-struct-definitions">Lifetime Annotations trong Struct Definitions</a></h3>
<p>Cho Ä‘áº¿n nay, cÃ¡c struct chÃºng ta Ä‘á»‹nh nghÄ©a Ä‘á»u chá»©a cÃ¡c kiá»ƒu owned. ChÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a struct chá»©a references, nhÆ°ng trong trÆ°á»ng há»£p Ä‘Ã³ cáº§n thÃªm lifetime annotation cho má»—i reference trong Ä‘á»‹nh nghÄ©a struct. Listing 10-24 cÃ³ má»™t struct tÃªn lÃ  <code>ImportantExcerpt</code> chá»©a má»™t string slice.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct ImportantExcerpt&lt;'a&gt; {
    part: &amp;'a str,
}

fn main() {
    let novel = String::from("Call me Ishmael. Some years ago...");
    let first_sentence = novel.split('.').next().unwrap();
    let i = ImportantExcerpt {
        part: first_sentence,
    };
}</code></pre></pre>
<p><span class="caption">Listing 10-24: Má»™t struct chá»©a reference, yÃªu cáº§u lifetime annotation</span></p>
<p>Struct nÃ y cÃ³ má»™t field duy nháº¥t <code>part</code> chá»©a má»™t string slice, vá»‘n lÃ  má»™t reference. Giá»‘ng nhÆ° vá»›i generic data types, chÃºng ta khai bÃ¡o tÃªn cá»§a generic lifetime parameter trong dáº¥u ngoáº·c nhá»n sau tÃªn struct Ä‘á»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng lifetime parameter trong thÃ¢n Ä‘á»‹nh nghÄ©a struct. Annotation nÃ y cÃ³ nghÄ©a lÃ  má»™t instance cá»§a <code>ImportantExcerpt</code> khÃ´ng thá»ƒ sá»‘ng lÃ¢u hÆ¡n reference mÃ  nÃ³ giá»¯ trong field <code>part</code>.</p>
<p>HÃ m <code>main</code> á»Ÿ Ä‘Ã¢y táº¡o má»™t instance cá»§a struct <code>ImportantExcerpt</code> giá»¯ reference tá»›i cÃ¢u Ä‘áº§u tiÃªn cá»§a <code>String</code> do biáº¿n <code>novel</code> sá»Ÿ há»¯u. Dá»¯ liá»‡u trong <code>novel</code> tá»“n táº¡i trÆ°á»›c khi instance cá»§a <code>ImportantExcerpt</code> Ä‘Æ°á»£c táº¡o. ThÃªm vÃ o Ä‘Ã³, <code>novel</code> khÃ´ng ra khá»i scope cho Ä‘áº¿n sau khi <code>ImportantExcerpt</code> ra khá»i scope, nÃªn reference trong instance cá»§a <code>ImportantExcerpt</code> lÃ  há»£p lá»‡.</p>
<h3 id="lifetime-elision"><a class="header" href="#lifetime-elision">Lifetime Elision</a></h3>
<p>Báº¡n Ä‘Ã£ há»c ráº±ng má»—i reference cÃ³ má»™t lifetime vÃ  cáº§n chá»‰ Ä‘á»‹nh lifetime parameters cho cÃ¡c hÃ m hoáº·c struct sá»­ dá»¥ng reference. Tuy nhiÃªn, trong ChÆ°Æ¡ng 4, chÃºng ta cÃ³ má»™t hÃ m trong Listing 4-9, Ä‘Æ°á»£c nháº¯c láº¡i trong Listing 10-25, mÃ  compile mÃ  khÃ´ng cáº§n lifetime annotations.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn first_word(s: &amp;str) -&gt; &amp;str {
    let bytes = s.as_bytes();

    for (i, &amp;item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &amp;s[0..i];
        }
    }

    &amp;s[..]
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let my_string = String::from("hello world");
</span><span class="boring">
</span><span class="boring">    // first_word works on slices of `String`s
</span><span class="boring">    let word = first_word(&amp;my_string[..]);
</span><span class="boring">
</span><span class="boring">    let my_string_literal = "hello world";
</span><span class="boring">
</span><span class="boring">    // first_word works on slices of string literals
</span><span class="boring">    let word = first_word(&amp;my_string_literal[..]);
</span><span class="boring">
</span><span class="boring">    // Because string literals *are* string slices already,
</span><span class="boring">    // this works too, without the slice syntax!
</span><span class="boring">    let word = first_word(my_string_literal);
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 10-25: Má»™t hÃ m chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong Listing 4-9 mÃ  compile mÃ  khÃ´ng cáº§n lifetime annotations, máº·c dÃ¹ tham sá»‘ vÃ  kiá»ƒu tráº£ vá» lÃ  references</span></p>
<p>LÃ½ do hÃ m nÃ y compile mÃ  khÃ´ng cáº§n lifetime annotations lÃ  do lÃ½ do lá»‹ch sá»­: trong cÃ¡c phiÃªn báº£n Ä‘áº§u cá»§a Rust (trÆ°á»›c 1.0), code nÃ y sáº½ khÃ´ng compile vÃ¬ má»—i reference cáº§n má»™t lifetime rÃµ rÃ ng. Khi Ä‘Ã³, chá»¯ kÃ½ hÃ m sáº½ Ä‘Æ°á»£c viáº¿t nhÆ° sau:</p>
<pre><code class="language-rust ignore">fn first_word&lt;'a&gt;(s: &amp;'a str) -&gt; &amp;'a str {</code></pre>
<p>Sau khi viáº¿t nhiá»u code Rust, nhÃ³m phÃ¡t triá»ƒn Rust nháº­n tháº¥y cÃ¡c láº­p trÃ¬nh viÃªn thÆ°á»ng nháº­p cÃ¹ng má»™t lifetime annotation nhiá»u láº§n trong nhá»¯ng tÃ¬nh huá»‘ng nháº¥t Ä‘á»‹nh. Nhá»¯ng tÃ¬nh huá»‘ng nÃ y cÃ³ thá»ƒ dá»± Ä‘oÃ¡n Ä‘Æ°á»£c vÃ  theo má»™t sá»‘ máº«u xÃ¡c Ä‘á»‹nh. CÃ¡c nhÃ  phÃ¡t triá»ƒn Ä‘Ã£ láº­p trÃ¬nh cÃ¡c máº«u nÃ y vÃ o compiler Ä‘á»ƒ borrow checker cÃ³ thá»ƒ suy luáº­n lifetimes trong nhá»¯ng tÃ¬nh huá»‘ng nÃ y mÃ  khÃ´ng cáº§n annotation rÃµ rÃ ng.</p>
<p>Lá»‹ch sá»­ Rust nÃ y cÃ³ liÃªn quan vÃ¬ cÃ³ kháº£ nÄƒng trong tÆ°Æ¡ng lai sáº½ xuáº¥t hiá»‡n nhiá»u máº«u xÃ¡c Ä‘á»‹nh hÆ¡n vÃ  Ä‘Æ°á»£c thÃªm vÃ o compiler. Khi Ä‘Ã³, tháº­m chÃ­ Ã­t lifetime annotation hÆ¡n sáº½ cáº§n thiáº¿t.</p>
<p>CÃ¡c máº«u Ä‘Æ°á»£c láº­p trÃ¬nh vÃ o phÃ¢n tÃ­ch reference cá»§a Rust Ä‘Æ°á»£c gá»i lÃ  <em>lifetime elision rules</em>. ÄÃ¢y khÃ´ng pháº£i lÃ  cÃ¡c quy táº¯c dÃ nh cho láº­p trÃ¬nh viÃªn; chÃºng lÃ  cÃ¡c trÆ°á»ng há»£p cá»¥ thá»ƒ mÃ  compiler sáº½ xem xÃ©t, vÃ  náº¿u code cá»§a báº¡n phÃ¹ há»£p cÃ¡c trÆ°á»ng há»£p nÃ y, báº¡n khÃ´ng cáº§n viáº¿t lifetime má»™t cÃ¡ch rÃµ rÃ ng.</p>
<p>CÃ¡c elision rules khÃ´ng cung cáº¥p suy luáº­n Ä‘áº§y Ä‘á»§. Náº¿u Rust Ã¡p dá»¥ng cÃ¡c quy táº¯c má»™t cÃ¡ch xÃ¡c Ä‘á»‹nh nhÆ°ng váº«n cÃ²n mÆ¡ há»“ vá» lifetime cá»§a cÃ¡c reference, compiler sáº½ khÃ´ng Ä‘oÃ¡n lifetime cá»§a cÃ¡c reference cÃ²n láº¡i. Thay vÃ¬ Ä‘oÃ¡n, compiler sáº½ bÃ¡o lá»—i vÃ  báº¡n cÃ³ thá»ƒ sá»­a báº±ng cÃ¡ch thÃªm lifetime annotation.</p>
<p>Lifetime trÃªn cÃ¡c tham sá»‘ hÃ m hoáº·c method Ä‘Æ°á»£c gá»i lÃ  <em>input lifetimes</em>, vÃ  lifetime trÃªn giÃ¡ trá»‹ tráº£ vá» Ä‘Æ°á»£c gá»i lÃ  <em>output lifetimes</em>.</p>
<p>Compiler sá»­ dá»¥ng ba quy táº¯c Ä‘á»ƒ xÃ¡c Ä‘á»‹nh lifetime cá»§a reference khi khÃ´ng cÃ³ annotation rÃµ rÃ ng. Quy táº¯c Ä‘áº§u Ã¡p dá»¥ng cho input lifetimes, cÃ²n quy táº¯c thá»© hai vÃ  thá»© ba Ã¡p dá»¥ng cho output lifetimes. Náº¿u compiler Ã¡p dá»¥ng háº¿t ba quy táº¯c mÃ  váº«n cÃ²n reference chÆ°a xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c lifetime, compiler sáº½ bÃ¡o lá»—i. CÃ¡c quy táº¯c nÃ y Ã¡p dá»¥ng cho Ä‘á»‹nh nghÄ©a <code>fn</code> cÅ©ng nhÆ° cÃ¡c <code>impl</code> block.</p>
<p>Quy táº¯c Ä‘áº§u tiÃªn lÃ  compiler gÃ¡n má»™t lifetime parameter cho má»—i tham sá»‘ lÃ  reference. NÃ³i cÃ¡ch khÃ¡c, má»™t hÃ m cÃ³ má»™t tham sá»‘ sáº½ nháº­n má»™t lifetime parameter: <code>fn foo&lt;'a&gt;(x: &amp;'a i32)</code>; má»™t hÃ m cÃ³ hai tham sá»‘ sáº½ nháº­n hai lifetime parameter riÃªng biá»‡t: <code>fn foo&lt;'a, 'b&gt;(x: &amp;'a i32, y: &amp;'b i32)</code>; vÃ  tÆ°Æ¡ng tá»±.</p>
<p>Quy táº¯c thá»© hai lÃ , náº¿u cÃ³ Ä‘Ãºng má»™t input lifetime parameter, lifetime nÃ y sáº½ Ä‘Æ°á»£c gÃ¡n cho táº¥t cáº£ output lifetime parameters: <code>fn foo&lt;'a&gt;(x: &amp;'a i32) -&gt; &amp;'a i32</code>.</p>
<p>Quy táº¯c thá»© ba lÃ , náº¿u cÃ³ nhiá»u input lifetime parameters, nhÆ°ng má»™t trong sá»‘ Ä‘Ã³ lÃ  <code>&amp;self</code> hoáº·c <code>&amp;mut self</code> vÃ¬ Ä‘Ã¢y lÃ  má»™t method, lifetime cá»§a <code>self</code> sáº½ Ä‘Æ°á»£c gÃ¡n cho táº¥t cáº£ output lifetime parameters. Quy táº¯c thá»© ba nÃ y giÃºp cÃ¡c method dá»… Ä‘á»c vÃ  viáº¿t hÆ¡n vÃ¬ cáº§n Ã­t kÃ½ hiá»‡u hÆ¡n.</p>
<p>HÃ£y giáº£ sá»­ chÃºng ta lÃ  compiler. ChÃºng ta sáº½ Ã¡p dá»¥ng cÃ¡c quy táº¯c nÃ y Ä‘á»ƒ xÃ¡c Ä‘á»‹nh lifetime cá»§a cÃ¡c reference trong chá»¯ kÃ½ hÃ m <code>first_word</code> trong Listing 10-25. Chá»¯ kÃ½ báº¯t Ä‘áº§u mÃ  khÃ´ng cÃ³ lifetime nÃ o gáº¯n vá»›i cÃ¡c reference:</p>
<pre><code class="language-rust ignore">fn first_word(s: &amp;str) -&gt; &amp;str {</code></pre>
<p>Sau Ä‘Ã³ compiler Ã¡p dá»¥ng quy táº¯c Ä‘áº§u tiÃªn, quy Ä‘á»‹nh ráº±ng má»—i tham sá»‘ nháº­n má»™t lifetime riÃªng. ChÃºng ta sáº½ gá»i nÃ³ lÃ  <code>'a</code> nhÆ° thÆ°á»ng lá»‡, nÃªn chá»¯ kÃ½ bÃ¢y giá» lÃ :</p>
<pre><code class="language-rust ignore">fn first_word&lt;'a&gt;(s: &amp;'a str) -&gt; &amp;str {</code></pre>
<p>Quy táº¯c thá»© hai Ã¡p dá»¥ng vÃ¬ chá»‰ cÃ³ Ä‘Ãºng má»™t input lifetime. Quy táº¯c thá»© hai quy Ä‘á»‹nh ráº±ng lifetime cá»§a tham sá»‘ input nÃ y sáº½ Ä‘Æ°á»£c gÃ¡n cho output lifetime, nÃªn chá»¯ kÃ½ bÃ¢y giá» lÃ :</p>
<pre><code class="language-rust ignore">fn first_word&lt;'a&gt;(s: &amp;'a str) -&gt; &amp;'a str {</code></pre>
<p>BÃ¢y giá» táº¥t cáº£ cÃ¡c reference trong chá»¯ kÃ½ hÃ m nÃ y Ä‘Ã£ cÃ³ lifetimes, vÃ  compiler cÃ³ thá»ƒ tiáº¿p tá»¥c phÃ¢n tÃ­ch mÃ  khÃ´ng cáº§n láº­p trÃ¬nh viÃªn pháº£i annotation lifetimes trong chá»¯ kÃ½ hÃ m nÃ y.</p>
<p>HÃ£y xem má»™t vÃ­ dá»¥ khÃ¡c, láº§n nÃ y sá»­ dá»¥ng hÃ m <code>longest</code> mÃ  trÆ°á»›c Ä‘Ã³ khÃ´ng cÃ³ lifetime parameters khi chÃºng ta báº¯t Ä‘áº§u lÃ m viá»‡c vá»›i nÃ³ trong Listing 10-20:</p>
<pre><code class="language-rust ignore">fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str {</code></pre>
<p>HÃ£y Ã¡p dá»¥ng quy táº¯c Ä‘áº§u tiÃªn: má»—i tham sá»‘ nháº­n má»™t lifetime riÃªng. Láº§n nÃ y chÃºng ta cÃ³ hai tham sá»‘ thay vÃ¬ má»™t, nÃªn sáº½ cÃ³ hai lifetimes:</p>
<pre><code class="language-rust ignore">fn longest&lt;'a, 'b&gt;(x: &amp;'a str, y: &amp;'b str) -&gt; &amp;str {</code></pre>
<p>Báº¡n cÃ³ thá»ƒ tháº¥y ráº±ng quy táº¯c thá»© hai khÃ´ng Ã¡p dá»¥ng vÃ¬ cÃ³ nhiá»u hÆ¡n má»™t input lifetime. Quy táº¯c thá»© ba cÅ©ng khÃ´ng Ã¡p dá»¥ng, vÃ¬ <code>longest</code> lÃ  má»™t function chá»© khÃ´ng pháº£i method, nÃªn khÃ´ng cÃ³ tham sá»‘ nÃ o lÃ  <code>self</code>. Sau khi Ã¡p dá»¥ng cáº£ ba quy táº¯c, chÃºng ta váº«n chÆ°a xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c lifetime cá»§a kiá»ƒu tráº£ vá». ÄÃ¢y lÃ  lÃ½ do chÃºng ta nháº­n Ä‘Æ°á»£c lá»—i khi cá»‘ compile code trong Listing 10-20: compiler Ä‘Ã£ Ã¡p dá»¥ng cÃ¡c lifetime elision rules nhÆ°ng váº«n khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c táº¥t cáº£ lifetimes cá»§a cÃ¡c reference trong chá»¯ kÃ½.</p>
<p>VÃ¬ quy táº¯c thá»© ba thá»±c sá»± chá»‰ Ã¡p dá»¥ng trong chá»¯ kÃ½ method, chÃºng ta sáº½ xem xÃ©t lifetimes trong ngá»¯ cáº£nh nÃ y tiáº¿p theo Ä‘á»ƒ hiá»ƒu táº¡i sao quy táº¯c thá»© ba giÃºp khÃ´ng cáº§n pháº£i annotation lifetimes trong chá»¯ kÃ½ method thÆ°á»ng xuyÃªn.</p>
<h3 id="lifetime-annotations-trong-method-definitions"><a class="header" href="#lifetime-annotations-trong-method-definitions">Lifetime Annotations trong Method Definitions</a></h3>
<p>Khi triá»ƒn khai cÃ¡c method trÃªn má»™t struct cÃ³ lifetimes, chÃºng ta sá»­ dá»¥ng cÃ¹ng cÃº phÃ¡p nhÆ° vá»›i generic type parameters Ä‘Ã£ trÃ¬nh bÃ y trong Listing 10-11. Viá»‡c khai bÃ¡o vÃ  sá»­ dá»¥ng lifetime parameters phá»¥ thuá»™c vÃ o viá»‡c chÃºng liÃªn quan Ä‘áº¿n fields cá»§a struct hay cÃ¡c tham sá»‘ vÃ  giÃ¡ trá»‹ tráº£ vá» cá»§a method.</p>
<p>TÃªn lifetime cho cÃ¡c field cá»§a struct luÃ´n cáº§n Ä‘Æ°á»£c khai bÃ¡o sau tá»« khÃ³a <code>impl</code> vÃ  sau Ä‘Ã³ sá»­ dá»¥ng sau tÃªn struct, vÃ¬ nhá»¯ng lifetime nÃ y lÃ  má»™t pháº§n cá»§a kiá»ƒu struct.</p>
<p>Trong chá»¯ kÃ½ method bÃªn trong <code>impl</code> block, cÃ¡c reference cÃ³ thá»ƒ liÃªn quan tá»›i lifetime cá»§a cÃ¡c reference trong field cá»§a struct, hoáº·c cÃ³ thá»ƒ Ä‘á»™c láº­p. ThÃªm vÃ o Ä‘Ã³, cÃ¡c lifetime elision rules thÆ°á»ng lÃ m cho viá»‡c annotation lifetime trong chá»¯ kÃ½ method khÃ´ng cáº§n thiáº¿t. HÃ£y xem má»™t sá»‘ vÃ­ dá»¥ sá»­ dá»¥ng struct tÃªn lÃ  <code>ImportantExcerpt</code> mÃ  chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong Listing 10-24.</p>
<p>TrÆ°á»›c tiÃªn, chÃºng ta sáº½ dÃ¹ng má»™t method tÃªn lÃ  <code>level</code> mÃ  tham sá»‘ duy nháº¥t lÃ  reference tá»›i <code>self</code> vÃ  giÃ¡ trá»‹ tráº£ vá» lÃ  má»™t <code>i32</code>, khÃ´ng pháº£i reference tá»›i báº¥t cá»© thá»© gÃ¬:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct ImportantExcerpt&lt;'a&gt; {
</span><span class="boring">    part: &amp;'a str,
</span><span class="boring">}
</span><span class="boring">
</span>impl&lt;'a&gt; ImportantExcerpt&lt;'a&gt; {
    fn level(&amp;self) -&gt; i32 {
        3
    }
}
<span class="boring">
</span><span class="boring">impl&lt;'a&gt; ImportantExcerpt&lt;'a&gt; {
</span><span class="boring">    fn announce_and_return_part(&amp;self, announcement: &amp;str) -&gt; &amp;str {
</span><span class="boring">        println!("Attention please: {announcement}");
</span><span class="boring">        self.part
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let novel = String::from("Call me Ishmael. Some years ago...");
</span><span class="boring">    let first_sentence = novel.split('.').next().unwrap();
</span><span class="boring">    let i = ImportantExcerpt {
</span><span class="boring">        part: first_sentence,
</span><span class="boring">    };
</span><span class="boring">}</span></code></pre></pre>
<p>Viá»‡c khai bÃ¡o lifetime parameter sau <code>impl</code> vÃ  sá»­ dá»¥ng nÃ³ sau tÃªn kiá»ƒu lÃ  báº¯t buá»™c, nhÆ°ng chÃºng ta khÃ´ng cáº§n annotation lifetime cá»§a reference tá»›i <code>self</code> vÃ¬ quy táº¯c elision Ä‘áº§u tiÃªn.</p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ mÃ  quy táº¯c elision thá»© ba Ã¡p dá»¥ng:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct ImportantExcerpt&lt;'a&gt; {
</span><span class="boring">    part: &amp;'a str,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl&lt;'a&gt; ImportantExcerpt&lt;'a&gt; {
</span><span class="boring">    fn level(&amp;self) -&gt; i32 {
</span><span class="boring">        3
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>impl&lt;'a&gt; ImportantExcerpt&lt;'a&gt; {
    fn announce_and_return_part(&amp;self, announcement: &amp;str) -&gt; &amp;str {
        println!("Attention please: {announcement}");
        self.part
    }
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let novel = String::from("Call me Ishmael. Some years ago...");
</span><span class="boring">    let first_sentence = novel.split('.').next().unwrap();
</span><span class="boring">    let i = ImportantExcerpt {
</span><span class="boring">        part: first_sentence,
</span><span class="boring">    };
</span><span class="boring">}</span></code></pre></pre>
<p>CÃ³ hai input lifetimes, vÃ¬ váº­y Rust Ã¡p dá»¥ng quy táº¯c elision Ä‘áº§u tiÃªn vÃ  gÃ¡n cho cáº£ <code>&amp;self</code> vÃ  <code>announcement</code> lifetime riÃªng cá»§a chÃºng. Sau Ä‘Ã³, vÃ¬ má»™t trong cÃ¡c tham sá»‘ lÃ  <code>&amp;self</code>, kiá»ƒu tráº£ vá» nháº­n lifetime cá»§a <code>&amp;self</code>, vÃ  táº¥t cáº£ cÃ¡c lifetimes Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh.</p>
<h3 id="the-static-lifetime"><a class="header" href="#the-static-lifetime">The Static Lifetime</a></h3>
<p>Má»™t lifetime Ä‘áº·c biá»‡t mÃ  chÃºng ta cáº§n tháº£o luáº­n lÃ  <code>'static</code>, biá»ƒu thá»‹ ráº±ng reference bá»‹ áº£nh hÆ°á»Ÿng <em>cÃ³ thá»ƒ</em> tá»“n táº¡i trong toÃ n bá»™ thá»i gian cháº¡y cá»§a chÆ°Æ¡ng trÃ¬nh. Táº¥t cáº£ string literals Ä‘á»u cÃ³ lifetime <code>'static</code>, vÃ  chÃºng ta cÃ³ thá»ƒ annotation nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s: &amp;'static str = "I have a static lifetime.";
<span class="boring">}</span></code></pre></pre>
<p>Ná»™i dung cá»§a string nÃ y Ä‘Æ°á»£c lÆ°u trá»±c tiáº¿p trong binary cá»§a chÆ°Æ¡ng trÃ¬nh, vá»‘n luÃ´n cÃ³ sáºµn. Do Ä‘Ã³, lifetime cá»§a táº¥t cáº£ string literals lÃ  <code>'static</code>.</p>
<p>Báº¡n cÃ³ thá»ƒ tháº¥y cÃ¡c gá»£i Ã½ sá»­ dá»¥ng lifetime <code>'static</code> trong cÃ¡c thÃ´ng bÃ¡o lá»—i. NhÆ°ng trÆ°á»›c khi chá»‰ Ä‘á»‹nh <code>'static</code> lÃ m lifetime cho má»™t reference, hÃ£y suy nghÄ© xem reference báº¡n cÃ³ thá»±c sá»± sá»‘ng trong toÃ n bá»™ thá»i gian cháº¡y cá»§a chÆ°Æ¡ng trÃ¬nh hay khÃ´ng, vÃ  liá»‡u báº¡n cÃ³ muá»‘n váº­y khÃ´ng. Pháº§n lá»›n thá»i gian, má»™t thÃ´ng bÃ¡o lá»—i gá»£i Ã½ lifetime <code>'static</code> xuáº¥t phÃ¡t tá»« viá»‡c cá»‘ táº¡o má»™t dangling reference hoáº·c sá»± khÃ´ng khá»›p giá»¯a cÃ¡c lifetimes sáºµn cÃ³. Trong nhá»¯ng trÆ°á»ng há»£p nÃ y, giáº£i phÃ¡p lÃ  sá»­a cÃ¡c váº¥n Ä‘á» Ä‘Ã³, chá»© khÃ´ng pháº£i chá»‰ Ä‘á»‹nh lifetime <code>'static</code>.</p>
<h2 id="generic-type-parameters-trait-bounds-and-lifetimes-together"><a class="header" href="#generic-type-parameters-trait-bounds-and-lifetimes-together">Generic Type Parameters, Trait Bounds, and Lifetimes Together</a></h2>
<p>HÃ£y cÃ¹ng xem nhanh cÃº phÃ¡p Ä‘á»ƒ chá»‰ Ä‘á»‹nh generic type parameters, trait bounds vÃ  lifetimes trong cÃ¹ng má»™t hÃ m!</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span><span class="boring">    let string1 = String::from("abcd");
</span><span class="boring">    let string2 = "xyz";
</span><span class="boring">
</span><span class="boring">    let result = longest_with_an_announcement(
</span><span class="boring">        string1.as_str(),
</span><span class="boring">        string2,
</span><span class="boring">        "Today is someone's birthday!",
</span><span class="boring">    );
</span><span class="boring">    println!("The longest string is {result}");
</span><span class="boring">}
</span><span class="boring">
</span>use std::fmt::Display;

fn longest_with_an_announcement&lt;'a, T&gt;(
    x: &amp;'a str,
    y: &amp;'a str,
    ann: T,
) -&gt; &amp;'a str
where
    T: Display,
{
    println!("Announcement! {ann}");
    if x.len() &gt; y.len() { x } else { y }
}</code></pre></pre>
<p>ÄÃ¢y lÃ  hÃ m <code>longest</code> tá»« Listing 10-21 tráº£ vá» chuá»—i con dÃ i hÆ¡n trong hai chuá»—i con. NhÆ°ng bÃ¢y giá» nÃ³ cÃ³ thÃªm má»™t tham sá»‘ tÃªn lÃ  <code>ann</code> vá»›i kiá»ƒu generic <code>T</code>, cÃ³ thá»ƒ lÃ  báº¥t ká»³ kiá»ƒu nÃ o triá»ƒn khai trait <code>Display</code> nhÆ° Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong <code>where</code> clause. Tham sá»‘ thÃªm nÃ y sáº½ Ä‘Æ°á»£c in ra báº±ng <code>{}</code>, Ä‘Ã³ lÃ  lÃ½ do cáº§n trait bound <code>Display</code>. VÃ¬ lifetimes cÅ©ng lÃ  má»™t loáº¡i generic, nÃªn khai bÃ¡o lifetime parameter <code>'a</code> vÃ  generic type parameter <code>T</code> Ä‘Æ°á»£c Ä‘áº·t trong cÃ¹ng má»™t danh sÃ¡ch bÃªn trong dáº¥u ngoáº·c nhá»n sau tÃªn hÃ m.</p>
<h2 id="tÃ³m-táº¯t"><a class="header" href="#tÃ³m-táº¯t">TÃ³m táº¯t</a></h2>
<p>ChÃºng ta Ä‘Ã£ bao quÃ¡t ráº¥t nhiá»u trong chÆ°Æ¡ng nÃ y! Giá» Ä‘Ã¢y báº¡n Ä‘Ã£ hiá»ƒu vá» generic type parameters, traits vÃ  trait bounds, cÃ¹ng generic lifetime parameters, báº¡n Ä‘Ã£ sáºµn sÃ ng viáº¿t code khÃ´ng láº·p láº¡i vÃ  hoáº¡t Ä‘á»™ng trong nhiá»u tÃ¬nh huá»‘ng khÃ¡c nhau. Generic type parameters cho phÃ©p Ã¡p dá»¥ng code cho nhiá»u kiá»ƒu khÃ¡c nhau. Traits vÃ  trait bounds Ä‘áº£m báº£o ráº±ng máº·c dÃ¹ cÃ¡c kiá»ƒu lÃ  generic, chÃºng váº«n cÃ³ hÃ nh vi mÃ  code cáº§n. Báº¡n Ä‘Ã£ há»c cÃ¡ch sá»­ dá»¥ng lifetime annotations Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng code linh hoáº¡t nÃ y sáº½ khÃ´ng cÃ³ báº¥t ká»³ dangling reference nÃ o. VÃ  táº¥t cáº£ phÃ¢n tÃ­ch nÃ y xáº£y ra táº¡i thá»i Ä‘iá»ƒm compile, khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u nÄƒng runtime!</p>
<p>Tin hay khÃ´ng, váº«n cÃ²n nhiá»u Ä‘iá»u Ä‘á»ƒ há»c vá» cÃ¡c chá»§ Ä‘á» Ä‘Ã£ tháº£o luáº­n trong chÆ°Æ¡ng nÃ y: ChÆ°Æ¡ng 17 sáº½ nÃ³i vá» trait objects, má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ sá»­ dá»¥ng traits. CÅ©ng cÃ³ nhá»¯ng tÃ¬nh huá»‘ng phá»©c táº¡p hÆ¡n liÃªn quan Ä‘áº¿n lifetime annotations mÃ  báº¡n chá»‰ cáº§n trong cÃ¡c trÆ°á»ng há»£p nÃ¢ng cao; vá»›i nhá»¯ng trÆ°á»ng há»£p Ä‘Ã³, báº¡n nÃªn Ä‘á»c <a href="../reference/index.html">Rust Reference</a>. NhÆ°ng tiáº¿p theo, báº¡n sáº½ há»c cÃ¡ch viáº¿t tests trong Rust Ä‘á»ƒ Ä‘áº£m báº£o code cá»§a báº¡n hoáº¡t Ä‘á»™ng nhÆ° mong Ä‘á»£i.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="viáº¿t-cÃ¡c-bÃ i-kiá»ƒm-tra-tá»±-Äá»™ng"><a class="header" href="#viáº¿t-cÃ¡c-bÃ i-kiá»ƒm-tra-tá»±-Äá»™ng">Viáº¿t CÃ¡c BÃ i Kiá»ƒm Tra Tá»± Äá»™ng</a></h1>
<p>Trong bÃ i luáº­n nÄƒm 1972 â€œThe Humble Programmer,â€ Edsger W. Dijkstra Ä‘Ã£ nÃ³i ráº±ng â€œKiá»ƒm thá»­ chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ lÃ  má»™t cÃ¡ch ráº¥t hiá»‡u quáº£ Ä‘á»ƒ phÃ¡t hiá»‡n lá»—i, nhÆ°ng hoÃ n toÃ n khÃ´ng Ä‘á»§ Ä‘á»ƒ chá»©ng minh ráº±ng khÃ´ng cÃ³ lá»—i.â€ Äiá»u Ä‘Ã³ khÃ´ng cÃ³ nghÄ©a lÃ  chÃºng ta khÃ´ng nÃªn cá»‘ gáº¯ng kiá»ƒm thá»­ cÃ ng nhiá»u cÃ ng tá»‘t!</p>
<p>Äá»™ chÃ­nh xÃ¡c trong chÆ°Æ¡ng trÃ¬nh lÃ  má»©c Ä‘á»™ mÃ  code cá»§a chÃºng ta thá»±c hiá»‡n Ä‘Ãºng nhá»¯ng gÃ¬ chÃºng ta dá»± Ä‘á»‹nh. Rust Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i sá»± quan tÃ¢m cao vá» Ä‘á»™ chÃ­nh xÃ¡c cá»§a chÆ°Æ¡ng trÃ¬nh, nhÆ°ng Ä‘á»™ chÃ­nh xÃ¡c lÃ  má»™t váº¥n Ä‘á» phá»©c táº¡p vÃ  khÃ³ chá»©ng minh. Há»‡ thá»‘ng kiá»ƒu cá»§a Rust Ä‘áº£m nháº­n pháº§n lá»›n gÃ¡nh náº·ng nÃ y, nhÆ°ng há»‡ thá»‘ng kiá»ƒu khÃ´ng thá»ƒ phÃ¡t hiá»‡n táº¥t cáº£. Do Ä‘Ã³, Rust há»— trá»£ viáº¿t cÃ¡c bÃ i kiá»ƒm tra pháº§n má»m tá»± Ä‘á»™ng.</p>
<p>Giáº£ sá»­ chÃºng ta viáº¿t má»™t hÃ m <code>add_two</code> Ä‘á»ƒ cá»™ng thÃªm 2 vÃ o báº¥t ká»³ sá»‘ nÃ o Ä‘Æ°á»£c truyá»n vÃ o. Chá»¯ kÃ½ cá»§a hÃ m nÃ y nháº­n má»™t sá»‘ nguyÃªn lÃ m tham sá»‘ vÃ  tráº£ vá» má»™t sá»‘ nguyÃªn. Khi chÃºng ta triá»ƒn khai vÃ  biÃªn dá»‹ch hÃ m Ä‘Ã³, Rust thá»±c hiá»‡n táº¥t cáº£ kiá»ƒm tra kiá»ƒu vÃ  kiá»ƒm tra mÆ°á»£n mÃ  báº¡n Ä‘Ã£ há»c Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng, vÃ­ dá»¥, chÃºng ta khÃ´ng truyá»n má»™t giÃ¡ trá»‹ <code>String</code> hoáº·c má»™t reference khÃ´ng há»£p lá»‡ vÃ o hÃ m nÃ y. NhÆ°ng Rust <em>khÃ´ng thá»ƒ</em> kiá»ƒm tra ráº±ng hÃ m nÃ y sáº½ thá»±c sá»± thá»±c hiá»‡n Ä‘Ãºng Ä‘iá»u chÃºng ta muá»‘n, cháº³ng háº¡n tráº£ vá» tham sá»‘ cá»™ng 2 thay vÃ¬ tham sá»‘ cá»™ng 10 hoáº·c trá»« 50! ÄÃ¢y lÃ  lÃºc cÃ¡c bÃ i kiá»ƒm tra phÃ¡t huy tÃ¡c dá»¥ng.</p>
<p>ChÃºng ta cÃ³ thá»ƒ viáº¿t cÃ¡c bÃ i kiá»ƒm tra Ä‘á»ƒ kháº³ng Ä‘á»‹nh, vÃ­ dá»¥, khi truyá»n <code>3</code> vÃ o hÃ m <code>add_two</code>, giÃ¡ trá»‹ tráº£ vá» lÃ  <code>5</code>. ChÃºng ta cÃ³ thá»ƒ cháº¡y cÃ¡c bÃ i kiá»ƒm tra nÃ y báº¥t cá»© khi nÃ o thay Ä‘á»•i code Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng cÃ¡c hÃ nh vi Ä‘Ãºng trÆ°á»›c Ä‘Ã³ khÃ´ng bá»‹ thay Ä‘á»•i.</p>
<p>Kiá»ƒm thá»­ lÃ  má»™t ká»¹ nÄƒng phá»©c táº¡p: máº·c dÃ¹ khÃ´ng thá»ƒ bao quÃ¡t táº¥t cáº£ chi tiáº¿t vá» cÃ¡ch viáº¿t cÃ¡c bÃ i kiá»ƒm tra tá»‘t trong má»™t chÆ°Æ¡ng, chÃºng ta sáº½ tháº£o luáº­n vá» cÆ¡ cháº¿ cá»§a cÃ¡c tiá»‡n Ã­ch kiá»ƒm thá»­ trong Rust. ChÃºng ta sáº½ nÃ³i vá» cÃ¡c annotation vÃ  macro cÃ³ sáºµn khi viáº¿t kiá»ƒm tra, hÃ nh vi máº·c Ä‘á»‹nh vÃ  cÃ¡c tÃ¹y chá»n khi cháº¡y kiá»ƒm tra, cÅ©ng nhÆ° cÃ¡ch tá»• chá»©c kiá»ƒm tra thÃ nh unit tests vÃ  integration tests.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="cÃ¡ch-viáº¿t-tests"><a class="header" href="#cÃ¡ch-viáº¿t-tests">CÃ¡ch Viáº¿t Tests</a></h2>
<p>BÃ i kiá»ƒm tra lÃ  cÃ¡c hÃ m trong Rust dÃ¹ng Ä‘á»ƒ xÃ¡c minh ráº±ng code khÃ´ng pháº£i kiá»ƒm tra hoáº¡t Ä‘á»™ng Ä‘Ãºng nhÆ° mong Ä‘á»£i. Ná»™i dung cá»§a cÃ¡c hÃ m kiá»ƒm tra thÆ°á»ng thá»±c hiá»‡n ba bÆ°á»›c sau:</p>
<ol>
<li>Thiáº¿t láº­p dá»¯ liá»‡u hoáº·c tráº¡ng thÃ¡i cáº§n thiáº¿t.</li>
<li>Cháº¡y Ä‘oáº¡n code báº¡n muá»‘n kiá»ƒm tra.</li>
<li>Kháº³ng Ä‘á»‹nh káº¿t quáº£ lÃ  nhÆ° mong Ä‘á»£i.</li>
</ol>
<p>HÃ£y xem cÃ¡c tÃ­nh nÄƒng mÃ  Rust cung cáº¥p Ä‘á»ƒ viáº¿t cÃ¡c bÃ i kiá»ƒm tra thá»±c hiá»‡n cÃ¡c bÆ°á»›c nÃ y, bao gá»“m attribute <code>test</code>, má»™t sá»‘ macro, vÃ  attribute <code>should_panic</code>.</p>
<h3 id="cáº¥u-trÃºc-cá»§a-má»™t-hÃ m-kiá»ƒm-tra"><a class="header" href="#cáº¥u-trÃºc-cá»§a-má»™t-hÃ m-kiá»ƒm-tra">Cáº¥u TrÃºc Cá»§a Má»™t HÃ m Kiá»ƒm Tra</a></h3>
<p>á» má»©c Ä‘Æ¡n giáº£n nháº¥t, má»™t bÃ i kiá»ƒm tra trong Rust lÃ  má»™t hÃ m Ä‘Æ°á»£c chÃº thÃ­ch vá»›i attribute <code>test</code>. Attributes lÃ  metadata vá» cÃ¡c pháº§n code Rust; má»™t vÃ­ dá»¥ lÃ  attribute <code>derive</code> mÃ  chÃºng ta Ä‘Ã£ dÃ¹ng vá»›i struct trong ChÆ°Æ¡ng 5. Äá»ƒ biáº¿n má»™t hÃ m thÃ nh hÃ m kiá»ƒm tra, thÃªm <code>#[test]</code> ngay trÆ°á»›c <code>fn</code>. Khi báº¡n cháº¡y kiá»ƒm tra vá»›i lá»‡nh <code>cargo test</code>, Rust sáº½ xÃ¢y dá»±ng má»™t binary cháº¡y kiá»ƒm tra, cháº¡y cÃ¡c hÃ m Ä‘Æ°á»£c chÃº thÃ­ch vÃ  bÃ¡o cÃ¡o xem má»—i hÃ m kiá»ƒm tra pass hay fail.</p>
<p>Má»—i khi chÃºng ta táº¡o má»™t dá»± Ã¡n thÆ° viá»‡n má»›i vá»›i Cargo, má»™t module kiá»ƒm tra cÃ¹ng vá»›i má»™t hÃ m kiá»ƒm tra trong Ä‘Ã³ Ä‘Æ°á»£c tá»± Ä‘á»™ng táº¡o sáºµn. Module nÃ y cung cáº¥p cho báº¡n má»™t máº«u Ä‘á»ƒ viáº¿t cÃ¡c bÃ i kiá»ƒm tra, nhá» Ä‘Ã³ báº¡n khÃ´ng pháº£i tra cá»©u cáº¥u trÃºc vÃ  cÃº phÃ¡p chÃ­nh xÃ¡c má»—i khi báº¯t Ä‘áº§u dá»± Ã¡n má»›i. Báº¡n cÃ³ thá»ƒ thÃªm bao nhiÃªu hÃ m kiá»ƒm tra vÃ  module kiá»ƒm tra tÃ¹y Ã½.</p>
<p>ChÃºng ta sáº½ khÃ¡m phÃ¡ má»™t sá»‘ khÃ­a cáº¡nh vá» cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a kiá»ƒm tra báº±ng cÃ¡ch thá»­ nghiá»‡m vá»›i máº«u kiá»ƒm tra trÆ°á»›c khi thá»±c sá»± kiá»ƒm tra báº¥t ká»³ code nÃ o. Sau Ä‘Ã³, chÃºng ta sáº½ viáº¿t cÃ¡c bÃ i kiá»ƒm tra thá»±c táº¿, gá»i cÃ¡c code Ä‘Ã£ viáº¿t vÃ  kháº³ng Ä‘á»‹nh ráº±ng hÃ nh vi cá»§a chÃºng lÃ  Ä‘Ãºng.</p>
<p>HÃ£y táº¡o má»™t dá»± Ã¡n thÆ° viá»‡n má»›i cÃ³ tÃªn lÃ  <code>adder</code> dÃ¹ng Ä‘á»ƒ cá»™ng hai sá»‘:</p>
<pre><code class="language-console">$ cargo new adder --lib
     Created library `adder` project
$ cd adder
</code></pre>
<p>The contents of the <em>src/lib.rs</em> file in your <code>adder</code> library should look like
Listing 11-1.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<!-- manual-regeneration
cd listings/ch11-writing-automated-tests
rm -rf listing-11-01
cargo new listing-11-01 --lib --name adder
cd listing-11-01
cargo test
git co output.txt
cd ../../..
-->
<pre><code class="language-rust noplayground">pub fn add(left: u64, right: u64) -&gt; u64 {
    left + right
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn it_works() {
        let result = add(2, 2);
        assert_eq!(result, 4);
    }
}</code></pre>
<p><span class="caption">Listing 11-1: Module kiá»ƒm thá»­ vÃ  hÃ m Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng bá»Ÿi <code>cargo new</code></span></p>
<p>Hiá»‡n táº¡i, hÃ£y bá» qua hai dÃ²ng Ä‘áº§u vÃ  táº­p trung vÃ o hÃ m. ChÃº Ã½ annotation <code>#[test]</code>: attribute nÃ y cho biáº¿t Ä‘Ã¢y lÃ  má»™t hÃ m kiá»ƒm thá»­, vÃ¬ váº­y test runner sáº½ biáº¿t xá»­ lÃ½ hÃ m nÃ y nhÆ° má»™t kiá»ƒm thá»­. ChÃºng ta cÅ©ng cÃ³ thá»ƒ cÃ³ cÃ¡c hÃ m khÃ´ng pháº£i kiá»ƒm thá»­ trong module <code>tests</code> Ä‘á»ƒ thiáº¿t láº­p cÃ¡c ká»‹ch báº£n chung hoáº·c thá»±c hiá»‡n cÃ¡c thao tÃ¡c chung, vÃ¬ váº­y chÃºng ta luÃ´n cáº§n chá»‰ rÃµ hÃ m nÃ o lÃ  kiá»ƒm thá»­.</p>
<p>Ná»™i dung hÃ m vÃ­ dá»¥ sá»­ dá»¥ng macro <code>assert_eq!</code> Ä‘á»ƒ kháº³ng Ä‘á»‹nh ráº±ng <code>result</code>, chá»©a káº¿t quáº£ cá»§a viá»‡c cá»™ng 2 vÃ  2, báº±ng 4. Kháº³ng Ä‘á»‹nh nÃ y lÃ  má»™t vÃ­ dá»¥ vá» Ä‘á»‹nh dáº¡ng cá»§a má»™t hÃ m kiá»ƒm thá»­ Ä‘iá»ƒn hÃ¬nh. HÃ£y cháº¡y nÃ³ Ä‘á»ƒ xem kiá»ƒm thá»­ nÃ y pass.</p>
<p>Lá»‡nh <code>cargo test</code> sáº½ cháº¡y táº¥t cáº£ cÃ¡c kiá»ƒm thá»­ trong dá»± Ã¡n cá»§a chÃºng ta, nhÆ° minh há»a trong Listing 11-2.</p>
<pre><code class="language-console">$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.57s
     Running unittests src/lib.rs (target/debug/deps/adder-01ad14159ff659ab)

running 1 test
test tests::it_works ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p><span class="caption">Listing 11-2: Káº¿t quáº£ khi cháº¡y kiá»ƒm thá»­ Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng</span></p>
<p>Cargo Ä‘Ã£ biÃªn dá»‹ch vÃ  cháº¡y kiá»ƒm thá»­. ChÃºng ta tháº¥y dÃ²ng <code>running 1 test</code>. DÃ²ng tiáº¿p theo hiá»ƒn thá»‹ tÃªn cá»§a hÃ m kiá»ƒm thá»­ Ä‘Æ°á»£c táº¡o, gá»i lÃ  <code>it_works</code>, vÃ  káº¿t quáº£ cháº¡y kiá»ƒm thá»­ lÃ  <code>ok</code>. TÃ³m táº¯t tá»•ng thá»ƒ <code>test result: ok.</code> cÃ³ nghÄ©a lÃ  táº¥t cáº£ cÃ¡c kiá»ƒm thá»­ Ä‘á»u pass, vÃ  pháº§n <code>1 passed; 0 failed</code> cho biáº¿t sá»‘ lÆ°á»£ng kiá»ƒm thá»­ pass hoáº·c fail.</p>
<p>CÃ³ thá»ƒ Ä‘Ã¡nh dáº¥u má»™t kiá»ƒm thá»­ lÃ  ignored Ä‘á»ƒ nÃ³ khÃ´ng cháº¡y trong má»™t trÆ°á»ng há»£p cá»¥ thá»ƒ; pháº§n nÃ y sáº½ Ä‘Æ°á»£c nÃ³i Ä‘áº¿n trong má»¥c <a href="ch11-02-running-tests.html#ignoring-some-tests-unless-specifically-requested">â€œIgnoring Some Tests Unless Specifically Requestedâ€</a> sau trong chÆ°Æ¡ng. VÃ¬ á»Ÿ Ä‘Ã¢y chÃºng ta chÆ°a lÃ m Ä‘iá»u Ä‘Ã³, tÃ³m táº¯t hiá»ƒn thá»‹ <code>0 ignored</code>. ChÃºng ta cÅ©ng cÃ³ thá»ƒ truyá»n má»™t Ä‘á»‘i sá»‘ cho lá»‡nh <code>cargo test</code> Ä‘á»ƒ chá»‰ cháº¡y cÃ¡c kiá»ƒm thá»­ cÃ³ tÃªn khá»›p vá»›i má»™t chuá»—i; Ä‘iá»u nÃ y gá»i lÃ  <em>filtering</em> vÃ  sáº½ Ä‘Æ°á»£c nÃ³i Ä‘áº¿n trong má»¥c <a href="ch11-02-running-tests.html#running-a-subset-of-tests-by-name">â€œRunning a Subset of Tests by Nameâ€</a>. á» Ä‘Ã¢y chÃºng ta cÅ©ng chÆ°a lá»c cÃ¡c kiá»ƒm thá»­ Ä‘ang cháº¡y, vÃ¬ váº­y cuá»‘i tÃ³m táº¯t hiá»ƒn thá»‹ <code>0 filtered out</code>.</p>
<p>Thá»‘ng kÃª <code>0 measured</code> dÃ nh cho cÃ¡c kiá»ƒm thá»­ benchmark Ä‘o hiá»‡u nÄƒng. CÃ¡c kiá»ƒm thá»­ benchmark hiá»‡n táº¡i chá»‰ kháº£ dá»¥ng trong Rust nightly. Xem <a href="../unstable-book/library-features/test.html">tÃ i liá»‡u vá» benchmark tests</a> Ä‘á»ƒ tÃ¬m hiá»ƒu thÃªm.</p>
<p>Pháº§n tiáº¿p theo cá»§a káº¿t quáº£ kiá»ƒm thá»­, báº¯t Ä‘áº§u tá»« <code>Doc-tests adder</code>, lÃ  káº¿t quáº£ cá»§a cÃ¡c kiá»ƒm thá»­ tÃ i liá»‡u. ChÃºng ta chÆ°a cÃ³ kiá»ƒm thá»­ tÃ i liá»‡u nÃ o, nhÆ°ng Rust cÃ³ thá»ƒ biÃªn dá»‹ch báº¥t ká»³ vÃ­ dá»¥ code nÃ o xuáº¥t hiá»‡n trong tÃ i liá»‡u API. TÃ­nh nÄƒng nÃ y giÃºp Ä‘á»“ng bá»™ giá»¯a tÃ i liá»‡u vÃ  code! ChÃºng ta sáº½ tháº£o luáº­n cÃ¡ch viáº¿t kiá»ƒm thá»­ tÃ i liá»‡u trong má»¥c <a href="ch14-02-publishing-to-crates-io.html#documentation-comments-as-tests">â€œDocumentation Comments as Testsâ€</a> á»Ÿ ChÆ°Æ¡ng 14. Hiá»‡n táº¡i, chÃºng ta sáº½ bá» qua káº¿t quáº£ <code>Doc-tests</code>.</p>
<p>HÃ£y báº¯t Ä‘áº§u tÃ¹y chá»‰nh kiá»ƒm thá»­ theo nhu cáº§u cá»§a chÃºng ta. TrÆ°á»›c háº¿t, Ä‘á»•i tÃªn hÃ m <code>it_works</code> sang má»™t tÃªn khÃ¡c, vÃ­ dá»¥ <code>exploration</code>, nhÆ° sau:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn add(left: u64, right: u64) -&gt; u64 {
    left + right
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn exploration() {
        let result = add(2, 2);
        assert_eq!(result, 4);
    }
}</code></pre>
<p>Sau Ä‘Ã³ cháº¡y láº¡i <code>cargo test</code> láº§n ná»¯a. Káº¿t quáº£ bÃ¢y giá» hiá»ƒn thá»‹ <code>exploration</code> thay vÃ¬ <code>it_works</code>:</p>
<pre><code class="language-console">$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.59s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 1 test
test tests::exploration ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>BÃ¢y giá» chÃºng ta sáº½ thÃªm má»™t hÃ m Ä‘á»ƒ kiá»ƒm tra khÃ¡c, nhÆ°ng láº§n nÃ y sáº½ táº¡o má»™t hÃ m Ä‘á»ƒ kiá»ƒm tra tháº¥t báº¡i! HÃ m kiá»ƒm tra sáº½ tháº¥t báº¡i khi cÃ³ Ä‘iá»u gÃ¬ Ä‘Ã³ trong hÃ m gÃ¢y ra <code>panic</code>. Má»—i hÃ m kiá»ƒm tra Ä‘Æ°á»£c cháº¡y trong má»™t thread má»›i, vÃ  khi thread chÃ­nh nháº­n tháº¥y má»™t thread kiá»ƒm tra Ä‘Ã£ káº¿t thÃºc, hÃ m kiá»ƒm tra Ä‘Ã³ sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  tháº¥t báº¡i. Trong ChÆ°Æ¡ng 9, chÃºng ta Ä‘Ã£ nÃ³i vá» cÃ¡ch Ä‘Æ¡n giáº£n nháº¥t Ä‘á»ƒ gÃ¢y <code>panic</code> lÃ  gá»i macro <code>panic!</code>.</p>
<p>Nháº­p hÃ m kiá»ƒm tra má»›i dÆ°á»›i dáº¡ng má»™t hÃ m tÃªn lÃ  <code>another</code>, sao cho file <em>src/lib.rs</em> cá»§a báº¡n trÃ´ng giá»‘ng nhÆ° Listing 11-3.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust panics noplayground"><span class="boring">pub fn add(left: u64, right: u64) -&gt; u64 {
</span><span class="boring">    left + right
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn exploration() {
</span><span class="boring">        let result = add(2, 2);
</span><span class="boring">        assert_eq!(result, 4);
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn another() {
</span><span class="boring">        panic!("Make this test fail");
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 11-3: ThÃªm má»™t hÃ m kiá»ƒm tra thá»© hai sáº½ tháº¥t báº¡i vÃ¬ chÃºng ta gá»i macro <code>panic!</code></span></p>
<p>Cháº¡y láº¡i cÃ¡c hÃ m kiá»ƒm tra báº±ng cÃ¡ch sá»­ dá»¥ng <code>cargo test</code>. Káº¿t quáº£ sáº½ trÃ´ng giá»‘ng nhÆ° Listing 11-4, cho tháº¥y hÃ m kiá»ƒm tra <code>exploration</code> cá»§a chÃºng ta Ä‘Ã£ thÃ nh cÃ´ng vÃ  <code>another</code> tháº¥t báº¡i.</p>
<pre><code class="language-console">$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.72s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 2 tests
test tests::another ... FAILED
test tests::exploration ... ok

failures:

---- tests::another stdout ----

thread 'tests::another' panicked at src/lib.rs:17:9:
Make this test fail
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::another

test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p><span class="caption">Listing 11-4: Káº¿t quáº£ kiá»ƒm tra khi má»™t hÃ m kiá»ƒm tra thÃ nh cÃ´ng vÃ  má»™t hÃ m kiá»ƒm tra tháº¥t báº¡i</span></p>
<p>Thay vÃ¬ hiá»ƒn thá»‹ <code>ok</code>, dÃ²ng <code>test tests::another</code> sáº½ hiá»ƒn thá»‹ <code>FAILED</code>. Hai pháº§n má»›i xuáº¥t hiá»‡n giá»¯a káº¿t quáº£ tá»«ng hÃ m kiá»ƒm tra vÃ  pháº§n tÃ³m táº¯t: pháº§n Ä‘áº§u tiÃªn hiá»ƒn thá»‹ lÃ½ do chi tiáº¿t cho má»—i lá»—i cá»§a hÃ m kiá»ƒm tra. Trong trÆ°á»ng há»£p nÃ y, chÃºng ta nháº­n Ä‘Æ°á»£c chi tiáº¿t ráº±ng hÃ m <code>another</code> tháº¥t báº¡i vÃ¬ nÃ³ <code>panicked at 'Make this test fail'</code> á»Ÿ dÃ²ng 10 trong file <em>src/lib.rs</em>. Pháº§n tiáº¿p theo chá»‰ liá»‡t kÃª tÃªn cá»§a táº¥t cáº£ cÃ¡c hÃ m kiá»ƒm tra tháº¥t báº¡i, Ä‘iá»u nÃ y há»¯u Ã­ch khi cÃ³ nhiá»u hÃ m kiá»ƒm tra vÃ  nhiá»u káº¿t quáº£ lá»—i chi tiáº¿t. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng tÃªn cá»§a hÃ m kiá»ƒm tra tháº¥t báº¡i Ä‘á»ƒ cháº¡y riÃªng hÃ m Ä‘Ã³, giÃºp gá»¡ lá»—i dá»… hÆ¡n; chÃºng ta sáº½ bÃ n ká»¹ hÆ¡n vá» cÃ¡c cÃ¡ch cháº¡y kiá»ƒm tra trong pháº§n <a href="ch11-02-running-tests.html#controlling-how-tests-are-run">â€œControlling How Tests Are Runâ€</a><!-- ignore -->.</p>
<p>DÃ²ng tÃ³m táº¯t xuáº¥t hiá»‡n á»Ÿ cuá»‘i: tá»•ng thá»ƒ, káº¿t quáº£ kiá»ƒm tra cá»§a chÃºng ta lÃ  <code>FAILED</code>. ChÃºng ta cÃ³ má»™t hÃ m kiá»ƒm tra thÃ nh cÃ´ng vÃ  má»™t hÃ m kiá»ƒm tra tháº¥t báº¡i.</p>
<p>BÃ¢y giá» khi báº¡n Ä‘Ã£ tháº¥y káº¿t quáº£ kiá»ƒm tra trÃ´ng nhÆ° tháº¿ nÃ o trong cÃ¡c ká»‹ch báº£n khÃ¡c nhau, hÃ£y cÃ¹ng xem má»™t sá»‘ macro khÃ¡c ngoÃ i <code>panic!</code> mÃ  há»¯u Ã­ch trong cÃ¡c hÃ m kiá»ƒm tra.</p>
<h3 id="kiá»ƒm-tra-káº¿t-quáº£-vá»›i-macro-assert"><a class="header" href="#kiá»ƒm-tra-káº¿t-quáº£-vá»›i-macro-assert">Kiá»ƒm tra káº¿t quáº£ vá»›i macro <code>assert!</code></a></h3>
<p>Macro <code>assert!</code>, Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n chuáº©n, há»¯u Ã­ch khi báº¡n muá»‘n Ä‘áº£m báº£o ráº±ng má»™t Ä‘iá»u kiá»‡n trong hÃ m kiá»ƒm tra Ä‘Ã¡nh giÃ¡ lÃ  <code>true</code>. ChÃºng ta truyá»n cho macro <code>assert!</code> má»™t biá»ƒu thá»©c tráº£ vá» Boolean. Náº¿u giÃ¡ trá»‹ lÃ  <code>true</code>, khÃ´ng cÃ³ gÃ¬ xáº£y ra vÃ  hÃ m kiá»ƒm tra thÃ nh cÃ´ng. Náº¿u giÃ¡ trá»‹ lÃ  <code>false</code>, macro <code>assert!</code> gá»i <code>panic!</code> Ä‘á»ƒ lÃ m cho hÃ m kiá»ƒm tra tháº¥t báº¡i. Sá»­ dá»¥ng macro <code>assert!</code> giÃºp chÃºng ta kiá»ƒm tra ráº±ng mÃ£ cá»§a mÃ¬nh hoáº¡t Ä‘á»™ng theo Ä‘Ãºng Ã½ Ä‘á»‹nh.</p>
<p>Trong ChÆ°Æ¡ng 5, Listing 5-15, chÃºng ta Ä‘Ã£ sá»­ dá»¥ng struct <code>Rectangle</code> vÃ  phÆ°Æ¡ng thá»©c <code>can_hold</code>, Ä‘Æ°á»£c láº·p láº¡i á»Ÿ Ä‘Ã¢y trong Listing 11-5. HÃ£y Ä‘áº·t Ä‘oáº¡n mÃ£ nÃ y vÃ o file <em>src/lib.rs</em>, sau Ä‘Ã³ viáº¿t má»™t sá»‘ hÃ m kiá»ƒm tra cho nÃ³ báº±ng cÃ¡ch sá»­ dá»¥ng macro <code>assert!</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Rectangle {
</span><span class="boring">    width: u32,
</span><span class="boring">    height: u32,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Rectangle {
</span><span class="boring">    fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool {
</span><span class="boring">        self.width &gt; other.width &amp;&amp; self.height &gt; other.height
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 11-5: Sá»­ dá»¥ng struct <code>Rectangle</code> vÃ  phÆ°Æ¡ng thá»©c <code>can_hold</code> tá»« ChÆ°Æ¡ng 5</span></p>
<p>PhÆ°Æ¡ng thá»©c <code>can_hold</code> tráº£ vá» má»™t giÃ¡ trá»‹ Boolean, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  nÃ³ lÃ  má»™t trÆ°á»ng há»£p sá»­ dá»¥ng hoÃ n háº£o cho macro <code>assert!</code>. Trong Listing 11-6, chÃºng ta viáº¿t má»™t hÃ m kiá»ƒm tra Ä‘á»ƒ thá»­ phÆ°Æ¡ng thá»©c <code>can_hold</code> báº±ng cÃ¡ch táº¡o má»™t instance cá»§a <code>Rectangle</code> cÃ³ chiá»u rá»™ng 8 vÃ  chiá»u cao 7, vÃ  xÃ¡c nháº­n ráº±ng nÃ³ cÃ³ thá»ƒ chá»©a má»™t instance khÃ¡c cá»§a <code>Rectangle</code> cÃ³ chiá»u rá»™ng 5 vÃ  chiá»u cao 1.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Rectangle {
</span><span class="boring">    width: u32,
</span><span class="boring">    height: u32,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Rectangle {
</span><span class="boring">    fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool {
</span><span class="boring">        self.width &gt; other.width &amp;&amp; self.height &gt; other.height
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn larger_can_hold_smaller() {
        let larger = Rectangle {
            width: 8,
            height: 7,
        };
        let smaller = Rectangle {
            width: 5,
            height: 1,
        };

        assert!(larger.can_hold(&amp;smaller));
    }
}</code></pre>
<p><span class="caption">Listing 11-6: Má»™t hÃ m kiá»ƒm tra <code>can_hold</code> xÃ¡c Ä‘á»‹nh xem má»™t hÃ¬nh chá»¯ nháº­t lá»›n hÆ¡n cÃ³ thá»ƒ chá»©a má»™t hÃ¬nh chá»¯ nháº­t nhá» hÆ¡n hay khÃ´ng</span></p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta Ä‘Ã£ thÃªm má»™t dÃ²ng má»›i bÃªn trong module <code>tests</code>: <code>use super::*;</code>. Module <code>tests</code> lÃ  má»™t module bÃ¬nh thÆ°á»ng tuÃ¢n theo cÃ¡c quy táº¯c hiá»ƒn thá»‹ thÃ´ng thÆ°á»ng mÃ  chÃºng ta Ä‘Ã£ Ä‘á» cáº­p trong ChÆ°Æ¡ng 7 á»Ÿ pháº§n <a href="ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html">â€œPaths for Referring to an Item in the Module Treeâ€</a><!-- ignore -->. VÃ¬ module <code>tests</code> lÃ  má»™t inner module, chÃºng ta cáº§n Ä‘Æ°a mÃ£ Ä‘ang kiá»ƒm tra trong module bÃªn ngoÃ i vÃ o pháº¡m vi cá»§a inner module. á» Ä‘Ã¢y chÃºng ta sá»­ dá»¥ng glob Ä‘á»ƒ báº¥t ká»³ thá»© gÃ¬ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong module bÃªn ngoÃ i cÅ©ng cÃ³ sáºµn cho module <code>tests</code>.</p>
<p>ChÃºng ta Ä‘áº·t tÃªn cho hÃ m kiá»ƒm tra lÃ  <code>larger_can_hold_smaller</code>, vÃ  Ä‘Ã£ táº¡o hai instance cá»§a <code>Rectangle</code> cáº§n thiáº¿t. Sau Ä‘Ã³ chÃºng ta gá»i macro <code>assert!</code> vÃ  truyá»n vÃ o káº¿t quáº£ cá»§a viá»‡c gá»i <code>larger.can_hold(&amp;smaller)</code>. Biá»ƒu thá»©c nÃ y dá»± kiáº¿n tráº£ vá» <code>true</code>, vÃ¬ váº­y hÃ m kiá»ƒm tra cá»§a chÃºng ta nÃªn thÃ nh cÃ´ng. HÃ£y cÃ¹ng kiá»ƒm tra!</p>
<pre><code class="language-console">$ cargo test
   Compiling rectangle v0.1.0 (file:///projects/rectangle)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.66s
     Running unittests src/lib.rs (target/debug/deps/rectangle-6584c4561e48942e)

running 1 test
test tests::larger_can_hold_smaller ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests rectangle

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>NÃ³ Ä‘Ã£ thÃ nh cÃ´ng! BÃ¢y giá» hÃ£y thÃªm má»™t hÃ m kiá»ƒm tra khÃ¡c, láº§n nÃ y xÃ¡c nháº­n ráº±ng má»™t hÃ¬nh chá»¯ nháº­t nhá» hÆ¡n <strong>khÃ´ng thá»ƒ</strong> chá»©a má»™t hÃ¬nh chá»¯ nháº­t lá»›n hÆ¡n:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Rectangle {
</span><span class="boring">    width: u32,
</span><span class="boring">    height: u32,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Rectangle {
</span><span class="boring">    fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool {
</span><span class="boring">        self.width &gt; other.width &amp;&amp; self.height &gt; other.height
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn larger_can_hold_smaller() {
        // --snip--
<span class="boring">        let larger = Rectangle {
</span><span class="boring">            width: 8,
</span><span class="boring">            height: 7,
</span><span class="boring">        };
</span><span class="boring">        let smaller = Rectangle {
</span><span class="boring">            width: 5,
</span><span class="boring">            height: 1,
</span><span class="boring">        };
</span><span class="boring">
</span><span class="boring">        assert!(larger.can_hold(&amp;smaller));
</span>    }

    #[test]
    fn smaller_cannot_hold_larger() {
        let larger = Rectangle {
            width: 8,
            height: 7,
        };
        let smaller = Rectangle {
            width: 5,
            height: 1,
        };

        assert!(!smaller.can_hold(&amp;larger));
    }
}</code></pre>
<p>Bá»Ÿi vÃ¬ káº¿t quáº£ Ä‘Ãºng cá»§a hÃ m <code>can_hold</code> trong trÆ°á»ng há»£p nÃ y lÃ  <code>false</code>, chÃºng ta cáº§n phá»§ Ä‘á»‹nh káº¿t quáº£ Ä‘Ã³ trÆ°á»›c khi truyá»n nÃ³ vÃ o macro <code>assert!</code>. Káº¿t quáº£ lÃ , hÃ m kiá»ƒm tra cá»§a chÃºng ta sáº½ thÃ nh cÃ´ng náº¿u <code>can_hold</code> tráº£ vá» <code>false</code>:</p>
<pre><code class="language-console">$ cargo test
   Compiling rectangle v0.1.0 (file:///projects/rectangle)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.66s
     Running unittests src/lib.rs (target/debug/deps/rectangle-6584c4561e48942e)

running 2 tests
test tests::larger_can_hold_smaller ... ok
test tests::smaller_cannot_hold_larger ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests rectangle

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>Hai hÃ m kiá»ƒm tra Ä‘á»u thÃ nh cÃ´ng! BÃ¢y giá» hÃ£y xem Ä‘iá»u gÃ¬ sáº½ xáº£y ra vá»›i káº¿t quáº£ kiá»ƒm tra khi chÃºng ta giá»›i thiá»‡u má»™t lá»—i trong mÃ£ cá»§a mÃ¬nh. ChÃºng ta sáº½ thay Ä‘á»•i cÃ i Ä‘áº·t cá»§a phÆ°Æ¡ng thá»©c <code>can_hold</code> báº±ng cÃ¡ch thay dáº¥u lá»›n hÆ¡n (<code>&gt;</code>) báº±ng dáº¥u nhá» hÆ¡n (<code>&lt;</code>) khi so sÃ¡nh chiá»u rá»™ng:</p>
<pre><code class="language-rust not_desired_behavior noplayground"><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Rectangle {
</span><span class="boring">    width: u32,
</span><span class="boring">    height: u32,
</span><span class="boring">}
</span><span class="boring">
</span>// --snip--
impl Rectangle {
    fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool {
        self.width &lt; other.width &amp;&amp; self.height &gt; other.height
    }
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn larger_can_hold_smaller() {
</span><span class="boring">        let larger = Rectangle {
</span><span class="boring">            width: 8,
</span><span class="boring">            height: 7,
</span><span class="boring">        };
</span><span class="boring">        let smaller = Rectangle {
</span><span class="boring">            width: 5,
</span><span class="boring">            height: 1,
</span><span class="boring">        };
</span><span class="boring">
</span><span class="boring">        assert!(larger.can_hold(&amp;smaller));
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn smaller_cannot_hold_larger() {
</span><span class="boring">        let larger = Rectangle {
</span><span class="boring">            width: 8,
</span><span class="boring">            height: 7,
</span><span class="boring">        };
</span><span class="boring">        let smaller = Rectangle {
</span><span class="boring">            width: 5,
</span><span class="boring">            height: 1,
</span><span class="boring">        };
</span><span class="boring">
</span><span class="boring">        assert!(!smaller.can_hold(&amp;larger));
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Cháº¡y cÃ¡c hÃ m kiá»ƒm tra bÃ¢y giá» sáº½ cho káº¿t quáº£ nhÆ° sau:</p>
<pre><code class="language-console">$ cargo test
   Compiling rectangle v0.1.0 (file:///projects/rectangle)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.66s
     Running unittests src/lib.rs (target/debug/deps/rectangle-6584c4561e48942e)

running 2 tests
test tests::larger_can_hold_smaller ... FAILED
test tests::smaller_cannot_hold_larger ... ok

failures:

---- tests::larger_can_hold_smaller stdout ----

thread 'tests::larger_can_hold_smaller' panicked at src/lib.rs:28:9:
assertion failed: larger.can_hold(&amp;smaller)
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::larger_can_hold_smaller

test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p>CÃ¡c hÃ m kiá»ƒm tra cá»§a chÃºng ta Ä‘Ã£ phÃ¡t hiá»‡n ra lá»—i! Bá»Ÿi vÃ¬ <code>larger.width</code> lÃ  8 vÃ  <code>smaller.width</code> lÃ  5, so sÃ¡nh chiá»u rá»™ng trong <code>can_hold</code> bÃ¢y giá» tráº£ vá» <code>false</code>: 8 khÃ´ng nhá» hÆ¡n 5.</p>
<h3 id="kiá»ƒm-tra-báº±ng-macro-assert_eq-vÃ -assert_ne"><a class="header" href="#kiá»ƒm-tra-báº±ng-macro-assert_eq-vÃ -assert_ne">Kiá»ƒm tra báº±ng macro <code>assert_eq!</code> vÃ  <code>assert_ne!</code></a></h3>
<p>Má»™t cÃ¡ch phá»• biáº¿n Ä‘á»ƒ xÃ¡c minh chá»©c nÄƒng lÃ  kiá»ƒm tra sá»± báº±ng nhau giá»¯a káº¿t quáº£ cá»§a mÃ£ Ä‘ang kiá»ƒm tra vÃ  giÃ¡ trá»‹ mÃ  báº¡n mong mÃ£ tráº£ vá». Báº¡n cÃ³ thá»ƒ lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng macro <code>assert!</code> vÃ  truyá»n cho nÃ³ má»™t biá»ƒu thá»©c sá»­ dá»¥ng toÃ¡n tá»­ <code>==</code>. Tuy nhiÃªn, Ä‘Ã¢y lÃ  má»™t kiá»ƒu kiá»ƒm tra ráº¥t phá»• biáº¿n nÃªn thÆ° viá»‡n chuáº©n cung cáº¥p má»™t cáº·p macro â€” <code>assert_eq!</code> vÃ  <code>assert_ne!</code> â€” Ä‘á»ƒ thá»±c hiá»‡n kiá»ƒm tra nÃ y thuáº­n tiá»‡n hÆ¡n. CÃ¡c macro nÃ y so sÃ¡nh hai Ä‘á»‘i sá»‘ Ä‘á»ƒ kiá»ƒm tra báº±ng nhau hoáº·c khÃ´ng báº±ng nhau, tÆ°Æ¡ng á»©ng. ChÃºng cÅ©ng sáº½ in ra hai giÃ¡ trá»‹ náº¿u phÃ©p kiá»ƒm tra tháº¥t báº¡i, giÃºp dá»… dÃ ng nháº­n tháº¥y <em>táº¡i sao</em> hÃ m kiá»ƒm tra tháº¥t báº¡i; ngÆ°á»£c láº¡i, macro <code>assert!</code> chá»‰ cho biáº¿t ráº±ng biá»ƒu thá»©c <code>==</code> tráº£ vá» <code>false</code>, mÃ  khÃ´ng in ra cÃ¡c giÃ¡ trá»‹ dáº«n Ä‘áº¿n <code>false</code>.</p>
<p>Trong Listing 11-7, chÃºng ta viáº¿t má»™t hÃ m tÃªn lÃ  <code>add_two</code> Ä‘á»ƒ cá»™ng <code>2</code> vÃ o tham sá»‘ cá»§a nÃ³, sau Ä‘Ã³ kiá»ƒm tra hÃ m nÃ y báº±ng macro <code>assert_eq!</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn add_two(a: u64) -&gt; u64 {
    a + 2
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn it_adds_two() {
        let result = add_two(2);
        assert_eq!(result, 4);
    }
}</code></pre>
<p><span class="caption">Listing 11-7: Kiá»ƒm tra hÃ m <code>add_two</code> báº±ng macro <code>assert_eq!</code></span></p>
<p>HÃ£y kiá»ƒm tra xem nÃ³ cÃ³ thÃ nh cÃ´ng khÃ´ng!</p>
<pre><code class="language-console">$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.58s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 1 test
test tests::it_adds_two ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>ChÃºng ta truyá»n <code>4</code> lÃ m Ä‘á»‘i sá»‘ cho <code>assert_eq!</code>, báº±ng vá»›i káº¿t quáº£ cá»§a viá»‡c gá»i <code>add_two(2)</code>. DÃ²ng cho hÃ m kiá»ƒm tra nÃ y lÃ  <code>test tests::it_adds_two ... ok</code>, vÃ  chá»¯ <code>ok</code> cho tháº¥y hÃ m kiá»ƒm tra cá»§a chÃºng ta Ä‘Ã£ thÃ nh cÃ´ng!</p>
<p>HÃ£y giá»›i thiá»‡u má»™t lá»—i vÃ o mÃ£ cá»§a chÃºng ta Ä‘á»ƒ xem <code>assert_eq!</code> trÃ´ng nhÆ° tháº¿ nÃ o khi tháº¥t báº¡i. Thay Ä‘á»•i cÃ i Ä‘áº·t cá»§a hÃ m <code>add_two</code> Ä‘á»ƒ thay vÃ o Ä‘Ã³ cá»™ng <code>3</code>:</p>
<pre><code class="language-rust not_desired_behavior noplayground">pub fn add_two(a: u64) -&gt; u64 {
    a + 3
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn it_adds_two() {
</span><span class="boring">        let result = add_two(2);
</span><span class="boring">        assert_eq!(result, 4);
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Cháº¡y láº¡i cÃ¡c hÃ m kiá»ƒm tra:</p>
<pre><code class="language-console">$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.61s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 1 test
test tests::it_adds_two ... FAILED

failures:

---- tests::it_adds_two stdout ----

thread 'tests::it_adds_two' panicked at src/lib.rs:12:9:
assertion `left == right` failed
  left: 5
 right: 4
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::it_adds_two

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p>CÃ¡c hÃ m kiá»ƒm tra cá»§a chÃºng ta Ä‘Ã£ phÃ¡t hiá»‡n ra lá»—i! HÃ m kiá»ƒm tra <code>it_adds_two</code> tháº¥t báº¡i, vÃ  thÃ´ng bÃ¡o cho chÃºng ta biáº¿t phÃ©p kiá»ƒm tra tháº¥t báº¡i lÃ  <code>assertion failed: `(left == right)`</code> cÃ¹ng vá»›i giÃ¡ trá»‹ cá»§a <code>left</code> vÃ  <code>right</code>. ThÃ´ng bÃ¡o nÃ y giÃºp chÃºng ta báº¯t Ä‘áº§u gá»¡ lá»—i: Ä‘á»‘i sá»‘ <code>left</code> lÃ  <code>4</code> nhÆ°ng Ä‘á»‘i sá»‘ <code>right</code>, nÆ¡i chÃºng ta gá»i <code>add_two(2)</code>, lÃ  <code>5</code>. Báº¡n cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng Ä‘iá»u nÃ y Ä‘áº·c biá»‡t há»¯u Ã­ch khi chÃºng ta cÃ³ nhiá»u hÃ m kiá»ƒm tra.</p>
<p>LÆ°u Ã½ ráº±ng trong má»™t sá»‘ ngÃ´n ngá»¯ vÃ  framework kiá»ƒm tra, cÃ¡c tham sá»‘ cá»§a hÃ m kiá»ƒm tra báº±ng nhau Ä‘Æ°á»£c gá»i lÃ  <code>expected</code> vÃ  <code>actual</code>, vÃ  thá»© tá»± truyá»n Ä‘á»‘i sá»‘ ráº¥t quan trá»ng. Tuy nhiÃªn, trong Rust, chÃºng Ä‘Æ°á»£c gá»i lÃ  <code>left</code> vÃ  <code>right</code>, vÃ  thá»© tá»± chÃºng ta chá»‰ Ä‘á»‹nh giÃ¡ trá»‹ mong Ä‘á»£i vÃ  giÃ¡ trá»‹ mÃ  mÃ£ tráº£ vá» <strong>khÃ´ng quan trá»ng</strong>. ChÃºng ta cÃ³ thá»ƒ viáº¿t phÃ©p kiá»ƒm tra trong vÃ­ dá»¥ nÃ y lÃ  <code>assert_eq!(add_two(2), 4)</code>, vÃ  káº¿t quáº£ sáº½ giá»‘ng nhau vá»›i thÃ´ng bÃ¡o tháº¥t báº¡i <code>assertion failed: `(left == right)`</code>.</p>
<p>Macro <code>assert_ne!</code> sáº½ thÃ nh cÃ´ng náº¿u hai giÃ¡ trá»‹ khÃ´ng báº±ng nhau vÃ  tháº¥t báº¡i náº¿u chÃºng báº±ng nhau. Macro nÃ y há»¯u Ã­ch nháº¥t khi chÃºng ta khÃ´ng cháº¯c giÃ¡ trá»‹ <em>sáº½</em> lÃ  gÃ¬, nhÆ°ng chÃºng ta biáº¿t giÃ¡ trá»‹ Ä‘Ã³ cháº¯c cháº¯n <em>khÃ´ng nÃªn</em> lÃ  gÃ¬. VÃ­ dá»¥, náº¿u chÃºng ta kiá»ƒm tra má»™t hÃ m Ä‘áº£m báº£o thay Ä‘á»•i Ä‘áº§u vÃ o theo má»™t cÃ¡ch nÃ o Ä‘Ã³, nhÆ°ng cÃ¡ch thay Ä‘á»•i phá»¥ thuá»™c vÃ o ngÃ y trong tuáº§n khi cháº¡y kiá»ƒm tra, Ä‘iá»u tá»‘t nháº¥t Ä‘á»ƒ kiá»ƒm tra cÃ³ thá»ƒ lÃ  Ä‘áº§u ra cá»§a hÃ m khÃ´ng báº±ng Ä‘áº§u vÃ o.</p>
<p>á» má»©c cÆ¡ báº£n, cÃ¡c macro <code>assert_eq!</code> vÃ  <code>assert_ne!</code> sá»­ dá»¥ng cÃ¡c toÃ¡n tá»­ <code>==</code> vÃ  <code>!=</code>, tÆ°Æ¡ng á»©ng. Khi cÃ¡c phÃ©p kiá»ƒm tra tháº¥t báº¡i, cÃ¡c macro nÃ y in cÃ¡c Ä‘á»‘i sá»‘ báº±ng <strong>debug formatting</strong>, nghÄ©a lÃ  cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c so sÃ¡nh pháº£i triá»ƒn khai cÃ¡c trait <code>PartialEq</code> vÃ  <code>Debug</code>. Táº¥t cáº£ cÃ¡c kiá»ƒu nguyÃªn thá»§y vÃ  háº§u háº¿t cÃ¡c kiá»ƒu trong thÆ° viá»‡n chuáº©n Ä‘á»u triá»ƒn khai cÃ¡c trait nÃ y. Äá»‘i vá»›i cÃ¡c struct vÃ  enum do báº¡n Ä‘á»‹nh nghÄ©a, báº¡n cáº§n triá»ƒn khai <code>PartialEq</code> Ä‘á»ƒ kiá»ƒm tra sá»± báº±ng nhau cá»§a cÃ¡c kiá»ƒu Ä‘Ã³. Báº¡n cÅ©ng cáº§n triá»ƒn khai <code>Debug</code> Ä‘á»ƒ in giÃ¡ trá»‹ khi phÃ©p kiá»ƒm tra tháº¥t báº¡i. VÃ¬ cáº£ hai trait Ä‘á»u cÃ³ thá»ƒ Ä‘Æ°á»£c derive, nhÆ° Ä‘Ã£ Ä‘á» cáº­p trong Listing 5-12 á»Ÿ ChÆ°Æ¡ng 5, Ä‘iá»u nÃ y thÆ°á»ng Ä‘Æ¡n giáº£n chá»‰ cáº§n thÃªm annotation <code>#[derive(PartialEq, Debug)]</code> vÃ o Ä‘á»‹nh nghÄ©a struct hoáº·c enum cá»§a báº¡n. Xem Phá»¥ lá»¥c C, <a href="appendix-03-derivable-traits.html">â€œDerivable Traits,â€</a><!-- ignore --> Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá» cÃ¡c trait cÃ³ thá»ƒ derive vÃ  cÃ¡c trait khÃ¡c.</p>
<h3 id="thÃªm-thÃ´ng-bÃ¡o-lá»—i-tÃ¹y-chá»‰nh"><a class="header" href="#thÃªm-thÃ´ng-bÃ¡o-lá»—i-tÃ¹y-chá»‰nh">ThÃªm thÃ´ng bÃ¡o lá»—i tÃ¹y chá»‰nh</a></h3>
<p>Báº¡n cÅ©ng cÃ³ thá»ƒ thÃªm thÃ´ng bÃ¡o tÃ¹y chá»‰nh Ä‘Æ°á»£c in cÃ¹ng vá»›i thÃ´ng bÃ¡o tháº¥t báº¡i nhÆ° cÃ¡c Ä‘á»‘i sá»‘ tÃ¹y chá»n cho cÃ¡c macro <code>assert!</code>, <code>assert_eq!</code>, vÃ  <code>assert_ne!</code>. Báº¥t ká»³ Ä‘á»‘i sá»‘ nÃ o Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh sau cÃ¡c Ä‘á»‘i sá»‘ báº¯t buá»™c sáº½ Ä‘Æ°á»£c chuyá»ƒn cho macro <code>format!</code> (Ä‘Æ°á»£c tháº£o luáº­n trong ChÆ°Æ¡ng 8 á»Ÿ pháº§n <a href="ch08-02-strings.html#concatenation-with-the--operator-or-the-format-macro">â€œConcatenation with the <code>+</code> Operator or the <code>format!</code> Macroâ€</a><!-- ignore -->), vÃ¬ váº­y báº¡n cÃ³ thá»ƒ truyá»n má»™t chuá»—i Ä‘á»‹nh dáº¡ng chá»©a cÃ¡c placeholder <code>{}</code> vÃ  cÃ¡c giÃ¡ trá»‹ Ä‘á»ƒ Ä‘iá»n vÃ o Ä‘Ã³. ThÃ´ng bÃ¡o tÃ¹y chá»‰nh há»¯u Ã­ch Ä‘á»ƒ ghi chÃº Ã½ nghÄ©a cá»§a má»™t phÃ©p kiá»ƒm tra; khi má»™t hÃ m kiá»ƒm tra tháº¥t báº¡i, báº¡n sáº½ dá»… dÃ ng biáº¿t váº¥n Ä‘á» lÃ  gÃ¬ trong mÃ£.</p>
<p>VÃ­ dá»¥, giáº£ sá»­ chÃºng ta cÃ³ má»™t hÃ m chÃ o ngÆ°á»i theo tÃªn vÃ  muá»‘n kiá»ƒm tra ráº±ng tÃªn truyá»n vÃ o hÃ m xuáº¥t hiá»‡n trong Ä‘áº§u ra:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn greeting(name: &amp;str) -&gt; String {
    format!("Hello {name}!")
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn greeting_contains_name() {
        let result = greeting("Carol");
        assert!(result.contains("Carol"));
    }
}</code></pre>
<p>CÃ¡c yÃªu cáº§u cho chÆ°Æ¡ng trÃ¬nh nÃ y váº«n chÆ°a Ä‘Æ°á»£c thá»‘ng nháº¥t, vÃ  chÃºng ta khÃ¡ cháº¯c ráº±ng Ä‘oáº¡n vÄƒn báº£n <code>Hello</code> á»Ÿ Ä‘áº§u lá»i chÃ o sáº½ thay Ä‘á»•i. ChÃºng ta quyáº¿t Ä‘á»‹nh khÃ´ng muá»‘n pháº£i cáº­p nháº­t hÃ m kiá»ƒm tra khi cÃ¡c yÃªu cáº§u thay Ä‘á»•i, vÃ¬ váº­y thay vÃ¬ kiá»ƒm tra sá»± báº±ng nhau chÃ­nh xÃ¡c vá»›i giÃ¡ trá»‹ tráº£ vá» tá»« hÃ m <code>greeting</code>, chÃºng ta chá»‰ xÃ¡c nháº­n ráº±ng Ä‘áº§u ra chá»©a vÄƒn báº£n cá»§a tham sá»‘ Ä‘áº§u vÃ o.</p>
<p>BÃ¢y giá» hÃ£y giá»›i thiá»‡u má»™t lá»—i vÃ o mÃ£ nÃ y báº±ng cÃ¡ch thay Ä‘á»•i hÃ m <code>greeting</code> Ä‘á»ƒ bá» qua <code>name</code> Ä‘á»ƒ xem thÃ´ng bÃ¡o tháº¥t báº¡i máº·c Ä‘á»‹nh cá»§a hÃ m kiá»ƒm tra trÃ´ng nhÆ° tháº¿ nÃ o:</p>
<pre><code class="language-rust not_desired_behavior noplayground">pub fn greeting(name: &amp;str) -&gt; String {
    String::from("Hello!")
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn greeting_contains_name() {
</span><span class="boring">        let result = greeting("Carol");
</span><span class="boring">        assert!(result.contains("Carol"));
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Cháº¡y hÃ m kiá»ƒm tra nÃ y sáº½ cho káº¿t quáº£ nhÆ° sau:</p>
<pre><code class="language-console">$ cargo test
   Compiling greeter v0.1.0 (file:///projects/greeter)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.91s
     Running unittests src/lib.rs (target/debug/deps/greeter-170b942eb5bf5e3a)

running 1 test
test tests::greeting_contains_name ... FAILED

failures:

---- tests::greeting_contains_name stdout ----

thread 'tests::greeting_contains_name' panicked at src/lib.rs:12:9:
assertion failed: result.contains("Carol")
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::greeting_contains_name

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p>Káº¿t quáº£ nÃ y chá»‰ cho biáº¿t ráº±ng phÃ©p kiá»ƒm tra tháº¥t báº¡i vÃ  dÃ²ng chá»©a phÃ©p kiá»ƒm tra Ä‘Ã³. Má»™t thÃ´ng bÃ¡o tháº¥t báº¡i há»¯u Ã­ch hÆ¡n sáº½ in giÃ¡ trá»‹ tráº£ vá» tá»« hÃ m <code>greeting</code>. HÃ£y thÃªm má»™t thÃ´ng bÃ¡o tháº¥t báº¡i tÃ¹y chá»‰nh gá»“m má»™t chuá»—i Ä‘á»‹nh dáº¡ng vá»›i placeholder Ä‘Æ°á»£c Ä‘iá»n báº±ng giÃ¡ trá»‹ thá»±c táº¿ mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c tá»« hÃ m <code>greeting</code>:</p>
<pre><code class="language-rust ignore"><span class="boring">pub fn greeting(name: &amp;str) -&gt; String {
</span><span class="boring">    String::from("Hello!")
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span>    #[test]
    fn greeting_contains_name() {
        let result = greeting("Carol");
        assert!(
            result.contains("Carol"),
            "Greeting did not contain name, value was `{result}`"
        );
    }
<span class="boring">}</span></code></pre>
<p>BÃ¢y giá» khi chÃºng ta cháº¡y hÃ m kiá»ƒm tra, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c má»™t thÃ´ng bÃ¡o lá»—i chi tiáº¿t hÆ¡n:</p>
<pre><code class="language-console">$ cargo test
   Compiling greeter v0.1.0 (file:///projects/greeter)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.93s
     Running unittests src/lib.rs (target/debug/deps/greeter-170b942eb5bf5e3a)

running 1 test
test tests::greeting_contains_name ... FAILED

failures:

---- tests::greeting_contains_name stdout ----

thread 'tests::greeting_contains_name' panicked at src/lib.rs:12:9:
Greeting did not contain name, value was `Hello!`
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::greeting_contains_name

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p>ChÃºng ta cÃ³ thá»ƒ tháº¥y giÃ¡ trá»‹ thá»±c táº¿ mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c trong káº¿t quáº£ kiá»ƒm tra, Ä‘iá»u nÃ y sáº½ giÃºp gá»¡ lá»—i xem chuyá»‡n gÃ¬ Ä‘Ã£ xáº£y ra thay vÃ¬ nhá»¯ng gÃ¬ chÃºng ta mong Ä‘á»£i.</p>
<h3 id="kiá»ƒm-tra-panic-vá»›i-should_panic"><a class="header" href="#kiá»ƒm-tra-panic-vá»›i-should_panic">Kiá»ƒm tra panic vá»›i <code>should_panic</code></a></h3>
<p>NgoÃ i viá»‡c kiá»ƒm tra giÃ¡ trá»‹ tráº£ vá», viá»‡c kiá»ƒm tra ráº±ng mÃ£ cá»§a chÃºng ta xá»­ lÃ½ cÃ¡c Ä‘iá»u kiá»‡n lá»—i nhÆ° mong Ä‘á»£i cÅ©ng ráº¥t quan trá»ng. VÃ­ dá»¥, hÃ£y xem xÃ©t kiá»ƒu <code>Guess</code> mÃ  chÃºng ta Ä‘Ã£ táº¡o trong ChÆ°Æ¡ng 9, Listing 9-13. CÃ¡c Ä‘oáº¡n mÃ£ khÃ¡c sá»­ dá»¥ng <code>Guess</code> phá»¥ thuá»™c vÃ o Ä‘áº£m báº£o ráº±ng cÃ¡c instance cá»§a <code>Guess</code> chá»‰ chá»©a cÃ¡c giÃ¡ trá»‹ tá»« 1 Ä‘áº¿n 100. ChÃºng ta cÃ³ thá»ƒ viáº¿t má»™t hÃ m kiá»ƒm tra Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng viá»‡c cá»‘ gáº¯ng táº¡o má»™t instance cá»§a <code>Guess</code> vá»›i giÃ¡ trá»‹ ngoÃ i khoáº£ng Ä‘Ã³ sáº½ gÃ¢y panic.</p>
<p>ChÃºng ta lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch thÃªm attribute <code>should_panic</code> vÃ o hÃ m kiá»ƒm tra. HÃ m kiá»ƒm tra sáº½ thÃ nh cÃ´ng náº¿u mÃ£ bÃªn trong hÃ m gÃ¢y panic; hÃ m kiá»ƒm tra sáº½ tháº¥t báº¡i náº¿u mÃ£ bÃªn trong hÃ m khÃ´ng gÃ¢y panic.</p>
<p>Listing 11-8 hiá»ƒn thá»‹ má»™t hÃ m kiá»ƒm tra Ä‘áº£m báº£o ráº±ng cÃ¡c Ä‘iá»u kiá»‡n lá»—i cá»§a <code>Guess::new</code> xáº£y ra khi chÃºng ta mong Ä‘á»£i.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub struct Guess {
    value: i32,
}

impl Guess {
    pub fn new(value: i32) -&gt; Guess {
        if value &lt; 1 || value &gt; 100 {
            panic!("Guess value must be between 1 and 100, got {value}.");
        }

        Guess { value }
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    #[should_panic]
    fn greater_than_100() {
        Guess::new(200);
    }
}</code></pre>
<p><span class="caption">Listing 11-8: Kiá»ƒm tra ráº±ng má»™t Ä‘iá»u kiá»‡n sáº½ gÃ¢y ra <code>panic!</code></span></p>
<p>ChÃºng ta Ä‘áº·t attribute <code>#[should_panic]</code> sau attribute <code>#[test]</code> vÃ  trÆ°á»›c hÃ m kiá»ƒm tra mÃ  nÃ³ Ã¡p dá»¥ng. HÃ£y xem káº¿t quáº£ khi hÃ m kiá»ƒm tra nÃ y thÃ nh cÃ´ng:</p>
<pre><code class="language-console">$ cargo test
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.58s
     Running unittests src/lib.rs (target/debug/deps/guessing_game-57d70c3acb738f4d)

running 1 test
test tests::greater_than_100 - should panic ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests guessing_game

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>TrÃ´ng á»•n rá»“i! BÃ¢y giá» hÃ£y giá»›i thiá»‡u má»™t lá»—i vÃ o mÃ£ cá»§a chÃºng ta báº±ng cÃ¡ch loáº¡i bá» Ä‘iá»u kiá»‡n mÃ  hÃ m <code>new</code> sáº½ panic náº¿u giÃ¡ trá»‹ lá»›n hÆ¡n 100:</p>
<pre><code class="language-rust not_desired_behavior noplayground"><span class="boring">pub struct Guess {
</span><span class="boring">    value: i32,
</span><span class="boring">}
</span><span class="boring">
</span>// --snip--
impl Guess {
    pub fn new(value: i32) -&gt; Guess {
        if value &lt; 1 {
            panic!("Guess value must be between 1 and 100, got {value}.");
        }

        Guess { value }
    }
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    #[should_panic]
</span><span class="boring">    fn greater_than_100() {
</span><span class="boring">        Guess::new(200);
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Khi chÃºng ta cháº¡y hÃ m kiá»ƒm tra trong Listing 11-8, nÃ³ sáº½ tháº¥t báº¡i:</p>
<pre><code class="language-console">$ cargo test
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.62s
     Running unittests src/lib.rs (target/debug/deps/guessing_game-57d70c3acb738f4d)

running 1 test
test tests::greater_than_100 - should panic ... FAILED

failures:

---- tests::greater_than_100 stdout ----
note: test did not panic as expected

failures:
    tests::greater_than_100

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p>Trong trÆ°á»ng há»£p nÃ y, chÃºng ta khÃ´ng nháº­n Ä‘Æ°á»£c thÃ´ng bÃ¡o há»¯u Ã­ch láº¯m, nhÆ°ng khi xem hÃ m kiá»ƒm tra, chÃºng ta tháº¥y nÃ³ Ä‘Æ°á»£c chÃº thÃ­ch báº±ng <code>#[should_panic]</code>. Tháº¥t báº¡i mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c cÃ³ nghÄ©a lÃ  mÃ£ trong hÃ m kiá»ƒm tra khÃ´ng gÃ¢y ra panic.</p>
<p>CÃ¡c hÃ m kiá»ƒm tra sá»­ dá»¥ng <code>should_panic</code> cÃ³ thá»ƒ khÃ´ng chÃ­nh xÃ¡c. Má»™t hÃ m kiá»ƒm tra <code>should_panic</code> sáº½ váº«n thÃ nh cÃ´ng ngay cáº£ khi panic xáº£y ra vÃ¬ lÃ½ do khÃ¡c vá»›i lÃ½ do mÃ  chÃºng ta mong Ä‘á»£i. Äá»ƒ lÃ m cho cÃ¡c hÃ m kiá»ƒm tra <code>should_panic</code> chÃ­nh xÃ¡c hÆ¡n, chÃºng ta cÃ³ thá»ƒ thÃªm má»™t tham sá»‘ tÃ¹y chá»n <code>expected</code> vÃ o attribute <code>should_panic</code>. TrÃ¬nh cháº¡y kiá»ƒm tra sáº½ Ä‘áº£m báº£o ráº±ng thÃ´ng bÃ¡o tháº¥t báº¡i chá»©a vÄƒn báº£n Ä‘Æ°á»£c cung cáº¥p. VÃ­ dá»¥, hÃ£y xem Ä‘oáº¡n mÃ£ <code>Guess</code> Ä‘Ã£ Ä‘Æ°á»£c chá»‰nh sá»­a trong Listing 11-9, nÆ¡i hÃ m <code>new</code> panic vá»›i cÃ¡c thÃ´ng Ä‘iá»‡p khÃ¡c nhau tÃ¹y thuá»™c vÃ o viá»‡c giÃ¡ trá»‹ quÃ¡ nhá» hay quÃ¡ lá»›n.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">pub struct Guess {
</span><span class="boring">    value: i32,
</span><span class="boring">}
</span><span class="boring">
</span>// --snip--

impl Guess {
    pub fn new(value: i32) -&gt; Guess {
        if value &lt; 1 {
            panic!(
                "Guess value must be greater than or equal to 1, got {value}."
            );
        } else if value &gt; 100 {
            panic!(
                "Guess value must be less than or equal to 100, got {value}."
            );
        }

        Guess { value }
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    #[should_panic(expected = "less than or equal to 100")]
    fn greater_than_100() {
        Guess::new(200);
    }
}</code></pre>
<p><span class="caption">Listing 11-9: Kiá»ƒm tra <code>panic!</code> vá»›i thÃ´ng bÃ¡o panic chá»©a má»™t chuá»—i con xÃ¡c Ä‘á»‹nh</span></p>
<p>HÃ m kiá»ƒm tra nÃ y sáº½ thÃ nh cÃ´ng vÃ¬ giÃ¡ trá»‹ mÃ  chÃºng ta Ä‘áº·t trong tham sá»‘ <code>expected</code> cá»§a attribute <code>should_panic</code> lÃ  má»™t chuá»—i con cá»§a thÃ´ng bÃ¡o mÃ  hÃ m <code>Guess::new</code> panic. ChÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh toÃ n bá»™ thÃ´ng bÃ¡o panic mÃ  chÃºng ta mong Ä‘á»£i, trong trÆ°á»ng há»£p nÃ y sáº½ lÃ  <code>Guess value must be less than or equal to 100, got 200.</code> Viá»‡c báº¡n chá»n chá»‰ Ä‘á»‹nh cÃ¡i gÃ¬ phá»¥ thuá»™c vÃ o viá»‡c pháº§n nÃ o cá»§a thÃ´ng bÃ¡o panic lÃ  duy nháº¥t hoáº·c thay Ä‘á»•i vÃ  má»©c Ä‘á»™ chÃ­nh xÃ¡c mÃ  báº¡n muá»‘n cho hÃ m kiá»ƒm tra. Trong trÆ°á»ng há»£p nÃ y, má»™t chuá»—i con cá»§a thÃ´ng bÃ¡o panic lÃ  Ä‘á»§ Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng mÃ£ trong hÃ m kiá»ƒm tra thá»±c thi nhÃ¡nh <code>else if value &gt; 100</code>.</p>
<p>Äá»ƒ xem Ä‘iá»u gÃ¬ xáº£y ra khi má»™t hÃ m kiá»ƒm tra <code>should_panic</code> vá»›i thÃ´ng bÃ¡o <code>expected</code> tháº¥t báº¡i, hÃ£y láº¡i giá»›i thiá»‡u má»™t lá»—i vÃ o mÃ£ cá»§a chÃºng ta báº±ng cÃ¡ch hoÃ¡n Ä‘á»•i ná»™i dung cá»§a cÃ¡c khá»‘i <code>if value &lt; 1</code> vÃ  <code>else if value &gt; 100</code>:</p>
<pre><code class="language-rust ignore not_desired_behavior"><span class="boring">pub struct Guess {
</span><span class="boring">    value: i32,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Guess {
</span><span class="boring">    pub fn new(value: i32) -&gt; Guess {
</span>        if value &lt; 1 {
            panic!(
                "Guess value must be less than or equal to 100, got {value}."
            );
        } else if value &gt; 100 {
            panic!(
                "Guess value must be greater than or equal to 1, got {value}."
            );
        }
<span class="boring">
</span><span class="boring">        Guess { value }
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    #[should_panic(expected = "less than or equal to 100")]
</span><span class="boring">    fn greater_than_100() {
</span><span class="boring">        Guess::new(200);
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Láº§n nÃ y khi chÃºng ta cháº¡y hÃ m kiá»ƒm tra <code>should_panic</code>, nÃ³ sáº½ tháº¥t báº¡i:</p>
<pre><code class="language-console">$ cargo test
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.66s
     Running unittests src/lib.rs (target/debug/deps/guessing_game-57d70c3acb738f4d)

running 1 test
test tests::greater_than_100 - should panic ... FAILED

failures:

---- tests::greater_than_100 stdout ----

thread 'tests::greater_than_100' panicked at src/lib.rs:12:13:
Guess value must be greater than or equal to 1, got 200.
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
note: panic did not contain expected string
      panic message: `"Guess value must be greater than or equal to 1, got 200."`,
 expected substring: `"less than or equal to 100"`

failures:
    tests::greater_than_100

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p>ThÃ´ng bÃ¡o tháº¥t báº¡i cho tháº¥y hÃ m kiá»ƒm tra nÃ y thá»±c sá»± Ä‘Ã£ panic nhÆ° chÃºng ta mong Ä‘á»£i, nhÆ°ng thÃ´ng bÃ¡o panic khÃ´ng chá»©a chuá»—i mong Ä‘á»£i <code>'Guess value must be less than or equal to 100'</code>. ThÃ´ng bÃ¡o panic mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c trong trÆ°á»ng há»£p nÃ y lÃ  <code>Guess value must be greater than or equal to 1, got 200.</code> BÃ¢y giá» chÃºng ta cÃ³ thá»ƒ báº¯t Ä‘áº§u xÃ¡c Ä‘á»‹nh vá»‹ trÃ­ lá»—i cá»§a mÃ¬nh!</p>
<h3 id="sá»­-dá»¥ng-resultt-e-trong-cÃ¡c-hÃ m-kiá»ƒm-tra"><a class="header" href="#sá»­-dá»¥ng-resultt-e-trong-cÃ¡c-hÃ m-kiá»ƒm-tra">Sá»­ dá»¥ng <code>Result&lt;T, E&gt;</code> trong cÃ¡c hÃ m kiá»ƒm tra</a></h3>
<p>Cho Ä‘áº¿n nay cÃ¡c hÃ m kiá»ƒm tra cá»§a chÃºng ta Ä‘á»u panic khi tháº¥t báº¡i. ChÃºng ta cÅ©ng cÃ³ thá»ƒ viáº¿t cÃ¡c hÃ m kiá»ƒm tra sá»­ dá»¥ng <code>Result&lt;T, E&gt;</code>! ÄÃ¢y lÃ  hÃ m kiá»ƒm tra tá»« Listing 11-1, Ä‘Æ°á»£c viáº¿t láº¡i Ä‘á»ƒ sá»­ dá»¥ng <code>Result&lt;T, E&gt;</code> vÃ  tráº£ vá» <code>Err</code> thay vÃ¬ panic:</p>
<pre><code class="language-rust noplayground">pub fn add(left: u64, right: u64) -&gt; u64 {
    left + right
}

#[cfg(test)]
mod tests {
    use super::*;

    // ANCHOR: here
    #[test]
    fn it_works() -&gt; Result&lt;(), String&gt; {
        let result = add(2, 2);

        if result == 4 {
            Ok(())
        } else {
            Err(String::from("two plus two does not equal four"))
        }
    }
    // ANCHOR_END: here
}</code></pre>
<p>HÃ m <code>it_works</code> bÃ¢y giá» cÃ³ kiá»ƒu tráº£ vá» <code>Result&lt;(), String&gt;</code>. Trong thÃ¢n hÃ m, thay vÃ¬ gá»i macro <code>assert_eq!</code>, chÃºng ta tráº£ vá» <code>Ok(())</code> khi hÃ m kiá»ƒm tra thÃ nh cÃ´ng vÃ  má»™t <code>Err</code> chá»©a <code>String</code> khi hÃ m kiá»ƒm tra tháº¥t báº¡i.</p>
<p>Viá»‡c viáº¿t cÃ¡c hÃ m kiá»ƒm tra tráº£ vá» <code>Result&lt;T, E&gt;</code> cho phÃ©p báº¡n sá»­ dá»¥ng toÃ¡n tá»­ dáº¥u há»i <code>?</code> trong thÃ¢n hÃ m kiá»ƒm tra, Ä‘Ã¢y cÃ³ thá»ƒ lÃ  má»™t cÃ¡ch tiá»‡n lá»£i Ä‘á»ƒ viáº¿t cÃ¡c hÃ m kiá»ƒm tra mÃ  sáº½ tháº¥t báº¡i náº¿u báº¥t ká»³ thao tÃ¡c nÃ o bÃªn trong tráº£ vá» biáº¿n thá»ƒ <code>Err</code>.</p>
<p>Báº¡n khÃ´ng thá»ƒ sá»­ dá»¥ng annotation <code>#[should_panic]</code> trÃªn cÃ¡c hÃ m kiá»ƒm tra sá»­ dá»¥ng <code>Result&lt;T, E&gt;</code>. Äá»ƒ kiá»ƒm tra ráº±ng má»™t thao tÃ¡c tráº£ vá» biáº¿n thá»ƒ <code>Err</code>, khÃ´ng sá»­ dá»¥ng toÃ¡n tá»­ dáº¥u há»i <code>?</code> trÃªn giÃ¡ trá»‹ <code>Result&lt;T, E&gt;</code>. Thay vÃ o Ä‘Ã³, hÃ£y dÃ¹ng <code>assert!(value.is_err())</code>.</p>
<p>BÃ¢y giá» khi báº¡n Ä‘Ã£ biáº¿t nhiá»u cÃ¡ch Ä‘á»ƒ viáº¿t cÃ¡c hÃ m kiá»ƒm tra, hÃ£y xem Ä‘iá»u gÃ¬ xáº£y ra khi chÃºng ta cháº¡y cÃ¡c hÃ m kiá»ƒm tra vÃ  khÃ¡m phÃ¡ cÃ¡c tÃ¹y chá»n khÃ¡c nhau mÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng vá»›i <code>cargo test</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="kiá»ƒm-soÃ¡t-cÃ¡ch-cháº¡y-cÃ¡c-hÃ m-kiá»ƒm-tra"><a class="header" href="#kiá»ƒm-soÃ¡t-cÃ¡ch-cháº¡y-cÃ¡c-hÃ m-kiá»ƒm-tra">Kiá»ƒm soÃ¡t cÃ¡ch cháº¡y cÃ¡c hÃ m kiá»ƒm tra</a></h2>
<p>CÅ©ng giá»‘ng nhÆ° <code>cargo run</code> biÃªn dá»‹ch mÃ£ cá»§a báº¡n vÃ  sau Ä‘Ã³ cháº¡y file nhá»‹ phÃ¢n káº¿t quáº£, <code>cargo test</code> biÃªn dá»‹ch mÃ£ cá»§a báº¡n á»Ÿ cháº¿ Ä‘á»™ kiá»ƒm tra vÃ  cháº¡y file nhá»‹ phÃ¢n kiá»ƒm tra táº¡o ra. HÃ nh vi máº·c Ä‘á»‹nh cá»§a file nhá»‹ phÃ¢n do <code>cargo test</code> táº¡o ra lÃ  cháº¡y táº¥t cáº£ cÃ¡c hÃ m kiá»ƒm tra song song vÃ  báº¯t giá»¯ output Ä‘Æ°á»£c táº¡o ra trong quÃ¡ trÃ¬nh cháº¡y kiá»ƒm tra, ngÄƒn khÃ´ng cho output hiá»ƒn thá»‹ vÃ  giÃºp dá»… Ä‘á»c cÃ¡c káº¿t quáº£ liÃªn quan Ä‘áº¿n kiá»ƒm tra. Tuy nhiÃªn, báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh cÃ¡c tÃ¹y chá»n dÃ²ng lá»‡nh Ä‘á»ƒ thay Ä‘á»•i hÃ nh vi máº·c Ä‘á»‹nh nÃ y.</p>
<p>Má»™t sá»‘ tÃ¹y chá»n dÃ²ng lá»‡nh dÃ nh cho <code>cargo test</code>, vÃ  má»™t sá»‘ dÃ nh cho file nhá»‹ phÃ¢n kiá»ƒm tra táº¡o ra. Äá»ƒ tÃ¡ch hai loáº¡i Ä‘á»‘i sá»‘ nÃ y, báº¡n liá»‡t kÃª cÃ¡c Ä‘á»‘i sá»‘ dÃ nh cho <code>cargo test</code>, theo sau lÃ  dáº¥u phÃ¢n tÃ¡ch <code>--</code>, rá»“i má»›i Ä‘áº¿n cÃ¡c Ä‘á»‘i sá»‘ dÃ nh cho file nhá»‹ phÃ¢n kiá»ƒm tra. Cháº¡y <code>cargo test --help</code> sáº½ hiá»ƒn thá»‹ cÃ¡c tÃ¹y chá»n báº¡n cÃ³ thá»ƒ dÃ¹ng vá»›i <code>cargo test</code>, vÃ  cháº¡y <code>cargo test -- --help</code> sáº½ hiá»ƒn thá»‹ cÃ¡c tÃ¹y chá»n báº¡n cÃ³ thá»ƒ dÃ¹ng sau dáº¥u phÃ¢n tÃ¡ch.</p>
<h3 id="cháº¡y-cÃ¡c-hÃ m-kiá»ƒm-tra-song-song-hoáº·c-tuáº§n-tá»±"><a class="header" href="#cháº¡y-cÃ¡c-hÃ m-kiá»ƒm-tra-song-song-hoáº·c-tuáº§n-tá»±">Cháº¡y cÃ¡c hÃ m kiá»ƒm tra song song hoáº·c tuáº§n tá»±</a></h3>
<p>Khi báº¡n cháº¡y nhiá»u hÃ m kiá»ƒm tra, theo máº·c Ä‘á»‹nh chÃºng cháº¡y song song báº±ng cÃ¡c thread, nghÄ©a lÃ  chÃºng hoÃ n thÃ nh nhanh hÆ¡n vÃ  báº¡n nháº­n pháº£n há»“i nhanh hÆ¡n. VÃ¬ cÃ¡c hÃ m kiá»ƒm tra cháº¡y cÃ¹ng lÃºc, báº¡n pháº£i Ä‘áº£m báº£o ráº±ng cÃ¡c hÃ m kiá»ƒm tra khÃ´ng phá»¥ thuá»™c vÃ o nhau hoáº·c vÃ o báº¥t ká»³ tráº¡ng thÃ¡i chung nÃ o, bao gá»“m mÃ´i trÆ°á»ng chung, cháº³ng háº¡n nhÆ° thÆ° má»¥c lÃ m viá»‡c hiá»‡n táº¡i hoáº·c biáº¿n mÃ´i trÆ°á»ng.</p>
<p>VÃ­ dá»¥, giáº£ sá»­ má»—i hÃ m kiá»ƒm tra cá»§a báº¡n cháº¡y má»™t Ä‘oáº¡n mÃ£ táº¡o má»™t file trÃªn á»• Ä‘Ä©a tÃªn <em>test-output.txt</em> vÃ  ghi má»™t sá»‘ dá»¯ liá»‡u vÃ o file Ä‘Ã³. Sau Ä‘Ã³ má»—i hÃ m kiá»ƒm tra Ä‘á»c dá»¯ liá»‡u trong file vÃ  xÃ¡c nháº­n ráº±ng file chá»©a má»™t giÃ¡ trá»‹ nháº¥t Ä‘á»‹nh, khÃ¡c nhau á»Ÿ má»—i hÃ m kiá»ƒm tra. VÃ¬ cÃ¡c hÃ m kiá»ƒm tra cháº¡y cÃ¹ng lÃºc, má»™t hÃ m kiá»ƒm tra cÃ³ thá»ƒ ghi Ä‘Ã¨ file trong lÃºc má»™t hÃ m kiá»ƒm tra khÃ¡c Ä‘ang ghi vÃ  Ä‘á»c file. HÃ m kiá»ƒm tra thá»© hai sáº½ tháº¥t báº¡i, khÃ´ng pháº£i vÃ¬ mÃ£ sai mÃ  vÃ¬ cÃ¡c hÃ m kiá»ƒm tra Ä‘Ã£ can thiá»‡p láº«n nhau khi cháº¡y song song. Má»™t giáº£i phÃ¡p lÃ  Ä‘áº£m báº£o má»—i hÃ m kiá»ƒm tra ghi vÃ o má»™t file khÃ¡c; giáº£i phÃ¡p khÃ¡c lÃ  cháº¡y cÃ¡c hÃ m kiá»ƒm tra má»™t láº§n má»—i láº§n.</p>
<p>Náº¿u báº¡n khÃ´ng muá»‘n cháº¡y cÃ¡c hÃ m kiá»ƒm tra song song hoáº·c muá»‘n kiá»ƒm soÃ¡t chi tiáº¿t hÆ¡n sá»‘ lÆ°á»£ng thread sá»­ dá»¥ng, báº¡n cÃ³ thá»ƒ gá»­i flag <code>--test-threads</code> kÃ¨m sá»‘ lÆ°á»£ng thread muá»‘n dÃ¹ng cho file nhá»‹ phÃ¢n kiá»ƒm tra. Xem vÃ­ dá»¥ sau:</p>
<pre><code class="language-console">$ cargo test -- --test-threads=1
</code></pre>
<p>ChÃºng ta Ä‘áº·t sá»‘ lÆ°á»£ng thread kiá»ƒm tra lÃ  <code>1</code>, thÃ´ng bÃ¡o cho chÆ°Æ¡ng trÃ¬nh khÃ´ng sá»­ dá»¥ng song song. Cháº¡y cÃ¡c hÃ m kiá»ƒm tra báº±ng má»™t thread sáº½ máº¥t nhiá»u thá»i gian hÆ¡n so vá»›i cháº¡y song song, nhÆ°ng cÃ¡c hÃ m kiá»ƒm tra sáº½ khÃ´ng can thiá»‡p láº«n nhau náº¿u chÃºng chia sáº» tráº¡ng thÃ¡i.</p>
<h3 id="hiá»ƒn-thá»‹-output-cá»§a-hÃ m"><a class="header" href="#hiá»ƒn-thá»‹-output-cá»§a-hÃ m">Hiá»ƒn thá»‹ output cá»§a hÃ m</a></h3>
<p>Theo máº·c Ä‘á»‹nh, náº¿u má»™t hÃ m kiá»ƒm tra thÃ nh cÃ´ng, thÆ° viá»‡n kiá»ƒm tra cá»§a Rust sáº½ báº¯t giá»¯ má»i thá»© in ra standard output. VÃ­ dá»¥, náº¿u chÃºng ta gá»i <code>println!</code> trong má»™t hÃ m kiá»ƒm tra vÃ  hÃ m kiá»ƒm tra thÃ nh cÃ´ng, chÃºng ta sáº½ khÃ´ng tháº¥y output cá»§a <code>println!</code> trÃªn terminal; chÃºng ta chá»‰ tháº¥y dÃ²ng bÃ¡o ráº±ng hÃ m kiá»ƒm tra Ä‘Ã£ thÃ nh cÃ´ng. Náº¿u má»™t hÃ m kiá»ƒm tra tháº¥t báº¡i, chÃºng ta sáº½ tháº¥y má»i thá»© Ä‘Æ°á»£c in ra standard output kÃ¨m vá»›i thÃ´ng bÃ¡o tháº¥t báº¡i.</p>
<p>VÃ­ dá»¥, Listing 11-10 cÃ³ má»™t hÃ m ngá»› ngáº©n in giÃ¡ trá»‹ cá»§a tham sá»‘ vÃ  tráº£ vá» 10, cÃ¹ng vá»›i má»™t hÃ m kiá»ƒm tra thÃ nh cÃ´ng vÃ  má»™t hÃ m kiá»ƒm tra tháº¥t báº¡i.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust panics noplayground">fn prints_and_returns_10(a: i32) -&gt; i32 {
    println!("I got the value {a}");
    10
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn this_test_will_pass() {
        let value = prints_and_returns_10(4);
        assert_eq!(value, 10);
    }

    #[test]
    fn this_test_will_fail() {
        let value = prints_and_returns_10(8);
        assert_eq!(value, 5);
    }
}</code></pre>
<p><span class="caption">Listing 11-10: CÃ¡c hÃ m kiá»ƒm tra cho má»™t hÃ m gá»i <code>println!</code></span></p>
<p>Khi chÃºng ta cháº¡y cÃ¡c hÃ m kiá»ƒm tra nÃ y vá»›i <code>cargo test</code>, chÃºng ta sáº½ tháº¥y output nhÆ° sau:</p>
<pre><code class="language-console">$ cargo test
   Compiling silly-function v0.1.0 (file:///projects/silly-function)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.58s
     Running unittests src/lib.rs (target/debug/deps/silly_function-160869f38cff9166)

running 2 tests
test tests::this_test_will_fail ... FAILED
test tests::this_test_will_pass ... ok

failures:

---- tests::this_test_will_fail stdout ----
I got the value 8

thread 'tests::this_test_will_fail' panicked at src/lib.rs:19:9:
assertion `left == right` failed
  left: 10
 right: 5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::this_test_will_fail

test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p>LÆ°u Ã½ ráº±ng á»Ÿ Ä‘Ã¢u trong output nÃ y chÃºng ta cÅ©ng khÃ´ng tháº¥y <code>I got the value 4</code>, Ä‘Ã¢y lÃ  giÃ¡ trá»‹ Ä‘Æ°á»£c in ra khi hÃ m kiá»ƒm tra thÃ nh cÃ´ng cháº¡y. Output nÃ y Ä‘Ã£ bá»‹ báº¯t giá»¯. Output tá»« hÃ m kiá»ƒm tra tháº¥t báº¡i, <code>I got the value 8</code>, xuáº¥t hiá»‡n trong pháº§n tÃ³m táº¯t káº¿t quáº£ kiá»ƒm tra, cÃ¹ng vá»›i nguyÃªn nhÃ¢n tháº¥t báº¡i cá»§a hÃ m kiá»ƒm tra.</p>
<p>Náº¿u chÃºng ta muá»‘n tháº¥y giÃ¡ trá»‹ Ä‘Æ°á»£c in ra cá»§a cÃ¡c hÃ m kiá»ƒm tra thÃ nh cÃ´ng, chÃºng ta cÃ³ thá»ƒ yÃªu cáº§u Rust hiá»ƒn thá»‹ output cá»§a cÃ¡c kiá»ƒm tra thÃ nh cÃ´ng báº±ng <code>--show-output</code>.</p>
<pre><code class="language-console">$ cargo test -- --show-output
</code></pre>
<p>When we run the tests in Listing 11-10 again with the <code>--show-output</code> flag, we
see the following output:</p>
<pre><code class="language-console">$ cargo test -- --show-output
   Compiling silly-function v0.1.0 (file:///projects/silly-function)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.60s
     Running unittests src/lib.rs (target/debug/deps/silly_function-160869f38cff9166)

running 2 tests
test tests::this_test_will_fail ... FAILED
test tests::this_test_will_pass ... ok

successes:

---- tests::this_test_will_pass stdout ----
I got the value 4


successes:
    tests::this_test_will_pass

failures:

---- tests::this_test_will_fail stdout ----
I got the value 8

thread 'tests::this_test_will_fail' panicked at src/lib.rs:19:9:
assertion `left == right` failed
  left: 10
 right: 5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::this_test_will_fail

test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<h3 id="cháº¡y-má»™t-táº­p-con-cÃ¡c-hÃ m-kiá»ƒm-tra-theo-tÃªn"><a class="header" href="#cháº¡y-má»™t-táº­p-con-cÃ¡c-hÃ m-kiá»ƒm-tra-theo-tÃªn">Cháº¡y má»™t táº­p con cÃ¡c hÃ m kiá»ƒm tra theo tÃªn</a></h3>
<p>ÄÃ´i khi, cháº¡y toÃ n bá»™ bá»™ kiá»ƒm tra cÃ³ thá»ƒ máº¥t nhiá»u thá»i gian. Náº¿u báº¡n Ä‘ang lÃ m viá»‡c trÃªn má»™t pháº§n cá»¥ thá»ƒ cá»§a mÃ£, báº¡n cÃ³ thá»ƒ chá»‰ muá»‘n cháº¡y cÃ¡c hÃ m kiá»ƒm tra liÃªn quan Ä‘áº¿n pháº§n Ä‘Ã³. Báº¡n cÃ³ thá»ƒ chá»n cÃ¡c hÃ m kiá»ƒm tra Ä‘á»ƒ cháº¡y báº±ng cÃ¡ch truyá»n tÃªn hoáº·c cÃ¡c tÃªn cá»§a hÃ m kiá»ƒm tra muá»‘n cháº¡y lÃ m Ä‘á»‘i sá»‘ cho <code>cargo test</code>.</p>
<p>Äá»ƒ minh há»a cÃ¡ch cháº¡y má»™t táº­p con cÃ¡c hÃ m kiá»ƒm tra, trÆ°á»›c tiÃªn chÃºng ta sáº½ táº¡o ba hÃ m kiá»ƒm tra cho hÃ m <code>add_two</code> cá»§a mÃ¬nh, nhÆ° hiá»ƒn thá»‹ trong Listing 11-11, vÃ  chá»n nhá»¯ng hÃ m nÃ o sáº½ cháº¡y.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn add_two(a: u64) -&gt; u64 {
    a + 2
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn add_two_and_two() {
        let result = add_two(2);
        assert_eq!(result, 4);
    }

    #[test]
    fn add_three_and_two() {
        let result = add_two(3);
        assert_eq!(result, 5);
    }

    #[test]
    fn one_hundred() {
        let result = add_two(100);
        assert_eq!(result, 102);
    }
}</code></pre>
<p><span class="caption">Listing 11-11: Ba hÃ m kiá»ƒm tra vá»›i ba tÃªn khÃ¡c nhau</span></p>
<p>Náº¿u chÃºng ta cháº¡y cÃ¡c hÃ m kiá»ƒm tra mÃ  khÃ´ng truyá»n báº¥t ká»³ Ä‘á»‘i sá»‘ nÃ o, nhÆ° Ä‘Ã£ tháº¥y trÆ°á»›c Ä‘Ã³, táº¥t cáº£ cÃ¡c hÃ m kiá»ƒm tra sáº½ cháº¡y song song:</p>
<pre><code class="language-console">$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.62s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 3 tests
test tests::add_three_and_two ... ok
test tests::add_two_and_two ... ok
test tests::one_hundred ... ok

test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<h4 id="cháº¡y-má»™t-hÃ m-kiá»ƒm-tra-riÃªng-láº»"><a class="header" href="#cháº¡y-má»™t-hÃ m-kiá»ƒm-tra-riÃªng-láº»">Cháº¡y má»™t hÃ m kiá»ƒm tra riÃªng láº»</a></h4>
<p>ChÃºng ta cÃ³ thá»ƒ truyá»n tÃªn báº¥t ká»³ hÃ m kiá»ƒm tra nÃ o cho <code>cargo test</code> Ä‘á»ƒ chá»‰ cháº¡y hÃ m kiá»ƒm tra Ä‘Ã³:</p>
<pre><code class="language-console">$ cargo test one_hundred
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.69s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 1 test
test tests::one_hundred ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 2 filtered out; finished in 0.00s

</code></pre>
<p>Chá»‰ hÃ m kiá»ƒm tra cÃ³ tÃªn <code>one_hundred</code> Ä‘Æ°á»£c cháº¡y; hai hÃ m kiá»ƒm tra cÃ²n láº¡i khÃ´ng khá»›p vá»›i tÃªn Ä‘Ã³. Output cá»§a hÃ m kiá»ƒm tra thÃ´ng bÃ¡o cho chÃºng ta ráº±ng cÃ²n nhiá»u hÃ m kiá»ƒm tra khÃ¡c khÃ´ng cháº¡y báº±ng cÃ¡ch hiá»ƒn thá»‹ <code>2 filtered out</code> á»Ÿ cuá»‘i.</p>
<p>ChÃºng ta khÃ´ng thá»ƒ chá»‰ Ä‘á»‹nh tÃªn nhiá»u hÃ m kiá»ƒm tra theo cÃ¡ch nÃ y; chá»‰ giÃ¡ trá»‹ Ä‘áº§u tiÃªn truyá»n cho <code>cargo test</code> sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng. NhÆ°ng váº«n cÃ³ cÃ¡ch Ä‘á»ƒ cháº¡y nhiá»u hÃ m kiá»ƒm tra.</p>
<h4 id="lá»c-Ä‘á»ƒ-cháº¡y-nhiá»u-hÃ m-kiá»ƒm-tra"><a class="header" href="#lá»c-Ä‘á»ƒ-cháº¡y-nhiá»u-hÃ m-kiá»ƒm-tra">Lá»c Ä‘á»ƒ cháº¡y nhiá»u hÃ m kiá»ƒm tra</a></h4>
<p>ChÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh má»™t pháº§n cá»§a tÃªn hÃ m kiá»ƒm tra, vÃ  báº¥t ká»³ hÃ m kiá»ƒm tra nÃ o cÃ³ tÃªn khá»›p vá»›i giÃ¡ trá»‹ Ä‘Ã³ sáº½ Ä‘Æ°á»£c cháº¡y. VÃ­ dá»¥, vÃ¬ hai trong sá»‘ cÃ¡c hÃ m kiá»ƒm tra cá»§a chÃºng ta cÃ³ tÃªn chá»©a <code>add</code>, chÃºng ta cÃ³ thá»ƒ cháº¡y hai hÃ m Ä‘Ã³ báº±ng cÃ¡ch cháº¡y <code>cargo test add</code>:</p>
<pre><code class="language-console">$ cargo test add
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.61s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 2 tests
test tests::add_three_and_two ... ok
test tests::add_two_and_two ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out; finished in 0.00s

</code></pre>
<p>Lá»‡nh nÃ y cháº¡y táº¥t cáº£ cÃ¡c hÃ m kiá»ƒm tra cÃ³ <code>add</code> trong tÃªn vÃ  loáº¡i bá» hÃ m kiá»ƒm tra cÃ³ tÃªn <code>one_hundred</code>. CÅ©ng lÆ°u Ã½ ráº±ng module chá»©a hÃ m kiá»ƒm tra trá»Ÿ thÃ nh má»™t pháº§n cá»§a tÃªn hÃ m kiá»ƒm tra, vÃ¬ váº­y chÃºng ta cÃ³ thá»ƒ cháº¡y táº¥t cáº£ cÃ¡c hÃ m kiá»ƒm tra trong má»™t module báº±ng cÃ¡ch lá»c theo tÃªn module.</p>
<h3 id="bá»-qua-má»™t-sá»‘-hÃ m-kiá»ƒm-tra-trá»«-khi-Ä‘Æ°á»£c-yÃªu-cáº§u-cá»¥-thá»ƒ"><a class="header" href="#bá»-qua-má»™t-sá»‘-hÃ m-kiá»ƒm-tra-trá»«-khi-Ä‘Æ°á»£c-yÃªu-cáº§u-cá»¥-thá»ƒ">Bá» qua má»™t sá»‘ hÃ m kiá»ƒm tra trá»« khi Ä‘Æ°á»£c yÃªu cáº§u cá»¥ thá»ƒ</a></h3>
<p>ÄÃ´i khi má»™t vÃ i hÃ m kiá»ƒm tra cá»¥ thá»ƒ cÃ³ thá»ƒ máº¥t nhiá»u thá»i gian Ä‘á»ƒ thá»±c thi, vÃ¬ váº­y báº¡n cÃ³ thá»ƒ muá»‘n loáº¡i chÃºng ra trong háº§u háº¿t cÃ¡c láº§n cháº¡y <code>cargo test</code>. Thay vÃ¬ liá»‡t kÃª táº¥t cáº£ cÃ¡c hÃ m kiá»ƒm tra báº¡n muá»‘n cháº¡y lÃ m Ä‘á»‘i sá»‘, báº¡n cÃ³ thá»ƒ chÃº thÃ­ch cÃ¡c hÃ m kiá»ƒm tra tá»‘n thá»i gian báº±ng attribute <code>ignore</code> Ä‘á»ƒ loáº¡i chÃºng ra, nhÆ° minh há»a dÆ°á»›i Ä‘Ã¢y:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn add(left: u64, right: u64) -&gt; u64 {
    left + right
}

// ANCHOR: here
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn it_works() {
        let result = add(2, 2);
        assert_eq!(result, 4);
    }

    #[test]
    #[ignore]
    fn expensive_test() {
        // code that takes an hour to run
    }
}
// ANCHOR_END: here</code></pre>
<p>Sau <code>#[test]</code>, chÃºng ta thÃªm dÃ²ng <code>#[ignore]</code> vÃ o hÃ m kiá»ƒm tra mÃ  chÃºng ta muá»‘n loáº¡i ra. BÃ¢y giá» khi cháº¡y cÃ¡c hÃ m kiá»ƒm tra, <code>it_works</code> sáº½ cháº¡y, nhÆ°ng <code>expensive_test</code> thÃ¬ khÃ´ng:</p>
<pre><code class="language-console">$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.60s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 2 tests
test tests::expensive_test ... ignored
test tests::it_works ... ok

test result: ok. 1 passed; 0 failed; 1 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>HÃ m <code>expensive_test</code> Ä‘Æ°á»£c liá»‡t kÃª lÃ  <code>ignored</code>. Náº¿u chÃºng ta chá»‰ muá»‘n cháº¡y cÃ¡c hÃ m kiá»ƒm tra bá»‹ bá» qua, cÃ³ thá»ƒ dÃ¹ng <code>cargo test -- --ignored</code>:</p>
<pre><code class="language-console">$ cargo test -- --ignored
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.61s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 1 test
test tests::expensive_test ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>Báº±ng cÃ¡ch kiá»ƒm soÃ¡t cÃ¡c hÃ m kiá»ƒm tra Ä‘Æ°á»£c cháº¡y, báº¡n cÃ³ thá»ƒ Ä‘áº£m báº£o ráº±ng káº¿t quáº£ <code>cargo test</code> sáº½ nhanh. Khi Ä‘áº¿n lÃºc báº¡n muá»‘n kiá»ƒm tra káº¿t quáº£ cá»§a cÃ¡c hÃ m kiá»ƒm tra bá»‹ <code>ignored</code> vÃ  cÃ³ thá»i gian chá» káº¿t quáº£, báº¡n cÃ³ thá»ƒ cháº¡y <code>cargo test -- --ignored</code>. Náº¿u báº¡n muá»‘n cháº¡y táº¥t cáº£ cÃ¡c hÃ m kiá»ƒm tra, báº¥t ká»ƒ chÃºng cÃ³ bá»‹ bá» qua hay khÃ´ng, báº¡n cÃ³ thá»ƒ cháº¡y <code>cargo test -- --include-ignored</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="tá»•-chá»©c-cÃ¡c-hÃ m-kiá»ƒm-tra"><a class="header" href="#tá»•-chá»©c-cÃ¡c-hÃ m-kiá»ƒm-tra">Tá»• chá»©c cÃ¡c hÃ m kiá»ƒm tra</a></h2>
<p>NhÆ° Ä‘Ã£ Ä‘á» cáº­p á»Ÿ Ä‘áº§u chÆ°Æ¡ng, kiá»ƒm tra lÃ  má»™t lÄ©nh vá»±c phá»©c táº¡p, vÃ  nhá»¯ng ngÆ°á»i khÃ¡c nhau sá»­ dá»¥ng thuáº­t ngá»¯ vÃ  cÃ¡ch tá»• chá»©c khÃ¡c nhau. Cá»™ng Ä‘á»“ng Rust chia cÃ¡c hÃ m kiá»ƒm tra thÃ nh hai loáº¡i chÃ­nh: unit tests vÃ  integration tests. <em>Unit tests</em> nhá» vÃ  táº­p trung hÆ¡n, kiá»ƒm tra má»™t module riÃªng láº» táº¡i má»™t thá»i Ä‘iá»ƒm vÃ  cÃ³ thá»ƒ kiá»ƒm tra cÃ¡c giao diá»‡n private. <em>Integration tests</em> hoÃ n toÃ n náº±m ngoÃ i thÆ° viá»‡n cá»§a báº¡n vÃ  sá»­ dá»¥ng mÃ£ cá»§a báº¡n giá»‘ng nhÆ° báº¥t ká»³ mÃ£ bÃªn ngoÃ i nÃ o khÃ¡c, chá»‰ sá»­ dá»¥ng giao diá»‡n public vÃ  cÃ³ thá»ƒ kiá»ƒm tra nhiá»u module trong má»™t hÃ m kiá»ƒm tra.</p>
<p>Viá»‡c viáº¿t cáº£ hai loáº¡i kiá»ƒm tra lÃ  quan trá»ng Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng cÃ¡c pháº§n cá»§a thÆ° viá»‡n hoáº¡t Ä‘á»™ng nhÆ° báº¡n mong Ä‘á»£i, riÃªng láº» vÃ  káº¿t há»£p vá»›i nhau.</p>
<h3 id="unit-tests"><a class="header" href="#unit-tests">Unit Tests</a></h3>
<p>Má»¥c Ä‘Ã­ch cá»§a unit tests lÃ  kiá»ƒm tra tá»«ng Ä‘Æ¡n vá»‹ mÃ£ má»™t cÃ¡ch riÃªng biá»‡t vá»›i pháº§n cÃ²n láº¡i cá»§a mÃ£ Ä‘á»ƒ nhanh chÃ³ng xÃ¡c Ä‘á»‹nh vá»‹ trÃ­ mÃ£ Ä‘ang hoáº¡t Ä‘á»™ng hoáº·c khÃ´ng hoáº¡t Ä‘á»™ng nhÆ° mong Ä‘á»£i. Báº¡n sáº½ Ä‘áº·t unit tests trong thÆ° má»¥c <em>src</em> trong má»—i file chá»©a mÃ£ mÃ  chÃºng Ä‘ang kiá»ƒm tra. Quy Æ°á»›c lÃ  táº¡o má»™t module cÃ³ tÃªn <code>tests</code> trong má»—i file Ä‘á»ƒ chá»©a cÃ¡c hÃ m kiá»ƒm tra vÃ  chÃº thÃ­ch module báº±ng <code>cfg(test)</code>.</p>
<h4 id="module-tests-vÃ -cfgtest"><a class="header" href="#module-tests-vÃ -cfgtest">Module Tests vÃ  <code>#[cfg(test)]</code></a></h4>
<p>ChÃº thÃ­ch <code>#[cfg(test)]</code> trÃªn module tests thÃ´ng bÃ¡o cho Rust chá»‰ biÃªn dá»‹ch vÃ  cháº¡y mÃ£ kiá»ƒm tra khi báº¡n cháº¡y <code>cargo test</code>, khÃ´ng khi cháº¡y <code>cargo build</code>. Äiá»u nÃ y tiáº¿t kiá»‡m thá»i gian biÃªn dá»‹ch khi báº¡n chá»‰ muá»‘n build thÆ° viá»‡n vÃ  tiáº¿t kiá»‡m dung lÆ°á»£ng trong file nhá»‹ phÃ¢n káº¿t quáº£ vÃ¬ cÃ¡c hÃ m kiá»ƒm tra khÃ´ng Ä‘Æ°á»£c bao gá»“m. Báº¡n sáº½ tháº¥y ráº±ng vÃ¬ cÃ¡c integration tests náº±m á»Ÿ thÆ° má»¥c khÃ¡c, chÃºng khÃ´ng cáº§n chÃº thÃ­ch <code>#[cfg(test)]</code>. Tuy nhiÃªn, vÃ¬ unit tests náº±m trong cÃ¹ng file vá»›i mÃ£, báº¡n sáº½ dÃ¹ng <code>#[cfg(test)]</code> Ä‘á»ƒ chá»‰ Ä‘á»‹nh ráº±ng chÃºng khÃ´ng nÃªn Ä‘Æ°á»£c bao gá»“m trong káº¿t quáº£ biÃªn dá»‹ch.</p>
<p>HÃ£y nhá»› ráº±ng khi chÃºng ta táº¡o dá»± Ã¡n má»›i <code>adder</code> trong pháº§n Ä‘áº§u tiÃªn cá»§a chÆ°Æ¡ng nÃ y, Cargo Ä‘Ã£ táº¡o ra Ä‘oáº¡n mÃ£ sau cho chÃºng ta:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn add(left: u64, right: u64) -&gt; u64 {
    left + right
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn it_works() {
        let result = add(2, 2);
        assert_eq!(result, 4);
    }
}</code></pre>
<p>Äoáº¡n mÃ£ nÃ y lÃ  module kiá»ƒm tra Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng. Attribute <code>cfg</code> lÃ  viáº¿t táº¯t cá»§a <em>configuration</em> vÃ  thÃ´ng bÃ¡o cho Rust ráº±ng má»¥c tiáº¿p theo chá»‰ nÃªn Ä‘Æ°á»£c bao gá»“m khi cÃ³ má»™t tÃ¹y chá»n cáº¥u hÃ¬nh nháº¥t Ä‘á»‹nh. Trong trÆ°á»ng há»£p nÃ y, tÃ¹y chá»n cáº¥u hÃ¬nh lÃ  <code>test</code>, Ä‘Æ°á»£c Rust cung cáº¥p Ä‘á»ƒ biÃªn dá»‹ch vÃ  cháº¡y cÃ¡c hÃ m kiá»ƒm tra. Báº±ng cÃ¡ch sá»­ dá»¥ng attribute <code>cfg</code>, Cargo chá»‰ biÃªn dá»‹ch mÃ£ kiá»ƒm tra cá»§a chÃºng ta khi chÃºng ta thá»±c sá»± cháº¡y cÃ¡c hÃ m kiá»ƒm tra báº±ng <code>cargo test</code>. Äiá»u nÃ y bao gá»“m báº¥t ká»³ hÃ m trá»£ giÃºp nÃ o náº±m trong module nÃ y, cÅ©ng nhÆ° cÃ¡c hÃ m Ä‘Æ°á»£c chÃº thÃ­ch báº±ng <code>#[test]</code>.</p>
<h4 id="kiá»ƒm-tra-cÃ¡c-hÃ m-private"><a class="header" href="#kiá»ƒm-tra-cÃ¡c-hÃ m-private">Kiá»ƒm tra cÃ¡c hÃ m private</a></h4>
<p>Trong cá»™ng Ä‘á»“ng kiá»ƒm tra, cÃ³ tranh luáº­n vá» viá»‡c cÃ³ nÃªn kiá»ƒm tra trá»±c tiáº¿p cÃ¡c hÃ m private hay khÃ´ng, vÃ  cÃ¡c ngÃ´n ngá»¯ khÃ¡c thÆ°á»ng khÃ³ hoáº·c khÃ´ng thá»ƒ kiá»ƒm tra cÃ¡c hÃ m private. Báº¥t ká»ƒ báº¡n theo quan Ä‘iá»ƒm kiá»ƒm tra nÃ o, quy táº¯c private cá»§a Rust cho phÃ©p báº¡n kiá»ƒm tra cÃ¡c hÃ m private. HÃ£y xem xÃ©t Ä‘oáº¡n mÃ£ trong Listing 11-12 vá»›i hÃ m private <code>internal_adder</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn add_two(a: u64) -&gt; u64 {
    internal_adder(a, 2)
}

fn internal_adder(left: u64, right: u64) -&gt; u64 {
    left + right
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn internal() {
        let result = internal_adder(2, 2);
        assert_eq!(result, 4);
    }
}</code></pre>
<p><span class="caption">Listing 11-12: Kiá»ƒm tra má»™t hÃ m private</span></p>
<p>LÆ°u Ã½ ráº±ng hÃ m <code>internal_adder</code> khÃ´ng Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  <code>pub</code>. CÃ¡c hÃ m kiá»ƒm tra chá»‰ lÃ  mÃ£ Rust, vÃ  module <code>tests</code> chá»‰ lÃ  má»™t module khÃ¡c. NhÆ° chÃºng ta Ä‘Ã£ tháº£o luáº­n trong pháº§n <a href="ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html">â€œPaths for Referring to an Item in the Module Treeâ€</a><!-- ignore -->, cÃ¡c pháº§n tá»­ trong module con cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c pháº§n tá»­ trong module cha cá»§a chÃºng. Trong kiá»ƒm tra nÃ y, chÃºng ta Ä‘Æ°a táº¥t cáº£ cÃ¡c pháº§n tá»­ cá»§a module cha vÃ o pháº¡m vi vá»›i <code>use super::*</code>, vÃ  sau Ä‘Ã³ hÃ m kiá»ƒm tra cÃ³ thá»ƒ gá»i <code>internal_adder</code>. Náº¿u báº¡n khÃ´ng cho ráº±ng cÃ¡c hÃ m private nÃªn Ä‘Æ°á»£c kiá»ƒm tra, Rust khÃ´ng Ã©p buá»™c báº¡n pháº£i lÃ m Ä‘iá»u Ä‘Ã³.</p>
<h3 id="integration-tests"><a class="header" href="#integration-tests">Integration Tests</a></h3>
<p>Trong Rust, integration tests hoÃ n toÃ n náº±m ngoÃ i thÆ° viá»‡n cá»§a báº¡n. ChÃºng sá»­ dá»¥ng thÆ° viá»‡n cá»§a báº¡n giá»‘ng nhÆ° báº¥t ká»³ mÃ£ nÃ o khÃ¡c, cÃ³ nghÄ©a lÃ  chÃºng chá»‰ cÃ³ thá»ƒ gá»i cÃ¡c hÃ m lÃ  má»™t pháº§n cá»§a API public cá»§a thÆ° viá»‡n. Má»¥c Ä‘Ã­ch cá»§a chÃºng lÃ  kiá»ƒm tra xem nhiá»u pháº§n cá»§a thÆ° viá»‡n cÃ³ hoáº¡t Ä‘á»™ng cÃ¹ng nhau Ä‘Ãºng khÃ´ng. CÃ¡c Ä‘Æ¡n vá»‹ mÃ£ hoáº¡t Ä‘á»™ng Ä‘Ãºng riÃªng láº» cÃ³ thá»ƒ gáº·p váº¥n Ä‘á» khi tÃ­ch há»£p, vÃ¬ váº­y viá»‡c bao phá»§ kiá»ƒm tra mÃ£ tÃ­ch há»£p cÅ©ng quan trá»ng. Äá»ƒ táº¡o integration tests, trÆ°á»›c tiÃªn báº¡n cáº§n táº¡o thÆ° má»¥c <em>tests</em>.</p>
<h4 id="thÆ°-má»¥c-tests"><a class="header" href="#thÆ°-má»¥c-tests">ThÆ° má»¥c <em>tests</em></a></h4>
<p>ChÃºng ta táº¡o thÆ° má»¥c <em>tests</em> á»Ÿ cáº¥p cao nháº¥t cá»§a dá»± Ã¡n, cáº¡nh thÆ° má»¥c <em>src</em>. Cargo biáº¿t tÃ¬m cÃ¡c file kiá»ƒm tra tÃ­ch há»£p trong thÆ° má»¥c nÃ y. ChÃºng ta cÃ³ thá»ƒ táº¡o bao nhiÃªu file kiá»ƒm tra tÃ¹y thÃ­ch, vÃ  Cargo sáº½ biÃªn dá»‹ch tá»«ng file nhÆ° má»™t crate riÃªng láº».</p>
<p>HÃ£y táº¡o má»™t integration test. Vá»›i mÃ£ trong Listing 11-12 váº«n náº±m trong file <em>src/lib.rs</em>, táº¡o thÆ° má»¥c <em>tests</em> vÃ  táº¡o má»™t file má»›i tÃªn <em>tests/integration_test.rs</em>. Cáº¥u trÃºc thÆ° má»¥c cá»§a báº¡n sáº½ trÃ´ng nhÆ° sau:</p>
<pre><code class="language-text">adder
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ lib.rs
â””â”€â”€ tests
    â””â”€â”€ integration_test.rs
</code></pre>
<p>Enter the code in Listing 11-13 into the <em>tests/integration_test.rs</em> file:</p>
<p><span class="filename">Filename: tests/integration_test.rs</span></p>
<pre><code class="language-rust ignore">use adder::add_two;

#[test]
fn it_adds_two() {
    let result = add_two(2);
    assert_eq!(result, 4);
}</code></pre>
<p><span class="caption">Listing 11-13: Má»™t integration test cho má»™t hÃ m trong crate <code>adder</code></span></p>
<p>Má»—i file trong thÆ° má»¥c <code>tests</code> lÃ  má»™t crate riÃªng biá»‡t, vÃ¬ váº­y chÃºng ta cáº§n Ä‘Æ°a thÆ° viá»‡n cá»§a mÃ¬nh vÃ o pháº¡m vi cá»§a tá»«ng test crate. VÃ¬ lÃ½ do Ä‘Ã³, chÃºng ta thÃªm <code>use adder</code> á»Ÿ Ä‘áº§u mÃ£, Ä‘iá»u mÃ  trong unit tests chÃºng ta khÃ´ng cáº§n.</p>
<p>ChÃºng ta khÃ´ng cáº§n chÃº thÃ­ch báº¥t ká»³ mÃ£ nÃ o trong <em>tests/integration_test.rs</em> vá»›i <code>#[cfg(test)]</code>. Cargo xá»­ lÃ½ thÆ° má»¥c <code>tests</code> Ä‘áº·c biá»‡t vÃ  chá»‰ biÃªn dá»‹ch cÃ¡c file trong thÆ° má»¥c nÃ y khi cháº¡y <code>cargo test</code>. BÃ¢y giá» hÃ£y cháº¡y <code>cargo test</code>:</p>
<pre><code class="language-console">$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 1.31s
     Running unittests src/lib.rs (target/debug/deps/adder-1082c4b063a8fbe6)

running 1 test
test tests::internal ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

     Running tests/integration_test.rs (target/debug/deps/integration_test-1082c4b063a8fbe6)

running 1 test
test it_adds_two ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>Ba pháº§n cá»§a output bao gá»“m unit tests, integration test vÃ  doc tests. LÆ°u Ã½ ráº±ng náº¿u báº¥t ká»³ hÃ m kiá»ƒm tra nÃ o trong má»™t pháº§n tháº¥t báº¡i, cÃ¡c pháº§n tiáº¿p theo sáº½ khÃ´ng Ä‘Æ°á»£c cháº¡y. VÃ­ dá»¥, náº¿u má»™t unit test tháº¥t báº¡i, sáº½ khÃ´ng cÃ³ output cho integration vÃ  doc tests vÃ¬ cÃ¡c test Ä‘Ã³ chá»‰ Ä‘Æ°á»£c cháº¡y náº¿u táº¥t cáº£ unit tests Ä‘á»u thÃ nh cÃ´ng.</p>
<p>Pháº§n Ä‘áº§u tiÃªn cho unit tests giá»‘ng nhÆ° nhá»¯ng gÃ¬ chÃºng ta Ä‘Ã£ tháº¥y: má»™t dÃ²ng cho má»—i unit test (má»™t test tÃªn lÃ  <code>internal</code> mÃ  chÃºng ta Ä‘Ã£ thÃªm trong Listing 11-12) vÃ  sau Ä‘Ã³ lÃ  má»™t dÃ²ng tÃ³m táº¯t cho cÃ¡c unit tests.</p>
<p>Pháº§n integration tests báº¯t Ä‘áº§u vá»›i dÃ²ng <code>Running tests/integration_test.rs</code>. Tiáº¿p theo, cÃ³ má»™t dÃ²ng cho má»—i hÃ m kiá»ƒm tra trong integration test Ä‘Ã³ vÃ  má»™t dÃ²ng tÃ³m táº¯t káº¿t quáº£ cá»§a integration test ngay trÆ°á»›c khi pháº§n <code>Doc-tests adder</code> báº¯t Ä‘áº§u.</p>
<p>Má»—i file integration test cÃ³ pháº§n riÃªng cá»§a nÃ³, vÃ¬ váº­y náº¿u chÃºng ta thÃªm nhiá»u file trong thÆ° má»¥c <em>tests</em>, sáº½ cÃ³ thÃªm cÃ¡c pháº§n cho integration tests.</p>
<p>ChÃºng ta váº«n cÃ³ thá»ƒ cháº¡y má»™t hÃ m kiá»ƒm tra integration cá»¥ thá»ƒ báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh tÃªn hÃ m kiá»ƒm tra lÃ m Ä‘á»‘i sá»‘ cho <code>cargo test</code>. Äá»ƒ cháº¡y táº¥t cáº£ cÃ¡c test trong má»™t file integration test cá»¥ thá»ƒ, dÃ¹ng Ä‘á»‘i sá»‘ <code>--test</code> cá»§a <code>cargo test</code> theo sau lÃ  tÃªn file:</p>
<pre><code class="language-console">$ cargo test --test integration_test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.64s
     Running tests/integration_test.rs (target/debug/deps/integration_test-82e7799c1bc62298)

running 1 test
test it_adds_two ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>Lá»‡nh nÃ y chá»‰ cháº¡y cÃ¡c hÃ m kiá»ƒm tra trong file <em>tests/integration_test.rs</em>.</p>
<h4 id="submodules-trong-integration-tests"><a class="header" href="#submodules-trong-integration-tests">Submodules trong Integration Tests</a></h4>
<p>Khi báº¡n thÃªm nhiá»u integration tests, báº¡n cÃ³ thá»ƒ muá»‘n táº¡o thÃªm cÃ¡c file trong thÆ° má»¥c <em>tests</em> Ä‘á»ƒ giÃºp tá»• chá»©c chÃºng; vÃ­ dá»¥, báº¡n cÃ³ thá»ƒ nhÃ³m cÃ¡c hÃ m kiá»ƒm tra theo chá»©c nÄƒng mÃ  chÃºng Ä‘ang kiá»ƒm tra. NhÆ° Ä‘Ã£ Ä‘á» cáº­p trÆ°á»›c Ä‘Ã³, má»—i file trong thÆ° má»¥c <em>tests</em> Ä‘Æ°á»£c biÃªn dá»‹ch nhÆ° má»™t crate riÃªng biá»‡t, Ä‘iá»u nÃ y há»¯u Ã­ch Ä‘á»ƒ táº¡o cÃ¡c pháº¡m vi riÃªng nháº±m mÃ´ phá»ng gáº§n hÆ¡n cÃ¡ch ngÆ°á»i dÃ¹ng cuá»‘i sáº½ sá»­ dá»¥ng crate cá»§a báº¡n. Tuy nhiÃªn, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  cÃ¡c file trong thÆ° má»¥c <em>tests</em> khÃ´ng chia sáº» cÃ¹ng hÃ nh vi nhÆ° cÃ¡c file trong <em>src</em>, nhÆ° báº¡n Ä‘Ã£ há»c á»Ÿ ChÆ°Æ¡ng 7 vá» cÃ¡ch tÃ¡ch mÃ£ thÃ nh cÃ¡c module vÃ  file.</p>
<p>Sá»± khÃ¡c biá»‡t trong hÃ nh vi cá»§a cÃ¡c file trong thÆ° má»¥c <em>tests</em> rÃµ rÃ ng nháº¥t khi báº¡n cÃ³ má»™t bá»™ hÃ m trá»£ giÃºp dÃ¹ng trong nhiá»u file integration test vÃ  báº¡n cá»‘ gáº¯ng theo cÃ¡c bÆ°á»›c trong pháº§n <a href="ch07-05-separating-modules-into-different-files.html">â€œSeparating Modules into Different Filesâ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 7 Ä‘á»ƒ trÃ­ch xuáº¥t chÃºng thÃ nh má»™t module chung. VÃ­ dá»¥, náº¿u chÃºng ta táº¡o file <em>tests/common.rs</em> vÃ  Ä‘áº·t má»™t hÃ m tÃªn lÃ  <code>setup</code> trong Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ thÃªm má»™t sá»‘ mÃ£ vÃ o <code>setup</code> mÃ  muá»‘n gá»i tá»« nhiá»u hÃ m kiá»ƒm tra trong nhiá»u file test:</p>
<p><span class="filename">Filename: tests/common.rs</span></p>
<pre><code class="language-rust noplayground">pub fn setup() {
    // setup code specific to your library's tests would go here
}</code></pre>
<p>Khi chÃºng ta cháº¡y láº¡i cÃ¡c hÃ m kiá»ƒm tra, chÃºng ta sáº½ tháº¥y má»™t pháº§n má»›i trong output cho file <em>common.rs</em>, máº·c dÃ¹ file nÃ y khÃ´ng chá»©a báº¥t ká»³ hÃ m kiá»ƒm tra nÃ o vÃ  chÃºng ta cÅ©ng khÃ´ng gá»i hÃ m <code>setup</code> tá»« Ä‘Ã¢u cáº£:</p>
<pre><code class="language-console">$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.89s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

running 1 test
test tests::internal ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

     Running tests/common.rs (target/debug/deps/common-92948b65e88960b4)

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

     Running tests/integration_test.rs (target/debug/deps/integration_test-92948b65e88960b4)

running 1 test
test it_adds_two ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>Viá»‡c <code>common</code> xuáº¥t hiá»‡n trong káº¿t quáº£ kiá»ƒm tra vá»›i thÃ´ng bÃ¡o <code>running 0 tests</code> khÃ´ng pháº£i lÃ  Ä‘iá»u chÃºng ta mong muá»‘n. ChÃºng ta chá»‰ muá»‘n chia sáº» má»™t sá»‘ mÃ£ vá»›i cÃ¡c file integration test khÃ¡c.</p>
<p>Äá»ƒ trÃ¡nh <code>common</code> xuáº¥t hiá»‡n trong output cá»§a kiá»ƒm tra, thay vÃ¬ táº¡o file <em>tests/common.rs</em>, chÃºng ta sáº½ táº¡o <em>tests/common/mod.rs</em>. Cáº¥u trÃºc thÆ° má»¥c dá»± Ã¡n bÃ¢y giá» trÃ´ng nhÆ° sau:</p>
<pre><code class="language-text">â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ lib.rs
â””â”€â”€ tests
    â”œâ”€â”€ common
    â”‚Â Â  â””â”€â”€ mod.rs
    â””â”€â”€ integration_test.rs
</code></pre>
<p>ÄÃ¢y lÃ  quy Æ°á»›c Ä‘áº·t tÃªn cÅ© mÃ  Rust váº«n hiá»ƒu, nhÆ° chÃºng ta Ä‘Ã£ Ä‘á» cáº­p trong pháº§n <a href="ch07-05-separating-modules-into-different-files.html#alternate-file-paths">â€œAlternate File Pathsâ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 7. Äáº·t tÃªn file theo cÃ¡ch nÃ y thÃ´ng bÃ¡o cho Rust ráº±ng khÃ´ng nÃªn coi module <code>common</code> lÃ  má»™t file integration test. Khi chÃºng ta chuyá»ƒn mÃ£ hÃ m <code>setup</code> vÃ o <em>tests/common/mod.rs</em> vÃ  xÃ³a file <em>tests/common.rs</em>, pháº§n hiá»ƒn thá»‹ trong output kiá»ƒm tra sáº½ khÃ´ng cÃ²n xuáº¥t hiá»‡n. CÃ¡c file trong cÃ¡c thÆ° má»¥c con cá»§a <em>tests</em> sáº½ khÃ´ng Ä‘Æ°á»£c biÃªn dá»‹ch nhÆ° cÃ¡c crate riÃªng biá»‡t vÃ  cÅ©ng khÃ´ng xuáº¥t hiá»‡n trong output kiá»ƒm tra.</p>
<p>Sau khi táº¡o xong <em>tests/common/mod.rs</em>, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ tá»« báº¥t ká»³ file integration test nÃ o nhÆ° má»™t module. DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ gá»i hÃ m <code>setup</code> tá»« test <code>it_adds_two</code> trong <em>tests/integration_test.rs</em>:</p>
<p><span class="filename">Filename: tests/integration_test.rs</span></p>
<pre><code class="language-rust ignore">use adder::add_two;

mod common;

#[test]
fn it_adds_two() {
    common::setup();

    let result = add_two(2);
    assert_eq!(result, 4);
}</code></pre>
<p>LÆ°u Ã½ ráº±ng khai bÃ¡o <code>mod common;</code> giá»‘ng nhÆ° khai bÃ¡o module mÃ  chÃºng ta Ä‘Ã£ minh há»a trong Listing 7-21. Sau Ä‘Ã³, trong hÃ m kiá»ƒm tra, chÃºng ta cÃ³ thá»ƒ gá»i hÃ m <code>common::setup()</code>.</p>
<h4 id="integration-tests-cho-binary-crates"><a class="header" href="#integration-tests-cho-binary-crates">Integration Tests cho Binary Crates</a></h4>
<p>Náº¿u dá»± Ã¡n cá»§a chÃºng ta lÃ  má»™t binary crate chá»‰ chá»©a file <em>src/main.rs</em> vÃ  khÃ´ng cÃ³ file <em>src/lib.rs</em>, chÃºng ta khÃ´ng thá»ƒ táº¡o integration tests trong thÆ° má»¥c <em>tests</em> vÃ  Ä‘Æ°a cÃ¡c hÃ m Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong file <em>src/main.rs</em> vÃ o pháº¡m vi vá»›i cÃ¢u lá»‡nh <code>use</code>. Chá»‰ cÃ¡c library crate má»›i cung cáº¥p cÃ¡c hÃ m mÃ  crate khÃ¡c cÃ³ thá»ƒ sá»­ dá»¥ng; binary crate Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ cháº¡y Ä‘á»™c láº­p.</p>
<p>ÄÃ¢y lÃ  má»™t trong nhá»¯ng lÃ½ do mÃ  cÃ¡c dá»± Ã¡n Rust cung cáº¥p binary thÆ°á»ng cÃ³ file <em>src/main.rs</em> Ä‘Æ¡n giáº£n, gá»i cÃ¡c logic náº±m trong file <em>src/lib.rs</em>. Sá»­ dá»¥ng cáº¥u trÃºc Ä‘Ã³, integration tests <em>cÃ³ thá»ƒ</em> kiá»ƒm tra library crate vá»›i <code>use</code> Ä‘á»ƒ lÃ m cho cÃ¡c chá»©c nÄƒng quan trá»ng cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c. Náº¿u cÃ¡c chá»©c nÄƒng quan trá»ng hoáº¡t Ä‘á»™ng, pháº§n mÃ£ nhá» trong file <em>src/main.rs</em> cÅ©ng sáº½ hoáº¡t Ä‘á»™ng, vÃ  pháº§n mÃ£ nhá» Ä‘Ã³ khÃ´ng cáº§n pháº£i kiá»ƒm tra.</p>
<h2 id="tÃ³m-táº¯t-1"><a class="header" href="#tÃ³m-táº¯t-1">TÃ³m táº¯t</a></h2>
<p>CÃ¡c tÃ­nh nÄƒng kiá»ƒm tra cá»§a Rust cung cáº¥p cÃ¡ch Ä‘á»ƒ xÃ¡c Ä‘á»‹nh cÃ¡ch mÃ£ nÃªn hoáº¡t Ä‘á»™ng nháº±m Ä‘áº£m báº£o nÃ³ tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng nhÆ° báº¡n mong Ä‘á»£i, ngay cáº£ khi báº¡n thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i. Unit tests kiá»ƒm tra cÃ¡c pháº§n khÃ¡c nhau cá»§a thÆ° viá»‡n má»™t cÃ¡ch riÃªng biá»‡t vÃ  cÃ³ thá»ƒ kiá»ƒm tra cÃ¡c chi tiáº¿t triá»ƒn khai riÃªng tÆ°. Integration tests kiá»ƒm tra ráº±ng nhiá»u pháº§n cá»§a thÆ° viá»‡n hoáº¡t Ä‘á»™ng cÃ¹ng nhau chÃ­nh xÃ¡c, vÃ  chÃºng sá»­ dá»¥ng API cÃ´ng khai cá»§a thÆ° viá»‡n Ä‘á»ƒ kiá»ƒm tra mÃ£ giá»‘ng nhÆ° cÃ¡ch mÃ£ bÃªn ngoÃ i sáº½ sá»­ dá»¥ng. Máº·c dÃ¹ há»‡ thá»‘ng kiá»ƒu vÃ  quy táº¯c sá»Ÿ há»¯u cá»§a Rust giÃºp ngÄƒn ngá»«a má»™t sá»‘ loáº¡i lá»—i, nhÆ°ng viá»‡c kiá»ƒm tra váº«n quan trá»ng Ä‘á»ƒ giáº£m thiá»ƒu cÃ¡c lá»—i logic liÃªn quan Ä‘áº¿n cÃ¡ch mÃ£ cá»§a báº¡n Ä‘Æ°á»£c mong Ä‘á»£i hoáº¡t Ä‘á»™ng.</p>
<p>HÃ£y káº¿t há»£p kiáº¿n thá»©c báº¡n há»c Ä‘Æ°á»£c trong chÆ°Æ¡ng nÃ y vÃ  cÃ¡c chÆ°Æ¡ng trÆ°á»›c Ä‘á»ƒ lÃ m viá»‡c trÃªn má»™t dá»± Ã¡n!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="má»™t-dá»±-Ãn-io-xÃ¢y-dá»±ng-chÆ°Æ¡ng-trÃ¬nh-dÃ²ng-lá»‡nh"><a class="header" href="#má»™t-dá»±-Ãn-io-xÃ¢y-dá»±ng-chÆ°Æ¡ng-trÃ¬nh-dÃ²ng-lá»‡nh">Má»™t Dá»± Ãn I/O: XÃ¢y Dá»±ng ChÆ°Æ¡ng TrÃ¬nh DÃ²ng Lá»‡nh</a></h1>
<p>ChÆ°Æ¡ng nÃ y tá»•ng káº¿t láº¡i nhiá»u ká»¹ nÄƒng mÃ  báº¡n Ä‘Ã£ há»c cho Ä‘áº¿n nay vÃ  khÃ¡m phÃ¡ má»™t vÃ i tÃ­nh nÄƒng khÃ¡c cá»§a thÆ° viá»‡n chuáº©n. ChÃºng ta sáº½ xÃ¢y dá»±ng má»™t cÃ´ng cá»¥ dÃ²ng lá»‡nh tÆ°Æ¡ng tÃ¡c vá»›i tá»‡p tin vÃ  nháº­p/xuáº¥t dÃ²ng lá»‡nh Ä‘á»ƒ thá»±c hÃ nh má»™t sá»‘ khÃ¡i niá»‡m Rust mÃ  báº¡n Ä‘Ã£ náº¯m.</p>
<p>Tá»‘c Ä‘á»™, an toÃ n, xuáº¥t ra má»™t nhá»‹ phÃ¢n duy nháº¥t vÃ  há»— trá»£ Ä‘a ná»n táº£ng cá»§a Rust khiáº¿n nÃ³ trá»Ÿ thÃ nh ngÃ´n ngá»¯ lÃ½ tÆ°á»Ÿng Ä‘á»ƒ táº¡o cÃ´ng cá»¥ dÃ²ng lá»‡nh. VÃ¬ váº­y, trong dá»± Ã¡n nÃ y, chÃºng ta sáº½ táº¡o phiÃªn báº£n riÃªng cá»§a cÃ´ng cá»¥ tÃ¬m kiáº¿m dÃ²ng lá»‡nh cá»• Ä‘iá»ƒn <code>grep</code> (<strong>g</strong>lobally search a <strong>r</strong>egular <strong>e</strong>xpression and <strong>p</strong>rint). Trong trÆ°á»ng há»£p sá»­ dá»¥ng Ä‘Æ¡n giáº£n nháº¥t, <code>grep</code> tÃ¬m kiáº¿m má»™t tá»‡p cá»¥ thá»ƒ vá»›i má»™t chuá»—i cá»¥ thá»ƒ. Äá»ƒ lÃ m Ä‘iá»u nÃ y, <code>grep</code> nháº­n hai Ä‘á»‘i sá»‘: Ä‘Æ°á»ng dáº«n tá»‡p vÃ  chuá»—i tÃ¬m kiáº¿m. Sau Ä‘Ã³ nÃ³ Ä‘á»c tá»‡p, tÃ¬m cÃ¡c dÃ²ng chá»©a chuá»—i Ä‘Ã£ cho, vÃ  in ra nhá»¯ng dÃ²ng Ä‘Ã³.</p>
<p>Trong quÃ¡ trÃ¬nh Ä‘Ã³, chÃºng ta sáº½ minh há»a cÃ¡ch lÃ m cho cÃ´ng cá»¥ dÃ²ng lá»‡nh cá»§a mÃ¬nh sá»­ dá»¥ng cÃ¡c tÃ­nh nÄƒng terminal mÃ  nhiá»u cÃ´ng cá»¥ dÃ²ng lá»‡nh khÃ¡c cÅ©ng dÃ¹ng. ChÃºng ta sáº½ Ä‘á»c giÃ¡ trá»‹ cá»§a má»™t biáº¿n mÃ´i trÆ°á»ng Ä‘á»ƒ cho phÃ©p ngÆ°á»i dÃ¹ng cáº¥u hÃ¬nh hÃ nh vi cá»§a cÃ´ng cá»¥. ChÃºng ta cÅ©ng sáº½ in thÃ´ng bÃ¡o lá»—i ra luá»“ng lá»—i chuáº©n (<code>stderr</code>) thay vÃ¬ luá»“ng xuáº¥t chuáº©n (<code>stdout</code>), Ä‘á»ƒ vÃ­ dá»¥, ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ chuyá»ƒn hÆ°á»›ng output thÃ nh cÃ´ng vÃ o má»™t tá»‡p trong khi váº«n tháº¥y thÃ´ng bÃ¡o lá»—i trÃªn mÃ n hÃ¬nh.</p>
<p>Má»™t thÃ nh viÃªn cá»™ng Ä‘á»“ng Rust, Andrew Gallant, Ä‘Ã£ táº¡o má»™t phiÃªn báº£n <code>grep</code> hoÃ n chá»‰nh, cá»±c nhanh, gá»i lÃ  <code>ripgrep</code>. So sÃ¡nh vá»›i nÃ³, phiÃªn báº£n cá»§a chÃºng ta sáº½ khÃ¡ Ä‘Æ¡n giáº£n, nhÆ°ng chÆ°Æ¡ng nÃ y sáº½ cung cáº¥p cho báº¡n kiáº¿n thá»©c ná»n táº£ng cáº§n thiáº¿t Ä‘á»ƒ hiá»ƒu má»™t dá»± Ã¡n thá»±c táº¿ nhÆ° <code>ripgrep</code>.</p>
<p>Dá»± Ã¡n <code>grep</code> cá»§a chÃºng ta sáº½ káº¿t há»£p nhiá»u khÃ¡i niá»‡m mÃ  báº¡n Ä‘Ã£ há»c:</p>
<ul>
<li>Tá»• chá»©c mÃ£ (sá»­ dá»¥ng kiáº¿n thá»©c vá» modules trong <a href="ch07-00-managing-growing-projects-with-packages-crates-and-modules.html">ChÆ°Æ¡ng 7</a><!-- ignore -->)</li>
<li>Sá»­ dá»¥ng vectors vÃ  strings (collections, <a href="ch08-00-common-collections.html">ChÆ°Æ¡ng 8</a><!-- ignore -->)</li>
<li>Xá»­ lÃ½ lá»—i (<a href="ch09-00-error-handling.html">ChÆ°Æ¡ng 9</a><!-- ignore -->)</li>
<li>Sá»­ dá»¥ng traits vÃ  lifetimes khi phÃ¹ há»£p (<a href="ch10-00-generics.html">ChÆ°Æ¡ng 10</a><!-- ignore -->)</li>
<li>Viáº¿t cÃ¡c bÃ i kiá»ƒm tra (<a href="ch11-00-testing.html">ChÆ°Æ¡ng 11</a><!-- ignore -->)</li>
</ul>
<p>ChÃºng ta cÅ©ng sáº½ giá»›i thiá»‡u ngáº¯n gá»n vá» closures, iterators, vÃ  trait objects, mÃ  cÃ¡c ChÆ°Æ¡ng <a href="ch13-00-functional-features.html">13</a><!-- ignore --> vÃ  <a href="ch17-00-oop.html">17</a><!-- ignore --> sáº½ trÃ¬nh bÃ y chi tiáº¿t.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="nháº­n-tham-sá»‘-dÃ²ng-lá»‡nh"><a class="header" href="#nháº­n-tham-sá»‘-dÃ²ng-lá»‡nh">Nháº­n Tham Sá»‘ DÃ²ng Lá»‡nh</a></h2>
<p>HÃ£y táº¡o má»™t dá»± Ã¡n má»›i báº±ng cÃ¡ch dÃ¹ng, nhÆ° thÆ°á»ng lá»‡, <code>cargo new</code>. ChÃºng ta sáº½ gá»i dá»± Ã¡n nÃ y lÃ 
<code>minigrep</code> Ä‘á»ƒ phÃ¢n biá»‡t vá»›i cÃ´ng cá»¥ <code>grep</code> mÃ  báº¡n cÃ³ thá»ƒ Ä‘Ã£ cÃ³
trÃªn há»‡ thá»‘ng cá»§a mÃ¬nh.</p>
<pre><code class="language-console">$ cargo new minigrep
     Created binary (application) `minigrep` project
$ cd minigrep
</code></pre>
<p>Nhiá»‡m vá»¥ Ä‘áº§u tiÃªn lÃ  lÃ m cho <code>minigrep</code> nháº­n hai tham sá»‘ dÃ²ng lá»‡nh: Ä‘Æ°á»ng dáº«n tá»‡p vÃ  má»™t chuá»—i Ä‘á»ƒ tÃ¬m kiáº¿m. Tá»©c lÃ , chÃºng ta muá»‘n cÃ³ thá»ƒ cháº¡y chÆ°Æ¡ng trÃ¬nh cá»§a mÃ¬nh báº±ng <code>cargo run</code>, vá»›i hai dáº¥u gáº¡ch ngang Ä‘á»ƒ chá»‰ ra ráº±ng cÃ¡c tham sá»‘ sau lÃ  dÃ nh cho chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta chá»© khÃ´ng pháº£i cho <code>cargo</code>, má»™t chuá»—i Ä‘á»ƒ tÃ¬m kiáº¿m, vÃ  má»™t Ä‘Æ°á»ng dáº«n tá»›i tá»‡p Ä‘á»ƒ tÃ¬m kiáº¿m, nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run -- searchstring example-filename.txt
</code></pre>
<p>Right now, the program generated by <code>cargo new</code> cannot process arguments we
give it. Some existing libraries on <a href="https://crates.io/">crates.io</a> can help
with writing a program that accepts command line arguments, but because youâ€™re
just learning this concept, letâ€™s implement this capability ourselves.</p>
<h3 id="Äá»c-giÃ¡-trá»‹-tham-sá»‘"><a class="header" href="#Äá»c-giÃ¡-trá»‹-tham-sá»‘">Äá»c GiÃ¡ Trá»‹ Tham Sá»‘</a></h3>
<p>Äá»ƒ cho phÃ©p <code>minigrep</code> Ä‘á»c cÃ¡c giÃ¡ trá»‹ cá»§a tham sá»‘ dÃ²ng lá»‡nh mÃ  chÃºng ta truyá»n vÃ o, chÃºng ta sáº½ cáº§n hÃ m <code>std::env::args</code> Ä‘Æ°á»£c cung cáº¥p trong thÆ° viá»‡n chuáº©n cá»§a Rust. HÃ m nÃ y tráº£ vá» má»™t iterator cá»§a cÃ¡c tham sá»‘ dÃ²ng lá»‡nh Ä‘Æ°á»£c truyá»n cho <code>minigrep</code>. ChÃºng ta sáº½ tÃ¬m hiá»ƒu ká»¹ vá» iterator trong <a href="ch13-00-functional-features.html">ChÆ°Æ¡ng 13</a><!-- ignore -->. Hiá»‡n táº¡i, báº¡n chá»‰ cáº§n biáº¿t hai chi tiáº¿t vá» iterator: iterator sinh ra má»™t chuá»—i cÃ¡c giÃ¡ trá»‹, vÃ  chÃºng ta cÃ³ thá»ƒ gá»i phÆ°Æ¡ng thá»©c <code>collect</code> trÃªn má»™t iterator Ä‘á»ƒ biáº¿n nÃ³ thÃ nh má»™t táº­p há»£p, cháº³ng háº¡n nhÆ° vector, chá»©a táº¥t cáº£ cÃ¡c pháº§n tá»­ mÃ  iterator táº¡o ra.</p>
<p>MÃ£ trong Listing 12-1 cho phÃ©p chÆ°Æ¡ng trÃ¬nh <code>minigrep</code> cá»§a báº¡n Ä‘á»c báº¥t ká»³ tham sá»‘ dÃ²ng lá»‡nh nÃ o Ä‘Æ°á»£c truyá»n vÃ o vÃ  sau Ä‘Ã³ thu tháº­p cÃ¡c giÃ¡ trá»‹ Ä‘Ã³ vÃ o má»™t vector.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::env;

fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();
    dbg!(args);
}</code></pre></pre>
<p><span class="caption">Listing 12-1: Thu tháº­p cÃ¡c tham sá»‘ dÃ²ng lá»‡nh vÃ o má»™t vector vÃ  in chÃºng ra</span></p>
<p>TrÆ°á»›c tiÃªn, chÃºng ta Ä‘Æ°a module <code>std::env</code> vÃ o pháº¡m vi vá»›i cÃ¢u lá»‡nh <code>use</code> Ä‘á»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng hÃ m <code>args</code> cá»§a nÃ³. LÆ°u Ã½ ráº±ng hÃ m <code>std::env::args</code> Ä‘Æ°á»£c lá»“ng trong hai cáº¥p module. NhÆ° chÃºng ta Ä‘Ã£ tháº£o luáº­n trong <a href="ch07-04-bringing-paths-into-scope-with-the-use-keyword.html#creating-idiomatic-use-paths">ChÆ°Æ¡ng 7</a><!-- ignore -->, trong nhá»¯ng trÆ°á»ng há»£p hÃ m cáº§n dÃ¹ng Ä‘Æ°á»£c lá»“ng trong nhiá»u module, chÃºng ta chá»n cÃ¡ch Ä‘Æ°a module cha vÃ o pháº¡m vi thay vÃ¬ Ä‘Æ°a trá»±c tiáº¿p hÃ m. Báº±ng cÃ¡ch nÃ y, chÃºng ta cÃ³ thá»ƒ dá»… dÃ ng sá»­ dá»¥ng cÃ¡c hÃ m khÃ¡c tá»« <code>std::env</code>. CÃ¡ch nÃ y cÅ©ng Ã­t gÃ¢y nháº§m láº«n hÆ¡n so vá»›i viá»‡c thÃªm <code>use std::env::args</code> vÃ  sau Ä‘Ã³ gá»i hÃ m chá»‰ vá»›i <code>args</code>, vÃ¬ <code>args</code> cÃ³ thá»ƒ dá»… bá»‹ nháº§m vá»›i má»™t hÃ m Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong module hiá»‡n táº¡i.</p>
<section class="note" aria-role="note">
<h3 id="hÃ m-args-vÃ -unicode-khÃ´ng-há»£p-lá»‡"><a class="header" href="#hÃ m-args-vÃ -unicode-khÃ´ng-há»£p-lá»‡">HÃ m <code>args</code> vÃ  Unicode khÃ´ng há»£p lá»‡</a></h3>
<p>LÆ°u Ã½ ráº±ng <code>std::env::args</code> sáº½ gÃ¢y panic náº¿u báº¥t ká»³ tham sá»‘ nÃ o chá»©a Unicode khÃ´ng há»£p lá»‡. Náº¿u chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n cáº§n cháº¥p nháº­n cÃ¡c tham sá»‘ chá»©a Unicode khÃ´ng há»£p lá»‡, hÃ£y dÃ¹ng <code>std::env::args_os</code> thay tháº¿. HÃ m nÃ y tráº£ vá» má»™t iterator táº¡o ra cÃ¡c giÃ¡ trá»‹ <code>OsString</code> thay vÃ¬ <code>String</code>. á» Ä‘Ã¢y, chÃºng ta chá»n sá»­ dá»¥ng <code>std::env::args</code> Ä‘á»ƒ Ä‘Æ¡n giáº£n, vÃ¬ cÃ¡c giÃ¡ trá»‹ <code>OsString</code> khÃ¡c nhau tÃ¹y theo ná»n táº£ng vÃ  phá»©c táº¡p hÆ¡n khi lÃ m viá»‡c so vá»›i <code>String</code>.</p>
</section>
<p>á» dÃ²ng Ä‘áº§u tiÃªn cá»§a <code>main</code>, chÃºng ta gá»i <code>env::args</code>, vÃ  ngay láº­p tá»©c dÃ¹ng <code>collect</code> Ä‘á»ƒ biáº¿n iterator thÃ nh má»™t vector chá»©a táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ mÃ  iterator sinh ra. ChÃºng ta cÃ³ thá»ƒ dÃ¹ng hÃ m <code>collect</code> Ä‘á»ƒ táº¡o nhiá»u loáº¡i táº­p há»£p khÃ¡c nhau, vÃ¬ váº­y chÃºng ta chÃº thÃ­ch rÃµ kiá»ƒu cá»§a <code>args</code> Ä‘á»ƒ chá»‰ ra ráº±ng chÃºng ta muá»‘n má»™t vector cÃ¡c chuá»—i. Máº·c dÃ¹ hiáº¿m khi cáº§n chÃº thÃ­ch kiá»ƒu trong Rust, <code>collect</code> lÃ  má»™t trong nhá»¯ng hÃ m mÃ  báº¡n thÆ°á»ng pháº£i chÃº thÃ­ch, vÃ¬ Rust khÃ´ng thá»ƒ suy ra loáº¡i táº­p há»£p báº¡n muá»‘n.</p>
<p>Cuá»‘i cÃ¹ng, chÃºng ta in vector ra báº±ng macro debug. HÃ£y thá»­ cháº¡y mÃ£ trÆ°á»›c tiÃªn khÃ´ng cÃ³ tham sá»‘, rá»“i sau Ä‘Ã³ vá»›i hai tham sá»‘:</p>
<pre><code class="language-console">$ cargo run
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.61s
     Running `target/debug/minigrep`
[src/main.rs:5:5] args = [
    "target/debug/minigrep",
]
</code></pre>
<pre><code class="language-console">$ cargo run -- needle haystack
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.57s
     Running `target/debug/minigrep needle haystack`
[src/main.rs:5:5] args = [
    "target/debug/minigrep",
    "needle",
    "haystack",
]
</code></pre>
<p>LÆ°u Ã½ ráº±ng giÃ¡ trá»‹ Ä‘áº§u tiÃªn trong vector lÃ  <code>"target/debug/minigrep"</code>, chÃ­nh lÃ  tÃªn cá»§a file nhá»‹ phÃ¢n cá»§a chÃºng ta. Äiá»u nÃ y khá»›p vá»›i hÃ nh vi cá»§a danh sÃ¡ch tham sá»‘ trong C, cho phÃ©p chÆ°Æ¡ng trÃ¬nh sá»­ dá»¥ng tÃªn mÃ  chÃºng Ä‘Æ°á»£c gá»i khi thá»±c thi. ThÆ°á»ng thÃ¬ viá»‡c cÃ³ quyá»n truy cáº­p vÃ o tÃªn chÆ°Æ¡ng trÃ¬nh ráº¥t tiá»‡n lá»£i náº¿u báº¡n muá»‘n in nÃ³ trong cÃ¡c thÃ´ng bÃ¡o hoáº·c thay Ä‘á»•i hÃ nh vi cá»§a chÆ°Æ¡ng trÃ¬nh dá»±a trÃªn alias dÃ²ng lá»‡nh Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ gá»i chÆ°Æ¡ng trÃ¬nh. NhÆ°ng trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ bá» qua giÃ¡ trá»‹ nÃ y vÃ  chá»‰ lÆ°u hai tham sá»‘ mÃ  chÃºng ta cáº§n.</p>
<h3 id="lÆ°u-giÃ¡-trá»‹-tham-sá»‘-vÃ o-biáº¿n"><a class="header" href="#lÆ°u-giÃ¡-trá»‹-tham-sá»‘-vÃ o-biáº¿n">LÆ°u GiÃ¡ Trá»‹ Tham Sá»‘ vÃ o Biáº¿n</a></h3>
<p>ChÆ°Æ¡ng trÃ¬nh hiá»‡n táº¡i Ä‘Ã£ cÃ³ thá»ƒ truy cáº­p cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh dÆ°á»›i dáº¡ng tham sá»‘ dÃ²ng lá»‡nh. BÃ¢y giá» chÃºng ta cáº§n lÆ°u giÃ¡ trá»‹ cá»§a hai tham sá»‘ vÃ o cÃ¡c biáº¿n Ä‘á»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng chÃºng trong suá»‘t pháº§n cÃ²n láº¡i cá»§a chÆ°Æ¡ng trÃ¬nh. ChÃºng ta thá»±c hiá»‡n viá»‡c nÃ y trong Listing 12-2.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust should_panic noplayground">use std::env;

fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let query = &amp;args[1];
    let file_path = &amp;args[2];

    println!("Searching for {query}");
    println!("In file {file_path}");
}</code></pre>
<p><span class="caption">Listing 12-2: Táº¡o cÃ¡c biáº¿n Ä‘á»ƒ lÆ°u tham sá»‘ truy váº¥n vÃ  tham sá»‘ Ä‘Æ°á»ng dáº«n tá»‡p</span></p>
<p>NhÆ° chÃºng ta Ä‘Ã£ tháº¥y khi in vector, tÃªn chÆ°Æ¡ng trÃ¬nh chiáº¿m giÃ¡ trá»‹ Ä‘áº§u tiÃªn trong vector táº¡i <code>args[0]</code>, vÃ¬ váº­y chÃºng ta báº¯t Ä‘áº§u cÃ¡c tham sá»‘ tá»« chá»‰ sá»‘ <code>1</code>. Tham sá»‘ Ä‘áº§u tiÃªn mÃ  <code>minigrep</code> nháº­n lÃ  chuá»—i mÃ  chÃºng ta muá»‘n tÃ¬m kiáº¿m, vÃ¬ váº­y chÃºng ta Ä‘áº·t má»™t tham chiáº¿u tá»›i tham sá»‘ Ä‘áº§u tiÃªn vÃ o biáº¿n <code>query</code>. Tham sá»‘ thá»© hai sáº½ lÃ  Ä‘Æ°á»ng dáº«n tá»‡p, nÃªn chÃºng ta Ä‘áº·t má»™t tham chiáº¿u tá»›i tham sá»‘ thá»© hai vÃ o biáº¿n <code>file_path</code>.</p>
<p>ChÃºng ta táº¡m thá»i in cÃ¡c giÃ¡ trá»‹ cá»§a nhá»¯ng biáº¿n nÃ y Ä‘á»ƒ chá»©ng minh ráº±ng mÃ£ hoáº¡t Ä‘á»™ng nhÆ° mong muá»‘n. HÃ£y cháº¡y láº¡i chÆ°Æ¡ng trÃ¬nh nÃ y vá»›i cÃ¡c tham sá»‘ <code>test</code> vÃ  <code>sample.txt</code>:</p>
<pre><code class="language-console">$ cargo run -- test sample.txt
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/minigrep test sample.txt`
Searching for test
In file sample.txt
</code></pre>
<p>Tuyá»‡t vá»i, chÆ°Æ¡ng trÃ¬nh hoáº¡t Ä‘á»™ng rá»“i! CÃ¡c giÃ¡ trá»‹ cá»§a cÃ¡c tham sá»‘ mÃ  chÃºng ta cáº§n Ä‘ang Ä‘Æ°á»£c lÆ°u vÃ o cÃ¡c biáº¿n Ä‘Ãºng. Sau nÃ y chÃºng ta sáº½ thÃªm má»™t sá»‘ xá»­ lÃ½ lá»—i Ä‘á»ƒ Ä‘á»‘i phÃ³ vá»›i má»™t sá»‘ tÃ¬nh huá»‘ng cÃ³ thá»ƒ xáº£y ra, cháº³ng háº¡n nhÆ° khi ngÆ°á»i dÃ¹ng khÃ´ng cung cáº¥p tham sá»‘; hiá»‡n táº¡i, chÃºng ta sáº½ bá» qua tÃ¬nh huá»‘ng Ä‘Ã³ vÃ  táº­p trung vÃ o viá»‡c thÃªm kháº£ nÄƒng Ä‘á»c tá»‡p.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="Äá»c-tá»‡p"><a class="header" href="#Äá»c-tá»‡p">Äá»c Tá»‡p</a></h2>
<p>BÃ¢y giá» chÃºng ta sáº½ thÃªm chá»©c nÄƒng Ä‘á»ƒ Ä‘á»c tá»‡p Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong tham sá»‘ <code>file_path</code>. TrÆ°á»›c tiÃªn, chÃºng ta cáº§n má»™t tá»‡p máº«u Ä‘á»ƒ thá»­: chÃºng ta sáº½ dÃ¹ng má»™t tá»‡p cÃ³ má»™t lÆ°á»£ng nhá» vÄƒn báº£n trÃªn nhiá»u dÃ²ng vá»›i má»™t sá»‘ tá»« láº·p láº¡i. Listing 12-3 cÃ³ má»™t bÃ i thÆ¡ cá»§a Emily Dickinson ráº¥t phÃ¹ há»£p! HÃ£y táº¡o má»™t tá»‡p cÃ³ tÃªn <em>poem.txt</em> á»Ÿ cáº¥p gá»‘c cá»§a dá»± Ã¡n, vÃ  nháº­p bÃ i thÆ¡ â€œIâ€™m Nobody! Who are you?â€ vÃ o.</p>
<p><span class="filename">Filename: poem.txt</span></p>
<pre><code class="language-text">I'm nobody! Who are you?
Are you nobody, too?
Then there's a pair of us - don't tell!
They'd banish us, you know.

How dreary to be somebody!
How public, like a frog
To tell your name the livelong day
To an admiring bog!
</code></pre>
<p><span class="caption">Listing 12-3: Má»™t bÃ i thÆ¡ cá»§a Emily Dickinson lÃ  vÃ­ dá»¥ thá»­ nghiá»‡m tá»‘t</span></p>
<p>Khi vÄƒn báº£n Ä‘Ã£ sáºµn sÃ ng, hÃ£y chá»‰nh sá»­a <em>src/main.rs</em> vÃ  thÃªm mÃ£ Ä‘á»ƒ Ä‘á»c tá»‡p, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 12-4.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust should_panic noplayground">use std::env;
use std::fs;

fn main() {
    // --snip--
<span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let query = &amp;args[1];
</span><span class="boring">    let file_path = &amp;args[2];
</span><span class="boring">
</span><span class="boring">    println!("Searching for {query}");
</span>    println!("In file {file_path}");

    let contents = fs::read_to_string(file_path)
        .expect("Should have been able to read the file");

    println!("With text:\n{contents}");
}</code></pre>
<p><span class="caption">Listing 12-4: Äá»c ná»™i dung cá»§a tá»‡p Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh bá»Ÿi tham sá»‘ thá»© hai</span></p>
<p>TrÆ°á»›c tiÃªn, chÃºng ta Ä‘Æ°a vÃ o pháº§n liÃªn quan cá»§a thÆ° viá»‡n chuáº©n báº±ng cÃ¢u lá»‡nh <code>use</code>: chÃºng ta cáº§n <code>std::fs</code> Ä‘á»ƒ xá»­ lÃ½ tá»‡p.</p>
<p>Trong <code>main</code>, cÃ¢u lá»‡nh má»›i <code>fs::read_to_string</code> nháº­n <code>file_path</code>, má»Ÿ tá»‡p Ä‘Ã³, vÃ  tráº£ vá» má»™t <code>std::io::Result&lt;String&gt;</code> chá»©a ná»™i dung cá»§a tá»‡p.</p>
<p>Sau Ä‘Ã³, chÃºng ta láº¡i thÃªm má»™t cÃ¢u lá»‡nh táº¡m thá»i <code>println!</code> in giÃ¡ trá»‹ cá»§a <code>contents</code> sau khi tá»‡p Ä‘Æ°á»£c Ä‘á»c, Ä‘á»ƒ kiá»ƒm tra xem chÆ°Æ¡ng trÃ¬nh hoáº¡t Ä‘á»™ng Ä‘áº¿n Ä‘Ã¢u.</p>
<p>HÃ£y cháº¡y mÃ£ nÃ y vá»›i báº¥t ká»³ chuá»—i nÃ o lÃ m tham sá»‘ dÃ²ng lá»‡nh Ä‘áº§u tiÃªn (vÃ¬ chÃºng ta chÆ°a triá»ƒn khai pháº§n tÃ¬m kiáº¿m) vÃ  tá»‡p <em>poem.txt</em> lÃ m tham sá»‘ thá»© hai:</p>
<pre><code class="language-console">$ cargo run -- the poem.txt
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/minigrep the poem.txt`
Searching for the
In file poem.txt
With text:
I'm nobody! Who are you?
Are you nobody, too?
Then there's a pair of us - don't tell!
They'd banish us, you know.

How dreary to be somebody!
How public, like a frog
To tell your name the livelong day
To an admiring bog!

</code></pre>
<p>Tuyá»‡t vá»i! MÃ£ Ä‘Ã£ Ä‘á»c vÃ  in ra ná»™i dung cá»§a tá»‡p. NhÆ°ng mÃ£ nÃ y cÃ²n má»™t vÃ i Ä‘iá»ƒm chÆ°a tá»‘t. Hiá»‡n táº¡i, hÃ m <code>main</code> Ä‘áº£m nháº­n nhiá»u trÃ¡ch nhiá»‡m: nhÃ¬n chung, cÃ¡c hÃ m sáº½ rÃµ rÃ ng vÃ  dá»… báº£o trÃ¬ hÆ¡n náº¿u má»—i hÃ m chá»‰ chá»‹u trÃ¡ch nhiá»‡m cho má»™t Ã½ tÆ°á»Ÿng duy nháº¥t. Váº¥n Ä‘á» khÃ¡c lÃ  chÃºng ta chÆ°a xá»­ lÃ½ lá»—i tá»‘t nháº¥t cÃ³ thá»ƒ. ChÆ°Æ¡ng trÃ¬nh váº«n cÃ²n nhá», nÃªn nhá»¯ng Ä‘iá»ƒm nÃ y chÆ°a pháº£i lÃ  váº¥n Ä‘á» lá»›n, nhÆ°ng khi chÆ°Æ¡ng trÃ¬nh phÃ¡t triá»ƒn, viá»‡c sá»­a chÃºng sáº½ khÃ³ khÄƒn hÆ¡n. Thá»±c hÃ nh tá»‘t lÃ  báº¯t Ä‘áº§u tÃ¡i cáº¥u trÃºc (refactor) sá»›m khi phÃ¡t triá»ƒn chÆ°Æ¡ng trÃ¬nh, vÃ¬ viá»‡c refactor má»™t lÆ°á»£ng mÃ£ nhá» dá»… dÃ ng hÆ¡n nhiá»u. ChÃºng ta sáº½ lÃ m viá»‡c Ä‘Ã³ ngay sau Ä‘Ã¢y.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="tÃ¡i-cáº¥u-trÃºc-Äá»ƒ-cáº£i-thiá»‡n-tÃ­nh-module-vÃ -xá»­-lÃ½-lá»—i"><a class="header" href="#tÃ¡i-cáº¥u-trÃºc-Äá»ƒ-cáº£i-thiá»‡n-tÃ­nh-module-vÃ -xá»­-lÃ½-lá»—i">TÃ¡i Cáº¥u TrÃºc Äá»ƒ Cáº£i Thiá»‡n TÃ­nh Module vÃ  Xá»­ LÃ½ Lá»—i</a></h2>
<p>Äá»ƒ cáº£i thiá»‡n chÆ°Æ¡ng trÃ¬nh, chÃºng ta sáº½ kháº¯c phá»¥c bá»‘n váº¥n Ä‘á» liÃªn quan Ä‘áº¿n cáº¥u trÃºc chÆ°Æ¡ng trÃ¬nh vÃ  cÃ¡ch xá»­ lÃ½ cÃ¡c lá»—i tiá»m áº©n. Äáº§u tiÃªn, hÃ m <code>main</code> hiá»‡n táº¡i thá»±c hiá»‡n hai nhiá»‡m vá»¥: phÃ¢n tÃ­ch tham sá»‘ vÃ  Ä‘á»c tá»‡p. Khi chÆ°Æ¡ng trÃ¬nh phÃ¡t triá»ƒn, sá»‘ lÆ°á»£ng nhiá»‡m vá»¥ riÃªng láº» mÃ  hÃ m <code>main</code> Ä‘áº£m nháº­n sáº½ tÄƒng lÃªn. Khi má»™t hÃ m cÃ ng nhiá»u trÃ¡ch nhiá»‡m, nÃ³ cÃ ng khÃ³ lÃ½ giáº£i, khÃ³ kiá»ƒm thá»­ vÃ  khÃ³ thay Ä‘á»•i mÃ  khÃ´ng lÃ m há»ng má»™t pháº§n nÃ o Ä‘Ã³. Tá»‘t nháº¥t lÃ  tÃ¡ch chá»©c nÄƒng Ä‘á»ƒ má»—i hÃ m chá»‰ chá»‹u trÃ¡ch nhiá»‡m cho má»™t nhiá»‡m vá»¥ duy nháº¥t.</p>
<p>Váº¥n Ä‘á» nÃ y cÅ©ng liÃªn quan Ä‘áº¿n váº¥n Ä‘á» thá»© hai: máº·c dÃ¹ <code>query</code> vÃ  <code>file_path</code> lÃ  cÃ¡c biáº¿n cáº¥u hÃ¬nh cho chÆ°Æ¡ng trÃ¬nh, cÃ¡c biáº¿n nhÆ° <code>contents</code> Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ thá»±c hiá»‡n logic cá»§a chÆ°Æ¡ng trÃ¬nh. Khi <code>main</code> trá»Ÿ nÃªn dÃ i hÆ¡n, chÃºng ta sáº½ cáº§n nhiá»u biáº¿n hÆ¡n trong pháº¡m vi; cÃ ng nhiá»u biáº¿n trong pháº¡m vi, viá»‡c theo dÃµi má»¥c Ä‘Ã­ch cá»§a tá»«ng biáº¿n cÃ ng khÃ³. Tá»‘t nháº¥t lÃ  nhÃ³m cÃ¡c biáº¿n cáº¥u hÃ¬nh thÃ nh má»™t cáº¥u trÃºc Ä‘á»ƒ lÃ m rÃµ má»¥c Ä‘Ã­ch cá»§a chÃºng.</p>
<p>Váº¥n Ä‘á» thá»© ba lÃ  chÃºng ta Ä‘Ã£ dÃ¹ng <code>expect</code> Ä‘á»ƒ in thÃ´ng bÃ¡o lá»—i khi viá»‡c Ä‘á»c tá»‡p tháº¥t báº¡i, nhÆ°ng thÃ´ng bÃ¡o lá»—i chá»‰ in ra <code>Should have been able to read the file</code>. Viá»‡c Ä‘á»c tá»‡p cÃ³ thá»ƒ tháº¥t báº¡i theo nhiá»u cÃ¡ch: vÃ­ dá»¥, tá»‡p cÃ³ thá»ƒ bá»‹ máº¥t, hoáº·c chÃºng ta cÃ³ thá»ƒ khÃ´ng cÃ³ quyá»n má»Ÿ tá»‡p. Hiá»‡n táº¡i, báº¥t ká»ƒ tÃ¬nh huá»‘ng nÃ o, chÃºng ta cÅ©ng in cÃ¹ng má»™t thÃ´ng bÃ¡o lá»—i, Ä‘iá»u nÃ y sáº½ khÃ´ng cung cáº¥p thÃ´ng tin gÃ¬ cho ngÆ°á»i dÃ¹ng!</p>
<p>Thá»© tÆ°, chÃºng ta dÃ¹ng <code>expect</code> láº·p Ä‘i láº·p láº¡i Ä‘á»ƒ xá»­ lÃ½ cÃ¡c lá»—i khÃ¡c nhau, vÃ  náº¿u ngÆ°á»i dÃ¹ng cháº¡y chÆ°Æ¡ng trÃ¬nh mÃ  khÃ´ng cung cáº¥p Ä‘á»§ tham sá»‘, há» sáº½ nháº­n Ä‘Æ°á»£c lá»—i <code>index out of bounds</code> tá»« Rust, mÃ  khÃ´ng giáº£i thÃ­ch rÃµ váº¥n Ä‘á». Sáº½ tá»‘t hÆ¡n náº¿u táº¥t cáº£ mÃ£ xá»­ lÃ½ lá»—i Ä‘Æ°á»£c Ä‘áº·t á»Ÿ má»™t chá»—, Ä‘á»ƒ cÃ¡c ngÆ°á»i báº£o trÃ¬ trong tÆ°Æ¡ng lai chá»‰ cáº§n tham kháº£o má»™t nÆ¡i náº¿u logic xá»­ lÃ½ lá»—i cáº§n thay Ä‘á»•i. Viá»‡c Ä‘áº·t táº¥t cáº£ mÃ£ xá»­ lÃ½ lá»—i á»Ÿ má»™t chá»— cÅ©ng Ä‘áº£m báº£o ráº±ng chÃºng ta in cÃ¡c thÃ´ng Ä‘iá»‡p cÃ³ Ã½ nghÄ©a vá»›i ngÆ°á»i dÃ¹ng cuá»‘i.</p>
<p>HÃ£y giáº£i quyáº¿t bá»‘n váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch tÃ¡i cáº¥u trÃºc dá»± Ã¡n cá»§a chÃºng ta.</p>
<h3 id="tÃ¡ch-biá»‡t-trÃ¡ch-nhiá»‡m-cho-cÃ¡c-dá»±-Ãn-binary"><a class="header" href="#tÃ¡ch-biá»‡t-trÃ¡ch-nhiá»‡m-cho-cÃ¡c-dá»±-Ãn-binary">TÃ¡ch Biá»‡t TrÃ¡ch Nhiá»‡m Cho CÃ¡c Dá»± Ãn Binary</a></h3>
<p>Váº¥n Ä‘á» tá»• chá»©c khi phÃ¢n bá»• trÃ¡ch nhiá»‡m cho nhiá»u nhiá»‡m vá»¥ vÃ o hÃ m <code>main</code> lÃ  phá»• biáº¿n trong nhiá»u dá»± Ã¡n binary. Do Ä‘Ã³, cá»™ng Ä‘á»“ng Rust Ä‘Ã£ phÃ¡t triá»ƒn cÃ¡c hÆ°á»›ng dáº«n Ä‘á»ƒ tÃ¡ch cÃ¡c má»‘i quan tÃ¢m riÃªng biá»‡t cá»§a má»™t chÆ°Æ¡ng trÃ¬nh binary khi <code>main</code> báº¯t Ä‘áº§u trá»Ÿ nÃªn lá»›n. QuÃ¡ trÃ¬nh nÃ y cÃ³ cÃ¡c bÆ°á»›c sau:</p>
<ul>
<li>Chia chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n thÃ nh <em>main.rs</em> vÃ  <em>lib.rs</em> vÃ  chuyá»ƒn logic cá»§a chÆ°Æ¡ng trÃ¬nh sang <em>lib.rs</em>.</li>
<li>Miá»…n lÃ  logic phÃ¢n tÃ­ch tham sá»‘ dÃ²ng lá»‡nh cÃ²n nhá», nÃ³ cÃ³ thá»ƒ giá»¯ láº¡i trong <em>main.rs</em>.</li>
<li>Khi logic phÃ¢n tÃ­ch tham sá»‘ dÃ²ng lá»‡nh báº¯t Ä‘áº§u phá»©c táº¡p, tÃ¡ch nÃ³ ra khá»i <em>main.rs</em> vÃ  chuyá»ƒn sang <em>lib.rs</em>.</li>
</ul>
<p>CÃ¡c trÃ¡ch nhiá»‡m cÃ²n láº¡i trong hÃ m <code>main</code> sau quÃ¡ trÃ¬nh nÃ y nÃªn giá»›i háº¡n á»Ÿ cÃ¡c má»¥c sau:</p>
<ul>
<li>Gá»i logic phÃ¢n tÃ­ch tham sá»‘ dÃ²ng lá»‡nh vá»›i cÃ¡c giÃ¡ trá»‹ tham sá»‘</li>
<li>Thiáº¿t láº­p báº¥t ká»³ cáº¥u hÃ¬nh nÃ o khÃ¡c</li>
<li>Gá»i hÃ m <code>run</code> trong <em>lib.rs</em></li>
<li>Xá»­ lÃ½ lá»—i náº¿u <code>run</code> tráº£ vá» lá»—i</li>
</ul>
<p>Máº«u nÃ y nháº±m tÃ¡ch biá»‡t cÃ¡c má»‘i quan tÃ¢m: <em>main.rs</em> Ä‘áº£m nháº­n viá»‡c cháº¡y chÆ°Æ¡ng trÃ¬nh, vÃ  <em>lib.rs</em> Ä‘áº£m nháº­n toÃ n bá»™ logic cá»§a nhiá»‡m vá»¥. VÃ¬ báº¡n khÃ´ng thá»ƒ kiá»ƒm thá»­ trá»±c tiáº¿p hÃ m <code>main</code>, cáº¥u trÃºc nÃ y cho phÃ©p báº¡n kiá»ƒm thá»­ toÃ n bá»™ logic chÆ°Æ¡ng trÃ¬nh báº±ng cÃ¡ch chuyá»ƒn nÃ³ vÃ o cÃ¡c hÃ m trong <em>lib.rs</em>. MÃ£ cÃ²n láº¡i trong <em>main.rs</em> sáº½ Ä‘á»§ nhá» Ä‘á»ƒ xÃ¡c minh Ä‘á»™ chÃ­nh xÃ¡c chá»‰ báº±ng cÃ¡ch Ä‘á»c. HÃ£y tÃ¡i cáº¥u trÃºc chÆ°Æ¡ng trÃ¬nh theo quÃ¡ trÃ¬nh nÃ y.</p>
<h4 id="tÃ¡ch-hÃ m-phÃ¢n-tÃ­ch-tham-sá»‘"><a class="header" href="#tÃ¡ch-hÃ m-phÃ¢n-tÃ­ch-tham-sá»‘">TÃ¡ch HÃ m PhÃ¢n TÃ­ch Tham Sá»‘</a></h4>
<p>ChÃºng ta sáº½ tÃ¡ch chá»©c nÄƒng phÃ¢n tÃ­ch tham sá»‘ vÃ o má»™t hÃ m mÃ  <code>main</code> sáº½ gá»i, Ä‘á»ƒ chuáº©n bá»‹ chuyá»ƒn logic phÃ¢n tÃ­ch tham sá»‘ dÃ²ng lá»‡nh sang <em>src/lib.rs</em>. Listing 12-5 cho tháº¥y pháº§n Ä‘áº§u má»›i cá»§a <code>main</code> gá»i má»™t hÃ m má»›i <code>parse_config</code>, mÃ  chÃºng ta sáº½ Ä‘á»‹nh nghÄ©a trong <em>src/main.rs</em> táº¡m thá»i.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span>fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let (query, file_path) = parse_config(&amp;args);

    // --snip--
<span class="boring">
</span><span class="boring">    println!("Searching for {query}");
</span><span class="boring">    println!("In file {file_path}");
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span>}

fn parse_config(args: &amp;[String]) -&gt; (&amp;str, &amp;str) {
    let query = &amp;args[1];
    let file_path = &amp;args[2];

    (query, file_path)
}</code></pre>
<p><span class="caption">Listing 12-5: TÃ¡ch hÃ m <code>parse_config</code> tá»« <code>main</code></span></p>
<p>ChÃºng ta váº«n Ä‘ang thu tháº­p cÃ¡c tham sá»‘ dÃ²ng lá»‡nh vÃ o má»™t vector, nhÆ°ng thay vÃ¬ gÃ¡n giÃ¡ trá»‹ tham sá»‘ táº¡i chá»‰ sá»‘ 1 vÃ o biáº¿n <code>query</code> vÃ  giÃ¡ trá»‹ tham sá»‘ táº¡i chá»‰ sá»‘ 2 vÃ o biáº¿n <code>file_path</code> trong hÃ m <code>main</code>, chÃºng ta truyá»n toÃ n bá»™ vector vÃ o hÃ m <code>parse_config</code>. HÃ m <code>parse_config</code> sau Ä‘Ã³ chá»©a logic xÃ¡c Ä‘á»‹nh tham sá»‘ nÃ o sáº½ vÃ o biáº¿n nÃ o vÃ  tráº£ láº¡i cÃ¡c giÃ¡ trá»‹ cho <code>main</code>. ChÃºng ta váº«n táº¡o cÃ¡c biáº¿n <code>query</code> vÃ  <code>file_path</code> trong <code>main</code>, nhÆ°ng <code>main</code> khÃ´ng cÃ²n trÃ¡ch nhiá»‡m xÃ¡c Ä‘á»‹nh cÃ¡ch cÃ¡c tham sá»‘ dÃ²ng lá»‡nh vÃ  biáº¿n tÆ°Æ¡ng á»©ng vá»›i nhau.</p>
<p>Viá»‡c tÃ¡i cáº¥u trÃºc nÃ y cÃ³ thá»ƒ cÃ³ váº» quÃ¡ má»©c Ä‘á»‘i vá»›i chÆ°Æ¡ng trÃ¬nh nhá» cá»§a chÃºng ta, nhÆ°ng chÃºng ta Ä‘ang refactor theo cÃ¡c bÆ°á»›c nhá», tá»«ng pháº§n. Sau khi thá»±c hiá»‡n thay Ä‘á»•i nÃ y, hÃ£y cháº¡y láº¡i chÆ°Æ¡ng trÃ¬nh Ä‘á»ƒ xÃ¡c minh ráº±ng viá»‡c phÃ¢n tÃ­ch tham sá»‘ váº«n hoáº¡t Ä‘á»™ng. Viá»‡c kiá»ƒm tra tiáº¿n trÃ¬nh thÆ°á»ng xuyÃªn lÃ  tá»‘t, giÃºp xÃ¡c Ä‘á»‹nh nguyÃªn nhÃ¢n váº¥n Ä‘á» khi chÃºng xáº£y ra.</p>
<h4 id="nhÃ³m-cÃ¡c-giÃ¡-trá»‹-cáº¥u-hÃ¬nh"><a class="header" href="#nhÃ³m-cÃ¡c-giÃ¡-trá»‹-cáº¥u-hÃ¬nh">NhÃ³m CÃ¡c GiÃ¡ Trá»‹ Cáº¥u HÃ¬nh</a></h4>
<p>ChÃºng ta cÃ³ thá»ƒ thá»±c hiá»‡n má»™t bÆ°á»›c nhá» ná»¯a Ä‘á»ƒ cáº£i thiá»‡n hÃ m <code>parse_config</code>. Hiá»‡n táº¡i, chÃºng ta Ä‘ang tráº£ vá» má»™t tuple, nhÆ°ng ngay sau Ä‘Ã³ láº¡i tÃ¡ch tuple Ä‘Ã³ thÃ nh cÃ¡c pháº§n riÃªng láº». ÄÃ¢y lÃ  dáº¥u hiá»‡u ráº±ng cÃ³ láº½ chÃºng ta chÆ°a cÃ³ trá»«u tÆ°á»£ng (abstraction) phÃ¹ há»£p.</p>
<p>Má»™t chá»‰ bÃ¡o khÃ¡c cho tháº¥y cÃ²n cÃ³ thá»ƒ cáº£i thiá»‡n lÃ  pháº§n <code>config</code> trong <code>parse_config</code>, cho tháº¥y hai giÃ¡ trá»‹ chÃºng ta tráº£ vá» cÃ³ liÃªn quan vÃ  Ä‘á»u lÃ  má»™t pháº§n cá»§a má»™t giÃ¡ trá»‹ cáº¥u hÃ¬nh. Hiá»‡n táº¡i, chÃºng ta chá»‰ truyá»n Ä‘áº¡t Ã½ nghÄ©a nÃ y báº±ng cÃ¡ch nhÃ³m hai giÃ¡ trá»‹ vÃ o má»™t tuple; thay vÃ o Ä‘Ã³, chÃºng ta sáº½ Ä‘Æ°a hai giÃ¡ trá»‹ vÃ o má»™t struct vÃ  Ä‘áº·t tÃªn cÃ³ Ã½ nghÄ©a cho tá»«ng trÆ°á»ng trong struct. LÃ m nhÆ° váº­y sáº½ giÃºp nhá»¯ng ngÆ°á»i báº£o trÃ¬ mÃ£ trong tÆ°Æ¡ng lai hiá»ƒu rÃµ cÃ¡ch cÃ¡c giÃ¡ trá»‹ khÃ¡c nhau liÃªn quan vá»›i nhau vÃ  má»¥c Ä‘Ã­ch cá»§a chÃºng lÃ  gÃ¬.</p>
<p>Listing 12-6 trÃ¬nh bÃ y cÃ¡c cáº£i tiáº¿n cho hÃ m <code>parse_config</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust should_panic noplayground"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span>fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let config = parse_config(&amp;args);

    println!("Searching for {}", config.query);
    println!("In file {}", config.file_path);

    let contents = fs::read_to_string(config.file_path)
        .expect("Should have been able to read the file");

    // --snip--
<span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span>}

struct Config {
    query: String,
    file_path: String,
}

fn parse_config(args: &amp;[String]) -&gt; Config {
    let query = args[1].clone();
    let file_path = args[2].clone();

    Config { query, file_path }
}</code></pre>
<p><span class="caption">Listing 12-6: TÃ¡i cáº¥u trÃºc <code>parse_config</code> Ä‘á»ƒ tráº£ vá» má»™t thá»ƒ hiá»‡n cá»§a struct <code>Config</code></span></p>
<p>ChÃºng ta Ä‘Ã£ thÃªm má»™t struct cÃ³ tÃªn <code>Config</code> vá»›i cÃ¡c trÆ°á»ng <code>query</code> vÃ  <code>file_path</code>. Chá»¯ kÃ½ cá»§a <code>parse_config</code> hiá»‡n nay cho biáº¿t nÃ³ tráº£ vá» má»™t giÃ¡ trá»‹ <code>Config</code>. Trong thÃ¢n cá»§a <code>parse_config</code>, nÆ¡i trÆ°á»›c Ä‘Ã¢y chÃºng ta tráº£ vá» cÃ¡c string slice tham chiáº¿u tá»›i cÃ¡c giÃ¡ trá»‹ <code>String</code> trong <code>args</code>, bÃ¢y giá» chÃºng ta Ä‘á»‹nh nghÄ©a <code>Config</code> Ä‘á»ƒ chá»©a cÃ¡c giÃ¡ trá»‹ <code>String</code> sá»Ÿ há»¯u (owned). Biáº¿n <code>args</code> trong <code>main</code> lÃ  chá»§ sá»Ÿ há»¯u cá»§a cÃ¡c giÃ¡ trá»‹ tham sá»‘ vÃ  chá»‰ cho phÃ©p hÃ m <code>parse_config</code> mÆ°á»£n chÃºng, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng ta sáº½ vi pháº¡m quy táº¯c mÆ°á»£n cá»§a Rust náº¿u <code>Config</code> cá»‘ gáº¯ng chiáº¿m quyá»n sá»Ÿ há»¯u cÃ¡c giÃ¡ trá»‹ trong <code>args</code>.</p>
<p>CÃ³ nhiá»u cÃ¡ch Ä‘á»ƒ quáº£n lÃ½ dá»¯ liá»‡u <code>String</code>; cÃ¡ch Ä‘Æ¡n giáº£n nháº¥t, máº·c dÃ¹ hÆ¡i kÃ©m hiá»‡u quáº£, lÃ  gá»i phÆ°Æ¡ng thá»©c <code>clone</code> trÃªn cÃ¡c giÃ¡ trá»‹. Äiá»u nÃ y sáº½ táº¡o má»™t báº£n sao Ä‘áº§y Ä‘á»§ cá»§a dá»¯ liá»‡u Ä‘á»ƒ thá»ƒ hiá»‡n <code>Config</code> sá»Ÿ há»¯u, máº¥t nhiá»u thá»i gian vÃ  bá»™ nhá»› hÆ¡n so vá»›i viá»‡c chá»‰ lÆ°u tham chiáº¿u tá»›i dá»¯ liá»‡u chuá»—i. Tuy nhiÃªn, viá»‡c clone dá»¯ liá»‡u cÅ©ng lÃ m cho mÃ£ cá»§a chÃºng ta ráº¥t trá»±c quan vÃ¬ chÃºng ta khÃ´ng pháº£i quáº£n lÃ½ thá»i gian sá»‘ng cá»§a cÃ¡c tham chiáº¿u; trong trÆ°á»ng há»£p nÃ y, Ä‘Ã¡nh Ä‘á»•i má»™t chÃºt hiá»‡u suáº¥t Ä‘á»ƒ Ä‘á»•i láº¥y sá»± Ä‘Æ¡n giáº£n lÃ  xá»©ng Ä‘Ã¡ng.</p>
<section class="note" aria-role="note">
<h3 id="nhá»¯ng-Ä‘Ã¡nh-Ä‘á»•i-khi-sá»­-dá»¥ng-clone"><a class="header" href="#nhá»¯ng-Ä‘Ã¡nh-Ä‘á»•i-khi-sá»­-dá»¥ng-clone">Nhá»¯ng Ä‘Ã¡nh Ä‘á»•i khi sá»­ dá»¥ng <code>clone</code></a></h3>
<p>Nhiá»u Rustacean cÃ³ xu hÆ°á»›ng trÃ¡nh sá»­ dá»¥ng <code>clone</code> Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» ownership vÃ¬ chi phÃ­ thá»i gian cháº¡y cá»§a nÃ³. Trong <a href="ch13-00-functional-features.html">ChÆ°Æ¡ng 13</a><!-- ignore -->, báº¡n sáº½ há»c cÃ¡ch sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng phÃ¡p hiá»‡u quáº£ hÆ¡n trong tÃ¬nh huá»‘ng nÃ y. NhÆ°ng hiá»‡n táº¡i, sao chÃ©p má»™t vÃ i chuá»—i Ä‘á»ƒ tiáº¿p tá»¥c tiáº¿n triá»ƒn lÃ  á»•n vÃ¬ báº¡n chá»‰ thá»±c hiá»‡n cÃ¡c báº£n sao nÃ y má»™t láº§n vÃ  Ä‘Æ°á»ng dáº«n tá»‡p cÃ¹ng chuá»—i truy váº¥n ráº¥t nhá». Tá»‘t hÆ¡n lÃ  cÃ³ má»™t chÆ°Æ¡ng trÃ¬nh hoáº¡t Ä‘á»™ng hÆ¡i kÃ©m hiá»‡u quáº£ hÆ¡n lÃ  cá»‘ gáº¯ng tá»‘i Æ°u hÃ³a mÃ£ ngay láº§n Ä‘áº§u tiÃªn. Khi báº¡n quen thuá»™c hÆ¡n vá»›i Rust, viá»‡c báº¯t Ä‘áº§u vá»›i giáº£i phÃ¡p hiá»‡u quáº£ nháº¥t sáº½ dá»… dÃ ng hÆ¡n, nhÆ°ng hiá»‡n táº¡i, viá»‡c gá»i <code>clone</code> hoÃ n toÃ n cháº¥p nháº­n Ä‘Æ°á»£c.</p>
</section>
<p>ChÃºng ta Ä‘Ã£ cáº­p nháº­t <code>main</code> Ä‘á»ƒ Ä‘áº·t thá»ƒ hiá»‡n <code>Config</code> Ä‘Æ°á»£c tráº£ vá» tá»« <code>parse_config</code> vÃ o má»™t biáº¿n cÃ³ tÃªn <code>config</code>, vÃ  cáº­p nháº­t mÃ£ trÆ°á»›c Ä‘Ã¢y sá»­ dá»¥ng cÃ¡c biáº¿n riÃªng biá»‡t <code>query</code> vÃ  <code>file_path</code> Ä‘á»ƒ bÃ¢y giá» sá»­ dá»¥ng cÃ¡c trÆ°á»ng trong struct <code>Config</code>.</p>
<p>BÃ¢y giá» mÃ£ cá»§a chÃºng ta truyá»n Ä‘áº¡t rÃµ rÃ ng hÆ¡n ráº±ng <code>query</code> vÃ  <code>file_path</code> cÃ³ liÃªn quan vá»›i nhau vÃ  má»¥c Ä‘Ã­ch cá»§a chÃºng lÃ  cáº¥u hÃ¬nh cÃ¡ch chÆ°Æ¡ng trÃ¬nh hoáº¡t Ä‘á»™ng. Báº¥t ká»³ mÃ£ nÃ o sá»­ dá»¥ng cÃ¡c giÃ¡ trá»‹ nÃ y biáº¿t ráº±ng chÃºng náº±m trong thá»ƒ hiá»‡n <code>config</code> vÃ  Ä‘Æ°á»£c Ä‘áº·t trong cÃ¡c trÆ°á»ng vá»›i tÃªn pháº£n Ã¡nh má»¥c Ä‘Ã­ch.</p>
<h4 id="táº¡o-constructor-cho-config"><a class="header" href="#táº¡o-constructor-cho-config">Táº¡o Constructor cho <code>Config</code></a></h4>
<p>Cho Ä‘áº¿n nay, chÃºng ta Ä‘Ã£ tÃ¡ch logic chá»‹u trÃ¡ch nhiá»‡m phÃ¢n tÃ­ch tham sá»‘ dÃ²ng lá»‡nh ra khá»i <code>main</code> vÃ  Ä‘áº·t nÃ³ trong hÃ m <code>parse_config</code>. Viá»‡c nÃ y giÃºp chÃºng ta tháº¥y ráº±ng cÃ¡c giÃ¡ trá»‹ <code>query</code> vÃ  <code>file_path</code> cÃ³ liÃªn quan vÃ  má»‘i quan há»‡ nÃ y nÃªn Ä‘Æ°á»£c thá»ƒ hiá»‡n trong mÃ£. ChÃºng ta sau Ä‘Ã³ thÃªm má»™t struct <code>Config</code> Ä‘á»ƒ Ä‘áº·t tÃªn cho má»¥c Ä‘Ã­ch liÃªn quan cá»§a <code>query</code> vÃ  <code>file_path</code> vÃ  cÃ³ thá»ƒ tráº£ vá» cÃ¡c giÃ¡ trá»‹ nÃ y vá»›i tÃªn trÆ°á»ng trong struct tá»« hÃ m <code>parse_config</code>.</p>
<p>BÃ¢y giá», má»¥c Ä‘Ã­ch cá»§a hÃ m <code>parse_config</code> lÃ  táº¡o má»™t thá»ƒ hiá»‡n <code>Config</code>, vÃ¬ váº­y chÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i <code>parse_config</code> tá»« má»™t hÃ m thÃ´ng thÆ°á»ng thÃ nh má»™t hÃ m <code>new</code> liÃªn káº¿t vá»›i struct <code>Config</code>. Viá»‡c nÃ y sáº½ lÃ m mÃ£ trá»Ÿ nÃªn idiomatic hÆ¡n. ChÃºng ta cÃ³ thá»ƒ táº¡o cÃ¡c thá»ƒ hiá»‡n cá»§a cÃ¡c kiá»ƒu trong thÆ° viá»‡n chuáº©n, nhÆ° <code>String</code>, báº±ng cÃ¡ch gá»i <code>String::new</code>. TÆ°Æ¡ng tá»±, báº±ng cÃ¡ch Ä‘á»•i <code>parse_config</code> thÃ nh hÃ m <code>new</code> liÃªn káº¿t vá»›i <code>Config</code>, chÃºng ta sáº½ cÃ³ thá»ƒ táº¡o cÃ¡c thá»ƒ hiá»‡n cá»§a <code>Config</code> báº±ng cÃ¡ch gá»i <code>Config::new</code>. Listing 12-7 trÃ¬nh bÃ y cÃ¡c thay Ä‘á»•i cáº§n thá»±c hiá»‡n.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust should_panic noplayground"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span>fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let config = Config::new(&amp;args);
<span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span>
    // --snip--
}

// --snip--

<span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span>impl Config {
    fn new(args: &amp;[String]) -&gt; Config {
        let query = args[1].clone();
        let file_path = args[2].clone();

        Config { query, file_path }
    }
}</code></pre>
<p><span class="caption">Listing 12-7: Chuyá»ƒn <code>parse_config</code> thÃ nh <code>Config::new</code></span></p>
<p>ChÃºng ta Ä‘Ã£ cáº­p nháº­t <code>main</code>, nÆ¡i trÆ°á»›c Ä‘Ã¢y gá»i <code>parse_config</code>, Ä‘á»ƒ thay vÃ o Ä‘Ã³ gá»i <code>Config::new</code>. ChÃºng ta Ä‘Ã£ Ä‘á»•i tÃªn <code>parse_config</code> thÃ nh <code>new</code> vÃ  chuyá»ƒn nÃ³ vÃ o trong má»™t khá»‘i <code>impl</code>, liÃªn káº¿t hÃ m <code>new</code> vá»›i <code>Config</code>. HÃ£y thá»­ biÃªn dá»‹ch láº¡i mÃ£ Ä‘á»ƒ Ä‘áº£m báº£o nÃ³ hoáº¡t Ä‘á»™ng.</p>
<h3 id="sá»­a-xá»­-lÃ½-lá»—i"><a class="header" href="#sá»­a-xá»­-lÃ½-lá»—i">Sá»­a Xá»­ LÃ½ Lá»—i</a></h3>
<p>BÃ¢y giá» chÃºng ta sáº½ sá»­a cÃ¡ch xá»­ lÃ½ lá»—i. HÃ£y nhá»› ráº±ng viá»‡c truy cáº­p cÃ¡c giÃ¡ trá»‹ trong vector <code>args</code> táº¡i chá»‰ sá»‘ 1 hoáº·c 2 sáº½ khiáº¿n chÆ°Æ¡ng trÃ¬nh panic náº¿u vector chá»©a Ã­t hÆ¡n ba pháº§n tá»­. HÃ£y thá»­ cháº¡y chÆ°Æ¡ng trÃ¬nh mÃ  khÃ´ng cÃ³ tham sá»‘ nÃ o; káº¿t quáº£ sáº½ nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/minigrep`

thread 'main' panicked at src/main.rs:27:21:
index out of bounds: the len is 1 but the index is 1
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>DÃ²ng <code>index out of bounds: the len is 1 but the index is 1</code> lÃ  thÃ´ng bÃ¡o lá»—i dÃ nh cho láº­p trÃ¬nh viÃªn. NÃ³ sáº½ khÃ´ng giÃºp ngÆ°á»i dÃ¹ng cuá»‘i hiá»ƒu há» nÃªn lÃ m gÃ¬. HÃ£y sá»­a Ä‘iá»u Ä‘Ã³ ngay bÃ¢y giá».</p>
<h4 id="cáº£i-thiá»‡n-thÃ´ng-bÃ¡o-lá»—i"><a class="header" href="#cáº£i-thiá»‡n-thÃ´ng-bÃ¡o-lá»—i">Cáº£i Thiá»‡n ThÃ´ng BÃ¡o Lá»—i</a></h4>
<p>Trong Listing 12-8, chÃºng ta thÃªm má»™t kiá»ƒm tra trong hÃ m <code>new</code> Ä‘á»ƒ xÃ¡c minh ráº±ng slice Ä‘á»§ dÃ i trÆ°á»›c khi truy cáº­p chá»‰ sá»‘ 1 vÃ  2. Náº¿u slice khÃ´ng Ä‘á»§ dÃ i, chÆ°Æ¡ng trÃ¬nh sáº½ panic vÃ  hiá»ƒn thá»‹ má»™t thÃ´ng bÃ¡o lá»—i tá»‘t hÆ¡n.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::new(&amp;args);
</span><span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span>    // --snip--
    fn new(args: &amp;[String]) -&gt; Config {
        if args.len() &lt; 3 {
            panic!("not enough arguments");
        }
        // --snip--
<span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Config { query, file_path }
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-8: ThÃªm kiá»ƒm tra sá»‘ lÆ°á»£ng tham sá»‘</span></p>
<p>MÃ£ nÃ y tÆ°Æ¡ng tá»± vá»›i <a href="ch09-03-to-panic-or-not-to-panic.html#creating-custom-types-for-validation">hÃ m <code>Guess::new</code> mÃ  chÃºng ta Ä‘Ã£ viáº¿t trong Listing 9-13</a><!-- ignore -->, nÆ¡i chÃºng ta gá»i <code>panic!</code> khi tham sá»‘ <code>value</code> náº±m ngoÃ i pháº¡m vi giÃ¡ trá»‹ há»£p lá»‡. Thay vÃ¬ kiá»ƒm tra pháº¡m vi giÃ¡ trá»‹ á»Ÿ Ä‘Ã¢y, chÃºng ta kiá»ƒm tra ráº±ng Ä‘á»™ dÃ i cá»§a <code>args</code> Ã­t nháº¥t lÃ  3 vÃ  pháº§n cÃ²n láº¡i cá»§a hÃ m cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng vá»›i giáº£ Ä‘á»‹nh Ä‘iá»u kiá»‡n nÃ y Ä‘Ã£ Ä‘Æ°á»£c thá»a mÃ£n. Náº¿u <code>args</code> cÃ³ Ã­t hÆ¡n ba pháº§n tá»­, Ä‘iá»u kiá»‡n nÃ y sáº½ Ä‘Ãºng, vÃ  chÃºng ta gá»i macro <code>panic!</code> Ä‘á»ƒ káº¿t thÃºc chÆ°Æ¡ng trÃ¬nh ngay láº­p tá»©c.</p>
<p>Vá»›i vÃ i dÃ²ng mÃ£ bá»• sung trong <code>new</code>, hÃ£y cháº¡y láº¡i chÆ°Æ¡ng trÃ¬nh mÃ  khÃ´ng cÃ³ tham sá»‘ nÃ o Ä‘á»ƒ xem thÃ´ng bÃ¡o lá»—i trÃ´ng nhÆ° tháº¿ nÃ o bÃ¢y giá»:</p>
<pre><code class="language-console">$ cargo run
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/minigrep`

thread 'main' panicked at src/main.rs:26:13:
not enough arguments
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>Káº¿t quáº£ nÃ y tá»‘t hÆ¡n: chÃºng ta giá» cÃ³ má»™t thÃ´ng bÃ¡o lá»—i há»£p lÃ½. Tuy nhiÃªn, cÅ©ng cÃ³ má»™t sá»‘ thÃ´ng tin thá»«a mÃ  chÃºng ta khÃ´ng muá»‘n cung cáº¥p cho ngÆ°á»i dÃ¹ng. CÃ³ láº½ ká»¹ thuáº­t mÃ  chÃºng ta Ä‘Ã£ dÃ¹ng trong Listing 9-13 khÃ´ng pháº£i lÃ  cÃ¡ch tá»‘t nháº¥t á»Ÿ Ä‘Ã¢y: viá»‡c gá»i <code>panic!</code> thÃ­ch há»£p hÆ¡n cho váº¥n Ä‘á» láº­p trÃ¬nh hÆ¡n lÃ  váº¥n Ä‘á» sá»­ dá»¥ng, <a href="ch09-03-to-panic-or-not-to-panic.html#guidelines-for-error-handling">nhÆ° Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 9</a><!-- ignore -->. Thay vÃ o Ä‘Ã³, chÃºng ta sáº½ dÃ¹ng ká»¹ thuáº­t khÃ¡c mÃ  báº¡n Ä‘Ã£ há»c trong ChÆ°Æ¡ng 9 â€” <a href="ch09-02-recoverable-errors-with-result.html">tráº£ vá» má»™t <code>Result</code></a><!-- ignore -->, biá»ƒu thá»‹ thÃ nh cÃ´ng hoáº·c lá»—i.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="returning-a-result-from-new-instead-of-calling-panic"></a></p>
<h4 id="tráº£-vá»-result-thay-vÃ¬-gá»i-panic"><a class="header" href="#tráº£-vá»-result-thay-vÃ¬-gá»i-panic">Tráº£ Vá» <code>Result</code> Thay VÃ¬ Gá»i <code>panic!</code></a></h4>
<p>ChÃºng ta cÃ³ thá»ƒ tráº£ vá» má»™t giÃ¡ trá»‹ <code>Result</code>, trong Ä‘Ã³ sáº½ chá»©a má»™t thá»ƒ hiá»‡n <code>Config</code> trong trÆ°á»ng há»£p thÃ nh cÃ´ng vÃ  mÃ´ táº£ váº¥n Ä‘á» trong trÆ°á»ng há»£p lá»—i. ChÃºng ta cÅ©ng sáº½ Ä‘á»•i tÃªn hÃ m tá»« <code>new</code> thÃ nh <code>build</code> vÃ¬ nhiá»u láº­p trÃ¬nh viÃªn ká»³ vá»ng cÃ¡c hÃ m <code>new</code> sáº½ khÃ´ng bao giá» tháº¥t báº¡i. Khi <code>Config::build</code> truyá»n thÃ´ng tin vá» <code>main</code>, chÃºng ta cÃ³ thá»ƒ dÃ¹ng kiá»ƒu <code>Result</code> Ä‘á»ƒ bÃ¡o hiá»‡u cÃ³ váº¥n Ä‘á» xáº£y ra. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i <code>main</code> Ä‘á»ƒ chuyá»ƒn má»™t biáº¿n thá»ƒ <code>Err</code> thÃ nh lá»—i thá»±c táº¿ hÆ¡n cho ngÆ°á»i dÃ¹ng mÃ  khÃ´ng kÃ¨m theo cÃ¡c thÃ´ng tin vá» <code>thread 'main'</code> vÃ  <code>RUST_BACKTRACE</code> mÃ  má»™t láº§n gá»i <code>panic!</code> gÃ¢y ra.</p>
<p>Listing 12-9 trÃ¬nh bÃ y cÃ¡c thay Ä‘á»•i cáº§n thá»±c hiá»‡n Ä‘á»‘i vá»›i giÃ¡ trá»‹ tráº£ vá» cá»§a hÃ m mÃ  bÃ¢y giá» chÃºng ta gá»i lÃ  <code>Config::build</code> vÃ  pháº§n thÃ¢n hÃ m cáº§n Ä‘á»ƒ tráº£ vá» <code>Result</code>. LÆ°u Ã½ ráº±ng mÃ£ nÃ y sáº½ khÃ´ng biÃªn dá»‹ch cho Ä‘áº¿n khi chÃºng ta cáº­p nháº­t <code>main</code>, Ä‘iá»u nÃ y sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n trong listing tiáº¿p theo.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::new(&amp;args);
</span><span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span>impl Config {
    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
        if args.len() &lt; 3 {
            return Err("not enough arguments");
        }

        let query = args[1].clone();
        let file_path = args[2].clone();

        Ok(Config { query, file_path })
    }
}</code></pre>
<p><span class="caption">Listing 12-9: Tráº£ vá» <code>Result</code> tá»« <code>Config::build</code></span></p>
<p>HÃ m <code>build</code> cá»§a chÃºng ta tráº£ vá» má»™t <code>Result</code> vá»›i thá»ƒ hiá»‡n <code>Config</code> trong trÆ°á»ng há»£p thÃ nh cÃ´ng vÃ  má»™t <code>&amp;'static str</code> trong trÆ°á»ng há»£p lá»—i. CÃ¡c giÃ¡ trá»‹ lá»—i cá»§a chÃºng ta sáº½ luÃ´n lÃ  literal string cÃ³ thá»i gian sá»‘ng <code>'static</code>.</p>
<p>ChÃºng ta Ä‘Ã£ thá»±c hiá»‡n hai thay Ä‘á»•i trong thÃ¢n hÃ m: thay vÃ¬ gá»i <code>panic!</code> khi ngÆ°á»i dÃ¹ng khÃ´ng cung cáº¥p Ä‘á»§ tham sá»‘, chÃºng ta bÃ¢y giá» tráº£ vá» má»™t giÃ¡ trá»‹ <code>Err</code>, vÃ  chÃºng ta Ä‘Ã£ bá»c giÃ¡ trá»‹ <code>Config</code> trong <code>Ok</code>. Nhá»¯ng thay Ä‘á»•i nÃ y giÃºp hÃ m phÃ¹ há»£p vá»›i chá»¯ kÃ½ kiá»ƒu má»›i cá»§a nÃ³.</p>
<p>Viá»‡c tráº£ vá» má»™t giÃ¡ trá»‹ <code>Err</code> tá»« <code>Config::build</code> cho phÃ©p hÃ m <code>main</code> xá»­ lÃ½ giÃ¡ trá»‹ <code>Result</code> tráº£ vá» tá»« hÃ m <code>build</code> vÃ  káº¿t thÃºc tiáº¿n trÃ¬nh má»™t cÃ¡ch gá»n gÃ ng hÆ¡n trong trÆ°á»ng há»£p lá»—i.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="calling-confignew-and-handling-errors"></a></p>
<h4 id="gá»i-configbuild-vÃ -xá»­-lÃ½-lá»—i"><a class="header" href="#gá»i-configbuild-vÃ -xá»­-lÃ½-lá»—i">Gá»i <code>Config::build</code> vÃ  Xá»­ LÃ½ Lá»—i</a></h4>
<p>Äá»ƒ xá»­ lÃ½ trÆ°á»ng há»£p lá»—i vÃ  in thÃ´ng bÃ¡o thÃ¢n thiá»‡n vá»›i ngÆ°á»i dÃ¹ng, chÃºng ta cáº§n cáº­p nháº­t <code>main</code> Ä‘á»ƒ xá»­ lÃ½ giÃ¡ trá»‹ <code>Result</code> Ä‘Æ°á»£c tráº£ vá» tá»« <code>Config::build</code>, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 12-10. ChÃºng ta cÅ©ng sáº½ loáº¡i bá» trÃ¡ch nhiá»‡m káº¿t thÃºc cÃ´ng cá»¥ dÃ²ng lá»‡nh vá»›i mÃ£ lá»—i khÃ¡c 0 khá»i <code>panic!</code> vÃ  thay vÃ o Ä‘Ã³ tá»± triá»ƒn khai thá»§ cÃ´ng. MÃ£ thoÃ¡t khÃ¡c 0 lÃ  má»™t quy Æ°á»›c Ä‘á»ƒ bÃ¡o cho tiáº¿n trÃ¬nh gá»i chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta ráº±ng chÆ°Æ¡ng trÃ¬nh Ä‘Ã£ káº¿t thÃºc vá»›i tráº¡ng thÃ¡i lá»—i.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span>use std::process;

fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let config = Config::build(&amp;args).unwrap_or_else(|err| {
        println!("Problem parsing arguments: {err}");
        process::exit(1);
    });

    // --snip--
<span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-10: ThoÃ¡t vá»›i mÃ£ lá»—i náº¿u viá»‡c táº¡o <code>Config</code> tháº¥t báº¡i</span></p>
<p>Trong listing nÃ y, chÃºng ta Ä‘Ã£ sá»­ dá»¥ng má»™t phÆ°Æ¡ng thá»©c mÃ  chÆ°a Ä‘á» cáº­p chi tiáº¿t: <code>unwrap_or_else</code>, Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn <code>Result&lt;T, E&gt;</code> bá»Ÿi thÆ° viá»‡n chuáº©n. Viá»‡c sá»­ dá»¥ng <code>unwrap_or_else</code> cho phÃ©p chÃºng ta Ä‘á»‹nh nghÄ©a má»™t sá»‘ xá»­ lÃ½ lá»—i tÃ¹y chá»‰nh, khÃ´ng dÃ¹ng <code>panic!</code>. Náº¿u <code>Result</code> lÃ  má»™t giÃ¡ trá»‹ <code>Ok</code>, hÃ nh vi cá»§a phÆ°Æ¡ng thá»©c nÃ y tÆ°Æ¡ng tá»± nhÆ° <code>unwrap</code>: nÃ³ tráº£ vá» giÃ¡ trá»‹ bÃªn trong mÃ  <code>Ok</code> bá»c. Tuy nhiÃªn, náº¿u giÃ¡ trá»‹ lÃ  <code>Err</code>, phÆ°Æ¡ng thá»©c nÃ y sáº½ gá»i mÃ£ trong <em>closure</em>, lÃ  má»™t hÃ m áº©n danh mÃ  chÃºng ta Ä‘á»‹nh nghÄ©a vÃ  truyá»n nhÆ° má»™t tham sá»‘ cho <code>unwrap_or_else</code>. ChÃºng ta sáº½ tÃ¬m hiá»ƒu closures chi tiáº¿t hÆ¡n trong <a href="ch13-00-functional-features.html">ChÆ°Æ¡ng 13</a><!-- ignore -->. Hiá»‡n táº¡i, báº¡n chá»‰ cáº§n biáº¿t ráº±ng <code>unwrap_or_else</code> sáº½ truyá»n giÃ¡ trá»‹ bÃªn trong cá»§a <code>Err</code>, trong trÆ°á»ng há»£p nÃ y lÃ  chuá»—i tÄ©nh <code>"not enough arguments"</code> mÃ  chÃºng ta Ä‘Ã£ thÃªm trong Listing 12-9, vÃ o closure cá»§a chÃºng ta thÃ´ng qua tham sá»‘ <code>err</code> xuáº¥t hiá»‡n giá»¯a hai dáº¥u tháº³ng Ä‘á»©ng. MÃ£ trong closure cÃ³ thá»ƒ dÃ¹ng giÃ¡ trá»‹ <code>err</code> khi cháº¡y.</p>
<p>ChÃºng ta Ä‘Ã£ thÃªm má»™t dÃ²ng <code>use</code> má»›i Ä‘á»ƒ Ä‘Æ°a <code>process</code> tá»« thÆ° viá»‡n chuáº©n vÃ o pháº¡m vi. MÃ£ trong closure cháº¡y khi xáº£y ra lá»—i chá»‰ gá»“m hai dÃ²ng: in giÃ¡ trá»‹ <code>err</code> vÃ  gá»i <code>process::exit</code>. HÃ m <code>process::exit</code> sáº½ dá»«ng chÆ°Æ¡ng trÃ¬nh ngay láº­p tá»©c vÃ  tráº£ vá» sá»‘ Ä‘Æ°á»£c truyá»n lÃ m mÃ£ tráº¡ng thÃ¡i thoÃ¡t. Äiá»u nÃ y tÆ°Æ¡ng tá»± cÃ¡ch xá»­ lÃ½ dá»±a trÃªn <code>panic!</code> mÃ  chÃºng ta Ä‘Ã£ dÃ¹ng trong Listing 12-8, nhÆ°ng giá» Ä‘Ã¢y chÃºng ta khÃ´ng nháº­n Ä‘Æ°á»£c táº¥t cáº£ thÃ´ng tin thá»«a. HÃ£y thá»­ nÃ³:</p>
<pre><code class="language-console">$ cargo run
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.48s
     Running `target/debug/minigrep`
Problem parsing arguments: not enough arguments
</code></pre>
<p>Tuyá»‡t vá»i! Káº¿t quáº£ nÃ y thÃ¢n thiá»‡n hÆ¡n nhiá»u vá»›i ngÆ°á»i dÃ¹ng cá»§a chÃºng ta.</p>
<h3 id="tÃ¡ch-logic-ra-khá»i-main"><a class="header" href="#tÃ¡ch-logic-ra-khá»i-main">TÃ¡ch Logic Ra Khá»i <code>main</code></a></h3>
<p>BÃ¢y giá» chÃºng ta Ä‘Ã£ hoÃ n táº¥t viá»‡c refactor phÃ¢n tÃ­ch cáº¥u hÃ¬nh, hÃ£y chuyá»ƒn sang logic cá»§a chÆ°Æ¡ng trÃ¬nh. NhÆ° Ä‘Ã£ nÃªu trong <a href="ch12-03-improving-error-handling-and-modularity.html#separation-of-concerns-for-binary-projects">â€œTÃ¡ch Biá»‡t TrÃ¡ch Nhiá»‡m Cho CÃ¡c Dá»± Ãn Binaryâ€</a><!-- ignore -->, chÃºng ta sáº½ tÃ¡ch má»™t hÃ m cÃ³ tÃªn <code>run</code> Ä‘á»ƒ chá»©a táº¥t cáº£ logic hiá»‡n Ä‘ang náº±m trong hÃ m <code>main</code> mÃ  khÃ´ng liÃªn quan Ä‘áº¿n viá»‡c thiáº¿t láº­p cáº¥u hÃ¬nh hoáº·c xá»­ lÃ½ lá»—i. Khi hoÃ n táº¥t, <code>main</code> sáº½ ngáº¯n gá»n vÃ  dá»… kiá»ƒm tra báº±ng cÃ¡ch Ä‘á»c, vÃ  chÃºng ta sáº½ cÃ³ thá»ƒ viáº¿t cÃ¡c bÃ i kiá»ƒm tra cho toÃ n bá»™ logic cÃ²n láº¡i.</p>
<p>Listing 12-11 trÃ¬nh bÃ y hÃ m <code>run</code> Ä‘Ã£ Ä‘Æ°á»£c tÃ¡ch. Hiá»‡n táº¡i, chÃºng ta chá»‰ thá»±c hiá»‡n cáº£i tiáº¿n nhá», tá»«ng bÆ°á»›c báº±ng cÃ¡ch tÃ¡ch hÃ m. ChÃºng ta váº«n Ä‘á»‹nh nghÄ©a hÃ m nÃ y trong <em>src/main.rs</em>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span><span class="boring">
</span>fn main() {
    // --snip--

<span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::build(&amp;args).unwrap_or_else(|err| {
</span><span class="boring">        println!("Problem parsing arguments: {err}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    });
</span><span class="boring">
</span>    println!("Searching for {}", config.query);
    println!("In file {}", config.file_path);

    run(config);
}

fn run(config: Config) {
    let contents = fs::read_to_string(config.file_path)
        .expect("Should have been able to read the file");

    println!("With text:\n{contents}");
}

// --snip--
<span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-11: TÃ¡ch hÃ m <code>run</code> chá»©a pháº§n cÃ²n láº¡i cá»§a logic chÆ°Æ¡ng trÃ¬nh</span></p>
<p>HÃ m <code>run</code> bÃ¢y giá» chá»©a táº¥t cáº£ logic cÃ²n láº¡i tá»« <code>main</code>, báº¯t Ä‘áº§u tá»« viá»‡c Ä‘á»c file. HÃ m <code>run</code> nháº­n thá»ƒ hiá»‡n <code>Config</code> lÃ m tham sá»‘.</p>
<h4 id="tráº£-lá»—i-tá»«-hÃ m-run"><a class="header" href="#tráº£-lá»—i-tá»«-hÃ m-run">Tráº£ Lá»—i tá»« HÃ m <code>run</code></a></h4>
<p>Vá»›i logic chÆ°Æ¡ng trÃ¬nh cÃ²n láº¡i Ä‘Ã£ Ä‘Æ°á»£c tÃ¡ch ra thÃ nh hÃ m <code>run</code>, chÃºng ta cÃ³ thá»ƒ cáº£i thiá»‡n viá»‡c xá»­ lÃ½ lá»—i, giá»‘ng nhÆ° Ä‘Ã£ lÃ m vá»›i <code>Config::build</code> trong Listing 12-9. Thay vÃ¬ Ä‘á»ƒ chÆ°Æ¡ng trÃ¬nh panic báº±ng cÃ¡ch gá»i <code>expect</code>, hÃ m <code>run</code> sáº½ tráº£ vá» má»™t <code>Result&lt;T, E&gt;</code> khi cÃ³ váº¥n Ä‘á» xáº£y ra. Äiá»u nÃ y cho phÃ©p chÃºng ta tiáº¿p tá»¥c gom gá»n logic xá»­ lÃ½ lá»—i vÃ o <code>main</code> theo cÃ¡ch thÃ¢n thiá»‡n vá»›i ngÆ°á»i dÃ¹ng. Listing 12-12 trÃ¬nh bÃ y cÃ¡c thay Ä‘á»•i cáº§n thá»±c hiá»‡n Ä‘á»‘i vá»›i chá»¯ kÃ½ vÃ  thÃ¢n hÃ m cá»§a <code>run</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span>use std::error::Error;

// --snip--

<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::build(&amp;args).unwrap_or_else(|err| {
</span><span class="boring">        println!("Problem parsing arguments: {err}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    });
</span><span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    run(config);
</span><span class="boring">}
</span><span class="boring">
</span>fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let contents = fs::read_to_string(config.file_path)?;

    println!("With text:\n{contents}");

    Ok(())
}
<span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-12: Thay Ä‘á»•i hÃ m <code>run</code> Ä‘á»ƒ tráº£ vá» <code>Result</code></span></p>
<p>ChÃºng ta Ä‘Ã£ thá»±c hiá»‡n ba thay Ä‘á»•i quan trá»ng á»Ÿ Ä‘Ã¢y. Thá»© nháº¥t, chÃºng ta thay Ä‘á»•i kiá»ƒu tráº£ vá» cá»§a hÃ m <code>run</code> thÃ nh <code>Result&lt;(), Box&lt;dyn Error&gt;&gt;</code>. TrÆ°á»›c Ä‘Ã¢y hÃ m nÃ y tráº£ vá» kiá»ƒu unit <code>()</code>, vÃ  chÃºng ta giá»¯ giÃ¡ trá»‹ Ä‘Ã³ trong trÆ°á»ng há»£p <code>Ok</code>.</p>
<p>Äá»‘i vá»›i kiá»ƒu lá»—i, chÃºng ta dÃ¹ng <em>trait object</em> <code>Box&lt;dyn Error&gt;</code> (vÃ  Ä‘Ã£ Ä‘Æ°a <code>std::error::Error</code> vÃ o pháº¡m vi vá»›i má»™t cÃ¢u lá»‡nh <code>use</code> á»Ÿ Ä‘áº§u). ChÃºng ta sáº½ tÃ¬m hiá»ƒu trait object trong <a href="ch17-00-oop.html">ChÆ°Æ¡ng 17</a><!-- ignore -->. Hiá»‡n táº¡i, chá»‰ cáº§n biáº¿t ráº±ng <code>Box&lt;dyn Error&gt;</code> nghÄ©a lÃ  hÃ m sáº½ tráº£ vá» má»™t kiá»ƒu triá»ƒn khai trait <code>Error</code>, nhÆ°ng chÃºng ta khÃ´ng pháº£i chá»‰ Ä‘á»‹nh loáº¡i cá»¥ thá»ƒ cá»§a giÃ¡ trá»‹ tráº£ vá». Äiá»u nÃ y cho phÃ©p chÃºng ta linh hoáº¡t tráº£ vá» cÃ¡c giÃ¡ trá»‹ lá»—i cÃ³ thá»ƒ khÃ¡c nhau trong cÃ¡c trÆ°á»ng há»£p lá»—i khÃ¡c nhau. Tá»« khÃ³a <code>dyn</code> lÃ  viáº¿t táº¯t cá»§a â€œdynamicâ€.</p>
<p>Thá»© hai, chÃºng ta Ä‘Ã£ loáº¡i bá» viá»‡c gá»i <code>expect</code> vÃ  thay báº±ng toÃ¡n tá»­ <code>?</code>, nhÆ° Ä‘Ã£ bÃ n trong <a href="ch09-02-recoverable-errors-with-result.html#a-shortcut-for-propagating-errors-the--operator">ChÆ°Æ¡ng 9</a><!-- ignore -->. Thay vÃ¬ <code>panic!</code> khi cÃ³ lá»—i, <code>?</code> sáº½ tráº£ vá» giÃ¡ trá»‹ lá»—i tá»« hÃ m hiá»‡n táº¡i cho hÃ m gá»i xá»­ lÃ½.</p>
<p>Thá»© ba, hÃ m <code>run</code> bÃ¢y giá» tráº£ vá» giÃ¡ trá»‹ <code>Ok</code> trong trÆ°á»ng há»£p thÃ nh cÃ´ng. ChÃºng ta khai bÃ¡o kiá»ƒu thÃ nh cÃ´ng cá»§a hÃ m <code>run</code> lÃ  <code>()</code> trong chá»¯ kÃ½, cÃ³ nghÄ©a lÃ  chÃºng ta cáº§n bá»c giÃ¡ trá»‹ unit trong <code>Ok</code>. CÃº phÃ¡p <code>Ok(())</code> cÃ³ váº» hÆ¡i láº¡ lÃºc Ä‘áº§u, nhÆ°ng dÃ¹ng <code>()</code> nhÆ° tháº¿ nÃ y lÃ  cÃ¡ch idiomatic Ä‘á»ƒ biá»ƒu thá»‹ ráº±ng chÃºng ta gá»i <code>run</code> chá»‰ vÃ¬ hiá»‡u á»©ng phá»¥; nÃ³ khÃ´ng tráº£ vá» giÃ¡ trá»‹ mÃ  chÃºng ta cáº§n.</p>
<p>Khi cháº¡y mÃ£ nÃ y, nÃ³ sáº½ biÃªn dá»‹ch nhÆ°ng sáº½ hiá»ƒn thá»‹ má»™t cáº£nh bÃ¡o:</p>
<pre><code class="language-console">$ cargo run -- the poem.txt
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
warning: unused `Result` that must be used
  --&gt; src/main.rs:19:5
   |
19 |     run(config);
   |     ^^^^^^^^^^^
   |
   = note: this `Result` may be an `Err` variant, which should be handled
   = note: `#[warn(unused_must_use)]` on by default
help: use `let _ = ...` to ignore the resulting value
   |
19 |     let _ = run(config);
   |     +++++++

warning: `minigrep` (bin "minigrep") generated 1 warning
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.71s
     Running `target/debug/minigrep the poem.txt`
Searching for the
In file poem.txt
With text:
I'm nobody! Who are you?
Are you nobody, too?
Then there's a pair of us - don't tell!
They'd banish us, you know.

How dreary to be somebody!
How public, like a frog
To tell your name the livelong day
To an admiring bog!

</code></pre>
<p>Rust bÃ¡o cho chÃºng ta ráº±ng mÃ£ cá»§a chÃºng ta Ä‘Ã£ bá» qua giÃ¡ trá»‹ <code>Result</code> vÃ  giÃ¡ trá»‹ <code>Result</code> cÃ³ thá»ƒ chá»‰ ra ráº±ng Ä‘Ã£ xáº£y ra lá»—i. NhÆ°ng chÃºng ta khÃ´ng kiá»ƒm tra xem cÃ³ lá»—i hay khÃ´ng, vÃ  trÃ¬nh biÃªn dá»‹ch nháº¯c nhá»Ÿ ráº±ng cÃ³ láº½ chÃºng ta muá»‘n cÃ³ má»™t sá»‘ mÃ£ xá»­ lÃ½ lá»—i á»Ÿ Ä‘Ã¢y! HÃ£y kháº¯c phá»¥c váº¥n Ä‘á» Ä‘Ã³ ngay bÃ¢y giá».</p>
<h4 id="xá»­-lÃ½-lá»—i-tráº£-vá»-tá»«-run-trong-main"><a class="header" href="#xá»­-lÃ½-lá»—i-tráº£-vá»-tá»«-run-trong-main">Xá»­ LÃ½ Lá»—i Tráº£ Vá» Tá»« <code>run</code> Trong <code>main</code></a></h4>
<p>ChÃºng ta sáº½ kiá»ƒm tra lá»—i vÃ  xá»­ lÃ½ chÃºng báº±ng má»™t ká»¹ thuáº­t tÆ°Æ¡ng tá»± nhÆ° Ä‘Ã£ dÃ¹ng vá»›i <code>Config::build</code> trong Listing 12-10, nhÆ°ng cÃ³ má»™t chÃºt khÃ¡c biá»‡t:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::error::Error;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span><span class="boring">
</span>fn main() {
    // --snip--

<span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::build(&amp;args).unwrap_or_else(|err| {
</span><span class="boring">        println!("Problem parsing arguments: {err}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    });
</span><span class="boring">
</span>    println!("Searching for {}", config.query);
    println!("In file {}", config.file_path);

    if let Err(e) = run(config) {
        println!("Application error: {e}");
        process::exit(1);
    }
}
<span class="boring">
</span><span class="boring">fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)?;
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span><span class="boring">
</span><span class="boring">    Ok(())
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>ChÃºng ta sá»­ dá»¥ng <code>if let</code> thay vÃ¬ <code>unwrap_or_else</code> Ä‘á»ƒ kiá»ƒm tra xem <code>run</code> cÃ³ tráº£ vá» giÃ¡ trá»‹ <code>Err</code> khÃ´ng vÃ  gá»i <code>process::exit(1)</code> náº¿u cÃ³. HÃ m <code>run</code> khÃ´ng tráº£ vá» má»™t giÃ¡ trá»‹ mÃ  chÃºng ta muá»‘n <code>unwrap</code> giá»‘ng nhÆ° <code>Config::build</code> tráº£ vá» thá»ƒ hiá»‡n <code>Config</code>. VÃ¬ <code>run</code> tráº£ vá» <code>()</code> trong trÆ°á»ng há»£p thÃ nh cÃ´ng, chÃºng ta chá»‰ quan tÃ¢m Ä‘áº¿n viá»‡c phÃ¡t hiá»‡n lá»—i, nÃªn khÃ´ng cáº§n dÃ¹ng <code>unwrap_or_else</code> Ä‘á»ƒ tráº£ vá» giÃ¡ trá»‹ Ä‘Ã£ Ä‘Æ°á»£c unwrap, vá»‘n chá»‰ lÃ  <code>()</code>.</p>
<p>ThÃ¢n hÃ m cá»§a <code>if let</code> vÃ  <code>unwrap_or_else</code> Ä‘á»u giá»‘ng nhau trong cáº£ hai trÆ°á»ng há»£p: chÃºng ta in lá»—i vÃ  thoÃ¡t chÆ°Æ¡ng trÃ¬nh.</p>
<h3 id="tÃ¡ch-mÃ£-thÃ nh-thÆ°-viá»‡n-library-crate"><a class="header" href="#tÃ¡ch-mÃ£-thÃ nh-thÆ°-viá»‡n-library-crate">TÃ¡ch MÃ£ ThÃ nh ThÆ° Viá»‡n (Library Crate)</a></h3>
<p>Dá»± Ã¡n <code>minigrep</code> cá»§a chÃºng ta trÃ´ng khÃ¡ á»•n rá»“i! BÃ¢y giá» chÃºng ta sáº½ tÃ¡ch file <em>src/main.rs</em> vÃ  chuyá»ƒn má»™t sá»‘ mÃ£ vÃ o file <em>src/lib.rs</em>. Báº±ng cÃ¡ch Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ viáº¿t test cho mÃ£ vÃ  cÃ³ má»™t file <em>src/main.rs</em> vá»›i Ã­t trÃ¡ch nhiá»‡m hÆ¡n.</p>
<p>HÃ£y chuyá»ƒn táº¥t cáº£ mÃ£ khÃ´ng pháº£i hÃ m <code>main</code> tá»« <em>src/main.rs</em> sang <em>src/lib.rs</em>:</p>
<ul>
<li>Äá»‹nh nghÄ©a hÃ m <code>run</code></li>
<li>CÃ¡c cÃ¢u lá»‡nh <code>use</code> liÃªn quan</li>
<li>Äá»‹nh nghÄ©a cá»§a <code>Config</code></li>
<li>Äá»‹nh nghÄ©a hÃ m <code>Config::build</code></li>
</ul>
<p>Ná»™i dung cá»§a <em>src/lib.rs</em> nÃªn cÃ³ chá»¯ kÃ½ cÃ¡c hÃ m nhÆ° trong Listing 12-13 (chÃºng tÃ´i Ä‘Ã£ bá» qua thÃ¢n hÃ m Ä‘á»ƒ ngáº¯n gá»n). LÆ°u Ã½ ráº±ng mÃ£ nÃ y sáº½ khÃ´ng biÃªn dá»‹ch cho Ä‘áº¿n khi chÃºng ta chá»‰nh sá»­a <em>src/main.rs</em> trong Listing 12-14.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    unimplemented!();
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-13: Chuyá»ƒn <code>Config</code> vÃ  <code>run</code> vÃ o <em>src/lib.rs</em></span></p>
<p>ChÃºng ta Ä‘Ã£ sá»­ dá»¥ng rá»™ng rÃ£i tá»« khÃ³a <code>pub</code>: trÃªn <code>Config</code>, trÃªn cÃ¡c trÆ°á»ng cá»§a nÃ³ vÃ  phÆ°Æ¡ng thá»©c <code>build</code>, cÅ©ng nhÆ° trÃªn hÃ m <code>run</code>. BÃ¢y giá» chÃºng ta cÃ³ má»™t library crate vá»›i API cÃ´ng khai mÃ  chÃºng ta cÃ³ thá»ƒ viáº¿t test!</p>
<p>BÃ¢y giá» chÃºng ta cáº§n Ä‘Æ°a mÃ£ Ä‘Ã£ chuyá»ƒn vÃ o <em>src/lib.rs</em> vÃ o pháº¡m vi cá»§a binary crate trong <em>src/main.rs</em>, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 12-14.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::error::Error;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span><span class="boring">
</span>// --snip--
use minigrep::search;

fn main() {
    // --snip--
<span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::build(&amp;args).unwrap_or_else(|err| {
</span><span class="boring">        println!("Problem parsing arguments: {err}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    });
</span><span class="boring">
</span><span class="boring">    if let Err(e) = run(config) {
</span><span class="boring">        println!("Application error: {e}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    }
</span>}

// --snip--

<span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let contents = fs::read_to_string(config.file_path)?;

    for line in search(&amp;config.query, &amp;contents) {
        println!("{line}");
    }

    Ok(())
}</code></pre>
<p><span class="caption">Listing 12-14: Sá»­ dá»¥ng library crate <code>minigrep</code> trong <em>src/main.rs</em></span></p>
<p>ChÃºng ta thÃªm má»™t dÃ²ng <code>use minigrep::Config</code> Ä‘á»ƒ Ä‘Æ°a kiá»ƒu <code>Config</code> tá»« library crate vÃ o pháº¡m vi cá»§a binary crate, vÃ  tiá»n tá»‘ hÃ m <code>run</code> báº±ng tÃªn crate cá»§a chÃºng ta. BÃ¢y giá» táº¥t cáº£ chá»©c nÄƒng nÃªn Ä‘Æ°á»£c káº¿t ná»‘i vÃ  hoáº¡t Ä‘á»™ng. Cháº¡y chÆ°Æ¡ng trÃ¬nh vá»›i <code>cargo run</code> vÃ  Ä‘áº£m báº£o má»i thá»© hoáº¡t Ä‘á»™ng Ä‘Ãºng.</p>
<p>HÃº! ÄÃ³ lÃ  má»™t khá»‘i lÆ°á»£ng cÃ´ng viá»‡c khÃ¡ lá»›n, nhÆ°ng chÃºng ta Ä‘Ã£ chuáº©n bá»‹ tá»‘t cho thÃ nh cÃ´ng trong tÆ°Æ¡ng lai. BÃ¢y giá» viá»‡c xá»­ lÃ½ lá»—i trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n, vÃ  chÃºng ta Ä‘Ã£ lÃ m cho mÃ£ modular hÆ¡n. Háº§u háº¿t cÃ´ng viá»‡c cá»§a chÃºng ta tá»« Ä‘Ã¢y vá» sau sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n trong <em>src/lib.rs</em>.</p>
<p>HÃ£y táº­n dá»¥ng tÃ­nh modular má»›i nÃ y báº±ng cÃ¡ch lÃ m má»™t viá»‡c mÃ  trÆ°á»›c Ä‘Ã¢y sáº½ khÃ³ vá»›i mÃ£ cÅ© nhÆ°ng giá» Ä‘Ã¢y láº¡i dá»… dÃ ng: chÃºng ta sáº½ viáº¿t má»™t sá»‘ bÃ i kiá»ƒm tra (tests)!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="phÃ¡t-triá»ƒn-chá»©c-nÄƒng-cá»§a-thÆ°-viá»‡n-vá»›i-phÃ¡t-triá»ƒn-theo-kiá»ƒm-tra-tdd"><a class="header" href="#phÃ¡t-triá»ƒn-chá»©c-nÄƒng-cá»§a-thÆ°-viá»‡n-vá»›i-phÃ¡t-triá»ƒn-theo-kiá»ƒm-tra-tdd">PhÃ¡t Triá»ƒn Chá»©c NÄƒng Cá»§a ThÆ° Viá»‡n Vá»›i PhÃ¡t Triá»ƒn Theo Kiá»ƒm Tra (TDD)</a></h2>
<p>BÃ¢y giá» chÃºng ta Ä‘Ã£ tÃ¡ch logic vÃ o <em>src/lib.rs</em> vÃ  giá»¯ pháº§n thu tháº­p Ä‘á»‘i sá»‘ vÃ  xá»­ lÃ½ lá»—i trong <em>src/main.rs</em>, viá»‡c viáº¿t test cho chá»©c nÄƒng cá»‘t lÃµi cá»§a mÃ£ trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n nhiá»u. ChÃºng ta cÃ³ thá»ƒ gá»i trá»±c tiáº¿p cÃ¡c hÃ m vá»›i cÃ¡c Ä‘á»‘i sá»‘ khÃ¡c nhau vÃ  kiá»ƒm tra giÃ¡ trá»‹ tráº£ vá» mÃ  khÃ´ng cáº§n pháº£i gá»i binary tá»« dÃ²ng lá»‡nh.</p>
<p>Trong pháº§n nÃ y, chÃºng ta sáº½ thÃªm logic tÃ¬m kiáº¿m vÃ o chÆ°Æ¡ng trÃ¬nh <code>minigrep</code> báº±ng quy trÃ¬nh phÃ¡t triá»ƒn theo kiá»ƒm tra (test-driven development, TDD) vá»›i cÃ¡c bÆ°á»›c sau:</p>
<ol>
<li>Viáº¿t má»™t test mÃ  sáº½ tháº¥t báº¡i vÃ  cháº¡y nÃ³ Ä‘á»ƒ Ä‘áº£m báº£o nÃ³ tháº¥t báº¡i vÃ¬ lÃ½ do báº¡n mong Ä‘á»£i.</li>
<li>Viáº¿t hoáº·c sá»­a Ä‘á»•i Ä‘á»§ mÃ£ Ä‘á»ƒ test má»›i nÃ y thÃ nh cÃ´ng.</li>
<li>Refactor mÃ£ vá»«a thÃªm hoáº·c thay Ä‘á»•i vÃ  Ä‘áº£m báº£o cÃ¡c test váº«n cháº¡y Ä‘Ãºng.</li>
<li>Láº·p láº¡i tá»« bÆ°á»›c 1!</li>
</ol>
<p>Máº·c dÃ¹ Ä‘Ã¢y chá»‰ lÃ  má»™t trong nhiá»u cÃ¡ch viáº¿t pháº§n má»m, TDD cÃ³ thá»ƒ giÃºp Ä‘á»‹nh hÆ°á»›ng thiáº¿t káº¿ mÃ£. Viáº¿t test trÆ°á»›c khi viáº¿t mÃ£ lÃ m test Ä‘Ã³ thÃ nh cÃ´ng giÃºp duy trÃ¬ Ä‘á»™ bao phá»§ test cao trong suá»‘t quÃ¡ trÃ¬nh.</p>
<p>ChÃºng ta sáº½ viáº¿t test Ä‘á»ƒ Ä‘iá»u khiá»ƒn viá»‡c triá»ƒn khai chá»©c nÄƒng thá»±c sá»± sáº½ tÃ¬m kiáº¿m chuá»—i query trong ná»™i dung file vÃ  táº¡o ra danh sÃ¡ch cÃ¡c dÃ²ng khá»›p vá»›i query. ChÃºng ta sáº½ thÃªm chá»©c nÄƒng nÃ y trong má»™t hÃ m cÃ³ tÃªn <code>search</code>.</p>
<h3 id="viáº¿t-má»™t-test-tháº¥t-báº¡i"><a class="header" href="#viáº¿t-má»™t-test-tháº¥t-báº¡i">Viáº¿t Má»™t Test Tháº¥t Báº¡i</a></h3>
<p>VÃ¬ chÃºng ta khÃ´ng cÃ²n cáº§n chÃºng ná»¯a, hÃ£y loáº¡i bá» cÃ¡c cÃ¢u lá»‡nh <code>println!</code> tá»« <em>src/lib.rs</em> vÃ  <em>src/main.rs</em> mÃ  chÃºng ta Ä‘Ã£ dÃ¹ng Ä‘á»ƒ kiá»ƒm tra hÃ nh vi cá»§a chÆ°Æ¡ng trÃ¬nh. Sau Ä‘Ã³, trong <em>src/lib.rs</em>, thÃªm má»™t module <code>tests</code> vá»›i má»™t hÃ m test, nhÆ° chÃºng ta Ä‘Ã£ lÃ m trong <a href="ch11-01-writing-tests.html#the-anatomy-of-a-test-function">ChÆ°Æ¡ng 11</a><!-- ignore -->. HÃ m test chá»‰ Ä‘á»‹nh hÃ nh vi mÃ  chÃºng ta muá»‘n hÃ m <code>search</code> cÃ³: nÃ³ sáº½ nháº­n má»™t query vÃ  vÄƒn báº£n cáº§n tÃ¬m kiáº¿m, vÃ  tráº£ vá» chá»‰ cÃ¡c dÃ²ng tá»« vÄƒn báº£n chá»©a query. Listing 12-15 trÃ¬nh bÃ y test nÃ y, mÃ£ nÃ y hiá»‡n chÆ°a biÃªn dá»‹ch Ä‘Æ°á»£c.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    unimplemented!();
</span><span class="boring">}
</span><span class="boring">
</span>// --snip--

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn one_result() {
        let query = "duct";
        let contents = "\
Rust:
safe, fast, productive.
Pick three.";

        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
    }
}</code></pre>
<p><span class="caption">Listing 12-15: Táº¡o má»™t test tháº¥t báº¡i cho hÃ m <code>search</code> mÃ  chÃºng ta mong muá»‘n cÃ³</span></p>
<p>Test nÃ y tÃ¬m kiáº¿m chuá»—i <code>"duct"</code>. VÄƒn báº£n mÃ  chÃºng ta Ä‘ang tÃ¬m kiáº¿m cÃ³ ba dÃ²ng, chá»‰ cÃ³ má»™t dÃ²ng chá»©a <code>"duct"</code> (LÆ°u Ã½ ráº±ng dáº¥u gáº¡ch chÃ©o ngÆ°á»£c <code>\</code> sau dáº¥u ngoáº·c kÃ©p má»Ÿ cho Rust biáº¿t khÃ´ng chÃ¨n kÃ½ tá»± newline á»Ÿ Ä‘áº§u ná»™i dung cá»§a literal chuá»—i nÃ y). ChÃºng ta kháº³ng Ä‘á»‹nh ráº±ng giÃ¡ trá»‹ tráº£ vá» tá»« hÃ m <code>search</code> chá»‰ chá»©a dÃ²ng mÃ  chÃºng ta mong Ä‘á»£i.</p>
<p>Hiá»‡n táº¡i chÃºng ta chÆ°a thá»ƒ cháº¡y test nÃ y vÃ  xem nÃ³ tháº¥t báº¡i vÃ¬ test tháº­m chÃ­ cÃ²n chÆ°a biÃªn dá»‹ch Ä‘Æ°á»£c: hÃ m <code>search</code> váº«n chÆ°a tá»“n táº¡i! Theo nguyÃªn táº¯c TDD, chÃºng ta sáº½ thÃªm Ä‘á»§ mÃ£ Ä‘á»ƒ test cÃ³ thá»ƒ biÃªn dá»‹ch vÃ  cháº¡y báº±ng cÃ¡ch thÃªm Ä‘á»‹nh nghÄ©a hÃ m <code>search</code> luÃ´n tráº£ vá» má»™t vector rá»—ng, nhÆ° trong Listing 12-16. Khi Ä‘Ã³, test sáº½ biÃªn dá»‹ch nhÆ°ng tháº¥t báº¡i vÃ¬ má»™t vector rá»—ng khÃ´ng khá»›p vá»›i vector chá»©a dÃ²ng <code>"safe, fast, productive."</code></p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    vec![]
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn one_result() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-16: Äá»‹nh nghÄ©a Ä‘á»§ hÃ m <code>search</code> Ä‘á»ƒ test cá»§a chÃºng ta cÃ³ thá»ƒ biÃªn dá»‹ch</span></p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta cáº§n Ä‘á»‹nh nghÄ©a má»™t lifetime rÃµ rÃ ng <code>'a</code> trong chá»¯ kÃ½ cá»§a hÃ m <code>search</code> vÃ  sá»­ dá»¥ng lifetime Ä‘Ã³ vá»›i tham sá»‘ <code>contents</code> vÃ  giÃ¡ trá»‹ tráº£ vá». Nhá»› láº¡i trong <a href="ch10-03-lifetime-syntax.html">ChÆ°Æ¡ng 10</a><!-- ignore --> ráº±ng cÃ¡c tham sá»‘ lifetime chá»‰ ra lifetime cá»§a tham sá»‘ nÃ o Ä‘Æ°á»£c káº¿t ná»‘i vá»›i lifetime cá»§a giÃ¡ trá»‹ tráº£ vá». Trong trÆ°á»ng há»£p nÃ y, chÃºng ta chá»‰ ra ráº±ng vector tráº£ vá» nÃªn chá»©a cÃ¡c string slice tham chiáº¿u Ä‘áº¿n cÃ¡c slice cá»§a tham sá»‘ <code>contents</code> (thay vÃ¬ tham sá»‘ <code>query</code>).</p>
<p>NÃ³i cÃ¡ch khÃ¡c, chÃºng ta báº£o Rust ráº±ng dá»¯ liá»‡u tráº£ vá» tá»« hÃ m <code>search</code> sáº½ sá»‘ng lÃ¢u báº±ng dá»¯ liá»‡u Ä‘Æ°á»£c truyá»n vÃ o hÃ m <code>search</code> thÃ´ng qua tham sá»‘ <code>contents</code>. Äiá»u nÃ y ráº¥t quan trá»ng! Dá»¯ liá»‡u mÃ  má»™t slice tham chiáº¿u <em>bá»Ÿi</em> nÃ³ cáº§n pháº£i há»£p lá»‡ Ä‘á»ƒ tham chiáº¿u há»£p lá»‡; náº¿u compiler giáº£ sá»­ chÃºng ta táº¡o cÃ¡c string slice tá»« <code>query</code> thay vÃ¬ <code>contents</code>, nÃ³ sáº½ kiá»ƒm tra an toÃ n sai cÃ¡ch.</p>
<p>Náº¿u chÃºng ta quÃªn cÃ¡c annotation lifetime vÃ  cá»‘ biÃªn dá»‹ch hÃ m nÃ y, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i sau:</p>
<pre><code class="language-console">$ cargo build
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
error[E0106]: missing lifetime specifier
 --&gt; src/lib.rs:1:51
  |
1 | pub fn search(query: &amp;str, contents: &amp;str) -&gt; Vec&lt;&amp;str&gt; {
  |                      ----            ----         ^ expected named lifetime parameter
  |
  = help: this function's return type contains a borrowed value, but the signature does not say whether it is borrowed from `query` or `contents`
help: consider introducing a named lifetime parameter
  |
1 | pub fn search&lt;'a&gt;(query: &amp;'a str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
  |              ++++         ++                 ++              ++

For more information about this error, try `rustc --explain E0106`.
error: could not compile `minigrep` (lib) due to 1 previous error
</code></pre>
<p>Rust khÃ´ng thá»ƒ biáº¿t Ä‘Æ°á»£c chÃºng ta cáº§n dÃ¹ng argument nÃ o trong hai argument, vÃ¬ váº­y chÃºng ta cáº§n chá»‰ rÃµ cho nÃ³. VÃ¬ <code>contents</code> lÃ  argument chá»©a toÃ n bá»™ vÄƒn báº£n vÃ  chÃºng ta muá»‘n tráº£ vá» cÃ¡c pháº§n cá»§a vÄƒn báº£n Ä‘Ã³ mÃ  khá»›p vá»›i query, nÃªn chÃºng ta biáº¿t <code>contents</code> lÃ  argument cáº§n Ä‘Æ°á»£c káº¿t ná»‘i vá»›i giÃ¡ trá»‹ tráº£ vá» báº±ng cÃº phÃ¡p lifetime.</p>
<p>CÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c khÃ´ng yÃªu cáº§u báº¡n káº¿t ná»‘i argument vá»›i giÃ¡ trá»‹ tráº£ vá» trong chá»¯ kÃ½ hÃ m, nhÆ°ng thÃ³i quen nÃ y sáº½ trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n theo thá»i gian. Báº¡n cÃ³ thá»ƒ so sÃ¡nh vÃ­ dá»¥ nÃ y vá»›i pháº§n <a href="ch10-03-lifetime-syntax.html#validating-references-with-lifetimes">â€œValidating References with Lifetimesâ€</a><!-- ignore --> trong ChÆ°Æ¡ng 10.</p>
<p>BÃ¢y giá» hÃ£y cháº¡y test:</p>
<pre><code class="language-console">$ cargo test
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.97s
     Running unittests src/lib.rs (target/debug/deps/minigrep-9cd200e5fac0fc94)

running 1 test
test tests::one_result ... FAILED

failures:

---- tests::one_result stdout ----

thread 'tests::one_result' panicked at src/lib.rs:17:9:
assertion `left == right` failed
  left: ["safe, fast, productive."]
 right: []
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::one_result

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p>Tuyá»‡t! Test tháº¥t báº¡i, chÃ­nh xÃ¡c nhÆ° chÃºng ta mong Ä‘á»£i. BÃ¢y giá» hÃ£y viáº¿t mÃ£ Ä‘á»ƒ test thÃ nh cÃ´ng!</p>
<h3 id="viáº¿t-mÃ£-Äá»ƒ-test-thÃ nh-cÃ´ng"><a class="header" href="#viáº¿t-mÃ£-Äá»ƒ-test-thÃ nh-cÃ´ng">Viáº¿t MÃ£ Äá»ƒ Test ThÃ nh CÃ´ng</a></h3>
<p>Hiá»‡n táº¡i, test cá»§a chÃºng ta tháº¥t báº¡i vÃ¬ chÃºng ta luÃ´n tráº£ vá» má»™t vector rá»—ng. Äá»ƒ sá»­a lá»—i Ä‘Ã³ vÃ  triá»ƒn khai <code>search</code>, chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta cáº§n thá»±c hiá»‡n cÃ¡c bÆ°á»›c sau:</p>
<ul>
<li>Láº·p qua tá»«ng dÃ²ng cá»§a ná»™i dung.</li>
<li>Kiá»ƒm tra xem dÃ²ng Ä‘Ã³ cÃ³ chá»©a chuá»—i query khÃ´ng.</li>
<li>Náº¿u cÃ³, thÃªm nÃ³ vÃ o danh sÃ¡ch cÃ¡c giÃ¡ trá»‹ sáº½ tráº£ vá».</li>
<li>Náº¿u khÃ´ng, khÃ´ng lÃ m gÃ¬.</li>
<li>Tráº£ vá» danh sÃ¡ch cÃ¡c káº¿t quáº£ khá»›p.</li>
</ul>
<p>HÃ£y thá»±c hiá»‡n tá»«ng bÆ°á»›c, báº¯t Ä‘áº§u vá»›i viá»‡c láº·p qua cÃ¡c dÃ²ng.</p>
<h4 id="láº·p-qua-cÃ¡c-dÃ²ng-vá»›i-phÆ°Æ¡ng-thá»©c-lines"><a class="header" href="#láº·p-qua-cÃ¡c-dÃ²ng-vá»›i-phÆ°Æ¡ng-thá»©c-lines">Láº·p Qua CÃ¡c DÃ²ng Vá»›i PhÆ°Æ¡ng Thá»©c <code>lines</code></a></h4>
<p>Rust cÃ³ má»™t phÆ°Æ¡ng thá»©c há»¯u Ã­ch Ä‘á»ƒ láº·p tá»«ng dÃ²ng cá»§a chuá»—i, tÃªn lÃ  <code>lines</code>, hoáº¡t Ä‘á»™ng nhÆ° trong Listing 12-17. LÆ°u Ã½ ráº±ng mÃ£ nÃ y chÆ°a biÃªn dá»‹ch Ä‘Æ°á»£c.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    for line in contents.lines() {
        // do something with line
    }
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn one_result() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-17: Láº·p qua tá»«ng dÃ²ng trong <code>contents</code></span></p>
<p>PhÆ°Æ¡ng thá»©c <code>lines</code> tráº£ vá» má»™t iterator. ChÃºng ta sáº½ bÃ n ká»¹ vá» iterator trong <a href="ch13-02-iterators.html">ChÆ°Æ¡ng 13</a><!-- ignore -->, nhÆ°ng hÃ£y nhá»› ráº±ng báº¡n Ä‘Ã£ tháº¥y cÃ¡ch sá»­ dá»¥ng iterator nÃ y trong <a href="ch03-05-control-flow.html#looping-through-a-collection-with-for">Listing 3-5</a><!-- ignore -->, nÆ¡i chÃºng ta dÃ¹ng vÃ²ng láº·p <code>for</code> vá»›i iterator Ä‘á»ƒ cháº¡y má»™t sá»‘ mÃ£ trÃªn tá»«ng pháº§n tá»­ trong má»™t collection.</p>
<h4 id="tÃ¬m-kiáº¿m-chuá»—i-query-trong-má»—i-dÃ²ng"><a class="header" href="#tÃ¬m-kiáº¿m-chuá»—i-query-trong-má»—i-dÃ²ng">TÃ¬m Kiáº¿m Chuá»—i Query Trong Má»—i DÃ²ng</a></h4>
<p>Tiáº¿p theo, chÃºng ta sáº½ kiá»ƒm tra xem dÃ²ng hiá»‡n táº¡i cÃ³ chá»©a chuá»—i query khÃ´ng. May máº¯n lÃ  cÃ¡c string cÃ³ má»™t phÆ°Æ¡ng thá»©c há»¯u Ã­ch tÃªn lÃ  <code>contains</code> lÃ m viá»‡c nÃ y cho chÃºng ta! ThÃªm má»™t lá»i gá»i Ä‘áº¿n phÆ°Æ¡ng thá»©c <code>contains</code> trong hÃ m <code>search</code>, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 12-18. LÆ°u Ã½ ráº±ng mÃ£ nÃ y váº«n chÆ°a biÃªn dá»‹ch Ä‘Æ°á»£c.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    for line in contents.lines() {
        if line.contains(query) {
            // do something with line
        }
    }
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn one_result() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-18: ThÃªm chá»©c nÄƒng kiá»ƒm tra xem dÃ²ng cÃ³ chá»©a chuá»—i trong <code>query</code> khÃ´ng</span></p>
<p>Hiá»‡n táº¡i, chÃºng ta Ä‘ang xÃ¢y dá»±ng dáº§n chá»©c nÄƒng. Äá»ƒ mÃ£ biÃªn dá»‹ch Ä‘Æ°á»£c, chÃºng ta cáº§n tráº£ vá» má»™t giÃ¡ trá»‹ tá»« thÃ¢n hÃ m nhÆ° Ä‘Ã£ chá»‰ ra trong chá»¯ kÃ½ hÃ m.</p>
<h4 id="lÆ°u-cÃ¡c-dÃ²ng-khá»›p"><a class="header" href="#lÆ°u-cÃ¡c-dÃ²ng-khá»›p">LÆ°u CÃ¡c DÃ²ng Khá»›p</a></h4>
<p>Äá»ƒ hoÃ n thiá»‡n hÃ m nÃ y, chÃºng ta cáº§n má»™t cÃ¡ch lÆ°u cÃ¡c dÃ²ng khá»›p mÃ  muá»‘n tráº£ vá». Äá»ƒ lÃ m Ä‘iá»u Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ táº¡o má»™t vector mutable trÆ°á»›c vÃ²ng láº·p <code>for</code> vÃ  gá»i phÆ°Æ¡ng thá»©c <code>push</code> Ä‘á»ƒ lÆ°u má»™t <code>line</code> vÃ o vector. Sau vÃ²ng láº·p <code>for</code>, chÃºng ta tráº£ vá» vector, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 12-19.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    let mut results = Vec::new();

    for line in contents.lines() {
        if line.contains(query) {
            results.push(line);
        }
    }

    results
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn one_result() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-19: LÆ°u cÃ¡c dÃ²ng khá»›p Ä‘á»ƒ cÃ³ thá»ƒ tráº£ vá» chÃºng</span></p>
<p>BÃ¢y giá», hÃ m <code>search</code> sáº½ chá»‰ tráº£ vá» nhá»¯ng dÃ²ng chá»©a <code>query</code>, vÃ  test cá»§a chÃºng ta sáº½ thÃ nh cÃ´ng. HÃ£y cháº¡y test:</p>
<pre><code class="language-console">$ cargo test
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 1.22s
     Running unittests src/lib.rs (target/debug/deps/minigrep-9cd200e5fac0fc94)

running 1 test
test tests::one_result ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

     Running unittests src/main.rs (target/debug/deps/minigrep-9cd200e5fac0fc94)

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests minigrep

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>Test cá»§a chÃºng ta Ä‘Ã£ thÃ nh cÃ´ng, vÃ¬ váº­y chÃºng ta biáº¿t nÃ³ hoáº¡t Ä‘á»™ng!</p>
<p>á» thá»i Ä‘iá»ƒm nÃ y, chÃºng ta cÃ³ thá»ƒ xem xÃ©t cÃ¡c cÆ¡ há»™i Ä‘á»ƒ refactor viá»‡c triá»ƒn khai hÃ m search trong khi váº«n giá»¯ cÃ¡c test thÃ nh cÃ´ng Ä‘á»ƒ duy trÃ¬ cÃ¹ng má»™t chá»©c nÄƒng. MÃ£ trong hÃ m search khÃ´ng tá»‡, nhÆ°ng nÃ³ chÆ°a táº­n dá»¥ng má»™t sá»‘ tÃ­nh nÄƒng há»¯u Ã­ch cá»§a iterator. ChÃºng ta sáº½ quay láº¡i vÃ­ dá»¥ nÃ y trong <a href="ch13-02-iterators.html">ChÆ°Æ¡ng 13</a><!-- ignore -->, nÆ¡i chÃºng ta sáº½ tÃ¬m hiá»ƒu chi tiáº¿t vá» iterator vÃ  xem cÃ¡ch cáº£i thiá»‡n nÃ³.</p>
<h4 id="sá»­-dá»¥ng-hÃ m-search-trong-hÃ m-run"><a class="header" href="#sá»­-dá»¥ng-hÃ m-search-trong-hÃ m-run">Sá»­ dá»¥ng hÃ m <code>search</code> trong hÃ m <code>run</code></a></h4>
<p>BÃ¢y giá» hÃ m <code>search</code> Ä‘Ã£ hoáº¡t Ä‘á»™ng vÃ  Ä‘Æ°á»£c test, chÃºng ta cáº§n gá»i <code>search</code> tá»« hÃ m <code>run</code>. ChÃºng ta cáº§n truyá»n giÃ¡ trá»‹ <code>config.query</code> vÃ  <code>contents</code> mÃ  <code>run</code> Ä‘á»c tá»« file vÃ o hÃ m <code>search</code>. Sau Ä‘Ã³, <code>run</code> sáº½ in tá»«ng dÃ²ng Ä‘Æ°á»£c tráº£ vá» tá»« <code>search</code>:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::error::Error;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span><span class="boring">pub struct Config {
</span><span class="boring">    pub query: String,
</span><span class="boring">    pub file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    pub fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>pub fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let contents = fs::read_to_string(config.file_path)?;

    for line in search(&amp;config.query, &amp;contents) {
        println!("{line}");
    }

    Ok(())
}
<span class="boring">
</span><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.contains(query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn one_result() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>ChÃºng ta váº«n Ä‘ang sá»­ dá»¥ng má»™t vÃ²ng láº·p <code>for</code> Ä‘á»ƒ láº¥y tá»«ng dÃ²ng tá»« <code>search</code> vÃ  in ra.</p>
<p>BÃ¢y giá» toÃ n bá»™ chÆ°Æ¡ng trÃ¬nh nÃªn hoáº¡t Ä‘á»™ng! HÃ£y thá»­ nÃ³, trÆ°á»›c tiÃªn vá»›i má»™t tá»« mÃ  sáº½ tráº£ vá» chÃ­nh xÃ¡c má»™t dÃ²ng tá»« bÃ i thÆ¡ cá»§a Emily Dickinson, <code>"frog"</code>:</p>
<pre><code class="language-console">$ cargo run -- frog poem.txt
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.38s
     Running `target/debug/minigrep frog poem.txt`
How public, like a frog
</code></pre>
<p>Tuyá»‡t! BÃ¢y giá» hÃ£y thá»­ má»™t tá»« sáº½ khá»›p vá»›i nhiá»u dÃ²ng, cháº³ng háº¡n <code>"body"</code>:</p>
<pre><code class="language-console">$ cargo run -- body poem.txt
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/minigrep body poem.txt`
I'm nobody! Who are you?
Are you nobody, too?
How dreary to be somebody!
</code></pre>
<p>VÃ  cuá»‘i cÃ¹ng, hÃ£y cháº¯c cháº¯n ráº±ng chÃºng ta khÃ´ng nháº­n Ä‘Æ°á»£c dÃ²ng nÃ o khi tÃ¬m kiáº¿m má»™t tá»« khÃ´ng xuáº¥t hiá»‡n trong bÃ i thÆ¡, cháº³ng háº¡n <code>"monomorphization"</code>:</p>
<pre><code class="language-console">$ cargo run -- monomorphization poem.txt
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/minigrep monomorphization poem.txt`
</code></pre>
<p>Tuyá»‡t vá»i! ChÃºng ta Ä‘Ã£ xÃ¢y dá»±ng phiÃªn báº£n mini cá»§a má»™t cÃ´ng cá»¥ cá»• Ä‘iá»ƒn vÃ  há»c Ä‘Æ°á»£c ráº¥t nhiá»u vá» cÃ¡ch cáº¥u trÃºc á»©ng dá»¥ng. ChÃºng ta cÅ©ng Ä‘Ã£ tÃ¬m hiá»ƒu má»™t chÃºt vá» nháº­p/xuáº¥t file, lifetimes, testing vÃ  phÃ¢n tÃ­ch tham sá»‘ dÃ²ng lá»‡nh.</p>
<p>Äá»ƒ hoÃ n thiá»‡n dá»± Ã¡n nÃ y, chÃºng ta sáº½ minh há»a ngáº¯n gá»n cÃ¡ch lÃ m viá»‡c vá»›i biáº¿n mÃ´i trÆ°á»ng vÃ  cÃ¡ch in ra lá»—i chuáº©n (standard error), cáº£ hai Ä‘á»u há»¯u Ã­ch khi viáº¿t cÃ¡c chÆ°Æ¡ng trÃ¬nh dÃ²ng lá»‡nh.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="lÃ m-viá»‡c-vá»›i-biáº¿n-mÃ´i-trÆ°á»ng"><a class="header" href="#lÃ m-viá»‡c-vá»›i-biáº¿n-mÃ´i-trÆ°á»ng">LÃ m viá»‡c vá»›i Biáº¿n MÃ´i TrÆ°á»ng</a></h2>
<p>ChÃºng ta sáº½ cáº£i tiáº¿n <code>minigrep</code> báº±ng cÃ¡ch thÃªm má»™t tÃ­nh nÄƒng: tÃ¹y chá»n tÃ¬m kiáº¿m khÃ´ng phÃ¢n biá»‡t chá»¯ hoa chá»¯ thÆ°á»ng, mÃ  ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ báº­t thÃ´ng qua biáº¿n mÃ´i trÆ°á»ng. ChÃºng ta cÃ³ thá»ƒ biáº¿n tÃ­nh nÄƒng nÃ y thÃ nh má»™t tÃ¹y chá»n dÃ²ng lá»‡nh vÃ  yÃªu cáº§u ngÆ°á»i dÃ¹ng nháº­p nÃ³ má»—i láº§n muá»‘n sá»­ dá»¥ng, nhÆ°ng báº±ng cÃ¡ch dÃ¹ng biáº¿n mÃ´i trÆ°á»ng, chÃºng ta cho phÃ©p ngÆ°á»i dÃ¹ng thiáº¿t láº­p má»™t láº§n vÃ  táº¥t cáº£ cÃ¡c tÃ¬m kiáº¿m sau Ä‘Ã³ trong phiÃªn terminal Ä‘Ã³ sáº½ khÃ´ng phÃ¢n biá»‡t chá»¯ hoa chá»¯ thÆ°á»ng.</p>
<h3 id="viáº¿t-test-tháº¥t-báº¡i-cho-hÃ m-search-khÃ´ng-phÃ¢n-biá»‡t-chá»¯-hoa"><a class="header" href="#viáº¿t-test-tháº¥t-báº¡i-cho-hÃ m-search-khÃ´ng-phÃ¢n-biá»‡t-chá»¯-hoa">Viáº¿t Test Tháº¥t Báº¡i cho HÃ m <code>search</code> KhÃ´ng PhÃ¢n Biá»‡t Chá»¯ Hoa</a></h3>
<p>TrÆ°á»›c tiÃªn, chÃºng ta thÃªm má»™t hÃ m má»›i <code>search_case_insensitive</code> sáº½ Ä‘Æ°á»£c gá»i khi biáº¿n mÃ´i trÆ°á»ng cÃ³ giÃ¡ trá»‹. ChÃºng ta sáº½ tiáº¿p tá»¥c theo quy trÃ¬nh TDD, vÃ¬ váº­y bÆ°á»›c Ä‘áº§u tiÃªn lÃ  viáº¿t má»™t test tháº¥t báº¡i. ChÃºng ta sáº½ thÃªm má»™t test má»›i cho hÃ m <code>search_case_insensitive</code> vÃ  Ä‘á»•i tÃªn test cÅ© tá»« <code>one_result</code> thÃ nh <code>case_sensitive</code> Ä‘á»ƒ lÃ m rÃµ sá»± khÃ¡c biá»‡t giá»¯a hai test, nhÆ° minh há»a trong Listing 12-20.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.contains(query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span>#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn case_sensitive() {
        let query = "duct";
        let contents = "\
Rust:
safe, fast, productive.
Pick three.
Duct tape.";

        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
    }

    #[test]
    fn case_insensitive() {
        let query = "rUsT";
        let contents = "\
Rust:
safe, fast, productive.
Pick three.
Trust me.";

        assert_eq!(
            vec!["Rust:", "Trust me."],
            search_case_insensitive(query, contents)
        );
    }
}</code></pre>
<p><span class="caption">Listing 12-20: ThÃªm má»™t test tháº¥t báº¡i má»›i cho
hÃ m khÃ´ng phÃ¢n biá»‡t chá»¯ hoa/chá»¯ thÆ°á»ng mÃ  chÃºng ta sáº¯p thÃªm</span></p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta cÅ©ng Ä‘Ã£ chá»‰nh sá»­a <code>contents</code> cá»§a test cÅ©. ChÃºng ta Ä‘Ã£ thÃªm má»™t dÃ²ng má»›i vá»›i ná»™i dung <code>"Duct tape."</code> sá»­ dá»¥ng chá»¯ D viáº¿t hoa, dÃ²ng nÃ y khÃ´ng nÃªn khá»›p vá»›i query <code>"duct"</code> khi chÃºng ta tÃ¬m kiáº¿m theo kiá»ƒu phÃ¢n biá»‡t chá»¯ hoa/chá»¯ thÆ°á»ng. Viá»‡c thay Ä‘á»•i test cÅ© theo cÃ¡ch nÃ y giÃºp Ä‘áº£m báº£o ráº±ng chÃºng ta khÃ´ng vÃ´ tÃ¬nh phÃ¡ vá»¡ chá»©c nÄƒng tÃ¬m kiáº¿m phÃ¢n biá»‡t chá»¯ hoa/chá»¯ thÆ°á»ng mÃ  chÃºng ta Ä‘Ã£ triá»ƒn khai. Test nÃ y nÃªn cháº¡y Ä‘Æ°á»£c vÃ  sáº½ tiáº¿p tá»¥c cháº¡y khi chÃºng ta lÃ m viá»‡c trÃªn chá»©c nÄƒng tÃ¬m kiáº¿m khÃ´ng phÃ¢n biá»‡t chá»¯ hoa/chá»¯ thÆ°á»ng.</p>
<p>Test má»›i cho tÃ¬m kiáº¿m khÃ´ng phÃ¢n biá»‡t chá»¯ hoa/chá»¯ thÆ°á»ng sá»­ dá»¥ng <code>"rUsT"</code> lÃ m query. Trong hÃ m <code>search_case_insensitive</code> mÃ  chÃºng ta sáº¯p thÃªm, query <code>"rUsT"</code> sáº½ khá»›p vá»›i dÃ²ng chá»©a <code>"Rust:"</code> vá»›i chá»¯ R viáº¿t hoa vÃ  cÅ©ng khá»›p vá»›i dÃ²ng <code>"Trust me."</code> máº·c dÃ¹ cáº£ hai cÃ³ cÃ¡ch viáº¿t khÃ¡c vá»›i query. ÄÃ¢y lÃ  test tháº¥t báº¡i cá»§a chÃºng ta, vÃ  nÃ³ sáº½ khÃ´ng biÃªn dá»‹ch Ä‘Æ°á»£c vÃ¬ chÃºng ta chÆ°a Ä‘á»‹nh nghÄ©a hÃ m <code>search_case_insensitive</code>. Báº¡n cÃ³ thá»ƒ thÃªm má»™t triá»ƒn khai skeleton tráº£ vá» luÃ´n má»™t vector rá»—ng, tÆ°Æ¡ng tá»± nhÆ° cÃ¡ch chÃºng ta lÃ m vá»›i hÃ m <code>search</code> trong Listing 12-16 Ä‘á»ƒ tháº¥y test biÃªn dá»‹ch vÃ  tháº¥t báº¡i.</p>
<h3 id="triá»ƒn-khai-hÃ m-search_case_insensitive"><a class="header" href="#triá»ƒn-khai-hÃ m-search_case_insensitive">Triá»ƒn khai hÃ m <code>search_case_insensitive</code></a></h3>
<p>HÃ m <code>search_case_insensitive</code>, nhÆ° minh há»a trong Listing 12-21, sáº½ gáº§n nhÆ° giá»‘ng há»‡t hÃ m <code>search</code>. Äiá»ƒm khÃ¡c duy nháº¥t lÃ  chÃºng ta sáº½ chuyá»ƒn <code>query</code> vÃ  tá»«ng <code>line</code> vá» chá»¯ thÆ°á»ng, Ä‘á»ƒ dÃ¹ Ä‘áº§u vÃ o cÃ³ kiá»ƒu chá»¯ nÃ o, chÃºng cÅ©ng sáº½ cÃ¹ng kiá»ƒu chá»¯ khi kiá»ƒm tra xem dÃ²ng cÃ³ chá»©a query hay khÃ´ng.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.contains(query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span>pub fn search_case_insensitive&lt;'a&gt;(
    query: &amp;str,
    contents: &amp;'a str,
) -&gt; Vec&lt;&amp;'a str&gt; {
    let query = query.to_lowercase();
    let mut results = Vec::new();

    for line in contents.lines() {
        if line.to_lowercase().contains(&amp;query) {
            results.push(line);
        }
    }

    results
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_sensitive() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Duct tape.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_insensitive() {
</span><span class="boring">        let query = "rUsT";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Trust me.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(
</span><span class="boring">            vec!["Rust:", "Trust me."],
</span><span class="boring">            search_case_insensitive(query, contents)
</span><span class="boring">        );
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-21: Äá»‹nh nghÄ©a hÃ m <code>search_case_insensitive</code>
Ä‘á»ƒ chuyá»ƒn query vÃ  dÃ²ng vá» chá»¯ thÆ°á»ng trÆ°á»›c khi so sÃ¡nh</span></p>
<p>TrÆ°á»›c tiÃªn, chÃºng ta chuyá»ƒn chuá»—i <code>query</code> vá» chá»¯ thÆ°á»ng vÃ  lÆ°u vÃ o má»™t biáº¿n
shadow cÃ¹ng tÃªn. Viá»‡c gá»i <code>to_lowercase</code> trÃªn query lÃ  cáº§n thiáº¿t Ä‘á»ƒ dÃ¹ query
cá»§a ngÆ°á»i dÃ¹ng lÃ  <code>"rust"</code>, <code>"RUST"</code>, <code>"Rust"</code>, hay <code>"rUsT"</code>, chÃºng ta sáº½
xá»­ lÃ½ query nhÆ° thá»ƒ nÃ³ lÃ  <code>"rust"</code> vÃ  khÃ´ng phÃ¢n biá»‡t chá»¯ hoa/chá»¯ thÆ°á»ng.
Máº·c dÃ¹ <code>to_lowercase</code> sáº½ xá»­ lÃ½ Unicode cÆ¡ báº£n, nhÆ°ng khÃ´ng hoÃ n toÃ n chÃ­nh
xÃ¡c 100%. Náº¿u chÃºng ta viáº¿t má»™t á»©ng dá»¥ng thá»±c sá»±, sáº½ cáº§n xá»­ lÃ½ ká»¹ hÆ¡n á»Ÿ
pháº§n nÃ y, nhÆ°ng má»¥c tiÃªu cá»§a pháº§n nÃ y lÃ  biáº¿n mÃ´i trÆ°á»ng, khÃ´ng pháº£i Unicode,
nÃªn chÃºng ta sáº½ táº¡m dá»«ng á»Ÿ Ä‘Ã¢y.</p>
<p>LÆ°u Ã½ ráº±ng <code>query</code> bÃ¢y giá» lÃ  má»™t <code>String</code> thay vÃ¬ má»™t slice cá»§a chuá»—i, vÃ¬
viá»‡c gá»i <code>to_lowercase</code> táº¡o ra dá»¯ liá»‡u má»›i thay vÃ¬ tham chiáº¿u dá»¯ liá»‡u cÃ³ sáºµn.
VÃ­ dá»¥, náº¿u query lÃ  <code>"rUsT"</code>, slice nÃ y khÃ´ng chá»©a chá»¯ <code>u</code> hay <code>t</code> viáº¿t
thÆ°á»ng Ä‘á»ƒ chÃºng ta sá»­ dá»¥ng, nÃªn chÃºng ta pháº£i cáº¥p phÃ¡t má»™t <code>String</code> má»›i
chá»©a <code>"rust"</code>. Khi truyá»n <code>query</code> lÃ m Ä‘á»‘i sá»‘ cho phÆ°Æ¡ng thá»©c <code>contains</code>, chÃºng
ta cáº§n thÃªm dáº¥u &amp; vÃ¬ chá»¯ kÃ½ cá»§a <code>contains</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a Ä‘á»ƒ nháº­n má»™t slice
cá»§a chuá»—i.</p>
<p>Tiáº¿p theo, chÃºng ta gá»i <code>to_lowercase</code> trÃªn tá»«ng <code>line</code> Ä‘á»ƒ chuyá»ƒn táº¥t cáº£
kÃ½ tá»± vá» chá»¯ thÆ°á»ng. Giá» Ä‘Ã¢y, khi <code>line</code> vÃ  <code>query</code> Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn vá» chá»¯
thÆ°á»ng, chÃºng ta sáº½ tÃ¬m tháº¥y cÃ¡c dÃ²ng khá»›p báº¥t ká»ƒ query cÃ³ chá»¯ hoa hay
chá»¯ thÆ°á»ng.</p>
<p>HÃ£y xem liá»‡u triá»ƒn khai nÃ y cÃ³ vÆ°á»£t qua cÃ¡c test khÃ´ng:</p>
<pre><code class="language-console">$ cargo test
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 1.33s
     Running unittests src/lib.rs (target/debug/deps/minigrep-9cd200e5fac0fc94)

running 2 tests
test tests::case_insensitive ... ok
test tests::case_sensitive ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

     Running unittests src/main.rs (target/debug/deps/minigrep-9cd200e5fac0fc94)

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests minigrep

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

</code></pre>
<p>Tuyá»‡t vá»i! CÃ¡c test Ä‘Ã£ vÆ°á»£t qua. BÃ¢y giá», chÃºng ta sáº½ gá»i hÃ m má»›i
<code>search_case_insensitive</code> tá»« hÃ m <code>run</code>. TrÆ°á»›c tiÃªn, chÃºng ta sáº½ thÃªm má»™t
tÃ¹y chá»n cáº¥u hÃ¬nh vÃ o struct <code>Config</code> Ä‘á»ƒ chuyá»ƒn Ä‘á»•i giá»¯a tÃ¬m kiáº¿m phÃ¢n biá»‡t
chá»¯ hoa/chá»¯ thÆ°á»ng vÃ  khÃ´ng phÃ¢n biá»‡t chá»¯ hoa/chá»¯ thÆ°á»ng. Viá»‡c thÃªm trÆ°á»ng
nÃ y sáº½ gÃ¢y ra lá»—i biÃªn dá»‹ch vÃ¬ chÃºng ta chÆ°a khá»Ÿi táº¡o trÆ°á»ng nÃ y á»Ÿ Ä‘Ã¢u cáº£:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.contains(query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span>pub fn search_case_insensitive&lt;'a&gt;(
    query: &amp;str,
    contents: &amp;'a str,
) -&gt; Vec&lt;&amp;'a str&gt; {
    let query = query.to_lowercase();
    let mut results = Vec::new();

    for line in contents.lines() {
        if line.to_lowercase().contains(&amp;query) {
            results.push(line);
        }
    }

    results
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_sensitive() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Duct tape.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_insensitive() {
</span><span class="boring">        let query = "rUsT";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Trust me.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(
</span><span class="boring">            vec!["Rust:", "Trust me."],
</span><span class="boring">            search_case_insensitive(query, contents)
</span><span class="boring">        );
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>ChÃºng ta Ä‘Ã£ thÃªm trÆ°á»ng <code>ignore_case</code> mÃ  chá»©a má»™t Boolean. Tiáº¿p theo, chÃºng ta cáº§n hÃ m <code>run</code>
Ä‘á»ƒ kiá»ƒm tra giÃ¡ trá»‹ cá»§a trÆ°á»ng <code>ignore_case</code> vÃ  dÃ¹ng nÃ³ Ä‘á»ƒ quyáº¿t Ä‘á»‹nh
cÃ³ gá»i hÃ m <code>search</code> hay hÃ m <code>search_case_insensitive</code>
nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ trong Listing 12-22. Äiá»u nÃ y váº«n chÆ°a thá»ƒ compile.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.contains(query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub fn search_case_insensitive&lt;'a&gt;(
</span><span class="boring">    query: &amp;str,
</span><span class="boring">    contents: &amp;'a str,
</span><span class="boring">) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let query = query.to_lowercase();
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.to_lowercase().contains(&amp;query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_sensitive() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Duct tape.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_insensitive() {
</span><span class="boring">        let query = "rUsT";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Trust me.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(
</span><span class="boring">            vec!["Rust:", "Trust me."],
</span><span class="boring">            search_case_insensitive(query, contents)
</span><span class="boring">        );
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-22: Gá»i <code>search</code> hoáº·c
<code>search_case_insensitive</code> dá»±a trÃªn giÃ¡ trá»‹ trong <code>config.ignore_case</code></span></p>
<p>Cuá»‘i cÃ¹ng, chÃºng ta cáº§n kiá»ƒm tra biáº¿n mÃ´i trÆ°á»ng. CÃ¡c hÃ m lÃ m viá»‡c vá»›i
biáº¿n mÃ´i trÆ°á»ng náº±m trong module <code>env</code> cá»§a thÆ° viá»‡n chuáº©n, vÃ¬ váº­y chÃºng ta
mang module Ä‘Ã³ vÃ o pháº¡m vi á»Ÿ Ä‘áº§u <em>src/lib.rs</em>. Sau Ä‘Ã³, chÃºng ta sáº½ sá»­ dá»¥ng
hÃ m <code>var</code> tá»« module <code>env</code> Ä‘á»ƒ kiá»ƒm tra xem cÃ³ giÃ¡ trá»‹ nÃ o Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t cho
biáº¿n mÃ´i trÆ°á»ng cÃ³ tÃªn <code>IGNORE_CASE</code> hay khÃ´ng, nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ trong
Listing 12-23.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.contains(query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub fn search_case_insensitive&lt;'a&gt;(
</span><span class="boring">    query: &amp;str,
</span><span class="boring">    contents: &amp;'a str,
</span><span class="boring">) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let query = query.to_lowercase();
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.to_lowercase().contains(&amp;query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_sensitive() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Duct tape.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_insensitive() {
</span><span class="boring">        let query = "rUsT";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Trust me.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(
</span><span class="boring">            vec!["Rust:", "Trust me."],
</span><span class="boring">            search_case_insensitive(query, contents)
</span><span class="boring">        );
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-23: Kiá»ƒm tra giÃ¡ trá»‹ trong biáº¿n mÃ´i trÆ°á»ng
cÃ³ tÃªn <code>IGNORE_CASE</code></span></p>
<p>á» Ä‘Ã¢y, chÃºng ta táº¡o má»™t biáº¿n má»›i <code>ignore_case</code>. Äá»ƒ gÃ¡n giÃ¡ trá»‹ cho nÃ³, chÃºng
ta gá»i hÃ m <code>env::var</code> vÃ  truyá»n vÃ o tÃªn cá»§a biáº¿n mÃ´i trÆ°á»ng <code>IGNORE_CASE</code>.
HÃ m <code>env::var</code> tráº£ vá» má»™t <code>Result</code> sáº½ lÃ  biáº¿n thá»ƒ <code>Ok</code> chá»©a giÃ¡ trá»‹ cá»§a
biáº¿n mÃ´i trÆ°á»ng náº¿u biáº¿n mÃ´i trÆ°á»ng Ä‘Ã³ Ä‘Æ°á»£c Ä‘áº·t báº¥t ká»³ giÃ¡ trá»‹ nÃ o. NÃ³ sáº½
tráº£ vá» biáº¿n thá»ƒ <code>Err</code> náº¿u biáº¿n mÃ´i trÆ°á»ng khÃ´ng Ä‘Æ°á»£c Ä‘áº·t.</p>
<p>ChÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>is_ok</code> trÃªn <code>Result</code> Ä‘á»ƒ kiá»ƒm tra xem biáº¿n
mÃ´i trÆ°á»ng cÃ³ Ä‘Æ°á»£c Ä‘áº·t hay khÃ´ng, nghÄ©a lÃ  chÆ°Æ¡ng trÃ¬nh sáº½ thá»±c hiá»‡n tÃ¬m
kiáº¿m khÃ´ng phÃ¢n biá»‡t chá»¯ hoa chá»¯ thÆ°á»ng. Náº¿u biáº¿n mÃ´i trÆ°á»ng <code>IGNORE_CASE</code>
khÃ´ng Ä‘Æ°á»£c Ä‘áº·t giÃ¡ trá»‹ gÃ¬, <code>is_ok</code> sáº½ tráº£ vá» false vÃ  chÆ°Æ¡ng trÃ¬nh sáº½ thá»±c
hiá»‡n tÃ¬m kiáº¿m phÃ¢n biá»‡t chá»¯ hoa chá»¯ thÆ°á»ng. ChÃºng ta khÃ´ng quan tÃ¢m Ä‘áº¿n
<em>giÃ¡ trá»‹</em> cá»§a biáº¿n mÃ´i trÆ°á»ng, chá»‰ quan tÃ¢m xem nÃ³ Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t hay chÆ°a, nÃªn
chÃºng ta kiá»ƒm tra <code>is_ok</code> thay vÃ¬ sá»­ dá»¥ng <code>unwrap</code>, <code>expect</code> hay báº¥t ká»³
phÆ°Æ¡ng thá»©c nÃ o khÃ¡c mÃ  chÃºng ta Ä‘Ã£ tháº¥y trÃªn <code>Result</code>.</p>
<p>ChÃºng ta truyá»n giÃ¡ trá»‹ trong biáº¿n <code>ignore_case</code> vÃ o instance cá»§a <code>Config</code> Ä‘á»ƒ
hÃ m <code>run</code> cÃ³ thá»ƒ Ä‘á»c giÃ¡ trá»‹ Ä‘Ã³ vÃ  quyáº¿t Ä‘á»‹nh cÃ³ gá»i <code>search_case_insensitive</code>
hay <code>search</code>, nhÆ° chÃºng ta Ä‘Ã£ triá»ƒn khai trong Listing 12-22.</p>
<p>HÃ£y thá»­ xem! TrÆ°á»›c tiÃªn, chÃºng ta sáº½ cháº¡y chÆ°Æ¡ng trÃ¬nh mÃ  khÃ´ng Ä‘áº·t biáº¿n
mÃ´i trÆ°á»ng vÃ  vá»›i truy váº¥n <code>to</code>, Ä‘iá»u nÃ y sáº½ khá»›p vá»›i báº¥t ká»³ dÃ²ng nÃ o
chá»©a tá»« â€œtoâ€ viáº¿t thÆ°á»ng:</p>
<pre><code class="language-console">$ cargo run -- to poem.txt
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/minigrep to poem.txt`
Are you nobody, too?
How dreary to be somebody!
</code></pre>
<p>CÃ³ váº» nhÆ° chÆ°Æ¡ng trÃ¬nh váº«n hoáº¡t Ä‘á»™ng! BÃ¢y giá», hÃ£y cháº¡y chÆ°Æ¡ng trÃ¬nh vá»›i
<code>IGNORE_CASE</code> Ä‘Æ°á»£c Ä‘áº·t thÃ nh <code>1</code> nhÆ°ng vá»›i cÃ¹ng truy váº¥n <code>to</code>.</p>
<pre><code class="language-console">$ IGNORE_CASE=1 cargo run -- to poem.txt
</code></pre>
<p>Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng PowerShell, báº¡n sáº½ cáº§n Ä‘áº·t biáº¿n mÃ´i trÆ°á»ng vÃ 
cháº¡y chÆ°Æ¡ng trÃ¬nh nhÆ° hai lá»‡nh riÃªng biá»‡t:</p>
<pre><code class="language-console">PS&gt; $Env:IGNORE_CASE=1; cargo run -- to poem.txt
</code></pre>
<p>Äiá»u nÃ y sáº½ lÃ m cho <code>IGNORE_CASE</code> tá»“n táº¡i trong suá»‘t phiÃªn lÃ m viá»‡c shell
cá»§a báº¡n. NÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c há»§y báº±ng cmdlet <code>Remove-Item</code>:</p>
<pre><code class="language-console">PS&gt; Remove-Item Env:IGNORE_CASE
</code></pre>
<p>ChÃºng ta sáº½ nháº­n Ä‘Æ°á»£c cÃ¡c dÃ²ng chá»©a â€œtoâ€ mÃ  cÃ³ thá»ƒ cÃ³ chá»¯ hoa:</p>
<!-- manual-regeneration
cd listings/ch12-an-io-project/listing-12-23
IGNORE_CASE=1 cargo run -- to poem.txt
can't extract because of the environment variable
-->
<pre><code class="language-console">Are you nobody, too?
How dreary to be somebody!
To tell your name the livelong day
To an admiring bog!
</code></pre>
<p>Tuyá»‡t vá»i, chÃºng ta cÅ©ng nháº­n Ä‘Æ°á»£c cÃ¡c dÃ²ng chá»©a â€œToâ€! ChÆ°Æ¡ng trÃ¬nh <code>minigrep</code>
cá»§a chÃºng ta bÃ¢y giá» cÃ³ thá»ƒ thá»±c hiá»‡n tÃ¬m kiáº¿m khÃ´ng phÃ¢n biá»‡t chá»¯ hoa chá»¯
thÆ°á»ng Ä‘Æ°á»£c Ä‘iá»u khiá»ƒn bá»Ÿi má»™t biáº¿n mÃ´i trÆ°á»ng. BÃ¢y giá» báº¡n Ä‘Ã£ biáº¿t cÃ¡ch
quáº£n lÃ½ cÃ¡c tÃ¹y chá»n Ä‘Æ°á»£c Ä‘áº·t thÃ´ng qua Ä‘á»‘i sá»‘ dÃ²ng lá»‡nh hoáº·c biáº¿n mÃ´i
trÆ°á»ng.</p>
<p>Má»™t sá»‘ chÆ°Æ¡ng trÃ¬nh cho phÃ©p sá»­ dá»¥ng cáº£ Ä‘á»‘i sá»‘ <em>vÃ </em> biáº¿n mÃ´i trÆ°á»ng cho
cÃ¹ng má»™t cáº¥u hÃ¬nh. Trong nhá»¯ng trÆ°á»ng há»£p Ä‘Ã³, chÆ°Æ¡ng trÃ¬nh sáº½ quyáº¿t Ä‘á»‹nh
biáº¿n nÃ o Ä‘Æ°á»£c Æ°u tiÃªn. Äá»ƒ luyá»‡n táº­p thÃªm, báº¡n cÃ³ thá»ƒ thá»­ Ä‘iá»u khiá»ƒn
viá»‡c phÃ¢n biá»‡t chá»¯ hoa chá»¯ thÆ°á»ng thÃ´ng qua Ä‘á»‘i sá»‘ dÃ²ng lá»‡nh hoáº·c biáº¿n
mÃ´i trÆ°á»ng. Quyáº¿t Ä‘á»‹nh xem Ä‘á»‘i sá»‘ dÃ²ng lá»‡nh hay biáº¿n mÃ´i trÆ°á»ng sáº½ Ä‘Æ°á»£c
Æ°u tiÃªn náº¿u chÆ°Æ¡ng trÃ¬nh Ä‘Æ°á»£c cháº¡y vá»›i má»™t cÃ¡i Ä‘áº·t phÃ¢n biá»‡t chá»¯ hoa
chá»¯ thÆ°á»ng vÃ  cÃ¡i cÃ²n láº¡i Ä‘áº·t khÃ´ng phÃ¢n biá»‡t.</p>
<p>Module <code>std::env</code> cÃ²n chá»©a nhiá»u tÃ­nh nÄƒng há»¯u Ã­ch khÃ¡c Ä‘á»ƒ lÃ m viá»‡c vá»›i
cÃ¡c biáº¿n mÃ´i trÆ°á»ng: hÃ£y tham kháº£o tÃ i liá»‡u cá»§a nÃ³ Ä‘á»ƒ xem nhá»¯ng gÃ¬
cÃ³ sáºµn.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="ghi-thÃ´ng-bÃ¡o-lá»—i-ra-standard-error-thay-vÃ¬-standard-output"><a class="header" href="#ghi-thÃ´ng-bÃ¡o-lá»—i-ra-standard-error-thay-vÃ¬-standard-output">Ghi ThÃ´ng BÃ¡o Lá»—i Ra Standard Error Thay VÃ¬ Standard Output</a></h2>
<p>Hiá»‡n táº¡i, chÃºng ta Ä‘ang ghi toÃ n bá»™ Ä‘áº§u ra ra terminal báº±ng macro <code>println!</code>.
Trong háº§u háº¿t cÃ¡c terminal, cÃ³ hai loáº¡i Ä‘áº§u ra: <em>standard output</em> (<code>stdout</code>)
cho thÃ´ng tin chung vÃ  <em>standard error</em> (<code>stderr</code>) cho cÃ¡c thÃ´ng bÃ¡o lá»—i.
Sá»± phÃ¢n biá»‡t nÃ y cho phÃ©p ngÆ°á»i dÃ¹ng chuyá»ƒn hÆ°á»›ng Ä‘áº§u ra thÃ nh cÃ´ng cá»§a
chÆ°Æ¡ng trÃ¬nh vÃ o má»™t file nhÆ°ng váº«n hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i trÃªn mÃ n hÃ¬nh.</p>
<p>Macro <code>println!</code> chá»‰ cÃ³ kháº£ nÄƒng in ra standard output, vÃ¬ váº­y chÃºng ta
pháº£i dÃ¹ng thá»© khÃ¡c Ä‘á»ƒ in ra standard error.</p>
<h3 id="kiá»ƒm-tra-nÆ¡i-cÃ¡c-lá»—i-ÄÆ°á»£c-ghi"><a class="header" href="#kiá»ƒm-tra-nÆ¡i-cÃ¡c-lá»—i-ÄÆ°á»£c-ghi">Kiá»ƒm Tra NÆ¡i CÃ¡c Lá»—i ÄÆ°á»£c Ghi</a></h3>
<p>TrÆ°á»›c tiÃªn, hÃ£y quan sÃ¡t cÃ¡ch ná»™i dung Ä‘Æ°á»£c in bá»Ÿi <code>minigrep</code> hiá»‡n Ä‘ang
Ä‘Æ°á»£c ghi ra standard output, bao gá»“m cáº£ cÃ¡c thÃ´ng bÃ¡o lá»—i mÃ  chÃºng ta muá»‘n
ghi ra standard error. ChÃºng ta sáº½ lÃ m Ä‘iá»u Ä‘Ã³ báº±ng cÃ¡ch chuyá»ƒn hÆ°á»›ng luá»“ng
standard output vÃ o má»™t file trong khi cá»‘ Ã½ gÃ¢y ra lá»—i. ChÃºng ta sáº½ khÃ´ng
chuyá»ƒn hÆ°á»›ng luá»“ng standard error, vÃ¬ váº­y báº¥t ká»³ ná»™i dung nÃ o gá»­i Ä‘áº¿n
standard error sáº½ tiáº¿p tá»¥c hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh.</p>
<p>CÃ¡c chÆ°Æ¡ng trÃ¬nh dÃ²ng lá»‡nh Ä‘Æ°á»£c ká»³ vá»ng gá»­i thÃ´ng bÃ¡o lá»—i Ä‘áº¿n luá»“ng
standard error Ä‘á»ƒ chÃºng ta váº«n cÃ³ thá»ƒ tháº¥y thÃ´ng bÃ¡o lá»—i trÃªn mÃ n hÃ¬nh
ngay cáº£ khi chÃºng ta chuyá»ƒn hÆ°á»›ng luá»“ng standard output vÃ o má»™t file. ChÆ°Æ¡ng
trÃ¬nh cá»§a chÃºng ta hiá»‡n táº¡i chÆ°a hoáº¡t Ä‘á»™ng Ä‘Ãºng: chÃºng ta sáº¯p tháº¥y ráº±ng nÃ³
lÆ°u thÃ´ng bÃ¡o lá»—i vÃ o file thay vÃ¬!</p>
<p>Äá»ƒ minh há»a hÃ nh vi nÃ y, chÃºng ta sáº½ cháº¡y chÆ°Æ¡ng trÃ¬nh vá»›i <code>&gt;</code> vÃ  Ä‘Æ°á»ng dáº«n
file, <em>output.txt</em>, mÃ  chÃºng ta muá»‘n chuyá»ƒn hÆ°á»›ng luá»“ng standard output vÃ o.
ChÃºng ta sáº½ khÃ´ng truyá»n báº¥t ká»³ Ä‘á»‘i sá»‘ nÃ o, Ä‘iá»u nÃ y sáº½ gÃ¢y ra lá»—i:</p>
<pre><code class="language-console">$ cargo run &gt; output.txt
</code></pre>
<p>CÃº phÃ¡p <code>&gt;</code> thÃ´ng bÃ¡o cho shell ghi ná»™i dung cá»§a standard output vÃ o
<em>output.txt</em> thay vÃ¬ hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh. ChÃºng ta khÃ´ng tháº¥y thÃ´ng bÃ¡o
lá»—i mÃ  chÃºng ta mong Ä‘á»£i Ä‘Æ°á»£c in ra mÃ n hÃ¬nh, Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  nÃ³ cháº¯c
cháº¯n Ä‘Ã£ káº¿t thÃºc trong file. ÄÃ¢y lÃ  ná»™i dung cá»§a <em>output.txt</em>:</p>
<pre><code class="language-text">Problem parsing arguments: not enough arguments
</code></pre>
<p>ÄÃºng rá»“i, thÃ´ng bÃ¡o lá»—i cá»§a chÃºng ta Ä‘ang Ä‘Æ°á»£c in ra standard output. Sáº½ há»¯u
Ã­ch hÆ¡n nhiá»u náº¿u cÃ¡c thÃ´ng bÃ¡o lá»—i nhÆ° tháº¿ nÃ y Ä‘Æ°á»£c in ra standard error Ä‘á»ƒ
chá»‰ cÃ³ dá»¯ liá»‡u tá»« láº§n cháº¡y thÃ nh cÃ´ng má»›i káº¿t thÃºc trong file. ChÃºng ta sáº½
thay Ä‘á»•i Ä‘iá»u Ä‘Ã³.</p>
<h3 id="in-lá»—i-ra-standard-error"><a class="header" href="#in-lá»—i-ra-standard-error">In Lá»—i Ra Standard Error</a></h3>
<p>ChÃºng ta sáº½ dÃ¹ng code trong Listing 12-24 Ä‘á»ƒ thay Ä‘á»•i cÃ¡ch cÃ¡c thÃ´ng bÃ¡o
lá»—i Ä‘Æ°á»£c in. Nhá» viá»‡c refactor mÃ  chÃºng ta Ä‘Ã£ lÃ m trÆ°á»›c Ä‘Ã³ trong chÆ°Æ¡ng
nÃ y, táº¥t cáº£ code in thÃ´ng bÃ¡o lá»—i Ä‘á»u náº±m trong má»™t hÃ m, <code>main</code>. ThÆ° viá»‡n
chuáº©n cung cáº¥p macro <code>eprintln!</code> Ä‘á»ƒ in ra luá»“ng standard error, vÃ¬ váº­y hÃ£y
thay Ä‘á»•i hai chá»— mÃ  chÃºng ta Ä‘ang gá»i <code>println!</code> Ä‘á»ƒ in lá»—i sang dÃ¹ng
<code>eprintln!</code> thay vÃ o.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::error::Error;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span><span class="boring">
</span><span class="boring">use minigrep::{search, search_case_insensitive};
</span><span class="boring">
</span>fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let config = Config::build(&amp;args).unwrap_or_else(|err| {
        eprintln!("Problem parsing arguments: {err}");
        process::exit(1);
    });

    if let Err(e) = run(config) {
        eprintln!("Application error: {e}");
        process::exit(1);
    }
}
<span class="boring">
</span><span class="boring">pub struct Config {
</span><span class="boring">    pub query: String,
</span><span class="boring">    pub file_path: String,
</span><span class="boring">    pub ignore_case: bool,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        let ignore_case = env::var("IGNORE_CASE").is_ok();
</span><span class="boring">
</span><span class="boring">        Ok(Config {
</span><span class="boring">            query,
</span><span class="boring">            file_path,
</span><span class="boring">            ignore_case,
</span><span class="boring">        })
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)?;
</span><span class="boring">
</span><span class="boring">    let results = if config.ignore_case {
</span><span class="boring">        search_case_insensitive(&amp;config.query, &amp;contents)
</span><span class="boring">    } else {
</span><span class="boring">        search(&amp;config.query, &amp;contents)
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    for line in results {
</span><span class="boring">        println!("{line}");
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    Ok(())
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 12-24: Ghi thÃ´ng bÃ¡o lá»—i ra standard error
thay vÃ¬ standard output báº±ng cÃ¡ch sá»­ dá»¥ng <code>eprintln!</code></span></p>
<p>BÃ¢y giá», hÃ£y cháº¡y láº¡i chÆ°Æ¡ng trÃ¬nh theo cÃ¹ng cÃ¡ch, khÃ´ng truyá»n Ä‘á»‘i sá»‘
nÃ o vÃ  chuyá»ƒn hÆ°á»›ng standard output báº±ng <code>&gt;</code>:</p>
<pre><code class="language-console">$ cargo run &gt; output.txt
Problem parsing arguments: not enough arguments
</code></pre>
<p>BÃ¢y giá» chÃºng ta tháº¥y thÃ´ng bÃ¡o lá»—i trÃªn mÃ n hÃ¬nh vÃ  <em>output.txt</em> khÃ´ng chá»©a
gÃ¬, Ä‘Ã¢y lÃ  hÃ nh vi mÃ  chÃºng ta mong Ä‘á»£i cá»§a cÃ¡c chÆ°Æ¡ng trÃ¬nh dÃ²ng lá»‡nh.</p>
<p>HÃ£y cháº¡y láº¡i chÆ°Æ¡ng trÃ¬nh vá»›i cÃ¡c Ä‘á»‘i sá»‘ khÃ´ng gÃ¢y ra lá»—i nhÆ°ng váº«n
chuyá»ƒn hÆ°á»›ng standard output vÃ o má»™t file, nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run -- to poem.txt &gt; output.txt
</code></pre>
<p>ChÃºng ta sáº½ khÃ´ng tháº¥y báº¥t ká»³ Ä‘áº§u ra nÃ o trÃªn terminal, vÃ  <em>output.txt</em>
sáº½ chá»©a káº¿t quáº£ cá»§a chÃºng ta:</p>
<p><span class="filename">Filename: output.txt</span></p>
<pre><code class="language-text">Are you nobody, too?
How dreary to be somebody!
</code></pre>
<p>Äiá»u nÃ y minh há»a ráº±ng bÃ¢y giá» chÃºng ta Ä‘ang sá»­ dá»¥ng standard output cho
Ä‘áº§u ra thÃ nh cÃ´ng vÃ  standard error cho Ä‘áº§u ra lá»—i má»™t cÃ¡ch thÃ­ch há»£p.</p>
<h2 id="tÃ³m-táº¯t-2"><a class="header" href="#tÃ³m-táº¯t-2">TÃ³m Táº¯t</a></h2>
<p>ChÆ°Æ¡ng nÃ y Ä‘Ã£ Ã´n láº¡i má»™t sá»‘ khÃ¡i niá»‡m chÃ­nh mÃ  báº¡n Ä‘Ã£ há»c cho Ä‘áº¿n nay vÃ 
giá»›i thiá»‡u cÃ¡ch thá»±c hiá»‡n cÃ¡c thao tÃ¡c I/O phá»• biáº¿n trong Rust. Báº±ng cÃ¡ch
sá»­ dá»¥ng Ä‘á»‘i sá»‘ dÃ²ng lá»‡nh, file, biáº¿n mÃ´i trÆ°á»ng, vÃ  macro <code>eprintln!</code> Ä‘á»ƒ
in lá»—i, báº¡n bÃ¢y giá» Ä‘Ã£ sáºµn sÃ ng viáº¿t cÃ¡c á»©ng dá»¥ng dÃ²ng lá»‡nh. Káº¿t há»£p vá»›i
cÃ¡c khÃ¡i niá»‡m trong cÃ¡c chÆ°Æ¡ng trÆ°á»›c, code cá»§a báº¡n sáº½ Ä‘Æ°á»£c tá»• chá»©c tá»‘t,
lÆ°u trá»¯ dá»¯ liá»‡u hiá»‡u quáº£ trong cÃ¡c cáº¥u trÃºc dá»¯ liá»‡u phÃ¹ há»£p, xá»­ lÃ½ lá»—i
mÆ°á»£t mÃ  vÃ  Ä‘Æ°á»£c kiá»ƒm thá»­ ká»¹ lÆ°á»¡ng.</p>
<p>Tiáº¿p theo, chÃºng ta sáº½ khÃ¡m phÃ¡ má»™t sá»‘ tÃ­nh nÄƒng cá»§a Rust chá»‹u áº£nh hÆ°á»Ÿng
tá»« cÃ¡c ngÃ´n ngá»¯ hÃ m: closures vÃ  iterators.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cÃ¡c-tÃ­nh-nÄƒng-ngÃ´n-ngá»¯-hÃ m-iterators-vÃ -closures"><a class="header" href="#cÃ¡c-tÃ­nh-nÄƒng-ngÃ´n-ngá»¯-hÃ m-iterators-vÃ -closures">CÃ¡c TÃ­nh NÄƒng NgÃ´n Ngá»¯ HÃ m: Iterators vÃ  Closures</a></h1>
<p>Thiáº¿t káº¿ cá»§a Rust Ä‘Ã£ láº¥y cáº£m há»©ng tá»« nhiá»u ngÃ´n ngá»¯ vÃ  ká»¹ thuáº­t hiá»‡n
cÃ³, vÃ  má»™t áº£nh hÆ°á»Ÿng Ä‘Ã¡ng ká»ƒ lÃ  <em>láº­p trÃ¬nh hÃ m</em> (functional programming).
Láº­p trÃ¬nh theo phong cÃ¡ch hÃ m thÆ°á»ng bao gá»“m viá»‡c sá»­ dá»¥ng cÃ¡c hÃ m nhÆ°
giÃ¡ trá»‹ báº±ng cÃ¡ch truyá»n chÃºng vÃ o cÃ¡c Ä‘á»‘i sá»‘, tráº£ vá» chÃºng tá»« cÃ¡c hÃ m
khÃ¡c, gÃ¡n chÃºng cho biáº¿n Ä‘á»ƒ thá»±c thi sau nÃ y, vÃ  nhiá»u thao tÃ¡c khÃ¡c.</p>
<p>Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ khÃ´ng tranh luáº­n vá» váº¥n Ä‘á» láº­p trÃ¬nh hÃ m
lÃ  gÃ¬ hay khÃ´ng pháº£i lÃ  gÃ¬ mÃ  sáº½ thay vÃ o Ä‘Ã³ tháº£o luáº­n má»™t sá»‘ tÃ­nh nÄƒng
cá»§a Rust tÆ°Æ¡ng tá»± nhÆ° cÃ¡c tÃ­nh nÄƒng trong nhiá»u ngÃ´n ngá»¯ thÆ°á»ng Ä‘Æ°á»£c
gá»i lÃ  hÃ m.</p>
<p>Cá»¥ thá»ƒ hÆ¡n, chÃºng ta sáº½ tÃ¬m hiá»ƒu:</p>
<ul>
<li><em>Closures</em>, má»™t cáº¥u trÃºc giá»‘ng hÃ m mÃ  báº¡n cÃ³ thá»ƒ lÆ°u vÃ o biáº¿n</li>
<li><em>Iterators</em>, má»™t cÃ¡ch xá»­ lÃ½ má»™t chuá»—i cÃ¡c pháº§n tá»­</li>
<li>CÃ¡ch sá»­ dá»¥ng closures vÃ  iterators Ä‘á»ƒ cáº£i thiá»‡n dá»± Ã¡n I/O trong ChÆ°Æ¡ng 12</li>
<li>Hiá»‡u suáº¥t cá»§a closures vÃ  iterators (Cáº£nh bÃ¡o: chÃºng nhanh hÆ¡n báº¡n
tÆ°á»Ÿng!)</li>
</ul>
<p>ChÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu má»™t sá»‘ tÃ­nh nÄƒng khÃ¡c cá»§a Rust, cháº³ng háº¡n nhÆ° pattern
matching vÃ  enums, cÅ©ng chá»‹u áº£nh hÆ°á»Ÿng tá»« phong cÃ¡ch hÃ m. VÃ¬ viá»‡c náº¯m vá»¯ng
closures vÃ  iterators lÃ  má»™t pháº§n quan trá»ng Ä‘á»ƒ viáº¿t code Rust theo phong
cÃ¡ch idiomatic vÃ  nhanh, chÃºng ta sáº½ dÃ nh toÃ n bá»™ chÆ°Æ¡ng nÃ y cho chÃºng.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- Old heading. Do not remove or links may break. -->
<p><a id="closures-anonymous-functions-that-can-capture-their-environment"></a></p>
<h2 id="closures-hÃ m-áº¨n-danh-cÃ³-kháº£-nÄƒng-báº¯t-giÃ¡-trá»‹-mÃ´i-trÆ°á»ng"><a class="header" href="#closures-hÃ m-áº¨n-danh-cÃ³-kháº£-nÄƒng-báº¯t-giÃ¡-trá»‹-mÃ´i-trÆ°á»ng">Closures: HÃ m áº¨n Danh CÃ³ Kháº£ NÄƒng Báº¯t GiÃ¡ Trá»‹ MÃ´i TrÆ°á»ng</a></h2>
<p>Closures trong Rust lÃ  cÃ¡c hÃ m áº©n danh mÃ  báº¡n cÃ³ thá»ƒ lÆ°u vÃ o biáº¿n hoáº·c
truyá»n lÃ m Ä‘á»‘i sá»‘ cho cÃ¡c hÃ m khÃ¡c. Báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a closure á»Ÿ má»™t
nÆ¡i vÃ  sau Ä‘Ã³ gá»i nÃ³ á»Ÿ nÆ¡i khÃ¡c Ä‘á»ƒ thá»±c thi trong má»™t ngá»¯ cáº£nh khÃ¡c.
KhÃ¡c vá»›i cÃ¡c hÃ m thÃ´ng thÆ°á»ng, closures cÃ³ thá»ƒ â€œbáº¯tâ€ cÃ¡c giÃ¡ trá»‹ tá»« pháº¡m
vi nÆ¡i chÃºng Ä‘Æ°á»£c táº¡o. ChÃºng ta sáº½ minh há»a cÃ¡ch cÃ¡c tÃ­nh nÄƒng nÃ y cá»§a
closures giÃºp tÃ¡i sá»­ dá»¥ng code vÃ  tÃ¹y chá»‰nh hÃ nh vi chÆ°Æ¡ng trÃ¬nh.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="creating-an-abstraction-of-behavior-with-closures"></a>
<a id="refactoring-using-functions"></a>
<a id="refactoring-with-closures-to-store-code"></a></p>
<h3 id="báº¯t-giÃ¡-trá»‹-mÃ´i-trÆ°á»ng-vá»›i-closures"><a class="header" href="#báº¯t-giÃ¡-trá»‹-mÃ´i-trÆ°á»ng-vá»›i-closures">Báº¯t GiÃ¡ Trá»‹ MÃ´i TrÆ°á»ng vá»›i Closures</a></h3>
<p>TrÆ°á»›c tiÃªn, chÃºng ta sáº½ xem cÃ¡ch closures cÃ³ thá»ƒ â€œbáº¯tâ€ cÃ¡c giÃ¡ trá»‹ tá»« mÃ´i
trÆ°á»ng nÆ¡i chÃºng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a Ä‘á»ƒ dÃ¹ng sau nÃ y. VÃ­ dá»¥ sau Ä‘Ã¢y: Thá»‰nh
thoáº£ng, cÃ´ng ty Ã¡o thun cá»§a chÃºng ta sáº½ táº·ng má»™t chiáº¿c Ã¡o phiÃªn báº£n giá»›i
háº¡n cho má»™t ngÆ°á»i trong danh sÃ¡ch email nhÆ° má»™t chÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i.
NgÆ°á»i trong danh sÃ¡ch email cÃ³ thá»ƒ tÃ¹y chá»n thÃªm mÃ u Ã¡o yÃªu thÃ­ch vÃ o há»“
sÆ¡ cá»§a há». Náº¿u ngÆ°á»i Ä‘Æ°á»£c chá»n Ä‘Ã£ cÃ³ mÃ u yÃªu thÃ­ch, há» sáº½ nháº­n Ã¡o mÃ u
Ä‘Ã³. Náº¿u chÆ°a, há» sáº½ nháº­n mÃ u Ã¡o mÃ  cÃ´ng ty Ä‘ang cÃ²n nhiá»u nháº¥t trong kho.</p>
<p>CÃ³ nhiá»u cÃ¡ch Ä‘á»ƒ triá»ƒn khai Ä‘iá»u nÃ y. Trong vÃ­ dá»¥ nÃ y, chÃºng ta sáº½ dÃ¹ng
enum <code>ShirtColor</code> vá»›i hai biáº¿n thá»ƒ <code>Red</code> vÃ  <code>Blue</code> (giá»›i háº¡n sá»‘ mÃ u cho
Ä‘Æ¡n giáº£n). Kho hÃ ng Ä‘Æ°á»£c biá»ƒu diá»…n báº±ng struct <code>Inventory</code>, cÃ³ trÆ°á»ng
<code>shirts</code> chá»©a <code>Vec&lt;ShirtColor&gt;</code> Ä‘áº¡i diá»‡n cho cÃ¡c mÃ u Ã¡o hiá»‡n cÃ³ trong kho.
PhÆ°Æ¡ng thá»©c <code>giveaway</code> cá»§a <code>Inventory</code> nháº­n tÃ¹y chá»n mÃ u Ã¡o cá»§a ngÆ°á»i
tháº¯ng cuá»™c vÃ  tráº£ vá» mÃ u Ã¡o mÃ  há» sáº½ nháº­n. Cáº¥u trÃºc nÃ y Ä‘Æ°á»£c minh há»a
trong Listing 13-1:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust noplayground">#[derive(Debug, PartialEq, Copy, Clone)]
enum ShirtColor {
    Red,
    Blue,
}

struct Inventory {
    shirts: Vec&lt;ShirtColor&gt;,
}

impl Inventory {
    fn giveaway(&amp;self, user_preference: Option&lt;ShirtColor&gt;) -&gt; ShirtColor {
        user_preference.unwrap_or_else(|| self.most_stocked())
    }

    fn most_stocked(&amp;self) -&gt; ShirtColor {
        let mut num_red = 0;
        let mut num_blue = 0;

        for color in &amp;self.shirts {
            match color {
                ShirtColor::Red =&gt; num_red += 1,
                ShirtColor::Blue =&gt; num_blue += 1,
            }
        }
        if num_red &gt; num_blue {
            ShirtColor::Red
        } else {
            ShirtColor::Blue
        }
    }
}

fn main() {
    let store = Inventory {
        shirts: vec![ShirtColor::Blue, ShirtColor::Red, ShirtColor::Blue],
    };

    let user_pref1 = Some(ShirtColor::Red);
    let giveaway1 = store.giveaway(user_pref1);
    println!(
        "The user with preference {:?} gets {:?}",
        user_pref1, giveaway1
    );

    let user_pref2 = None;
    let giveaway2 = store.giveaway(user_pref2);
    println!(
        "The user with preference {:?} gets {:?}",
        user_pref2, giveaway2
    );
}</code></pre>
<p><span class="caption">Listing 13-1: TÃ¬nh huá»‘ng táº·ng Ã¡o cá»§a cÃ´ng ty</span></p>
<p><code>store</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong <code>main</code> cÃ²n hai Ã¡o mÃ u xanh vÃ  má»™t Ã¡o mÃ u Ä‘á»
Ä‘á»ƒ phÃ¢n phÃ¡t trong chÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i phiÃªn báº£n giá»›i háº¡n nÃ y. ChÃºng
ta gá»i phÆ°Æ¡ng thá»©c <code>giveaway</code> cho má»™t ngÆ°á»i dÃ¹ng cÃ³ sá»Ÿ thÃ­ch Ã¡o mÃ u Ä‘á»
vÃ  má»™t ngÆ°á»i khÃ´ng cÃ³ sá»Ÿ thÃ­ch nÃ o.</p>
<p>Láº¡i má»™t láº§n ná»¯a, Ä‘oáº¡n code nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c triá»ƒn khai theo nhiá»u cÃ¡ch,
vÃ  á»Ÿ Ä‘Ã¢y, Ä‘á»ƒ táº­p trung vÃ o closures, chÃºng ta chá»‰ sá»­ dá»¥ng nhá»¯ng khÃ¡i niá»‡m
báº¡n Ä‘Ã£ há»c, ngoáº¡i trá»« pháº§n thÃ¢n cá»§a phÆ°Æ¡ng thá»©c <code>giveaway</code> sá»­ dá»¥ng closure.
Trong phÆ°Æ¡ng thá»©c <code>giveaway</code>, chÃºng ta nháº­n sá»Ÿ thÃ­ch cá»§a ngÆ°á»i dÃ¹ng dÆ°á»›i
dáº¡ng tham sá»‘ kiá»ƒu <code>Option&lt;ShirtColor&gt;</code> vÃ  gá»i phÆ°Æ¡ng thá»©c <code>unwrap_or_else</code>
trÃªn <code>user_preference</code>. PhÆ°Æ¡ng thá»©c <a href="../std/option/enum.Option.html#method.unwrap_or_else"><code>unwrap_or_else</code> trÃªn <code>Option&lt;T&gt;</code></a><!-- ignore -->
Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a bá»Ÿi thÆ° viá»‡n chuáº©n. NÃ³ nháº­n má»™t Ä‘á»‘i sá»‘: má»™t closure khÃ´ng
cÃ³ tham sá»‘ vÃ  tráº£ vá» giÃ¡ trá»‹ kiá»ƒu <code>T</code> (cÃ¹ng kiá»ƒu Ä‘Æ°á»£c lÆ°u trong biáº¿n thá»ƒ
<code>Some</code> cá»§a <code>Option&lt;T&gt;</code>, trong trÆ°á»ng há»£p nÃ y lÃ  <code>ShirtColor</code>). Náº¿u <code>Option&lt;T&gt;</code>
lÃ  biáº¿n thá»ƒ <code>Some</code>, <code>unwrap_or_else</code> tráº£ vá» giÃ¡ trá»‹ bÃªn trong <code>Some</code>. Náº¿u
<code>Option&lt;T&gt;</code> lÃ  biáº¿n thá»ƒ <code>None</code>, <code>unwrap_or_else</code> sáº½ gá»i closure vÃ  tráº£ vá»
giÃ¡ trá»‹ mÃ  closure tráº£ vá».</p>
<p>ChÃºng ta chá»‰ Ä‘á»‹nh biá»ƒu thá»©c closure <code>|| self.most_stocked()</code> lÃ m Ä‘á»‘i sá»‘
cho <code>unwrap_or_else</code>. ÄÃ¢y lÃ  má»™t closure khÃ´ng nháº­n tham sá»‘ nÃ o (náº¿u closure
cÃ³ tham sá»‘, chÃºng sáº½ xuáº¥t hiá»‡n giá»¯a hai dáº¥u gáº¡ch Ä‘á»©ng). ThÃ¢n cá»§a closure
gá»i <code>self.most_stocked()</code>. ChÃºng ta Ä‘á»‹nh nghÄ©a closure á»Ÿ Ä‘Ã¢y, vÃ 
cÃ i Ä‘áº·t cá»§a <code>unwrap_or_else</code> sáº½ thá»±c thi closure sau náº¿u káº¿t quáº£ Ä‘Æ°á»£c
cáº§n thiáº¿t.</p>
<p>Cháº¡y Ä‘oáº¡n code nÃ y sáº½ in ra:</p>
<pre><code class="language-console">$ cargo run
   Compiling shirt-company v0.1.0 (file:///projects/shirt-company)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.27s
     Running `target/debug/shirt-company`
The user with preference Some(Red) gets Red
The user with preference None gets Blue
</code></pre>
<p>Má»™t Ä‘iá»ƒm thÃº vá»‹ á»Ÿ Ä‘Ã¢y lÃ  chÃºng ta Ä‘Ã£ truyá»n má»™t closure gá»i <code>self.most_stocked()</code>
trÃªn instance <code>Inventory</code> hiá»‡n táº¡i. ThÆ° viá»‡n chuáº©n khÃ´ng cáº§n biáº¿t gÃ¬ vá» cÃ¡c
kiá»ƒu <code>Inventory</code> hay <code>ShirtColor</code> mÃ  chÃºng ta Ä‘á»‹nh nghÄ©a, cÅ©ng nhÆ° logic mÃ 
chÃºng ta muá»‘n sá»­ dá»¥ng trong tÃ¬nh huá»‘ng nÃ y. Closure sáº½ báº¯t má»™t tham chiáº¿u
báº¥t biáº¿n Ä‘áº¿n instance <code>self</code> cá»§a <code>Inventory</code> vÃ  truyá»n nÃ³ cÃ¹ng vá»›i Ä‘oáº¡n code
chÃºng ta chá»‰ Ä‘á»‹nh Ä‘áº¿n phÆ°Æ¡ng thá»©c <code>unwrap_or_else</code>. NgÆ°á»£c láº¡i, cÃ¡c hÃ m
thÆ°á»ng khÃ´ng thá»ƒ báº¯t mÃ´i trÆ°á»ng cá»§a chÃºng theo cÃ¡ch nÃ y.</p>
<h3 id="suy-luáº­n-kiá»ƒu-vÃ -ghi-chÃº-kiá»ƒu-cho-closures"><a class="header" href="#suy-luáº­n-kiá»ƒu-vÃ -ghi-chÃº-kiá»ƒu-cho-closures">Suy Luáº­n Kiá»ƒu vÃ  Ghi ChÃº Kiá»ƒu cho Closures</a></h3>
<p>CÃ²n cÃ³ nhiá»u khÃ¡c biá»‡t giá»¯a hÃ m vÃ  closures. Closures thÆ°á»ng khÃ´ng yÃªu cáº§u
báº¡n pháº£i ghi chÃº kiá»ƒu cho cÃ¡c tham sá»‘ hoáº·c giÃ¡ trá»‹ tráº£ vá» nhÆ° cÃ¡c hÃ m <code>fn</code>.
Ghi chÃº kiá»ƒu lÃ  cáº§n thiáº¿t cho hÃ m vÃ¬ cÃ¡c kiá»ƒu lÃ  má»™t pháº§n cá»§a giao diá»‡n
rÃµ rÃ ng Ä‘Æ°á»£c cung cáº¥p cho ngÆ°á»i dÃ¹ng. Äá»‹nh nghÄ©a giao diá»‡n nÃ y má»™t cÃ¡ch
cá»©ng nháº¯c giÃºp Ä‘áº£m báº£o má»i ngÆ°á»i Ä‘á»u hiá»ƒu cÃ¡c kiá»ƒu giÃ¡ trá»‹ mÃ  hÃ m sá»­ dá»¥ng
vÃ  tráº£ vá». Closures, ngÆ°á»£c láº¡i, khÃ´ng Ä‘Æ°á»£c dÃ¹ng trong má»™t giao diá»‡n lá»™ ra
nhÆ° váº­y: chÃºng Ä‘Æ°á»£c lÆ°u trong biáº¿n vÃ  sá»­ dá»¥ng mÃ  khÃ´ng cáº§n Ä‘áº·t tÃªn hay
tiáº¿p cáº­n bá»Ÿi ngÆ°á»i dÃ¹ng thÆ° viá»‡n.</p>
<p>Closures thÆ°á»ng ngáº¯n gá»n vÃ  chá»‰ liÃªn quan trong má»™t ngá»¯ cáº£nh háº¹p, thay vÃ¬
trong báº¥t ká»³ tÃ¬nh huá»‘ng tÃ¹y Ã½ nÃ o. Trong nhá»¯ng ngá»¯ cáº£nh háº¡n cháº¿ nÃ y,
compiler cÃ³ thá»ƒ suy luáº­n kiá»ƒu cá»§a cÃ¡c tham sá»‘ vÃ  kiá»ƒu tráº£ vá», tÆ°Æ¡ng tá»±
nhÆ° cÃ¡ch nÃ³ suy luáº­n kiá»ƒu háº§u háº¿t cÃ¡c biáº¿n (cÃ³ nhá»¯ng trÆ°á»ng há»£p hiáº¿m
ráº±ng compiler cÅ©ng cáº§n ghi chÃº kiá»ƒu cho closure).</p>
<p>Giá»‘ng nhÆ° vá»›i biáº¿n, chÃºng ta cÃ³ thá»ƒ thÃªm ghi chÃº kiá»ƒu náº¿u muá»‘n tÄƒng tÃ­nh
rÃµ rÃ ng vÃ  minh báº¡ch, máº·c dÃ¹ sáº½ lÃ m code dÃ i hÆ¡n má»©c cáº§n thiáº¿t. Viá»‡c ghi
chÃº kiá»ƒu cho má»™t closure sáº½ trÃ´ng nhÆ° Ä‘á»‹nh nghÄ©a trong Listing 13-2. Trong
vÃ­ dá»¥ nÃ y, chÃºng ta Ä‘á»‹nh nghÄ©a má»™t closure vÃ  lÆ°u nÃ³ vÃ o biáº¿n thay vÃ¬ Ä‘á»‹nh
nghÄ©a closure ngay táº¡i chá»— truyá»n lÃ m Ä‘á»‘i sá»‘ nhÆ° trong Listing 13-1.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">use std::thread;
</span><span class="boring">use std::time::Duration;
</span><span class="boring">
</span><span class="boring">fn generate_workout(intensity: u32, random_number: u32) {
</span>    let expensive_closure = |num: u32| -&gt; u32 {
        println!("calculating slowly...");
        thread::sleep(Duration::from_secs(2));
        num
    };
<span class="boring">
</span><span class="boring">    if intensity &lt; 25 {
</span><span class="boring">        println!("Today, do {} pushups!", expensive_closure(intensity));
</span><span class="boring">        println!("Next, do {} situps!", expensive_closure(intensity));
</span><span class="boring">    } else {
</span><span class="boring">        if random_number == 3 {
</span><span class="boring">            println!("Take a break today! Remember to stay hydrated!");
</span><span class="boring">        } else {
</span><span class="boring">            println!(
</span><span class="boring">                "Today, run for {} minutes!",
</span><span class="boring">                expensive_closure(intensity)
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let simulated_user_specified_value = 10;
</span><span class="boring">    let simulated_random_number = 7;
</span><span class="boring">
</span><span class="boring">    generate_workout(simulated_user_specified_value, simulated_random_number);
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 13-2: ThÃªm ghi chÃº kiá»ƒu tÃ¹y chá»n cho cÃ¡c kiá»ƒu
tham sá»‘ vÃ  giÃ¡ trá»‹ tráº£ vá» trong closure</span></p>
<p>Khi thÃªm ghi chÃº kiá»ƒu, cÃº phÃ¡p cá»§a closures trÃ´ng giá»‘ng hÆ¡n vá»›i cÃº phÃ¡p
cá»§a cÃ¡c hÃ m. á» Ä‘Ã¢y, chÃºng ta Ä‘á»‹nh nghÄ©a má»™t hÃ m cá»™ng 1 vÃ o tham sá»‘ cá»§a
nÃ³ vÃ  má»™t closure cÃ³ cÃ¹ng hÃ nh vi, Ä‘á»ƒ so sÃ¡nh. ChÃºng ta Ä‘Ã£ thÃªm má»™t sá»‘
dáº¥u cÃ¡ch Ä‘á»ƒ cÄƒn cÃ¡c pháº§n liÃªn quan. Äiá»u nÃ y minh há»a cÃ¡ch cÃº phÃ¡p
closure tÆ°Æ¡ng tá»± cÃº phÃ¡p hÃ m, ngoáº¡i trá»« viá»‡c sá»­ dá»¥ng cÃ¡c dáº¥u á»‘ng (<code>| |</code>)
vÃ  má»©c Ä‘á»™ cÃº phÃ¡p tÃ¹y chá»n.</p>
<pre><code class="language-rust ignore">fn  add_one_v1   (x: u32) -&gt; u32 { x + 1 }
let add_one_v2 = |x: u32| -&gt; u32 { x + 1 };
let add_one_v3 = |x|             { x + 1 };
let add_one_v4 = |x|               x + 1  ;</code></pre>
<p>DÃ²ng Ä‘áº§u tiÃªn hiá»ƒn thá»‹ Ä‘á»‹nh nghÄ©a má»™t hÃ m, vÃ  dÃ²ng thá»© hai hiá»ƒn thá»‹ Ä‘á»‹nh
nghÄ©a má»™t closure vá»›i Ä‘áº§y Ä‘á»§ ghi chÃº kiá»ƒu. á» dÃ²ng thá»© ba, chÃºng ta loáº¡i
bá» ghi chÃº kiá»ƒu khá»i Ä‘á»‹nh nghÄ©a closure. á» dÃ²ng thá»© tÆ°, chÃºng ta bá»
cáº·p dáº¥u ngoáº·c nhá»n, vá»‘n tÃ¹y chá»n vÃ¬ thÃ¢n closure chá»‰ cÃ³ má»™t biá»ƒu thá»©c.
Táº¥t cáº£ cÃ¡c Ä‘á»‹nh nghÄ©a nÃ y Ä‘á»u há»£p lá»‡ vÃ  sáº½ cho cÃ¹ng má»™t hÃ nh vi khi
Ä‘Æ°á»£c gá»i. CÃ¡c dÃ²ng <code>add_one_v3</code> vÃ  <code>add_one_v4</code> yÃªu cáº§u cÃ¡c closure Ä‘Æ°á»£c
Ä‘Ã¡nh giÃ¡ trÆ°á»›c khi biÃªn dá»‹ch vÃ¬ cÃ¡c kiá»ƒu sáº½ Ä‘Æ°á»£c suy luáº­n tá»« cÃ¡ch chÃºng
Ä‘Æ°á»£c sá»­ dá»¥ng. Äiá»u nÃ y tÆ°Æ¡ng tá»± nhÆ° <code>let v = Vec::new();</code> cáº§n ghi chÃº
kiá»ƒu hoáº·c cÃ¡c giÃ¡ trá»‹ cá»§a má»™t kiá»ƒu nÃ o Ä‘Ã³ Ä‘Æ°á»£c thÃªm vÃ o <code>Vec</code> Ä‘á»ƒ Rust
cÃ³ thá»ƒ suy luáº­n kiá»ƒu.</p>
<p>Äá»‘i vá»›i Ä‘á»‹nh nghÄ©a closure, compiler sáº½ suy luáº­n má»™t kiá»ƒu cá»¥ thá»ƒ cho má»—i
tham sá»‘ vÃ  cho giÃ¡ trá»‹ tráº£ vá» cá»§a chÃºng. VÃ­ dá»¥, Listing 13-3 hiá»ƒn thá»‹
Ä‘á»‹nh nghÄ©a má»™t closure ngáº¯n chá»‰ tráº£ vá» giÃ¡ trá»‹ mÃ  nÃ³ nháº­n lÃ m tham sá»‘.
Closure nÃ y khÃ´ng há»¯u Ã­ch láº¯m ngoÃ i má»¥c Ä‘Ã­ch minh há»a. LÆ°u Ã½ ráº±ng chÃºng
ta khÃ´ng thÃªm báº¥t ká»³ ghi chÃº kiá»ƒu nÃ o cho Ä‘á»‹nh nghÄ©a. VÃ¬ khÃ´ng cÃ³ ghi
chÃº kiá»ƒu, chÃºng ta cÃ³ thá»ƒ gá»i closure vá»›i báº¥t ká»³ kiá»ƒu nÃ o, nhÆ° láº§n Ä‘áº§u
chÃºng ta gá»i vá»›i <code>String</code>. Náº¿u sau Ä‘Ã³ thá»­ gá»i <code>example_closure</code> vá»›i má»™t
sá»‘ nguyÃªn, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">fn main() {
</span>    let example_closure = |x| x;

    let s = example_closure(String::from("hello"));
    let n = example_closure(5);
<span class="boring">}</span></code></pre>
<p><span class="caption">Listing 13-3: Thá»­ gá»i má»™t closure cÃ³ kiá»ƒu Ä‘Æ°á»£c suy luáº­n
vá»›i hai kiá»ƒu khÃ¡c nhau</span></p>
<p>Compiler sáº½ Ä‘Æ°a ra lá»—i sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling closure-example v0.1.0 (file:///projects/closure-example)
error[E0308]: mismatched types
 --&gt; src/main.rs:5:29
  |
5 |     let n = example_closure(5);
  |             --------------- ^- help: try using a conversion method: `.to_string()`
  |             |               |
  |             |               expected `String`, found integer
  |             arguments to this function are incorrect
  |
note: expected because the closure was earlier called with an argument of type `String`
 --&gt; src/main.rs:4:29
  |
4 |     let s = example_closure(String::from("hello"));
  |             --------------- ^^^^^^^^^^^^^^^^^^^^^ expected because this argument is of type `String`
  |             |
  |             in this closure call
note: closure parameter defined here
 --&gt; src/main.rs:2:28
  |
2 |     let example_closure = |x| x;
  |                            ^

For more information about this error, try `rustc --explain E0308`.
error: could not compile `closure-example` (bin "closure-example") due to 1 previous error
</code></pre>
<p>Láº§n Ä‘áº§u tiÃªn chÃºng ta gá»i <code>example_closure</code> vá»›i giÃ¡ trá»‹ <code>String</code>, compiler
suy luáº­n kiá»ƒu cá»§a <code>x</code> vÃ  kiá»ƒu tráº£ vá» cá»§a closure lÃ  <code>String</code>. Nhá»¯ng kiá»ƒu
nÃ y sau Ä‘Ã³ Ä‘Æ°á»£c â€œkhÃ³aâ€ trong closure á»Ÿ <code>example_closure</code>, vÃ  chÃºng ta sáº½
nháº­n Ä‘Æ°á»£c lá»—i kiá»ƒu khi cá»‘ gáº¯ng sá»­ dá»¥ng má»™t kiá»ƒu khÃ¡c vá»›i cÃ¹ng closure.</p>
<h3 id="báº¯t-tham-chiáº¿u-hoáº·c-chuyá»ƒn-quyá»n-sá»Ÿ-há»¯u"><a class="header" href="#báº¯t-tham-chiáº¿u-hoáº·c-chuyá»ƒn-quyá»n-sá»Ÿ-há»¯u">Báº¯t Tham Chiáº¿u hoáº·c Chuyá»ƒn Quyá»n Sá»Ÿ Há»¯u</a></h3>
<p>Closures cÃ³ thá»ƒ báº¯t cÃ¡c giÃ¡ trá»‹ tá»« mÃ´i trÆ°á»ng cá»§a chÃºng theo ba cÃ¡ch, tÆ°Æ¡ng
á»©ng trá»±c tiáº¿p vá»›i ba cÃ¡ch má»™t hÃ m cÃ³ thá»ƒ nháº­n tham sá»‘: mÆ°á»£n báº¥t biáº¿n,
mÆ°á»£n cÃ³ thá»ƒ thay Ä‘á»•i, vÃ  nháº­n quyá»n sá»Ÿ há»¯u. Closure sáº½ quyáº¿t Ä‘á»‹nh sá»­ dá»¥ng
cÃ¡ch nÃ o dá»±a trÃªn nhá»¯ng gÃ¬ thÃ¢n hÃ m lÃ m vá»›i cÃ¡c giÃ¡ trá»‹ bá»‹ báº¯t.</p>
<p>Trong Listing 13-4, chÃºng ta Ä‘á»‹nh nghÄ©a má»™t closure báº¯t má»™t tham chiáº¿u
báº¥t biáº¿n Ä‘áº¿n vector cÃ³ tÃªn <code>list</code> vÃ¬ nÃ³ chá»‰ cáº§n tham chiáº¿u báº¥t biáº¿n Ä‘á»ƒ in
giÃ¡ trá»‹:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let list = vec![1, 2, 3];
    println!("Before defining closure: {list:?}");

    let only_borrows = || println!("From closure: {list:?}");

    println!("Before calling closure: {list:?}");
    only_borrows();
    println!("After calling closure: {list:?}");
}</code></pre></pre>
<p><span class="caption">Listing 13-4: Äá»‹nh nghÄ©a vÃ  gá»i má»™t closure báº¯t tham chiáº¿u báº¥t biáº¿n</span></p>
<p>VÃ­ dá»¥ nÃ y cÅ©ng minh há»a ráº±ng má»™t biáº¿n cÃ³ thá»ƒ liÃªn káº¿t vá»›i má»™t Ä‘á»‹nh nghÄ©a
closure, vÃ  chÃºng ta cÃ³ thá»ƒ gá»i closure sau nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng tÃªn
biáº¿n vÃ  dáº¥u ngoáº·c, nhÆ° thá»ƒ tÃªn biáº¿n lÃ  tÃªn hÃ m.</p>
<p>VÃ¬ chÃºng ta cÃ³ thá»ƒ cÃ³ nhiá»u tham chiáº¿u báº¥t biáº¿n Ä‘áº¿n <code>list</code> cÃ¹ng lÃºc,
<code>list</code> váº«n cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c tá»« code trÆ°á»›c khi Ä‘á»‹nh nghÄ©a closure,
sau khi Ä‘á»‹nh nghÄ©a closure nhÆ°ng trÆ°á»›c khi gá»i closure, vÃ  sau khi gá»i
closure. Äoáº¡n code nÃ y biÃªn dá»‹ch Ä‘Æ°á»£c, cháº¡y Ä‘Æ°á»£c vÃ  in ra:</p>
<pre><code class="language-console">$ cargo run
   Compiling closure-example v0.1.0 (file:///projects/closure-example)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.43s
     Running `target/debug/closure-example`
Before defining closure: [1, 2, 3]
Before calling closure: [1, 2, 3]
From closure: [1, 2, 3]
After calling closure: [1, 2, 3]
</code></pre>
<p>Tiáº¿p theo, trong Listing 13-5, chÃºng ta thay Ä‘á»•i thÃ¢n closure sao cho nÃ³
thÃªm má»™t pháº§n tá»­ vÃ o vector <code>list</code>. Closure bÃ¢y giá» báº¯t má»™t tham chiáº¿u
cÃ³ thá»ƒ thay Ä‘á»•i:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let mut list = vec![1, 2, 3];
    println!("Before defining closure: {list:?}");

    let mut borrows_mutably = || list.push(7);

    borrows_mutably();
    println!("After calling closure: {list:?}");
}</code></pre></pre>
<p><span class="caption">Listing 13-5: Äá»‹nh nghÄ©a vÃ  gá»i má»™t closure báº¯t tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i</span></p>
<p>Äoáº¡n code nÃ y biÃªn dá»‹ch Ä‘Æ°á»£c, cháº¡y Ä‘Æ°á»£c vÃ  in ra:</p>
<pre><code class="language-console">$ cargo run
   Compiling closure-example v0.1.0 (file:///projects/closure-example)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.43s
     Running `target/debug/closure-example`
Before defining closure: [1, 2, 3]
After calling closure: [1, 2, 3, 7]
</code></pre>
<p>LÆ°u Ã½ ráº±ng khÃ´ng cÃ²n <code>println!</code> nÃ o giá»¯a Ä‘á»‹nh nghÄ©a vÃ  gá»i closure
<code>borrows_mutably</code>: khi <code>borrows_mutably</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a, nÃ³ báº¯t má»™t
tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i Ä‘áº¿n <code>list</code>. ChÃºng ta khÃ´ng sá»­ dá»¥ng closure
ná»¯a sau khi gá»i, nÃªn viá»‡c mÆ°á»£n cÃ³ thá»ƒ thay Ä‘á»•i káº¿t thÃºc. Giá»¯a Ä‘á»‹nh
nghÄ©a closure vÃ  gá»i closure, viá»‡c mÆ°á»£n báº¥t biáº¿n Ä‘á»ƒ in ra khÃ´ng Ä‘Æ°á»£c
cho phÃ©p vÃ¬ khi cÃ³ má»™t tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i, khÃ´ng cÃ³ mÆ°á»£n nÃ o
khÃ¡c Ä‘Æ°á»£c phÃ©p. HÃ£y thá»­ thÃªm má»™t <code>println!</code> vÃ o Ä‘Ã³ Ä‘á»ƒ xem thÃ´ng bÃ¡o
lá»—i báº¡n nháº­n Ä‘Æ°á»£c!</p>
<p>Náº¿u báº¡n muá»‘n buá»™c closure nháº­n quyá»n sá»Ÿ há»¯u cÃ¡c giÃ¡ trá»‹ nÃ³ sá»­ dá»¥ng
trong mÃ´i trÆ°á»ng máº·c dÃ¹ thÃ¢n closure khÃ´ng nháº¥t thiáº¿t pháº£i cáº§n quyá»n
sá»Ÿ há»¯u, báº¡n cÃ³ thá»ƒ dÃ¹ng tá»« khÃ³a <code>move</code> trÆ°á»›c danh sÃ¡ch tham sá»‘.</p>
<p>Ká»¹ thuáº­t nÃ y chá»§ yáº¿u há»¯u Ã­ch khi truyá»n má»™t closure vÃ o má»™t luá»“ng má»›i
Ä‘á»ƒ chuyá»ƒn dá»¯ liá»‡u sao cho nÃ³ thuá»™c sá»Ÿ há»¯u cá»§a luá»“ng má»›i. ChÃºng ta sáº½
tháº£o luáº­n chi tiáº¿t vá» luá»“ng vÃ  lÃ½ do muá»‘n dÃ¹ng chÃºng trong ChÆ°Æ¡ng 16
khi bÃ n vá» concurrency, nhÆ°ng bÃ¢y giá», hÃ£y cÃ¹ng khÃ¡m phÃ¡ ngáº¯n gá»n viá»‡c
khá»Ÿi táº¡o má»™t luá»“ng má»›i sá»­ dá»¥ng closure cáº§n tá»« khÃ³a <code>move</code>. Listing 13-6
hiá»ƒn thá»‹ Listing 13-4 Ä‘Æ°á»£c chá»‰nh sá»­a Ä‘á»ƒ in vector trong má»™t luá»“ng má»›i
thay vÃ¬ luá»“ng chÃ­nh:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::thread;

fn main() {
    let list = vec![1, 2, 3];
    println!("Before defining closure: {list:?}");

    thread::spawn(move || println!("From thread: {list:?}"))
        .join()
        .unwrap();
}</code></pre></pre>
<p><span class="caption">Listing 13-6: Sá»­ dá»¥ng <code>move</code> Ä‘á»ƒ buá»™c closure cá»§a luá»“ng má»›i nháº­n quyá»n sá»Ÿ há»¯u <code>list</code></span></p>
<p>ChÃºng ta khá»Ÿi táº¡o má»™t luá»“ng má»›i, truyá»n cho luá»“ng má»™t closure Ä‘á»ƒ cháº¡y
nhÆ° má»™t Ä‘á»‘i sá»‘. ThÃ¢n closure in ra <code>list</code>. Trong Listing 13-4, closure chá»‰
báº¯t <code>list</code> báº±ng má»™t tham chiáº¿u báº¥t biáº¿n vÃ¬ Ä‘Ã³ lÃ  má»©c truy cáº­p tá»‘i thiá»ƒu
cáº§n thiáº¿t Ä‘á»ƒ in. Trong vÃ­ dá»¥ nÃ y, máº·c dÃ¹ thÃ¢n closure váº«n chá»‰ cáº§n
má»™t tham chiáº¿u báº¥t biáº¿n, chÃºng ta cáº§n chá»‰ Ä‘á»‹nh ráº±ng <code>list</code> nÃªn Ä‘Æ°á»£c
chuyá»ƒn vÃ o closure báº±ng cÃ¡ch Ä‘áº·t tá»« khÃ³a <code>move</code> á»Ÿ Ä‘áº§u Ä‘á»‹nh nghÄ©a closure.
Luá»“ng má»›i cÃ³ thá»ƒ káº¿t thÃºc trÆ°á»›c khi luá»“ng chÃ­nh káº¿t thÃºc, hoáº·c luá»“ng chÃ­nh
cÃ³ thá»ƒ káº¿t thÃºc trÆ°á»›c. Náº¿u luá»“ng chÃ­nh váº«n giá»¯ quyá»n sá»Ÿ há»¯u <code>list</code> nhÆ°ng
káº¿t thÃºc trÆ°á»›c luá»“ng má»›i vÃ  há»§y <code>list</code>, tham chiáº¿u báº¥t biáº¿n trong luá»“ng má»›i
sáº½ khÃ´ng cÃ²n há»£p lá»‡. Do Ä‘Ã³, compiler yÃªu cáº§u <code>list</code> pháº£i Ä‘Æ°á»£c chuyá»ƒn vÃ o
closure cá»§a luá»“ng má»›i Ä‘á»ƒ tham chiáº¿u Ä‘Æ°á»£c há»£p lá»‡. HÃ£y thá»­ bá» tá»« khÃ³a <code>move</code>
hoáº·c sá»­ dá»¥ng <code>list</code> trong luá»“ng chÃ­nh sau khi Ä‘á»‹nh nghÄ©a closure Ä‘á»ƒ xem
cÃ¡c lá»—i compiler báº¡n nháº­n Ä‘Æ°á»£c!</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="storing-closures-using-generic-parameters-and-the-fn-traits"></a>
<a id="limitations-of-the-cacher-implementation"></a>
<a id="moving-captured-values-out-of-the-closure-and-the-fn-traits"></a></p>
<h3 id="chuyá»ƒn-giÃ¡-trá»‹-báº¯t-ÄÆ°á»£c-ra-khá»i-closures-vÃ -cÃ¡c-trait-fn"><a class="header" href="#chuyá»ƒn-giÃ¡-trá»‹-báº¯t-ÄÆ°á»£c-ra-khá»i-closures-vÃ -cÃ¡c-trait-fn">Chuyá»ƒn GiÃ¡ Trá»‹ Báº¯t ÄÆ°á»£c Ra Khá»i Closures vÃ  CÃ¡c Trait <code>Fn</code></a></h3>
<p>Khi má»™t closure Ä‘Ã£ báº¯t má»™t tham chiáº¿u hoáº·c quyá»n sá»Ÿ há»¯u cá»§a má»™t giÃ¡ trá»‹
tá»« mÃ´i trÆ°á»ng nÆ¡i closure Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a (áº£nh hÆ°á»Ÿng Ä‘áº¿n viá»‡c cÃ³ gÃ¬,
náº¿u cÃ³, Ä‘Æ°á»£c chuyá»ƒn <em>vÃ o</em> closure), thÃ¬ Ä‘oáº¡n code trong thÃ¢n closure sáº½
xÃ¡c Ä‘á»‹nh Ä‘iá»u gÃ¬ xáº£y ra vá»›i cÃ¡c tham chiáº¿u hoáº·c giÃ¡ trá»‹ khi closure Ä‘Æ°á»£c
thá»±c thi sau nÃ y (áº£nh hÆ°á»Ÿng Ä‘áº¿n viá»‡c cÃ³ gÃ¬, náº¿u cÃ³, Ä‘Æ°á»£c chuyá»ƒn <em>ra khá»i</em>
closure). ThÃ¢n closure cÃ³ thá»ƒ thá»±c hiá»‡n báº¥t ká»³ Ä‘iá»u nÃ o sau Ä‘Ã¢y: chuyá»ƒn
giÃ¡ trá»‹ báº¯t Ä‘Æ°á»£c ra khá»i closure, thay Ä‘á»•i giÃ¡ trá»‹ báº¯t Ä‘Æ°á»£c, khÃ´ng chuyá»ƒn
khÃ´ng thay Ä‘á»•i giÃ¡ trá»‹, hoáº·c khÃ´ng báº¯t gÃ¬ tá»« mÃ´i trÆ°á»ng ngay tá»« Ä‘áº§u.</p>
<p>CÃ¡ch closure báº¯t vÃ  xá»­ lÃ½ cÃ¡c giÃ¡ trá»‹ tá»« mÃ´i trÆ°á»ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c trait
mÃ  closure thá»±c thi, vÃ  traits lÃ  cÃ¡ch cÃ¡c hÃ m vÃ  struct cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh
loáº¡i closures mÃ  chÃºng cÃ³ thá»ƒ sá»­ dá»¥ng. Closures sáº½ tá»± Ä‘á»™ng triá»ƒn khai má»™t,
hai, hoáº·c cáº£ ba trait <code>Fn</code> nÃ y, theo cÃ¡ch cá»™ng dá»“n, tÃ¹y thuá»™c vÃ o cÃ¡ch thÃ¢n
closure xá»­ lÃ½ cÃ¡c giÃ¡ trá»‹:</p>
<ol>
<li><code>FnOnce</code> Ã¡p dá»¥ng cho cÃ¡c closures chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i má»™t láº§n. Táº¥t cáº£
closures Ä‘á»u triá»ƒn khai Ã­t nháº¥t trait nÃ y, vÃ¬ táº¥t cáº£ closures cÃ³ thá»ƒ Ä‘Æ°á»£c
gá»i. Má»™t closure mÃ  chuyá»ƒn cÃ¡c giÃ¡ trá»‹ báº¯t Ä‘Æ°á»£c ra khá»i thÃ¢n cá»§a nÃ³
sáº½ chá»‰ triá»ƒn khai <code>FnOnce</code> vÃ  khÃ´ng triá»ƒn khai cÃ¡c trait <code>Fn</code> khÃ¡c,
vÃ¬ nÃ³ chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i má»™t láº§n.</li>
<li><code>FnMut</code> Ã¡p dá»¥ng cho cÃ¡c closures khÃ´ng chuyá»ƒn giÃ¡ trá»‹ báº¯t Ä‘Æ°á»£c ra khá»i
thÃ¢n, nhÆ°ng cÃ³ thá»ƒ thay Ä‘á»•i cÃ¡c giÃ¡ trá»‹ báº¯t Ä‘Æ°á»£c. Nhá»¯ng closures nÃ y
cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i nhiá»u láº§n.</li>
<li><code>Fn</code> Ã¡p dá»¥ng cho cÃ¡c closures khÃ´ng chuyá»ƒn giÃ¡ trá»‹ báº¯t Ä‘Æ°á»£c ra khá»i thÃ¢n
vÃ  khÃ´ng thay Ä‘á»•i cÃ¡c giÃ¡ trá»‹ báº¯t Ä‘Æ°á»£c, cÅ©ng nhÆ° cÃ¡c closures khÃ´ng báº¯t
gÃ¬ tá»« mÃ´i trÆ°á»ng. Nhá»¯ng closures nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i nhiá»u láº§n mÃ  khÃ´ng
lÃ m thay Ä‘á»•i mÃ´i trÆ°á»ng, Ä‘iá»u nÃ y quan trá»ng trong cÃ¡c trÆ°á»ng há»£p nhÆ°
gá»i closure nhiá»u láº§n Ä‘á»“ng thá»i.</li>
</ol>
<p>HÃ£y xem Ä‘á»‹nh nghÄ©a cá»§a phÆ°Æ¡ng thá»©c <code>unwrap_or_else</code> trÃªn <code>Option&lt;T&gt;</code> mÃ 
chÃºng ta Ä‘Ã£ sá»­ dá»¥ng trong Listing 13-1:</p>
<pre><code class="language-rust ignore">impl&lt;T&gt; Option&lt;T&gt; {
    pub fn unwrap_or_else&lt;F&gt;(self, f: F) -&gt; T
    where
        F: FnOnce() -&gt; T
    {
        match self {
            Some(x) =&gt; x,
            None =&gt; f(),
        }
    }
}</code></pre>
<p>Nhá»› ráº±ng <code>T</code> lÃ  kiá»ƒu tá»•ng quÃ¡t Ä‘áº¡i diá»‡n cho kiá»ƒu giÃ¡ trá»‹ trong biáº¿n thá»ƒ
<code>Some</code> cá»§a má»™t <code>Option</code>. Kiá»ƒu <code>T</code> cÅ©ng lÃ  kiá»ƒu tráº£ vá» cá»§a hÃ m
<code>unwrap_or_else</code>: vÃ­ dá»¥, code gá»i <code>unwrap_or_else</code> trÃªn má»™t
<code>Option&lt;String&gt;</code> sáº½ nháº­n vá» má»™t <code>String</code>.</p>
<p>Tiáº¿p theo, lÆ°u Ã½ ráº±ng hÃ m <code>unwrap_or_else</code> cÃ³ thÃªm tham sá»‘ kiá»ƒu tá»•ng quÃ¡t
<code>F</code>. Kiá»ƒu <code>F</code> lÃ  kiá»ƒu cá»§a tham sá»‘ <code>f</code>, chÃ­nh lÃ  closure mÃ  chÃºng ta cung
cáº¥p khi gá»i <code>unwrap_or_else</code>.</p>
<p>RÃ ng buá»™c trait Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trÃªn kiá»ƒu tá»•ng quÃ¡t <code>F</code> lÃ  <code>FnOnce() -&gt; T</code>,
cÃ³ nghÄ©a <code>F</code> pháº£i cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i má»™t láº§n, khÃ´ng nháº­n tham sá»‘, vÃ  tráº£
vá» má»™t <code>T</code>. Viá»‡c dÃ¹ng <code>FnOnce</code> trong rÃ ng buá»™c trait thá»ƒ hiá»‡n háº¡n cháº¿
ráº±ng <code>unwrap_or_else</code> chá»‰ gá»i <code>f</code> tá»‘i Ä‘a má»™t láº§n. Trong thÃ¢n hÃ m
<code>unwrap_or_else</code>, náº¿u <code>Option</code> lÃ  <code>Some</code>, <code>f</code> sáº½ khÃ´ng Ä‘Æ°á»£c gá»i.
Náº¿u <code>Option</code> lÃ  <code>None</code>, <code>f</code> sáº½ Ä‘Æ°á»£c gá»i má»™t láº§n. VÃ¬ táº¥t cáº£ closures
triá»ƒn khai <code>FnOnce</code>, <code>unwrap_or_else</code> cháº¥p nháº­n Ä‘a dáº¡ng nháº¥t cÃ¡c loáº¡i
closures vÃ  linh hoáº¡t tá»‘i Ä‘a.</p>
<blockquote>
<p>LÆ°u Ã½: CÃ¡c hÃ m cÅ©ng cÃ³ thá»ƒ triá»ƒn khai cáº£ ba trait <code>Fn</code>. Náº¿u viá»‡c
chÃºng ta muá»‘n lÃ m khÃ´ng yÃªu cáº§u báº¯t giÃ¡ trá»‹ tá»« mÃ´i trÆ°á»ng, chÃºng ta
cÃ³ thá»ƒ sá»­ dá»¥ng tÃªn hÃ m thay vÃ¬ closure nÆ¡i cáº§n má»™t thá»© triá»ƒn khai
má»™t trong cÃ¡c trait <code>Fn</code>. VÃ­ dá»¥, trÃªn má»™t giÃ¡ trá»‹ <code>Option&lt;Vec&lt;T&gt;&gt;</code>,
ta cÃ³ thá»ƒ gá»i <code>unwrap_or_else(Vec::new)</code> Ä‘á»ƒ nháº­n má»™t vector má»›i rá»—ng
náº¿u giÃ¡ trá»‹ lÃ  <code>None</code>.</p>
</blockquote>
<p>BÃ¢y giá», hÃ£y xem phÆ°Æ¡ng thá»©c thÆ° viá»‡n chuáº©n <code>sort_by_key</code> Ä‘á»‹nh nghÄ©a
trÃªn cÃ¡c slices, Ä‘á»ƒ tháº¥y sá»± khÃ¡c biá»‡t vá»›i <code>unwrap_or_else</code> vÃ  lÃ½ do
táº¡i sao <code>sort_by_key</code> dÃ¹ng <code>FnMut</code> thay vÃ¬ <code>FnOnce</code> cho rÃ ng buá»™c trait.
Closure nháº­n má»™t tham sá»‘ dÆ°á»›i dáº¡ng tham chiáº¿u Ä‘áº¿n pháº§n tá»­ hiá»‡n táº¡i
trong slice Ä‘ang xÃ©t, vÃ  tráº£ vá» má»™t giÃ¡ trá»‹ kiá»ƒu <code>K</code> cÃ³ thá»ƒ sáº¯p xáº¿p.
HÃ m nÃ y há»¯u Ã­ch khi muá»‘n sáº¯p xáº¿p slice theo má»™t thuá»™c tÃ­nh cá»¥ thá»ƒ
cá»§a má»—i pháº§n tá»­. Trong Listing 13-7, chÃºng ta cÃ³ má»™t danh sÃ¡ch
cÃ¡c instance <code>Rectangle</code> vÃ  dÃ¹ng <code>sort_by_key</code> Ä‘á»ƒ sáº¯p xáº¿p theo
thuá»™c tÃ­nh <code>width</code> tá»« nhá» Ä‘áº¿n lá»›n:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let mut list = [
        Rectangle { width: 10, height: 1 },
        Rectangle { width: 3, height: 5 },
        Rectangle { width: 7, height: 12 },
    ];

    list.sort_by_key(|r| r.width);
    println!("{list:#?}");
}</code></pre></pre>
<p><span class="caption">Listing 13-7: Sá»­ dá»¥ng <code>sort_by_key</code> Ä‘á»ƒ sáº¯p xáº¿p cÃ¡c hÃ¬nh chá»¯ nháº­t theo chiá»u rá»™ng</span></p>
<p>Äoáº¡n code nÃ y in ra:</p>
<pre><code class="language-console">$ cargo run
   Compiling rectangles v0.1.0 (file:///projects/rectangles)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.41s
     Running `target/debug/rectangles`
[
    Rectangle {
        width: 3,
        height: 5,
    },
    Rectangle {
        width: 7,
        height: 12,
    },
    Rectangle {
        width: 10,
        height: 1,
    },
]
</code></pre>
<p>LÃ½ do <code>sort_by_key</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a Ä‘á»ƒ nháº­n má»™t closure <code>FnMut</code> lÃ  vÃ¬
nÃ³ gá»i closure nhiá»u láº§n: má»™t láº§n cho má»—i pháº§n tá»­ trong slice. Closure
<code>|r| r.width</code> khÃ´ng báº¯t, thay Ä‘á»•i, hay chuyá»ƒn ra báº¥t ká»³ giÃ¡ trá»‹ nÃ o
tá»« mÃ´i trÆ°á»ng, nÃªn nÃ³ thá»a mÃ£n cÃ¡c yÃªu cáº§u cá»§a rÃ ng buá»™c trait.</p>
<p>NgÆ°á»£c láº¡i, Listing 13-8 cho tháº¥y má»™t vÃ­ dá»¥ vá» closure chá»‰ triá»ƒn khai
trait <code>FnOnce</code>, vÃ¬ nÃ³ chuyá»ƒn má»™t giÃ¡ trá»‹ ra khá»i mÃ´i trÆ°á»ng. Compiler
sáº½ khÃ´ng cho phÃ©p chÃºng ta sá»­ dá»¥ng closure nÃ y vá»›i <code>sort_by_key</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let mut list = [
        Rectangle { width: 10, height: 1 },
        Rectangle { width: 3, height: 5 },
        Rectangle { width: 7, height: 12 },
    ];

    let mut sort_operations = vec![];
    let value = String::from("closure called");

    list.sort_by_key(|r| {
        sort_operations.push(value);
        r.width
    });
    println!("{list:#?}");
}</code></pre>
<p><span class="caption">Listing 13-8: Thá»­ sá»­ dá»¥ng má»™t closure <code>FnOnce</code> vá»›i <code>sort_by_key</code></span></p>
<p>ÄÃ¢y lÃ  má»™t cÃ¡ch dá»±ng lÃªn rÆ°á»m rÃ  vÃ  phá»©c táº¡p (khÃ´ng hoáº¡t Ä‘á»™ng) Ä‘á»ƒ cá»‘
gáº¯ng Ä‘áº¿m sá»‘ láº§n <code>sort_by_key</code> Ä‘Æ°á»£c gá»i khi sáº¯p xáº¿p <code>list</code>. Äoáº¡n code
nÃ y cá»‘ gáº¯ng Ä‘áº¿m báº±ng cÃ¡ch Ä‘áº©y <code>value</code>â€”má»™t <code>String</code> tá»« mÃ´i trÆ°á»ng cá»§a
closureâ€”vÃ o vector <code>sort_operations</code>. Closure báº¯t <code>value</code> rá»“i chuyá»ƒn
<code>value</code> ra khá»i closure báº±ng cÃ¡ch chuyá»ƒn quyá»n sá»Ÿ há»¯u cá»§a <code>value</code> vÃ o
vector <code>sort_operations</code>. Closure nÃ y chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i má»™t láº§n;
náº¿u cá»‘ gá»i láº§n thá»© hai sáº½ khÃ´ng Ä‘Æ°á»£c vÃ¬ <code>value</code> khÃ´ng cÃ²n trong
mÃ´i trÆ°á»ng Ä‘á»ƒ Ä‘áº©y vÃ o <code>sort_operations</code> ná»¯a! Do Ä‘Ã³, closure nÃ y chá»‰
triá»ƒn khai <code>FnOnce</code>. Khi cá»‘ biÃªn dá»‹ch Ä‘oáº¡n code nÃ y, chÃºng ta nháº­n Ä‘Æ°á»£c
lá»—i ráº±ng <code>value</code> khÃ´ng thá»ƒ Ä‘Æ°á»£c chuyá»ƒn ra khá»i closure vÃ¬ closure
pháº£i triá»ƒn khai <code>FnMut</code>:</p>
<pre><code class="language-console">$ cargo run
   Compiling rectangles v0.1.0 (file:///projects/rectangles)
error[E0507]: cannot move out of `value`, a captured variable in an `FnMut` closure
  --&gt; src/main.rs:18:30
   |
15 |     let value = String::from("closure called");
   |         ----- captured outer variable
16 |
17 |     list.sort_by_key(|r| {
   |                      --- captured by this `FnMut` closure
18 |         sort_operations.push(value);
   |                              ^^^^^ move occurs because `value` has type `String`, which does not implement the `Copy` trait
   |
help: consider cloning the value if the performance cost is acceptable
   |
18 |         sort_operations.push(value.clone());
   |                                   ++++++++

For more information about this error, try `rustc --explain E0507`.
error: could not compile `rectangles` (bin "rectangles") due to 1 previous error
</code></pre>
<p>Lá»—i nÃ y chá»‰ ra dÃ²ng trong thÃ¢n closure chuyá»ƒn <code>value</code> ra khá»i mÃ´i trÆ°á»ng.
Äá»ƒ kháº¯c phá»¥c, chÃºng ta cáº§n thay Ä‘á»•i thÃ¢n closure sao cho khÃ´ng chuyá»ƒn
giÃ¡ trá»‹ ra khá»i mÃ´i trÆ°á»ng. Äá»ƒ Ä‘áº¿m sá»‘ láº§n <code>sort_by_key</code> Ä‘Æ°á»£c gá»i, viá»‡c
giá»¯ má»™t biáº¿n Ä‘áº¿m trong mÃ´i trÆ°á»ng vÃ  tÄƒng giÃ¡ trá»‹ cá»§a nÃ³ trong thÃ¢n
closure lÃ  cÃ¡ch trá»±c quan hÆ¡n Ä‘á»ƒ tÃ­nh toÃ¡n. Closure trong Listing 13-9
hoáº¡t Ä‘á»™ng vá»›i <code>sort_by_key</code> vÃ¬ nÃ³ chá»‰ báº¯t má»™t tham chiáº¿u cÃ³ thá»ƒ thay
Ä‘á»•i Ä‘áº¿n biáº¿n Ä‘áº¿m <code>num_sort_operations</code> vÃ  do Ä‘Ã³ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i nhiá»u
láº§n:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let mut list = [
        Rectangle { width: 10, height: 1 },
        Rectangle { width: 3, height: 5 },
        Rectangle { width: 7, height: 12 },
    ];

    let mut num_sort_operations = 0;
    list.sort_by_key(|r| {
        num_sort_operations += 1;
        r.width
    });
    println!("{list:#?}, sorted in {num_sort_operations} operations");
}</code></pre></pre>
<p><span class="caption">Listing 13-9: Sá»­ dá»¥ng closure <code>FnMut</code> vá»›i <code>sort_by_key</code> Ä‘Æ°á»£c phÃ©p</span></p>
<p>CÃ¡c trait <code>Fn</code> ráº¥t quan trá»ng khi Ä‘á»‹nh nghÄ©a hoáº·c sá»­ dá»¥ng cÃ¡c hÃ m
hoáº·c kiá»ƒu dá»¯ liá»‡u cÃ³ dÃ¹ng closures. Trong pháº§n tiáº¿p theo, chÃºng ta sáº½
tháº£o luáº­n vá» iterators. Nhiá»u phÆ°Æ¡ng thá»©c cá»§a iterator nháº­n Ä‘á»‘i sá»‘
lÃ  closure, nÃªn hÃ£y nhá»› cÃ¡c chi tiáº¿t vá» closure nÃ y khi tiáº¿p tá»¥c!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="xá»­-lÃ½-má»™t-chuá»—i-pháº§n-tá»­-vá»›i-iterators"><a class="header" href="#xá»­-lÃ½-má»™t-chuá»—i-pháº§n-tá»­-vá»›i-iterators">Xá»­ LÃ½ Má»™t Chuá»—i Pháº§n Tá»­ vá»›i Iterators</a></h2>
<p>Máº«u iterator cho phÃ©p báº¡n thá»±c hiá»‡n má»™t tÃ¡c vá»¥ nÃ o Ä‘Ã³ trÃªn má»™t chuá»—i
cÃ¡c pháº§n tá»­ láº§n lÆ°á»£t. Má»™t iterator chá»‹u trÃ¡ch nhiá»‡m vá» logic láº·p qua
tá»«ng pháº§n tá»­ vÃ  xÃ¡c Ä‘á»‹nh khi nÃ o chuá»—i káº¿t thÃºc. Khi sá»­ dá»¥ng iterators,
báº¡n khÃ´ng cáº§n tá»± triá»ƒn khai láº¡i logic Ä‘Ã³.</p>
<p>Trong Rust, iterators lÃ  <em>lazy</em>, nghÄ©a lÃ  chÃºng khÃ´ng cÃ³ tÃ¡c dá»¥ng gÃ¬
cho Ä‘áº¿n khi báº¡n gá»i cÃ¡c phÆ°Æ¡ng thá»©c tiÃªu thá»¥ iterator Ä‘á»ƒ dÃ¹ng háº¿t nÃ³.
VÃ­ dá»¥, Ä‘oáº¡n code trong Listing 13-10 táº¡o má»™t iterator trÃªn cÃ¡c pháº§n
tá»­ trong vector <code>v1</code> báº±ng cÃ¡ch gá»i phÆ°Æ¡ng thá»©c <code>iter</code> Ä‘á»‹nh nghÄ©a
trÃªn <code>Vec&lt;T&gt;</code>. Äoáº¡n code nÃ y tá»± nÃ³ khÃ´ng lÃ m gÃ¬ há»¯u Ã­ch.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let v1 = vec![1, 2, 3];

    let v1_iter = v1.iter();
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 13-10: Táº¡o má»™t iterator</span></p>
<p>Iterator Ä‘Æ°á»£c lÆ°u trong biáº¿n <code>v1_iter</code>. Khi Ä‘Ã£ táº¡o má»™t iterator, chÃºng
ta cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ theo nhiá»u cÃ¡ch khÃ¡c nhau. Trong Listing 3-5 á»Ÿ
ChÆ°Æ¡ng 3, chÃºng ta Ä‘Ã£ láº·p qua má»™t máº£ng báº±ng vÃ²ng láº·p <code>for</code> Ä‘á»ƒ thá»±c
hiá»‡n má»™t sá»‘ code trÃªn tá»«ng pháº§n tá»­. Ngáº§m Ä‘á»‹nh, Ä‘iá»u nÃ y Ä‘Ã£ táº¡o vÃ 
sau Ä‘Ã³ tiÃªu thá»¥ má»™t iterator, nhÆ°ng chÃºng ta Ä‘Ã£ bá» qua cÃ¡ch thá»©c
hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c cá»§a nÃ³ cho Ä‘áº¿n bÃ¢y giá».</p>
<p>Trong vÃ­ dá»¥ á»Ÿ Listing 13-11, chÃºng ta tÃ¡ch viá»‡c táº¡o iterator ra khá»i
viá»‡c sá»­ dá»¥ng iterator trong vÃ²ng láº·p <code>for</code>. Khi vÃ²ng láº·p <code>for</code> Ä‘Æ°á»£c
gá»i vá»›i iterator trong <code>v1_iter</code>, má»—i pháº§n tá»­ trong iterator Ä‘Æ°á»£c
sá»­ dá»¥ng trong má»™t láº§n láº·p cá»§a vÃ²ng láº·p, in ra tá»«ng giÃ¡ trá»‹.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let v1 = vec![1, 2, 3];

    let v1_iter = v1.iter();

    for val in v1_iter {
        println!("Got: {val}");
    }
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 13-11: Sá»­ dá»¥ng iterator trong vÃ²ng láº·p <code>for</code></span></p>
<p>Trong cÃ¡c ngÃ´n ngá»¯ khÃ´ng cÃ³ iterator Ä‘Æ°á»£c cung cáº¥p bá»Ÿi thÆ° viá»‡n chuáº©n,
báº¡n cÃ³ thá»ƒ viáº¿t chá»©c nÄƒng tÆ°Æ¡ng tá»± báº±ng cÃ¡ch khá»Ÿi táº¡o má»™t biáº¿n á»Ÿ
chá»‰ sá»‘ 0, dÃ¹ng biáº¿n Ä‘Ã³ Ä‘á»ƒ truy cáº­p vÃ o vector láº¥y giÃ¡ trá»‹, vÃ  tÄƒng
giÃ¡ trá»‹ biáº¿n trong má»™t vÃ²ng láº·p cho Ä‘áº¿n khi Ä‘áº¡t tá»•ng sá»‘ pháº§n tá»­
trong vector.</p>
<p>Iterators xá»­ lÃ½ táº¥t cáº£ logic Ä‘Ã³ cho báº¡n, giáº£m bá»›t code láº·p Ä‘i láº·p
láº¡i mÃ  báº¡n cÃ³ thá»ƒ vÃ´ tÃ¬nh lÃ m sai. Iterators cung cáº¥p nhiá»u sá»± linh
hoáº¡t hÆ¡n Ä‘á»ƒ sá»­ dá»¥ng cÃ¹ng má»™t logic vá»›i nhiá»u loáº¡i chuá»—i khÃ¡c nhau,
khÃ´ng chá»‰ nhá»¯ng cáº¥u trÃºc dá»¯ liá»‡u cÃ³ thá»ƒ truy cáº­p theo chá»‰ sá»‘ nhÆ°
vector. HÃ£y xem cÃ¡ch iterators thá»±c hiá»‡n Ä‘iá»u Ä‘Ã³.</p>
<h3 id="trait-iterator-vÃ -phÆ°Æ¡ng-thá»©c-next"><a class="header" href="#trait-iterator-vÃ -phÆ°Æ¡ng-thá»©c-next">Trait <code>Iterator</code> vÃ  PhÆ°Æ¡ng Thá»©c <code>next</code></a></h3>
<p>Táº¥t cáº£ iterators triá»ƒn khai má»™t trait cÃ³ tÃªn <code>Iterator</code> Ä‘Æ°á»£c Ä‘á»‹nh
nghÄ©a trong thÆ° viá»‡n chuáº©n. Äá»‹nh nghÄ©a cá»§a trait trÃ´ng nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait Iterator {
    type Item;

    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;

    // methods with default implementations elided
}
<span class="boring">}</span></code></pre></pre>
<p>LÆ°u Ã½ ráº±ng Ä‘á»‹nh nghÄ©a nÃ y sá»­ dá»¥ng má»™t sá»‘ cÃº phÃ¡p má»›i: <code>type Item</code> vÃ 
<code>Self::Item</code>, Ä‘á»‹nh nghÄ©a má»™t <em>associated type</em> vá»›i trait nÃ y. ChÃºng ta
sáº½ bÃ n ká»¹ vá» associated types trong ChÆ°Æ¡ng 19. Hiá»‡n táº¡i, báº¡n chá»‰ cáº§n
biáº¿t ráº±ng Ä‘oáº¡n code nÃ y nÃ³i ráº±ng viá»‡c triá»ƒn khai trait <code>Iterator</code> yÃªu
cáº§u báº¡n cÅ©ng pháº£i Ä‘á»‹nh nghÄ©a má»™t kiá»ƒu <code>Item</code>, vÃ  kiá»ƒu <code>Item</code> nÃ y Ä‘Æ°á»£c
sá»­ dá»¥ng trong kiá»ƒu tráº£ vá» cá»§a phÆ°Æ¡ng thá»©c <code>next</code>. NÃ³i cÃ¡ch khÃ¡c, kiá»ƒu
<code>Item</code> sáº½ lÃ  kiá»ƒu Ä‘Æ°á»£c tráº£ vá» tá»« iterator.</p>
<p>Trait <code>Iterator</code> chá»‰ yÃªu cáº§u ngÆ°á»i triá»ƒn khai Ä‘á»‹nh nghÄ©a má»™t phÆ°Æ¡ng
thá»©c: phÆ°Æ¡ng thá»©c <code>next</code>, tráº£ vá» tá»«ng pháº§n tá»­ cá»§a iterator má»™t láº§n,
bao bá»c trong <code>Some</code> vÃ , khi káº¿t thÃºc iteration, tráº£ vá» <code>None</code>.</p>
<p>ChÃºng ta cÃ³ thá»ƒ gá»i trá»±c tiáº¿p phÆ°Æ¡ng thá»©c <code>next</code> trÃªn iterators; Listing
13-12 minh há»a cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c tráº£ vá» tá»« cÃ¡c láº§n gá»i láº·p Ä‘i láº·p láº¡i
<code>next</code> trÃªn iterator Ä‘Æ°á»£c táº¡o tá»« vector.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span>    #[test]
    fn iterator_demonstration() {
        let v1 = vec![1, 2, 3];

        let mut v1_iter = v1.iter();

        assert_eq!(v1_iter.next(), Some(&amp;1));
        assert_eq!(v1_iter.next(), Some(&amp;2));
        assert_eq!(v1_iter.next(), Some(&amp;3));
        assert_eq!(v1_iter.next(), None);
    }
<span class="boring">}</span></code></pre>
<p><span class="caption">Listing 13-12: Gá»i phÆ°Æ¡ng thá»©c <code>next</code> trÃªn má»™t iterator</span></p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta cáº§n lÃ m cho <code>v1_iter</code> cÃ³ thá»ƒ thay Ä‘á»•i (mutable):
gá»i phÆ°Æ¡ng thá»©c <code>next</code> trÃªn má»™t iterator thay Ä‘á»•i tráº¡ng thÃ¡i ná»™i bá»™ mÃ 
iterator sá»­ dá»¥ng Ä‘á»ƒ theo dÃµi vá»‹ trÃ­ hiá»‡n táº¡i trong chuá»—i. NÃ³i cÃ¡ch
khÃ¡c, Ä‘oáº¡n code nÃ y <em>tiÃªu thá»¥</em>, hay dÃ¹ng háº¿t, iterator. Má»—i láº§n gá»i
<code>next</code> láº¥y Ä‘i má»™t pháº§n tá»­ tá»« iterator. ChÃºng ta khÃ´ng cáº§n lÃ m cho
<code>v1_iter</code> mutable khi sá»­ dá»¥ng vÃ²ng láº·p <code>for</code> vÃ¬ vÃ²ng láº·p láº¥y quyá»n
sá»Ÿ há»¯u cá»§a <code>v1_iter</code> vÃ  lÃ m cho nÃ³ mutable ngáº§m.</p>
<p>CÅ©ng lÆ°u Ã½ ráº±ng cÃ¡c giÃ¡ trá»‹ nháº­n Ä‘Æ°á»£c tá»« cÃ¡c láº§n gá»i <code>next</code> lÃ  cÃ¡c
tham chiáº¿u báº¥t biáº¿n (immutable references) Ä‘áº¿n cÃ¡c giÃ¡ trá»‹ trong
vector. PhÆ°Æ¡ng thá»©c <code>iter</code> táº¡o ra má»™t iterator trÃªn cÃ¡c tham chiáº¿u
báº¥t biáº¿n. Náº¿u muá»‘n táº¡o má»™t iterator láº¥y quyá»n sá»Ÿ há»¯u cá»§a <code>v1</code> vÃ 
tráº£ vá» cÃ¡c giÃ¡ trá»‹ sá»Ÿ há»¯u, ta cÃ³ thá»ƒ gá»i <code>into_iter</code> thay vÃ¬ <code>iter</code>.
TÆ°Æ¡ng tá»±, náº¿u muá»‘n láº·p qua cÃ¡c tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i, ta cÃ³ thá»ƒ
gá»i <code>iter_mut</code> thay vÃ¬ <code>iter</code>.</p>
<h3 id="cÃ¡c-phÆ°Æ¡ng-thá»©c-tiÃªu-thá»¥-iterator"><a class="header" href="#cÃ¡c-phÆ°Æ¡ng-thá»©c-tiÃªu-thá»¥-iterator">CÃ¡c phÆ°Æ¡ng thá»©c tiÃªu thá»¥ iterator</a></h3>
<p>Trait <code>Iterator</code> cÃ³ má»™t sá»‘ phÆ°Æ¡ng thá»©c khÃ¡c nhau vá»›i triá»ƒn khai máº·c
Ä‘á»‹nh do thÆ° viá»‡n chuáº©n cung cáº¥p; báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu vá» cÃ¡c phÆ°Æ¡ng
thá»©c nÃ y báº±ng cÃ¡ch xem tÃ i liá»‡u API cá»§a trait <code>Iterator</code>. Má»™t sá»‘ phÆ°Æ¡ng
thá»©c nÃ y gá»i phÆ°Æ¡ng thá»©c <code>next</code> trong Ä‘á»‹nh nghÄ©a cá»§a chÃºng, Ä‘Ã³ lÃ  lÃ½
do báº¡n pháº£i triá»ƒn khai <code>next</code> khi implement trait <code>Iterator</code>.</p>
<p>CÃ¡c phÆ°Æ¡ng thá»©c gá»i <code>next</code> Ä‘Æ°á»£c gá»i lÃ  <em>consuming adaptors</em>, vÃ¬ gá»i
chÃºng sáº½ tiÃªu thá»¥ iterator. Má»™t vÃ­ dá»¥ lÃ  phÆ°Æ¡ng thá»©c <code>sum</code>, nÃ³
láº¥y quyá»n sá»Ÿ há»¯u iterator vÃ  láº·p qua cÃ¡c pháº§n tá»­ báº±ng cÃ¡ch gá»i
<code>next</code> liÃªn tá»¥c, do Ä‘Ã³ tiÃªu thá»¥ iterator. Khi láº·p qua, nÃ³ cá»™ng
má»—i pháº§n tá»­ vÃ o tá»•ng dá»“n vÃ  tráº£ vá» tá»•ng khi káº¿t thÃºc iteration.
Listing 13-13 cÃ³ má»™t vÃ­ dá»¥ minh há»a viá»‡c sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>sum</code>:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span>    #[test]
    fn iterator_sum() {
        let v1 = vec![1, 2, 3];

        let v1_iter = v1.iter();

        let total: i32 = v1_iter.sum();

        assert_eq!(total, 6);
    }
<span class="boring">}</span></code></pre>
<p><span class="caption">Listing 13-13: Gá»i phÆ°Æ¡ng thá»©c <code>sum</code> Ä‘á»ƒ láº¥y tá»•ng
táº¥t cáº£ cÃ¡c pháº§n tá»­ trong iterator</span></p>
<p>ChÃºng ta khÃ´ng Ä‘Æ°á»£c phÃ©p sá»­ dá»¥ng <code>v1_iter</code> sau khi gá»i <code>sum</code> vÃ¬ <code>sum</code>
láº¥y quyá»n sá»Ÿ há»¯u cá»§a iterator mÃ  chÃºng ta gá»i nÃ³ trÃªn Ä‘Ã³.</p>
<h3 id="cÃ¡c-phÆ°Æ¡ng-thá»©c-táº¡o-ra-iterator-khÃ¡c"><a class="header" href="#cÃ¡c-phÆ°Æ¡ng-thá»©c-táº¡o-ra-iterator-khÃ¡c">CÃ¡c phÆ°Æ¡ng thá»©c táº¡o ra iterator khÃ¡c</a></h3>
<p><em>Iterator adaptors</em> lÃ  cÃ¡c phÆ°Æ¡ng thá»©c Ä‘á»‹nh nghÄ©a trÃªn trait <code>Iterator</code>
khÃ´ng tiÃªu thá»¥ iterator. Thay vÃ o Ä‘Ã³, chÃºng táº¡o ra cÃ¡c iterator khÃ¡c
báº±ng cÃ¡ch thay Ä‘á»•i má»™t sá»‘ khÃ­a cáº¡nh cá»§a iterator gá»‘c.</p>
<p>Listing 13-14 minh há»a viá»‡c gá»i phÆ°Æ¡ng thá»©c iterator adaptor <code>map</code>,
nÃ³ nháº­n má»™t closure Ä‘á»ƒ gá»i trÃªn tá»«ng pháº§n tá»­ khi cÃ¡c pháº§n tá»­ Ä‘Æ°á»£c
láº·p qua. PhÆ°Æ¡ng thá»©c <code>map</code> tráº£ vá» má»™t iterator má»›i táº¡o ra cÃ¡c pháº§n
tá»­ Ä‘Ã£ Ä‘Æ°á»£c sá»­a Ä‘á»•i. Closure á»Ÿ Ä‘Ã¢y táº¡o ra má»™t iterator má»›i mÃ  má»—i
pháº§n tá»­ tá»« vector sáº½ Ä‘Æ°á»£c tÄƒng thÃªm 1:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust not_desired_behavior edition2024"><span class="boring">fn main() {
</span>    let v1: Vec&lt;i32&gt; = vec![1, 2, 3];

    v1.iter().map(|x| x + 1);
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 13-14: Gá»i iterator adaptor <code>map</code> Ä‘á»ƒ
táº¡o má»™t iterator má»›i</span></p>
<p>Tuy nhiÃªn, Ä‘oáº¡n code nÃ y sinh ra má»™t cáº£nh bÃ¡o:</p>
<pre><code class="language-console">$ cargo run
   Compiling iterators v0.1.0 (file:///projects/iterators)
warning: unused `Map` that must be used
 --&gt; src/main.rs:4:5
  |
4 |     v1.iter().map(|x| x + 1);
  |     ^^^^^^^^^^^^^^^^^^^^^^^^
  |
  = note: iterators are lazy and do nothing unless consumed
  = note: `#[warn(unused_must_use)]` on by default
help: use `let _ = ...` to ignore the resulting value
  |
4 |     let _ = v1.iter().map(|x| x + 1);
  |     +++++++

warning: `iterators` (bin "iterators") generated 1 warning
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.47s
     Running `target/debug/iterators`
</code></pre>
<p>Äoáº¡n code trong Listing 13-14 khÃ´ng lÃ m gÃ¬ cáº£; closure mÃ  chÃºng
ta Ä‘Ã£ chá»‰ Ä‘á»‹nh chÆ°a bao giá» Ä‘Æ°á»£c gá»i. Cáº£nh bÃ¡o nháº¯c nhá»Ÿ chÃºng
ta lÃ½ do: cÃ¡c iterator adaptors lÃ  lazy, vÃ  chÃºng ta cáº§n tiÃªu
thá»¥ iterator á»Ÿ Ä‘Ã¢y.</p>
<p>Äá»ƒ sá»­a cáº£nh bÃ¡o nÃ y vÃ  tiÃªu thá»¥ iterator, chÃºng ta sáº½ sá»­ dá»¥ng
phÆ°Æ¡ng thá»©c <code>collect</code>, mÃ  chÃºng ta Ä‘Ã£ dÃ¹ng trong ChÆ°Æ¡ng 12 vá»›i
<code>env::args</code> trong Listing 12-1. PhÆ°Æ¡ng thá»©c nÃ y tiÃªu thá»¥ iterator
vÃ  thu tháº­p cÃ¡c giÃ¡ trá»‹ káº¿t quáº£ vÃ o má»™t kiá»ƒu dá»¯ liá»‡u collection.</p>
<p>Trong Listing 13-15, chÃºng ta thu tháº­p káº¿t quáº£ cá»§a viá»‡c láº·p qua
iterator Ä‘Æ°á»£c tráº£ vá» tá»« cuá»™c gá»i <code>map</code> vÃ o má»™t vector. Vector
nÃ y sáº½ chá»©a tá»«ng pháº§n tá»­ tá»« vector gá»‘c tÄƒng thÃªm 1.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {
</span>    let v1: Vec&lt;i32&gt; = vec![1, 2, 3];

    let v2: Vec&lt;_&gt; = v1.iter().map(|x| x + 1).collect();

    assert_eq!(v2, vec![2, 3, 4]);
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 13-15: Gá»i phÆ°Æ¡ng thá»©c <code>map</code> Ä‘á»ƒ táº¡o má»™t
iterator má»›i vÃ  sau Ä‘Ã³ gá»i phÆ°Æ¡ng thá»©c <code>collect</code> Ä‘á»ƒ tiÃªu thá»¥ iterator
má»›i vÃ  táº¡o ra má»™t vector</span></p>
<p>VÃ¬ <code>map</code> nháº­n má»™t closure, chÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh báº¥t ká»³ thao tÃ¡c
nÃ o muá»‘n thá»±c hiá»‡n trÃªn tá»«ng pháº§n tá»­. ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ tuyá»‡t vá»i
vá» cÃ¡ch closures cho phÃ©p báº¡n tÃ¹y chá»‰nh hÃ nh vi trong khi tÃ¡i sá»­ dá»¥ng
hÃ nh vi láº·p mÃ  trait <code>Iterator</code> cung cáº¥p.</p>
<p>Báº¡n cÃ³ thá»ƒ xÃ¢u chuá»—i nhiá»u láº§n gá»i cÃ¡c iterator adaptor Ä‘á»ƒ thá»±c
hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng phá»©c táº¡p má»™t cÃ¡ch dá»… Ä‘á»c. NhÆ°ng vÃ¬ táº¥t cáº£ cÃ¡c
iterator lÃ  lazy, báº¡n pháº£i gá»i má»™t trong cÃ¡c phÆ°Æ¡ng thá»©c consuming
adaptor Ä‘á»ƒ nháº­n káº¿t quáº£ tá»« cÃ¡c cuá»™c gá»i Ä‘áº¿n iterator adaptor.</p>
<h3 id="sá»­-dá»¥ng-closures-capture-environment"><a class="header" href="#sá»­-dá»¥ng-closures-capture-environment">Sá»­ dá»¥ng Closures capture environment</a></h3>
<p>Nhiá»u iterator adaptor nháº­n closures lÃ m tham sá»‘, vÃ  thÆ°á»ng
cÃ¡c closures chÃºng ta chá»‰ Ä‘á»‹nh lÃ m tham sá»‘ cho iterator adaptor
sáº½ lÃ  cÃ¡c closures capture environment cá»§a chÃºng.</p>
<p>Trong vÃ­ dá»¥ nÃ y, chÃºng ta sáº½ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>filter</code> nháº­n
má»™t closure. Closure nháº­n má»™t pháº§n tá»­ tá»« iterator vÃ  tráº£ vá»
<code>bool</code>. Náº¿u closure tráº£ vá» <code>true</code>, giÃ¡ trá»‹ sáº½ Ä‘Æ°á»£c bao gá»“m
trong iteration do <code>filter</code> táº¡o ra. Náº¿u closure tráº£ vá» <code>false</code>,
giÃ¡ trá»‹ sáº½ khÃ´ng Ä‘Æ°á»£c bao gá»“m.</p>
<p>Trong Listing 13-16, chÃºng ta sá»­ dá»¥ng <code>filter</code> vá»›i má»™t closure
capture biáº¿n <code>shoe_size</code> tá»« mÃ´i trÆ°á»ng cá»§a nÃ³ Ä‘á»ƒ láº·p qua
má»™t táº­p há»£p cÃ¡c instance cá»§a struct <code>Shoe</code>. NÃ³ chá»‰ tráº£ vá»
nhá»¯ng Ä‘Ã´i giÃ y cÃ³ kÃ­ch thÆ°á»›c Ä‘Ã£ chá»‰ Ä‘á»‹nh.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">#[derive(PartialEq, Debug)]
struct Shoe {
    size: u32,
    style: String,
}

fn shoes_in_size(shoes: Vec&lt;Shoe&gt;, shoe_size: u32) -&gt; Vec&lt;Shoe&gt; {
    shoes.into_iter().filter(|s| s.size == shoe_size).collect()
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn filters_by_size() {
        let shoes = vec![
            Shoe {
                size: 10,
                style: String::from("sneaker"),
            },
            Shoe {
                size: 13,
                style: String::from("sandal"),
            },
            Shoe {
                size: 10,
                style: String::from("boot"),
            },
        ];

        let in_my_size = shoes_in_size(shoes, 10);

        assert_eq!(
            in_my_size,
            vec![
                Shoe {
                    size: 10,
                    style: String::from("sneaker")
                },
                Shoe {
                    size: 10,
                    style: String::from("boot")
                },
            ]
        );
    }
}</code></pre>
<p><span class="caption">Listing 13-16: Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>filter</code> vá»›i má»™t
closure capture <code>shoe_size</code></span></p>
<p>HÃ m <code>shoes_in_size</code> nháº­n quyá»n sá»Ÿ há»¯u má»™t vector cÃ¡c Ä‘Ã´i giÃ y vÃ  má»™t
kÃ­ch thÆ°á»›c giÃ y lÃ m tham sá»‘. NÃ³ tráº£ vá» má»™t vector chá»‰ chá»©a cÃ¡c Ä‘Ã´i
giÃ y cÃ³ kÃ­ch thÆ°á»›c Ä‘Ã£ chá»‰ Ä‘á»‹nh.</p>
<p>Trong thÃ¢n hÃ m <code>shoes_in_size</code>, chÃºng ta gá»i <code>into_iter</code> Ä‘á»ƒ táº¡o má»™t
iterator láº¥y quyá»n sá»Ÿ há»¯u cá»§a vector. Sau Ä‘Ã³, chÃºng ta gá»i <code>filter</code>
Ä‘á»ƒ biáº¿n Ä‘á»•i iterator Ä‘Ã³ thÃ nh má»™t iterator má»›i chá»‰ chá»©a cÃ¡c pháº§n tá»­
mÃ  closure tráº£ vá» <code>true</code>.</p>
<p>Closure capture tham sá»‘ <code>shoe_size</code> tá»« mÃ´i trÆ°á»ng vÃ  so sÃ¡nh giÃ¡ trá»‹
vá»›i kÃ­ch thÆ°á»›c cá»§a tá»«ng Ä‘Ã´i giÃ y, chá»‰ giá»¯ láº¡i nhá»¯ng Ä‘Ã´i cÃ³ kÃ­ch thÆ°á»›c
Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh. Cuá»‘i cÃ¹ng, gá»i <code>collect</code> thu tháº­p cÃ¡c giÃ¡ trá»‹ tráº£ vá»
tá»« iterator Ä‘Ã£ Ä‘Æ°á»£c biáº¿n Ä‘á»•i vÃ o má»™t vector Ä‘Æ°á»£c hÃ m tráº£ vá».</p>
<p>BÃ i test cho tháº¥y khi gá»i <code>shoes_in_size</code>, chÃºng ta chá»‰ nháº­n láº¡i
nhá»¯ng Ä‘Ã´i giÃ y cÃ³ cÃ¹ng kÃ­ch thÆ°á»›c vá»›i giÃ¡ trá»‹ Ä‘Ã£ chá»‰ Ä‘á»‹nh.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="cáº£i-thiá»‡n-dá»±-Ã¡n-io-cá»§a-chÃºng-ta"><a class="header" href="#cáº£i-thiá»‡n-dá»±-Ã¡n-io-cá»§a-chÃºng-ta">Cáº£i thiá»‡n Dá»± Ã¡n I/O cá»§a ChÃºng ta</a></h2>
<p>Vá»›i kiáº¿n thá»©c má»›i vá» iterators, chÃºng ta cÃ³ thá»ƒ cáº£i thiá»‡n dá»± Ã¡n I/O
trong ChÆ°Æ¡ng 12 báº±ng cÃ¡ch sá»­ dá»¥ng iterators Ä‘á»ƒ lÃ m cho cÃ¡c chá»— trong
code rÃµ rÃ ng vÃ  ngáº¯n gá»n hÆ¡n. HÃ£y xem cÃ¡ch iterators cÃ³ thá»ƒ cáº£i thiá»‡n
cÃ¡ch triá»ƒn khai hÃ m <code>Config::build</code> vÃ  hÃ m <code>search</code>.</p>
<h3 id="loáº¡i-bá»-viá»‡c-clone-báº±ng-iterator"><a class="header" href="#loáº¡i-bá»-viá»‡c-clone-báº±ng-iterator">Loáº¡i bá» viá»‡c <code>clone</code> báº±ng Iterator</a></h3>
<p>Trong Listing 12-6, chÃºng ta Ä‘Ã£ thÃªm code láº¥y má»™t slice cá»§a cÃ¡c giÃ¡ trá»‹
<code>String</code> vÃ  táº¡o má»™t instance cá»§a struct <code>Config</code> báº±ng cÃ¡ch index vÃ o
slice vÃ  clone cÃ¡c giÃ¡ trá»‹, cho phÃ©p struct <code>Config</code> sá»Ÿ há»¯u cÃ¡c giÃ¡ trá»‹
nÃ y. Trong Listing 13-17, chÃºng ta Ä‘Ã£ tÃ¡i hiá»‡n cÃ¡ch triá»ƒn khai hÃ m
<code>Config::build</code> nhÆ° trong Listing 12-23:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.contains(query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub fn search_case_insensitive&lt;'a&gt;(
</span><span class="boring">    query: &amp;str,
</span><span class="boring">    contents: &amp;'a str,
</span><span class="boring">) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let query = query.to_lowercase();
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.to_lowercase().contains(&amp;query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_sensitive() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Duct tape.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_insensitive() {
</span><span class="boring">        let query = "rUsT";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Trust me.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(
</span><span class="boring">            vec!["Rust:", "Trust me."],
</span><span class="boring">            search_case_insensitive(query, contents)
</span><span class="boring">        );
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 13-17: TÃ¡i hiá»‡n hÃ m <code>Config::build</code>
tá»« Listing 12-23</span></p>
<p>LÃºc Ä‘Ã³, chÃºng ta nÃ³i khÃ´ng cáº§n lo láº¯ng vá» cÃ¡c láº§n gá»i <code>clone</code> kÃ©m hiá»‡u
quáº£ vÃ¬ sáº½ loáº¡i bá» chÃºng trong tÆ°Æ¡ng lai. Giá» thÃ¬ thá»i Ä‘iá»ƒm Ä‘Ã³ Ä‘Ã£ Ä‘áº¿n!</p>
<p>ChÃºng ta cáº§n <code>clone</code> á»Ÿ Ä‘Ã¢y vÃ¬ chÃºng ta cÃ³ má»™t slice vá»›i cÃ¡c pháº§n tá»­
<code>String</code> trong tham sá»‘ <code>args</code>, nhÆ°ng hÃ m <code>build</code> khÃ´ng sá»Ÿ há»¯u <code>args</code>.
Äá»ƒ tráº£ quyá»n sá»Ÿ há»¯u má»™t instance cá»§a <code>Config</code>, chÃºng ta pháº£i clone
cÃ¡c giÃ¡ trá»‹ tá»« cÃ¡c trÆ°á»ng <code>query</code> vÃ  <code>filename</code> cá»§a <code>Config</code> Ä‘á»ƒ
instance <code>Config</code> cÃ³ thá»ƒ sá»Ÿ há»¯u cÃ¡c giÃ¡ trá»‹ cá»§a nÃ³.</p>
<p>Vá»›i kiáº¿n thá»©c má»›i vá» iterators, chÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i hÃ m <code>build</code>
Ä‘á»ƒ nháº­n quyá»n sá»Ÿ há»¯u cá»§a má»™t iterator lÃ m tham sá»‘ thay vÃ¬ mÆ°á»£n má»™t slice.
ChÃºng ta sáº½ dÃ¹ng chá»©c nÄƒng cá»§a iterator thay vÃ¬ code kiá»ƒm tra Ä‘á»™ dÃ i
slice vÃ  index vÃ o cÃ¡c vá»‹ trÃ­ cá»¥ thá»ƒ. Äiá»u nÃ y sáº½ lÃ m rÃµ viá»‡c
hÃ m <code>Config::build</code> Ä‘ang lÃ m gÃ¬ vÃ¬ iterator sáº½ truy cáº­p cÃ¡c giÃ¡ trá»‹.</p>
<p>Khi <code>Config::build</code> nháº­n quyá»n sá»Ÿ há»¯u iterator vÃ  ngá»«ng dÃ¹ng cÃ¡c
phÃ©p toÃ¡n indexing mÆ°á»£n, chÃºng ta cÃ³ thá»ƒ di chuyá»ƒn cÃ¡c giÃ¡ trá»‹ <code>String</code>
tá»« iterator vÃ o <code>Config</code> thay vÃ¬ gá»i <code>clone</code> vÃ  táº¡o má»™t cáº¥p phÃ¡t má»›i.</p>
<h4 id="sá»­-dá»¥ng-iterator-tráº£-vá»-trá»±c-tiáº¿p"><a class="header" href="#sá»­-dá»¥ng-iterator-tráº£-vá»-trá»±c-tiáº¿p">Sá»­ dá»¥ng Iterator tráº£ vá» trá»±c tiáº¿p</a></h4>
<p>Má»Ÿ file <em>src/main.rs</em> cá»§a dá»± Ã¡n I/O cá»§a báº¡n, file nÃ y sáº½ trÃ´ng nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::error::Error;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span><span class="boring">
</span><span class="boring">use minigrep::{search, search_case_insensitive};
</span><span class="boring">
</span>fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let config = Config::build(&amp;args).unwrap_or_else(|err| {
        eprintln!("Problem parsing arguments: {err}");
        process::exit(1);
    });

    // --snip--
<span class="boring">
</span><span class="boring">    if let Err(e) = run(config) {
</span><span class="boring">        eprintln!("Application error: {e}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    }
</span>}
<span class="boring">
</span><span class="boring">pub struct Config {
</span><span class="boring">    pub query: String,
</span><span class="boring">    pub file_path: String,
</span><span class="boring">    pub ignore_case: bool,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        let ignore_case = env::var("IGNORE_CASE").is_ok();
</span><span class="boring">
</span><span class="boring">        Ok(Config {
</span><span class="boring">            query,
</span><span class="boring">            file_path,
</span><span class="boring">            ignore_case,
</span><span class="boring">        })
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)?;
</span><span class="boring">
</span><span class="boring">    let results = if config.ignore_case {
</span><span class="boring">        search_case_insensitive(&amp;config.query, &amp;contents)
</span><span class="boring">    } else {
</span><span class="boring">        search(&amp;config.query, &amp;contents)
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    for line in results {
</span><span class="boring">        println!("{line}");
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    Ok(())
</span><span class="boring">}</span></code></pre>
<p>ChÃºng ta sáº½ báº¯t Ä‘áº§u báº±ng cÃ¡ch thay Ä‘á»•i pháº§n Ä‘áº§u cá»§a hÃ m <code>main</code>
mÃ  chÃºng ta cÃ³ trong Listing 12-24 thÃ nh code trong Listing 13-18,
láº§n nÃ y sá»­ dá»¥ng iterator. Code nÃ y sáº½ chÆ°a biÃªn dá»‹ch Ä‘Æ°á»£c cho Ä‘áº¿n
khi chÃºng ta cáº­p nháº­t hÃ m <code>Config::build</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">use std::env;
</span><span class="boring">use std::error::Error;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span><span class="boring">
</span><span class="boring">use minigrep::{search, search_case_insensitive};
</span><span class="boring">
</span>fn main() {
    let config = Config::build(env::args()).unwrap_or_else(|err| {
        eprintln!("Problem parsing arguments: {err}");
        process::exit(1);
    });

    // --snip--
<span class="boring">
</span><span class="boring">    if let Err(e) = run(config) {
</span><span class="boring">        eprintln!("Application error: {e}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    }
</span>}
<span class="boring">
</span><span class="boring">pub struct Config {
</span><span class="boring">    pub query: String,
</span><span class="boring">    pub file_path: String,
</span><span class="boring">    pub ignore_case: bool,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        let ignore_case = env::var("IGNORE_CASE").is_ok();
</span><span class="boring">
</span><span class="boring">        Ok(Config {
</span><span class="boring">            query,
</span><span class="boring">            file_path,
</span><span class="boring">            ignore_case,
</span><span class="boring">        })
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)?;
</span><span class="boring">
</span><span class="boring">    let results = if config.ignore_case {
</span><span class="boring">        search_case_insensitive(&amp;config.query, &amp;contents)
</span><span class="boring">    } else {
</span><span class="boring">        search(&amp;config.query, &amp;contents)
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    for line in results {
</span><span class="boring">        println!("{line}");
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    Ok(())
</span><span class="boring">}</span></code></pre>
<p>HÃ m <code>env::args</code> tráº£ vá» má»™t iterator! Thay vÃ¬ thu tháº­p cÃ¡c giÃ¡ trá»‹
cá»§a iterator vÃ o má»™t vector rá»“i truyá»n má»™t slice vÃ o <code>Config::build</code>,
bÃ¢y giá» chÃºng ta truyá»n quyá»n sá»Ÿ há»¯u cá»§a iterator tráº£ vá» tá»« <code>env::args</code>
trá»±c tiáº¿p vÃ o <code>Config::build</code>.</p>
<p>Tiáº¿p theo, chÃºng ta cáº§n cáº­p nháº­t Ä‘á»‹nh nghÄ©a cá»§a <code>Config::build</code>.
Trong file <em>src/lib.rs</em> cá»§a dá»± Ã¡n I/O, hÃ£y thay Ä‘á»•i chá»¯ kÃ½ cá»§a
<code>Config::build</code> nhÆ° trong Listing 13-19. Code nÃ y váº«n chÆ°a biÃªn dá»‹ch Ä‘Æ°á»£c
vÃ¬ chÃºng ta cáº§n cáº­p nháº­t pháº§n thÃ¢n hÃ m.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.contains(query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub fn search_case_insensitive&lt;'a&gt;(
</span><span class="boring">    query: &amp;str,
</span><span class="boring">    contents: &amp;'a str,
</span><span class="boring">) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let query = query.to_lowercase();
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.to_lowercase().contains(&amp;query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_sensitive() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Duct tape.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_insensitive() {
</span><span class="boring">        let query = "rUsT";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Trust me.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(
</span><span class="boring">            vec!["Rust:", "Trust me."],
</span><span class="boring">            search_case_insensitive(query, contents)
</span><span class="boring">        );
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>TÃ i liá»‡u cá»§a thÆ° viá»‡n chuáº©n cho hÃ m <code>env::args</code> cho tháº¥y kiá»ƒu cá»§a
iterator mÃ  nÃ³ tráº£ vá» lÃ  <code>std::env::Args</code>, vÃ  kiá»ƒu nÃ y triá»ƒn khai
trait <code>Iterator</code> vÃ  tráº£ vá» cÃ¡c giÃ¡ trá»‹ <code>String</code>.</p>
<p>ChÃºng ta Ä‘Ã£ cáº­p nháº­t chá»¯ kÃ½ cá»§a hÃ m <code>Config::build</code> sao cho tham sá»‘
<code>args</code> cÃ³ kiá»ƒu tá»•ng quÃ¡t vá»›i rÃ ng buá»™c trait
<code>impl Iterator&lt;Item = String&gt;</code> thay vÃ¬ <code>&amp;[String]</code>. CÃ¡ch sá»­ dá»¥ng
cÃº phÃ¡p <code>impl Trait</code> mÃ  chÃºng ta Ä‘Ã£ tháº£o luáº­n trong pháº§n
<a href="ch10-02-traits.html#traits-as-parameters">â€œTraits as Parametersâ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 10
cÃ³ nghÄ©a lÃ  <code>args</code> cÃ³ thá»ƒ lÃ  báº¥t ká»³ kiá»ƒu nÃ o triá»ƒn khai trait <code>Iterator</code>
vÃ  tráº£ vá» cÃ¡c pháº§n tá»­ kiá»ƒu <code>String</code>.</p>
<p>VÃ¬ chÃºng ta Ä‘ang nháº­n quyá»n sá»Ÿ há»¯u <code>args</code> vÃ  sáº½ thay Ä‘á»•i <code>args</code> báº±ng
cÃ¡ch láº·p qua nÃ³, chÃºng ta cÃ³ thá»ƒ thÃªm tá»« khÃ³a <code>mut</code> vÃ o khai bÃ¡o
tham sá»‘ <code>args</code> Ä‘á»ƒ lÃ m nÃ³ cÃ³ thá»ƒ thay Ä‘á»•i Ä‘Æ°á»£c.</p>
<h4 id="sá»­-dá»¥ng-cÃ¡c-phÆ°Æ¡ng-thá»©c-cá»§a-trait-iterator-thay-vÃ¬-Ä‘Ã¡nh-chá»‰-sá»‘"><a class="header" href="#sá»­-dá»¥ng-cÃ¡c-phÆ°Æ¡ng-thá»©c-cá»§a-trait-iterator-thay-vÃ¬-Ä‘Ã¡nh-chá»‰-sá»‘">Sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c cá»§a trait <code>Iterator</code> thay vÃ¬ Ä‘Ã¡nh chá»‰ sá»‘</a></h4>
<p>Tiáº¿p theo, chÃºng ta sáº½ sá»­a pháº§n thÃ¢n cá»§a <code>Config::build</code>. VÃ¬ <code>args</code>
triá»ƒn khai trait <code>Iterator</code>, chÃºng ta biáº¿t cÃ³ thá»ƒ gá»i phÆ°Æ¡ng thá»©c
<code>next</code> trÃªn nÃ³! Listing 13-20 cáº­p nháº­t code tá»« Listing 12-23
sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>next</code>:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.contains(query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub fn search_case_insensitive&lt;'a&gt;(
</span><span class="boring">    query: &amp;str,
</span><span class="boring">    contents: &amp;'a str,
</span><span class="boring">) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let query = query.to_lowercase();
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.to_lowercase().contains(&amp;query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_sensitive() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Duct tape.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_insensitive() {
</span><span class="boring">        let query = "rUsT";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Trust me.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(
</span><span class="boring">            vec!["Rust:", "Trust me."],
</span><span class="boring">            search_case_insensitive(query, contents)
</span><span class="boring">        );
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Nhá»› ráº±ng giÃ¡ trá»‹ Ä‘áº§u tiÃªn trong giÃ¡ trá»‹ tráº£ vá» cá»§a <code>env::args</code> lÃ  tÃªn
chÆ°Æ¡ng trÃ¬nh. ChÃºng ta muá»‘n bá» qua giÃ¡ trá»‹ nÃ y vÃ  láº¥y giÃ¡ trá»‹ tiáº¿p theo,
vÃ¬ váº­y trÆ°á»›c tiÃªn chÃºng ta gá»i <code>next</code> nhÆ°ng khÃ´ng lÃ m gÃ¬ vá»›i giÃ¡ trá»‹ tráº£ vá».
Tiáº¿p theo, chÃºng ta gá»i <code>next</code> Ä‘á»ƒ láº¥y giÃ¡ trá»‹ mÃ  chÃºng ta muá»‘n gÃ¡n vÃ o
trÆ°á»ng <code>query</code> cá»§a <code>Config</code>. Náº¿u <code>next</code> tráº£ vá» <code>Some</code>, chÃºng ta dÃ¹ng
<code>match</code> Ä‘á»ƒ láº¥y giÃ¡ trá»‹. Náº¿u tráº£ vá» <code>None</code>, nghÄ©a lÃ  khÃ´ng Ä‘á»§ tham sá»‘,
vÃ  chÃºng ta tráº£ vá» sá»›m vá»›i giÃ¡ trá»‹ <code>Err</code>. ChÃºng ta lÃ m tÆ°Æ¡ng tá»± cho giÃ¡
trá»‹ <code>filename</code>.</p>
<h3 id="lÃ m-code-rÃµ-rÃ ng-hÆ¡n-vá»›i-cÃ¡c-iterator-adaptor"><a class="header" href="#lÃ m-code-rÃµ-rÃ ng-hÆ¡n-vá»›i-cÃ¡c-iterator-adaptor">LÃ m code rÃµ rÃ ng hÆ¡n vá»›i cÃ¡c iterator adaptor</a></h3>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ táº­n dá»¥ng iterator trong hÃ m <code>search</code> cá»§a dá»± Ã¡n
I/O, Ä‘Æ°á»£c tÃ¡i hiá»‡n á»Ÿ Ä‘Ã¢y trong Listing 13-21 nhÆ° trong Listing 12-19:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    let mut results = Vec::new();

    for line in contents.lines() {
        if line.contains(query) {
            results.push(line);
        }
    }

    results
}
<span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn one_result() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>ChÃºng ta cÃ³ thá»ƒ viáº¿t Ä‘oáº¡n code nÃ y má»™t cÃ¡ch ngáº¯n gá»n hÆ¡n báº±ng cÃ¡ch dÃ¹ng
cÃ¡c phÆ°Æ¡ng thá»©c iterator adaptor. CÃ¡ch lÃ m nÃ y cÅ©ng giÃºp chÃºng ta trÃ¡nh
pháº£i táº¡o má»™t vector <code>results</code> trung gian cÃ³ thá»ƒ thay Ä‘á»•i. Phong cÃ¡ch láº­p
trÃ¬nh hÃ m hÆ°á»›ng (functional programming) Æ°u tiÃªn giáº£m thiá»ƒu tráº¡ng thÃ¡i
cÃ³ thá»ƒ thay Ä‘á»•i Ä‘á»ƒ lÃ m code rÃµ rÃ ng hÆ¡n. Viá»‡c loáº¡i bá» tráº¡ng thÃ¡i cÃ³ thá»ƒ
thay Ä‘á»•i cÅ©ng cÃ³ thá»ƒ cho phÃ©p nÃ¢ng cáº¥p trong tÆ°Æ¡ng lai Ä‘á»ƒ thá»±c hiá»‡n
tÃ¬m kiáº¿m song song, vÃ¬ chÃºng ta sáº½ khÃ´ng pháº£i quáº£n lÃ½ truy cáº­p Ä‘á»“ng
thá»i Ä‘áº¿n vector <code>results</code>. Listing 13-22 minh há»a thay Ä‘á»•i nÃ y:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    contents
        .lines()
        .filter(|line| line.contains(query))
        .collect()
}
<span class="boring">
</span><span class="boring">pub fn search_case_insensitive&lt;'a&gt;(
</span><span class="boring">    query: &amp;str,
</span><span class="boring">    contents: &amp;'a str,
</span><span class="boring">) -&gt; Vec&lt;&amp;'a str&gt; {
</span><span class="boring">    let query = query.to_lowercase();
</span><span class="boring">    let mut results = Vec::new();
</span><span class="boring">
</span><span class="boring">    for line in contents.lines() {
</span><span class="boring">        if line.to_lowercase().contains(&amp;query) {
</span><span class="boring">            results.push(line);
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    results
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_sensitive() {
</span><span class="boring">        let query = "duct";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Duct tape.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(vec!["safe, fast, productive."], search(query, contents));
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn case_insensitive() {
</span><span class="boring">        let query = "rUsT";
</span><span class="boring">        let contents = "\
</span><span class="boring">Rust:
</span><span class="boring">safe, fast, productive.
</span><span class="boring">Pick three.
</span><span class="boring">Trust me.";
</span><span class="boring">
</span><span class="boring">        assert_eq!(
</span><span class="boring">            vec!["Rust:", "Trust me."],
</span><span class="boring">            search_case_insensitive(query, contents)
</span><span class="boring">        );
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>HÃ£y nhá»› ráº±ng má»¥c Ä‘Ã­ch cá»§a hÃ m <code>search</code> lÃ  tráº£ vá» táº¥t cáº£ cÃ¡c dÃ²ng trong
<code>contents</code> chá»©a <code>query</code>. TÆ°Æ¡ng tá»± nhÆ° vÃ­ dá»¥ <code>filter</code> trong Listing 13-16,
Ä‘oáº¡n code nÃ y sá»­ dá»¥ng adaptor <code>filter</code> Ä‘á»ƒ giá»¯ láº¡i chá»‰ nhá»¯ng dÃ²ng mÃ 
<code>line.contains(query)</code> tráº£ vá» <code>true</code>. Sau Ä‘Ã³, chÃºng ta thu tháº­p cÃ¡c dÃ²ng
phÃ¹ há»£p vÃ o má»™t vector khÃ¡c báº±ng <code>collect</code>. ÄÆ¡n giáº£n hÆ¡n nhiá»u! Báº¡n cÃ³
thá»ƒ thá»±c hiá»‡n thay Ä‘á»•i tÆ°Æ¡ng tá»± Ä‘á»ƒ dÃ¹ng phÆ°Æ¡ng thá»©c iterator trong hÃ m
<code>search_case_insensitive</code>.</p>
<h3 id="chá»n-giá»¯a-vÃ²ng-láº·p-vÃ -iterator"><a class="header" href="#chá»n-giá»¯a-vÃ²ng-láº·p-vÃ -iterator">Chá»n giá»¯a vÃ²ng láº·p vÃ  iterator</a></h3>
<p>CÃ¢u há»i tiáº¿p theo lÃ  nÃªn chá»n phong cÃ¡ch nÃ o trong code cá»§a báº¡n vÃ  táº¡i sao:
cÃ i Ä‘áº·t ban Ä‘áº§u trong Listing 13-21 hay phiÃªn báº£n dÃ¹ng iterator trong Listing 13-22.
Háº§u háº¿t láº­p trÃ¬nh viÃªn Rust thÃ­ch dÃ¹ng phong cÃ¡ch iterator. Ban Ä‘áº§u cÃ³ thá»ƒ
khÃ³ lÃ m quen, nhÆ°ng khi báº¡n hiá»ƒu cÃ¡c iterator adaptor vÃ  chá»©c nÄƒng cá»§a chÃºng,
iterator thÆ°á»ng dá»… hiá»ƒu hÆ¡n. Thay vÃ¬ loay hoay vá»›i cÃ¡c vÃ²ng láº·p vÃ  táº¡o
vector má»›i, code táº­p trung vÃ o má»¥c tiÃªu cao cáº¥p cá»§a vÃ²ng láº·p. Äiá»u nÃ y
trá»«u tÆ°á»£ng hÃ³a má»™t pháº§n code thÃ´ng thÆ°á»ng, giÃºp dá»… nhÃ¬n tháº¥y cÃ¡c khÃ¡i niá»‡m
Ä‘áº·c trÆ°ng cho Ä‘oáº¡n code nÃ y, nhÆ° Ä‘iá»u kiá»‡n lá»c mÃ  má»—i pháº§n tá»­ trong iterator
pháº£i thá»a mÃ£n.</p>
<p>NhÆ°ng liá»‡u hai cÃ i Ä‘áº·t nÃ y cÃ³ thá»±c sá»± tÆ°Æ¡ng Ä‘Æ°Æ¡ng? Giáº£ Ä‘á»‹nh trá»±c quan
cÃ³ thá»ƒ lÃ  vÃ²ng láº·p má»©c tháº¥p sáº½ nhanh hÆ¡n. HÃ£y nÃ³i vá» hiá»‡u nÄƒng.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="so-sÃ¡nh-hiá»‡u-nÄƒng-vÃ²ng-láº·p-vs-iterator"><a class="header" href="#so-sÃ¡nh-hiá»‡u-nÄƒng-vÃ²ng-láº·p-vs-iterator">So sÃ¡nh hiá»‡u nÄƒng: VÃ²ng láº·p vs. Iterator</a></h2>
<p>Äá»ƒ quyáº¿t Ä‘á»‹nh nÃªn dÃ¹ng vÃ²ng láº·p hay iterator, báº¡n cáº§n biáº¿t phiÃªn báº£n nÃ o
nhanh hÆ¡n: phiÃªn báº£n hÃ m <code>search</code> dÃ¹ng vÃ²ng láº·p <code>for</code> rÃµ rÃ ng hay phiÃªn báº£n
dÃ¹ng iterator.</p>
<p>ChÃºng tÃ´i Ä‘Ã£ cháº¡y benchmark báº±ng cÃ¡ch táº£i toÃ n bá»™ ná»™i dung <em>The Adventures of
Sherlock Holmes</em> cá»§a Sir Arthur Conan Doyle vÃ o má»™t <code>String</code> vÃ  tÃ¬m tá»« <em>the</em>
trong ná»™i dung. DÆ°á»›i Ä‘Ã¢y lÃ  káº¿t quáº£ benchmark cho phiÃªn báº£n <code>search</code> dÃ¹ng
vÃ²ng láº·p <code>for</code> vÃ  phiÃªn báº£n dÃ¹ng iterator:</p>
<pre><code class="language-text">test bench_search_for  ... bench:  19,620,300 ns/iter (+/- 915,700)
test bench_search_iter ... bench:  19,234,900 ns/iter (+/- 657,200)
</code></pre>
<p>PhiÃªn báº£n dÃ¹ng iterator nhanh hÆ¡n má»™t chÃºt! ChÃºng tÃ´i sáº½ khÃ´ng giáº£i thÃ­ch chi tiáº¿t mÃ£ benchmark á»Ÿ Ä‘Ã¢y, vÃ¬ má»¥c Ä‘Ã­ch khÃ´ng pháº£i lÃ  chá»©ng minh hai phiÃªn báº£n hoÃ n toÃ n tÆ°Æ¡ng Ä‘Æ°Æ¡ng, mÃ  chá»‰ Ä‘á»ƒ cÃ³ cÃ¡i nhÃ¬n tá»•ng quan vá» hiá»‡u nÄƒng cá»§a hai cÃ¡ch triá»ƒn khai nÃ y.</p>
<p>Äá»ƒ benchmark toÃ n diá»‡n hÆ¡n, báº¡n nÃªn thá»­ vá»›i nhiá»u loáº¡i vÄƒn báº£n cÃ³ kÃ­ch thÆ°á»›c khÃ¡c nhau lÃ m <code>contents</code>, cÃ¡c tá»« khÃ¡c nhau vá»›i Ä‘á»™ dÃ i khÃ¡c nhau lÃ m <code>query</code>, vÃ  nhiá»u biáº¿n thá»ƒ khÃ¡c. Ã chÃ­nh lÃ : iterator, máº·c dÃ¹ lÃ  má»™t trá»«u tÆ°á»£ng cao cáº¥p, Ä‘Æ°á»£c biÃªn dá»‹ch xuá»‘ng gáº§n nhÆ° cÃ¹ng má»™t mÃ£ mÃ¡y nhÆ° náº¿u báº¡n tá»± viáº¿t mÃ£ cáº¥p tháº¥p. Iterator lÃ  má»™t trong nhá»¯ng <em>zero-cost abstractions</em> cá»§a Rust, nghÄ©a lÃ  sá»­ dá»¥ng trá»«u tÆ°á»£ng nÃ y khÃ´ng gÃ¢y thÃªm chi phÃ­ runtime. Äiá»u nÃ y tÆ°Æ¡ng tá»± cÃ¡ch Bjarne Stroustrup, nhÃ  thiáº¿t káº¿ vÃ  hiá»‡n thá»±c C++ gá»‘c, Ä‘á»‹nh nghÄ©a <em>zero-overhead</em> trong â€œFoundations of C++â€ (2012):</p>
<blockquote>
<p>In general, C++ implementations obey the zero-overhead principle: What you
donâ€™t use, you donâ€™t pay for. And further: What you do use, you couldnâ€™t hand
code any better.</p>
</blockquote>
<p>Má»™t vÃ­ dá»¥ khÃ¡c, Ä‘oáº¡n mÃ£ sau láº¥y tá»« má»™t bá»™ giáº£i mÃ£ audio. Thuáº­t toÃ¡n giáº£i mÃ£ sá»­ dá»¥ng phÃ©p toÃ¡n dá»± Ä‘oÃ¡n tuyáº¿n tÃ­nh Ä‘á»ƒ Æ°á»›c lÆ°á»£ng cÃ¡c giÃ¡ trá»‹ tÆ°Æ¡ng lai dá»±a trÃªn hÃ m tuyáº¿n tÃ­nh cá»§a cÃ¡c máº«u trÆ°á»›c Ä‘Ã³. Äoáº¡n mÃ£ nÃ y sá»­ dá»¥ng chuá»—i iterator Ä‘á»ƒ tÃ­nh toÃ¡n trÃªn ba biáº¿n trong pháº¡m vi: má»™t slice <code>buffer</code> chá»©a dá»¯ liá»‡u, má»™t máº£ng 12 pháº§n tá»­ <code>coefficients</code>, vÃ  má»™t lÆ°á»£ng dá»‹ch dá»¯ liá»‡u trong <code>qlp_shift</code>. ChÃºng tÃ´i Ä‘Ã£ khai bÃ¡o cÃ¡c biáº¿n trong vÃ­ dá»¥ nÃ y nhÆ°ng khÃ´ng gÃ¡n giÃ¡ trá»‹; máº·c dÃ¹ mÃ£ nÃ y khÃ´ng cÃ³ nhiá»u Ã½ nghÄ©a ngoÃ i ngá»¯ cáº£nh cá»§a nÃ³, nÃ³ váº«n lÃ  má»™t vÃ­ dá»¥ thá»±c táº¿, cÃ´ Ä‘á»ng vá» cÃ¡ch Rust chuyá»ƒn cÃ¡c Ã½ tÆ°á»Ÿng cao cáº¥p xuá»‘ng mÃ£ cáº¥p tháº¥p.</p>
<pre><code class="language-rust ignore">let buffer: &amp;mut [i32];
let coefficients: [i64; 12];
let qlp_shift: i16;

for i in 12..buffer.len() {
    let prediction = coefficients.iter()
                                 .zip(&amp;buffer[i - 12..i])
                                 .map(|(&amp;c, &amp;s)| c * s as i64)
                                 .sum::&lt;i64&gt;() &gt;&gt; qlp_shift;
    let delta = buffer[i];
    buffer[i] = prediction as i32 + delta;
}</code></pre>
<p>Äá»ƒ tÃ­nh giÃ¡ trá»‹ cá»§a <code>prediction</code>, Ä‘oáº¡n mÃ£ nÃ y láº·p qua tá»«ng giÃ¡ trá»‹ trong 12 pháº§n tá»­ cá»§a <code>coefficients</code> vÃ  sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>zip</code> Ä‘á»ƒ ghÃ©p cÃ¡c giÃ¡ trá»‹ há»‡ sá»‘ vá»›i 12 giÃ¡ trá»‹ trÆ°á»›c Ä‘Ã³ trong <code>buffer</code>. Sau Ä‘Ã³, vá»›i má»—i cáº·p, chÃºng ta nhÃ¢n cÃ¡c giÃ¡ trá»‹ vá»›i nhau, cá»™ng táº¥t cáº£ káº¿t quáº£, vÃ  dá»‹ch cÃ¡c bit trong tá»•ng lÃªn pháº£i <code>qlp_shift</code> bit.</p>
<p>CÃ¡c phÃ©p tÃ­nh trong cÃ¡c á»©ng dá»¥ng nhÆ° bá»™ giáº£i mÃ£ audio thÆ°á»ng Æ°u tiÃªn hiá»‡u nÄƒng hÃ ng Ä‘áº§u. á» Ä‘Ã¢y, chÃºng ta táº¡o má»™t iterator, sá»­ dá»¥ng hai adaptor, vÃ  sau Ä‘Ã³ tiÃªu thá»¥ giÃ¡ trá»‹. MÃ£ assembly mÃ  Rust biÃªn dá»‹ch ra tá»« Ä‘oáº¡n mÃ£ nÃ y sáº½ nhÆ° tháº¿ nÃ o? TÃ­nh Ä‘áº¿n thá»i Ä‘iá»ƒm hiá»‡n táº¡i, nÃ³ Ä‘Æ°á»£c biÃªn dá»‹ch xuá»‘ng cÃ¹ng mÃ£ assembly mÃ  báº¡n cÃ³ thá»ƒ viáº¿t tay. KhÃ´ng há» cÃ³ vÃ²ng láº·p tÆ°Æ¡ng á»©ng vá»›i viá»‡c láº·p qua cÃ¡c giÃ¡ trá»‹ trong <code>coefficients</code>: Rust biáº¿t cÃ³ 12 láº§n láº·p, nÃªn nÃ³ <em>â€œunrollâ€</em> vÃ²ng láº·p. <em>Unrolling</em> lÃ  má»™t tá»‘i Æ°u loáº¡i bá» chi phÃ­ overhead cá»§a mÃ£ Ä‘iá»u khiá»ƒn vÃ²ng láº·p vÃ  thay vÃ o Ä‘Ã³ táº¡o mÃ£ láº·p láº¡i cho tá»«ng láº§n láº·p.</p>
<p>Táº¥t cáº£ cÃ¡c há»‡ sá»‘ Ä‘Æ°á»£c lÆ°u trong cÃ¡c thanh ghi, nghÄ©a lÃ  truy cáº­p giÃ¡ trá»‹ ráº¥t nhanh. KhÃ´ng cÃ³ kiá»ƒm tra ranh giá»›i máº£ng táº¡i runtime. Táº¥t cáº£ cÃ¡c tá»‘i Æ°u hÃ³a mÃ  Rust Ã¡p dá»¥ng giÃºp mÃ£ káº¿t quáº£ cá»±c ká»³ hiá»‡u quáº£. BÃ¢y giá» báº¡n Ä‘Ã£ hiá»ƒu Ä‘iá»u nÃ y, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng iterators vÃ  closures mÃ  khÃ´ng lo láº¯ng! ChÃºng khiáº¿n mÃ£ trÃ´ng cao cáº¥p hÆ¡n nhÆ°ng khÃ´ng gÃ¢y ra báº¥t ká»³ pháº¡t hiá»‡u nÄƒng nÃ o táº¡i runtime.</p>
<h2 id="tÃ³m-táº¯t-3"><a class="header" href="#tÃ³m-táº¯t-3">TÃ³m táº¯t</a></h2>
<p>Closures vÃ  iterators lÃ  cÃ¡c tÃ­nh nÄƒng cá»§a Rust Ä‘Æ°á»£c láº¥y cáº£m há»©ng tá»« cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh hÃ m. ChÃºng giÃºp Rust thá»ƒ hiá»‡n rÃµ rÃ ng cÃ¡c Ã½ tÆ°á»Ÿng cao cáº¥p vá»›i hiá»‡u nÄƒng cáº¥p tháº¥p. CÃ¡ch triá»ƒn khai closures vÃ  iterators Ä‘Æ°á»£c thiáº¿t káº¿ sao cho hiá»‡u nÄƒng runtime khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng. ÄÃ¢y lÃ  má»™t pháº§n trong má»¥c tiÃªu cá»§a Rust nháº±m cung cáº¥p cÃ¡c <em>zero-cost abstractions</em>.</p>
<p>BÃ¢y giá», sau khi chÃºng ta Ä‘Ã£ cáº£i thiá»‡n kháº£ nÄƒng biá»ƒu Ä‘áº¡t trong dá»± Ã¡n I/O, hÃ£y cÃ¹ng xem má»™t sá»‘ tÃ­nh nÄƒng khÃ¡c cá»§a <code>cargo</code> sáº½ giÃºp chÃºng ta chia sáº» dá»± Ã¡n vá»›i tháº¿ giá»›i.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="thÃªm-vá»-cargo-vÃ -cratesio"><a class="header" href="#thÃªm-vá»-cargo-vÃ -cratesio">ThÃªm Vá» Cargo vÃ  Crates.io</a></h1>
<p>Cho Ä‘áº¿n nay, chÃºng ta chá»‰ sá»­ dá»¥ng nhá»¯ng tÃ­nh nÄƒng cÆ¡ báº£n nháº¥t cá»§a Cargo Ä‘á»ƒ build, cháº¡y vÃ  test mÃ£ cá»§a mÃ¬nh, nhÆ°ng nÃ³ cÃ²n lÃ m Ä‘Æ°á»£c nhiá»u hÆ¡n tháº¿. Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ tháº£o luáº­n vá» má»™t sá»‘ tÃ­nh nÄƒng nÃ¢ng cao hÆ¡n Ä‘á»ƒ chá»‰ ra cÃ¡ch thá»±c hiá»‡n cÃ¡c viá»‡c sau:</p>
<ul>
<li>TÃ¹y chá»‰nh quÃ¡ trÃ¬nh build thÃ´ng qua cÃ¡c <em>release profiles</em></li>
<li>Xuáº¥t báº£n thÆ° viá»‡n lÃªn <a href="https://crates.io/">crates.io</a><!-- ignore --></li>
<li>Tá»• chá»©c cÃ¡c dá»± Ã¡n lá»›n vá»›i <em>workspaces</em></li>
<li>CÃ i Ä‘áº·t cÃ¡c binary tá»« <a href="https://crates.io/">crates.io</a><!-- ignore --></li>
<li>Má»Ÿ rá»™ng Cargo báº±ng cÃ¡c lá»‡nh tÃ¹y chá»‰nh</li>
</ul>
<p>Cargo cÃ³ thá»ƒ lÃ m nhiá»u hÆ¡n ná»¯a so vá»›i nhá»¯ng gÃ¬ chÃºng ta Ä‘á» cáº­p trong chÆ°Æ¡ng nÃ y, vÃ¬ váº­y Ä‘á»ƒ hiá»ƒu Ä‘áº§y Ä‘á»§ táº¥t cáº£ cÃ¡c tÃ­nh nÄƒng, hÃ£y xem <a href="https://doc.rust-lang.org/cargo/">tÃ i liá»‡u cá»§a nÃ³</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="tÃ¹y-chá»‰nh-build-vá»›i-release-profiles"><a class="header" href="#tÃ¹y-chá»‰nh-build-vá»›i-release-profiles">TÃ¹y Chá»‰nh Build vá»›i Release Profiles</a></h2>
<p>Trong Rust, <em>release profiles</em> lÃ  cÃ¡c profile Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a sáºµn vÃ  cÃ³ thá»ƒ tÃ¹y chá»‰nh vá»›i cÃ¡c cáº¥u hÃ¬nh khÃ¡c nhau, cho phÃ©p láº­p trÃ¬nh viÃªn kiá»ƒm soÃ¡t nhiá»u tÃ¹y chá»n khi biÃªn dá»‹ch mÃ£. Má»—i profile Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»™c láº­p vá»›i cÃ¡c profile khÃ¡c.</p>
<p>Cargo cÃ³ hai profile chÃ­nh: profile <code>dev</code> mÃ  Cargo sá»­ dá»¥ng khi báº¡n cháº¡y <code>cargo build</code> vÃ  profile <code>release</code> mÃ  Cargo sá»­ dá»¥ng khi báº¡n cháº¡y <code>cargo build --release</code>. Profile <code>dev</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a vá»›i cÃ¡c giÃ¡ trá»‹ máº·c Ä‘á»‹nh tá»‘t cho phÃ¡t triá»ƒn, cÃ²n profile <code>release</code> cÃ³ cÃ¡c giÃ¡ trá»‹ máº·c Ä‘á»‹nh tá»‘t cho viá»‡c build khi phÃ¡t hÃ nh.</p>
<p>Nhá»¯ng tÃªn profile nÃ y cÃ³ thá»ƒ quen thuá»™c tá»« káº¿t quáº£ Ä‘áº§u ra cá»§a cÃ¡c láº§n build:</p>
<!-- manual-regeneration
anywhere, run:
cargo build
cargo build --release
and ensure output below is accurate
-->
<pre><code class="language-console">$ cargo build
    Finished dev [unoptimized + debuginfo] target(s) in 0.0s
$ cargo build --release
    Finished release [optimized] target(s) in 0.0s
</code></pre>
<p>Profile <code>dev</code> vÃ  <code>release</code> lÃ  hai profile khÃ¡c nhau mÃ  trÃ¬nh biÃªn dá»‹ch sá»­ dá»¥ng.</p>
<p>Cargo cÃ³ cÃ¡c thiáº¿t láº­p máº·c Ä‘á»‹nh cho má»—i profile, Ã¡p dá»¥ng khi báº¡n chÆ°a thÃªm báº¥t ká»³ pháº§n <code>[profile.*]</code> nÃ o trong file <em>Cargo.toml</em> cá»§a dá»± Ã¡n. Báº±ng cÃ¡ch thÃªm cÃ¡c pháº§n <code>[profile.*]</code> cho báº¥t ká»³ profile nÃ o báº¡n muá»‘n tÃ¹y chá»‰nh, báº¡n sáº½ ghi Ä‘Ã¨ má»™t táº­p há»£p con cá»§a cÃ¡c thiáº¿t láº­p máº·c Ä‘á»‹nh. VÃ­ dá»¥, dÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c giÃ¡ trá»‹ máº·c Ä‘á»‹nh cá»§a thiáº¿t láº­p <code>opt-level</code> cho profile <code>dev</code> vÃ  <code>release</code>:</p>
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">[profile.dev]
opt-level = 0

[profile.release]
opt-level = 3
</code></pre>
<p>Thiáº¿t láº­p <code>opt-level</code> Ä‘iá»u khiá»ƒn sá»‘ lÆ°á»£ng tá»‘i Æ°u hÃ³a mÃ  Rust sáº½ Ã¡p dá»¥ng cho mÃ£ cá»§a báº¡n, vá»›i pháº¡m vi tá»« 0 Ä‘áº¿n 3. Ãp dá»¥ng nhiá»u tá»‘i Æ°u hÃ³a hÆ¡n sáº½ lÃ m tÄƒng thá»i gian biÃªn dá»‹ch, vÃ¬ váº­y náº¿u báº¡n Ä‘ang phÃ¡t triá»ƒn vÃ  biÃªn dá»‹ch thÆ°á»ng xuyÃªn, báº¡n sáº½ muá»‘n Ã­t tá»‘i Æ°u hÃ³a hÆ¡n Ä‘á»ƒ biÃªn dá»‹ch nhanh hÆ¡n máº·c dÃ¹ mÃ£ cháº¡y cháº­m hÆ¡n. Do Ä‘Ã³, <code>opt-level</code> máº·c Ä‘á»‹nh cho profile <code>dev</code> lÃ  <code>0</code>. Khi báº¡n sáºµn sÃ ng phÃ¡t hÃ nh mÃ£, tá»‘t nháº¥t lÃ  dÃ nh nhiá»u thá»i gian hÆ¡n cho viá»‡c biÃªn dá»‹ch. Báº¡n chá»‰ biÃªn dá»‹ch á»Ÿ cháº¿ Ä‘á»™ release má»™t láº§n, nhÆ°ng sáº½ cháº¡y chÆ°Æ¡ng trÃ¬nh biÃªn dá»‹ch nhiá»u láº§n, vÃ¬ váº­y cháº¿ Ä‘á»™ release Ä‘Ã¡nh Ä‘á»•i thá»i gian biÃªn dá»‹ch lÃ¢u hÆ¡n Ä‘á»ƒ mÃ£ cháº¡y nhanh hÆ¡n. ÄÃ³ lÃ  lÃ½ do táº¡i sao <code>opt-level</code> máº·c Ä‘á»‹nh cho profile <code>release</code> lÃ  <code>3</code>.</p>
<p>Báº¡n cÃ³ thá»ƒ ghi Ä‘Ã¨ thiáº¿t láº­p máº·c Ä‘á»‹nh báº±ng cÃ¡ch thÃªm má»™t giÃ¡ trá»‹ khÃ¡c trong <em>Cargo.toml</em>. VÃ­ dá»¥, náº¿u muá»‘n sá»­ dá»¥ng má»©c tá»‘i Æ°u hÃ³a 1 trong profile phÃ¡t triá»ƒn, báº¡n cÃ³ thá»ƒ thÃªm hai dÃ²ng sau vÃ o file <em>Cargo.toml</em> cá»§a dá»± Ã¡n:</p>
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">[profile.dev]
opt-level = 1
</code></pre>
<p>MÃ£ nÃ y ghi Ä‘Ã¨ thiáº¿t láº­p máº·c Ä‘á»‹nh lÃ  <code>0</code>. BÃ¢y giá» khi cháº¡y <code>cargo build</code>, Cargo sáº½ sá»­ dá»¥ng cÃ¡c giÃ¡ trá»‹ máº·c Ä‘á»‹nh cho profile <code>dev</code> cÃ¹ng vá»›i tÃ¹y chá»‰nh <code>opt-level</code> cá»§a chÃºng ta. VÃ¬ chÃºng ta Ä‘áº·t <code>opt-level</code> lÃ  <code>1</code>, Cargo sáº½ Ã¡p dá»¥ng nhiá»u tá»‘i Æ°u hÃ³a hÆ¡n máº·c Ä‘á»‹nh, nhÆ°ng khÃ´ng nhiá»u báº±ng trong báº£n build release.</p>
<p>Äá»ƒ xem danh sÃ¡ch Ä‘áº§y Ä‘á»§ cÃ¡c tÃ¹y chá»n cáº¥u hÃ¬nh vÃ  giÃ¡ trá»‹ máº·c Ä‘á»‹nh cho tá»«ng profile, hÃ£y tham kháº£o
<a href="https://doc.rust-lang.org/cargo/reference/profiles.html">tÃ i liá»‡u cá»§a Cargo</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="publishing-a-crate-to-cratesio"><a class="header" href="#publishing-a-crate-to-cratesio">Publishing a Crate to Crates.io</a></h2>
<p>ChÃºng ta Ä‘Ã£ sá»­ dá»¥ng cÃ¡c package tá»« <a href="https://crates.io/">crates.io</a><!-- ignore --> lÃ m dependencies cho dá»± Ã¡n cá»§a mÃ¬nh, nhÆ°ng báº¡n cÅ©ng cÃ³ thá»ƒ chia sáº» mÃ£ cá»§a mÃ¬nh vá»›i ngÆ°á»i khÃ¡c báº±ng cÃ¡ch xuáº¥t báº£n package riÃªng. Registry cá»§a crate táº¡i <a href="https://crates.io/">crates.io</a><!-- ignore --> phÃ¢n phá»‘i mÃ£ nguá»“n cá»§a package cá»§a báº¡n, chá»§ yáº¿u lÃ  mÃ£ nguá»“n má»Ÿ.</p>
<p>Rust vÃ  Cargo cÃ³ cÃ¡c tÃ­nh nÄƒng giÃºp package báº¡n xuáº¥t báº£n dá»… Ä‘Æ°á»£c tÃ¬m tháº¥y vÃ  sá»­ dá»¥ng hÆ¡n. ChÃºng ta sáº½ nÃ³i vá» má»™t sá»‘ tÃ­nh nÄƒng nÃ y vÃ  sau Ä‘Ã³ giáº£i thÃ­ch cÃ¡ch xuáº¥t báº£n package.</p>
<h3 id="viáº¿t-bÃ¬nh-luáº­n-tÃ i-liá»‡u-há»¯u-Ãch"><a class="header" href="#viáº¿t-bÃ¬nh-luáº­n-tÃ i-liá»‡u-há»¯u-Ãch">Viáº¿t BÃ¬nh Luáº­n TÃ i Liá»‡u Há»¯u Ãch</a></h3>
<p>Viá»‡c tÃ i liá»‡u hÃ³a chÃ­nh xÃ¡c package sáº½ giÃºp ngÆ°á»i dÃ¹ng khÃ¡c biáº¿t cÃ¡ch vÃ  khi nÃ o sá»­ dá»¥ng chÃºng, vÃ¬ váº­y Ä‘Ã¡ng Ä‘á»ƒ Ä‘áº§u tÆ° thá»i gian viáº¿t tÃ i liá»‡u. Trong ChÆ°Æ¡ng 3, chÃºng ta Ä‘Ã£ tháº£o luáº­n cÃ¡ch comment code Rust sá»­ dá»¥ng hai dáº¥u gáº¡ch chÃ©o, <code>//</code>. Rust cÅ©ng cÃ³ má»™t kiá»ƒu comment Ä‘áº·c biá»‡t cho tÃ i liá»‡u, gá»i tiá»‡n lÃ  <em>documentation comment</em>, sáº½ táº¡o ra tÃ i liá»‡u HTML. HTML sáº½ hiá»ƒn thá»‹ ná»™i dung cá»§a cÃ¡c comment tÃ i liá»‡u cho cÃ¡c API public, nháº±m hÆ°á»›ng dáº«n láº­p trÃ¬nh viÃªn cÃ¡ch <em>sá»­ dá»¥ng</em> crate thay vÃ¬ cÃ¡ch crate Ä‘Æ°á»£c <em>triá»ƒn khai</em>.</p>
<p>Documentation comment sá»­ dá»¥ng ba dáº¥u gáº¡ch chÃ©o, <code>///</code>, thay vÃ¬ hai, vÃ  há»— trá»£ Markdown Ä‘á»ƒ Ä‘á»‹nh dáº¡ng vÄƒn báº£n. Äáº·t comment ngay trÆ°á»›c item mÃ  nÃ³ tÃ i liá»‡u hÃ³a. Listing 14-1 minh há»a cÃ¡c comment tÃ i liá»‡u cho má»™t hÃ m <code>add_one</code> trong crate tÃªn lÃ  <code>my_crate</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore">/// Adds one to the number given.
///
/// # Examples
///
/// ```
/// let arg = 5;
/// let answer = my_crate::add_one(arg);
///
/// assert_eq!(6, answer);
/// ```
pub fn add_one(x: i32) -&gt; i32 {
    x + 1
}</code></pre>
<p><span class="caption">Listing 14-1: A documentation comment for a
function</span></p>
<p>á» Ä‘Ã¢y, chÃºng ta cung cáº¥p mÃ´ táº£ vá» chá»©c nÄƒng cá»§a hÃ m <code>add_one</code>, báº¯t Ä‘áº§u má»™t
section vá»›i tiÃªu Ä‘á» <code>Examples</code>, vÃ  sau Ä‘Ã³ cung cáº¥p code minh há»a cÃ¡ch sá»­ dá»¥ng
hÃ m <code>add_one</code>. ChÃºng ta cÃ³ thá»ƒ táº¡o tÃ i liá»‡u HTML tá»« comment nÃ y báº±ng cÃ¡ch cháº¡y
<code>cargo doc</code>. Lá»‡nh nÃ y sáº½ cháº¡y cÃ´ng cá»¥ <code>rustdoc</code> Ä‘i kÃ¨m Rust vÃ  Ä‘áº·t tÃ i liá»‡u HTML
táº¡o ra trong thÆ° má»¥c <em>target/doc</em>.</p>
<p>Äá»ƒ tiá»‡n lá»£i, cháº¡y <code>cargo doc --open</code> sáº½ build HTML cho tÃ i liá»‡u crate hiá»‡n táº¡i
(cÅ©ng nhÆ° tÃ i liá»‡u cho táº¥t cáº£ dependencies cá»§a crate) vÃ  má»Ÿ káº¿t quáº£ trong trÃ¬nh
duyá»‡t web. Äiá»u hÆ°á»›ng Ä‘áº¿n hÃ m <code>add_one</code> vÃ  báº¡n sáº½ tháº¥y cÃ¡ch vÄƒn báº£n trong
comment Ä‘Æ°á»£c hiá»ƒn thá»‹, nhÆ° minh há»a trong HÃ¬nh 14-1:</p>
<img alt="Rendered HTML documentation for the `add_one` function of `my_crate`" src="img/trpl14-01.png" class="center" />
<p><span class="caption">Figure 14-1: HTML documentation for the <code>add_one</code>
function</span></p>
<h4 id="cÃ¡c-section-thÆ°á»ng-dÃ¹ng"><a class="header" href="#cÃ¡c-section-thÆ°á»ng-dÃ¹ng">CÃ¡c Section ThÆ°á»ng DÃ¹ng</a></h4>
<p>ChÃºng ta Ä‘Ã£ sá»­ dá»¥ng tiÃªu Ä‘á» Markdown <code># Examples</code> trong Listing 14-1 Ä‘á»ƒ táº¡o
má»™t section trong HTML vá»›i tÃªn â€œExamples.â€ DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ section khÃ¡c mÃ 
tÃ¡c giáº£ crate thÆ°á»ng dÃ¹ng trong tÃ i liá»‡u:</p>
<ul>
<li><strong>Panics</strong>: CÃ¡c tÃ¬nh huá»‘ng mÃ  hÃ m Ä‘Æ°á»£c tÃ i liá»‡u hÃ³a cÃ³ thá»ƒ panic. Nhá»¯ng
ngÆ°á»i gá»i hÃ m mÃ  khÃ´ng muá»‘n chÆ°Æ¡ng trÃ¬nh cá»§a há» panic cáº§n Ä‘áº£m báº£o khÃ´ng
gá»i hÃ m trong nhá»¯ng tÃ¬nh huá»‘ng nÃ y.</li>
<li><strong>Errors</strong>: Náº¿u hÃ m tráº£ vá» <code>Result</code>, mÃ´ táº£ cÃ¡c loáº¡i lá»—i cÃ³ thá»ƒ xáº£y ra vÃ 
Ä‘iá»u kiá»‡n nÃ o gÃ¢y ra lá»—i sáº½ giÃºp ngÆ°á»i dÃ¹ng viáº¿t code xá»­ lÃ½ cÃ¡c lá»—i khÃ¡c
nhau má»™t cÃ¡ch phÃ¹ há»£p.</li>
<li><strong>Safety</strong>: Náº¿u hÃ m lÃ  <code>unsafe</code> Ä‘á»ƒ gá»i (chÃºng ta sáº½ bÃ n vá» unsafety á»Ÿ ChÆ°Æ¡ng
19), cáº§n cÃ³ má»™t section giáº£i thÃ­ch táº¡i sao hÃ m lÃ  unsafe vÃ  cÃ¡c invariant mÃ 
hÃ m mong ngÆ°á»i gá»i tuÃ¢n thá»§.</li>
</ul>
<p>Háº§u háº¿t cÃ¡c comment tÃ i liá»‡u khÃ´ng cáº§n táº¥t cáº£ cÃ¡c section nÃ y, nhÆ°ng Ä‘Ã¢y lÃ 
má»™t checklist há»¯u Ã­ch nháº¯c nhá»Ÿ báº¡n vá» nhá»¯ng khÃ­a cáº¡nh cá»§a code mÃ  ngÆ°á»i dÃ¹ng
sáº½ quan tÃ¢m.</p>
<h4 id="documentation-comments-as-tests"><a class="header" href="#documentation-comments-as-tests">Documentation Comments as Tests</a></h4>
<p>ThÃªm cÃ¡c khá»‘i code vÃ­ dá»¥ trong comment tÃ i liá»‡u cÃ³ thá»ƒ giÃºp minh há»a cÃ¡ch sá»­
dá»¥ng thÆ° viá»‡n cá»§a báº¡n, vÃ  Ä‘iá»u nÃ y cÃ²n cÃ³ má»™t lá»£i Ã­ch thÃªm: cháº¡y <code>cargo test</code>
sáº½ thá»±c thi cÃ¡c vÃ­ dá»¥ trong tÃ i liá»‡u nhÆ° cÃ¡c test! KhÃ´ng gÃ¬ tá»‘t hÆ¡n tÃ i liá»‡u
cÃ³ vÃ­ dá»¥ minh há»a. NhÆ°ng cÅ©ng khÃ´ng gÃ¬ tá»‡ hÆ¡n cÃ¡c vÃ­ dá»¥ khÃ´ng hoáº¡t Ä‘á»™ng vÃ¬
code Ä‘Ã£ thay Ä‘á»•i ká»ƒ tá»« khi tÃ i liá»‡u Ä‘Æ°á»£c viáº¿t. Náº¿u chÃºng ta cháº¡y <code>cargo test</code>
vá»›i tÃ i liá»‡u cá»§a hÃ m <code>add_one</code> tá»« Listing 14-1, chÃºng ta sáº½ tháº¥y má»™t section
trong káº¿t quáº£ test nhÆ° sau:</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/listing-14-01/
cargo test
copy just the doc-tests section below
-->
<pre><code class="language-text">   Doc-tests my_crate

running 1 test
test src/lib.rs - add_one (line 5) ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.27s
</code></pre>
<p>BÃ¢y giá» náº¿u chÃºng ta thay Ä‘á»•i hÃ m hoáº·c vÃ­ dá»¥ sao cho <code>assert_eq!</code> trong vÃ­ dá»¥
panic vÃ  cháº¡y láº¡i <code>cargo test</code>, chÃºng ta sáº½ tháº¥y ráº±ng cÃ¡c doc test phÃ¡t hiá»‡n
ra ráº±ng vÃ­ dá»¥ vÃ  code khÃ´ng cÃ²n Ä‘á»“ng bá»™ vá»›i nhau ná»¯a!</p>
<h4 id="comment-cho-cÃ¡c-item-chá»©a-nÃ³"><a class="header" href="#comment-cho-cÃ¡c-item-chá»©a-nÃ³">Comment cho cÃ¡c Item Chá»©a NÃ³</a></h4>
<p>Kiá»ƒu comment tÃ i liá»‡u <code>//!</code> sáº½ thÃªm tÃ i liá»‡u vÃ o item chá»©a cÃ¡c comment thay
vÃ¬ cÃ¡c item theo sau. ChÃºng ta thÆ°á»ng dÃ¹ng kiá»ƒu doc comment nÃ y bÃªn trong
file gá»‘c cá»§a crate (<em>src/lib.rs</em> theo quy Æ°á»›c) hoáº·c bÃªn trong má»™t module Ä‘á»ƒ
document toÃ n bá»™ crate hoáº·c module.</p>
<p>VÃ­ dá»¥, Ä‘á»ƒ thÃªm tÃ i liá»‡u mÃ´ táº£ má»¥c Ä‘Ã­ch cá»§a crate <code>my_crate</code> chá»©a hÃ m
<code>add_one</code>, chÃºng ta thÃªm cÃ¡c doc comment báº¯t Ä‘áº§u vá»›i <code>//!</code> vÃ o Ä‘áº§u file
<em>src/lib.rs</em>, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 14-2:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore">//! # My Crate
//!
//! `my_crate` is a collection of utilities to make performing certain
//! calculations more convenient.

/// Adds one to the number given.
// --snip--
<span class="boring">///
</span><span class="boring">/// # Examples
</span><span class="boring">///
</span><span class="boring">/// ```
</span><span class="boring">/// let arg = 5;
</span><span class="boring">/// let answer = my_crate::add_one(arg);
</span><span class="boring">///
</span><span class="boring">/// assert_eq!(6, answer);
</span><span class="boring">/// ```
</span><span class="boring">pub fn add_one(x: i32) -&gt; i32 {
</span><span class="boring">    x + 1
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 14-2: Documentation cho toÃ n bá»™ crate <code>my_crate</code></span></p>
<p>ChÃº Ã½ ráº±ng khÃ´ng cÃ³ code nÃ o sau dÃ²ng cuá»‘i cÃ¹ng báº¯t Ä‘áº§u báº±ng <code>//!</code>. VÃ¬ chÃºng
ta báº¯t Ä‘áº§u comment vá»›i <code>//!</code> thay vÃ¬ <code>///</code>, chÃºng ta Ä‘ang document item chá»©a
comment nÃ y thay vÃ¬ má»™t item theo sau. Trong trÆ°á»ng há»£p nÃ y, item Ä‘Ã³ lÃ  file
<em>src/lib.rs</em>, tá»©c lÃ  crate root. CÃ¡c comment nÃ y mÃ´ táº£ toÃ n bá»™ crate.</p>
<p>Khi cháº¡y <code>cargo doc --open</code>, cÃ¡c comment nÃ y sáº½ hiá»ƒn thá»‹ trÃªn trang chÃ­nh
cá»§a tÃ i liá»‡u crate <code>my_crate</code> phÃ­a trÃªn danh sÃ¡ch cÃ¡c item public trong crate,
nhÆ° Ä‘Æ°á»£c minh há»a trong Figure 14-2:</p>
<img alt="Rendered HTML documentation with a comment for the crate as a whole" src="img/trpl14-02.png" class="center" />
<p><span class="caption">Figure 14-2: TÃ i liá»‡u Ä‘Æ°á»£c render cho <code>my_crate</code>,
bao gá»“m comment mÃ´ táº£ toÃ n bá»™ crate</span></p>
<p>CÃ¡c documentation comment bÃªn trong cÃ¡c item ráº¥t há»¯u Ã­ch Ä‘á»ƒ mÃ´ táº£ crates
vÃ  modules. DÃ¹ng chÃºng Ä‘á»ƒ giáº£i thÃ­ch má»¥c Ä‘Ã­ch tá»•ng thá»ƒ cá»§a container Ä‘á»ƒ
giÃºp ngÆ°á»i dÃ¹ng hiá»ƒu tá»• chá»©c crate.</p>
<h3 id="export-má»™t-public-api-thuáº­n-tiá»‡n-vá»›i-pub-use"><a class="header" href="#export-má»™t-public-api-thuáº­n-tiá»‡n-vá»›i-pub-use">Export má»™t Public API thuáº­n tiá»‡n vá»›i <code>pub use</code></a></h3>
<p>Cáº¥u trÃºc cá»§a public API lÃ  yáº¿u tá»‘ quan trá»ng khi xuáº¥t báº£n crate. NgÆ°á»i dÃ¹ng
crate cá»§a báº¡n khÃ´ng quen vá»›i cáº¥u trÃºc báº±ng báº¡n vÃ  cÃ³ thá»ƒ gáº·p khÃ³ khÄƒn khi
tÃ¬m cÃ¡c pháº§n há» muá»‘n dÃ¹ng náº¿u crate cÃ³ hierarchy module lá»›n.</p>
<p>Trong Chapter 7, chÃºng ta Ä‘Ã£ há»c cÃ¡ch lÃ m item public vá»›i tá»« khÃ³a <code>pub</code>,
vÃ  Ä‘Æ°a item vÃ o scope vá»›i tá»« khÃ³a <code>use</code>. Tuy nhiÃªn, cáº¥u trÃºc há»£p lÃ½ cho báº¡n
khi phÃ¡t triá»ƒn crate cÃ³ thá»ƒ khÃ´ng thuáº­n tiá»‡n cho ngÆ°á»i khÃ¡c. Báº¡n cÃ³ thá»ƒ
muá»‘n tá»• chá»©c cÃ¡c struct theo má»™t hierarchy nhiá»u cáº¥p, nhÆ°ng ngÆ°á»i dÃ¹ng muá»‘n
dÃ¹ng má»™t type trong cáº¥p sÃ¢u cÃ³ thá»ƒ khÃ³ biáº¿t type Ä‘Ã³ tá»“n táº¡i. Há» cÅ©ng cÃ³
thá»ƒ phiá»n khi pháº£i viáº¿t <code>use my_crate::some_module::another_module::UsefulType;</code>
thay vÃ¬ <code>use my_crate::UsefulType;</code>.</p>
<p>Tin tá»‘t lÃ  náº¿u cáº¥u trÃºc <em>khÃ´ng</em> tiá»‡n lá»£i cho ngÆ°á»i khÃ¡c dÃ¹ng tá»« thÆ° viá»‡n
khÃ¡c, báº¡n khÃ´ng cáº§n pháº£i thay Ä‘á»•i tá»• chá»©c ná»™i bá»™: thay vÃ o Ä‘Ã³, báº¡n cÃ³ thá»ƒ
re-export item Ä‘á»ƒ táº¡o cáº¥u trÃºc public khÃ¡c vá»›i cáº¥u trÃºc private báº±ng cÃ¡ch dÃ¹ng
<code>pub use</code>. Re-export sáº½ láº¥y má»™t public item á»Ÿ má»™t nÆ¡i vÃ  lÃ m nÃ³ public á»Ÿ nÆ¡i
khÃ¡c, nhÆ° thá»ƒ item Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a á»Ÿ vá»‹ trÃ­ khÃ¡c Ä‘Ã³.</p>
<p>VÃ­ dá»¥, giáº£ sá»­ chÃºng ta táº¡o má»™t library tÃªn lÃ  <code>art</code> Ä‘á»ƒ mÃ´ hÃ¬nh hÃ³a cÃ¡c
khÃ¡i niá»‡m nghá»‡ thuáº­t. Trong library nÃ y cÃ³ hai module: module <code>kinds</code> chá»©a
hai enum <code>PrimaryColor</code> vÃ  <code>SecondaryColor</code>, vÃ  module <code>utils</code> chá»©a hÃ m <code>mix</code>,
nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 14-3:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground test_harness">//! # Art
//!
//! A library for modeling artistic concepts.

pub mod kinds {
    /// The primary colors according to the RYB color model.
    pub enum PrimaryColor {
        Red,
        Yellow,
        Blue,
    }

    /// The secondary colors according to the RYB color model.
    pub enum SecondaryColor {
        Orange,
        Green,
        Purple,
    }
}

pub mod utils {
    use crate::kinds::*;

    /// Combines two primary colors in equal amounts to create
    /// a secondary color.
    pub fn mix(c1: PrimaryColor, c2: PrimaryColor) -&gt; SecondaryColor {
        // --snip--
<span class="boring">        unimplemented!();
</span>    }
}</code></pre>
<p><span class="caption">Listing 14-3: Má»™t thÆ° viá»‡n <code>art</code> vá»›i cÃ¡c item Ä‘Æ°á»£c tá»• chá»©c
trong cÃ¡c module <code>kinds</code> vÃ  <code>utils</code></span></p>
<p>Figure 14-3 minh há»a trang chÃ­nh cá»§a tÃ i liá»‡u crate nÃ y Ä‘Æ°á»£c táº¡o bá»Ÿi
<code>cargo doc</code>:</p>
<img alt="Rendered documentation for the `art` crate that lists the `kinds` and `utils` modules" src="img/trpl14-03.png" class="center" />
<p><span class="caption">Figure 14-3: Trang chÃ­nh cá»§a tÃ i liá»‡u crate <code>art</code>
liá»‡t kÃª cÃ¡c module <code>kinds</code> vÃ  <code>utils</code></span></p>
<p>ChÃº Ã½ ráº±ng cÃ¡c type <code>PrimaryColor</code> vÃ  <code>SecondaryColor</code> khÃ´ng Ä‘Æ°á»£c liá»‡t kÃª
trÃªn trang chÃ­nh, cÅ©ng nhÆ° hÃ m <code>mix</code>. ChÃºng ta pháº£i click vÃ o <code>kinds</code> vÃ 
<code>utils</code> Ä‘á»ƒ xem chÃºng.</p>
<p>Má»™t crate khÃ¡c phá»¥ thuá»™c vÃ o thÆ° viá»‡n nÃ y sáº½ cáº§n cÃ¡c cÃ¢u lá»‡nh <code>use</code> Ä‘á»ƒ
Ä‘Æ°a cÃ¡c item tá»« <code>art</code> vÃ o scope, chá»‰ ra cáº¥u trÃºc module hiá»‡n táº¡i. Listing 14-4
minh há»a má»™t vÃ­ dá»¥ crate sá»­ dá»¥ng cÃ¡c item <code>PrimaryColor</code> vÃ  <code>mix</code> tá»« crate
<code>art</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">use art::kinds::PrimaryColor;
use art::utils::mix;

fn main() {
    let red = PrimaryColor::Red;
    let yellow = PrimaryColor::Yellow;
    mix(red, yellow);
}</code></pre>
<p><span class="caption">Listing 14-4: Má»™t crate sá»­ dá»¥ng cÃ¡c item cá»§a crate <code>art</code> vá»›i
cáº¥u trÃºc ná»™i bá»™ cá»§a nÃ³</span></p>
<p>TÃ¡c giáº£ cá»§a code trong Listing 14-4, sá»­ dá»¥ng crate <code>art</code>, pháº£i xÃ¡c Ä‘á»‹nh ráº±ng
<code>PrimaryColor</code> náº±m trong module <code>kinds</code> vÃ  <code>mix</code> náº±m trong module <code>utils</code>.
Cáº¥u trÃºc module cá»§a crate <code>art</code> quan trá»ng hÆ¡n vá»›i cÃ¡c developer lÃ m viá»‡c
trÃªn crate <code>art</code> hÆ¡n lÃ  vá»›i nhá»¯ng ngÆ°á»i dÃ¹ng nÃ³. Cáº¥u trÃºc ná»™i bá»™ khÃ´ng chá»©a
thÃ´ng tin há»¯u Ã­ch cho ai Ä‘Ã³ Ä‘ang cá»‘ gáº¯ng hiá»ƒu cÃ¡ch sá»­ dá»¥ng crate <code>art</code>,
mÃ  ngÆ°á»£c láº¡i gÃ¢y nháº§m láº«n vÃ¬ cÃ¡c developer pháº£i tÃ¬m xem nÃªn look vÃ o Ä‘Ã¢u
vÃ  pháº£i chá»‰ rÃµ tÃªn module trong cÃ¡c cÃ¢u lá»‡nh <code>use</code>.</p>
<p>Äá»ƒ loáº¡i bá» cáº¥u trÃºc ná»™i bá»™ khá»i API cÃ´ng khai, chÃºng ta cÃ³ thá»ƒ chá»‰nh sá»­a
code crate <code>art</code> trong Listing 14-3 Ä‘á»ƒ thÃªm cÃ¡c cÃ¢u lá»‡nh <code>pub use</code> Ä‘á»ƒ
re-export cÃ¡c item lÃªn cáº¥p top-level, nhÆ° minh há»a trong Listing 14-5:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore">//! # Art
//!
//! A library for modeling artistic concepts.

pub use self::kinds::PrimaryColor;
pub use self::kinds::SecondaryColor;
pub use self::utils::mix;

pub mod kinds {
    // --snip--
<span class="boring">    /// The primary colors according to the RYB color model.
</span><span class="boring">    pub enum PrimaryColor {
</span><span class="boring">        Red,
</span><span class="boring">        Yellow,
</span><span class="boring">        Blue,
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    /// The secondary colors according to the RYB color model.
</span><span class="boring">    pub enum SecondaryColor {
</span><span class="boring">        Orange,
</span><span class="boring">        Green,
</span><span class="boring">        Purple,
</span><span class="boring">    }
</span>}

pub mod utils {
    // --snip--
<span class="boring">    use crate::kinds::*;
</span><span class="boring">
</span><span class="boring">    /// Combines two primary colors in equal amounts to create
</span><span class="boring">    /// a secondary color.
</span><span class="boring">    pub fn mix(c1: PrimaryColor, c2: PrimaryColor) -&gt; SecondaryColor {
</span><span class="boring">        SecondaryColor::Orange
</span><span class="boring">    }
</span>}</code></pre>
<p><span class="caption">Listing 14-5: ThÃªm cÃ¡c cÃ¢u lá»‡nh <code>pub use</code> Ä‘á»ƒ re-export
cÃ¡c item</span></p>
<p>TÃ i liá»‡u API mÃ  <code>cargo doc</code> táº¡o ra cho crate nÃ y giá» sáº½ liá»‡t kÃª vÃ  liÃªn káº¿t
cÃ¡c re-export trÃªn trang chÃ­nh, nhÆ° minh há»a trong Figure 14-4, giÃºp
cÃ¡c type <code>PrimaryColor</code> vÃ  <code>SecondaryColor</code> cÅ©ng nhÆ° hÃ m <code>mix</code> dá»… tÃ¬m hÆ¡n.</p>
<img alt="Rendered documentation for the `art` crate with the re-exports on the front page" src="img/trpl14-04.png" class="center" />
<p><span class="caption">Figure 14-4: Trang chÃ­nh cá»§a tÃ i liá»‡u crate <code>art</code>
liá»‡t kÃª cÃ¡c re-exports</span></p>
<p>NgÆ°á»i dÃ¹ng crate <code>art</code> váº«n cÃ³ thá»ƒ xem vÃ  sá»­ dá»¥ng cáº¥u trÃºc ná»™i bá»™ tá»« Listing
14-3 nhÆ° minh há»a trong Listing 14-4, hoáº·c há» cÃ³ thá»ƒ sá»­ dá»¥ng cáº¥u trÃºc
tiá»‡n lá»£i hÆ¡n trong Listing 14-5, nhÆ° minh há»a trong Listing 14-6:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">use art::PrimaryColor;
use art::mix;

fn main() {
    // --snip--
<span class="boring">    let red = PrimaryColor::Red;
</span><span class="boring">    let yellow = PrimaryColor::Yellow;
</span><span class="boring">    mix(red, yellow);
</span>}</code></pre>
<p><span class="caption">Listing 14-6: Má»™t chÆ°Æ¡ng trÃ¬nh sá»­ dá»¥ng cÃ¡c item Ä‘Æ°á»£c re-export tá»«
crate <code>art</code></span></p>
<p>Trong trÆ°á»ng há»£p cÃ³ nhiá»u module lá»“ng nhau, viá»‡c re-export cÃ¡c type á»Ÿ cáº¥p
trÃªn cÃ¹ng vá»›i <code>pub use</code> cÃ³ thá»ƒ cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ tráº£i nghiá»‡m cá»§a ngÆ°á»i
dÃ¹ng crate. Má»™t cÃ¡ch sá»­ dá»¥ng phá»• biáº¿n khÃ¡c cá»§a <code>pub use</code> lÃ  re-export
cÃ¡c Ä‘á»‹nh nghÄ©a tá»« má»™t dependency trong crate hiá»‡n táº¡i Ä‘á»ƒ biáº¿n cÃ¡c
Ä‘á»‹nh nghÄ©a Ä‘Ã³ thÃ nh má»™t pháº§n cá»§a public API crate cá»§a báº¡n.</p>
<p>Táº¡o má»™t cáº¥u trÃºc public API há»¯u Ã­ch thÆ°á»ng lÃ  nghá»‡ thuáº­t hÆ¡n lÃ  khoa há»c,
vÃ  báº¡n cÃ³ thá»ƒ láº·p láº¡i Ä‘á»ƒ tÃ¬m ra API phÃ¹ há»£p nháº¥t vá»›i ngÆ°á»i dÃ¹ng cá»§a báº¡n.
Chá»n <code>pub use</code> giÃºp báº¡n linh hoáº¡t trong cÃ¡ch cáº¥u trÃºc crate ná»™i bá»™ vÃ 
tÃ¡ch biá»‡t cáº¥u trÃºc ná»™i bá»™ Ä‘Ã³ khá»i nhá»¯ng gÃ¬ báº¡n trÃ¬nh bÃ y cho ngÆ°á»i dÃ¹ng.
HÃ£y xem má»™t sá»‘ code cá»§a cÃ¡c crate báº¡n Ä‘Ã£ cÃ i Ä‘á»ƒ xem liá»‡u cáº¥u trÃºc ná»™i bá»™
cá»§a chÃºng cÃ³ khÃ¡c vá»›i public API khÃ´ng.</p>
<h3 id="thiáº¿t-láº­p-tÃ i-khoáº£n-cratesio"><a class="header" href="#thiáº¿t-láº­p-tÃ i-khoáº£n-cratesio">Thiáº¿t láº­p tÃ i khoáº£n Crates.io</a></h3>
<p>TrÆ°á»›c khi báº¡n cÃ³ thá»ƒ publish báº¥t ká»³ crate nÃ o, báº¡n cáº§n táº¡o má»™t tÃ i khoáº£n
trÃªn <a href="https://crates.io/">crates.io</a><!-- ignore --> vÃ  láº¥y API token. Äá»ƒ lÃ m
Ä‘iá»u nÃ y, truy cáº­p trang chá»§ táº¡i <a href="https://crates.io/">crates.io</a><!-- ignore -->
vÃ  Ä‘Äƒng nháº­p qua tÃ i khoáº£n GitHub. (Hiá»‡n táº¡i tÃ i khoáº£n GitHub lÃ  báº¯t buá»™c,
nhÆ°ng trang web cÃ³ thá»ƒ há»— trá»£ cÃ¡c cÃ¡ch táº¡o tÃ i khoáº£n khÃ¡c trong tÆ°Æ¡ng lai.)
Khi Ä‘Ã£ Ä‘Äƒng nháº­p, truy cáº­p cÃ i Ä‘áº·t tÃ i khoáº£n cá»§a báº¡n táº¡i
<a href="https://crates.io/me/">https://crates.io/me/</a><!-- ignore --> vÃ  láº¥y API key.
Sau Ä‘Ã³ cháº¡y lá»‡nh <code>cargo login</code> vá»›i API key cá»§a báº¡n, nhÆ° sau:</p>
<pre><code class="language-console">$ cargo login abcdefghijklmnopqrstuvwxyz012345
</code></pre>
<p>Lá»‡nh nÃ y sáº½ thÃ´ng bÃ¡o cho Cargo vá» API token cá»§a báº¡n vÃ  lÆ°u trá»¯ nÃ³ cá»¥c bá»™
táº¡i <em>~/.cargo/credentials</em>. LÆ°u Ã½ ráº±ng token nÃ y lÃ  má»™t <em>bÃ­ máº­t</em>: khÃ´ng
chia sáº» nÃ³ vá»›i báº¥t ká»³ ai khÃ¡c. Náº¿u báº¡n Ä‘Ã£ chia sáº» token vá»›i ngÆ°á»i khÃ¡c vÃ¬
báº¥t ká»³ lÃ½ do gÃ¬, báº¡n nÃªn thu há»“i nÃ³ vÃ  táº¡o má»™t token má»›i trÃªn
<a href="https://crates.io/">crates.io</a><!-- ignore -->.</p>
<h3 id="thÃªm-metadata-cho-crate-má»›i"><a class="header" href="#thÃªm-metadata-cho-crate-má»›i">ThÃªm Metadata cho Crate Má»›i</a></h3>
<p>Giáº£ sá»­ báº¡n cÃ³ má»™t crate mÃ  báº¡n muá»‘n publish. TrÆ°á»›c khi publish, báº¡n cáº§n
thÃªm má»™t sá»‘ metadata vÃ o pháº§n <code>[package]</code> trong file <em>Cargo.toml</em> cá»§a crate.</p>
<p>Crate cá»§a báº¡n cáº§n cÃ³ má»™t tÃªn duy nháº¥t. Khi lÃ m viá»‡c vá»›i crate cá»¥c bá»™, báº¡n
cÃ³ thá»ƒ Ä‘áº·t tÃªn crate tÃ¹y Ã½. Tuy nhiÃªn, tÃªn crate trÃªn
<a href="https://crates.io/">crates.io</a><!-- ignore --> Ä‘Æ°á»£c cáº¥p theo cÆ¡ cháº¿
first-come, first-served. Khi tÃªn crate Ä‘Ã£ Ä‘Æ°á»£c dÃ¹ng, khÃ´ng ai khÃ¡c cÃ³ thá»ƒ
publish crate vá»›i tÃªn Ä‘Ã³. TrÆ°á»›c khi thá»­ publish, hÃ£y tÃ¬m kiáº¿m tÃªn báº¡n muá»‘n
sá»­ dá»¥ng. Náº¿u tÃªn Ä‘Ã³ Ä‘Ã£ Ä‘Æ°á»£c dÃ¹ng, báº¡n sáº½ cáº§n tÃ¬m tÃªn khÃ¡c vÃ  chá»‰nh sá»­a
trÆ°á»ng <code>name</code> trong file <em>Cargo.toml</em> á»Ÿ pháº§n <code>[package]</code> Ä‘á»ƒ sá»­ dá»¥ng tÃªn má»›i
khi publish, nhÆ° sau:</p>
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">[package]
name = "guessing_game"
</code></pre>
<p>Ngay cáº£ khi báº¡n Ä‘Ã£ chá»n má»™t tÃªn duy nháº¥t, khi cháº¡y <code>cargo publish</code> Ä‘á»ƒ
publish crate vÃ o thá»i Ä‘iá»ƒm nÃ y, báº¡n sáº½ nháº­n Ä‘Æ°á»£c má»™t cáº£nh bÃ¡o vÃ  sau Ä‘Ã³ lÃ 
má»™t lá»—i:</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/listing-14-01/
cargo publish
copy just the relevant lines below
-->
<pre><code class="language-console">$ cargo publish
    Updating crates.io index
warning: manifest has no description, license, license-file, documentation, homepage or repository.
See https://doc.rust-lang.org/cargo/reference/manifest.html#package-metadata for more info.
--snip--
error: failed to publish to registry at https://crates.io

Caused by:
  the remote server responded with an error: missing or empty metadata fields: description, license. Please see https://doc.rust-lang.org/cargo/reference/manifest.html for how to upload metadata
</code></pre>
<p>Lá»—i nÃ y xáº£y ra vÃ¬ báº¡n Ä‘ang thiáº¿u má»™t sá»‘ thÃ´ng tin quan trá»ng: báº¡n pháº£i cÃ³
<code>description</code> vÃ  <code>license</code> Ä‘á»ƒ ngÆ°á»i khÃ¡c biáº¿t crate cá»§a báº¡n lÃ m gÃ¬ vÃ  dÆ°á»›i
Ä‘iá»u kiá»‡n nÃ o há» cÃ³ thá»ƒ sá»­ dá»¥ng. Trong <em>Cargo.toml</em>, thÃªm má»™t <code>description</code>
chá»‰ vÃ i cÃ¢u ngáº¯n, vÃ¬ nÃ³ sáº½ hiá»ƒn thá»‹ trong káº¿t quáº£ tÃ¬m kiáº¿m crate cá»§a báº¡n.
Äá»‘i vá»›i trÆ°á»ng <code>license</code>, báº¡n cáº§n cung cáº¥p má»™t <em>license identifier</em>.
<a href="http://spdx.org/licenses/">Linux Foundationâ€™s Software Package Data Exchange (SPDX)</a> liá»‡t kÃª cÃ¡c
identifier mÃ  báº¡n cÃ³ thá»ƒ dÃ¹ng. VÃ­ dá»¥, Ä‘á»ƒ chá»‰ ra ráº±ng báº¡n cáº¥p phÃ©p crate
báº±ng MIT License, thÃªm identifier <code>MIT</code>:</p>
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">[package]
name = "guessing_game"
license = "MIT"
</code></pre>
<p>Náº¿u báº¡n muá»‘n dÃ¹ng má»™t license khÃ´ng cÃ³ trong danh sÃ¡ch SPDX, báº¡n cáº§n Ä‘áº·t
ná»™i dung license Ä‘Ã³ vÃ o má»™t file, thÃªm file Ä‘Ã³ vÃ o dá»± Ã¡n, vÃ  dÃ¹ng <code>license-file</code>
Ä‘á»ƒ chá»‰ Ä‘á»‹nh tÃªn file Ä‘Ã³ thay vÃ¬ dÃ¹ng khÃ³a <code>license</code>.</p>
<p>HÆ°á»›ng dáº«n chá»n license phÃ¹ há»£p cho dá»± Ã¡n cá»§a báº¡n náº±m ngoÃ i pháº¡m vi cuá»‘n
sÃ¡ch nÃ y. Nhiá»u ngÆ°á»i trong cá»™ng Ä‘á»“ng Rust cáº¥p phÃ©p dá»± Ã¡n cá»§a há» giá»‘ng nhÆ°
Rust báº±ng cÃ¡ch dÃ¹ng dual license <code>MIT OR Apache-2.0</code>. CÃ¡ch lÃ m nÃ y cÅ©ng
chá»©ng minh ráº±ng báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh nhiá»u license báº±ng cÃ¡ch dÃ¹ng <code>OR</code> Ä‘á»ƒ
cho phÃ©p nhiá»u license cho dá»± Ã¡n cá»§a báº¡n.</p>
<p>Vá»›i tÃªn duy nháº¥t, phiÃªn báº£n, description, vÃ  license Ä‘Ã£ thÃªm vÃ o, file
<em>Cargo.toml</em> cho má»™t dá»± Ã¡n sáºµn sÃ ng publish cÃ³ thá»ƒ trÃ´ng nhÆ° sau:</p>
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">[package]
name = "guessing_game"
version = "0.1.0"
edition = "2021"
description = "A fun game where you guess what number the computer has chosen."
license = "MIT OR Apache-2.0"

[dependencies]
</code></pre>
<p><a href="https://doc.rust-lang.org/cargo/">Cargoâ€™s documentation</a> mÃ´ táº£ cÃ¡c metadata
khÃ¡c mÃ  báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh Ä‘á»ƒ giÃºp ngÆ°á»i khÃ¡c dá»… dÃ ng tÃ¬m tháº¥y vÃ  sá»­ dá»¥ng
crate cá»§a báº¡n hÆ¡n.</p>
<h3 id="publishing-to-cratesio"><a class="header" href="#publishing-to-cratesio">Publishing to Crates.io</a></h3>
<p>BÃ¢y giá» báº¡n Ä‘Ã£ táº¡o tÃ i khoáº£n, lÆ°u API token, chá»n tÃªn cho crate cá»§a báº¡n,
vÃ  chá»‰ Ä‘á»‹nh cÃ¡c metadata cáº§n thiáº¿t, báº¡n Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ publish! Viá»‡c publish
má»™t crate sáº½ táº£i má»™t phiÃªn báº£n cá»¥ thá»ƒ lÃªn <a href="https://crates.io/">crates.io</a>
cho ngÆ°á»i khÃ¡c sá»­ dá»¥ng.</p>
<p>HÃ£y cáº©n tháº­n, vÃ¬ viá»‡c publish lÃ  <em>vÄ©nh viá»…n</em>. PhiÃªn báº£n Ä‘Ã³ khÃ´ng thá»ƒ bá»‹
ghi Ä‘Ã¨, vÃ  code khÃ´ng thá»ƒ bá»‹ xÃ³a. Má»™t má»¥c tiÃªu chÃ­nh cá»§a <a href="https://crates.io/">crates.io</a>
lÃ  lÃ m má»™t kho lÆ°u trá»¯ vÄ©nh viá»…n cá»§a code Ä‘á»ƒ cÃ¡c build cá»§a má»i dá»± Ã¡n phá»¥ thuá»™c
vÃ o cÃ¡c crate tá»« <a href="https://crates.io/">crates.io</a> váº«n tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng.
Cho phÃ©p xÃ³a phiÃªn báº£n sáº½ phÃ¡ vá»¡ má»¥c tiÃªu nÃ y. Tuy nhiÃªn, khÃ´ng cÃ³ giá»›i
háº¡n vá» sá»‘ phiÃªn báº£n crate mÃ  báº¡n cÃ³ thá»ƒ publish.</p>
<p>Cháº¡y lá»‡nh <code>cargo publish</code> láº§n ná»¯a. LÃºc nÃ y lá»‡nh sáº½ thÃ nh cÃ´ng:</p>
<!-- manual-regeneration
go to some valid crate, publish a new version
cargo publish
copy just the relevant lines below
-->
<pre><code class="language-console">$ cargo publish
    Updating crates.io index
   Packaging guessing_game v0.1.0 (file:///projects/guessing_game)
   Verifying guessing_game v0.1.0 (file:///projects/guessing_game)
   Compiling guessing_game v0.1.0
(file:///projects/guessing_game/target/package/guessing_game-0.1.0)
    Finished dev [unoptimized + debuginfo] target(s) in 0.19s
   Uploading guessing_game v0.1.0 (file:///projects/guessing_game)
</code></pre>
<p>ChÃºc má»«ng! BÃ¢y giá» báº¡n Ä‘Ã£ chia sáº» code cá»§a mÃ¬nh vá»›i cá»™ng Ä‘á»“ng Rust, vÃ 
báº¥t ká»³ ai cÅ©ng cÃ³ thá»ƒ dá»… dÃ ng thÃªm crate cá»§a báº¡n lÃ m dependency trong dá»± Ã¡n
cá»§a há».</p>
<h3 id="publishing-a-new-version-of-an-existing-crate"><a class="header" href="#publishing-a-new-version-of-an-existing-crate">Publishing a New Version of an Existing Crate</a></h3>
<p>Khi báº¡n Ä‘Ã£ thá»±c hiá»‡n thay Ä‘á»•i cho crate vÃ  sáºµn sÃ ng phÃ¡t hÃ nh phiÃªn báº£n
má»›i, hÃ£y thay Ä‘á»•i giÃ¡ trá»‹ <code>version</code> trong <em>Cargo.toml</em> cá»§a báº¡n vÃ  publish
láº¡i. Sá»­ dá»¥ng cÃ¡c quy táº¯c <a href="http://semver.org/">Semantic Versioning</a> Ä‘á»ƒ quyáº¿t Ä‘á»‹nh sá»‘
phiÃªn báº£n tiáº¿p theo phÃ¹ há»£p dá»±a trÃªn cÃ¡c loáº¡i thay Ä‘á»•i báº¡n Ä‘Ã£ thá»±c hiá»‡n.
Sau Ä‘Ã³ cháº¡y <code>cargo publish</code> Ä‘á»ƒ táº£i phiÃªn báº£n má»›i lÃªn.</p>
<h3 id="deprecating-versions-from-cratesio-with-cargo-yank"><a class="header" href="#deprecating-versions-from-cratesio-with-cargo-yank">Deprecating Versions from Crates.io with <code>cargo yank</code></a></h3>
<p>Máº·c dÃ¹ báº¡n khÃ´ng thá»ƒ xÃ³a cÃ¡c phiÃªn báº£n trÆ°á»›c cá»§a crate, báº¡n cÃ³ thá»ƒ ngÄƒn
cÃ¡c dá»± Ã¡n má»›i thÃªm chÃºng lÃ m dependency má»›i. Äiá»u nÃ y há»¯u Ã­ch khi má»™t
phiÃªn báº£n crate bá»‹ lá»—i vÃ¬ lÃ½ do nÃ o Ä‘Ã³. Trong nhá»¯ng tÃ¬nh huá»‘ng nÃ y, Cargo
há»— trá»£ <em>yanking</em> má»™t phiÃªn báº£n crate.</p>
<p>Yanking má»™t phiÃªn báº£n ngÄƒn cÃ¡c dá»± Ã¡n má»›i phá»¥ thuá»™c vÃ o phiÃªn báº£n Ä‘Ã³
trong khi váº«n cho phÃ©p táº¥t cáº£ cÃ¡c dá»± Ã¡n hiá»‡n cÃ³ Ä‘ang phá»¥ thuá»™c vÃ o nÃ³
tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng. Vá» cÆ¡ báº£n, yank Ä‘áº£m báº£o ráº±ng táº¥t cáº£ cÃ¡c dá»± Ã¡n cÃ³
<em>Cargo.lock</em> sáº½ khÃ´ng bá»‹ phÃ¡ vá»¡, vÃ  báº¥t ká»³ <em>Cargo.lock</em> má»›i nÃ o Ä‘Æ°á»£c
táº¡o ra sáº½ khÃ´ng sá»­ dá»¥ng phiÃªn báº£n bá»‹ yank.</p>
<p>Äá»ƒ yank má»™t phiÃªn báº£n crate, trong thÆ° má»¥c cá»§a crate mÃ  báº¡n Ä‘Ã£ publish
trÆ°á»›c Ä‘Ã³, cháº¡y <code>cargo yank</code> vÃ  chá»‰ Ä‘á»‹nh phiÃªn báº£n báº¡n muá»‘n yank. VÃ­ dá»¥,
náº¿u chÃºng ta Ä‘Ã£ publish crate cÃ³ tÃªn <code>guessing_game</code> phiÃªn báº£n 1.0.1
vÃ  muá»‘n yank nÃ³, trong thÆ° má»¥c dá»± Ã¡n cá»§a <code>guessing_game</code> chÃºng ta sáº½ cháº¡y:</p>
<!-- manual-regeneration:
cargo yank carol-test --version 2.1.0
cargo yank carol-test --version 2.1.0 --undo
-->
<pre><code class="language-console">$ cargo yank --vers 1.0.1
    Updating crates.io index
        Yank guessing_game@1.0.1
</code></pre>
<p>Báº±ng cÃ¡ch thÃªm <code>--undo</code> vÃ o lá»‡nh, báº¡n cÅ©ng cÃ³ thá»ƒ hoÃ n tÃ¡c má»™t yank vÃ 
cho phÃ©p cÃ¡c dá»± Ã¡n báº¯t Ä‘áº§u phá»¥ thuá»™c vÃ o phiÃªn báº£n Ä‘Ã³ má»™t láº§n ná»¯a:</p>
<pre><code class="language-console">$ cargo yank --vers 1.0.1 --undo
    Updating crates.io index
      Unyank guessing_game@1.0.1
</code></pre>
<p>Má»™t yank <em>khÃ´ng</em> xÃ³a báº¥t ká»³ mÃ£ nÃ o. VÃ­ dá»¥, nÃ³ khÃ´ng thá»ƒ xÃ³a cÃ¡c thÃ´ng tin bÃ­ máº­t
bá»‹ táº£i lÃªn nháº§m. Náº¿u Ä‘iá»u Ä‘Ã³ xáº£y ra, báº¡n pháº£i ngay láº­p tá»©c Ä‘áº·t láº¡i nhá»¯ng thÃ´ng tin bÃ­ máº­t Ä‘Ã³.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="cargo-workspaces"><a class="header" href="#cargo-workspaces">Cargo Workspaces</a></h2>
<p>Trong ChÆ°Æ¡ng 12, chÃºng ta Ä‘Ã£ xÃ¢y dá»±ng má»™t package bao gá»“m má»™t crate nhá»‹ phÃ¢n (binary crate) vÃ  má»™t crate thÆ° viá»‡n (library crate). Khi dá»± Ã¡n phÃ¡t triá»ƒn, báº¡n cÃ³ thá»ƒ tháº¥y ráº±ng crate thÆ° viá»‡n ngÃ y cÃ ng lá»›n vÃ  muá»‘n tÃ¡ch package thÃ nh nhiá»u crate thÆ° viá»‡n hÆ¡n. Cargo cung cáº¥p má»™t tÃ­nh nÄƒng gá»i lÃ  <em>workspaces</em> giÃºp quáº£n lÃ½ nhiá»u package liÃªn quan Ä‘Æ°á»£c phÃ¡t triá»ƒn Ä‘á»“ng thá»i.</p>
<h3 id="táº¡o-workspace"><a class="header" href="#táº¡o-workspace">Táº¡o Workspace</a></h3>
<p>Má»™t <em>workspace</em> lÃ  má»™t táº­p há»£p cÃ¡c package chia sáº» cÃ¹ng má»™t <em>Cargo.lock</em> vÃ  thÆ° má»¥c Ä‘áº§u ra (output directory). HÃ£y táº¡o má»™t dá»± Ã¡n sá»­ dá»¥ng workspace â€” chÃºng ta sáº½ dÃ¹ng mÃ£ Ä‘Æ¡n giáº£n Ä‘á»ƒ táº­p trung vÃ o cáº¥u trÃºc cá»§a workspace. CÃ³ nhiá»u cÃ¡ch Ä‘á»ƒ cáº¥u trÃºc workspace, á»Ÿ Ä‘Ã¢y chÃºng ta sáº½ giá»›i thiá»‡u má»™t cÃ¡ch phá»• biáº¿n:</p>
<ul>
<li>Workspace sáº½ chá»©a má»™t crate nhá»‹ phÃ¢n vÃ  hai crate thÆ° viá»‡n.</li>
<li>Crate nhá»‹ phÃ¢n cung cáº¥p chá»©c nÄƒng chÃ­nh vÃ  sáº½ phá»¥ thuá»™c vÃ o hai crate thÆ° viá»‡n.</li>
<li>Má»™t crate thÆ° viá»‡n sáº½ cung cáº¥p hÃ m <code>add_one</code>, vÃ  crate thÆ° viá»‡n thá»© hai cung cáº¥p hÃ m <code>add_two</code>.</li>
</ul>
<p>Ba crate nÃ y sáº½ náº±m trong cÃ¹ng má»™t workspace. TrÆ°á»›c tiÃªn, chÃºng ta táº¡o má»™t thÆ° má»¥c má»›i cho workspace:</p>
<pre><code class="language-console">$ mkdir add
$ cd add
</code></pre>
<p>Tiáº¿p theo, trong thÆ° má»¥c <em>add</em>, chÃºng ta táº¡o tá»‡p <em>Cargo.toml</em> Ä‘á»ƒ cáº¥u hÃ¬nh toÃ n bá»™ workspace. Tá»‡p nÃ y sáº½ <strong>khÃ´ng</strong> cÃ³ pháº§n <code>[package]</code>. Thay vÃ o Ä‘Ã³, nÃ³ sáº½ báº¯t Ä‘áº§u vá»›i pháº§n <code>[workspace]</code> cho phÃ©p chÃºng ta thÃªm cÃ¡c thÃ nh viÃªn (members) vÃ o workspace báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh Ä‘Æ°á»ng dáº«n tá»›i package chá»©a crate nhá»‹ phÃ¢n; trong vÃ­ dá»¥ nÃ y, Ä‘Æ°á»ng dáº«n lÃ  <em>adder</em>:</p>
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">{{#include ../listings/ch14-more-about-cargo/no-listing-01-workspace-with-adder-crate/add/Cargo.toml}}
</code></pre>
<p>Tiáº¿p theo, chÃºng ta sáº½ táº¡o crate nhá»‹ phÃ¢n <code>adder</code> báº±ng cÃ¡ch cháº¡y <code>cargo new</code> trong thÆ° má»¥c <em>add</em>:</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/output-only-01-adder-crate/add
rm -rf adder
cargo new adder
copy output below
-->
<pre><code class="language-console">$ cargo new adder
     Created binary (application) `adder` package
</code></pre>
<p>Táº¡i thá»i Ä‘iá»ƒm nÃ y, chÃºng ta cÃ³ thá»ƒ build workspace báº±ng lá»‡nh <code>cargo build</code>. CÃ¡c tá»‡p trong thÆ° má»¥c <em>add</em> cá»§a báº¡n sáº½ trÃ´ng nhÆ° sau:</p>
<pre><code class="language-text">â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ adder
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main.rs
â””â”€â”€ target
</code></pre>
<p>Workspace nÃ y cÃ³ má»™t thÆ° má»¥c <em>target</em> duy nháº¥t á»Ÿ cáº¥p trÃªn, nÆ¡i cÃ¡c artifact Ä‘Æ°á»£c biÃªn dá»‹ch sáº½ Ä‘Æ°á»£c Ä‘áº·t; gÃ³i <code>adder</code> khÃ´ng cÃ³ thÆ° má»¥c <em>target</em> riÃªng. Ngay cáº£ khi chÃºng ta cháº¡y <code>cargo build</code> tá»« bÃªn trong thÆ° má»¥c <em>adder</em>, cÃ¡c artifact biÃªn dá»‹ch váº«n sáº½ náº±m trong <em>add/target</em> thay vÃ¬ <em>add/adder/target</em>. Cargo cáº¥u trÃºc thÆ° má»¥c <em>target</em> trong má»™t workspace nhÆ° váº­y vÃ¬ cÃ¡c crate trong workspace dá»± Ä‘á»‹nh phá»¥ thuá»™c láº«n nhau. Náº¿u má»—i crate cÃ³ thÆ° má»¥c <em>target</em> riÃªng, má»—i crate sáº½ pháº£i biÃªn dá»‹ch láº¡i táº¥t cáº£ cÃ¡c crate khÃ¡c trong workspace Ä‘á»ƒ Ä‘áº·t artifact vÃ o thÆ° má»¥c <em>target</em> riÃªng cá»§a nÃ³. Báº±ng cÃ¡ch chia sáº» má»™t thÆ° má»¥c <em>target</em>, cÃ¡c crate cÃ³ thá»ƒ trÃ¡nh viá»‡c biÃªn dá»‹ch láº¡i khÃ´ng cáº§n thiáº¿t.</p>
<h3 id="táº¡o-gÃ³i-thá»©-hai-trong-workspace"><a class="header" href="#táº¡o-gÃ³i-thá»©-hai-trong-workspace">Táº¡o GÃ³i Thá»© Hai Trong Workspace</a></h3>
<p>Tiáº¿p theo, chÃºng ta sáº½ táº¡o má»™t gÃ³i thÃ nh viÃªn khÃ¡c trong workspace vÃ  gá»i nÃ³ lÃ  <code>add_one</code>. Thay Ä‘á»•i tá»‡p <em>Cargo.toml</em> á»Ÿ cáº¥p trÃªn Ä‘á»ƒ chá»‰ Ä‘á»‹nh Ä‘Æ°á»ng dáº«n <em>add_one</em> trong danh sÃ¡ch <code>members</code>:</p>
<p><span class="filename">Filename: Cargo.toml</span></p>
<pre><code class="language-toml">[workspace]
resolver = "3"
members = ["adder", "add_one"]
</code></pre>
<p>Then generate a new library crate named <code>add_one</code>:</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/output-only-02-add-one/add
rm -rf add_one
cargo new add_one --lib
copy output below
-->
<pre><code class="language-console">$ cargo new add_one --lib
     Created library `add_one` package
</code></pre>
<p>Your <em>add</em> directory should now have these directories and files:</p>
<pre><code class="language-text">â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ add_one
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ lib.rs
â”œâ”€â”€ adder
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main.rs
â””â”€â”€ target
</code></pre>
<p>Trong tá»‡p <em>add_one/src/lib.rs</em>, chÃºng ta thÃªm má»™t hÃ m <code>add_one</code>:</p>
<p><span class="filename">Filename: add_one/src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn add_one(x: i32) -&gt; i32 {
    x + 1
}</code></pre>
<p>BÃ¢y giá», gÃ³i <code>adder</code> vá»›i binary cÃ³ thá»ƒ phá»¥ thuá»™c vÃ o gÃ³i <code>add_one</code> chá»©a thÆ° viá»‡n cá»§a chÃºng ta. TrÆ°á»›c tiÃªn, chÃºng ta cáº§n thÃªm má»™t <em>path dependency</em> tá»›i <code>add_one</code> trong tá»‡p <em>adder/Cargo.toml</em>:</p>
<p><span class="filename">Filename: adder/Cargo.toml</span></p>
<pre><code class="language-toml">[dependencies]
add_one = { path = "../add_one" }
</code></pre>
<p>Cargo khÃ´ng tá»± Ä‘á»™ng cho ráº±ng cÃ¡c crate trong má»™t workspace sáº½ phá»¥ thuá»™c láº«n nhau, vÃ¬ váº­y chÃºng ta cáº§n chá»‰ rÃµ má»‘i quan há»‡ phá»¥ thuá»™c.</p>
<p>Tiáº¿p theo, hÃ£y sá»­ dá»¥ng hÃ m <code>add_one</code> (tá»« crate <code>add_one</code>) trong crate <code>adder</code>. Má»Ÿ tá»‡p <em>adder/src/main.rs</em> vÃ  thÃªm má»™t dÃ²ng <code>use</code> á»Ÿ Ä‘áº§u Ä‘á»ƒ Ä‘Æ°a crate thÆ° viá»‡n <code>add_one</code> vÃ o scope. Sau Ä‘Ã³, thay Ä‘á»•i hÃ m <code>main</code> Ä‘á»ƒ gá»i hÃ m <code>add_one</code>, nhÆ° trong Listing 14-7.</p>
<p><span class="filename">Filename: adder/src/main.rs</span></p>
<pre><code class="language-rust ignore">fn main() {
    let num = 10;
    println!("Hello, world! {num} plus one is {}!", add_one::add_one(num));
}</code></pre>
<p><span class="caption">Listing 14-7: Sá»­ dá»¥ng crate thÆ° viá»‡n <code>add_one</code> tá»« crate <code>adder</code></span></p>
<p>HÃ£y biÃªn dá»‹ch toÃ n bá»™ workspace báº±ng cÃ¡ch cháº¡y lá»‡nh <code>cargo build</code> trong thÆ° má»¥c cáº¥p cao <em>add</em>!</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/listing-14-07/add
cargo build
copy output below; the output updating script doesn't handle subdirectories in paths properly
-->
<pre><code class="language-console">$ cargo build
   Compiling add_one v0.1.0 (file:///projects/add/add_one)
   Compiling adder v0.1.0 (file:///projects/add/adder)
    Finished dev [unoptimized + debuginfo] target(s) in 0.68s
</code></pre>
<p>Äá»ƒ cháº¡y crate nhá»‹ phÃ¢n tá»« thÆ° má»¥c <em>add</em>, chÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh gÃ³i muá»‘n cháº¡y trong workspace báº±ng cÃ¡ch sá»­ dá»¥ng tham sá»‘ <code>-p</code> cÃ¹ng tÃªn gÃ³i vá»›i lá»‡nh <code>cargo run</code>:</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/listing-14-07/add
cargo run -p adder
copy output below; the output updating script doesn't handle subdirectories in paths properly
-->
<pre><code class="language-console">$ cargo run -p adder
    Finished dev [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/adder`
Hello, world! 10 plus one is 11!
</code></pre>
<p>Äiá»u nÃ y sáº½ cháº¡y code trong <em>adder/src/main.rs</em>, crate nhá»‹ phÃ¢n nÃ y phá»¥ thuá»™c vÃ o crate <code>add_one</code>.</p>
<h4 id="phá»¥-thuá»™c-vÃ o-gÃ³i-bÃªn-ngoÃ i-trong-workspace"><a class="header" href="#phá»¥-thuá»™c-vÃ o-gÃ³i-bÃªn-ngoÃ i-trong-workspace">Phá»¥ thuá»™c vÃ o GÃ³i BÃªn NgoÃ i trong Workspace</a></h4>
<p>LÆ°u Ã½ ráº±ng workspace chá»‰ cÃ³ má»™t file <em>Cargo.lock</em> á»Ÿ cáº¥p cao nháº¥t, thay vÃ¬ má»—i crate cÃ³ má»™t <em>Cargo.lock</em> riÃªng. Äiá»u nÃ y Ä‘áº£m báº£o táº¥t cáº£ cÃ¡c crate Ä‘ang sá»­ dá»¥ng cÃ¹ng má»™t phiÃªn báº£n cá»§a táº¥t cáº£ cÃ¡c dependencies.</p>
<p>Náº¿u chÃºng ta thÃªm gÃ³i <code>rand</code> vÃ o cáº£ <em>adder/Cargo.toml</em> vÃ  <em>add_one/Cargo.toml</em>, Cargo sáº½ giáº£i quyáº¿t cáº£ hai vá» má»™t phiÃªn báº£n cá»§a <code>rand</code> vÃ  ghi láº¡i trong cÃ¹ng má»™t <em>Cargo.lock</em>. Viá»‡c táº¥t cáº£ cÃ¡c crate trong workspace sá»­ dá»¥ng cÃ¹ng má»™t phiÃªn báº£n dependency Ä‘áº£m báº£o cÃ¡c crate luÃ´n tÆ°Æ¡ng thÃ­ch vá»›i nhau.</p>
<p>HÃ£y thÃªm crate <code>rand</code> vÃ o pháº§n <code>[dependencies]</code> trong file <em>add_one/Cargo.toml</em> Ä‘á»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng crate <code>rand</code> trong crate <code>add_one</code>:</p>
<!-- When updating the version of `rand` used, also update the version of
`rand` used in these files so they all match:
* ch02-00-guessing-game-tutorial.md
* ch07-04-bringing-paths-into-scope-with-the-use-keyword.md
-->
<p><span class="filename">Filename: add_one/Cargo.toml</span></p>
<pre><code class="language-toml">[dependencies]
rand = "0.8.5"
</code></pre>
<p>BÃ¢y giá» chÃºng ta cÃ³ thá»ƒ thÃªm <code>use rand;</code> vÃ o file <em>add_one/src/lib.rs</em>, vÃ  khi build toÃ n bá»™ workspace báº±ng cÃ¡ch cháº¡y <code>cargo build</code> trong thÆ° má»¥c <em>add</em>, Cargo sáº½ tá»± Ä‘á»™ng táº£i vÃ  biÃªn dá»‹ch crate <code>rand</code>. ChÃºng ta sáº½ nháº­n Ä‘Æ°á»£c má»™t cáº£nh bÃ¡o vÃ¬ hiá»‡n táº¡i chÆ°a sá»­ dá»¥ng Ä‘áº¿n <code>rand</code> Ä‘Ã£ Ä‘Æ°á»£c Ä‘Æ°a vÃ o scope:</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/no-listing-03-workspace-with-external-dependency/add
cargo build
copy output below; the output updating script doesn't handle subdirectories in paths properly
-->
<pre><code class="language-console">$ cargo build
    Updating crates.io index
  Downloaded rand v0.8.5
   --snip--
   Compiling rand v0.8.5
   Compiling add_one v0.1.0 (file:///projects/add/add_one)
warning: unused import: `rand`
 --&gt; add_one/src/lib.rs:1:5
  |
1 | use rand;
  |     ^^^^
  |
  = note: `#[warn(unused_imports)]` on by default

warning: `add_one` (lib) generated 1 warning
   Compiling adder v0.1.0 (file:///projects/add/adder)
    Finished dev [unoptimized + debuginfo] target(s) in 10.18s
</code></pre>
<p>File <em>Cargo.lock</em> á»Ÿ cáº¥p trÃªn cÃ¹ng bÃ¢y giá» chá»©a thÃ´ng tin vá» viá»‡c crate <code>add_one</code> phá»¥ thuá»™c vÃ o <code>rand</code>. Tuy nhiÃªn, máº·c dÃ¹ <code>rand</code> Ä‘Æ°á»£c sá»­ dá»¥ng trong má»™t crate trong workspace, chÃºng ta khÃ´ng thá»ƒ dÃ¹ng nÃ³ trong cÃ¡c crate khÃ¡c trá»« khi thÃªm <code>rand</code> vÃ o file <em>Cargo.toml</em> cá»§a cÃ¡c crate Ä‘Ã³. VÃ­ dá»¥, náº¿u thÃªm <code>use rand;</code> vÃ o file <em>adder/src/main.rs</em> cá»§a crate <code>adder</code>, chÃºng ta sáº½ gáº·p lá»—i:</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/output-only-03-use-rand/add
cargo build
copy output below; the output updating script doesn't handle subdirectories in paths properly
-->
<pre><code class="language-console">$ cargo build
  --snip--
   Compiling adder v0.1.0 (file:///projects/add/adder)
error[E0432]: unresolved import `rand`
 --&gt; adder/src/main.rs:2:5
  |
2 | use rand;
  |     ^^^^ no external crate `rand`
</code></pre>
<p>Äá»ƒ kháº¯c phá»¥c váº¥n Ä‘á» nÃ y, chá»‰nh sá»­a file <em>Cargo.toml</em> cá»§a package <code>adder</code> vÃ  chá»‰ ra ráº±ng <code>rand</code> cÅ©ng lÃ  má»™t dependency cho nÃ³. Viá»‡c build package <code>adder</code> sáº½ thÃªm <code>rand</code> vÃ o danh sÃ¡ch dependencies cá»§a <code>adder</code> trong <em>Cargo.lock</em>, nhÆ°ng sáº½ khÃ´ng táº£i thÃªm báº£n sao nÃ o cá»§a <code>rand</code>. Cargo Ä‘áº£m báº£o ráº±ng má»i crate trong má»i package trong workspace sá»­ dá»¥ng package <code>rand</code> Ä‘á»u dÃ¹ng cÃ¹ng má»™t phiÃªn báº£n, tiáº¿t kiá»‡m khÃ´ng gian vÃ  Ä‘áº£m báº£o cÃ¡c crate trong workspace tÆ°Æ¡ng thÃ­ch vá»›i nhau.</p>
<h4 id="thÃªm-test-vÃ o-workspace"><a class="header" href="#thÃªm-test-vÃ o-workspace">ThÃªm Test vÃ o Workspace</a></h4>
<p>Má»™t cáº£i tiáº¿n khÃ¡c, hÃ£y thÃªm má»™t test cho hÃ m <code>add_one::add_one</code> trong crate <code>add_one</code>:</p>
<p><span class="filename">Filename: add_one/src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub fn add_one(x: i32) -&gt; i32 {
    x + 1
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn it_works() {
        assert_eq!(3, add_one(2));
    }
}</code></pre>
<p>BÃ¢y giá» cháº¡y <code>cargo test</code> trong thÆ° má»¥c <em>add</em> cáº¥p cao nháº¥t. Cháº¡y <code>cargo test</code>
trong má»™t workspace Ä‘Æ°á»£c cáº¥u trÃºc nhÆ° tháº¿ nÃ y sáº½ cháº¡y cÃ¡c test cho táº¥t cáº£ cÃ¡c crate trong workspace:</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/no-listing-04-workspace-with-tests/add
cargo test
copy output below; the output updating script doesn't handle subdirectories in
paths properly
-->
<pre><code class="language-console">$ cargo test
   Compiling add_one v0.1.0 (file:///projects/add/add_one)
   Compiling adder v0.1.0 (file:///projects/add/adder)
    Finished test [unoptimized + debuginfo] target(s) in 0.27s
     Running unittests src/lib.rs (target/debug/deps/add_one-f0253159197f7841)

running 1 test
test tests::it_works ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

     Running unittests src/main.rs (target/debug/deps/adder-49979ff40686fa8e)

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests add_one

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<p>Pháº§n Ä‘áº§u ra Ä‘áº§u tiÃªn cho tháº¥y test <code>it_works</code> trong crate <code>add_one</code> Ä‘Ã£ cháº¡y thÃ nh cÃ´ng.
Pháº§n tiáº¿p theo cho tháº¥y khÃ´ng cÃ³ test nÃ o Ä‘Æ°á»£c tÃ¬m tháº¥y trong crate <code>adder</code>,
vÃ  pháº§n cuá»‘i cÃ¹ng cho tháº¥y khÃ´ng cÃ³ test tÃ i liá»‡u nÃ o Ä‘Æ°á»£c tÃ¬m tháº¥y trong crate <code>add_one</code>.</p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ cháº¡y test cho má»™t crate cá»¥ thá»ƒ trong workspace tá»« thÆ° má»¥c cáº¥p cao báº±ng cÃ¡ch sá»­ dá»¥ng flag <code>-p</code>
vÃ  chá»‰ Ä‘á»‹nh tÃªn crate mÃ  ta muá»‘n test:</p>
<!-- manual-regeneration
cd listings/ch14-more-about-cargo/no-listing-04-workspace-with-tests/add
cargo test -p add_one
copy output below; the output updating script doesn't handle subdirectories in paths properly
-->
<pre><code class="language-console">$ cargo test -p add_one
    Finished test [unoptimized + debuginfo] target(s) in 0.00s
     Running unittests src/lib.rs (target/debug/deps/add_one-b3235fea9a156f74)

running 1 test
test tests::it_works ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests add_one

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<p>Pháº§n Ä‘áº§u ra nÃ y cho tháº¥y <code>cargo test</code> chá»‰ cháº¡y cÃ¡c test cho crate <code>add_one</code> vÃ  khÃ´ng cháº¡y cÃ¡c test cá»§a crate <code>adder</code>.</p>
<p>Náº¿u báº¡n muá»‘n publish cÃ¡c crate trong workspace lÃªn <a href="https://crates.io/">crates.io</a>, má»—i crate sáº½ cáº§n Ä‘Æ°á»£c publish riÃªng biá»‡t. TÆ°Æ¡ng tá»± nhÆ° <code>cargo test</code>, báº¡n cÃ³ thá»ƒ publish má»™t crate cá»¥ thá»ƒ trong workspace báº±ng cÃ¡ch sá»­ dá»¥ng flag <code>-p</code> vÃ  chá»‰ Ä‘á»‹nh tÃªn crate mÃ  báº¡n muá»‘n publish.</p>
<p>Äá»ƒ luyá»‡n táº­p thÃªm, báº¡n cÃ³ thá»ƒ thÃªm má»™t crate <code>add_two</code> vÃ o workspace nÃ y theo cÃ¡ch tÆ°Æ¡ng tá»± nhÆ° crate <code>add_one</code>.</p>
<p>Khi dá»± Ã¡n cá»§a báº¡n lá»›n lÃªn, hÃ£y cÃ¢n nháº¯c sá»­ dá»¥ng workspace: viá»‡c hiá»ƒu cÃ¡c thÃ nh pháº§n nhá», riÃªng láº» sáº½ dá»… hÆ¡n lÃ  má»™t khá»‘i code lá»›n. HÆ¡n ná»¯a, giá»¯ cÃ¡c crate trong workspace sáº½ giÃºp viá»‡c phá»‘i há»£p giá»¯a cÃ¡c crate dá»… dÃ ng hÆ¡n náº¿u chÃºng thÆ°á»ng Ä‘Æ°á»£c thay Ä‘á»•i cÃ¹ng lÃºc.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- Old link, do not remove -->
<p><a id="installing-binaries-from-cratesio-with-cargo-install"></a></p>
<h2 id="cÃ i-binaries-vá»›i-cargo-install"><a class="header" href="#cÃ i-binaries-vá»›i-cargo-install">CÃ i Binaries vá»›i <code>cargo install</code></a></h2>
<p>Lá»‡nh <code>cargo install</code> cho phÃ©p báº¡n cÃ i Ä‘áº·t vÃ  sá»­ dá»¥ng cÃ¡c binary crate <strong>cá»¥c bá»™</strong>. Lá»‡nh nÃ y khÃ´ng nháº±m thay tháº¿ cÃ¡c gÃ³i há»‡ thá»‘ng; nÃ³ chá»‰ lÃ  má»™t cÃ¡ch tiá»‡n lá»£i cho cÃ¡c láº­p trÃ¬nh viÃªn Rust Ä‘á»ƒ cÃ i Ä‘áº·t cÃ¡c cÃ´ng cá»¥ mÃ  ngÆ°á»i khÃ¡c chia sáº» trÃªn <a href="https://crates.io/">crates.io</a><!-- ignore -->.</p>
<p>LÆ°u Ã½ ráº±ng báº¡n chá»‰ cÃ³ thá»ƒ cÃ i Ä‘áº·t cÃ¡c gÃ³i cÃ³ <strong>binary targets</strong>. Má»™t <em>binary target</em> lÃ  chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ cháº¡y Ä‘Æ°á»£c Ä‘Æ°á»£c táº¡o ra náº¿u crate cÃ³ file <em>src/main.rs</em> hoáº·c má»™t file khÃ¡c Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh lÃ  binary, trÃ¡i ngÆ°á»£c vá»›i <strong>library target</strong> khÃ´ng thá»ƒ cháº¡y Ä‘á»™c láº­p mÃ  chá»‰ phÃ¹ há»£p Ä‘á»ƒ sá»­ dá»¥ng trong cÃ¡c chÆ°Æ¡ng trÃ¬nh khÃ¡c. ThÃ´ng thÆ°á»ng, cÃ¡c crate sáº½ ghi chÃº trong file <em>README</em> liá»‡u crate lÃ  library, cÃ³ binary target, hay cáº£ hai.</p>
<p>Táº¥t cáº£ cÃ¡c binaries Ä‘Æ°á»£c cÃ i báº±ng <code>cargo install</code> sáº½ Ä‘Æ°á»£c lÆ°u trong thÆ° má»¥c <em>bin</em> cá»§a <strong>installation root</strong>. Náº¿u báº¡n cÃ i Rust báº±ng <em>rustup.rs</em> vÃ  khÃ´ng cáº¥u hÃ¬nh gÃ¬ thÃªm, thÆ° má»¥c nÃ y sáº½ lÃ  <code>$HOME/.cargo/bin</code>. HÃ£y Ä‘áº£m báº£o thÆ° má»¥c nÃ y cÃ³ trong <code>$PATH</code> Ä‘á»ƒ báº¡n cÃ³ thá»ƒ cháº¡y cÃ¡c chÆ°Æ¡ng trÃ¬nh Ä‘Ã£ cÃ i báº±ng <code>cargo install</code>.</p>
<p>VÃ­ dá»¥, trong ChÆ°Æ¡ng 12, chÃºng ta Ä‘Ã£ nháº¯c tá»›i cÃ´ng cá»¥ <code>grep</code> viáº¿t báº±ng Rust cÃ³ tÃªn lÃ  <code>ripgrep</code> dÃ¹ng Ä‘á»ƒ tÃ¬m kiáº¿m trong file. Äá»ƒ cÃ i <code>ripgrep</code>, ta cháº¡y:</p>
<!-- manual-regeneration
cargo install something you don't have, copy relevant output below
-->
<pre><code class="language-console">$ cargo install ripgrep
    Updating crates.io index
  Downloaded ripgrep v13.0.0
  Downloaded 1 crate (243.3 KB) in 0.88s
  Installing ripgrep v13.0.0
--snip--
   Compiling ripgrep v13.0.0
    Finished release [optimized + debuginfo] target(s) in 3m 10s
  Installing ~/.cargo/bin/rg
   Installed package `ripgrep v13.0.0` (executable `rg`)
</code></pre>
<p>DÃ²ng thá»© hai tá»« cuá»‘i cá»§a output hiá»ƒn thá»‹ vá»‹ trÃ­ vÃ  tÃªn cá»§a binary Ä‘Ã£ cÃ i Ä‘áº·t, trong trÆ°á»ng há»£p cá»§a <code>ripgrep</code> lÃ  <code>rg</code>. Miá»…n lÃ  thÆ° má»¥c cÃ i Ä‘áº·t náº±m trong <code>$PATH</code>, nhÆ° Ä‘Ã£ Ä‘á» cáº­p trÆ°á»›c Ä‘Ã³, báº¡n cÃ³ thá»ƒ cháº¡y <code>rg --help</code> vÃ  báº¯t Ä‘áº§u sá»­ dá»¥ng cÃ´ng cá»¥ tÃ¬m kiáº¿m file nhanh hÆ¡n vÃ  â€œRustierâ€ nÃ y!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="extending-cargo-with-custom-commands"><a class="header" href="#extending-cargo-with-custom-commands">Extending Cargo with Custom Commands</a></h2>
<p>Cargo Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ báº¡n cÃ³ thá»ƒ má»Ÿ rá»™ng vá»›i cÃ¡c lá»‡nh con má»›i mÃ  khÃ´ng cáº§n pháº£i
sá»­a Ä‘á»•i Cargo. Náº¿u má»™t binary trong <code>$PATH</code> cá»§a báº¡n cÃ³ tÃªn lÃ  <code>cargo-something</code>,
báº¡n cÃ³ thá»ƒ cháº¡y nÃ³ nhÆ° thá»ƒ nÃ³ lÃ  má»™t lá»‡nh con cá»§a Cargo báº±ng cÃ¡ch cháº¡y
<code>cargo something</code>. CÃ¡c lá»‡nh tÃ¹y chá»‰nh nhÆ° tháº¿ nÃ y cÅ©ng Ä‘Æ°á»£c liá»‡t kÃª khi báº¡n cháº¡y
<code>cargo --list</code>. Kháº£ nÄƒng sá»­ dá»¥ng <code>cargo install</code> Ä‘á»ƒ cÃ i Ä‘áº·t cÃ¡c tiá»‡n Ã­ch má»Ÿ rá»™ng
vÃ  sau Ä‘Ã³ cháº¡y chÃºng giá»‘ng nhÆ° cÃ¡c cÃ´ng cá»¥ Cargo tÃ­ch há»£p lÃ  má»™t lá»£i Ã­ch cá»±c ká»³
tiá»‡n lá»£i cá»§a thiáº¿t káº¿ Cargo!</p>
<h2 id="tÃ³m-táº¯t-4"><a class="header" href="#tÃ³m-táº¯t-4">TÃ³m táº¯t</a></h2>
<p>Chia sáº» mÃ£ vá»›i Cargo vÃ  <a href="https://crates.io/">crates.io</a><!-- ignore --> lÃ  má»™t pháº§n
lÃ m cho há»‡ sinh thÃ¡i Rust há»¯u Ã­ch cho nhiá»u nhiá»‡m vá»¥ khÃ¡c nhau. ThÆ° viá»‡n chuáº©n
cá»§a Rust nhá» vÃ  á»•n Ä‘á»‹nh, nhÆ°ng cÃ¡c crate ráº¥t dá»… chia sáº», sá»­ dá»¥ng vÃ  cáº£i tiáº¿n theo
má»™t dÃ²ng thá»i gian khÃ¡c vá»›i ngÃ´n ngá»¯. Äá»«ng ngáº§n ngáº¡i chia sáº» mÃ£ mÃ  báº¡n tháº¥y há»¯u
Ã­ch trÃªn <a href="https://crates.io/">crates.io</a><!-- ignore -->; ráº¥t cÃ³ thá»ƒ nÃ³ cÅ©ng sáº½ há»¯u
Ã­ch vá»›i ngÆ°á»i khÃ¡c!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="smart-pointers"><a class="header" href="#smart-pointers">Smart Pointers</a></h1>
<p>Má»™t <em>pointer</em> lÃ  má»™t khÃ¡i niá»‡m chung cho má»™t biáº¿n chá»©a má»™t Ä‘á»‹a chá»‰ trong bá»™ nhá»›.
Äá»‹a chá»‰ nÃ y tham chiáº¿u Ä‘áº¿n, hay â€œchá»‰ vÃ o,â€ má»™t dá»¯ liá»‡u khÃ¡c. Loáº¡i pointer phá»•
biáº¿n nháº¥t trong Rust lÃ  reference, mÃ  báº¡n Ä‘Ã£ há»c trong ChÆ°Æ¡ng 4. References Ä‘Æ°á»£c
biá»ƒu thá»‹ báº±ng kÃ½ hiá»‡u <code>&amp;</code> vÃ  mÆ°á»£n giÃ¡ trá»‹ mÃ  chÃºng trá» tá»›i. ChÃºng khÃ´ng cÃ³
kháº£ nÄƒng Ä‘áº·c biá»‡t nÃ o ngoÃ i viá»‡c tham chiáº¿u dá»¯ liá»‡u vÃ  khÃ´ng cÃ³ chi phÃ­ overhead.</p>
<p><em>Smart pointers</em>, ngÆ°á»£c láº¡i, lÃ  cÃ¡c cáº¥u trÃºc dá»¯ liá»‡u hoáº¡t Ä‘á»™ng nhÆ° má»™t pointer
nhÆ°ng cÅ©ng cÃ³ metadata vÃ  kháº£ nÄƒng bá»• sung. KhÃ¡i niá»‡m smart pointer khÃ´ng chá»‰
cÃ³ á»Ÿ Rust: smart pointer báº¯t nguá»“n tá»« C++ vÃ  tá»“n táº¡i trong cÃ¡c ngÃ´n ngá»¯ khÃ¡c.
Rust cÃ³ nhiá»u smart pointer Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong thÆ° viá»‡n chuáº©n cung cáº¥p chá»©c
nÄƒng vÆ°á»£t trá»™i hÆ¡n so vá»›i references. Äá»ƒ khÃ¡m phÃ¡ khÃ¡i niá»‡m chung, chÃºng ta sáº½
xem má»™t vÃ i vÃ­ dá»¥ vá» smart pointers, bao gá»“m má»™t loáº¡i <em>reference counting</em>.
Loáº¡i pointer nÃ y cho phÃ©p dá»¯ liá»‡u cÃ³ nhiá»u chá»§ sá»Ÿ há»¯u báº±ng cÃ¡ch theo dÃµi sá»‘ lÆ°á»£ng
chá»§ sá»Ÿ há»¯u, vÃ  khi khÃ´ng cÃ²n chá»§ sá»Ÿ há»¯u nÃ o, sáº½ dá»n dáº¹p dá»¯ liá»‡u.</p>
<p>Rust, vá»›i khÃ¡i niá»‡m ownership vÃ  borrowing, cÃ³ thÃªm sá»± khÃ¡c biá»‡t giá»¯a references
vÃ  smart pointers: trong khi references chá»‰ mÆ°á»£n dá»¯ liá»‡u, trong nhiá»u trÆ°á»ng
há»£p, smart pointers <em>sá»Ÿ há»¯u</em> dá»¯ liá»‡u mÃ  chÃºng trá» tá»›i.</p>
<p>Máº·c dÃ¹ chÃºng ta chÆ°a gá»i chÃºng lÃ  smart pointers trÆ°á»›c Ä‘Ã¢y, nhÆ°ng chÃºng ta Ä‘Ã£
gáº·p má»™t vÃ i smart pointers trong cuá»‘n sÃ¡ch nÃ y, bao gá»“m <code>String</code> vÃ  <code>Vec&lt;T&gt;</code>
trong ChÆ°Æ¡ng 8. Cáº£ hai loáº¡i nÃ y Ä‘Æ°á»£c coi lÃ  smart pointers vÃ¬ chÃºng sá»Ÿ há»¯u má»™t
sá»‘ bá»™ nhá»› vÃ  cho phÃ©p báº¡n thao tÃ¡c vá»›i nÃ³. ChÃºng cÅ©ng cÃ³ metadata vÃ  kháº£ nÄƒng
bá»• sung hoáº·c Ä‘áº£m báº£o thÃªm. VÃ­ dá»¥, <code>String</code> lÆ°u trá»¯ dung lÆ°á»£ng cá»§a nÃ³ nhÆ°
metadata vÃ  cÃ³ kháº£ nÄƒng Ä‘áº£m báº£o dá»¯ liá»‡u luÃ´n há»£p lá»‡ UTF-8.</p>
<p>Smart pointers thÆ°á»ng Ä‘Æ°á»£c triá»ƒn khai báº±ng struct. KhÃ´ng giá»‘ng nhÆ° má»™t struct
bÃ¬nh thÆ°á»ng, smart pointers triá»ƒn khai cÃ¡c trait <code>Deref</code> vÃ  <code>Drop</code>. Trait <code>Deref</code>
cho phÃ©p má»™t instance cá»§a smart pointer struct hoáº¡t Ä‘á»™ng nhÆ° má»™t reference Ä‘á»ƒ
báº¡n cÃ³ thá»ƒ viáº¿t code lÃ m viá»‡c vá»›i references hoáº·c smart pointers. Trait <code>Drop</code>
cho phÃ©p báº¡n tÃ¹y chá»‰nh code Ä‘Æ°á»£c cháº¡y khi má»™t instance cá»§a smart pointer ra
khá»i scope. Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ tháº£o luáº­n vá» cáº£ hai trait vÃ  chá»©ng
minh lÃ½ do chÃºng quan trá»ng vá»›i smart pointers.</p>
<p>Vá»›i viá»‡c pattern smart pointer lÃ  má»™t pattern thiáº¿t káº¿ phá»• biáº¿n Ä‘Æ°á»£c sá»­ dá»¥ng
thÆ°á»ng xuyÃªn trong Rust, chÆ°Æ¡ng nÃ y sáº½ khÃ´ng Ä‘á» cáº­p Ä‘áº¿n táº¥t cáº£ cÃ¡c smart
pointer hiá»‡n cÃ³. Nhiá»u thÆ° viá»‡n cÃ³ smart pointer riÃªng, vÃ  báº¡n tháº­m chÃ­ cÃ³ thá»ƒ
tá»± viáº¿t smart pointer cá»§a mÃ¬nh. ChÃºng ta sáº½ Ä‘á» cáº­p Ä‘áº¿n cÃ¡c smart pointer phá»•
biáº¿n trong thÆ° viá»‡n chuáº©n:</p>
<ul>
<li><code>Box&lt;T&gt;</code> Ä‘á»ƒ cáº¥p phÃ¡t giÃ¡ trá»‹ trÃªn heap</li>
<li><code>Rc&lt;T&gt;</code>, má»™t kiá»ƒu reference counting cho phÃ©p nhiá»u chá»§ sá»Ÿ há»¯u</li>
<li><code>Ref&lt;T&gt;</code> vÃ  <code>RefMut&lt;T&gt;</code>, truy cáº­p thÃ´ng qua <code>RefCell&lt;T&gt;</code>, má»™t kiá»ƒu
thá»±c thi cÃ¡c quy táº¯c borrowing lÃºc runtime thay vÃ¬ compile time</li>
</ul>
<p>NgoÃ i ra, chÃºng ta sáº½ tháº£o luáº­n vá» pattern <em>interior mutability</em> nÆ¡i má»™t kiá»ƒu
immutable cung cáº¥p API Ä‘á»ƒ thay Ä‘á»•i giÃ¡ trá»‹ bÃªn trong. ChÃºng ta cÅ©ng sáº½ bÃ n vá»
<em>cÃ¡c vÃ²ng tham chiáº¿u (reference cycles)</em>: cÃ¡ch chÃºng cÃ³ thá»ƒ gÃ¢y rÃ² rá»‰ bá»™ nhá»›
vÃ  cÃ¡ch phÃ²ng trÃ¡nh.</p>
<p>HÃ£y cÃ¹ng khÃ¡m phÃ¡!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="sá»­-dá»¥ng-boxt-Ä‘á»ƒ-trá»-Ä‘áº¿n-dá»¯-liá»‡u-trÃªn-heap"><a class="header" href="#sá»­-dá»¥ng-boxt-Ä‘á»ƒ-trá»-Ä‘áº¿n-dá»¯-liá»‡u-trÃªn-heap">Sá»­ dá»¥ng <code>Box&lt;T&gt;</code> Ä‘á»ƒ trá» Ä‘áº¿n dá»¯ liá»‡u trÃªn Heap</a></h2>
<p>Smart pointer Ä‘Æ¡n giáº£n nháº¥t lÃ  <em>box</em>, vá»›i kiá»ƒu Ä‘Æ°á»£c viáº¿t lÃ  <code>Box&lt;T&gt;</code>. Boxes
cho phÃ©p báº¡n lÆ°u trá»¯ dá»¯ liá»‡u trÃªn heap thay vÃ¬ trÃªn stack. TrÃªn stack chá»‰ cÃ²n
pointer trá» Ä‘áº¿n dá»¯ liá»‡u trÃªn heap. Tham kháº£o ChÆ°Æ¡ng 4 Ä‘á»ƒ Ã´n láº¡i sá»± khÃ¡c biá»‡t
giá»¯a stack vÃ  heap.</p>
<p>Boxes khÃ´ng cÃ³ chi phÃ­ hiá»‡u nÄƒng nÃ o, ngoÃ i viá»‡c lÆ°u dá»¯ liá»‡u trÃªn heap thay vÃ¬
trÃªn stack. Tuy nhiÃªn, chÃºng cÅ©ng khÃ´ng cÃ³ nhiá»u kháº£ nÄƒng bá»• sung. Báº¡n sáº½
sá»­ dá»¥ng chÃºng thÆ°á»ng xuyÃªn nháº¥t trong cÃ¡c trÆ°á»ng há»£p sau:</p>
<ul>
<li>Khi báº¡n cÃ³ má»™t kiá»ƒu mÃ  kÃ­ch thÆ°á»›c khÃ´ng thá»ƒ biáº¿t táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch vÃ 
báº¡n muá»‘n sá»­ dá»¥ng giÃ¡ trá»‹ cá»§a kiá»ƒu Ä‘Ã³ trong má»™t ngá»¯ cáº£nh yÃªu cáº§u kÃ­ch thÆ°á»›c
chÃ­nh xÃ¡c</li>
<li>Khi báº¡n cÃ³ má»™t lÆ°á»£ng dá»¯ liá»‡u lá»›n vÃ  muá»‘n chuyá»ƒn quyá»n sá»Ÿ há»¯u nhÆ°ng muá»‘n
Ä‘áº£m báº£o dá»¯ liá»‡u khÃ´ng bá»‹ sao chÃ©p khi lÃ m váº­y</li>
<li>Khi báº¡n muá»‘n sá»Ÿ há»¯u má»™t giÃ¡ trá»‹ vÃ  báº¡n chá»‰ quan tÃ¢m ráº±ng nÃ³ lÃ  má»™t kiá»ƒu
triá»ƒn khai má»™t trait cá»¥ thá»ƒ, thay vÃ¬ pháº£i lÃ  má»™t kiá»ƒu cá»¥ thá»ƒ</li>
</ul>
<p>ChÃºng ta sáº½ minh há»a tÃ¬nh huá»‘ng Ä‘áº§u tiÃªn trong pháº§n <a href="ch15-01-box.html#enabling-recursive-types-with-boxes">â€œEnabling Recursive Types
with Boxesâ€</a>. Trong trÆ°á»ng há»£p thá»© hai,
viá»‡c chuyá»ƒn quyá»n sá»Ÿ há»¯u má»™t lÆ°á»£ng lá»›n dá»¯ liá»‡u cÃ³ thá»ƒ máº¥t nhiá»u thá»i gian
bá»Ÿi vÃ¬ dá»¯ liá»‡u bá»‹ sao chÃ©p trÃªn stack. Äá»ƒ cáº£i thiá»‡n hiá»‡u nÄƒng trong trÆ°á»ng
há»£p nÃ y, chÃºng ta cÃ³ thá»ƒ lÆ°u lÆ°á»£ng dá»¯ liá»‡u lá»›n trÃªn heap trong má»™t box.
Khi Ä‘Ã³, chá»‰ má»™t lÆ°á»£ng nhá» dá»¯ liá»‡u pointer Ä‘Æ°á»£c sao chÃ©p trÃªn stack, trong khi
dá»¯ liá»‡u mÃ  nÃ³ tham chiáº¿u váº«n náº±m nguyÃªn vá»‹ trÃ­ trÃªn heap. TrÆ°á»ng há»£p thá»© ba
Ä‘Æ°á»£c gá»i lÃ  <em>trait object</em>, vÃ  ChÆ°Æ¡ng 17 dÃ nh háº³n má»™t pháº§n, <a href="ch17-02-trait-objects.html#using-trait-objects-that-allow-for-values-of-different-types">â€œUsing Trait
Objects That Allow for Values of Different Types,â€</a>, Ä‘á»ƒ tháº£o luáº­n
vá» chá»§ Ä‘á» nÃ y. VÃ¬ váº­y nhá»¯ng gÃ¬ báº¡n há»c á»Ÿ Ä‘Ã¢y sáº½ Ä‘Æ°á»£c Ã¡p dá»¥ng láº¡i á»Ÿ ChÆ°Æ¡ng 17!</p>
<h3 id="sá»­-dá»¥ng-boxt-Ä‘á»ƒ-lÆ°u-dá»¯-liá»‡u-trÃªn-heap"><a class="header" href="#sá»­-dá»¥ng-boxt-Ä‘á»ƒ-lÆ°u-dá»¯-liá»‡u-trÃªn-heap">Sá»­ dá»¥ng <code>Box&lt;T&gt;</code> Ä‘á»ƒ lÆ°u dá»¯ liá»‡u trÃªn Heap</a></h3>
<p>TrÆ°á»›c khi tháº£o luáº­n vá» trÆ°á»ng há»£p lÆ°u trá»¯ trÃªn heap cho <code>Box&lt;T&gt;</code>, chÃºng ta sáº½
xem cÃº phÃ¡p vÃ  cÃ¡ch tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c lÆ°u trá»¯ bÃªn trong <code>Box&lt;T&gt;</code>.</p>
<p>Listing 15-1 minh há»a cÃ¡ch sá»­ dá»¥ng box Ä‘á»ƒ lÆ°u má»™t giÃ¡ trá»‹ <code>i32</code> trÃªn heap:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let b = Box::new(5);
    println!("b = {b}");
}</code></pre></pre>
<p><span class="caption">Listing 15-1: LÆ°u má»™t giÃ¡ trá»‹ <code>i32</code> trÃªn heap báº±ng box</span></p>
<p>ChÃºng ta Ä‘á»‹nh nghÄ©a biáº¿n <code>b</code> lÃ  má»™t <code>Box</code> trá» Ä‘áº¿n giÃ¡ trá»‹ <code>5</code>, Ä‘Æ°á»£c cáº¥p phÃ¡t
trÃªn heap. ChÆ°Æ¡ng trÃ¬nh nÃ y sáº½ in ra <code>b = 5</code>; trong trÆ°á»ng há»£p nÃ y, chÃºng ta
cÃ³ thá»ƒ truy cáº­p dá»¯ liá»‡u trong box tÆ°Æ¡ng tá»± nhÆ° khi dá»¯ liá»‡u náº±m trÃªn stack. Giá»‘ng
nhÆ° báº¥t ká»³ giÃ¡ trá»‹ nÃ o mÃ  chÃºng ta sá»Ÿ há»¯u, khi má»™t box ra khá»i pháº¡m vi, nhÆ°
<code>b</code> á»Ÿ cuá»‘i <code>main</code>, nÃ³ sáº½ Ä‘Æ°á»£c giáº£i phÃ³ng bá»™ nhá»›. Viá»‡c giáº£i phÃ³ng xáº£y ra cáº£ vá»›i
box (lÆ°u trÃªn stack) vÃ  dá»¯ liá»‡u mÃ  nÃ³ trá» Ä‘áº¿n (lÆ°u trÃªn heap).</p>
<p>Viá»‡c Ä‘áº·t má»™t giÃ¡ trá»‹ Ä‘Æ¡n láº» trÃªn heap khÃ´ng thá»±c sá»± há»¯u Ã­ch, vÃ¬ váº­y báº¡n sáº½ Ã­t
khi dÃ¹ng boxes má»™t mÃ¬nh theo cÃ¡ch nÃ y. Viá»‡c lÆ°u giÃ¡ trá»‹ nhÆ° má»™t <code>i32</code> trÃªn stack,
nÆ¡i chÃºng Ä‘Æ°á»£c lÆ°u máº·c Ä‘á»‹nh, lÃ  phÃ¹ há»£p hÆ¡n trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p. HÃ£y
xem má»™t vÃ­ dá»¥ mÃ  boxes cho phÃ©p chÃºng ta Ä‘á»‹nh nghÄ©a cÃ¡c kiá»ƒu mÃ  náº¿u khÃ´ng cÃ³
boxes thÃ¬ sáº½ khÃ´ng lÃ m Ä‘Æ°á»£c.</p>
<h3 id="cho-phÃ©p-kiá»ƒu-Ä‘á»‡-quy-vá»›i-boxes"><a class="header" href="#cho-phÃ©p-kiá»ƒu-Ä‘á»‡-quy-vá»›i-boxes">Cho phÃ©p kiá»ƒu Ä‘á»‡ quy vá»›i Boxes</a></h3>
<p>Má»™t giÃ¡ trá»‹ cá»§a <em>kiá»ƒu Ä‘á»‡ quy</em> cÃ³ thá»ƒ chá»©a má»™t giÃ¡ trá»‹ khÃ¡c cÃ¹ng kiá»ƒu bÃªn trong
nÃ³. Kiá»ƒu Ä‘á»‡ quy gáº·p váº¥n Ä‘á» vÃ¬ táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch Rust cáº§n biáº¿t má»™t kiá»ƒu
chiáº¿m bao nhiÃªu khÃ´ng gian. Tuy nhiÃªn, viá»‡c lá»“ng cÃ¡c giÃ¡ trá»‹ kiá»ƒu Ä‘á»‡ quy vá» lÃ½
thuyáº¿t cÃ³ thá»ƒ tiáº¿p tá»¥c vÃ´ háº¡n, vÃ¬ váº­y Rust khÃ´ng thá»ƒ biáº¿t chÃ­nh xÃ¡c kÃ­ch thÆ°á»›c
cáº§n thiáº¿t. VÃ¬ boxes cÃ³ kÃ­ch thÆ°á»›c xÃ¡c Ä‘á»‹nh, chÃºng ta cÃ³ thá»ƒ cho phÃ©p kiá»ƒu Ä‘á»‡
quy báº±ng cÃ¡ch chÃ¨n má»™t box trong Ä‘á»‹nh nghÄ©a kiá»ƒu Ä‘á»‡ quy.</p>
<p>Láº¥y vÃ­ dá»¥ vá» má»™t kiá»ƒu Ä‘á»‡ quy, hÃ£y xem xÃ©t <em>cons list</em>. ÄÃ¢y lÃ  má»™t kiá»ƒu dá»¯ liá»‡u
thÆ°á»ng tháº¥y trong cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh hÃ m. Kiá»ƒu cons list chÃºng ta sáº½ Ä‘á»‹nh
nghÄ©a khÃ¡ Ä‘Æ¡n giáº£n, ngoáº¡i trá»« pháº§n Ä‘á»‡ quy; do Ä‘Ã³, cÃ¡c khÃ¡i niá»‡m trong vÃ­ dá»¥ nÃ y
sáº½ há»¯u Ã­ch má»—i khi báº¡n gáº·p cÃ¡c tÃ¬nh huá»‘ng phá»©c táº¡p hÆ¡n liÃªn quan Ä‘áº¿n kiá»ƒu Ä‘á»‡
quy.</p>
<h4 id="thÃ´ng-tin-thÃªm-vá»-cons-list"><a class="header" href="#thÃ´ng-tin-thÃªm-vá»-cons-list">ThÃ´ng tin thÃªm vá» Cons List</a></h4>
<p><em>Cons list</em> lÃ  má»™t cáº¥u trÃºc dá»¯ liá»‡u xuáº¥t phÃ¡t tá»« ngÃ´n ngá»¯ láº­p trÃ¬nh Lisp vÃ  cÃ¡c
biáº¿n thá»ƒ cá»§a nÃ³, Ä‘Æ°á»£c táº¡o tá»« cÃ¡c cáº·p lá»“ng nhau, vÃ  lÃ  phiÃªn báº£n Lisp cá»§a
linked list. TÃªn cá»§a nÃ³ xuáº¥t phÃ¡t tá»« hÃ m <code>cons</code> (viáº¿t táº¯t cá»§a â€œconstruct
functionâ€) trong Lisp, dÃ¹ng Ä‘á»ƒ táº¡o má»™t cáº·p má»›i tá»« hai Ä‘á»‘i sá»‘. Báº±ng cÃ¡ch gá»i
<code>cons</code> trÃªn má»™t cáº·p gá»“m má»™t giÃ¡ trá»‹ vÃ  má»™t cáº·p khÃ¡c, chÃºng ta cÃ³ thá»ƒ táº¡o
cons lists gá»“m cÃ¡c cáº·p Ä‘á»‡ quy.</p>
<p>VÃ­ dá»¥, dÆ°á»›i Ä‘Ã¢y lÃ  biá»ƒu diá»…n giáº£ mÃ£ cá»§a má»™t cons list chá»©a danh sÃ¡ch 1, 2, 3
vá»›i má»—i cáº·p Ä‘Æ°á»£c Ä‘áº·t trong dáº¥u ngoáº·c:</p>
<pre><code class="language-text">(1, (2, (3, Nil)))
</code></pre>
<p>Má»—i pháº§n tá»­ trong cons list chá»©a hai thÃ nh pháº§n: giÃ¡ trá»‹ cá»§a pháº§n tá»­ hiá»‡n táº¡i
vÃ  pháº§n tá»­ tiáº¿p theo. Pháº§n tá»­ cuá»‘i cÃ¹ng trong danh sÃ¡ch chá»‰ chá»©a má»™t giÃ¡ trá»‹
gá»i lÃ  <code>Nil</code> mÃ  khÃ´ng cÃ³ pháº§n tá»­ tiáº¿p theo. Má»™t cons list Ä‘Æ°á»£c táº¡o ra báº±ng cÃ¡ch
gá»i Ä‘á»‡ quy hÃ m <code>cons</code>. TÃªn chuáº©n Ä‘á»ƒ chá»‰ trÆ°á»ng há»£p cÆ¡ sá»Ÿ cá»§a Ä‘á»‡ quy lÃ  <code>Nil</code>.
LÆ°u Ã½ ráº±ng Ä‘Ã¢y khÃ´ng pháº£i lÃ  cÃ¹ng khÃ¡i niá»‡m â€œnullâ€ hay â€œnilâ€ trong ChÆ°Æ¡ng 6,
mÃ  lÃ  má»™t giÃ¡ trá»‹ khÃ´ng há»£p lá»‡ hoáº·c váº¯ng máº·t.</p>
<p>Cons list khÃ´ng pháº£i lÃ  má»™t cáº¥u trÃºc dá»¯ liá»‡u thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng trong Rust.
Háº§u háº¿t thá»i gian khi báº¡n cáº§n má»™t danh sÃ¡ch cÃ¡c pháº§n tá»­ trong Rust, <code>Vec&lt;T&gt;</code>
lÃ  lá»±a chá»n tá»‘t hÆ¡n. CÃ¡c kiá»ƒu dá»¯ liá»‡u Ä‘á»‡ quy phá»©c táº¡p khÃ¡c <em>cÃ³</em> thá»ƒ há»¯u Ã­ch
trong nhiá»u tÃ¬nh huá»‘ng, nhÆ°ng báº¯t Ä‘áº§u vá»›i cons list trong chÆ°Æ¡ng nÃ y giÃºp
chÃºng ta khÃ¡m phÃ¡ cÃ¡ch boxes cho phÃ©p Ä‘á»‹nh nghÄ©a kiá»ƒu Ä‘á»‡ quy mÃ  khÃ´ng bá»‹
xao nhÃ£ng quÃ¡ nhiá»u.</p>
<p>Listing 15-2 chá»©a Ä‘á»‹nh nghÄ©a enum cho má»™t cons list. LÆ°u Ã½ ráº±ng mÃ£ nÃ y sáº½
chÆ°a biÃªn dá»‹ch Ä‘Æ°á»£c vÃ¬ kiá»ƒu <code>List</code> chÆ°a cÃ³ kÃ­ch thÆ°á»›c xÃ¡c Ä‘á»‹nh, Ä‘iá»u nÃ y
chÃºng ta sáº½ minh há»a tiáº¿p theo.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">enum List {
    Cons(i32, List),
    Nil,
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre>
<p><span class="caption">Listing 15-2: Láº§n thá»­ Ä‘áº§u tiÃªn Ä‘á»‹nh nghÄ©a enum Ä‘á»ƒ
biá»ƒu diá»…n cáº¥u trÃºc dá»¯ liá»‡u cons list chá»©a cÃ¡c giÃ¡ trá»‹ <code>i32</code></span></p>
<blockquote>
<p>LÆ°u Ã½: ChÃºng ta Ä‘ang triá»ƒn khai má»™t cons list chá»‰ chá»©a cÃ¡c giÃ¡ trá»‹ <code>i32</code>
cho vÃ­ dá»¥ nÃ y. ChÃºng ta hoÃ n toÃ n cÃ³ thá»ƒ dÃ¹ng generics, nhÆ° Ä‘Ã£ tháº£o luáº­n
trong ChÆ°Æ¡ng 10, Ä‘á»ƒ Ä‘á»‹nh nghÄ©a má»™t cons list cÃ³ thá»ƒ lÆ°u trá»¯ giÃ¡ trá»‹ cá»§a
báº¥t ká»³ kiá»ƒu nÃ o.</p>
</blockquote>
<p>Sá»­ dá»¥ng kiá»ƒu <code>List</code> Ä‘á»ƒ lÆ°u danh sÃ¡ch <code>1, 2, 3</code> sáº½ trÃ´ng nhÆ° mÃ£ trong
Listing 15-3:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">enum List {
</span><span class="boring">    Cons(i32, List),
</span><span class="boring">    Nil,
</span><span class="boring">}
</span><span class="boring">
</span>// --snip--

use crate::List::{Cons, Nil};

fn main() {
    let list = Cons(1, Cons(2, Cons(3, Nil)));
}</code></pre>
<p><span class="caption">Listing 15-3: Sá»­ dá»¥ng enum <code>List</code> Ä‘á»ƒ lÆ°u danh sÃ¡ch <code>1, 2, 3</code></span></p>
<p>GiÃ¡ trá»‹ <code>Cons</code> Ä‘áº§u tiÃªn chá»©a <code>1</code> vÃ  má»™t giÃ¡ trá»‹ <code>List</code> khÃ¡c. GiÃ¡ trá»‹ <code>List</code>
nÃ y lÃ  má»™t giÃ¡ trá»‹ <code>Cons</code> khÃ¡c chá»©a <code>2</code> vÃ  má»™t giÃ¡ trá»‹ <code>List</code> khÃ¡c ná»¯a. GiÃ¡
trá»‹ <code>List</code> nÃ y lÃ  má»™t <code>Cons</code> ná»¯a chá»©a <code>3</code> vÃ  má»™t giÃ¡ trá»‹ <code>List</code>, cuá»‘i cÃ¹ng lÃ 
<code>Nil</code>, biáº¿n thá»ƒ khÃ´ng Ä‘á»‡ quy Ä‘Ã¡nh dáº¥u káº¿t thÃºc cá»§a danh sÃ¡ch.</p>
<p>Náº¿u chÃºng ta cá»‘ gáº¯ng biÃªn dá»‹ch mÃ£ trong Listing 15-3, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c
lá»—i nhÆ° trong Listing 15-4:</p>
<pre><code class="language-console">$ cargo run
   Compiling cons-list v0.1.0 (file:///projects/cons-list)
error[E0072]: recursive type `List` has infinite size
 --&gt; src/main.rs:1:1
  |
1 | enum List {
  | ^^^^^^^^^
2 |     Cons(i32, List),
  |               ---- recursive without indirection
  |
help: insert some indirection (e.g., a `Box`, `Rc`, or `&amp;`) to break the cycle
  |
2 |     Cons(i32, Box&lt;List&gt;),
  |               ++++    +

error[E0391]: cycle detected when computing when `List` needs drop
 --&gt; src/main.rs:1:1
  |
1 | enum List {
  | ^^^^^^^^^
  |
  = note: ...which immediately requires computing when `List` needs drop again
  = note: cycle used when computing whether `List` needs drop
  = note: see https://rustc-dev-guide.rust-lang.org/overview.html#queries and https://rustc-dev-guide.rust-lang.org/query.html for more information

Some errors have detailed explanations: E0072, E0391.
For more information about an error, try `rustc --explain E0072`.
error: could not compile `cons-list` (bin "cons-list") due to 2 previous errors
</code></pre>
<p><span class="caption">Listing 15-4: Lá»—i nháº­n Ä‘Æ°á»£c khi cá»‘ gáº¯ng Ä‘á»‹nh nghÄ©a
má»™t enum Ä‘á»‡ quy</span></p>
<p>Lá»—i nÃ y cho tháº¥y kiá»ƒu nÃ y â€œcÃ³ kÃ­ch thÆ°á»›c vÃ´ háº¡nâ€. NguyÃªn nhÃ¢n lÃ  chÃºng ta Ä‘Ã£
Ä‘á»‹nh nghÄ©a <code>List</code> vá»›i má»™t biáº¿n thá»ƒ Ä‘á»‡ quy: nÃ³ trá»±c tiáº¿p chá»©a má»™t giÃ¡ trá»‹ cá»§a
chÃ­nh nÃ³. Do Ä‘Ã³, Rust khÃ´ng thá»ƒ xÃ¡c Ä‘á»‹nh cáº§n bao nhiÃªu khÃ´ng gian Ä‘á»ƒ lÆ°u má»™t
giÃ¡ trá»‹ <code>List</code>. HÃ£y phÃ¢n tÃ­ch lÃ½ do chÃºng ta nháº­n Ä‘Æ°á»£c lá»—i nÃ y. TrÆ°á»›c tiÃªn, ta
xem cÃ¡ch Rust tÃ­nh toÃ¡n kÃ­ch thÆ°á»›c cáº§n thiáº¿t Ä‘á»ƒ lÆ°u má»™t giÃ¡ trá»‹ cá»§a kiá»ƒu khÃ´ng
Ä‘á»‡ quy.</p>
<h4 id="tÃ­nh-kÃ­ch-thÆ°á»›c-cá»§a-kiá»ƒu-khÃ´ng-Äá»‡-quy"><a class="header" href="#tÃ­nh-kÃ­ch-thÆ°á»›c-cá»§a-kiá»ƒu-khÃ´ng-Äá»‡-quy">TÃ­nh KÃ­ch ThÆ°á»›c cá»§a Kiá»ƒu KhÃ´ng Äá»‡ Quy</a></h4>
<p>Nhá»› láº¡i enum <code>Message</code> mÃ  chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong Listing 6-2 khi bÃ n
vá» Ä‘á»‹nh nghÄ©a enum trong ChÆ°Æ¡ng 6:</p>
<pre><pre class="playground"><code class="language-rust edition2024">enum Message {
    Quit,
    Move { x: i32, y: i32 },
    Write(String),
    ChangeColor(i32, i32, i32),
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p>Äá»ƒ xÃ¡c Ä‘á»‹nh bao nhiÃªu khÃ´ng gian cáº§n cáº¥p phÃ¡t cho má»™t giÃ¡ trá»‹ <code>Message</code>, Rust
sáº½ xem qua tá»«ng biáº¿n thá»ƒ Ä‘á»ƒ xem biáº¿n thá»ƒ nÃ o cáº§n nhiá»u khÃ´ng gian nháº¥t. Rust
tháº¥y ráº±ng <code>Message::Quit</code> khÃ´ng cáº§n khÃ´ng gian, <code>Message::Move</code> cáº§n Ä‘á»§ khÃ´ng
gian Ä‘á»ƒ lÆ°u hai giÃ¡ trá»‹ <code>i32</code>, v.v. VÃ¬ chá»‰ cÃ³ má»™t biáº¿n thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng táº¡i
má»™t thá»i Ä‘iá»ƒm, nÃªn khÃ´ng gian tá»‘i Ä‘a mÃ  má»™t giÃ¡ trá»‹ <code>Message</code> cáº§n chÃ­nh lÃ 
khÃ´ng gian cáº§n Ä‘á»ƒ lÆ°u biáº¿n thá»ƒ lá»›n nháº¥t.</p>
<p>So sÃ¡nh vá»›i trÆ°á»ng há»£p khi Rust cá»‘ xÃ¡c Ä‘á»‹nh kÃ­ch thÆ°á»›c cáº§n thiáº¿t cho má»™t
kiá»ƒu Ä‘á»‡ quy nhÆ° enum <code>List</code> trong Listing 15-2. TrÃ¬nh biÃªn dá»‹ch báº¯t Ä‘áº§u báº±ng
viá»‡c xem biáº¿n thá»ƒ <code>Cons</code>, chá»©a má»™t giÃ¡ trá»‹ kiá»ƒu <code>i32</code> vÃ  má»™t giÃ¡ trá»‹ kiá»ƒu
<code>List</code>. Do Ä‘Ã³, <code>Cons</code> cáº§n má»™t lÆ°á»£ng khÃ´ng gian báº±ng kÃ­ch thÆ°á»›c cá»§a <code>i32</code> cá»™ng
vá»›i kÃ­ch thÆ°á»›c cá»§a <code>List</code>. Äá»ƒ tÃ­nh kÃ­ch thÆ°á»›c cá»§a kiá»ƒu <code>List</code>, trÃ¬nh biÃªn
dá»‹ch nhÃ¬n vÃ o cÃ¡c biáº¿n thá»ƒ, báº¯t Ä‘áº§u vá»›i <code>Cons</code>. Biáº¿n thá»ƒ <code>Cons</code> chá»©a má»™t
giÃ¡ trá»‹ kiá»ƒu <code>i32</code> vÃ  má»™t giÃ¡ trá»‹ kiá»ƒu <code>List</code>, vÃ  quÃ¡ trÃ¬nh nÃ y tiáº¿p tá»¥c
vÃ´ háº¡n, nhÆ° minh há»a trong HÃ¬nh 15-1.</p>
<img alt="Danh sÃ¡ch Cons vÃ´ háº¡n" src="img/trpl15-01.svg" class="center" style="width: 50%;" />
<p><span class="caption">HÃ¬nh 15-1: Má»™t <code>List</code> vÃ´ háº¡n gá»“m cÃ¡c biáº¿n thá»ƒ <code>Cons</code>
vÃ´ háº¡n</span></p>
<h4 id="sá»­-dá»¥ng-boxt-Ä‘á»ƒ-cÃ³-kiá»ƒu-Ä‘á»‡-quy-vá»›i-kÃ­ch-thÆ°á»›c-Ä‘Ã£-biáº¿t"><a class="header" href="#sá»­-dá»¥ng-boxt-Ä‘á»ƒ-cÃ³-kiá»ƒu-Ä‘á»‡-quy-vá»›i-kÃ­ch-thÆ°á»›c-Ä‘Ã£-biáº¿t">Sá»­ dá»¥ng <code>Box&lt;T&gt;</code> Ä‘á»ƒ cÃ³ kiá»ƒu Ä‘á»‡ quy vá»›i kÃ­ch thÆ°á»›c Ä‘Ã£ biáº¿t</a></h4>
<p>VÃ¬ Rust khÃ´ng thá»ƒ xÃ¡c Ä‘á»‹nh bao nhiÃªu khÃ´ng gian cáº§n cáº¥p phÃ¡t cho cÃ¡c kiá»ƒu
Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a Ä‘á»‡ quy, trÃ¬nh biÃªn dá»‹ch sáº½ Ä‘Æ°a ra lá»—i kÃ¨m theo gá»£i Ã½ há»¯u Ã­ch:</p>
<!-- manual-regeneration
after doing automatic regeneration, look at listings/ch15-smart-pointers/listing-15-03/output.txt and copy the relevant line
-->
<pre><code class="language-text">help: insert some indirection (e.g., a `Box`, `Rc`, or `&amp;`) to make `List` representable
  |
2 |     Cons(i32, Box&lt;List&gt;),
  |               ++++    +
</code></pre>
<p>Trong gá»£i Ã½ nÃ y, â€œÄ‘iá»u hÆ°á»›ng giÃ¡n tiáº¿pâ€ (indirection) cÃ³ nghÄ©a lÃ  thay vÃ¬ lÆ°u
má»™t giÃ¡ trá»‹ trá»±c tiáº¿p, chÃºng ta nÃªn thay Ä‘á»•i cáº¥u trÃºc dá»¯ liá»‡u Ä‘á»ƒ lÆ°u giÃ¡ trá»‹
má»™t cÃ¡ch giÃ¡n tiáº¿p báº±ng cÃ¡ch lÆ°u má»™t con trá» tá»›i giÃ¡ trá»‹ Ä‘Ã³.</p>
<p>VÃ¬ <code>Box&lt;T&gt;</code> lÃ  má»™t con trá», Rust luÃ´n biáº¿t kÃ­ch thÆ°á»›c cá»§a má»™t <code>Box&lt;T&gt;</code> cáº§n
bao nhiÃªu: kÃ­ch thÆ°á»›c cá»§a con trá» khÃ´ng thay Ä‘á»•i dá»±a trÃªn lÆ°á»£ng dá»¯ liá»‡u mÃ  nÃ³
trá» tá»›i. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng ta cÃ³ thá»ƒ Ä‘áº·t má»™t <code>Box&lt;T&gt;</code> bÃªn trong
biáº¿n thá»ƒ <code>Cons</code> thay vÃ¬ má»™t giÃ¡ trá»‹ <code>List</code> khÃ¡c trá»±c tiáº¿p. <code>Box&lt;T&gt;</code> sáº½ trá»
tá»›i giÃ¡ trá»‹ <code>List</code> tiáº¿p theo, giÃ¡ trá»‹ nÃ y sáº½ náº±m trÃªn heap thay vÃ¬ bÃªn trong
biáº¿n thá»ƒ <code>Cons</code>. Vá» máº·t khÃ¡i niá»‡m, chÃºng ta váº«n cÃ³ má»™t danh sÃ¡ch, Ä‘Æ°á»£c táº¡o ra
báº±ng cÃ¡ch cÃ¡c danh sÃ¡ch chá»©a cÃ¡c danh sÃ¡ch khÃ¡c, nhÆ°ng viá»‡c triá»ƒn khai nÃ y
bÃ¢y giá» giá»‘ng nhÆ° Ä‘áº·t cÃ¡c pháº§n tá»­ cáº¡nh nhau thay vÃ¬ bÃªn trong nhau.</p>
<p>ChÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i Ä‘á»‹nh nghÄ©a cá»§a enum <code>List</code> trong Listing 15-2 vÃ 
cÃ¡ch sá»­ dá»¥ng <code>List</code> trong Listing 15-3 sang mÃ£ trong Listing 15-5, mÃ£ nÃ y sáº½
biÃªn dá»‹ch Ä‘Æ°á»£c:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">enum List {
    Cons(i32, Box&lt;List&gt;),
    Nil,
}

use crate::List::{Cons, Nil};

fn main() {
    let list = Cons(1, Box::new(Cons(2, Box::new(Cons(3, Box::new(Nil))))));
}</code></pre></pre>
<p><span class="caption">Listing 15-5: Äá»‹nh nghÄ©a <code>List</code> sá»­ dá»¥ng <code>Box&lt;T&gt;</code> Ä‘á»ƒ cÃ³ kÃ­ch thÆ°á»›c xÃ¡c Ä‘á»‹nh</span></p>
<p>Biáº¿n thá»ƒ <code>Cons</code> cáº§n kÃ­ch thÆ°á»›c cá»§a má»™t <code>i32</code> cá»™ng vá»›i khÃ´ng gian Ä‘á»ƒ lÆ°u con trá» cá»§a box. Biáº¿n thá»ƒ <code>Nil</code> khÃ´ng lÆ°u trá»¯ giÃ¡ trá»‹ nÃ o, vÃ¬ váº­y nÃ³ cáº§n Ã­t khÃ´ng gian hÆ¡n biáº¿n thá»ƒ <code>Cons</code>. BÃ¢y giá» chÃºng ta biáº¿t ráº±ng báº¥t ká»³ giÃ¡ trá»‹ <code>List</code> nÃ o sáº½ chiáº¿m kÃ­ch thÆ°á»›c cá»§a má»™t <code>i32</code> cá»™ng vá»›i kÃ­ch thÆ°á»›c cá»§a con trá» trong box. Báº±ng cÃ¡ch sá»­ dá»¥ng box, chÃºng ta Ä‘Ã£ phÃ¡ vá»¡ chuá»—i Ä‘á»‡ quy vÃ´ táº­n, vÃ¬ váº­y compiler cÃ³ thá»ƒ tÃ­nh Ä‘Æ°á»£c kÃ­ch thÆ°á»›c cáº§n thiáº¿t Ä‘á»ƒ lÆ°u má»™t giÃ¡ trá»‹ <code>List</code>. HÃ¬nh 15-2 minh há»a biáº¿n thá»ƒ <code>Cons</code> hiá»‡n nay trÃ´ng nhÆ° tháº¿ nÃ o.</p>
<img alt="A finite Cons list" src="img/trpl15-02.svg" class="center" />
<p><span class="caption">HÃ¬nh 15-2: Má»™t <code>List</code> khÃ´ng vÃ´ táº­n vÃ¬ <code>Cons</code> chá»©a má»™t <code>Box</code></span></p>
<p>Box chá»‰ cung cáº¥p cÆ¡ cháº¿ giÃ¡n tiáº¿p vÃ  cáº¥p phÃ¡t trÃªn heap; nÃ³ khÃ´ng cÃ³ báº¥t ká»³ kháº£ nÄƒng Ä‘áº·c biá»‡t nÃ o khÃ¡c, nhÆ° nhá»¯ng gÃ¬ chÃºng ta sáº½ tháº¥y vá»›i cÃ¡c loáº¡i smart pointer khÃ¡c. NÃ³ cÅ©ng khÃ´ng gÃ¢y overhead vá» hiá»‡u nÄƒng mÃ  cÃ¡c kháº£ nÄƒng Ä‘áº·c biá»‡t Ä‘Ã³ mang láº¡i, vÃ¬ váº­y nÃ³ cÃ³ thá»ƒ há»¯u Ã­ch trong cÃ¡c trÆ°á»ng há»£p nhÆ° cons list, nÆ¡i cÆ¡ cháº¿ giÃ¡n tiáº¿p lÃ  tÃ­nh nÄƒng duy nháº¥t mÃ  chÃºng ta cáº§n. ChÃºng ta cÅ©ng sáº½ xem thÃªm cÃ¡c trÆ°á»ng há»£p sá»­ dá»¥ng box trong ChÆ°Æ¡ng 17.</p>
<p>Kiá»ƒu <code>Box&lt;T&gt;</code> lÃ  má»™t smart pointer vÃ¬ nÃ³ triá»ƒn khai trait <code>Deref</code>, cho phÃ©p giÃ¡ trá»‹ <code>Box&lt;T&gt;</code> Ä‘Æ°á»£c sá»­ dá»¥ng nhÆ° tham chiáº¿u. Khi má»™t giÃ¡ trá»‹ <code>Box&lt;T&gt;</code> ra khá»i pháº¡m vi, dá»¯ liá»‡u trÃªn heap mÃ  box trá» tá»›i cÅ©ng Ä‘Æ°á»£c giáº£i phÃ³ng nhá» triá»ƒn khai trait <code>Drop</code>. Hai trait nÃ y sáº½ cÃ²n quan trá»ng hÆ¡n ná»¯a Ä‘á»‘i vá»›i chá»©c nÄƒng mÃ  cÃ¡c loáº¡i smart pointer khÃ¡c cung cáº¥p mÃ  chÃºng ta sáº½ tháº£o luáº­n trong pháº§n cÃ²n láº¡i cá»§a chÆ°Æ¡ng. HÃ£y cÃ¹ng khÃ¡m phÃ¡ hai trait nÃ y chi tiáº¿t hÆ¡n.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="xá»­-lÃ½-smart-pointer-nhÆ°-tham-chiáº¿u-thÆ°á»ng-vá»›i-trait-deref"><a class="header" href="#xá»­-lÃ½-smart-pointer-nhÆ°-tham-chiáº¿u-thÆ°á»ng-vá»›i-trait-deref">Xá»­ lÃ½ Smart Pointer nhÆ° Tham Chiáº¿u ThÆ°á»ng vá»›i Trait <code>Deref</code></a></h2>
<p>Triá»ƒn khai trait <code>Deref</code> cho phÃ©p báº¡n tÃ¹y chá»‰nh hÃ nh vi cá»§a <em>toÃ¡n tá»­ dereference</em> <code>*</code> (khÃ´ng nháº§m láº«n vá»›i toÃ¡n tá»­ nhÃ¢n hoáº·c glob). Báº±ng cÃ¡ch triá»ƒn khai <code>Deref</code> sao cho smart pointer cÃ³ thá»ƒ Ä‘Æ°á»£c xá»­ lÃ½ nhÆ° má»™t tham chiáº¿u thÃ´ng thÆ°á»ng, báº¡n cÃ³ thá»ƒ viáº¿t code hoáº¡t Ä‘á»™ng trÃªn cÃ¡c tham chiáº¿u vÃ  cÅ©ng dÃ¹ng code Ä‘Ã³ vá»›i smart pointer.</p>
<p>TrÆ°á»›c tiÃªn, chÃºng ta sáº½ xem cÃ¡ch toÃ¡n tá»­ dereference hoáº¡t Ä‘á»™ng vá»›i tham chiáº¿u thÃ´ng thÆ°á»ng. Sau Ä‘Ã³, chÃºng ta sáº½ thá»­ Ä‘á»‹nh nghÄ©a má»™t kiá»ƒu tÃ¹y chá»‰nh hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° <code>Box&lt;T&gt;</code>, vÃ  xem lÃ½ do táº¡i sao toÃ¡n tá»­ dereference khÃ´ng hoáº¡t Ä‘á»™ng nhÆ° má»™t tham chiáº¿u vá»›i kiá»ƒu má»›i Ä‘á»‹nh nghÄ©a cá»§a chÃºng ta. ChÃºng ta sáº½ khÃ¡m phÃ¡ cÃ¡ch triá»ƒn khai trait <code>Deref</code> giÃºp smart pointer hoáº¡t Ä‘á»™ng tÆ°Æ¡ng tá»± tham chiáº¿u. Sau Ä‘Ã³, chÃºng ta sáº½ xem tÃ­nh nÄƒng <em>deref coercion</em> cá»§a Rust vÃ  cÃ¡ch nÃ³ cho phÃ©p lÃ m viá»‡c vá»›i cáº£ tham chiáº¿u láº«n smart pointer.</p>
<blockquote>
<p>LÆ°u Ã½: cÃ³ má»™t Ä‘iá»ƒm khÃ¡c biá»‡t lá»›n giá»¯a kiá»ƒu <code>MyBox&lt;T&gt;</code> mÃ  chÃºng ta sáº¯p xÃ¢y dá»±ng vÃ  <code>Box&lt;T&gt;</code> tháº­t: phiÃªn báº£n cá»§a chÃºng ta sáº½ khÃ´ng lÆ°u dá»¯ liá»‡u trÃªn heap. ChÃºng ta táº­p trung vÃ o vÃ­ dá»¥ nÃ y vá» <code>Deref</code>, vÃ¬ váº­y nÆ¡i dá»¯ liá»‡u thá»±c sá»± Ä‘Æ°á»£c lÆ°u khÃ´ng quan trá»ng báº±ng hÃ nh vi giá»‘ng con trá».</p>
</blockquote>
<!-- Old link, do not remove -->
<p><a id="following-the-pointer-to-the-value-with-the-dereference-operator"></a></p>
<h3 id="theo-dáº¥u-con-trá»-Ä‘áº¿n-giÃ¡-trá»‹"><a class="header" href="#theo-dáº¥u-con-trá»-Ä‘áº¿n-giÃ¡-trá»‹">Theo Dáº¥u Con Trá» Ä‘áº¿n GiÃ¡ Trá»‹</a></h3>
<p>Má»™t tham chiáº¿u thÃ´ng thÆ°á»ng lÃ  má»™t loáº¡i con trá», vÃ  má»™t cÃ¡ch Ä‘á»ƒ nghÄ© vá» con trá» lÃ  nhÆ° má»™t mÅ©i tÃªn Ä‘áº¿n má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c lÆ°u á»Ÿ nÆ¡i khÃ¡c. Trong Listing 15-6, chÃºng ta táº¡o má»™t tham chiáº¿u Ä‘áº¿n má»™t giÃ¡ trá»‹ <code>i32</code> vÃ  sau Ä‘Ã³ sá»­ dá»¥ng toÃ¡n tá»­ dereference Ä‘á»ƒ theo dáº¥u tham chiáº¿u Ä‘áº¿n giÃ¡ trá»‹:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let x = 5;
    let y = &amp;x;

    assert_eq!(5, x);
    assert_eq!(5, *y);
}</code></pre></pre>
<p><span class="caption">Listing 15-6: Sá»­ dá»¥ng toÃ¡n tá»­ dereference Ä‘á»ƒ theo dáº¥u
má»™t tham chiáº¿u Ä‘áº¿n giÃ¡ trá»‹ <code>i32</code></span></p>
<p>Biáº¿n <code>x</code> giá»¯ giÃ¡ trá»‹ <code>i32</code> lÃ  <code>5</code>. ChÃºng ta gÃ¡n <code>y</code> báº±ng má»™t tham chiáº¿u Ä‘áº¿n <code>x</code>. ChÃºng ta cÃ³ thá»ƒ xÃ¡c nháº­n ráº±ng <code>x</code> báº±ng <code>5</code>. Tuy nhiÃªn, náº¿u muá»‘n xÃ¡c nháº­n giÃ¡ trá»‹ trong <code>y</code>, chÃºng ta pháº£i sá»­ dá»¥ng <code>*y</code> Ä‘á»ƒ theo dáº¥u tham chiáº¿u Ä‘áº¿n giÃ¡ trá»‹ mÃ  nÃ³ Ä‘ang trá» tá»›i (tá»©c lÃ  <em>dereference</em>) Ä‘á»ƒ trÃ¬nh biÃªn dá»‹ch cÃ³ thá»ƒ so sÃ¡nh giÃ¡ trá»‹ thá»±c táº¿. Khi chÃºng ta dereference <code>y</code>, chÃºng ta sáº½ truy cáº­p Ä‘Æ°á»£c giÃ¡ trá»‹ sá»‘ nguyÃªn mÃ  <code>y</code> Ä‘ang trá» tá»›i vÃ  cÃ³ thá»ƒ so sÃ¡nh vá»›i <code>5</code>.</p>
<p>Náº¿u chÃºng ta cá»‘ viáº¿t <code>assert_eq!(5, y);</code> thÃ¬ sáº½ nháº­n Ä‘Æ°á»£c lá»—i biÃªn dá»‹ch sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling deref-example v0.1.0 (file:///projects/deref-example)
error[E0277]: can't compare `{integer}` with `&amp;{integer}`
 --&gt; src/main.rs:6:5
  |
6 |     assert_eq!(5, y);
  |     ^^^^^^^^^^^^^^^^ no implementation for `{integer} == &amp;{integer}`
  |
  = help: the trait `PartialEq&lt;&amp;{integer}&gt;` is not implemented for `{integer}`
  = note: this error originates in the macro `assert_eq` (in Nightly builds, run with -Z macro-backtrace for more info)

For more information about this error, try `rustc --explain E0277`.
error: could not compile `deref-example` (bin "deref-example") due to 1 previous error
</code></pre>
<p>So sÃ¡nh má»™t sá»‘ vÃ  má»™t tham chiáº¿u Ä‘áº¿n sá»‘ khÃ´ng Ä‘Æ°á»£c phÃ©p vÃ¬ chÃºng lÃ  cÃ¡c loáº¡i khÃ¡c nhau. ChÃºng ta pháº£i sá»­ dá»¥ng toÃ¡n tá»­ dereference Ä‘á»ƒ theo dáº¥u tham chiáº¿u Ä‘áº¿n giÃ¡ trá»‹ mÃ  nÃ³ Ä‘ang trá» tá»›i.</p>
<h3 id="sá»­-dá»¥ng-boxt-giá»‘ng-nhÆ°-tham-chiáº¿u"><a class="header" href="#sá»­-dá»¥ng-boxt-giá»‘ng-nhÆ°-tham-chiáº¿u">Sá»­ dá»¥ng <code>Box&lt;T&gt;</code> giá»‘ng nhÆ° tham chiáº¿u</a></h3>
<p>ChÃºng ta cÃ³ thá»ƒ viáº¿t láº¡i mÃ£ trong Listing 15-6 Ä‘á»ƒ sá»­ dá»¥ng <code>Box&lt;T&gt;</code> thay vÃ¬ má»™t tham chiáº¿u; toÃ¡n tá»­ dereference Ä‘Æ°á»£c sá»­ dá»¥ng trÃªn <code>Box&lt;T&gt;</code> trong Listing 15-7 hoáº¡t Ä‘á»™ng cÃ¹ng cÃ¡ch vá»›i toÃ¡n tá»­ dereference Ä‘Æ°á»£c sá»­ dá»¥ng trÃªn tham chiáº¿u trong Listing 15-6:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let x = 5;
    let y = Box::new(x);

    assert_eq!(5, x);
    assert_eq!(5, *y);
}</code></pre></pre>
<p><span class="caption">Listing 15-7: Sá»­ dá»¥ng toÃ¡n tá»­ dereference trÃªn má»™t
<code>Box&lt;i32&gt;</code></span></p>
<p>Sá»± khÃ¡c biá»‡t chÃ­nh giá»¯a Listing 15-7 vÃ  Listing 15-6 lÃ  á»Ÿ Ä‘Ã¢y chÃºng ta gÃ¡n
<code>y</code> thÃ nh má»™t thá»ƒ hiá»‡n cá»§a <code>Box&lt;T&gt;</code> trá» tá»›i má»™t báº£n sao cá»§a giÃ¡ trá»‹ <code>x</code>
thay vÃ¬ má»™t tham chiáº¿u trá» tá»›i giÃ¡ trá»‹ cá»§a <code>x</code>. Trong cÃ¢u lá»‡nh assert cuá»‘i,
chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng toÃ¡n tá»­ dereference Ä‘á»ƒ theo dáº¥u con trá» cá»§a <code>Box&lt;T&gt;</code>
cÃ¹ng cÃ¡ch mÃ  chÃºng ta Ä‘Ã£ lÃ m khi <code>y</code> lÃ  má»™t tham chiáº¿u. Tiáº¿p theo, chÃºng ta
sáº½ khÃ¡m phÃ¡ Ä‘iá»u gÃ¬ Ä‘áº·c biá»‡t á»Ÿ <code>Box&lt;T&gt;</code> cho phÃ©p chÃºng ta sá»­ dá»¥ng toÃ¡n tá»­
dereference báº±ng cÃ¡ch Ä‘á»‹nh nghÄ©a kiá»ƒu riÃªng cá»§a mÃ¬nh.</p>
<h3 id="Äá»‹nh-nghÄ©a-smart-pointer-cá»§a-riÃªng-chÃºng-ta"><a class="header" href="#Äá»‹nh-nghÄ©a-smart-pointer-cá»§a-riÃªng-chÃºng-ta">Äá»‹nh nghÄ©a Smart Pointer cá»§a riÃªng chÃºng ta</a></h3>
<p>HÃ£y xÃ¢y dá»±ng má»™t smart pointer tÆ°Æ¡ng tá»± nhÆ° kiá»ƒu <code>Box&lt;T&gt;</code> do thÆ° viá»‡n
chuáº©n cung cáº¥p Ä‘á»ƒ tráº£i nghiá»‡m cÃ¡ch mÃ  smart pointer hoáº¡t Ä‘á»™ng khÃ¡c vá»›i
cÃ¡c tham chiáº¿u theo máº·c Ä‘á»‹nh. Sau Ä‘Ã³, chÃºng ta sáº½ xem cÃ¡ch thÃªm kháº£ nÄƒng
sá»­ dá»¥ng toÃ¡n tá»­ dereference.</p>
<p>Kiá»ƒu <code>Box&lt;T&gt;</code> cuá»‘i cÃ¹ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° má»™t tuple struct vá»›i má»™t pháº§n tá»­,
vÃ¬ váº­y Listing 15-8 Ä‘á»‹nh nghÄ©a má»™t kiá»ƒu <code>MyBox&lt;T&gt;</code> theo cÃ¹ng cÃ¡ch. ChÃºng ta
cÅ©ng sáº½ Ä‘á»‹nh nghÄ©a má»™t hÃ m <code>new</code> Ä‘á»ƒ tÆ°Æ¡ng á»©ng vá»›i hÃ m <code>new</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a
trÃªn <code>Box&lt;T&gt;</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct MyBox&lt;T&gt;(T);

impl&lt;T&gt; MyBox&lt;T&gt; {
    fn new(x: T) -&gt; MyBox&lt;T&gt; {
        MyBox(x)
    }
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p><span class="caption">Listing 15-8: Äá»‹nh nghÄ©a kiá»ƒu <code>MyBox&lt;T&gt;</code></span></p>
<p>ChÃºng ta Ä‘á»‹nh nghÄ©a má»™t struct tÃªn lÃ  <code>MyBox</code> vÃ  khai bÃ¡o má»™t tham sá»‘ generic <code>T</code>,
vÃ¬ chÃºng ta muá»‘n kiá»ƒu cá»§a mÃ¬nh cÃ³ thá»ƒ chá»©a giÃ¡ trá»‹ cá»§a báº¥t ká»³ loáº¡i nÃ o. Kiá»ƒu
<code>MyBox</code> lÃ  má»™t tuple struct vá»›i má»™t pháº§n tá»­ cÃ³ kiá»ƒu <code>T</code>. HÃ m <code>MyBox::new</code> nháº­n
má»™t tham sá»‘ kiá»ƒu <code>T</code> vÃ  tráº£ vá» má»™t thá»ƒ hiá»‡n <code>MyBox</code> chá»©a giÃ¡ trá»‹ Ä‘Æ°á»£c truyá»n vÃ o.</p>
<p>HÃ£y thá»­ thÃªm hÃ m <code>main</code> trong Listing 15-7 vÃ o Listing 15-8 vÃ  thay Ä‘á»•i
nÃ³ Ä‘á»ƒ sá»­ dá»¥ng kiá»ƒu <code>MyBox&lt;T&gt;</code> mÃ  chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a thay vÃ¬ <code>Box&lt;T&gt;</code>.
MÃ£ trong Listing 15-9 sáº½ khÃ´ng biÃªn dá»‹ch vÃ¬ Rust khÃ´ng biáº¿t cÃ¡ch dereference
<code>MyBox</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">struct MyBox&lt;T&gt;(T);
</span><span class="boring">
</span><span class="boring">impl&lt;T&gt; MyBox&lt;T&gt; {
</span><span class="boring">    fn new(x: T) -&gt; MyBox&lt;T&gt; {
</span><span class="boring">        MyBox(x)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let x = 5;
    let y = MyBox::new(x);

    assert_eq!(5, x);
    assert_eq!(5, *y);
}</code></pre>
<p><span class="caption">Listing 15-9: Thá»­ sá»­ dá»¥ng <code>MyBox&lt;T&gt;</code> theo cÃ¹ng cÃ¡ch
chÃºng ta Ä‘Ã£ dÃ¹ng references vÃ  <code>Box&lt;T&gt;</code></span></p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  lá»—i biÃªn dá»‹ch mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c:</p>
<pre><code class="language-console">$ cargo run
   Compiling deref-example v0.1.0 (file:///projects/deref-example)
error[E0614]: type `MyBox&lt;{integer}&gt;` cannot be dereferenced
  --&gt; src/main.rs:14:19
   |
14 |     assert_eq!(5, *y);
   |                   ^^

For more information about this error, try `rustc --explain E0614`.
error: could not compile `deref-example` (bin "deref-example") due to 1 previous error
</code></pre>
<p>Kiá»ƒu <code>MyBox&lt;T&gt;</code> cá»§a chÃºng ta khÃ´ng thá»ƒ dereference Ä‘Æ°á»£c vÃ¬ chÃºng ta chÆ°a triá»ƒn khai
kháº£ nÄƒng Ä‘Ã³ cho kiá»ƒu nÃ y. Äá»ƒ cho phÃ©p dereferencing vá»›i toÃ¡n tá»­ <code>*</code>, chÃºng ta
cáº§n triá»ƒn khai trait <code>Deref</code>.</p>
<h3 id="xá»­-lÃ½-má»™t-kiá»ƒu-nhÆ°-má»™t-reference-báº±ng-cÃ¡ch-triá»ƒn-khai-trait-deref"><a class="header" href="#xá»­-lÃ½-má»™t-kiá»ƒu-nhÆ°-má»™t-reference-báº±ng-cÃ¡ch-triá»ƒn-khai-trait-deref">Xá»­ lÃ½ má»™t kiá»ƒu nhÆ° má»™t reference báº±ng cÃ¡ch triá»ƒn khai trait <code>Deref</code></a></h3>
<p>NhÆ° Ä‘Ã£ tháº£o luáº­n trong pháº§n <a href="ch10-02-traits.html#implementing-a-trait-on-a-type">â€œImplementing a Trait on a Typeâ€</a><!-- ignore -->
cá»§a ChÆ°Æ¡ng 10, Ä‘á»ƒ triá»ƒn khai má»™t trait, chÃºng ta cáº§n cung cáº¥p cÃ¡c
cÃ i Ä‘áº·t cho cÃ¡c phÆ°Æ¡ng thá»©c báº¯t buá»™c cá»§a trait Ä‘Ã³. Trait <code>Deref</code>, Ä‘Æ°á»£c cung cáº¥p
bá»Ÿi thÆ° viá»‡n chuáº©n, yÃªu cáº§u chÃºng ta triá»ƒn khai má»™t phÆ°Æ¡ng thá»©c tÃªn lÃ  <code>deref</code>
mÆ°á»£n <code>self</code> vÃ  tráº£ vá» má»™t reference Ä‘áº¿n dá»¯ liá»‡u bÃªn trong. Listing 15-10
chá»©a cÃ i Ä‘áº·t cá»§a <code>Deref</code> Ä‘á»ƒ thÃªm vÃ o Ä‘á»‹nh nghÄ©a cá»§a <code>MyBox</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::ops::Deref;

impl&lt;T&gt; Deref for MyBox&lt;T&gt; {
    type Target = T;

    fn deref(&amp;self) -&gt; &amp;Self::Target {
        &amp;self.0
    }
}
<span class="boring">
</span><span class="boring">struct MyBox&lt;T&gt;(T);
</span><span class="boring">
</span><span class="boring">impl&lt;T&gt; MyBox&lt;T&gt; {
</span><span class="boring">    fn new(x: T) -&gt; MyBox&lt;T&gt; {
</span><span class="boring">        MyBox(x)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let x = 5;
</span><span class="boring">    let y = MyBox::new(x);
</span><span class="boring">
</span><span class="boring">    assert_eq!(5, x);
</span><span class="boring">    assert_eq!(5, *y);
</span><span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 15-10: Triá»ƒn khai <code>Deref</code> trÃªn <code>MyBox&lt;T&gt;</code></span></p>
<p>CÃº phÃ¡p <code>type Target = T;</code> Ä‘á»‹nh nghÄ©a má»™t associated type cho trait <code>Deref</code> sá»­ dá»¥ng.
Associated types lÃ  má»™t cÃ¡ch hÆ¡i khÃ¡c Ä‘á»ƒ khai bÃ¡o tham sá»‘ generic, nhÆ°ng hiá»‡n
táº¡i báº¡n khÃ´ng cáº§n lo láº¯ng vá» chÃºng; chÃºng ta sáº½ tÃ¬m hiá»ƒu chi tiáº¿t hÆ¡n trong
ChÆ°Æ¡ng 19.</p>
<p>ChÃºng ta Ä‘iá»n thÃ¢n phÆ°Æ¡ng thá»©c <code>deref</code> vá»›i <code>&amp;self.0</code> Ä‘á»ƒ <code>deref</code> tráº£ vá» má»™t
reference Ä‘áº¿n giÃ¡ trá»‹ mÃ  chÃºng ta muá»‘n truy cáº­p vá»›i toÃ¡n tá»­ <code>*</code>; nhá»› láº¡i tá»«
pháº§n <a href="ch05-01-defining-structs.html#using-tuple-structs-without-named-fields-to-create-different-types">â€œUsing Tuple Structs without Named Fields to Create Different Typesâ€</a><!-- ignore -->
cá»§a ChÆ°Æ¡ng 5 ráº±ng <code>.0</code> truy cáº­p giÃ¡ trá»‹ Ä‘áº§u tiÃªn trong tuple struct. HÃ m <code>main</code>
trong Listing 15-9 gá»i <code>*</code> trÃªn giÃ¡ trá»‹ <code>MyBox&lt;T&gt;</code> bÃ¢y giá» Ä‘Ã£ biÃªn dá»‹ch Ä‘Æ°á»£c,
vÃ  cÃ¡c assertion Ä‘á»u pass!</p>
<p>Náº¿u khÃ´ng cÃ³ trait <code>Deref</code>, compiler chá»‰ cÃ³ thá»ƒ dereference cÃ¡c reference <code>&amp;</code>.
PhÆ°Æ¡ng thá»©c <code>deref</code> cung cáº¥p cho compiler kháº£ nÄƒng láº¥y má»™t giÃ¡ trá»‹ cá»§a báº¥t ká»³
kiá»ƒu nÃ o triá»ƒn khai <code>Deref</code> vÃ  gá»i phÆ°Æ¡ng thá»©c <code>deref</code> Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c má»™t reference
<code>&amp;</code> mÃ  nÃ³ biáº¿t cÃ¡ch dereference.</p>
<p>Khi chÃºng ta nháº­p <code>*y</code> trong Listing 15-9, phÃ­a sau, Rust thá»±c sá»± cháº¡y Ä‘oáº¡n
mÃ£ sau:</p>
<pre><code class="language-rust ignore">*(y.deref())</code></pre>
<p>Rust thay tháº¿ toÃ¡n tá»­ <code>*</code> báº±ng má»™t lá»i gá»i tá»›i phÆ°Æ¡ng thá»©c <code>deref</code> vÃ  sau Ä‘Ã³
má»™t dereference bÃ¬nh thÆ°á»ng, vÃ¬ váº­y chÃºng ta khÃ´ng cáº§n pháº£i nghÄ© xem cÃ³ cáº§n
gá»i phÆ°Æ¡ng thá»©c <code>deref</code> hay khÃ´ng. TÃ­nh nÄƒng nÃ y cá»§a Rust cho phÃ©p chÃºng ta
viáº¿t mÃ£ hoáº¡t Ä‘á»™ng giá»‘ng há»‡t, dÃ¹ chÃºng ta Ä‘ang dÃ¹ng má»™t reference thÃ´ng thÆ°á»ng
hay má»™t kiá»ƒu triá»ƒn khai <code>Deref</code>.</p>
<p>LÃ½ do phÆ°Æ¡ng thá»©c <code>deref</code> tráº£ vá» má»™t reference tá»›i giÃ¡ trá»‹, vÃ  dereference
bÃªn ngoÃ i dáº¥u ngoáº·c trong <code>*(y.deref())</code> váº«n cáº§n thiáº¿t, liÃªn quan tá»›i há»‡
thá»‘ng ownership. Náº¿u phÆ°Æ¡ng thá»©c <code>deref</code> tráº£ vá» giÃ¡ trá»‹ trá»±c tiáº¿p thay vÃ¬
má»™t reference tá»›i giÃ¡ trá»‹, giÃ¡ trá»‹ Ä‘Ã³ sáº½ bá»‹ move ra khá»i <code>self</code>. ChÃºng ta
khÃ´ng muá»‘n chiáº¿m quyá»n sá»Ÿ há»¯u giÃ¡ trá»‹ bÃªn trong <code>MyBox&lt;T&gt;</code> trong trÆ°á»ng
há»£p nÃ y hoáº·c trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p sá»­ dá»¥ng toÃ¡n tá»­ dereference.</p>
<p>LÆ°u Ã½ ráº±ng toÃ¡n tá»­ <code>*</code> Ä‘Æ°á»£c thay tháº¿ báº±ng má»™t lá»i gá»i tá»›i <code>deref</code> vÃ  sau Ä‘Ã³
má»™t lá»i gá»i tá»›i <code>*</code> chá»‰ má»™t láº§n, má»—i khi chÃºng ta sá»­ dá»¥ng <code>*</code> trong mÃ£.
VÃ¬ viá»‡c thay tháº¿ toÃ¡n tá»­ <code>*</code> khÃ´ng láº·p vÃ´ háº¡n, chÃºng ta cuá»‘i cÃ¹ng nháº­n Ä‘Æ°á»£c
dá»¯ liá»‡u kiá»ƒu <code>i32</code>, khá»›p vá»›i giÃ¡ trá»‹ <code>5</code> trong <code>assert_eq!</code> á»Ÿ Listing 15-9.</p>
<h3 id="chuyá»ƒn-Ä‘á»•i-deref-ngáº§m-Ä‘á»‹nh-vá»›i-hÃ m-vÃ -phÆ°Æ¡ng-thá»©c"><a class="header" href="#chuyá»ƒn-Ä‘á»•i-deref-ngáº§m-Ä‘á»‹nh-vá»›i-hÃ m-vÃ -phÆ°Æ¡ng-thá»©c">Chuyá»ƒn Ä‘á»•i Deref ngáº§m Ä‘á»‹nh vá»›i HÃ m vÃ  PhÆ°Æ¡ng thá»©c</a></h3>
<p><em>Deref coercion</em> chuyá»ƒn má»™t reference tá»›i má»™t kiá»ƒu triá»ƒn khai trait <code>Deref</code>
thÃ nh má»™t reference tá»›i kiá»ƒu khÃ¡c. VÃ­ dá»¥, deref coercion cÃ³ thá»ƒ chuyá»ƒn
<code>&amp;String</code> thÃ nh <code>&amp;str</code> vÃ¬ <code>String</code> triá»ƒn khai <code>Deref</code> Ä‘á»ƒ tráº£ vá» <code>&amp;str</code>.
Deref coercion lÃ  má»™t tiá»‡n Ã­ch mÃ  Rust thá»±c hiá»‡n trÃªn cÃ¡c Ä‘á»‘i sá»‘ cá»§a hÃ m
vÃ  phÆ°Æ¡ng thá»©c, vÃ  chá»‰ hoáº¡t Ä‘á»™ng trÃªn cÃ¡c kiá»ƒu triá»ƒn khai trait <code>Deref</code>.
NÃ³ xáº£y ra tá»± Ä‘á»™ng khi chÃºng ta truyá»n má»™t reference tá»›i giÃ¡ trá»‹ cá»§a má»™t
kiá»ƒu nháº¥t Ä‘á»‹nh lÃ m Ä‘á»‘i sá»‘ cho má»™t hÃ m hoáº·c phÆ°Æ¡ng thá»©c mÃ  kiá»ƒu tham sá»‘
trong Ä‘á»‹nh nghÄ©a hÃ m/phÆ°Æ¡ng thá»©c khÃ´ng khá»›p. Má»™t chuá»—i cÃ¡c lá»i gá»i tá»›i
phÆ°Æ¡ng thá»©c <code>deref</code> chuyá»ƒn kiá»ƒu chÃºng ta cung cáº¥p thÃ nh kiá»ƒu mÃ  tham sá»‘
cáº§n.</p>
<p>Deref coercion Ä‘Æ°á»£c thÃªm vÃ o Rust Ä‘á»ƒ láº­p trÃ¬nh viÃªn khi viáº¿t cÃ¡c lá»i gá»i
hÃ m vÃ  phÆ°Æ¡ng thá»©c khÃ´ng cáº§n thÃªm quÃ¡ nhiá»u reference vÃ  dereference
tÆ°á»ng minh vá»›i <code>&amp;</code> vÃ  <code>*</code>. TÃ­nh nÄƒng nÃ y cÅ©ng cho phÃ©p viáº¿t nhiá»u mÃ£
hÆ¡n cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng vá»›i cáº£ reference hoáº·c smart pointer.</p>
<p>Äá»ƒ tháº¥y deref coercion hoáº¡t Ä‘á»™ng, chÃºng ta hÃ£y dÃ¹ng kiá»ƒu <code>MyBox&lt;T&gt;</code> Ä‘Ã£
Ä‘á»‹nh nghÄ©a trong Listing 15-8 cÃ¹ng vá»›i viá»‡c triá»ƒn khai <code>Deref</code> mÃ  chÃºng
ta Ä‘Ã£ thÃªm trong Listing 15-10. Listing 15-11 hiá»ƒn thá»‹ Ä‘á»‹nh nghÄ©a má»™t hÃ m
cÃ³ tham sá»‘ lÃ  string slice:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn hello(name: &amp;str) {
    println!("Hello, {name}!");
}
<span class="boring">
</span><span class="boring">fn main() {}</span></code></pre></pre>
<p><span class="caption">Listing 15-11: HÃ m <code>hello</code> cÃ³ tham sá»‘ <code>name</code> kiá»ƒu <code>&amp;str</code></span></p>
<p>ChÃºng ta cÃ³ thá»ƒ gá»i hÃ m <code>hello</code> vá»›i má»™t string slice lÃ m Ä‘á»‘i sá»‘, vÃ­ dá»¥:
<code>hello("Rust");</code>. Deref coercion cho phÃ©p gá»i hÃ m <code>hello</code> vá»›i má»™t reference
tá»›i giÃ¡ trá»‹ kiá»ƒu <code>MyBox&lt;String&gt;</code>, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 15-12:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">use std::ops::Deref;
</span><span class="boring">
</span><span class="boring">impl&lt;T&gt; Deref for MyBox&lt;T&gt; {
</span><span class="boring">    type Target = T;
</span><span class="boring">
</span><span class="boring">    fn deref(&amp;self) -&gt; &amp;T {
</span><span class="boring">        &amp;self.0
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct MyBox&lt;T&gt;(T);
</span><span class="boring">
</span><span class="boring">impl&lt;T&gt; MyBox&lt;T&gt; {
</span><span class="boring">    fn new(x: T) -&gt; MyBox&lt;T&gt; {
</span><span class="boring">        MyBox(x)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn hello(name: &amp;str) {
</span><span class="boring">    println!("Hello, {name}!");
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let m = MyBox::new(String::from("Rust"));
    hello(&amp;m);
}</code></pre></pre>
<p><span class="caption">Listing 15-12: Gá»i hÃ m <code>hello</code> vá»›i reference tá»›i giÃ¡ trá»‹
<code>MyBox&lt;String&gt;</code>, hoáº¡t Ä‘á»™ng nhá» deref coercion</span></p>
<p>á» Ä‘Ã¢y chÃºng ta gá»i hÃ m <code>hello</code> vá»›i Ä‘á»‘i sá»‘ <code>&amp;m</code>, lÃ  má»™t reference tá»›i giÃ¡ trá»‹
<code>MyBox&lt;String&gt;</code>. Bá»Ÿi vÃ¬ chÃºng ta Ä‘Ã£ triá»ƒn khai trait <code>Deref</code> trÃªn <code>MyBox&lt;T&gt;</code>
trong Listing 15-10, Rust cÃ³ thá»ƒ chuyá»ƒn <code>&amp;MyBox&lt;String&gt;</code> thÃ nh <code>&amp;String</code> báº±ng
cÃ¡ch gá»i <code>deref</code>. ThÆ° viá»‡n chuáº©n cung cáº¥p má»™t triá»ƒn khai <code>Deref</code> trÃªn <code>String</code>
tráº£ vá» má»™t string slice, vÃ  Ä‘iá»u nÃ y cÃ³ trong tÃ i liá»‡u API cá»§a <code>Deref</code>. Rust
láº¡i gá»i <code>deref</code> láº§n ná»¯a Ä‘á»ƒ chuyá»ƒn <code>&amp;String</code> thÃ nh <code>&amp;str</code>, phÃ¹ há»£p vá»›i Ä‘á»‹nh
nghÄ©a cá»§a hÃ m <code>hello</code>.</p>
<p>Náº¿u Rust khÃ´ng thá»±c hiá»‡n deref coercion, chÃºng ta sáº½ pháº£i viáº¿t mÃ£ nhÆ° trong
Listing 15-13 thay vÃ¬ mÃ£ trong Listing 15-12 Ä‘á»ƒ gá»i <code>hello</code> vá»›i má»™t giÃ¡ trá»‹
kiá»ƒu <code>&amp;MyBox&lt;String&gt;</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">use std::ops::Deref;
</span><span class="boring">
</span><span class="boring">impl&lt;T&gt; Deref for MyBox&lt;T&gt; {
</span><span class="boring">    type Target = T;
</span><span class="boring">
</span><span class="boring">    fn deref(&amp;self) -&gt; &amp;T {
</span><span class="boring">        &amp;self.0
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct MyBox&lt;T&gt;(T);
</span><span class="boring">
</span><span class="boring">impl&lt;T&gt; MyBox&lt;T&gt; {
</span><span class="boring">    fn new(x: T) -&gt; MyBox&lt;T&gt; {
</span><span class="boring">        MyBox(x)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn hello(name: &amp;str) {
</span><span class="boring">    println!("Hello, {name}!");
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let m = MyBox::new(String::from("Rust"));
    hello(&amp;(*m)[..]);
}</code></pre></pre>
<p><span class="caption">Listing 15-13: MÃ£ mÃ  chÃºng ta pháº£i viáº¿t náº¿u Rust
khÃ´ng cÃ³ deref coercion</span></p>
<p><code>(*m)</code> dereference <code>MyBox&lt;String&gt;</code> thÃ nh má»™t <code>String</code>. Sau Ä‘Ã³, <code>&amp;</code> vÃ  <code>[..]</code>
láº¥y má»™t string slice cá»§a <code>String</code> báº±ng toÃ n bá»™ chuá»—i Ä‘á»ƒ phÃ¹ há»£p vá»›i chá»¯ kÃ½
cá»§a hÃ m <code>hello</code>. MÃ£ nÃ y náº¿u khÃ´ng cÃ³ deref coercion sáº½ khÃ³ Ä‘á»c, viáº¿t vÃ  hiá»ƒu
vá»›i táº¥t cáº£ cÃ¡c kÃ½ hiá»‡u phá»©c táº¡p nÃ y. Deref coercion cho phÃ©p Rust xá»­ lÃ½
tá»± Ä‘á»™ng cÃ¡c chuyá»ƒn Ä‘á»•i nÃ y.</p>
<p>Khi trait <code>Deref</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a cho cÃ¡c kiá»ƒu liÃªn quan, Rust sáº½ phÃ¢n tÃ­ch
cÃ¡c kiá»ƒu vÃ  sá»­ dá»¥ng <code>Deref::deref</code> nhiá»u láº§n tÃ¹y cáº§n Ä‘á»ƒ cÃ³ má»™t reference
phÃ¹ há»£p vá»›i kiá»ƒu cá»§a tham sá»‘. Sá»‘ láº§n <code>Deref::deref</code> Ä‘Æ°á»£c chÃ¨n Ä‘Æ°á»£c quyáº¿t
Ä‘á»‹nh táº¡i thá»i gian biÃªn dá»‹ch, nÃªn khÃ´ng cÃ³ chi phÃ­ runtime khi sá»­ dá»¥ng
deref coercion!</p>
<h3 id="cÃ¡ch-deref-coercion-tÆ°Æ¡ng-tÃ¡c-vá»›i-mutability"><a class="header" href="#cÃ¡ch-deref-coercion-tÆ°Æ¡ng-tÃ¡c-vá»›i-mutability">CÃ¡ch Deref Coercion TÆ°Æ¡ng TÃ¡c vá»›i Mutability</a></h3>
<p>TÆ°Æ¡ng tá»± nhÆ° cÃ¡ch báº¡n dÃ¹ng trait <code>Deref</code> Ä‘á»ƒ override toÃ¡n tá»­ <code>*</code> trÃªn
reference khÃ´ng thay Ä‘á»•i, báº¡n cÃ³ thá»ƒ dÃ¹ng trait <code>DerefMut</code> Ä‘á»ƒ override
toÃ¡n tá»­ <code>*</code> trÃªn reference cÃ³ thá»ƒ thay Ä‘á»•i.</p>
<p>Rust thá»±c hiá»‡n deref coercion trong ba trÆ°á»ng há»£p:</p>
<ul>
<li>Tá»« <code>&amp;T</code> sang <code>&amp;U</code> khi <code>T: Deref&lt;Target=U&gt;</code></li>
<li>Tá»« <code>&amp;mut T</code> sang <code>&amp;mut U</code> khi <code>T: DerefMut&lt;Target=U&gt;</code></li>
<li>Tá»« <code>&amp;mut T</code> sang <code>&amp;U</code> khi <code>T: Deref&lt;Target=U&gt;</code></li>
</ul>
<p>Hai trÆ°á»ng há»£p Ä‘áº§u giá»‘ng nhau ngoáº¡i trá»« trÆ°á»ng há»£p thá»© hai Ã¡p dá»¥ng cho
mutable references. TrÆ°á»ng há»£p Ä‘áº§u nÃ³i ráº±ng náº¿u báº¡n cÃ³ má»™t <code>&amp;T</code>, vÃ  <code>T</code>
triá»ƒn khai <code>Deref</code> tá»›i kiá»ƒu <code>U</code>, báº¡n cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c má»™t <code>&amp;U</code> má»™t cÃ¡ch
trong suá»‘t. TrÆ°á»ng há»£p thá»© hai cÅ©ng xáº£y ra tÆ°Æ¡ng tá»± cho mutable references.</p>
<p>TrÆ°á»ng há»£p thá»© ba phá»©c táº¡p hÆ¡n: Rust cÅ©ng sáº½ coercion má»™t mutable reference
thÃ nh immutable reference. NhÆ°ng ngÆ°á»£c láº¡i <em>khÃ´ng</em> thá»±c hiá»‡n Ä‘Æ°á»£c: immutable
references sáº½ khÃ´ng bao giá» coercion thÃ nh mutable references. Theo quy táº¯c
mÆ°á»£n, náº¿u báº¡n cÃ³ má»™t mutable reference, reference Ä‘Ã³ pháº£i lÃ  reference duy
nháº¥t tá»›i dá»¯ liá»‡u Ä‘Ã³ (náº¿u khÃ´ng, chÆ°Æ¡ng trÃ¬nh sáº½ khÃ´ng biÃªn dá»‹ch). Viá»‡c
chuyá»ƒn má»™t mutable reference thÃ nh immutable reference sáº½ khÃ´ng vi pháº¡m
quy táº¯c mÆ°á»£n. NgÆ°á»£c láº¡i, chuyá»ƒn má»™t immutable reference thÃ nh mutable
reference sáº½ yÃªu cáº§u reference immutable ban Ä‘áº§u lÃ  reference duy nháº¥t tá»›i
dá»¯ liá»‡u Ä‘Ã³, nhÆ°ng quy táº¯c mÆ°á»£n khÃ´ng Ä‘áº£m báº£o Ä‘iá»u nÃ y. Do Ä‘Ã³, Rust khÃ´ng
thá»ƒ giáº£ Ä‘á»‹nh ráº±ng chuyá»ƒn Ä‘á»•i immutable reference thÃ nh mutable reference lÃ 
kháº£ thi.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="cháº¡y-code-khi-dá»n-dáº¹p-vá»›i-trait-drop"><a class="header" href="#cháº¡y-code-khi-dá»n-dáº¹p-vá»›i-trait-drop">Cháº¡y Code Khi Dá»n Dáº¹p vá»›i Trait <code>Drop</code></a></h2>
<p>Trait thá»© hai quan trá»ng vá»›i máº«u thiáº¿t káº¿ smart pointer lÃ  <code>Drop</code>, cho phÃ©p
báº¡n tÃ¹y chá»‰nh nhá»¯ng gÃ¬ xáº£y ra khi má»™t giÃ¡ trá»‹ sáº¯p ra khá»i pháº¡m vi. Báº¡n cÃ³
thá»ƒ cung cáº¥p má»™t triá»ƒn khai cho trait <code>Drop</code> trÃªn báº¥t ká»³ kiá»ƒu nÃ o, vÃ  mÃ£ Ä‘Ã³
cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ giáº£i phÃ³ng tÃ i nguyÃªn nhÆ° file hoáº·c káº¿t ná»‘i máº¡ng.</p>
<p>ChÃºng ta giá»›i thiá»‡u <code>Drop</code> trong bá»‘i cáº£nh smart pointer vÃ¬ chá»©c nÄƒng cá»§a
trait <code>Drop</code> háº§u nhÆ° luÃ´n Ä‘Æ°á»£c sá»­ dá»¥ng khi triá»ƒn khai smart pointer. VÃ­
dá»¥, khi má»™t <code>Box&lt;T&gt;</code> bá»‹ drop, nÃ³ sáº½ giáº£i phÃ³ng khÃ´ng gian trÃªn heap mÃ  box
trá» tá»›i.</p>
<p>Trong má»™t sá»‘ ngÃ´n ngá»¯, vá»›i má»™t sá»‘ kiá»ƒu, láº­p trÃ¬nh viÃªn pháº£i gá»i mÃ£ Ä‘á»ƒ
giáº£i phÃ³ng bá»™ nhá»› hoáº·c tÃ i nguyÃªn má»—i khi há» sá»­ dá»¥ng xong má»™t thá»ƒ hiá»‡n
cá»§a cÃ¡c kiá»ƒu Ä‘Ã³. VÃ­ dá»¥ bao gá»“m file handles, sockets, hoáº·c locks. Náº¿u há»
quÃªn, há»‡ thá»‘ng cÃ³ thá»ƒ bá»‹ quÃ¡ táº£i vÃ  crash. Trong Rust, báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh
ráº±ng má»™t Ä‘oáº¡n mÃ£ cá»¥ thá»ƒ sáº½ cháº¡y báº¥t cá»© khi nÃ o má»™t giÃ¡ trá»‹ ra khá»i pháº¡m
vi, vÃ  compiler sáº½ tá»± Ä‘á»™ng chÃ¨n Ä‘oáº¡n mÃ£ Ä‘Ã³. Káº¿t quáº£ lÃ  báº¡n khÃ´ng cáº§n lo
láº¯ng vá» viá»‡c Ä‘áº·t mÃ£ dá»n dáº¹p á»Ÿ kháº¯p nÆ¡i trong chÆ°Æ¡ng trÃ¬nh khi má»™t thá»ƒ
hiá»‡n cá»§a má»™t kiá»ƒu cá»¥ thá»ƒ káº¿t thÃºc â€” báº¡n váº«n sáº½ khÃ´ng bá»‹ rÃ² rá»‰ tÃ i
nguyÃªn!</p>
<p>Báº¡n chá»‰ Ä‘á»‹nh Ä‘oáº¡n mÃ£ cháº¡y khi má»™t giÃ¡ trá»‹ ra khá»i pháº¡m vi báº±ng cÃ¡ch triá»ƒn
khai trait <code>Drop</code>. Trait <code>Drop</code> yÃªu cáº§u báº¡n triá»ƒn khai má»™t phÆ°Æ¡ng thá»©c tÃªn
lÃ  <code>drop</code> nháº­n má»™t mutable reference tá»›i <code>self</code>. Äá»ƒ tháº¥y khi nÃ o Rust
gá»i <code>drop</code>, chÃºng ta sáº½ triá»ƒn khai <code>drop</code> vá»›i cÃ¡c lá»‡nh <code>println!</code> trÆ°á»›c
Ä‘á»ƒ quan sÃ¡t.</p>
<p>Listing 15-14 hiá»ƒn thá»‹ má»™t struct <code>CustomSmartPointer</code> mÃ  chá»©c nÄƒng tÃ¹y
chá»‰nh duy nháº¥t lÃ  in ra <code>Dropping CustomSmartPointer!</code> khi thá»ƒ hiá»‡n ra
khá»i pháº¡m vi, Ä‘á»ƒ minh há»a khi Rust cháº¡y hÃ m <code>drop</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">struct CustomSmartPointer {
    data: String,
}

impl Drop for CustomSmartPointer {
    fn drop(&amp;mut self) {
        println!("Dropping CustomSmartPointer with data `{}`!", self.data);
    }
}

fn main() {
    let c = CustomSmartPointer {
        data: String::from("my stuff"),
    };
    let d = CustomSmartPointer {
        data: String::from("other stuff"),
    };
    println!("CustomSmartPointers created.");
}</code></pre></pre>
<p><span class="caption">Listing 15-14: Má»™t struct <code>CustomSmartPointer</code> triá»ƒn khai trait <code>Drop</code>, nÆ¡i chÃºng ta sáº½ Ä‘áº·t code dá»n dáº¹p</span></p>
<p>Trait <code>Drop</code> Ä‘Ã£ Ä‘Æ°á»£c bao gá»“m trong prelude, nÃªn chÃºng ta khÃ´ng cáº§n pháº£i Ä‘Æ°a
nÃ³ vÃ o pháº¡m vi. ChÃºng ta triá»ƒn khai trait <code>Drop</code> trÃªn <code>CustomSmartPointer</code>
vÃ  cung cáº¥p má»™t triá»ƒn khai cho phÆ°Æ¡ng thá»©c <code>drop</code> gá»i <code>println!</code>. ThÃ¢n
hÃ m <code>drop</code> lÃ  nÆ¡i báº¡n sáº½ Ä‘áº·t báº¥t ká»³ logic nÃ o mÃ  báº¡n muá»‘n cháº¡y khi má»™t
thá»ƒ hiá»‡n cá»§a kiá»ƒu cá»§a báº¡n ra khá»i pháº¡m vi. á» Ä‘Ã¢y chÃºng ta in ra má»™t sá»‘
vÄƒn báº£n Ä‘á»ƒ trá»±c quan minh há»a khi Rust sáº½ gá»i <code>drop</code>.</p>
<p>Trong hÃ m <code>main</code>, chÃºng ta táº¡o hai thá»ƒ hiá»‡n cá»§a <code>CustomSmartPointer</code> vÃ 
sau Ä‘Ã³ in ra <code>CustomSmartPointers created</code>. á» cuá»‘i <code>main</code>, cÃ¡c thá»ƒ hiá»‡n
cá»§a <code>CustomSmartPointer</code> sáº½ ra khá»i pháº¡m vi, vÃ  Rust sáº½ gá»i Ä‘oáº¡n code
chÃºng ta Ä‘áº·t trong phÆ°Æ¡ng thá»©c <code>drop</code>, in ra thÃ´ng Ä‘iá»‡p cuá»‘i cÃ¹ng. LÆ°u
Ã½ ráº±ng chÃºng ta khÃ´ng cáº§n pháº£i gá»i phÆ°Æ¡ng thá»©c <code>drop</code> má»™t cÃ¡ch rÃµ rÃ ng.</p>
<p>Khi cháº¡y chÆ°Æ¡ng trÃ¬nh nÃ y, chÃºng ta sáº½ tháº¥y Ä‘áº§u ra nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling drop-example v0.1.0 (file:///projects/drop-example)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.60s
     Running `target/debug/drop-example`
CustomSmartPointers created.
Dropping CustomSmartPointer with data `other stuff`!
Dropping CustomSmartPointer with data `my stuff`!
</code></pre>
<p>Rust tá»± Ä‘á»™ng gá»i <code>drop</code> cho chÃºng ta khi cÃ¡c thá»ƒ hiá»‡n ra khá»i pháº¡m vi,
thá»±c thi Ä‘oáº¡n code mÃ  chÃºng ta Ä‘Ã£ chá»‰ Ä‘á»‹nh. CÃ¡c biáº¿n Ä‘Æ°á»£c drop theo thá»© tá»±
ngÆ°á»£c láº¡i vá»›i thá»© tá»± táº¡o ra, nÃªn <code>d</code> Ä‘Æ°á»£c drop trÆ°á»›c <code>c</code>. Má»¥c Ä‘Ã­ch cá»§a
vÃ­ dá»¥ nÃ y lÃ  Ä‘á»ƒ cung cáº¥p má»™t hÆ°á»›ng dáº«n trá»±c quan vá» cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a
phÆ°Æ¡ng thá»©c <code>drop</code>; thÆ°á»ng thÃ¬ báº¡n sáº½ Ä‘áº·t code dá»n dáº¹p mÃ  kiá»ƒu cá»§a báº¡n
cáº§n cháº¡y thay vÃ¬ má»™t thÃ´ng Ä‘iá»‡p in ra.</p>
<h3 id="drop-má»™t-giÃ¡-trá»‹-sá»›m-vá»›i-stdmemdrop"><a class="header" href="#drop-má»™t-giÃ¡-trá»‹-sá»›m-vá»›i-stdmemdrop">Drop má»™t giÃ¡ trá»‹ sá»›m vá»›i <code>std::mem::drop</code></a></h3>
<p>Tháº­t khÃ´ng may, viá»‡c táº¯t chá»©c nÄƒng <code>drop</code> tá»± Ä‘á»™ng khÃ´ng Ä‘Æ¡n giáº£n. ThÃ´ng
thÆ°á»ng, viá»‡c táº¯t <code>drop</code> khÃ´ng cáº§n thiáº¿t; toÃ n bá»™ má»¥c Ä‘Ã­ch cá»§a trait
<code>Drop</code> lÃ  nÃ³ Ä‘Æ°á»£c thá»±c hiá»‡n tá»± Ä‘á»™ng. Tuy nhiÃªn, Ä‘Ã´i khi báº¡n cÃ³ thá»ƒ muá»‘n
dá»n dáº¹p má»™t giÃ¡ trá»‹ sá»›m. Má»™t vÃ­ dá»¥ lÃ  khi sá»­ dá»¥ng smart pointer quáº£n lÃ½
lock: báº¡n cÃ³ thá»ƒ muá»‘n buá»™c phÆ°Æ¡ng thá»©c <code>drop</code> giáº£i phÃ³ng lock Ä‘á»ƒ cÃ¡c
Ä‘oáº¡n code khÃ¡c trong cÃ¹ng pháº¡m vi cÃ³ thá»ƒ láº¥y lock. Rust khÃ´ng cho phÃ©p
báº¡n gá»i trá»±c tiáº¿p phÆ°Æ¡ng thá»©c <code>drop</code> cá»§a trait <code>Drop</code>; thay vÃ o Ä‘Ã³, báº¡n
pháº£i gá»i hÃ m <code>std::mem::drop</code> do thÆ° viá»‡n chuáº©n cung cáº¥p náº¿u muá»‘n buá»™c
má»™t giÃ¡ trá»‹ bá»‹ drop trÆ°á»›c khi káº¿t thÃºc pháº¡m vi cá»§a nÃ³.</p>
<p>Náº¿u chÃºng ta thá»­ gá»i phÆ°Æ¡ng thá»©c <code>drop</code> cá»§a trait <code>Drop</code> má»™t cÃ¡ch thá»§
cÃ´ng báº±ng cÃ¡ch sá»­a hÃ m <code>main</code> tá»« Listing 15-14, nhÆ° trong Listing 15-15,
chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i biÃªn dá»‹ch:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">struct CustomSmartPointer {
</span><span class="boring">    data: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Drop for CustomSmartPointer {
</span><span class="boring">    fn drop(&amp;mut self) {
</span><span class="boring">        println!("Dropping CustomSmartPointer with data `{}`!", self.data);
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let c = CustomSmartPointer {
        data: String::from("some data"),
    };
    println!("CustomSmartPointer created.");
    c.drop();
    println!("CustomSmartPointer dropped before the end of main.");
}</code></pre>
<p><span class="caption">Listing 15-15: Thá»­ gá»i phÆ°Æ¡ng thá»©c <code>drop</code> tá»«
trait <code>Drop</code> má»™t cÃ¡ch thá»§ cÃ´ng Ä‘á»ƒ dá»n dáº¹p sá»›m</span></p>
<p>Khi chÃºng ta cá»‘ gáº¯ng biÃªn dá»‹ch Ä‘oáº¡n code nÃ y, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling drop-example v0.1.0 (file:///projects/drop-example)
error[E0040]: explicit use of destructor method
  --&gt; src/main.rs:16:7
   |
16 |     c.drop();
   |       ^^^^ explicit destructor calls not allowed
   |
help: consider using `drop` function
   |
16 |     drop(c);
   |     +++++ ~

For more information about this error, try `rustc --explain E0040`.
error: could not compile `drop-example` (bin "drop-example") due to 1 previous error
</code></pre>
<p>ThÃ´ng bÃ¡o lá»—i nÃ y cho biáº¿t ráº±ng chÃºng ta khÃ´ng Ä‘Æ°á»£c phÃ©p gá»i <code>drop</code> má»™t cÃ¡ch rÃµ rÃ ng. ThÃ´ng bÃ¡o lá»—i sá»­ dá»¥ng thuáº­t ngá»¯ <em>destructor</em>, Ä‘Ã¢y lÃ  thuáº­t ngá»¯ láº­p trÃ¬nh chung Ä‘á»ƒ chá»‰ má»™t hÃ m dá»n dáº¹p má»™t thá»ƒ hiá»‡n. Má»™t <em>destructor</em> tÆ°Æ¡ng tá»± nhÆ° má»™t <em>constructor</em>, nhÆ°ng thay vÃ¬ táº¡o thá»ƒ hiá»‡n thÃ¬ nÃ³ dá»n dáº¹p thá»ƒ hiá»‡n Ä‘Ã³. HÃ m <code>drop</code> trong Rust lÃ  má»™t destructor cá»¥ thá»ƒ.</p>
<p>Rust khÃ´ng cho phÃ©p chÃºng ta gá»i <code>drop</code> trá»±c tiáº¿p vÃ¬ Rust váº«n sáº½ tá»± Ä‘á»™ng gá»i <code>drop</code> trÃªn giÃ¡ trá»‹ vÃ o cuá»‘i <code>main</code>. Äiá»u nÃ y sáº½ gÃ¢y ra lá»—i <em>double free</em> vÃ¬ Rust sáº½ cá»‘ gáº¯ng dá»n dáº¹p cÃ¹ng má»™t giÃ¡ trá»‹ hai láº§n.</p>
<p>ChÃºng ta khÃ´ng thá»ƒ vÃ´ hiá»‡u hÃ³a viá»‡c chÃ¨n tá»± Ä‘á»™ng <code>drop</code> khi má»™t giÃ¡ trá»‹ ra khá»i pháº¡m vi, vÃ  cÅ©ng khÃ´ng thá»ƒ gá»i phÆ°Æ¡ng thá»©c <code>drop</code> má»™t cÃ¡ch rÃµ rÃ ng. VÃ¬ váº­y, náº¿u cáº§n Ã©p má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c dá»n dáº¹p sá»›m, chÃºng ta sá»­ dá»¥ng hÃ m <code>std::mem::drop</code>.</p>
<p>HÃ m <code>std::mem::drop</code> khÃ¡c vá»›i phÆ°Æ¡ng thá»©c <code>drop</code> trong trait <code>Drop</code>. ChÃºng ta gá»i nÃ³ báº±ng cÃ¡ch truyá»n giÃ¡ trá»‹ muá»‘n Ã©p dá»n dáº¹p lÃ m Ä‘á»‘i sá»‘. HÃ m nÃ y cÃ³ sáºµn trong prelude, vÃ¬ váº­y chÃºng ta cÃ³ thá»ƒ chá»‰nh sá»­a <code>main</code> trong Listing 15-15 Ä‘á»ƒ gá»i hÃ m <code>drop</code>, nhÆ° minh há»a trong Listing 15-16:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">struct CustomSmartPointer {
</span><span class="boring">    data: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Drop for CustomSmartPointer {
</span><span class="boring">    fn drop(&amp;mut self) {
</span><span class="boring">        println!("Dropping CustomSmartPointer with data `{}`!", self.data);
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let c = CustomSmartPointer {
        data: String::from("some data"),
    };
    println!("CustomSmartPointer created.");
    drop(c);
    println!("CustomSmartPointer dropped before the end of main.");
}</code></pre></pre>
<p><span class="caption">Listing 15-16: Gá»i <code>std::mem::drop</code> Ä‘á»ƒ dá»n dáº¹p má»™t giÃ¡ trá»‹ má»™t cÃ¡ch rÃµ rÃ ng trÆ°á»›c khi nÃ³ ra khá»i pháº¡m vi</span></p>
<p>Cháº¡y Ä‘oáº¡n mÃ£ nÃ y sáº½ in ra káº¿t quáº£ sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling drop-example v0.1.0 (file:///projects/drop-example)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.73s
     Running `target/debug/drop-example`
CustomSmartPointer created.
Dropping CustomSmartPointer with data `some data`!
CustomSmartPointer dropped before the end of main.
</code></pre>
<p>VÄƒn báº£n <code>Dropping CustomSmartPointer with data `some data`!</code> Ä‘Æ°á»£c in ra
giá»¯a cÃ¡c thÃ´ng bÃ¡o <code>CustomSmartPointer created.</code> vÃ  <code>CustomSmartPointer dropped before the end of main.</code>,
cho tháº¥y mÃ£ trong phÆ°Æ¡ng thá»©c <code>drop</code> Ä‘Æ°á»£c gá»i Ä‘á»ƒ há»§y <code>c</code> táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³.</p>
<p>Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng mÃ£ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh trong pháº§n triá»ƒn khai trait <code>Drop</code> theo nhiá»u cÃ¡ch
Ä‘á»ƒ lÃ m cho viá»‡c dá»n dáº¹p thuáº­n tiá»‡n vÃ  an toÃ n: vÃ­ dá»¥, báº¡n cÃ³ thá»ƒ dÃ¹ng nÃ³ Ä‘á»ƒ táº¡o bá»™
cáº¥p phÃ¡t bá»™ nhá»› riÃªng! Vá»›i trait <code>Drop</code> vÃ  há»‡ thá»‘ng ownership cá»§a Rust, báº¡n khÃ´ng cáº§n pháº£i nhá»› Ä‘á»ƒ dá»n dáº¹p vÃ¬ Rust sáº½ tá»± Ä‘á»™ng lÃ m Ä‘iá»u Ä‘Ã³.</p>
<p>Báº¡n cÅ©ng khÃ´ng cáº§n pháº£i lo láº¯ng vá» cÃ¡c váº¥n Ä‘á» phÃ¡t sinh tá»« viá»‡c vÃ´ tÃ¬nh dá»n dáº¹p cÃ¡c
giÃ¡ trá»‹ váº«n Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng: há»‡ thá»‘ng ownership Ä‘áº£m báº£o cÃ¡c tham chiáº¿u luÃ´n há»£p lá»‡
cÅ©ng Ä‘áº£m báº£o ráº±ng <code>drop</code> chá»‰ Ä‘Æ°á»£c gá»i má»™t láº§n khi giÃ¡ trá»‹ khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng.</p>
<p>BÃ¢y giá», sau khi Ä‘Ã£ xem xÃ©t <code>Box&lt;T&gt;</code> vÃ  má»™t sá»‘ Ä‘áº·c Ä‘iá»ƒm cá»§a smart pointer, hÃ£y cÃ¹ng
tÃ¬m hiá»ƒu má»™t vÃ i smart pointer khÃ¡c Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong thÆ° viá»‡n chuáº©n.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="rct-smart-pointer-Äáº¿m-tham-chiáº¿u"><a class="header" href="#rct-smart-pointer-Äáº¿m-tham-chiáº¿u"><code>Rc&lt;T&gt;</code>, Smart Pointer Äáº¿m Tham Chiáº¿u</a></h2>
<p>Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, quyá»n sá»Ÿ há»¯u rÃµ rÃ ng: báº¡n biáº¿t chÃ­nh xÃ¡c biáº¿n nÃ o sá»Ÿ há»¯u má»™t giÃ¡ trá»‹ nháº¥t Ä‘á»‹nh. Tuy nhiÃªn, cÃ³ nhá»¯ng trÆ°á»ng há»£p má»™t giÃ¡ trá»‹ cÃ³ thá»ƒ cÃ³ nhiá»u chá»§ sá»Ÿ há»¯u. VÃ­ dá»¥, trong cÃ¡c cáº¥u trÃºc dá»¯ liá»‡u Ä‘á»“ thá»‹, nhiá»u cáº¡nh cÃ³ thá»ƒ trá» Ä‘áº¿n cÃ¹ng má»™t nÃºt, vÃ  nÃºt Ä‘Ã³ vá» máº·t khÃ¡i niá»‡m Ä‘Æ°á»£c sá»Ÿ há»¯u bá»Ÿi táº¥t cáº£ cÃ¡c cáº¡nh trá» tá»›i nÃ³. Má»™t nÃºt khÃ´ng nÃªn bá»‹ dá»n dáº¹p trá»« khi khÃ´ng cÃ²n cáº¡nh nÃ o trá» tá»›i nÃ³ vÃ  do Ä‘Ã³ khÃ´ng cÃ²n chá»§ sá»Ÿ há»¯u.</p>
<p>Báº¡n pháº£i cho phÃ©p sá»Ÿ há»¯u nhiá»u chá»§ sá»Ÿ há»¯u má»™t cÃ¡ch rÃµ rÃ ng báº±ng cÃ¡ch sá»­ dá»¥ng kiá»ƒu Rust <code>Rc&lt;T&gt;</code>, viáº¿t táº¯t cá»§a <em>reference counting</em> (Ä‘áº¿m tham chiáº¿u). Kiá»ƒu <code>Rc&lt;T&gt;</code> theo dÃµi sá»‘ lÆ°á»£ng tham chiáº¿u tá»›i má»™t giÃ¡ trá»‹ Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xem giÃ¡ trá»‹ Ä‘Ã³ cÃ²n Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng hay khÃ´ng. Náº¿u khÃ´ng cÃ²n tham chiáº¿u nÃ o tá»›i giÃ¡ trá»‹, giÃ¡ trá»‹ cÃ³ thá»ƒ Ä‘Æ°á»£c dá»n dáº¹p mÃ  khÃ´ng lÃ m invalid báº¥t ká»³ tham chiáº¿u nÃ o.</p>
<p>HÃ£y tÆ°á»Ÿng tÆ°á»£ng <code>Rc&lt;T&gt;</code> giá»‘ng nhÆ° má»™t TV trong phÃ²ng khÃ¡ch gia Ä‘Ã¬nh. Khi má»™t ngÆ°á»i vÃ o xem TV, há» báº­t TV lÃªn. Nhá»¯ng ngÆ°á»i khÃ¡c cÃ³ thá»ƒ vÃ o phÃ²ng vÃ  xem TV. Khi ngÆ°á»i cuá»‘i cÃ¹ng rá»i phÃ²ng, há» táº¯t TV vÃ¬ TV khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng ná»¯a. Náº¿u ai Ä‘Ã³ táº¯t TV trong khi nhá»¯ng ngÆ°á»i khÃ¡c váº«n Ä‘ang xem, sáº½ cÃ³ sá»± pháº£n Ä‘á»‘i tá»« nhá»¯ng ngÆ°á»i cÃ²n láº¡i!</p>
<p>ChÃºng ta sá»­ dá»¥ng kiá»ƒu <code>Rc&lt;T&gt;</code> khi muá»‘n cáº¥p phÃ¡t dá»¯ liá»‡u trÃªn heap Ä‘á»ƒ nhiá»u pháº§n cá»§a chÆ°Æ¡ng trÃ¬nh Ä‘á»c vÃ  khÃ´ng thá»ƒ xÃ¡c Ä‘á»‹nh táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch pháº§n nÃ o sáº½ sá»­ dá»¥ng dá»¯ liá»‡u xong trÆ°á»›c. Náº¿u biáº¿t pháº§n nÃ o sá»­ dá»¥ng xong cuá»‘i cÃ¹ng, chÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh pháº§n Ä‘Ã³ lÃ m chá»§ sá»Ÿ há»¯u dá»¯ liá»‡u, vÃ  cÃ¡c quy táº¯c ownership thÃ´ng thÆ°á»ng Ä‘Æ°á»£c kiá»ƒm tra táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch sáº½ cÃ³ hiá»‡u lá»±c.</p>
<p>LÆ°u Ã½ ráº±ng <code>Rc&lt;T&gt;</code> chá»‰ dÃ¹ng trong cÃ¡c tÃ¬nh huá»‘ng Ä‘Æ¡n luá»“ng. Khi tháº£o luáº­n vá» Ä‘a luá»“ng trong ChÆ°Æ¡ng 16, chÃºng ta sáº½ Ä‘á» cáº­p cÃ¡ch Ä‘áº¿m tham chiáº¿u trong cÃ¡c chÆ°Æ¡ng trÃ¬nh Ä‘a luá»“ng.</p>
<h3 id="sá»­-dá»¥ng-rct-Ä‘á»ƒ-chia-sáº»-dá»¯-liá»‡u"><a class="header" href="#sá»­-dá»¥ng-rct-Ä‘á»ƒ-chia-sáº»-dá»¯-liá»‡u">Sá»­ dá»¥ng <code>Rc&lt;T&gt;</code> Ä‘á»ƒ Chia Sáº» Dá»¯ Liá»‡u</a></h3>
<p>HÃ£y quay láº¡i vÃ­ dá»¥ danh sÃ¡ch cons trong Listing 15-5. Nhá»› ráº±ng chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a nÃ³ sá»­ dá»¥ng <code>Box&lt;T&gt;</code>. Láº§n nÃ y, chÃºng ta sáº½ táº¡o hai danh sÃ¡ch cÃ¹ng chia sáº» quyá»n sá»Ÿ há»¯u cá»§a má»™t danh sÃ¡ch thá»© ba. Vá» máº·t khÃ¡i niá»‡m, Ä‘iá»u nÃ y tÆ°Æ¡ng tá»± nhÆ° HÃ¬nh 15-3:</p>
<img alt="Hai danh sÃ¡ch chia sáº» quyá»n sá»Ÿ há»¯u cá»§a danh sÃ¡ch thá»© ba" src="img/trpl15-03.svg" class="center" />
<p><span class="caption">HÃ¬nh 15-3: Hai danh sÃ¡ch, <code>b</code> vÃ  <code>c</code>, cÃ¹ng chia sáº» quyá»n sá»Ÿ há»¯u cá»§a danh sÃ¡ch thá»© ba, <code>a</code></span></p>
<p>ChÃºng ta sáº½ táº¡o danh sÃ¡ch <code>a</code> chá»©a cÃ¡c giÃ¡ trá»‹ 5 vÃ  10. Sau Ä‘Ã³, táº¡o thÃªm hai danh sÃ¡ch: <code>b</code> báº¯t Ä‘áº§u vá»›i 3 vÃ  <code>c</code> báº¯t Ä‘áº§u vá»›i 4. Cáº£ hai danh sÃ¡ch <code>b</code> vÃ  <code>c</code> sau Ä‘Ã³ sáº½ tiáº¿p ná»‘i danh sÃ¡ch <code>a</code> ban Ä‘áº§u chá»©a 5 vÃ  10. NÃ³i cÃ¡ch khÃ¡c, cáº£ hai danh sÃ¡ch sáº½ cÃ¹ng chia sáº» danh sÃ¡ch Ä‘áº§u tiÃªn chá»©a 5 vÃ  10.</p>
<p>Cá»‘ gáº¯ng thá»±c hiá»‡n ká»‹ch báº£n nÃ y sá»­ dá»¥ng Ä‘á»‹nh nghÄ©a <code>List</code> vá»›i <code>Box&lt;T&gt;</code> sáº½ khÃ´ng hoáº¡t Ä‘á»™ng, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 15-17:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">enum List {
    Cons(i32, Box&lt;List&gt;),
    Nil,
}

use crate::List::{Cons, Nil};

fn main() {
    let a = Cons(5, Box::new(Cons(10, Box::new(Nil))));
    let b = Cons(3, Box::new(a));
    let c = Cons(4, Box::new(a));
}</code></pre>
<p><span class="caption">Listing 15-17: Minh há»a viá»‡c khÃ´ng Ä‘Æ°á»£c phÃ©p cÃ³ hai danh sÃ¡ch sá»­ dá»¥ng <code>Box&lt;T&gt;</code> mÃ  cá»‘ gáº¯ng chia sáº» quyá»n sá»Ÿ há»¯u cá»§a má»™t danh sÃ¡ch thá»© ba</span></p>
<p>Khi biÃªn dá»‹ch mÃ£ nÃ y, chÃºng ta nháº­n Ä‘Æ°á»£c lá»—i sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling cons-list v0.1.0 (file:///projects/cons-list)
error[E0382]: use of moved value: `a`
  --&gt; src/main.rs:11:30
   |
9  |     let a = Cons(5, Box::new(Cons(10, Box::new(Nil))));
   |         - move occurs because `a` has type `List`, which does not implement the `Copy` trait
10 |     let b = Cons(3, Box::new(a));
   |                              - value moved here
11 |     let c = Cons(4, Box::new(a));
   |                              ^ value used here after move

For more information about this error, try `rustc --explain E0382`.
error: could not compile `cons-list` (bin "cons-list") due to 1 previous error
</code></pre>
<p>CÃ¡c biáº¿n thá»ƒ <code>Cons</code> sá»Ÿ há»¯u dá»¯ liá»‡u mÃ  chÃºng giá»¯, vÃ¬ váº­y khi chÃºng ta táº¡o danh sÃ¡ch <code>b</code>, <code>a</code> sáº½ bá»‹ <strong>di chuyá»ƒn</strong> vÃ o <code>b</code> vÃ  <code>b</code> sá»Ÿ há»¯u <code>a</code>. Sau Ä‘Ã³, khi chÃºng ta cá»‘ gáº¯ng sá»­ dá»¥ng láº¡i <code>a</code> Ä‘á»ƒ táº¡o <code>c</code>, Ä‘iá»u Ä‘Ã³ khÃ´ng Ä‘Æ°á»£c phÃ©p vÃ¬ <code>a</code> Ä‘Ã£ bá»‹ di chuyá»ƒn.</p>
<p>ChÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i Ä‘á»‹nh nghÄ©a cá»§a <code>Cons</code> Ä‘á»ƒ giá»¯ cÃ¡c <strong>tham chiáº¿u</strong> thay vÃ¬ giÃ¡ trá»‹ sá»Ÿ há»¯u, nhÆ°ng khi Ä‘Ã³ chÃºng ta pháº£i khai bÃ¡o cÃ¡c tham sá»‘ <strong>lifetime</strong>. Khi khai bÃ¡o lifetime, chÃºng ta sáº½ chá»‰ Ä‘á»‹nh ráº±ng má»—i pháº§n tá»­ trong danh sÃ¡ch sáº½ sá»‘ng Ã­t nháº¥t báº±ng toÃ n bá»™ thá»i gian sá»‘ng cá»§a danh sÃ¡ch. Äiá»u nÃ y Ä‘Ãºng vá»›i cÃ¡c pháº§n tá»­ vÃ  danh sÃ¡ch trong Listing 15-17, nhÆ°ng khÃ´ng pháº£i trong má»i trÆ°á»ng há»£p.</p>
<p>Thay vÃ o Ä‘Ã³, chÃºng ta sáº½ thay Ä‘á»•i Ä‘á»‹nh nghÄ©a cá»§a <code>List</code> Ä‘á»ƒ sá»­ dá»¥ng <code>Rc&lt;T&gt;</code> thay cho <code>Box&lt;T&gt;</code>, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 15-18. Má»—i biáº¿n thá»ƒ <code>Cons</code> bÃ¢y giá» sáº½ giá»¯ má»™t giÃ¡ trá»‹ vÃ  má»™t <code>Rc&lt;T&gt;</code> trá» tá»›i má»™t <code>List</code>. Khi táº¡o <code>b</code>, thay vÃ¬ chiáº¿m quyá»n sá»Ÿ há»¯u cá»§a <code>a</code>, chÃºng ta sáº½ <strong>clone</strong> <code>Rc&lt;List&gt;</code> mÃ  <code>a</code> giá»¯, tá»« Ä‘Ã³ tÄƒng sá»‘ lÆ°á»£ng tham chiáº¿u tá»« má»™t lÃªn hai vÃ  cho phÃ©p <code>a</code> vÃ  <code>b</code> cÃ¹ng sá»Ÿ há»¯u dá»¯ liá»‡u trong <code>Rc&lt;List&gt;</code>. ChÃºng ta cÅ©ng sáº½ clone <code>a</code> khi táº¡o <code>c</code>, tÄƒng sá»‘ lÆ°á»£ng tham chiáº¿u tá»« hai lÃªn ba. Má»—i khi gá»i <code>Rc::clone</code>, bá»™ Ä‘áº¿m tham chiáº¿u tá»›i dá»¯ liá»‡u bÃªn trong <code>Rc&lt;List&gt;</code> sáº½ tÄƒng lÃªn, vÃ  dá»¯ liá»‡u sáº½ khÃ´ng bá»‹ giáº£i phÃ³ng cho Ä‘áº¿n khi khÃ´ng cÃ²n tham chiáº¿u nÃ o tá»›i nÃ³.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">enum List {
    Cons(i32, Rc&lt;List&gt;),
    Nil,
}

use crate::List::{Cons, Nil};
use std::rc::Rc;

fn main() {
    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));
    let b = Cons(3, Rc::clone(&amp;a));
    let c = Cons(4, Rc::clone(&amp;a));
}</code></pre></pre>
<p><span class="caption">Listing 15-18: A definition of <code>List</code> that uses
<code>Rc&lt;T&gt;</code></span></p>
<p>ChÃºng ta cáº§n thÃªm cÃ¢u lá»‡nh <code>use</code> Ä‘á»ƒ Ä‘Æ°a <code>Rc&lt;T&gt;</code> vÃ o pháº¡m vi sá»­ dá»¥ng vÃ¬ nÃ³ khÃ´ng cÃ³ trong prelude. Trong <code>main</code>, chÃºng ta táº¡o danh sÃ¡ch chá»©a 5 vÃ  10 vÃ  lÆ°u nÃ³ vÃ o má»™t <code>Rc&lt;List&gt;</code> má»›i trong <code>a</code>. Sau Ä‘Ã³, khi táº¡o <code>b</code> vÃ  <code>c</code>, chÃºng ta gá»i hÃ m <code>Rc::clone</code> vÃ  truyá»n má»™t tham chiáº¿u tá»›i <code>Rc&lt;List&gt;</code> trong <code>a</code> lÃ m Ä‘á»‘i sá»‘.</p>
<p>ChÃºng ta cÃ³ thá»ƒ gá»i <code>a.clone()</code> thay vÃ¬ <code>Rc::clone(&amp;a)</code>, nhÆ°ng quy Æ°á»›c cá»§a Rust lÃ  sá»­ dá»¥ng <code>Rc::clone</code> trong trÆ°á»ng há»£p nÃ y. Viá»‡c triá»ƒn khai <code>Rc::clone</code> khÃ´ng táº¡o má»™t báº£n sao sÃ¢u cá»§a toÃ n bá»™ dá»¯ liá»‡u nhÆ° háº§u háº¿t cÃ¡c kiá»ƒu dá»¯ liá»‡u khÃ¡c triá»ƒn khai <code>clone</code>. Lá»‡nh gá»i <code>Rc::clone</code> chá»‰ tÄƒng bá»™ Ä‘áº¿m tham chiáº¿u, Ä‘iá»u nÃ y tá»‘n ráº¥t Ã­t thá»i gian. CÃ¡c báº£n sao sÃ¢u cá»§a dá»¯ liá»‡u cÃ³ thá»ƒ máº¥t nhiá»u thá»i gian. Báº±ng cÃ¡ch sá»­ dá»¥ng <code>Rc::clone</code> cho viá»‡c Ä‘áº¿m tham chiáº¿u, chÃºng ta cÃ³ thá»ƒ phÃ¢n biá»‡t rÃµ rÃ ng giá»¯a cÃ¡c báº£n sao sÃ¢u (deep-copy) vÃ  cÃ¡c báº£n sao chá»‰ tÄƒng bá»™ Ä‘áº¿m tham chiáº¿u. Khi tÃ¬m kiáº¿m váº¥n Ä‘á» vá» hiá»‡u nÄƒng trong mÃ£, chÃºng ta chá»‰ cáº§n xem xÃ©t cÃ¡c báº£n sao sÃ¢u vÃ  cÃ³ thá»ƒ bá» qua cÃ¡c lá»‡nh gá»i tá»›i <code>Rc::clone</code>.</p>
<h3 id="cloning-má»™t-rct-lÃ m-tÄƒng-bá»™-Ä‘áº¿m-tham-chiáº¿u"><a class="header" href="#cloning-má»™t-rct-lÃ m-tÄƒng-bá»™-Ä‘áº¿m-tham-chiáº¿u">Cloning má»™t <code>Rc&lt;T&gt;</code> lÃ m tÄƒng bá»™ Ä‘áº¿m tham chiáº¿u</a></h3>
<p>HÃ£y thay Ä‘á»•i vÃ­ dá»¥ Ä‘ang hoáº¡t Ä‘á»™ng trong Listing 15-18 Ä‘á»ƒ cÃ³ thá»ƒ tháº¥y Ä‘Æ°á»£c sá»‘ lÆ°á»£ng tham chiáº¿u thay Ä‘á»•i khi chÃºng ta táº¡o vÃ  xÃ³a cÃ¡c tham chiáº¿u tá»›i <code>Rc&lt;List&gt;</code> trong <code>a</code>.</p>
<p>Trong Listing 15-19, chÃºng ta sáº½ thay Ä‘á»•i <code>main</code> Ä‘á»ƒ cÃ³ má»™t scope bÃªn trong cho danh sÃ¡ch <code>c</code>; sau Ä‘Ã³ chÃºng ta cÃ³ thá»ƒ tháº¥y sá»‘ lÆ°á»£ng tham chiáº¿u thay Ä‘á»•i khi <code>c</code> ra khá»i pháº¡m vi.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">enum List {
</span><span class="boring">    Cons(i32, Rc&lt;List&gt;),
</span><span class="boring">    Nil,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">use crate::List::{Cons, Nil};
</span><span class="boring">use std::rc::Rc;
</span><span class="boring">
</span>// --snip--

fn main() {
    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));
    println!("count after creating a = {}", Rc::strong_count(&amp;a));
    let b = Cons(3, Rc::clone(&amp;a));
    println!("count after creating b = {}", Rc::strong_count(&amp;a));
    {
        let c = Cons(4, Rc::clone(&amp;a));
        println!("count after creating c = {}", Rc::strong_count(&amp;a));
    }
    println!("count after c goes out of scope = {}", Rc::strong_count(&amp;a));
}</code></pre></pre>
<p><span class="caption">Listing 15-19: In ra sá»‘ lÆ°á»£ng tham chiáº¿u</span></p>
<p>Táº¡i má»—i Ä‘iá»ƒm trong chÆ°Æ¡ng trÃ¬nh mÃ  sá»‘ lÆ°á»£ng tham chiáº¿u thay Ä‘á»•i, chÃºng ta in ra sá»‘ lÆ°á»£ng tham chiáº¿u, láº¥y Ä‘Æ°á»£c báº±ng cÃ¡ch gá»i hÃ m <code>Rc::strong_count</code>. HÃ m nÃ y Ä‘Æ°á»£c Ä‘áº·t tÃªn lÃ  <code>strong_count</code> thay vÃ¬ <code>count</code> vÃ¬ kiá»ƒu <code>Rc&lt;T&gt;</code> cÅ©ng cÃ³ <code>weak_count</code>; chÃºng ta sáº½ tÃ¬m hiá»ƒu <code>weak_count</code> Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬ trong pháº§n <a href="ch15-06-reference-cycles.html#preventing-reference-cycles-turning-an-rct-into-a-weakt">â€œNgÄƒn cháº·n chu ká»³ tham chiáº¿u: Chuyá»ƒn má»™t <code>Rc&lt;T&gt;</code> thÃ nh <code>Weak&lt;T&gt;</code>â€</a><!-- ignore -->.</p>
<p>MÃ£ nÃ y in ra káº¿t quáº£ sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling cons-list v0.1.0 (file:///projects/cons-list)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.45s
     Running `target/debug/cons-list`
count after creating a = 1
count after creating b = 2
count after creating c = 3
count after c goes out of scope = 2
</code></pre>
<p>ChÃºng ta cÃ³ thá»ƒ tháº¥y ráº±ng <code>Rc&lt;List&gt;</code> trong <code>a</code> ban Ä‘áº§u cÃ³ sá»‘ lÆ°á»£ng tham chiáº¿u lÃ  1;
sau Ä‘Ã³ má»—i láº§n gá»i <code>clone</code>, sá»‘ lÆ°á»£ng nÃ y tÄƒng lÃªn 1. Khi <code>c</code> ra khá»i pháº¡m vi, sá»‘ lÆ°á»£ng giáº£m Ä‘i 1.
ChÃºng ta khÃ´ng cáº§n gá»i má»™t hÃ m nÃ o Ä‘á»ƒ giáº£m sá»‘ lÆ°á»£ng tham chiáº¿u nhÆ° khi pháº£i gá»i <code>Rc::clone</code>
Ä‘á»ƒ tÄƒng sá»‘ lÆ°á»£ng tham chiáº¿u: viá»‡c triá»ƒn khai trait <code>Drop</code> sáº½ tá»± Ä‘á»™ng giáº£m sá»‘ lÆ°á»£ng tham chiáº¿u khi má»™t giÃ¡ trá»‹ <code>Rc&lt;T&gt;</code> ra khá»i pháº¡m vi.</p>
<p>Äiá»u chÃºng ta khÃ´ng tháº¥y trong vÃ­ dá»¥ nÃ y lÃ  khi <code>b</code> vÃ  sau Ä‘Ã³ <code>a</code> ra khá»i pháº¡m vi vÃ o cuá»‘i <code>main</code>,
sá»‘ lÆ°á»£ng tham chiáº¿u sáº½ báº±ng 0, vÃ  <code>Rc&lt;List&gt;</code> Ä‘Æ°á»£c dá»n dáº¹p hoÃ n toÃ n. Sá»­ dá»¥ng <code>Rc&lt;T&gt;</code>
cho phÃ©p má»™t giÃ¡ trá»‹ cÃ³ nhiá»u chá»§ sá»Ÿ há»¯u, vÃ  sá»‘ lÆ°á»£ng tham chiáº¿u Ä‘áº£m báº£o ráº±ng giÃ¡ trá»‹
váº«n há»£p lá»‡ miá»…n lÃ  cÃ²n báº¥t ká»³ chá»§ sá»Ÿ há»¯u nÃ o tá»“n táº¡i.</p>
<p>ThÃ´ng qua cÃ¡c tham chiáº¿u khÃ´ng thay Ä‘á»•i, <code>Rc&lt;T&gt;</code> cho phÃ©p báº¡n chia sáº» dá»¯ liá»‡u giá»¯a nhiá»u pháº§n
cá»§a chÆ°Æ¡ng trÃ¬nh chá»‰ Ä‘á»ƒ Ä‘á»c. Náº¿u <code>Rc&lt;T&gt;</code> cho phÃ©p báº¡n cÃ³ nhiá»u tham chiáº¿u thay Ä‘á»•i cÅ©ng nhÆ° váº­y,
báº¡n cÃ³ thá»ƒ vi pháº¡m má»™t trong cÃ¡c quy táº¯c mÆ°á»£n Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 4: nhiá»u láº§n mÆ°á»£n thay Ä‘á»•i
cÃ¹ng má»™t vá»‹ trÃ­ cÃ³ thá»ƒ gÃ¢y ra race condition vÃ  dá»¯ liá»‡u khÃ´ng nháº¥t quÃ¡n.
NhÆ°ng kháº£ nÄƒng thay Ä‘á»•i dá»¯ liá»‡u lÃ  ráº¥t há»¯u Ã­ch! Trong pháº§n tiáº¿p theo, chÃºng ta sáº½ tháº£o luáº­n
vá» máº«u <em>interior mutability</em> vÃ  kiá»ƒu <code>RefCell&lt;T&gt;</code> mÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¹ng vá»›i <code>Rc&lt;T&gt;</code> Ä‘á»ƒ lÃ m viá»‡c vá»›i giá»›i háº¡n khÃ´ng thay Ä‘á»•i nÃ y.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="refcellt-vÃ -máº«u-interior-mutability"><a class="header" href="#refcellt-vÃ -máº«u-interior-mutability"><code>RefCell&lt;T&gt;</code> vÃ  Máº«u Interior Mutability</a></h2>
<p><em>Interior mutability</em> lÃ  má»™t máº«u thiáº¿t káº¿ trong Rust cho phÃ©p báº¡n thay Ä‘á»•i dá»¯ liá»‡u ngay cáº£ khi cÃ³ cÃ¡c tham chiáº¿u khÃ´ng thay Ä‘á»•i Ä‘áº¿n dá»¯ liá»‡u Ä‘Ã³; thÃ´ng thÆ°á»ng, hÃ nh Ä‘á»™ng nÃ y bá»‹ cáº¥m bá»Ÿi cÃ¡c quy táº¯c mÆ°á»£n. Äá»ƒ thay Ä‘á»•i dá»¯ liá»‡u, máº«u nÃ y sá»­ dá»¥ng mÃ£ <code>unsafe</code> bÃªn trong má»™t cáº¥u trÃºc dá»¯ liá»‡u Ä‘á»ƒ uá»‘n náº¯n cÃ¡c quy táº¯c thÃ´ng thÆ°á»ng cá»§a Rust vá» mutation vÃ  borrowing. MÃ£ <code>unsafe</code> bÃ¡o cho trÃ¬nh biÃªn dá»‹ch ráº±ng chÃºng ta sáº½ kiá»ƒm tra cÃ¡c quy táº¯c thá»§ cÃ´ng thay vÃ¬ dá»±a vÃ o trÃ¬nh biÃªn dá»‹ch; chÃºng ta sáº½ tháº£o luáº­n thÃªm vá» mÃ£ <code>unsafe</code> trong ChÆ°Æ¡ng 19.</p>
<p>ChÃºng ta chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c kiá»ƒu dá»¯ liá»‡u Ã¡p dá»¥ng máº«u interior mutability khi cÃ³ thá»ƒ Ä‘áº£m báº£o ráº±ng cÃ¡c quy táº¯c mÆ°á»£n sáº½ Ä‘Æ°á»£c tuÃ¢n thá»§ táº¡i thá»i Ä‘iá»ƒm cháº¡y, máº·c dÃ¹ trÃ¬nh biÃªn dá»‹ch khÃ´ng thá»ƒ Ä‘áº£m báº£o Ä‘iá»u Ä‘Ã³. MÃ£ <code>unsafe</code> liÃªn quan sáº½ Ä‘Æ°á»£c bao bá»c trong má»™t API an toÃ n, vÃ  kiá»ƒu bÃªn ngoÃ i váº«n khÃ´ng thay Ä‘á»•i.</p>
<p>HÃ£y khÃ¡m phÃ¡ khÃ¡i niá»‡m nÃ y báº±ng cÃ¡ch xem kiá»ƒu <code>RefCell&lt;T&gt;</code> Ã¡p dá»¥ng máº«u interior mutability.</p>
<h3 id="thá»±c-thi-cÃ¡c-quy-táº¯c-mÆ°á»£n-táº¡i-thá»i-Ä‘iá»ƒm-cháº¡y-vá»›i-refcellt"><a class="header" href="#thá»±c-thi-cÃ¡c-quy-táº¯c-mÆ°á»£n-táº¡i-thá»i-Ä‘iá»ƒm-cháº¡y-vá»›i-refcellt">Thá»±c thi cÃ¡c quy táº¯c mÆ°á»£n táº¡i thá»i Ä‘iá»ƒm cháº¡y vá»›i <code>RefCell&lt;T&gt;</code></a></h3>
<p>KhÃ¡c vá»›i <code>Rc&lt;T&gt;</code>, kiá»ƒu <code>RefCell&lt;T&gt;</code> Ä‘áº¡i diá»‡n cho quyá»n sá»Ÿ há»¯u duy nháº¥t Ä‘á»‘i vá»›i dá»¯ liá»‡u mÃ  nÃ³ giá»¯. Váº­y Ä‘iá»u gÃ¬ lÃ m <code>RefCell&lt;T&gt;</code> khÃ¡c vá»›i má»™t kiá»ƒu nhÆ° <code>Box&lt;T&gt;</code>? HÃ£y nhá»› láº¡i cÃ¡c quy táº¯c mÆ°á»£n mÃ  báº¡n Ä‘Ã£ há»c trong ChÆ°Æ¡ng 4:</p>
<ul>
<li>Táº¡i báº¥t ká»³ thá»i Ä‘iá»ƒm nÃ o, báº¡n cÃ³ thá»ƒ cÃ³ <em>hoáº·c</em> (nhÆ°ng khÃ´ng pháº£i cáº£ hai) má»™t tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i hoáº·c báº¥t ká»³ sá»‘ lÆ°á»£ng tham chiáº¿u khÃ´ng thay Ä‘á»•i nÃ o.</li>
<li>CÃ¡c tham chiáº¿u pháº£i luÃ´n há»£p lá»‡.</li>
</ul>
<p>Vá»›i cÃ¡c tham chiáº¿u vÃ  <code>Box&lt;T&gt;</code>, cÃ¡c quy táº¯c mÆ°á»£n Ä‘Æ°á»£c thá»±c thi táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch. Vá»›i <code>RefCell&lt;T&gt;</code>, nhá»¯ng báº¥t biáº¿n nÃ y Ä‘Æ°á»£c thá»±c thi <em>táº¡i thá»i Ä‘iá»ƒm cháº¡y</em>. Vá»›i cÃ¡c tham chiáº¿u, náº¿u báº¡n vi pháº¡m cÃ¡c quy táº¯c nÃ y, báº¡n sáº½ nháº­n Ä‘Æ°á»£c lá»—i biÃªn dá»‹ch. Vá»›i <code>RefCell&lt;T&gt;</code>, náº¿u báº¡n vi pháº¡m cÃ¡c quy táº¯c nÃ y, chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n sáº½ panic vÃ  káº¿t thÃºc.</p>
<p>Æ¯u Ä‘iá»ƒm cá»§a viá»‡c kiá»ƒm tra cÃ¡c quy táº¯c mÆ°á»£n táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch lÃ  cÃ¡c lá»—i sáº½ Ä‘Æ°á»£c phÃ¡t hiá»‡n sá»›m hÆ¡n trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn, vÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u nÄƒng táº¡i thá»i Ä‘iá»ƒm cháº¡y vÃ¬ táº¥t cáº£ phÃ¢n tÃ­ch Ä‘Ã£ hoÃ n táº¥t trÆ°á»›c Ä‘Ã³. VÃ¬ nhá»¯ng lÃ½ do nÃ y, kiá»ƒm tra cÃ¡c quy táº¯c mÆ°á»£n táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch lÃ  lá»±a chá»n tá»‘t nháº¥t trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, Ä‘Ã³ lÃ  lÃ½ do táº¡i sao Ä‘Ã¢y lÃ  máº·c Ä‘á»‹nh cá»§a Rust.</p>
<p>Æ¯u Ä‘iá»ƒm cá»§a viá»‡c kiá»ƒm tra cÃ¡c quy táº¯c mÆ°á»£n táº¡i thá»i Ä‘iá»ƒm cháº¡y lÃ  cho phÃ©p má»™t sá»‘ tÃ¬nh huá»‘ng an toÃ n vá» bá»™ nhá»› mÃ  náº¿u kiá»ƒm tra táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch sáº½ bá»‹ cáº¥m. PhÃ¢n tÃ­ch tÄ©nh, nhÆ° trÃ¬nh biÃªn dá»‹ch Rust, vá»‘n mang tÃ­nh tháº­n trá»ng. Má»™t sá»‘ Ä‘áº·c tÃ­nh cá»§a mÃ£ lÃ  khÃ´ng thá»ƒ phÃ¡t hiá»‡n báº±ng viá»‡c phÃ¢n tÃ­ch mÃ£: vÃ­ dá»¥ ná»•i tiáº¿ng nháº¥t lÃ  Váº¥n Ä‘á» Halting, vÆ°á»£t ngoÃ i pháº¡m vi cuá»‘n sÃ¡ch nÃ y nhÆ°ng lÃ  má»™t chá»§ Ä‘á» thÃº vá»‹ Ä‘á»ƒ nghiÃªn cá»©u.</p>
<p>Bá»Ÿi vÃ¬ má»™t sá»‘ phÃ¢n tÃ­ch lÃ  khÃ´ng thá»ƒ, náº¿u trÃ¬nh biÃªn dá»‹ch Rust khÃ´ng cháº¯c cháº¯n mÃ£ tuÃ¢n thá»§ cÃ¡c quy táº¯c sá»Ÿ há»¯u, nÃ³ cÃ³ thá»ƒ tá»« chá»‘i má»™t chÆ°Æ¡ng trÃ¬nh há»£p lá»‡; theo cÃ¡ch nÃ y, nÃ³ mang tÃ­nh tháº­n trá»ng. Náº¿u Rust cháº¥p nháº­n má»™t chÆ°Æ¡ng trÃ¬nh khÃ´ng Ä‘Ãºng, ngÆ°á»i dÃ¹ng sáº½ khÃ´ng thá»ƒ tin tÆ°á»Ÿng vÃ o cÃ¡c Ä‘áº£m báº£o mÃ  Rust Ä‘Æ°a ra. Tuy nhiÃªn, náº¿u Rust tá»« chá»‘i má»™t chÆ°Æ¡ng trÃ¬nh há»£p lá»‡, láº­p trÃ¬nh viÃªn sáº½ gáº·p báº¥t tiá»‡n, nhÆ°ng khÃ´ng cÃ³ gÃ¬ tháº£m khá»‘c xáº£y ra. Kiá»ƒu <code>RefCell&lt;T&gt;</code> há»¯u Ã­ch khi báº¡n cháº¯c cháº¯n mÃ£ cá»§a mÃ¬nh tuÃ¢n thá»§ cÃ¡c quy táº¯c mÆ°á»£n nhÆ°ng trÃ¬nh biÃªn dá»‹ch khÃ´ng thá»ƒ hiá»ƒu vÃ  Ä‘áº£m báº£o Ä‘iá»u Ä‘Ã³.</p>
<p>TÆ°Æ¡ng tá»± nhÆ° <code>Rc&lt;T&gt;</code>, <code>RefCell&lt;T&gt;</code> chá»‰ dÃ¹ng trong cÃ¡c ká»‹ch báº£n Ä‘Æ¡n luá»“ng vÃ  sáº½ bÃ¡o lá»—i biÃªn dá»‹ch náº¿u báº¡n cá»‘ gáº¯ng sá»­ dá»¥ng trong bá»‘i cáº£nh Ä‘a luá»“ng. ChÃºng ta sáº½ nÃ³i vá» cÃ¡ch cÃ³ Ä‘Æ°á»£c chá»©c nÄƒng cá»§a <code>RefCell&lt;T&gt;</code> trong chÆ°Æ¡ng trÃ¬nh Ä‘a luá»“ng á»Ÿ ChÆ°Æ¡ng 16.</p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  tÃ³m táº¯t lÃ½ do chá»n <code>Box&lt;T&gt;</code>, <code>Rc&lt;T&gt;</code> hoáº·c <code>RefCell&lt;T&gt;</code>:</p>
<ul>
<li><code>Rc&lt;T&gt;</code> cho phÃ©p nhiá»u chá»§ sá»Ÿ há»¯u cÃ¹ng dá»¯ liá»‡u; <code>Box&lt;T&gt;</code> vÃ  <code>RefCell&lt;T&gt;</code> chá»‰ cÃ³ má»™t chá»§ sá»Ÿ há»¯u.</li>
<li><code>Box&lt;T&gt;</code> cho phÃ©p mÆ°á»£n cÃ³ thá»ƒ hoáº·c khÃ´ng thá»ƒ thay Ä‘á»•i Ä‘Æ°á»£c kiá»ƒm tra táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch; <code>Rc&lt;T&gt;</code> chá»‰ cho phÃ©p mÆ°á»£n khÃ´ng thay Ä‘á»•i Ä‘Æ°á»£c kiá»ƒm tra táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch; <code>RefCell&lt;T&gt;</code> cho phÃ©p mÆ°á»£n cÃ³ thá»ƒ hoáº·c khÃ´ng thá»ƒ thay Ä‘á»•i Ä‘Æ°á»£c kiá»ƒm tra táº¡i thá»i Ä‘iá»ƒm cháº¡y.</li>
<li>VÃ¬ <code>RefCell&lt;T&gt;</code> cho phÃ©p mÆ°á»£n cÃ³ thá»ƒ thay Ä‘á»•i Ä‘Æ°á»£c kiá»ƒm tra táº¡i thá»i Ä‘iá»ƒm cháº¡y, báº¡n cÃ³ thá»ƒ thay Ä‘á»•i giÃ¡ trá»‹ bÃªn trong <code>RefCell&lt;T&gt;</code> ngay cáº£ khi <code>RefCell&lt;T&gt;</code> lÃ  báº¥t biáº¿n.</li>
</ul>
<p>Viá»‡c thay Ä‘á»•i giÃ¡ trá»‹ bÃªn trong má»™t giÃ¡ trá»‹ báº¥t biáº¿n lÃ  máº«u <em>interior mutability</em>. HÃ£y xem xÃ©t má»™t tÃ¬nh huá»‘ng mÃ  interior mutability há»¯u Ã­ch vÃ  khÃ¡m phÃ¡ cÃ¡ch mÃ  nÃ³ cÃ³ thá»ƒ thá»±c hiá»‡n Ä‘Æ°á»£c.</p>
<h3 id="interior-mutability-mÆ°á»£n-cÃ³-thá»ƒ-thay-Ä‘á»•i-trÃªn-má»™t-giÃ¡-trá»‹-báº¥t-biáº¿n"><a class="header" href="#interior-mutability-mÆ°á»£n-cÃ³-thá»ƒ-thay-Ä‘á»•i-trÃªn-má»™t-giÃ¡-trá»‹-báº¥t-biáº¿n">Interior Mutability: MÆ°á»£n cÃ³ thá»ƒ thay Ä‘á»•i trÃªn má»™t giÃ¡ trá»‹ báº¥t biáº¿n</a></h3>
<p>Má»™t há»‡ quáº£ cá»§a cÃ¡c quy táº¯c mÆ°á»£n lÃ  khi báº¡n cÃ³ má»™t giÃ¡ trá»‹ báº¥t biáº¿n, báº¡n khÃ´ng thá»ƒ mÆ°á»£n nÃ³ theo cÃ¡ch cÃ³ thá»ƒ thay Ä‘á»•i. VÃ­ dá»¥, Ä‘oáº¡n mÃ£ nÃ y sáº½ khÃ´ng biÃªn dá»‹ch:</p>
<pre><code class="language-rust ignore does_not_compile">fn main() {
    let x = 5;
    let y = &amp;mut x;
}</code></pre>
<p>Náº¿u báº¡n thá»­ biÃªn dá»‹ch Ä‘oáº¡n mÃ£ nÃ y, báº¡n sáº½ nháº­n Ä‘Æ°á»£c lá»—i sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling borrowing v0.1.0 (file:///projects/borrowing)
error[E0596]: cannot borrow `x` as mutable, as it is not declared as mutable
 --&gt; src/main.rs:3:13
  |
3 |     let y = &amp;mut x;
  |             ^^^^^^ cannot borrow as mutable
  |
help: consider changing this to be mutable
  |
2 |     let mut x = 5;
  |         +++

For more information about this error, try `rustc --explain E0596`.
error: could not compile `borrowing` (bin "borrowing") due to 1 previous error
</code></pre>
<p>Tuy nhiÃªn, cÃ³ nhá»¯ng tÃ¬nh huá»‘ng mÃ  má»™t giÃ¡ trá»‹ cÃ³ thá»ƒ tá»± thay Ä‘á»•i trong
cÃ¡c phÆ°Æ¡ng thá»©c cá»§a nÃ³ nhÆ°ng váº«n xuáº¥t hiá»‡n nhÆ° báº¥t biáº¿n Ä‘á»‘i vá»›i cÃ¡c Ä‘oáº¡n mÃ£ khÃ¡c.
CÃ¡c Ä‘oáº¡n mÃ£ bÃªn ngoÃ i cÃ¡c phÆ°Æ¡ng thá»©c cá»§a giÃ¡ trá»‹ sáº½ khÃ´ng thá»ƒ thay Ä‘á»•i giÃ¡ trá»‹ Ä‘Ã³.
Sá»­ dá»¥ng <code>RefCell&lt;T&gt;</code> lÃ  má»™t cÃ¡ch Ä‘á»ƒ cÃ³ thá»ƒ thá»±c hiá»‡n <em>interior mutability</em>,
nhÆ°ng <code>RefCell&lt;T&gt;</code> khÃ´ng bá» qua hoÃ n toÃ n cÃ¡c quy táº¯c mÆ°á»£n: trÃ¬nh kiá»ƒm tra mÆ°á»£n
trong trÃ¬nh biÃªn dá»‹ch cho phÃ©p ná»™i bá»™ thay Ä‘á»•i nÃ y vÃ  cÃ¡c quy táº¯c mÆ°á»£n Ä‘Æ°á»£c kiá»ƒm tra táº¡i thá»i gian cháº¡y.
Náº¿u báº¡n vi pháº¡m cÃ¡c quy táº¯c nÃ y, báº¡n sáº½ nháº­n Ä‘Æ°á»£c má»™t <code>panic!</code> thay vÃ¬ lá»—i biÃªn dá»‹ch.</p>
<p>HÃ£y cÃ¹ng xem má»™t vÃ­ dá»¥ thá»±c táº¿ nÆ¡i chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng <code>RefCell&lt;T&gt;</code> Ä‘á»ƒ thay Ä‘á»•i
má»™t giÃ¡ trá»‹ báº¥t biáº¿n vÃ  hiá»ƒu táº¡i sao Ä‘iá»u Ä‘Ã³ láº¡i há»¯u Ã­ch.</p>
<h4 id="trÆ°á»ng-há»£p-sá»­-dá»¥ng-interior-mutability-mock-objects"><a class="header" href="#trÆ°á»ng-há»£p-sá»­-dá»¥ng-interior-mutability-mock-objects">TrÆ°á»ng há»£p sá»­ dá»¥ng Interior Mutability: Mock Objects</a></h4>
<p>ÄÃ´i khi trong quÃ¡ trÃ¬nh kiá»ƒm thá»­, láº­p trÃ¬nh viÃªn sáº½ sá»­ dá»¥ng má»™t kiá»ƒu thay cho má»™t
kiá»ƒu khÃ¡c Ä‘á»ƒ quan sÃ¡t hÃ nh vi cá»¥ thá»ƒ vÃ  xÃ¡c nháº­n ráº±ng nÃ³ Ä‘Æ°á»£c thá»±c hiá»‡n Ä‘Ãºng.
Kiá»ƒu thay tháº¿ nÃ y Ä‘Æ°á»£c gá»i lÃ  <em>test double</em>. HÃ£y tÆ°á»Ÿng tÆ°á»£ng nÃ³ giá»‘ng nhÆ° má»™t â€œstunt doubleâ€ trong Ä‘iá»‡n áº£nh,
nÆ¡i má»™t ngÆ°á»i Ä‘Ã³ng tháº¿ cho diá»…n viÃªn trong má»™t cáº£nh khÃ³. Test doubles Ä‘á»©ng thay cho
cÃ¡c kiá»ƒu khÃ¡c khi chÃºng ta cháº¡y kiá»ƒm thá»­. <em>Mock objects</em> lÃ  nhá»¯ng loáº¡i test doubles
cá»¥ thá»ƒ ghi láº¡i nhá»¯ng gÃ¬ xáº£y ra trong quÃ¡ trÃ¬nh kiá»ƒm thá»­ Ä‘á»ƒ báº¡n cÃ³ thá»ƒ xÃ¡c nháº­n ráº±ng cÃ¡c hÃ nh Ä‘á»™ng Ä‘Ãºng Ä‘Ã£ diá»…n ra.</p>
<p>Rust khÃ´ng cÃ³ cÃ¡c object theo cÃ¹ng cÃ¡ch cÃ¡c ngÃ´n ngá»¯ khÃ¡c cÃ³ object,
vÃ  Rust khÃ´ng cÃ³ chá»©c nÄƒng mock object tÃ­ch há»£p trong thÆ° viá»‡n chuáº©n nhÆ° má»™t sá»‘ ngÃ´n ngá»¯ khÃ¡c.
Tuy nhiÃªn, báº¡n hoÃ n toÃ n cÃ³ thá»ƒ táº¡o má»™t struct phá»¥c vá»¥ cÃ¹ng má»¥c Ä‘Ã­ch nhÆ° má»™t mock object.</p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  ká»‹ch báº£n mÃ  chÃºng ta sáº½ kiá»ƒm thá»­: chÃºng ta sáº½ táº¡o má»™t thÆ° viá»‡n theo dÃµi
giÃ¡ trá»‹ so vá»›i giÃ¡ trá»‹ tá»‘i Ä‘a vÃ  gá»­i thÃ´ng Ä‘iá»‡p dá»±a trÃªn má»©c gáº§n vá»›i giÃ¡ trá»‹ tá»‘i Ä‘a
mÃ  giÃ¡ trá»‹ hiá»‡n táº¡i Ä‘áº¡t Ä‘Æ°á»£c. ThÆ° viá»‡n nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ theo dÃµi háº¡n má»©c API mÃ  ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c phÃ©p gá»i, vÃ­ dá»¥.</p>
<p>ThÆ° viá»‡n cá»§a chÃºng ta chá»‰ cung cáº¥p chá»©c nÄƒng theo dÃµi má»©c gáº§n vá»›i giÃ¡ trá»‹
tá»‘i Ä‘a vÃ  cÃ¡c thÃ´ng Ä‘iá»‡p nÃªn Ä‘Æ°á»£c gá»­i khi nÃ o. á»¨ng dá»¥ng sá»­ dá»¥ng thÆ° viá»‡n nÃ y
sáº½ chá»‹u trÃ¡ch nhiá»‡m cung cáº¥p cÆ¡ cháº¿ gá»­i thÃ´ng Ä‘iá»‡p: á»©ng dá»¥ng cÃ³ thá»ƒ lÆ°u thÃ´ng Ä‘iá»‡p,
gá»­i email, gá»­i tin nháº¯n, hoáº·c thá»±c hiá»‡n viá»‡c khÃ¡c. ThÆ° viá»‡n khÃ´ng cáº§n biáº¿t chi tiáº¿t Ä‘Ã³.
Táº¥t cáº£ nhá»¯ng gÃ¬ nÃ³ cáº§n lÃ  má»™t thá»© gÃ¬ Ä‘Ã³ thá»±c thi má»™t trait mÃ  chÃºng ta sáº½ cung cáº¥p gá»i lÃ  <code>Messenger</code>.
Listing 15-20 hiá»ƒn thá»‹ mÃ£ thÆ° viá»‡n:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">pub trait Messenger {
    fn send(&amp;self, msg: &amp;str);
}

pub struct LimitTracker&lt;'a, T: Messenger&gt; {
    messenger: &amp;'a T,
    value: usize,
    max: usize,
}

impl&lt;'a, T&gt; LimitTracker&lt;'a, T&gt;
where
    T: Messenger,
{
    pub fn new(messenger: &amp;'a T, max: usize) -&gt; LimitTracker&lt;'a, T&gt; {
        LimitTracker {
            messenger,
            value: 0,
            max,
        }
    }

    pub fn set_value(&amp;mut self, value: usize) {
        self.value = value;

        let percentage_of_max = self.value as f64 / self.max as f64;

        if percentage_of_max &gt;= 1.0 {
            self.messenger.send("Error: You are over your quota!");
        } else if percentage_of_max &gt;= 0.9 {
            self.messenger
                .send("Urgent warning: You've used up over 90% of your quota!");
        } else if percentage_of_max &gt;= 0.75 {
            self.messenger
                .send("Warning: You've used up over 75% of your quota!");
        }
    }
}</code></pre>
<p><span class="caption">Listing 15-20: Má»™t thÆ° viá»‡n Ä‘á»ƒ theo dÃµi má»©c gáº§n vá»›i giÃ¡ trá»‹ tá»‘i Ä‘a vÃ  cáº£nh bÃ¡o khi giÃ¡ trá»‹ Ä‘áº¡t cÃ¡c má»©c nháº¥t Ä‘á»‹nh</span></p>
<p>Má»™t pháº§n quan trá»ng cá»§a mÃ£ nÃ y lÃ  trait <code>Messenger</code> cÃ³ má»™t phÆ°Æ¡ng thá»©c gá»i lÃ  <code>send</code> nháº­n má»™t tham chiáº¿u báº¥t biáº¿n tá»›i <code>self</code> vÃ  ná»™i dung cá»§a thÃ´ng Ä‘iá»‡p. Trait nÃ y lÃ  giao diá»‡n mÃ  mock object cá»§a chÃºng ta cáº§n thá»±c thi Ä‘á»ƒ mock cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng giá»‘ng nhÆ° má»™t object tháº­t. Pháº§n quan trá»ng khÃ¡c lÃ  chÃºng ta muá»‘n kiá»ƒm thá»­ hÃ nh vi cá»§a phÆ°Æ¡ng thá»©c <code>set_value</code> trÃªn <code>LimitTracker</code>. ChÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i giÃ¡ trá»‹ truyá»n vÃ o tham sá»‘ <code>value</code>, nhÆ°ng <code>set_value</code> khÃ´ng tráº£ vá» gÃ¬ Ä‘á»ƒ chÃºng ta thá»±c hiá»‡n cÃ¡c kháº³ng Ä‘á»‹nh. ChÃºng ta muá»‘n cÃ³ thá»ƒ nÃ³i ráº±ng náº¿u chÃºng ta táº¡o má»™t <code>LimitTracker</code> vá»›i má»™t thá»© thá»±c thi trait <code>Messenger</code> vÃ  má»™t giÃ¡ trá»‹ cá»¥ thá»ƒ cho <code>max</code>, khi truyá»n cÃ¡c sá»‘ khÃ¡c nhau cho <code>value</code>, messenger sáº½ Ä‘Æ°á»£c yÃªu cáº§u gá»­i cÃ¡c thÃ´ng Ä‘iá»‡p thÃ­ch há»£p.</p>
<p>ChÃºng ta cáº§n má»™t mock object mÃ  thay vÃ¬ gá»­i email hoáº·c tin nháº¯n khi gá»i <code>send</code>, chá»‰ giá»¯ láº¡i cÃ¡c thÃ´ng Ä‘iá»‡p mÃ  nÃ³ Ä‘Æ°á»£c yÃªu cáº§u gá»­i. ChÃºng ta cÃ³ thá»ƒ táº¡o má»™t instance má»›i cá»§a mock object, táº¡o má»™t <code>LimitTracker</code> sá»­ dá»¥ng mock object Ä‘Ã³, gá»i phÆ°Æ¡ng thá»©c <code>set_value</code> trÃªn <code>LimitTracker</code>, vÃ  sau Ä‘Ã³ kiá»ƒm tra xem mock object cÃ³ cÃ¡c thÃ´ng Ä‘iá»‡p mÃ  chÃºng ta mong Ä‘á»£i khÃ´ng. Listing 15-21 trÃ¬nh bÃ y má»™t thá»­ nghiá»‡m triá»ƒn khai mock object lÃ m viá»‡c nÃ y, nhÆ°ng trÃ¬nh kiá»ƒm tra mÆ°á»£n sáº½ khÃ´ng cho phÃ©p:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">pub trait Messenger {
</span><span class="boring">    fn send(&amp;self, msg: &amp;str);
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct LimitTracker&lt;'a, T: Messenger&gt; {
</span><span class="boring">    messenger: &amp;'a T,
</span><span class="boring">    value: usize,
</span><span class="boring">    max: usize,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl&lt;'a, T&gt; LimitTracker&lt;'a, T&gt;
</span><span class="boring">where
</span><span class="boring">    T: Messenger,
</span><span class="boring">{
</span><span class="boring">    pub fn new(messenger: &amp;'a T, max: usize) -&gt; LimitTracker&lt;'a, T&gt; {
</span><span class="boring">        LimitTracker {
</span><span class="boring">            messenger,
</span><span class="boring">            value: 0,
</span><span class="boring">            max,
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    pub fn set_value(&amp;mut self, value: usize) {
</span><span class="boring">        self.value = value;
</span><span class="boring">
</span><span class="boring">        let percentage_of_max = self.value as f64 / self.max as f64;
</span><span class="boring">
</span><span class="boring">        if percentage_of_max &gt;= 1.0 {
</span><span class="boring">            self.messenger.send("Error: You are over your quota!");
</span><span class="boring">        } else if percentage_of_max &gt;= 0.9 {
</span><span class="boring">            self.messenger
</span><span class="boring">                .send("Urgent warning: You've used up over 90% of your quota!");
</span><span class="boring">        } else if percentage_of_max &gt;= 0.75 {
</span><span class="boring">            self.messenger
</span><span class="boring">                .send("Warning: You've used up over 75% of your quota!");
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>#[cfg(test)]
mod tests {
    use super::*;

    struct MockMessenger {
        sent_messages: Vec&lt;String&gt;,
    }

    impl MockMessenger {
        fn new() -&gt; MockMessenger {
            MockMessenger {
                sent_messages: vec![],
            }
        }
    }

    impl Messenger for MockMessenger {
        fn send(&amp;self, message: &amp;str) {
            self.sent_messages.push(String::from(message));
        }
    }

    #[test]
    fn it_sends_an_over_75_percent_warning_message() {
        let mock_messenger = MockMessenger::new();
        let mut limit_tracker = LimitTracker::new(&amp;mock_messenger, 100);

        limit_tracker.set_value(80);

        assert_eq!(mock_messenger.sent_messages.len(), 1);
    }
}</code></pre>
<p><span class="caption">Listing 15-21: Má»™t ná»— lá»±c triá»ƒn khai <code>MockMessenger</code> nhÆ°ng khÃ´ng Ä‘Æ°á»£c trÃ¬nh kiá»ƒm tra mÆ°á»£n cho phÃ©p</span></p>
<p>MÃ£ kiá»ƒm thá»­ nÃ y Ä‘á»‹nh nghÄ©a má»™t struct <code>MockMessenger</code> cÃ³ trÆ°á»ng <code>sent_messages</code> vá»›i má»™t <code>Vec</code> chá»©a cÃ¡c giÃ¡ trá»‹ <code>String</code> Ä‘á»ƒ theo dÃµi cÃ¡c thÃ´ng Ä‘iá»‡p mÃ  nÃ³ Ä‘Æ°á»£c yÃªu cáº§u gá»­i. ChÃºng ta cÅ©ng Ä‘á»‹nh nghÄ©a má»™t hÃ m liÃªn káº¿t <code>new</code> Ä‘á»ƒ thuáº­n tiá»‡n táº¡o cÃ¡c giÃ¡ trá»‹ <code>MockMessenger</code> má»›i báº¯t Ä‘áº§u vá»›i danh sÃ¡ch thÃ´ng Ä‘iá»‡p trá»‘ng. Sau Ä‘Ã³, chÃºng ta triá»ƒn khai trait <code>Messenger</code> cho <code>MockMessenger</code> Ä‘á»ƒ cÃ³ thá»ƒ cung cáº¥p má»™t <code>MockMessenger</code> cho <code>LimitTracker</code>. Trong Ä‘á»‹nh nghÄ©a phÆ°Æ¡ng thá»©c <code>send</code>, chÃºng ta láº¥y thÃ´ng Ä‘iá»‡p truyá»n vÃ o dÆ°á»›i dáº¡ng tham sá»‘ vÃ  lÆ°u nÃ³ vÃ o danh sÃ¡ch <code>sent_messages</code> cá»§a <code>MockMessenger</code>.</p>
<p>Trong kiá»ƒm thá»­, chÃºng ta kiá»ƒm tra Ä‘iá»u gÃ¬ xáº£y ra khi <code>LimitTracker</code> Ä‘Æ°á»£c yÃªu cáº§u Ä‘áº·t <code>value</code> thÃ nh má»™t giÃ¡ trá»‹ lá»›n hÆ¡n 75% giÃ¡ trá»‹ <code>max</code>. TrÆ°á»›c tiÃªn, chÃºng ta táº¡o má»™t <code>MockMessenger</code> má»›i, báº¯t Ä‘áº§u vá»›i danh sÃ¡ch thÃ´ng Ä‘iá»‡p trá»‘ng. Sau Ä‘Ã³, chÃºng ta táº¡o má»™t <code>LimitTracker</code> má»›i vÃ  truyá»n cho nÃ³ má»™t tham chiáº¿u tá»›i <code>MockMessenger</code> má»›i vÃ  má»™t giÃ¡ trá»‹ <code>max</code> báº±ng 100. ChÃºng ta gá»i phÆ°Æ¡ng thá»©c <code>set_value</code> trÃªn <code>LimitTracker</code> vá»›i giÃ¡ trá»‹ 80, lá»›n hÆ¡n 75% cá»§a 100. Sau Ä‘Ã³, chÃºng ta kháº³ng Ä‘á»‹nh ráº±ng danh sÃ¡ch thÃ´ng Ä‘iá»‡p mÃ  <code>MockMessenger</code> theo dÃµi bÃ¢y giá» pháº£i cÃ³ má»™t thÃ´ng Ä‘iá»‡p.</p>
<p>Tuy nhiÃªn, cÃ³ má»™t váº¥n Ä‘á» vá»›i kiá»ƒm thá»­ nÃ y, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y á»Ÿ Ä‘Ã¢y:</p>
<pre><code class="language-console">$ cargo test
   Compiling limit-tracker v0.1.0 (file:///projects/limit-tracker)
error[E0596]: cannot borrow `self.sent_messages` as mutable, as it is behind a `&amp;` reference
  --&gt; src/lib.rs:58:13
   |
58 |             self.sent_messages.push(String::from(message));
   |             ^^^^^^^^^^^^^^^^^^ `self` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable
   |
help: consider changing this to be a mutable reference in the `impl` method and the `trait` definition
   |
2  ~     fn send(&amp;mut self, msg: &amp;str);
3  | }
...
56 |     impl Messenger for MockMessenger {
57 ~         fn send(&amp;mut self, message: &amp;str) {
   |

For more information about this error, try `rustc --explain E0596`.
error: could not compile `limit-tracker` (lib test) due to 1 previous error
</code></pre>
<p>ChÃºng ta khÃ´ng thá»ƒ sá»­a <code>MockMessenger</code> Ä‘á»ƒ theo dÃµi cÃ¡c thÃ´ng Ä‘iá»‡p, vÃ¬ phÆ°Æ¡ng thá»©c <code>send</code> nháº­n má»™t tham chiáº¿u khÃ´ng thay Ä‘á»•i tá»›i <code>self</code>. ChÃºng ta cÅ©ng khÃ´ng thá»ƒ Ã¡p dá»¥ng gá»£i Ã½ tá»« thÃ´ng bÃ¡o lá»—i Ä‘á»ƒ dÃ¹ng <code>&amp;mut self</code>, vÃ¬ khi Ä‘Ã³ chá»¯ kÃ½ cá»§a <code>send</code> sáº½ khÃ´ng khá»›p vá»›i chá»¯ kÃ½ trong Ä‘á»‹nh nghÄ©a trait <code>Messenger</code> (báº¡n cÃ³ thá»ƒ thá»­ vÃ  xem thÃ´ng bÃ¡o lá»—i nháº­n Ä‘Æ°á»£c).</p>
<p>ÄÃ¢y lÃ  má»™t tÃ¬nh huá»‘ng mÃ  <em>interior mutability</em> cÃ³ thá»ƒ giÃºp Ã­ch! ChÃºng ta sáº½ lÆ°u <code>sent_messages</code> bÃªn trong má»™t <code>RefCell&lt;T&gt;</code>, vÃ  sau Ä‘Ã³ phÆ°Æ¡ng thá»©c <code>send</code> sáº½ cÃ³ thá»ƒ sá»­a Ä‘á»•i <code>sent_messages</code> Ä‘á»ƒ lÆ°u cÃ¡c thÃ´ng Ä‘iá»‡p mÃ  chÃºng ta Ä‘Ã£ nháº­n tháº¥y. Listing 15-22 minh há»a Ä‘iá»u Ä‘Ã³:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">pub trait Messenger {
</span><span class="boring">    fn send(&amp;self, msg: &amp;str);
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct LimitTracker&lt;'a, T: Messenger&gt; {
</span><span class="boring">    messenger: &amp;'a T,
</span><span class="boring">    value: usize,
</span><span class="boring">    max: usize,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl&lt;'a, T&gt; LimitTracker&lt;'a, T&gt;
</span><span class="boring">where
</span><span class="boring">    T: Messenger,
</span><span class="boring">{
</span><span class="boring">    pub fn new(messenger: &amp;'a T, max: usize) -&gt; LimitTracker&lt;'a, T&gt; {
</span><span class="boring">        LimitTracker {
</span><span class="boring">            messenger,
</span><span class="boring">            value: 0,
</span><span class="boring">            max,
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    pub fn set_value(&amp;mut self, value: usize) {
</span><span class="boring">        self.value = value;
</span><span class="boring">
</span><span class="boring">        let percentage_of_max = self.value as f64 / self.max as f64;
</span><span class="boring">
</span><span class="boring">        if percentage_of_max &gt;= 1.0 {
</span><span class="boring">            self.messenger.send("Error: You are over your quota!");
</span><span class="boring">        } else if percentage_of_max &gt;= 0.9 {
</span><span class="boring">            self.messenger
</span><span class="boring">                .send("Urgent warning: You've used up over 90% of your quota!");
</span><span class="boring">        } else if percentage_of_max &gt;= 0.75 {
</span><span class="boring">            self.messenger
</span><span class="boring">                .send("Warning: You've used up over 75% of your quota!");
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>#[cfg(test)]
mod tests {
    use super::*;
    use std::cell::RefCell;

    struct MockMessenger {
        sent_messages: RefCell&lt;Vec&lt;String&gt;&gt;,
    }

    impl MockMessenger {
        fn new() -&gt; MockMessenger {
            MockMessenger {
                sent_messages: RefCell::new(vec![]),
            }
        }
    }

    impl Messenger for MockMessenger {
        fn send(&amp;self, message: &amp;str) {
            self.sent_messages.borrow_mut().push(String::from(message));
        }
    }

    #[test]
    fn it_sends_an_over_75_percent_warning_message() {
        // --snip--
<span class="boring">        let mock_messenger = MockMessenger::new();
</span><span class="boring">        let mut limit_tracker = LimitTracker::new(&amp;mock_messenger, 100);
</span><span class="boring">
</span><span class="boring">        limit_tracker.set_value(80);
</span>
        assert_eq!(mock_messenger.sent_messages.borrow().len(), 1);
    }
}</code></pre>
<p><span class="caption">Listing 15-22: Sá»­ dá»¥ng <code>RefCell&lt;T&gt;</code> Ä‘á»ƒ thay Ä‘á»•i giÃ¡ trá»‹ bÃªn trong trong khi giÃ¡ trá»‹ bÃªn ngoÃ i Ä‘Æ°á»£c coi lÃ  báº¥t biáº¿n</span></p>
<p>TrÆ°á»ng <code>sent_messages</code> bÃ¢y giá» cÃ³ kiá»ƒu <code>RefCell&lt;Vec&lt;String&gt;&gt;</code> thay vÃ¬ <code>Vec&lt;String&gt;</code>. Trong hÃ m <code>new</code>, chÃºng ta táº¡o má»™t thá»ƒ hiá»‡n <code>RefCell&lt;Vec&lt;String&gt;&gt;</code> xung quanh vector rá»—ng.</p>
<p>Trong pháº§n triá»ƒn khai phÆ°Æ¡ng thá»©c <code>send</code>, tham sá»‘ Ä‘áº§u tiÃªn váº«n lÃ  má»™t borrow báº¥t biáº¿n cá»§a <code>self</code>, khá»›p vá»›i Ä‘á»‹nh nghÄ©a trait. ChÃºng ta gá»i <code>borrow_mut</code> trÃªn <code>RefCell&lt;Vec&lt;String&gt;&gt;</code> trong <code>self.sent_messages</code> Ä‘á»ƒ láº¥y má»™t tham chiáº¿u mutable tá»›i giÃ¡ trá»‹ bÃªn trong <code>RefCell&lt;Vec&lt;String&gt;&gt;</code>, chÃ­nh lÃ  vector. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ gá»i <code>push</code> trÃªn tham chiáº¿u mutable cá»§a vector Ä‘á»ƒ lÆ°u láº¡i cÃ¡c thÃ´ng Ä‘iá»‡p Ä‘Æ°á»£c gá»­i trong quÃ¡ trÃ¬nh test.</p>
<p>Thay Ä‘á»•i cuá»‘i cÃ¹ng lÃ  trong assertion: Ä‘á»ƒ xem cÃ³ bao nhiÃªu má»¥c trong vector bÃªn trong, chÃºng ta gá»i <code>borrow</code> trÃªn <code>RefCell&lt;Vec&lt;String&gt;&gt;</code> Ä‘á»ƒ láº¥y má»™t tham chiáº¿u báº¥t biáº¿n tá»›i vector.</p>
<p>BÃ¢y giá» báº¡n Ä‘Ã£ tháº¥y cÃ¡ch sá»­ dá»¥ng <code>RefCell&lt;T&gt;</code>, hÃ£y tÃ¬m hiá»ƒu cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ng!</p>
<h4 id="theo-dÃµi-borrow-táº¡i-runtime-vá»›i-refcellt"><a class="header" href="#theo-dÃµi-borrow-táº¡i-runtime-vá»›i-refcellt">Theo dÃµi borrow táº¡i runtime vá»›i <code>RefCell&lt;T&gt;</code></a></h4>
<p>Khi táº¡o cÃ¡c tham chiáº¿u báº¥t biáº¿n vÃ  mutable, chÃºng ta dÃ¹ng cÃº phÃ¡p <code>&amp;</code> vÃ  <code>&amp;mut</code>. Vá»›i <code>RefCell&lt;T&gt;</code>, chÃºng ta dÃ¹ng cÃ¡c phÆ°Æ¡ng thá»©c <code>borrow</code> vÃ  <code>borrow_mut</code>, lÃ  má»™t pháº§n cá»§a API an toÃ n thuá»™c vá» <code>RefCell&lt;T&gt;</code>. PhÆ°Æ¡ng thá»©c <code>borrow</code> tráº£ vá» smart pointer kiá»ƒu <code>Ref&lt;T&gt;</code>, vÃ  <code>borrow_mut</code> tráº£ vá» smart pointer kiá»ƒu <code>RefMut&lt;T&gt;</code>. Cáº£ hai kiá»ƒu Ä‘á»u implement <code>Deref</code>, vÃ¬ váº­y chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng chÃºng nhÆ° cÃ¡c tham chiáº¿u thÃ´ng thÆ°á»ng.</p>
<p><code>RefCell&lt;T&gt;</code> theo dÃµi cÃ³ bao nhiÃªu smart pointer <code>Ref&lt;T&gt;</code> vÃ  <code>RefMut&lt;T&gt;</code> Ä‘ang hoáº¡t Ä‘á»™ng. Má»—i láº§n gá»i <code>borrow</code>, <code>RefCell&lt;T&gt;</code> tÄƒng sá»‘ lÆ°á»£ng immutable borrows Ä‘ang hoáº¡t Ä‘á»™ng. Khi má»™t giÃ¡ trá»‹ <code>Ref&lt;T&gt;</code> ra khá»i scope, sá»‘ lÆ°á»£ng immutable borrows giáº£m Ä‘i má»™t. Giá»‘ng nhÆ° cÃ¡c quy táº¯c borrow táº¡i compile-time, <code>RefCell&lt;T&gt;</code> cho phÃ©p nhiá»u immutable borrows hoáº·c má»™t mutable borrow táº¡i báº¥t ká»³ thá»i Ä‘iá»ƒm nÃ o.</p>
<p>Náº¿u chÃºng ta cá»‘ vi pháº¡m cÃ¡c quy táº¯c nÃ y, thay vÃ¬ nháº­n lá»—i biÃªn dá»‹ch nhÆ° vá»›i references, viá»‡c implement cá»§a <code>RefCell&lt;T&gt;</code> sáº½ gÃ¢y panic táº¡i runtime. Listing 15-23 minh há»a má»™t sá»­a Ä‘á»•i cá»§a phÆ°Æ¡ng thá»©c <code>send</code> trong Listing 15-22, chÃºng ta cá»‘ tÃ¬nh táº¡o hai mutable borrows cÃ¹ng lÃºc Ä‘á»ƒ chá»©ng minh ráº±ng <code>RefCell&lt;T&gt;</code> ngÄƒn cháº·n Ä‘iá»u nÃ y táº¡i runtime.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore panics"><span class="boring">pub trait Messenger {
</span><span class="boring">    fn send(&amp;self, msg: &amp;str);
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct LimitTracker&lt;'a, T: Messenger&gt; {
</span><span class="boring">    messenger: &amp;'a T,
</span><span class="boring">    value: usize,
</span><span class="boring">    max: usize,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl&lt;'a, T&gt; LimitTracker&lt;'a, T&gt;
</span><span class="boring">where
</span><span class="boring">    T: Messenger,
</span><span class="boring">{
</span><span class="boring">    pub fn new(messenger: &amp;'a T, max: usize) -&gt; LimitTracker&lt;'a, T&gt; {
</span><span class="boring">        LimitTracker {
</span><span class="boring">            messenger,
</span><span class="boring">            value: 0,
</span><span class="boring">            max,
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    pub fn set_value(&amp;mut self, value: usize) {
</span><span class="boring">        self.value = value;
</span><span class="boring">
</span><span class="boring">        let percentage_of_max = self.value as f64 / self.max as f64;
</span><span class="boring">
</span><span class="boring">        if percentage_of_max &gt;= 1.0 {
</span><span class="boring">            self.messenger.send("Error: You are over your quota!");
</span><span class="boring">        } else if percentage_of_max &gt;= 0.9 {
</span><span class="boring">            self.messenger
</span><span class="boring">                .send("Urgent warning: You've used up over 90% of your quota!");
</span><span class="boring">        } else if percentage_of_max &gt;= 0.75 {
</span><span class="boring">            self.messenger
</span><span class="boring">                .send("Warning: You've used up over 75% of your quota!");
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests {
</span><span class="boring">    use super::*;
</span><span class="boring">    use std::cell::RefCell;
</span><span class="boring">
</span><span class="boring">    struct MockMessenger {
</span><span class="boring">        sent_messages: RefCell&lt;Vec&lt;String&gt;&gt;,
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    impl MockMessenger {
</span><span class="boring">        fn new() -&gt; MockMessenger {
</span><span class="boring">            MockMessenger {
</span><span class="boring">                sent_messages: RefCell::new(vec![]),
</span><span class="boring">            }
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">
</span>    impl Messenger for MockMessenger {
        fn send(&amp;self, message: &amp;str) {
            let mut one_borrow = self.sent_messages.borrow_mut();
            let mut two_borrow = self.sent_messages.borrow_mut();

            one_borrow.push(String::from(message));
            two_borrow.push(String::from(message));
        }
    }
<span class="boring">
</span><span class="boring">    #[test]
</span><span class="boring">    fn it_sends_an_over_75_percent_warning_message() {
</span><span class="boring">        let mock_messenger = MockMessenger::new();
</span><span class="boring">        let mut limit_tracker = LimitTracker::new(&amp;mock_messenger, 100);
</span><span class="boring">
</span><span class="boring">        limit_tracker.set_value(80);
</span><span class="boring">
</span><span class="boring">        assert_eq!(mock_messenger.sent_messages.borrow().len(), 1);
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 15-23: Táº¡o hai tham chiáº¿u mutable trong cÃ¹ng má»™t scope Ä‘á»ƒ tháº¥y ráº±ng <code>RefCell&lt;T&gt;</code> sáº½ panic</span></p>
<p>ChÃºng ta táº¡o má»™t biáº¿n <code>one_borrow</code> cho smart pointer <code>RefMut&lt;T&gt;</code> Ä‘Æ°á»£c tráº£ vá» tá»« <code>borrow_mut</code>.
Sau Ä‘Ã³, chÃºng ta táº¡o má»™t borrow mutable khÃ¡c theo cÃ¡ch tÆ°Æ¡ng tá»± trong biáº¿n <code>two_borrow</code>.
Äiá»u nÃ y táº¡o ra hai tham chiáº¿u mutable trong cÃ¹ng má»™t scope, Ä‘iá»u mÃ  khÃ´ng Ä‘Æ°á»£c phÃ©p.
Khi cháº¡y cÃ¡c test cho thÆ° viá»‡n cá»§a chÃºng ta, mÃ£ trong Listing 15-23 sáº½ biÃªn dá»‹ch mÃ  khÃ´ng gáº·p lá»—i, nhÆ°ng test sáº½ tháº¥t báº¡i:</p>
<pre><code class="language-console">$ cargo test
   Compiling limit-tracker v0.1.0 (file:///projects/limit-tracker)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.91s
     Running unittests src/lib.rs (target/debug/deps/limit_tracker-e599811fa246dbde)

running 1 test
test tests::it_sends_an_over_75_percent_warning_message ... FAILED

failures:

---- tests::it_sends_an_over_75_percent_warning_message stdout ----

thread 'tests::it_sends_an_over_75_percent_warning_message' panicked at src/lib.rs:60:53:
already borrowed: BorrowMutError
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::it_sends_an_over_75_percent_warning_message

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `--lib`
</code></pre>
<p>LÆ°u Ã½ ráº±ng mÃ£ Ä‘Ã£ panic vá»›i thÃ´ng bÃ¡o <code>already borrowed: BorrowMutError</code>. ÄÃ¢y lÃ  cÃ¡ch mÃ  <code>RefCell&lt;T&gt;</code> xá»­ lÃ½ viá»‡c vi pháº¡m cÃ¡c quy táº¯c mÆ°á»£n (borrowing rules) táº¡i thá»i Ä‘iá»ƒm cháº¡y.</p>
<p>Viá»‡c chá»n kiá»ƒm tra lá»—i mÆ°á»£n táº¡i thá»i Ä‘iá»ƒm cháº¡y thay vÃ¬ thá»i Ä‘iá»ƒm biÃªn dá»‹ch, nhÆ° chÃºng ta Ä‘Ã£ lÃ m á»Ÿ Ä‘Ã¢y, cÃ³ nghÄ©a lÃ  báº¡n cÃ³ thá»ƒ sáº½ phÃ¡t hiá»‡n ra lá»—i trong mÃ£ muá»™n hÆ¡n trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn: cÃ³ thá»ƒ lÃ  cho Ä‘áº¿n khi mÃ£ cá»§a báº¡n Ä‘Æ°á»£c triá»ƒn khai vÃ o mÃ´i trÆ°á»ng sáº£n xuáº¥t. NgoÃ i ra, mÃ£ cá»§a báº¡n sáº½ chá»‹u má»™t chÃºt chi phÃ­ hiá»‡u nÄƒng táº¡i thá»i Ä‘iá»ƒm cháº¡y do pháº£i theo dÃµi cÃ¡c láº§n mÆ°á»£n táº¡i runtime thay vÃ¬ compile time. Tuy nhiÃªn, viá»‡c sá»­ dá»¥ng <code>RefCell&lt;T&gt;</code> cho phÃ©p báº¡n viáº¿t má»™t Ä‘á»‘i tÆ°á»£ng mock cÃ³ thá»ƒ tá»± sá»­a Ä‘á»•i Ä‘á»ƒ theo dÃµi cÃ¡c thÃ´ng Ä‘iá»‡p mÃ  nÃ³ Ä‘Ã£ nháº­n trong khi báº¡n Ä‘ang sá»­ dá»¥ng nÃ³ trong má»™t ngá»¯ cáº£nh mÃ  chá»‰ cho phÃ©p cÃ¡c giÃ¡ trá»‹ báº¥t biáº¿n (immutable). Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng <code>RefCell&lt;T&gt;</code> báº¥t cháº¥p nhá»¯ng Ä‘Ã¡nh Ä‘á»•i nÃ y Ä‘á»ƒ cÃ³ thÃªm chá»©c nÄƒng hÆ¡n so vá»›i cÃ¡c tham chiáº¿u thÃ´ng thÆ°á»ng.</p>
<h3 id="sá»Ÿ-há»¯u-nhiá»u-chá»§-sá»Ÿ-há»¯u-cho-dá»¯-liá»‡u-cÃ³-thá»ƒ-thay-Ä‘á»•i-báº±ng-cÃ¡ch-káº¿t-há»£p-rct-vÃ -refcellt"><a class="header" href="#sá»Ÿ-há»¯u-nhiá»u-chá»§-sá»Ÿ-há»¯u-cho-dá»¯-liá»‡u-cÃ³-thá»ƒ-thay-Ä‘á»•i-báº±ng-cÃ¡ch-káº¿t-há»£p-rct-vÃ -refcellt">Sá»Ÿ há»¯u nhiá»u chá»§ sá»Ÿ há»¯u cho dá»¯ liá»‡u cÃ³ thá»ƒ thay Ä‘á»•i báº±ng cÃ¡ch káº¿t há»£p <code>Rc&lt;T&gt;</code> vÃ  <code>RefCell&lt;T&gt;</code></a></h3>
<p>Má»™t cÃ¡ch phá»• biáº¿n Ä‘á»ƒ sá»­ dá»¥ng <code>RefCell&lt;T&gt;</code> lÃ  káº¿t há»£p vá»›i <code>Rc&lt;T&gt;</code>. Nhá»› ráº±ng <code>Rc&lt;T&gt;</code> cho phÃ©p báº¡n cÃ³ nhiá»u chá»§ sá»Ÿ há»¯u cho cÃ¹ng má»™t dá»¯ liá»‡u, nhÆ°ng nÃ³ chá»‰ cung cáº¥p quyá»n truy cáº­p báº¥t biáº¿n (immutable) tá»›i dá»¯ liá»‡u Ä‘Ã³. Náº¿u báº¡n cÃ³ má»™t <code>Rc&lt;T&gt;</code> chá»©a <code>RefCell&lt;T&gt;</code>, báº¡n sáº½ cÃ³ má»™t giÃ¡ trá»‹ vá»«a cÃ³ thá»ƒ cÃ³ nhiá»u chá»§ sá»Ÿ há»¯u <em>vá»«a</em> cÃ³ thá»ƒ thay Ä‘á»•i Ä‘Æ°á»£c!</p>
<p>VÃ­ dá»¥, hÃ£y nhá»› vÃ­ dá»¥ danh sÃ¡ch cons trong Listing 15-18, nÆ¡i chÃºng ta sá»­ dá»¥ng <code>Rc&lt;T&gt;</code> Ä‘á»ƒ cho phÃ©p nhiá»u danh sÃ¡ch chia sáº» quyá»n sá»Ÿ há»¯u cá»§a má»™t danh sÃ¡ch khÃ¡c. VÃ¬ <code>Rc&lt;T&gt;</code> chá»‰ chá»©a cÃ¡c giÃ¡ trá»‹ báº¥t biáº¿n, chÃºng ta khÃ´ng thá»ƒ thay Ä‘á»•i báº¥t ká»³ giÃ¡ trá»‹ nÃ o trong danh sÃ¡ch sau khi Ä‘Ã£ táº¡o chÃºng. HÃ£y thÃªm <code>RefCell&lt;T&gt;</code> Ä‘á»ƒ cÃ³ kháº£ nÄƒng thay Ä‘á»•i cÃ¡c giÃ¡ trá»‹ trong danh sÃ¡ch. Listing 15-24 cho tháº¥y ráº±ng báº±ng cÃ¡ch sá»­ dá»¥ng <code>RefCell&lt;T&gt;</code> trong Ä‘á»‹nh nghÄ©a <code>Cons</code>, chÃºng ta cÃ³ thá»ƒ sá»­a Ä‘á»•i giÃ¡ trá»‹ Ä‘Æ°á»£c lÆ°u trá»¯ trong táº¥t cáº£ cÃ¡c danh sÃ¡ch:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">#[derive(Debug)]
enum List {
    Cons(Rc&lt;RefCell&lt;i32&gt;&gt;, Rc&lt;List&gt;),
    Nil,
}

use crate::List::{Cons, Nil};
use std::cell::RefCell;
use std::rc::Rc;

fn main() {
    let value = Rc::new(RefCell::new(5));

    let a = Rc::new(Cons(Rc::clone(&amp;value), Rc::new(Nil)));

    let b = Cons(Rc::new(RefCell::new(3)), Rc::clone(&amp;a));
    let c = Cons(Rc::new(RefCell::new(4)), Rc::clone(&amp;a));

    *value.borrow_mut() += 10;

    println!("a after = {a:?}");
    println!("b after = {b:?}");
    println!("c after = {c:?}");
}</code></pre></pre>
<p><span class="caption">Listing 15-24: Sá»­ dá»¥ng <code>Rc&lt;RefCell&lt;i32&gt;&gt;</code> Ä‘á»ƒ táº¡o má»™t
<code>List</code> mÃ  chÃºng ta cÃ³ thá»ƒ thay Ä‘á»•i</span></p>
<p>ChÃºng ta táº¡o má»™t giÃ¡ trá»‹ lÃ  má»™t thá»ƒ hiá»‡n cá»§a <code>Rc&lt;RefCell&lt;i32&gt;&gt;</code> vÃ  lÆ°u nÃ³
vÃ o biáº¿n tÃªn lÃ  <code>value</code> Ä‘á»ƒ sau nÃ y cÃ³ thá»ƒ truy cáº­p trá»±c tiáº¿p. Sau Ä‘Ã³ chÃºng
ta táº¡o má»™t <code>List</code> trong <code>a</code> vá»›i biáº¿n thá»ƒ <code>Cons</code> chá»©a <code>value</code>. ChÃºng ta cáº§n
clone <code>value</code> Ä‘á»ƒ cáº£ <code>a</code> vÃ  <code>value</code> Ä‘á»u sá»Ÿ há»¯u giÃ¡ trá»‹ bÃªn trong lÃ  <code>5</code>, thay
vÃ¬ chuyá»ƒn quyá»n sá»Ÿ há»¯u tá»« <code>value</code> sang <code>a</code> hoáº·c Ä‘á»ƒ <code>a</code> mÆ°á»£n tá»« <code>value</code>.</p>
<p>ChÃºng ta bao <code>List</code> <code>a</code> trong má»™t <code>Rc&lt;T&gt;</code> Ä‘á»ƒ khi táº¡o cÃ¡c danh sÃ¡ch <code>b</code> vÃ  <code>c</code>,
cáº£ hai Ä‘á»u cÃ³ thá»ƒ tham chiáº¿u tá»›i <code>a</code>, giá»‘ng nhÆ° nhá»¯ng gÃ¬ chÃºng ta Ä‘Ã£ lÃ m
trong Listing 15-18.</p>
<p>Sau khi táº¡o cÃ¡c danh sÃ¡ch <code>a</code>, <code>b</code>, vÃ  <code>c</code>, chÃºng ta muá»‘n cá»™ng thÃªm 10
vÃ o giÃ¡ trá»‹ trong <code>value</code>. ChÃºng ta lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch gá»i <code>borrow_mut</code>
trÃªn <code>value</code>, sá»­ dá»¥ng tÃ­nh nÄƒng dereferencing tá»± Ä‘á»™ng mÃ  chÃºng ta Ä‘Ã£ tháº£o
luáº­n trong ChÆ°Æ¡ng 5 (xem pháº§n <a href="ch05-03-method-syntax.html#wheres-the---operator">â€œWhereâ€™s the <code>-&gt;</code> Operator?â€</a><!-- ignore -->)
Ä‘á»ƒ giáº£i tham chiáº¿u <code>Rc&lt;T&gt;</code> tá»›i giÃ¡ trá»‹ bÃªn trong <code>RefCell&lt;T&gt;</code>. PhÆ°Æ¡ng thá»©c
<code>borrow_mut</code> tráº£ vá» má»™t con trá» thÃ´ng minh <code>RefMut&lt;T&gt;</code>, vÃ  chÃºng ta sá»­ dá»¥ng
toÃ¡n tá»­ dereference trÃªn nÃ³ vÃ  thay Ä‘á»•i giÃ¡ trá»‹ bÃªn trong.</p>
<p>Khi in <code>a</code>, <code>b</code>, vÃ  <code>c</code>, chÃºng ta cÃ³ thá»ƒ tháº¥y ráº±ng táº¥t cáº£ Ä‘á»u cÃ³ giÃ¡ trá»‹
Ä‘Ã£ Ä‘Æ°á»£c sá»­a thÃ nh 15 thay vÃ¬ 5:</p>
<pre><code class="language-console">$ cargo run
   Compiling cons-list v0.1.0 (file:///projects/cons-list)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.63s
     Running `target/debug/cons-list`
a after = Cons(RefCell { value: 15 }, Nil)
b after = Cons(RefCell { value: 3 }, Cons(RefCell { value: 15 }, Nil))
c after = Cons(RefCell { value: 4 }, Cons(RefCell { value: 15 }, Nil))
</code></pre>
<p>Ká»¹ thuáº­t nÃ y khÃ¡ hay ho! Báº±ng cÃ¡ch sá»­ dá»¥ng <code>RefCell&lt;T&gt;</code>, chÃºng ta cÃ³ má»™t
giÃ¡ trá»‹ <code>List</code> bÃªn ngoÃ i lÃ  báº¥t biáº¿n. NhÆ°ng chÃºng ta cÃ³ thá»ƒ dÃ¹ng cÃ¡c phÆ°Æ¡ng
thá»©c trÃªn <code>RefCell&lt;T&gt;</code> cung cáº¥p quyá»n truy cáº­p vÃ o kháº£ nÄƒng thay Ä‘á»•i bÃªn trong
nÃ³ Ä‘á»ƒ sá»­a Ä‘á»•i dá»¯ liá»‡u khi cáº§n. CÃ¡c kiá»ƒm tra táº¡i thá»i gian cháº¡y vá» cÃ¡c quy
táº¯c mÆ°á»£n báº£o vá»‡ chÃºng ta khá»i cÃ¡c race condition, vÃ  Ä‘Ã´i khi Ä‘Ã¡ng Ä‘á»ƒ Ä‘Ã¡nh
Ä‘á»•i má»™t chÃºt tá»‘c Ä‘á»™ Ä‘á»ƒ cÃ³ sá»± linh hoáº¡t nÃ y trong cáº¥u trÃºc dá»¯ liá»‡u. LÆ°u Ã½
ráº±ng <code>RefCell&lt;T&gt;</code> khÃ´ng hoáº¡t Ä‘á»™ng cho mÃ£ Ä‘a luá»“ng! <code>Mutex&lt;T&gt;</code> lÃ  phiÃªn báº£n
an toÃ n cho luá»“ng cá»§a <code>RefCell&lt;T&gt;</code> vÃ  chÃºng ta sáº½ tháº£o luáº­n vá» <code>Mutex&lt;T&gt;</code>
trong ChÆ°Æ¡ng 16.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="chu-ká»³-tham-chiáº¿u-cÃ³-thá»ƒ-gÃ¢y-rÃ²-rá»‰-bá»™-nhá»›"><a class="header" href="#chu-ká»³-tham-chiáº¿u-cÃ³-thá»ƒ-gÃ¢y-rÃ²-rá»‰-bá»™-nhá»›">Chu ká»³ tham chiáº¿u cÃ³ thá»ƒ gÃ¢y rÃ² rá»‰ bá»™ nhá»›</a></h2>
<p>CÃ¡c Ä‘áº£m báº£o vá» an toÃ n bá»™ nhá»› cá»§a Rust khiáº¿n viá»‡c vÃ´ tÃ¬nh táº¡o ra bá»™ nhá»›
khÃ´ng bao giá» Ä‘Æ°á»£c giáº£i phÃ³ng (gá»i lÃ  <em>rÃ² rá»‰ bá»™ nhá»›</em>) trá»Ÿ nÃªn khÃ³ khÄƒn,
nhÆ°ng khÃ´ng pháº£i lÃ  khÃ´ng thá»ƒ. NgÄƒn cháº·n hoÃ n toÃ n rÃ² rá»‰ bá»™ nhá»› khÃ´ng pháº£i
lÃ  má»™t trong nhá»¯ng Ä‘áº£m báº£o cá»§a Rust, cÃ³ nghÄ©a lÃ  rÃ² rá»‰ bá»™ nhá»› váº«n an toÃ n
vá» máº·t bá»™ nhá»› trong Rust. ChÃºng ta cÃ³ thá»ƒ tháº¥y Rust cho phÃ©p rÃ² rá»‰ bá»™ nhá»›
khi sá»­ dá»¥ng <code>Rc&lt;T&gt;</code> vÃ  <code>RefCell&lt;T&gt;</code>: cÃ³ thá»ƒ táº¡o ra cÃ¡c tham chiáº¿u mÃ  cÃ¡c
pháº§n tá»­ tham chiáº¿u láº«n nhau theo má»™t chu ká»³. Äiá»u nÃ y gÃ¢y rÃ² rá»‰ bá»™ nhá»›
bá»Ÿi vÃ¬ sá»‘ tham chiáº¿u cá»§a má»—i pháº§n tá»­ trong chu ká»³ sáº½ khÃ´ng bao giá»
Ä‘áº¡t 0, vÃ  cÃ¡c giÃ¡ trá»‹ sáº½ khÃ´ng bao giá» Ä‘Æ°á»£c drop.</p>
<h3 id="táº¡o-má»™t-chu-ká»³-tham-chiáº¿u"><a class="header" href="#táº¡o-má»™t-chu-ká»³-tham-chiáº¿u">Táº¡o má»™t chu ká»³ tham chiáº¿u</a></h3>
<p>HÃ£y xem cÃ¡ch má»™t chu ká»³ tham chiáº¿u cÃ³ thá»ƒ xáº£y ra vÃ  cÃ¡ch ngÄƒn cháº·n nÃ³,
báº¯t Ä‘áº§u vá»›i Ä‘á»‹nh nghÄ©a cá»§a enum <code>List</code> vÃ  phÆ°Æ¡ng thá»©c <code>tail</code> trong Listing
15-25:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use crate::List::{Cons, Nil};
use std::cell::RefCell;
use std::rc::Rc;

#[derive(Debug)]
enum List {
    Cons(i32, RefCell&lt;Rc&lt;List&gt;&gt;),
    Nil,
}

impl List {
    fn tail(&amp;self) -&gt; Option&lt;&amp;RefCell&lt;Rc&lt;List&gt;&gt;&gt; {
        match self {
            Cons(_, item) =&gt; Some(item),
            Nil =&gt; None,
        }
    }
}

fn main() {}</code></pre></pre>
<p><span class="caption">Listing 15-25: Äá»‹nh nghÄ©a cons list giá»¯ má»™t
<code>RefCell&lt;T&gt;</code> Ä‘á»ƒ chÃºng ta cÃ³ thá»ƒ sá»­a Ä‘á»•i pháº§n mÃ  má»™t biáº¿n thá»ƒ <code>Cons</code> Ä‘ang tham chiáº¿u</span></p>
<p>ChÃºng ta Ä‘ang sá»­ dá»¥ng má»™t biáº¿n thá»ƒ khÃ¡c cá»§a Ä‘á»‹nh nghÄ©a <code>List</code> tá»« Listing 15-5.
Pháº§n tá»­ thá»© hai trong biáº¿n thá»ƒ <code>Cons</code> giá» lÃ  <code>RefCell&lt;Rc&lt;List&gt;&gt;</code>, cÃ³ nghÄ©a lÃ 
thay vÃ¬ chá»‰ sá»­a Ä‘á»•i giÃ¡ trá»‹ <code>i32</code> nhÆ° chÃºng ta Ä‘Ã£ lÃ m trong Listing 15-24,
chÃºng ta muá»‘n sá»­a Ä‘á»•i giÃ¡ trá»‹ <code>List</code> mÃ  má»™t biáº¿n thá»ƒ <code>Cons</code> Ä‘ang trá» tá»›i.
ChÃºng ta cÅ©ng thÃªm phÆ°Æ¡ng thá»©c <code>tail</code> Ä‘á»ƒ thuáº­n tiá»‡n khi truy cáº­p pháº§n tá»­
thá»© hai náº¿u chÃºng ta cÃ³ má»™t biáº¿n thá»ƒ <code>Cons</code>.</p>
<p>Trong Listing 15-26, chÃºng ta thÃªm má»™t hÃ m <code>main</code> sá»­ dá»¥ng cÃ¡c Ä‘á»‹nh nghÄ©a trong
Listing 15-25. Äoáº¡n code nÃ y táº¡o má»™t list trong <code>a</code> vÃ  má»™t list trong <code>b</code> trá»
tá»›i list trong <code>a</code>. Sau Ä‘Ã³ nÃ³ sá»­a Ä‘á»•i list trong <code>a</code> Ä‘á»ƒ trá» tá»›i <code>b</code>, táº¡o ra
má»™t chu ká»³ tham chiáº¿u. CÃ³ cÃ¡c cÃ¢u lá»‡nh <code>println!</code> dá»c theo quÃ¡ trÃ¬nh Ä‘á»ƒ hiá»ƒn
thá»‹ sá»‘ tham chiáº¿u táº¡i cÃ¡c Ä‘iá»ƒm khÃ¡c nhau.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">use crate::List::{Cons, Nil};
</span><span class="boring">use std::cell::RefCell;
</span><span class="boring">use std::rc::Rc;
</span><span class="boring">
</span><span class="boring">#[derive(Debug)]
</span><span class="boring">enum List {
</span><span class="boring">    Cons(i32, RefCell&lt;Rc&lt;List&gt;&gt;),
</span><span class="boring">    Nil,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl List {
</span><span class="boring">    fn tail(&amp;self) -&gt; Option&lt;&amp;RefCell&lt;Rc&lt;List&gt;&gt;&gt; {
</span><span class="boring">        match self {
</span><span class="boring">            Cons(_, item) =&gt; Some(item),
</span><span class="boring">            Nil =&gt; None,
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let a = Rc::new(Cons(5, RefCell::new(Rc::new(Nil))));

    println!("a initial rc count = {}", Rc::strong_count(&amp;a));
    println!("a next item = {:?}", a.tail());

    let b = Rc::new(Cons(10, RefCell::new(Rc::clone(&amp;a))));

    println!("a rc count after b creation = {}", Rc::strong_count(&amp;a));
    println!("b initial rc count = {}", Rc::strong_count(&amp;b));
    println!("b next item = {:?}", b.tail());

    if let Some(link) = a.tail() {
        *link.borrow_mut() = Rc::clone(&amp;b);
    }

    println!("b rc count after changing a = {}", Rc::strong_count(&amp;b));
    println!("a rc count after changing a = {}", Rc::strong_count(&amp;a));

    // Uncomment the next line to see that we have a cycle;
    // it will overflow the stack.
    // println!("a next item = {:?}", a.tail());
}</code></pre></pre>
<p><span class="caption">Listing 15-26: Táº¡o má»™t chu ká»³ tham chiáº¿u cá»§a hai giÃ¡ trá»‹ <code>List</code> trá» láº«n nhau</span></p>
<p>ChÃºng ta táº¡o má»™t instance <code>Rc&lt;List&gt;</code> giá»¯ má»™t giÃ¡ trá»‹ <code>List</code> trong biáº¿n <code>a</code>
vá»›i danh sÃ¡ch ban Ä‘áº§u lÃ  <code>5, Nil</code>. Sau Ä‘Ã³ chÃºng ta táº¡o má»™t instance <code>Rc&lt;List&gt;</code>
giá»¯ má»™t giÃ¡ trá»‹ <code>List</code> khÃ¡c trong biáº¿n <code>b</code> chá»©a giÃ¡ trá»‹ 10 vÃ  trá» tá»›i list trong <code>a</code>.</p>
<p>ChÃºng ta sá»­a Ä‘á»•i <code>a</code> Ä‘á»ƒ nÃ³ trá» tá»›i <code>b</code> thay vÃ¬ <code>Nil</code>, táº¡o ra má»™t chu ká»³.
ChÃºng ta lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>tail</code> Ä‘á»ƒ láº¥y tham chiáº¿u tá»›i
<code>RefCell&lt;Rc&lt;List&gt;&gt;</code> trong <code>a</code>, vÃ  lÆ°u vÃ o biáº¿n <code>link</code>. Sau Ä‘Ã³ chÃºng ta dÃ¹ng phÆ°Æ¡ng thá»©c
<code>borrow_mut</code> trÃªn <code>RefCell&lt;Rc&lt;List&gt;&gt;</code> Ä‘á»ƒ thay Ä‘á»•i giÃ¡ trá»‹ bÃªn trong tá»« má»™t <code>Rc&lt;List&gt;</code>
giá»¯ giÃ¡ trá»‹ <code>Nil</code> thÃ nh <code>Rc&lt;List&gt;</code> trong <code>b</code>.</p>
<p>Khi cháº¡y Ä‘oáº¡n code nÃ y, giá»¯ cÃ¢u lá»‡nh <code>println!</code> cuá»‘i cÃ¹ng Ä‘ang bá»‹ comment láº¡i,
chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c output sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling cons-list v0.1.0 (file:///projects/cons-list)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.53s
     Running `target/debug/cons-list`
a initial rc count = 1
a next item = Some(RefCell { value: Nil })
a rc count after b creation = 2
b initial rc count = 1
b next item = Some(RefCell { value: Cons(5, RefCell { value: Nil }) })
b rc count after changing a = 2
a rc count after changing a = 2
</code></pre>
<p>Sá»‘ lÆ°á»£ng tham chiáº¿u cá»§a cÃ¡c instance <code>Rc&lt;List&gt;</code> trong cáº£ <code>a</code> vÃ  <code>b</code> lÃ  2 sau khi
chÃºng ta thay Ä‘á»•i danh sÃ¡ch trong <code>a</code> Ä‘á»ƒ trá» tá»›i <code>b</code>. á» cuá»‘i <code>main</code>, Rust sáº½
drop biáº¿n <code>b</code>, Ä‘iá»u nÃ y lÃ m giáº£m sá»‘ lÆ°á»£ng tham chiáº¿u cá»§a instance <code>Rc&lt;List&gt;</code> trong <code>b</code>
tá»« 2 xuá»‘ng cÃ²n 1. Bá»™ nhá»› mÃ  <code>Rc&lt;List&gt;</code> chiáº¿m trÃªn heap sáº½ khÃ´ng bá»‹ giáº£i phÃ³ng táº¡i thá»i Ä‘iá»ƒm nÃ y,
bá»Ÿi vÃ¬ sá»‘ lÆ°á»£ng tham chiáº¿u váº«n lÃ  1, khÃ´ng pháº£i 0. Sau Ä‘Ã³, Rust drop <code>a</code>, lÃ m giáº£m sá»‘ lÆ°á»£ng
tham chiáº¿u cá»§a instance <code>Rc&lt;List&gt;</code> trong <code>a</code> tá»« 2 xuá»‘ng cÃ²n 1. Bá»™ nhá»› cá»§a instance nÃ y cÅ©ng
khÃ´ng thá»ƒ bá»‹ giáº£i phÃ³ng, vÃ¬ instance <code>Rc&lt;List&gt;</code> khÃ¡c váº«n trá» tá»›i nÃ³. Bá»™ nhá»› Ä‘Æ°á»£c cáº¥p phÃ¡t
cho danh sÃ¡ch sáº½ mÃ£i khÃ´ng Ä‘Æ°á»£c thu há»“i. Äá»ƒ hÃ¬nh dung chu ká»³ tham chiáº¿u nÃ y, chÃºng tÃ´i táº¡o má»™t sÆ¡ Ä‘á»“ trong HÃ¬nh 15-4.</p>
<img alt="Reference cycle of lists" src="img/trpl15-04.svg" class="center" />
<p><span class="caption">HÃ¬nh 15-4: Má»™t chu ká»³ tham chiáº¿u cá»§a cÃ¡c danh sÃ¡ch <code>a</code> vÃ  <code>b</code> trá» láº«n nhau</span></p>
<p>Náº¿u báº¡n bá» comment cÃ¢u lá»‡nh <code>println!</code> cuá»‘i cÃ¹ng vÃ  cháº¡y chÆ°Æ¡ng trÃ¬nh, Rust sáº½ cá»‘ gáº¯ng
in chu ká»³ nÃ y vá»›i <code>a</code> trá» tá»›i <code>b</code> trá» tá»›i <code>a</code> vÃ  cá»© tháº¿ cho Ä‘áº¿n khi trÃ n stack.</p>
<p>So vá»›i má»™t chÆ°Æ¡ng trÃ¬nh thá»±c táº¿, háº­u quáº£ cá»§a viá»‡c táº¡o chu ká»³ tham chiáº¿u trong vÃ­ dá»¥ nÃ y
khÃ´ng quÃ¡ nghiÃªm trá»ng: ngay sau khi chÃºng ta táº¡o chu ká»³ tham chiáº¿u, chÆ°Æ¡ng trÃ¬nh káº¿t thÃºc.
Tuy nhiÃªn, náº¿u má»™t chÆ°Æ¡ng trÃ¬nh phá»©c táº¡p hÆ¡n cáº¥p phÃ¡t nhiá»u bá»™ nhá»› trong má»™t chu ká»³ vÃ  giá»¯ nÃ³ lÃ¢u,
chÆ°Æ¡ng trÃ¬nh sáº½ sá»­ dá»¥ng nhiá»u bá»™ nhá»› hÆ¡n cáº§n thiáº¿t vÃ  cÃ³ thá»ƒ lÃ m há»‡ thá»‘ng bá»‹ quÃ¡ táº£i, dáº«n Ä‘áº¿n háº¿t bá»™ nhá»› kháº£ dá»¥ng.</p>
<p>Viá»‡c táº¡o chu ká»³ tham chiáº¿u khÃ´ng dá»…, nhÆ°ng cÅ©ng khÃ´ng pháº£i lÃ  khÃ´ng thá»ƒ. Náº¿u báº¡n cÃ³ cÃ¡c giÃ¡ trá»‹
<code>RefCell&lt;T&gt;</code> chá»©a cÃ¡c giÃ¡ trá»‹ <code>Rc&lt;T&gt;</code> hoáº·c cÃ¡c káº¿t há»£p lá»“ng nhau tÆ°Æ¡ng tá»± cá»§a cÃ¡c kiá»ƒu vá»›i kháº£ nÄƒng
biáº¿n Ä‘á»•i bÃªn trong vÃ  Ä‘áº¿m tham chiáº¿u, báº¡n pháº£i Ä‘áº£m báº£o ráº±ng mÃ¬nh khÃ´ng táº¡o ra cÃ¡c chu ká»³;
báº¡n khÃ´ng thá»ƒ trÃ´ng chá» Rust báº¯t lá»—i chÃºng. Táº¡o má»™t chu ká»³ tham chiáº¿u sáº½ lÃ  má»™t lá»—i logic trong chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n,
vÃ  báº¡n nÃªn dÃ¹ng kiá»ƒm thá»­ tá»± Ä‘á»™ng, review code vÃ  cÃ¡c phÆ°Æ¡ng phÃ¡p phÃ¡t triá»ƒn pháº§n má»m khÃ¡c Ä‘á»ƒ giáº£m thiá»ƒu.</p>
<p>Má»™t giáº£i phÃ¡p khÃ¡c Ä‘á»ƒ trÃ¡nh chu ká»³ tham chiáº¿u lÃ  tá»• chá»©c láº¡i cáº¥u trÃºc dá»¯ liá»‡u sao cho
má»™t sá»‘ tham chiáº¿u biá»ƒu thá»‹ quyá»n sá»Ÿ há»¯u vÃ  má»™t sá»‘ tham chiáº¿u khÃ´ng biá»ƒu thá»‹ quyá»n sá»Ÿ há»¯u.
Káº¿t quáº£ lÃ , báº¡n cÃ³ thá»ƒ cÃ³ cÃ¡c chu ká»³ Ä‘Æ°á»£c táº¡o tá»« má»™t sá»‘ quan há»‡ sá»Ÿ há»¯u vÃ  má»™t sá»‘ quan há»‡
khÃ´ng sá»Ÿ há»¯u, vÃ  chá»‰ cÃ¡c quan há»‡ sá»Ÿ há»¯u má»›i áº£nh hÆ°á»Ÿng tá»›i viá»‡c má»™t giÃ¡ trá»‹ cÃ³ thá»ƒ bá»‹ drop hay khÃ´ng.
Trong Listing 15-25, chÃºng ta luÃ´n muá»‘n cÃ¡c variant <code>Cons</code> sá»Ÿ há»¯u danh sÃ¡ch cá»§a chÃºng,
vÃ¬ váº­y viá»‡c tá»• chá»©c láº¡i cáº¥u trÃºc dá»¯ liá»‡u lÃ  khÃ´ng kháº£ thi. HÃ£y xem má»™t vÃ­ dá»¥ sá»­ dá»¥ng cÃ¡c Ä‘á»“ thá»‹
gá»“m cÃ¡c nÃºt cha vÃ  nÃºt con Ä‘á»ƒ tháº¥y khi nÃ o cÃ¡c quan há»‡ khÃ´ng sá»Ÿ há»¯u lÃ  cÃ¡ch phÃ¹ há»£p Ä‘á»ƒ ngÄƒn
chu ká»³ tham chiáº¿u.</p>
<h3 id="ngÄƒn-ngá»«a-chu-ká»³-tham-chiáº¿u-chuyá»ƒn-rct-thÃ nh-weakt"><a class="header" href="#ngÄƒn-ngá»«a-chu-ká»³-tham-chiáº¿u-chuyá»ƒn-rct-thÃ nh-weakt">NgÄƒn Ngá»«a Chu Ká»³ Tham Chiáº¿u: Chuyá»ƒn <code>Rc&lt;T&gt;</code> thÃ nh <code>Weak&lt;T&gt;</code></a></h3>
<p>Cho Ä‘áº¿n nay, chÃºng ta Ä‘Ã£ minh há»a ráº±ng viá»‡c gá»i <code>Rc::clone</code> sáº½ tÄƒng <code>strong_count</code>
cá»§a má»™t instance <code>Rc&lt;T&gt;</code>, vÃ  má»™t instance <code>Rc&lt;T&gt;</code> chá»‰ Ä‘Æ°á»£c dá»n dáº¹p náº¿u <code>strong_count</code>
cá»§a nÃ³ lÃ  0. Báº¡n cÅ©ng cÃ³ thá»ƒ táº¡o má»™t <em>tham chiáº¿u yáº¿u</em> tá»›i giÃ¡ trá»‹ bÃªn trong má»™t
instance <code>Rc&lt;T&gt;</code> báº±ng cÃ¡ch gá»i <code>Rc::downgrade</code> vÃ  truyá»n má»™t tham chiáº¿u tá»›i <code>Rc&lt;T&gt;</code>.
CÃ¡c tham chiáº¿u máº¡nh (strong) lÃ  cÃ¡ch báº¡n chia sáº» quyá»n sá»Ÿ há»¯u cá»§a má»™t instance <code>Rc&lt;T&gt;</code>.
CÃ¡c tham chiáº¿u yáº¿u (weak) khÃ´ng biá»ƒu thá»‹ má»‘i quan há»‡ sá»Ÿ há»¯u, vÃ  sá»‘ lÆ°á»£ng cá»§a chÃºng
khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n thá»i Ä‘iá»ƒm instance <code>Rc&lt;T&gt;</code> Ä‘Æ°á»£c dá»n dáº¹p. ChÃºng sáº½ khÃ´ng gÃ¢y ra chu ká»³
tham chiáº¿u vÃ¬ báº¥t ká»³ chu ká»³ nÃ o cÃ³ chá»©a tham chiáº¿u yáº¿u sáº½ bá»‹ phÃ¡ vá»¡ khi sá»‘ lÆ°á»£ng
tham chiáº¿u máº¡nh cá»§a cÃ¡c giÃ¡ trá»‹ liÃªn quan vá» 0.</p>
<p>Khi báº¡n gá»i <code>Rc::downgrade</code>, báº¡n nháº­n Ä‘Æ°á»£c má»™t smart pointer kiá»ƒu <code>Weak&lt;T&gt;</code>.
Thay vÃ¬ tÄƒng <code>strong_count</code> trong instance <code>Rc&lt;T&gt;</code> lÃªn 1, viá»‡c gá»i <code>Rc::downgrade</code>
sáº½ tÄƒng <code>weak_count</code> lÃªn 1. Kiá»ƒu <code>Rc&lt;T&gt;</code> dÃ¹ng <code>weak_count</code> Ä‘á»ƒ theo dÃµi cÃ³ bao nhiÃªu
tham chiáº¿u <code>Weak&lt;T&gt;</code> tá»“n táº¡i, tÆ°Æ¡ng tá»± nhÆ° <code>strong_count</code>. Sá»± khÃ¡c biá»‡t lÃ  <code>weak_count</code>
khÃ´ng cáº§n pháº£i vá» 0 Ä‘á»ƒ instance <code>Rc&lt;T&gt;</code> Ä‘Æ°á»£c dá»n dáº¹p.</p>
<p>VÃ¬ giÃ¡ trá»‹ mÃ  <code>Weak&lt;T&gt;</code> tham chiáº¿u cÃ³ thá»ƒ Ä‘Ã£ bá»‹ drop, Ä‘á»ƒ thao tÃ¡c vá»›i giÃ¡ trá»‹ mÃ  má»™t
<code>Weak&lt;T&gt;</code> trá» tá»›i, báº¡n pháº£i cháº¯c cháº¯n giÃ¡ trá»‹ váº«n tá»“n táº¡i. LÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch
gá»i phÆ°Æ¡ng thá»©c <code>upgrade</code> trÃªn instance <code>Weak&lt;T&gt;</code>, phÆ°Æ¡ng thá»©c nÃ y sáº½ tráº£ vá»
<code>Option&lt;Rc&lt;T&gt;&gt;</code>. Báº¡n sáº½ nháº­n Ä‘Æ°á»£c <code>Some</code> náº¿u giÃ¡ trá»‹ <code>Rc&lt;T&gt;</code> chÆ°a bá»‹ drop vÃ  <code>None</code>
náº¿u giÃ¡ trá»‹ <code>Rc&lt;T&gt;</code> Ä‘Ã£ bá»‹ drop. VÃ¬ <code>upgrade</code> tráº£ vá» <code>Option&lt;Rc&lt;T&gt;&gt;</code>, Rust sáº½ Ä‘áº£m báº£o
ráº±ng cáº£ trÆ°á»ng há»£p <code>Some</code> vÃ  <code>None</code> Ä‘á»u Ä‘Æ°á»£c xá»­ lÃ½, vÃ  sáº½ khÃ´ng cÃ³ con trá» khÃ´ng há»£p lá»‡.</p>
<p>VÃ­ dá»¥, thay vÃ¬ sá»­ dá»¥ng má»™t danh sÃ¡ch mÃ  cÃ¡c pháº§n tá»­ chá»‰ biáº¿t vá» pháº§n tá»­ tiáº¿p theo,
chÃºng ta sáº½ táº¡o má»™t cÃ¢y mÃ  cÃ¡c pháº§n tá»­ biáº¿t vá» cÃ¡c pháº§n tá»­ con <em>vÃ </em> cÃ¡c pháº§n tá»­ cha cá»§a chÃºng.</p>
<h4 id="táº¡o-cáº¥u-trÃºc-dá»¯-liá»‡u-cÃ¢y-má»™t-node-vá»›i-cÃ¡c-node-con"><a class="header" href="#táº¡o-cáº¥u-trÃºc-dá»¯-liá»‡u-cÃ¢y-má»™t-node-vá»›i-cÃ¡c-node-con">Táº¡o Cáº¥u TrÃºc Dá»¯ Liá»‡u CÃ¢y: má»™t <code>Node</code> vá»›i cÃ¡c Node Con</a></h4>
<p>Äá»ƒ báº¯t Ä‘áº§u, chÃºng ta sáº½ xÃ¢y dá»±ng má»™t cÃ¢y vá»›i cÃ¡c node biáº¿t vá» cÃ¡c node con cá»§a chÃºng.
ChÃºng ta sáº½ táº¡o má»™t struct cÃ³ tÃªn <code>Node</code> giá»¯ giÃ¡ trá»‹ <code>i32</code> cá»§a chÃ­nh nÃ³ cÅ©ng nhÆ° cÃ¡c
tham chiáº¿u tá»›i cÃ¡c giÃ¡ trá»‹ <code>Node</code> con:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::cell::RefCell;
use std::rc::Rc;

#[derive(Debug)]
struct Node {
    value: i32,
    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let leaf = Rc::new(Node {
</span><span class="boring">        value: 3,
</span><span class="boring">        children: RefCell::new(vec![]),
</span><span class="boring">    });
</span><span class="boring">
</span><span class="boring">    let branch = Rc::new(Node {
</span><span class="boring">        value: 5,
</span><span class="boring">        children: RefCell::new(vec![Rc::clone(&amp;leaf)]),
</span><span class="boring">    });
</span><span class="boring">}</span></code></pre></pre>
<p>ChÃºng ta muá»‘n má»™t <code>Node</code> sá»Ÿ há»¯u cÃ¡c node con cá»§a nÃ³, vÃ  chÃºng ta muá»‘n chia sáº» quyá»n sá»Ÿ há»¯u Ä‘Ã³ vá»›i cÃ¡c biáº¿n
Ä‘á»ƒ cÃ³ thá»ƒ truy cáº­p trá»±c tiáº¿p tá»«ng <code>Node</code> trong cÃ¢y. Äá»ƒ lÃ m Ä‘iá»u nÃ y, chÃºng ta Ä‘á»‹nh nghÄ©a cÃ¡c pháº§n tá»­ trong <code>Vec&lt;T&gt;</code>
lÃ  cÃ¡c giÃ¡ trá»‹ kiá»ƒu <code>Rc&lt;Node&gt;</code>. ChÃºng ta cÅ©ng muá»‘n thay Ä‘á»•i node nÃ o lÃ  con cá»§a node khÃ¡c,
vÃ¬ váº­y chÃºng ta Ä‘áº·t má»™t <code>RefCell&lt;T&gt;</code> trong <code>children</code> bao quanh <code>Vec&lt;Rc&lt;Node&gt;&gt;</code>.</p>
<p>Tiáº¿p theo, chÃºng ta sáº½ sá»­ dá»¥ng Ä‘á»‹nh nghÄ©a struct vÃ  táº¡o má»™t instance <code>Node</code> cÃ³ tÃªn <code>leaf</code> vá»›i giÃ¡ trá»‹ 3 vÃ  khÃ´ng cÃ³ node con,
vÃ  má»™t instance khÃ¡c cÃ³ tÃªn <code>branch</code> vá»›i giÃ¡ trá»‹ 5 vÃ  <code>leaf</code> lÃ  má»™t trong cÃ¡c node con cá»§a nÃ³,
nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 15-27:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">use std::cell::RefCell;
</span><span class="boring">use std::rc::Rc;
</span><span class="boring">
</span><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Node {
</span><span class="boring">    value: i32,
</span><span class="boring">    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let leaf = Rc::new(Node {
        value: 3,
        children: RefCell::new(vec![]),
    });

    let branch = Rc::new(Node {
        value: 5,
        children: RefCell::new(vec![Rc::clone(&amp;leaf)]),
    });
}</code></pre></pre>
<p>ChÃºng ta clone <code>Rc&lt;Node&gt;</code> trong <code>leaf</code> vÃ  lÆ°u vÃ o <code>branch</code>, nghÄ©a lÃ  <code>Node</code> trong <code>leaf</code> bÃ¢y giá» cÃ³ hai chá»§ sá»Ÿ há»¯u: <code>leaf</code> vÃ  <code>branch</code>.
ChÃºng ta cÃ³ thá»ƒ Ä‘i tá»« <code>branch</code> Ä‘áº¿n <code>leaf</code> thÃ´ng qua <code>branch.children</code>, nhÆ°ng khÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘i tá»« <code>leaf</code> Ä‘áº¿n <code>branch</code>.
LÃ½ do lÃ  <code>leaf</code> khÃ´ng cÃ³ tham chiáº¿u Ä‘áº¿n <code>branch</code> vÃ  khÃ´ng biáº¿t chÃºng cÃ³ liÃªn quan. ChÃºng ta muá»‘n <code>leaf</code> biáº¿t ráº±ng <code>branch</code> lÃ  cha cá»§a nÃ³.
ChÃºng ta sáº½ lÃ m Ä‘iá»u Ä‘Ã³ tiáº¿p theo.</p>
<h4 id="thÃªm-tham-chiáº¿u-tá»«-con-tá»›i-cha"><a class="header" href="#thÃªm-tham-chiáº¿u-tá»«-con-tá»›i-cha">ThÃªm Tham Chiáº¿u tá»« Con tá»›i Cha</a></h4>
<p>Äá»ƒ cho node con nháº­n biáº¿t cha cá»§a nÃ³, chÃºng ta cáº§n thÃªm má»™t trÆ°á»ng <code>parent</code> vÃ o Ä‘á»‹nh nghÄ©a struct <code>Node</code>.
Váº¥n Ä‘á» lÃ  xÃ¡c Ä‘á»‹nh kiá»ƒu dá»¯ liá»‡u cá»§a <code>parent</code> nÃªn lÃ  gÃ¬. ChÃºng ta biáº¿t nÃ³ khÃ´ng thá»ƒ chá»©a <code>Rc&lt;T&gt;</code>, vÃ¬ Ä‘iá»u Ä‘Ã³ sáº½ táº¡o ra má»™t vÃ²ng tham chiáº¿u
vá»›i <code>leaf.parent</code> trá» tá»›i <code>branch</code> vÃ  <code>branch.children</code> trá» tá»›i <code>leaf</code>, dáº«n Ä‘áº¿n giÃ¡ trá»‹ <code>strong_count</code> cá»§a chÃºng sáº½ khÃ´ng bao giá» vá» 0.</p>
<p>Xem xÃ©t cÃ¡c má»‘i quan há»‡ theo cÃ¡ch khÃ¡c, má»™t node cha nÃªn sá»Ÿ há»¯u cÃ¡c node con cá»§a nÃ³: náº¿u má»™t node cha bá»‹ drop, cÃ¡c node con cÅ©ng nÃªn bá»‹ drop theo.
Tuy nhiÃªn, má»™t node con khÃ´ng nÃªn sá»Ÿ há»¯u cha cá»§a nÃ³: náº¿u chÃºng ta drop má»™t node con, node cha váº«n tá»“n táº¡i. ÄÃ¢y lÃ  trÆ°á»ng há»£p sá»­ dá»¥ng tham chiáº¿u yáº¿u!</p>
<p>VÃ¬ váº­y, thay vÃ¬ dÃ¹ng <code>Rc&lt;T&gt;</code>, chÃºng ta sáº½ lÃ m kiá»ƒu cá»§a <code>parent</code> sá»­ dá»¥ng <code>Weak&lt;T&gt;</code>, cá»¥ thá»ƒ lÃ  <code>RefCell&lt;Weak&lt;Node&gt;&gt;</code>.
BÃ¢y giá» Ä‘á»‹nh nghÄ©a struct <code>Node</code> cá»§a chÃºng ta trÃ´ng nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::cell::RefCell;
use std::rc::{Rc, Weak};

#[derive(Debug)]
struct Node {
    value: i32,
    parent: RefCell&lt;Weak&lt;Node&gt;&gt;,
    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let leaf = Rc::new(Node {
</span><span class="boring">        value: 3,
</span><span class="boring">        parent: RefCell::new(Weak::new()),
</span><span class="boring">        children: RefCell::new(vec![]),
</span><span class="boring">    });
</span><span class="boring">
</span><span class="boring">    println!("leaf parent = {:?}", leaf.parent.borrow().upgrade());
</span><span class="boring">
</span><span class="boring">    let branch = Rc::new(Node {
</span><span class="boring">        value: 5,
</span><span class="boring">        parent: RefCell::new(Weak::new()),
</span><span class="boring">        children: RefCell::new(vec![Rc::clone(&amp;leaf)]),
</span><span class="boring">    });
</span><span class="boring">
</span><span class="boring">    *leaf.parent.borrow_mut() = Rc::downgrade(&amp;branch);
</span><span class="boring">
</span><span class="boring">    println!("leaf parent = {:?}", leaf.parent.borrow().upgrade());
</span><span class="boring">}</span></code></pre></pre>
<p>Má»™t node sáº½ cÃ³ thá»ƒ tham chiáº¿u tá»›i node cha cá»§a nÃ³ nhÆ°ng khÃ´ng sá»Ÿ há»¯u node cha.
Trong Listing 15-28, chÃºng ta cáº­p nháº­t <code>main</code> Ä‘á»ƒ sá»­ dá»¥ng Ä‘á»‹nh nghÄ©a má»›i nÃ y,
vÃ¬ váº­y node <code>leaf</code> sáº½ cÃ³ cÃ¡ch Ä‘á»ƒ tham chiáº¿u tá»›i cha cá»§a nÃ³ lÃ  <code>branch</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">use std::cell::RefCell;
</span><span class="boring">use std::rc::{Rc, Weak};
</span><span class="boring">
</span><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Node {
</span><span class="boring">    value: i32,
</span><span class="boring">    parent: RefCell&lt;Weak&lt;Node&gt;&gt;,
</span><span class="boring">    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let leaf = Rc::new(Node {
        value: 3,
        parent: RefCell::new(Weak::new()),
        children: RefCell::new(vec![]),
    });

    println!("leaf parent = {:?}", leaf.parent.borrow().upgrade());

    let branch = Rc::new(Node {
        value: 5,
        parent: RefCell::new(Weak::new()),
        children: RefCell::new(vec![Rc::clone(&amp;leaf)]),
    });

    *leaf.parent.borrow_mut() = Rc::downgrade(&amp;branch);

    println!("leaf parent = {:?}", leaf.parent.borrow().upgrade());
}</code></pre></pre>
<p><span class="caption">Listing 15-28: Node <code>leaf</code> vá»›i tham chiáº¿u yáº¿u tá»›i node cha <code>branch</code></span></p>
<p>Viá»‡c táº¡o node <code>leaf</code> trÃ´ng giá»‘ng nhÆ° trong Listing 15-27 ngoáº¡i trá»« trÆ°á»ng <code>parent</code>:
<code>leaf</code> báº¯t Ä‘áº§u mÃ  khÃ´ng cÃ³ cha, vÃ¬ váº­y chÃºng ta táº¡o má»™t instance <code>Weak&lt;Node&gt;</code> má»›i, rá»—ng.</p>
<p>Táº¡i thá»i Ä‘iá»ƒm nÃ y, khi chÃºng ta cá»‘ láº¥y tham chiáº¿u tá»›i cha cá»§a <code>leaf</code> báº±ng phÆ°Æ¡ng thá»©c
<code>upgrade</code>, chÃºng ta nháº­n Ä‘Æ°á»£c giÃ¡ trá»‹ <code>None</code>. Äiá»u nÃ y Ä‘Æ°á»£c thá»ƒ hiá»‡n trong káº¿t quáº£
tá»« cÃ¢u lá»‡nh <code>println!</code> Ä‘áº§u tiÃªn:</p>
<pre><code class="language-text">leaf parent = None
</code></pre>
<p>Khi chÃºng ta táº¡o node <code>branch</code>, nÃ³ cÅ©ng sáº½ cÃ³ má»™t tham chiáº¿u <code>Weak&lt;Node&gt;</code> má»›i trong
trÆ°á»ng <code>parent</code>, vÃ¬ <code>branch</code> khÃ´ng cÃ³ node cha. ChÃºng ta váº«n giá»¯ <code>leaf</code> lÃ  má»™t trong
cÃ¡c con cá»§a <code>branch</code>. Khi Ä‘Ã£ cÃ³ instance <code>Node</code> trong <code>branch</code>, chÃºng ta cÃ³ thá»ƒ sá»­a
<code>leaf</code> Ä‘á»ƒ cung cáº¥p cho nÃ³ má»™t tham chiáº¿u <code>Weak&lt;Node&gt;</code> tá»›i cha cá»§a nÃ³. ChÃºng ta dÃ¹ng
phÆ°Æ¡ng thá»©c <code>borrow_mut</code> trÃªn <code>RefCell&lt;Weak&lt;Node&gt;&gt;</code> trong trÆ°á»ng <code>parent</code> cá»§a <code>leaf</code>,
sau Ä‘Ã³ dÃ¹ng hÃ m <code>Rc::downgrade</code> Ä‘á»ƒ táº¡o má»™t tham chiáº¿u <code>Weak&lt;Node&gt;</code> tá»›i <code>branch</code> tá»«
<code>Rc&lt;Node&gt;</code> trong <code>branch</code>.</p>
<p>Khi in láº¡i cha cá»§a <code>leaf</code>, láº§n nÃ y chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c biáº¿n thá»ƒ <code>Some</code> chá»©a <code>branch</code>:
bÃ¢y giá» <code>leaf</code> cÃ³ thá»ƒ truy cáº­p cha cá»§a nÃ³! Khi in <code>leaf</code>, chÃºng ta cÅ©ng trÃ¡nh Ä‘Æ°á»£c
vÃ²ng láº·p tham chiáº¿u gÃ¢y trÃ n stack nhÆ° trong Listing 15-26; cÃ¡c tham chiáº¿u <code>Weak&lt;Node&gt;</code>
Ä‘Æ°á»£c in ra dÆ°á»›i dáº¡ng <code>(Weak)</code>:</p>
<pre><code class="language-text">leaf parent = Some(Node { value: 5, parent: RefCell { value: (Weak) },
children: RefCell { value: [Node { value: 3, parent: RefCell { value: (Weak) },
children: RefCell { value: [] } }] } })
</code></pre>
<p>Viá»‡c khÃ´ng cÃ³ Ä‘áº§u ra vÃ´ háº¡n cho tháº¥y mÃ£ nÃ y khÃ´ng táº¡o ra vÃ²ng láº·p tham chiáº¿u. ChÃºng ta
cÅ©ng cÃ³ thá»ƒ nháº­n tháº¥y Ä‘iá»u nÃ y báº±ng cÃ¡ch xem cÃ¡c giÃ¡ trá»‹ nháº­n Ä‘Æ°á»£c tá»« viá»‡c gá»i
<code>Rc::strong_count</code> vÃ  <code>Rc::weak_count</code>.</p>
<h4 id="trá»±c-quan-hÃ³a-cÃ¡c-thay-Ä‘á»•i-cá»§a-strong_count-vÃ -weak_count"><a class="header" href="#trá»±c-quan-hÃ³a-cÃ¡c-thay-Ä‘á»•i-cá»§a-strong_count-vÃ -weak_count">Trá»±c quan hÃ³a cÃ¡c thay Ä‘á»•i cá»§a <code>strong_count</code> vÃ  <code>weak_count</code></a></h4>
<p>HÃ£y xem cÃ¡ch cÃ¡c giÃ¡ trá»‹ <code>strong_count</code> vÃ  <code>weak_count</code> cá»§a cÃ¡c instance <code>Rc&lt;Node&gt;</code>
thay Ä‘á»•i báº±ng cÃ¡ch táº¡o má»™t pháº¡m vi con má»›i vÃ  chuyá»ƒn viá»‡c táº¡o <code>branch</code> vÃ o pháº¡m vi Ä‘Ã³.
Báº±ng cÃ¡ch nÃ y, chÃºng ta cÃ³ thá»ƒ tháº¥y Ä‘iá»u gÃ¬ xáº£y ra khi <code>branch</code> Ä‘Æ°á»£c táº¡o vÃ  sau Ä‘Ã³ bá»‹
há»§y khi nÃ³ ra khá»i pháº¡m vi. CÃ¡c thay Ä‘á»•i Ä‘Æ°á»£c thá»ƒ hiá»‡n trong Listing 15-29:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">use std::cell::RefCell;
</span><span class="boring">use std::rc::{Rc, Weak};
</span><span class="boring">
</span><span class="boring">#[derive(Debug)]
</span><span class="boring">struct Node {
</span><span class="boring">    value: i32,
</span><span class="boring">    parent: RefCell&lt;Weak&lt;Node&gt;&gt;,
</span><span class="boring">    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,
</span><span class="boring">}
</span><span class="boring">
</span>fn main() {
    let leaf = Rc::new(Node {
        value: 3,
        parent: RefCell::new(Weak::new()),
        children: RefCell::new(vec![]),
    });

    println!(
        "leaf strong = {}, weak = {}",
        Rc::strong_count(&amp;leaf),
        Rc::weak_count(&amp;leaf),
    );

    {
        let branch = Rc::new(Node {
            value: 5,
            parent: RefCell::new(Weak::new()),
            children: RefCell::new(vec![Rc::clone(&amp;leaf)]),
        });

        *leaf.parent.borrow_mut() = Rc::downgrade(&amp;branch);

        println!(
            "branch strong = {}, weak = {}",
            Rc::strong_count(&amp;branch),
            Rc::weak_count(&amp;branch),
        );

        println!(
            "leaf strong = {}, weak = {}",
            Rc::strong_count(&amp;leaf),
            Rc::weak_count(&amp;leaf),
        );
    }

    println!("leaf parent = {:?}", leaf.parent.borrow().upgrade());
    println!(
        "leaf strong = {}, weak = {}",
        Rc::strong_count(&amp;leaf),
        Rc::weak_count(&amp;leaf),
    );
}</code></pre></pre>
<p><span class="caption">Listing 15-29: Táº¡o <code>branch</code> trong má»™t pháº¡m vi con vÃ 
kiá»ƒm tra sá»‘ lÆ°á»£ng tham chiáº¿u máº¡nh vÃ  yáº¿u</span></p>
<p>Sau khi <code>leaf</code> Ä‘Æ°á»£c táº¡o, <code>Rc&lt;Node&gt;</code> cá»§a nÃ³ cÃ³ <code>strong count</code> lÃ  1 vÃ  <code>weak count</code> lÃ  0.
Trong pháº¡m vi con, chÃºng ta táº¡o <code>branch</code> vÃ  liÃªn káº¿t nÃ³ vá»›i <code>leaf</code>, vÃ o thá»i Ä‘iá»ƒm Ä‘Ã³ khi
in ra cÃ¡c sá»‘ lÆ°á»£ng, <code>Rc&lt;Node&gt;</code> trong <code>branch</code> sáº½ cÃ³ <code>strong count</code> lÃ  1 vÃ  <code>weak count</code> lÃ  1
(cho <code>leaf.parent</code> trá» tá»›i <code>branch</code> vá»›i má»™t <code>Weak&lt;Node&gt;</code>). Khi in cÃ¡c sá»‘ lÆ°á»£ng cá»§a <code>leaf</code>,
chÃºng ta sáº½ tháº¥y nÃ³ cÃ³ <code>strong count</code> lÃ  2, vÃ¬ <code>branch</code> bÃ¢y giá» cÃ³ má»™t báº£n clone cá»§a
<code>Rc&lt;Node&gt;</code> cá»§a <code>leaf</code> lÆ°u trong <code>branch.children</code>, nhÆ°ng váº«n cÃ³ <code>weak count</code> lÃ  0.</p>
<p>Khi pháº¡m vi con káº¿t thÃºc, <code>branch</code> ra khá»i pháº¡m vi vÃ  <code>strong count</code> cá»§a <code>Rc&lt;Node&gt;</code> giáº£m xuá»‘ng 0,
vÃ¬ váº­y <code>Node</code> cá»§a nÃ³ bá»‹ drop. <code>weak count</code> lÃ  1 tá»« <code>leaf.parent</code> khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n viá»‡c <code>Node</code>
cÃ³ bá»‹ drop hay khÃ´ng, vÃ¬ váº­y chÃºng ta khÃ´ng gáº·p rÃ² rá»‰ bá»™ nhá»›!</p>
<p>Náº¿u chÃºng ta thá»­ truy cáº­p parent cá»§a <code>leaf</code> sau khi káº¿t thÃºc pháº¡m vi, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c
<code>None</code> má»™t láº§n ná»¯a. Cuá»‘i chÆ°Æ¡ng trÃ¬nh, <code>Rc&lt;Node&gt;</code> trong <code>leaf</code> cÃ³ <code>strong count</code> lÃ  1 vÃ 
<code>weak count</code> lÃ  0, vÃ¬ biáº¿n <code>leaf</code> bÃ¢y giá» lÃ  tham chiáº¿u duy nháº¥t Ä‘áº¿n <code>Rc&lt;Node&gt;</code>.</p>
<p>Táº¥t cáº£ logic quáº£n lÃ½ sá»‘ lÆ°á»£ng tham chiáº¿u vÃ  viá»‡c drop giÃ¡ trá»‹ Ä‘á»u Ä‘Æ°á»£c tÃ­ch há»£p trong
<code>Rc&lt;T&gt;</code> vÃ  <code>Weak&lt;T&gt;</code> cÃ¹ng vá»›i cÃ¡c implement cá»§a trait <code>Drop</code>. Báº±ng cÃ¡ch xÃ¡c Ä‘á»‹nh ráº±ng
má»‘i quan há»‡ tá»« con Ä‘áº¿n cha nÃªn lÃ  má»™t tham chiáº¿u <code>Weak&lt;T&gt;</code> trong Ä‘á»‹nh nghÄ©a cá»§a <code>Node</code>,
báº¡n cÃ³ thá»ƒ cho cÃ¡c node cha trá» tá»›i node con vÃ  ngÆ°á»£c láº¡i mÃ  khÃ´ng táº¡o ra vÃ²ng tham chiáº¿u
vÃ  rÃ² rá»‰ bá»™ nhá»›.</p>
<h2 id="tÃ³m-táº¯t-5"><a class="header" href="#tÃ³m-táº¯t-5">TÃ³m táº¯t</a></h2>
<p>ChÆ°Æ¡ng nÃ y trÃ¬nh bÃ y cÃ¡ch sá»­ dá»¥ng smart pointer Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c Ä‘áº£m báº£o vÃ  Ä‘Ã¡nh Ä‘á»•i khÃ¡c
vá»›i nhá»¯ng gÃ¬ Rust máº·c Ä‘á»‹nh thá»±c hiá»‡n vá»›i cÃ¡c reference thÃ´ng thÆ°á»ng. Kiá»ƒu <code>Box&lt;T&gt;</code> cÃ³ kÃ­ch thÆ°á»›c
cá»‘ Ä‘á»‹nh vÃ  trá» Ä‘áº¿n dá»¯ liá»‡u Ä‘Æ°á»£c cáº¥p phÃ¡t trÃªn heap. Kiá»ƒu <code>Rc&lt;T&gt;</code> theo dÃµi sá»‘ lÆ°á»£ng tham
chiáº¿u Ä‘áº¿n dá»¯ liá»‡u trÃªn heap Ä‘á»ƒ dá»¯ liá»‡u cÃ³ thá»ƒ cÃ³ nhiá»u chá»§ sá»Ÿ há»¯u. Kiá»ƒu <code>RefCell&lt;T&gt;</code> vá»›i
kháº£ nÄƒng mutability ná»™i táº¡i cung cáº¥p cho chÃºng ta má»™t kiá»ƒu cÃ³ thá»ƒ sá»­ dá»¥ng khi cáº§n má»™t kiá»ƒu
immutable nhÆ°ng váº«n cáº§n thay Ä‘á»•i giÃ¡ trá»‹ bÃªn trong; nÃ³ cÅ©ng thá»±c thi cÃ¡c quy táº¯c mÆ°á»£n táº¡i
runtime thay vÃ¬ compile time.</p>
<p>ChÃºng ta cÅ©ng Ä‘Ã£ bÃ n vá» cÃ¡c trait <code>Deref</code> vÃ  <code>Drop</code>, cho phÃ©p nhiá»u chá»©c nÄƒng cá»§a smart pointer.
ChÃºng ta khÃ¡m phÃ¡ cÃ¡c vÃ²ng tham chiáº¿u cÃ³ thá»ƒ gÃ¢y rÃ² rá»‰ bá»™ nhá»› vÃ  cÃ¡ch ngÄƒn cháº·n chÃºng báº±ng
<code>Weak&lt;T&gt;</code>.</p>
<p>Náº¿u chÆ°Æ¡ng nÃ y khiáº¿n báº¡n há»©ng thÃº vÃ  báº¡n muá»‘n triá»ƒn khai smart pointer cá»§a riÃªng mÃ¬nh, hÃ£y xem
thÃªm táº¡i <a href="../nomicon/index.html">â€œThe Rustonomiconâ€</a> Ä‘á»ƒ cÃ³ thÃªm thÃ´ng tin há»¯u Ã­ch.</p>
<p>Tiáº¿p theo, chÃºng ta sáº½ bÃ n vá» Ä‘á»“ng thá»i trong Rust. Báº¡n tháº­m chÃ­ sáº½ Ä‘Æ°á»£c tÃ¬m hiá»ƒu vá» vÃ i smart
pointer má»›i.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="Äá»“ng-thá»i-khÃ´ng-sá»£-hÃ£i"><a class="header" href="#Äá»“ng-thá»i-khÃ´ng-sá»£-hÃ£i">Äá»“ng Thá»i KhÃ´ng Sá»£ HÃ£i</a></h1>
<p>Xá»­ lÃ½ láº­p trÃ¬nh Ä‘á»“ng thá»i má»™t cÃ¡ch an toÃ n vÃ  hiá»‡u quáº£ lÃ  má»™t trong nhá»¯ng má»¥c tiÃªu lá»›n cá»§a Rust. <em>Láº­p trÃ¬nh Ä‘á»“ng thá»i</em> (concurrent programming), nÆ¡i cÃ¡c pháº§n khÃ¡c nhau cá»§a chÆ°Æ¡ng trÃ¬nh thá»±c thi Ä‘á»™c láº­p, vÃ  <em>láº­p trÃ¬nh song song</em> (parallel programming), nÆ¡i cÃ¡c pháº§n khÃ¡c nhau cá»§a chÆ°Æ¡ng trÃ¬nh thá»±c thi cÃ¹ng má»™t lÃºc, Ä‘ang trá»Ÿ nÃªn ngÃ y cÃ ng quan trá»ng khi nhiá»u mÃ¡y tÃ­nh táº­n dá»¥ng nhiá»u bá»™ xá»­ lÃ½ cá»§a chÃºng. Trong lá»‹ch sá»­, láº­p trÃ¬nh trong nhá»¯ng bá»‘i cáº£nh nÃ y ráº¥t khÃ³ khÄƒn vÃ  dá»… xáº£y ra lá»—i: Rust hy vá»ng sáº½ thay Ä‘á»•i Ä‘iá»u Ä‘Ã³.</p>
<p>Ban Ä‘áº§u, nhÃ³m Rust nghÄ© ráº±ng Ä‘áº£m báº£o an toÃ n bá»™ nhá»› vÃ  ngÄƒn ngá»«a cÃ¡c váº¥n Ä‘á» Ä‘á»“ng thá»i lÃ  hai thÃ¡ch thá»©c riÃªng biá»‡t cáº§n Ä‘Æ°á»£c giáº£i quyáº¿t báº±ng cÃ¡c phÆ°Æ¡ng phÃ¡p khÃ¡c nhau. Theo thá»i gian, nhÃ³m phÃ¡t hiá»‡n ráº±ng há»‡ thá»‘ng ownership vÃ  type lÃ  má»™t táº­p há»£p cÃ´ng cá»¥ máº¡nh máº½ giÃºp quáº£n lÃ½ cáº£ váº¥n Ä‘á» an toÃ n bá»™ nhá»› <em>vÃ </em> Ä‘á»“ng thá»i! Báº±ng cÃ¡ch táº­n dá»¥ng ownership vÃ  kiá»ƒm tra kiá»ƒu, nhiá»u lá»—i Ä‘á»“ng thá»i trá»Ÿ thÃ nh lá»—i thá»i gian biÃªn dá»‹ch trong Rust thay vÃ¬ lá»—i thá»i gian cháº¡y. Do Ä‘Ã³, thay vÃ¬ báº¡n pháº£i dÃ nh nhiá»u thá»i gian Ä‘á»ƒ tÃ¡i hiá»‡n chÃ­nh xÃ¡c hoÃ n cáº£nh mÃ  lá»—i Ä‘á»“ng thá»i xáº£y ra trong thá»i gian cháº¡y, mÃ£ khÃ´ng Ä‘Ãºng sáº½ tá»« chá»‘i biÃªn dá»‹ch vÃ  Ä‘Æ°a ra thÃ´ng bÃ¡o lá»—i giáº£i thÃ­ch váº¥n Ä‘á». Káº¿t quáº£ lÃ  báº¡n cÃ³ thá»ƒ sá»­a mÃ£ trong khi Ä‘ang lÃ m viá»‡c thay vÃ¬ cÃ³ thá»ƒ sau khi nÃ³ Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai lÃªn production. ChÃºng tÃ´i Ä‘Ã£ Ä‘áº·t biá»‡t danh cho khÃ­a cáº¡nh nÃ y cá»§a Rust lÃ  <em>fearless concurrency</em> (Ä‘á»“ng thá»i khÃ´ng sá»£ hÃ£i). Äá»“ng thá»i khÃ´ng sá»£ hÃ£i cho phÃ©p báº¡n viáº¿t mÃ£ khÃ´ng cÃ³ lá»—i tinh vi vÃ  dá»… dÃ ng tÃ¡i cáº¥u trÃºc mÃ  khÃ´ng gÃ¢y ra lá»—i má»›i.</p>
<blockquote>
<p>LÆ°u Ã½: VÃ¬ Ä‘Æ¡n giáº£n, chÃºng tÃ´i sáº½ gá»i nhiá»u váº¥n Ä‘á» lÃ  <em>concurrent</em> thay vÃ¬ chÃ­nh xÃ¡c hÆ¡n báº±ng cÃ¡ch nÃ³i <em>concurrent vÃ /hoáº·c parallel</em>. Náº¿u cuá»‘n sÃ¡ch nÃ y vá» concurrency vÃ /hoáº·c parallelism, chÃºng tÃ´i sáº½ cá»¥ thá»ƒ hÆ¡n. Trong chÆ°Æ¡ng nÃ y, hÃ£y táº¡m thá»i thay tháº¿ <em>concurrent vÃ /hoáº·c parallel</em> báº¥t cá»© khi nÃ o chÃºng tÃ´i dÃ¹ng <em>concurrent</em>.</p>
</blockquote>
<p>Nhiá»u ngÃ´n ngá»¯ ráº¥t báº£o thá»§ vá» cÃ¡c giáº£i phÃ¡p mÃ  chÃºng cung cáº¥p Ä‘á»ƒ xá»­ lÃ½ cÃ¡c váº¥n Ä‘á» Ä‘á»“ng thá»i. VÃ­ dá»¥, Erlang cÃ³ chá»©c nÄƒng tinh táº¿ cho Ä‘á»“ng thá»i dá»±a trÃªn truyá»n thÃ´ng Ä‘iá»‡p nhÆ°ng chá»‰ cÃ³ nhá»¯ng cÃ¡ch mÆ¡ há»“ Ä‘á»ƒ chia sáº» tráº¡ng thÃ¡i giá»¯a cÃ¡c luá»“ng. Chá»‰ há»— trá»£ má»™t pháº§n cÃ¡c giáº£i phÃ¡p cÃ³ thá»ƒ lÃ  chiáº¿n lÆ°á»£c há»£p lÃ½ cho cÃ¡c ngÃ´n ngá»¯ cáº¥p cao, vÃ¬ ngÃ´n ngá»¯ cáº¥p cao há»©a háº¹n lá»£i Ã­ch tá»« viá»‡c tá»« bá» má»™t sá»‘ kiá»ƒm soÃ¡t Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c cÃ¡c trá»«u tÆ°á»£ng. Tuy nhiÃªn, cÃ¡c ngÃ´n ngá»¯ cáº¥p tháº¥p Ä‘Æ°á»£c ká»³ vá»ng cung cáº¥p giáº£i phÃ¡p cÃ³ hiá»‡u suáº¥t tá»‘t nháº¥t trong báº¥t ká»³ tÃ¬nh huá»‘ng nÃ o vÃ  cÃ³ Ã­t trá»«u tÆ°á»£ng hÆ¡n trÃªn pháº§n cá»©ng. Do Ä‘Ã³, Rust cung cáº¥p nhiá»u cÃ´ng cá»¥ Ä‘á»ƒ mÃ´ hÃ¬nh hÃ³a váº¥n Ä‘á» theo báº¥t ká»³ cÃ¡ch nÃ o phÃ¹ há»£p vá»›i tÃ¬nh huá»‘ng vÃ  yÃªu cáº§u cá»§a báº¡n.</p>
<p>CÃ¡c chá»§ Ä‘á» chÃºng ta sáº½ Ä‘á» cáº­p trong chÆ°Æ¡ng nÃ y:</p>
<ul>
<li>CÃ¡ch táº¡o cÃ¡c luá»“ng Ä‘á»ƒ cháº¡y nhiá»u Ä‘oáº¡n mÃ£ cÃ¹ng má»™t lÃºc</li>
<li>Äá»“ng thá»i dá»±a trÃªn <em>truyá»n thÃ´ng Ä‘iá»‡p</em> (message-passing concurrency), nÆ¡i cÃ¡c channel gá»­i thÃ´ng Ä‘iá»‡p giá»¯a cÃ¡c luá»“ng</li>
<li>Äá»“ng thá»i dá»±a trÃªn <em>tráº¡ng thÃ¡i chia sáº»</em> (shared-state concurrency), nÆ¡i nhiá»u luá»“ng cÃ³ quyá»n truy cáº­p vÃ o má»™t máº£nh dá»¯ liá»‡u</li>
<li>CÃ¡c trait <code>Sync</code> vÃ  <code>Send</code>, má»Ÿ rá»™ng Ä‘áº£m báº£o Ä‘á»“ng thá»i cá»§a Rust cho cÃ¡c kiá»ƒu do ngÆ°á»i dÃ¹ng Ä‘á»‹nh nghÄ©a cÅ©ng nhÆ° cÃ¡c kiá»ƒu do thÆ° viá»‡n chuáº©n cung cáº¥p</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="sá»­-dá»¥ng-luá»“ng-Ä‘á»ƒ-cháº¡y-mÃ£-Äá»“ng-thá»i"><a class="header" href="#sá»­-dá»¥ng-luá»“ng-Ä‘á»ƒ-cháº¡y-mÃ£-Äá»“ng-thá»i">Sá»­ Dá»¥ng Luá»“ng Ä‘á»ƒ Cháº¡y MÃ£ Äá»“ng Thá»i</a></h2>
<p>Trong háº§u háº¿t cÃ¡c há»‡ Ä‘iá»u hÃ nh hiá»‡n nay, mÃ£ cá»§a má»™t chÆ°Æ¡ng trÃ¬nh khi thá»±c thi Ä‘Æ°á»£c cháº¡y trong má»™t <em>process</em>, vÃ  há»‡ Ä‘iá»u hÃ nh sáº½ quáº£n lÃ½ nhiá»u process cÃ¹ng lÃºc. Trong má»™t chÆ°Æ¡ng trÃ¬nh, báº¡n cÅ©ng cÃ³ thá»ƒ cÃ³ cÃ¡c pháº§n Ä‘á»™c láº­p cháº¡y Ä‘á»“ng thá»i. CÃ¡c tÃ­nh nÄƒng cháº¡y cÃ¡c pháº§n Ä‘á»™c láº­p nÃ y Ä‘Æ°á»£c gá»i lÃ  <em>threads</em> (luá»“ng). VÃ­ dá»¥, má»™t web server cÃ³ thá»ƒ cÃ³ nhiá»u luá»“ng Ä‘á»ƒ cÃ³ thá»ƒ pháº£n há»“i nhiá»u yÃªu cáº§u cÃ¹ng má»™t lÃºc.</p>
<p>Chia viá»‡c tÃ­nh toÃ¡n trong chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n thÃ nh nhiá»u luá»“ng Ä‘á»ƒ cháº¡y nhiá»u tÃ¡c vá»¥ cÃ¹ng má»™t lÃºc cÃ³ thá»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t, nhÆ°ng cÅ©ng lÃ m tÄƒng Ä‘á»™ phá»©c táº¡p. VÃ¬ cÃ¡c luá»“ng cÃ³ thá»ƒ cháº¡y Ä‘á»“ng thá»i, khÃ´ng cÃ³ Ä‘áº£m báº£o nÃ o vá» thá»© tá»± mÃ  cÃ¡c pháº§n mÃ£ trÃªn cÃ¡c luá»“ng khÃ¡c nhau sáº½ cháº¡y. Äiá»u nÃ y cÃ³ thá»ƒ dáº«n Ä‘áº¿n cÃ¡c váº¥n Ä‘á» nhÆ°:</p>
<ul>
<li>Race conditions, nÆ¡i cÃ¡c luá»“ng truy cáº­p dá»¯ liá»‡u hoáº·c tÃ i nguyÃªn theo thá»© tá»± khÃ´ng nháº¥t quÃ¡n</li>
<li>Deadlocks, nÆ¡i hai luá»“ng chá» láº«n nhau, khiáº¿n cáº£ hai luá»“ng khÃ´ng thá»ƒ tiáº¿p tá»¥c</li>
<li>Lá»—i chá»‰ xáº£y ra trong má»™t sá»‘ tÃ¬nh huá»‘ng nháº¥t Ä‘á»‹nh vÃ  khÃ³ tÃ¡i táº¡o cÅ©ng nhÆ° sá»­a chá»¯a má»™t cÃ¡ch Ä‘Ã¡ng tin cáº­y</li>
</ul>
<p>Rust cá»‘ gáº¯ng giáº£m thiá»ƒu cÃ¡c tÃ¡c Ä‘á»™ng tiÃªu cá»±c khi sá»­ dá»¥ng luá»“ng, nhÆ°ng láº­p trÃ¬nh trong bá»‘i cáº£nh Ä‘a luá»“ng váº«n Ä‘Ã²i há»i suy nghÄ© cáº©n tháº­n vÃ  yÃªu cáº§u cáº¥u trÃºc mÃ£ khÃ¡c vá»›i cÃ¡c chÆ°Æ¡ng trÃ¬nh cháº¡y trong má»™t luá»“ng Ä‘Æ¡n.</p>
<p>CÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh triá»ƒn khai luá»“ng theo má»™t vÃ i cÃ¡ch khÃ¡c nhau, vÃ  nhiá»u há»‡ Ä‘iá»u hÃ nh cung cáº¥p má»™t API mÃ  ngÃ´n ngá»¯ cÃ³ thá»ƒ gá»i Ä‘á»ƒ táº¡o luá»“ng má»›i. ThÆ° viá»‡n chuáº©n cá»§a Rust sá»­ dá»¥ng mÃ´ hÃ¬nh <em>1:1</em> trong viá»‡c triá»ƒn khai luá»“ng, theo Ä‘Ã³ má»™t chÆ°Æ¡ng trÃ¬nh sá»­ dá»¥ng má»™t luá»“ng há»‡ Ä‘iá»u hÃ nh cho má»—i luá»“ng trong ngÃ´n ngá»¯. CÃ³ cÃ¡c crate triá»ƒn khai cÃ¡c mÃ´ hÃ¬nh luá»“ng khÃ¡c, Ä‘Æ°a ra cÃ¡c Ä‘Ã¡nh Ä‘á»•i khÃ¡c so vá»›i mÃ´ hÃ¬nh 1:1.</p>
<h3 id="táº¡o-luá»“ng-má»›i-vá»›i-spawn"><a class="header" href="#táº¡o-luá»“ng-má»›i-vá»›i-spawn">Táº¡o Luá»“ng Má»›i vá»›i <code>spawn</code></a></h3>
<p>Äá»ƒ táº¡o má»™t luá»“ng má»›i, chÃºng ta gá»i hÃ m <code>thread::spawn</code>
vÃ  truyá»n vÃ o má»™t closure (chÃºng ta Ä‘Ã£ nÃ³i vá» closures trong ChÆ°Æ¡ng 13)
chá»©a mÃ£ mÃ  chÃºng ta muá»‘n cháº¡y trong luá»“ng má»›i.
VÃ­ dá»¥ trong Listing 16-1 in ra má»™t sá»‘ vÄƒn báº£n tá»« luá»“ng chÃ­nh vÃ  vÄƒn báº£n khÃ¡c tá»« má»™t luá»“ng má»›i:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::thread;
use std::time::Duration;

fn main() {
    thread::spawn(|| {
        for i in 1..10 {
            println!("hi number {i} from the spawned thread!");
            thread::sleep(Duration::from_millis(1));
        }
    });

    for i in 1..5 {
        println!("hi number {i} from the main thread!");
        thread::sleep(Duration::from_millis(1));
    }
}</code></pre></pre>
<p><span class="caption">Listing 16-1: Táº¡o má»™t luá»“ng má»›i Ä‘á»ƒ in má»™t thá»© trong khi luá»“ng chÃ­nh in thá»© khÃ¡c</span></p>
<p>LÆ°u Ã½ ráº±ng khi luá»“ng chÃ­nh cá»§a má»™t chÆ°Æ¡ng trÃ¬nh Rust hoÃ n táº¥t, táº¥t cáº£ cÃ¡c luá»“ng Ä‘Æ°á»£c sinh ra sáº½ bá»‹ Ä‘Ã³ng, báº¥t ká»ƒ chÃºng Ä‘Ã£ cháº¡y xong hay chÆ°a. Äáº§u ra tá»« chÆ°Æ¡ng trÃ¬nh nÃ y cÃ³ thá»ƒ hÆ¡i khÃ¡c nhau má»—i láº§n cháº¡y, nhÆ°ng sáº½ trÃ´ng tÆ°Æ¡ng tá»± nhÆ° sau:</p>
<!-- KhÃ´ng trÃ­ch xuáº¥t Ä‘áº§u ra vÃ¬ cÃ¡c thay Ä‘á»•i trong Ä‘áº§u ra nÃ y khÃ´ng quan trá»ng; cÃ¡c thay Ä‘á»•i cÃ³ kháº£ nÄƒng do cÃ¡c luá»“ng cháº¡y khÃ¡c nhau chá»© khÃ´ng pháº£i do thay Ä‘á»•i trong trÃ¬nh biÃªn dá»‹ch -->
<pre><code class="language-text">hi number 1 from the main thread!
hi number 1 from the spawned thread!
hi number 2 from the main thread!
hi number 2 from the spawned thread!
hi number 3 from the main thread!
hi number 3 from the spawned thread!
hi number 4 from the main thread!
hi number 4 from the spawned thread!
hi number 5 from the spawned thread!
</code></pre>
<p>CÃ¡c láº§n gá»i <code>thread::sleep</code> buá»™c má»™t luá»“ng pháº£i táº¡m dá»«ng thá»±c thi trong má»™t khoáº£ng thá»i gian ngáº¯n, cho phÃ©p luá»“ng khÃ¡c cháº¡y. CÃ¡c luá»“ng cÃ³ thá»ƒ sáº½ cháº¡y láº§n lÆ°á»£t, nhÆ°ng Ä‘iá»u Ä‘Ã³ khÃ´ng Ä‘Æ°á»£c Ä‘áº£m báº£o: nÃ³ phá»¥ thuá»™c vÃ o cÃ¡ch há»‡ Ä‘iá»u hÃ nh cá»§a báº¡n láº­p lá»‹ch cÃ¡c luá»“ng. Trong láº§n cháº¡y nÃ y, luá»“ng chÃ­nh in ra trÆ°á»›c, máº·c dÃ¹ cÃ¢u lá»‡nh in tá»« luá»“ng Ä‘Æ°á»£c sinh ra xuáº¥t hiá»‡n trÆ°á»›c trong mÃ£. VÃ  máº·c dÃ¹ chÃºng ta báº£o luá»“ng Ä‘Æ°á»£c sinh ra in cho Ä‘áº¿n khi <code>i</code> lÃ  9, nÃ³ chá»‰ in Ä‘Æ°á»£c Ä‘áº¿n 5 trÆ°á»›c khi luá»“ng chÃ­nh káº¿t thÃºc.</p>
<p>Náº¿u báº¡n cháº¡y mÃ£ nÃ y vÃ  chá»‰ tháº¥y Ä‘áº§u ra tá»« luá»“ng chÃ­nh, hoáº·c khÃ´ng tháº¥y sá»± chá»“ng láº¥n nÃ o, hÃ£y thá»­ tÄƒng cÃ¡c con sá»‘ trong cÃ¡c pháº¡m vi Ä‘á»ƒ táº¡o thÃªm cÆ¡ há»™i cho há»‡ Ä‘iá»u hÃ nh chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c luá»“ng.</p>
<h3 id="chá»-táº¥t-cáº£-cÃ¡c-luá»“ng-hoÃ n-thÃ nh-báº±ng-cÃ¡ch-sá»­-dá»¥ng-join-handles"><a class="header" href="#chá»-táº¥t-cáº£-cÃ¡c-luá»“ng-hoÃ n-thÃ nh-báº±ng-cÃ¡ch-sá»­-dá»¥ng-join-handles">Chá» táº¥t cáº£ cÃ¡c luá»“ng hoÃ n thÃ nh báº±ng cÃ¡ch sá»­ dá»¥ng <code>Join</code> Handles</a></h3>
<p>MÃ£ trong Listing 16-1 khÃ´ng chá»‰ dá»«ng luá»“ng Ä‘Æ°á»£c sinh ra sá»›m hÆ¡n háº§u háº¿t thá»i gian do luá»“ng chÃ­nh káº¿t thÃºc, mÃ  vÃ¬ khÃ´ng cÃ³ Ä‘áº£m báº£o vá» thá»© tá»± cÃ¡c luá»“ng cháº¡y, chÃºng ta cÅ©ng khÃ´ng thá»ƒ Ä‘áº£m báº£o ráº±ng luá»“ng Ä‘Æ°á»£c sinh ra sáº½ cháº¡y Ä‘Æ°á»£c chÃºt nÃ o!</p>
<p>ChÃºng ta cÃ³ thá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» luá»“ng Ä‘Æ°á»£c sinh ra khÃ´ng cháº¡y hoáº·c káº¿t thÃºc sá»›m báº±ng cÃ¡ch lÆ°u giÃ¡ trá»‹ tráº£ vá» cá»§a <code>thread::spawn</code> vÃ o má»™t biáº¿n. Kiá»ƒu tráº£ vá» cá»§a <code>thread::spawn</code> lÃ  <code>JoinHandle</code>. Má»™t <code>JoinHandle</code> lÃ  má»™t giÃ¡ trá»‹ sá»Ÿ há»¯u mÃ  khi chÃºng ta gá»i phÆ°Æ¡ng thá»©c <code>join</code> trÃªn nÃ³, sáº½ chá» cho luá»“ng cá»§a nÃ³ hoÃ n thÃ nh. Listing 16-2 minh há»a cÃ¡ch sá»­ dá»¥ng <code>JoinHandle</code> cá»§a luá»“ng chÃºng ta táº¡o trong Listing 16-1 vÃ  gá»i <code>join</code> Ä‘á»ƒ Ä‘áº£m báº£o luá»“ng Ä‘Æ°á»£c sinh ra káº¿t thÃºc trÆ°á»›c khi <code>main</code> thoÃ¡t:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::thread;
use std::time::Duration;

fn main() {
    let handle = thread::spawn(|| {
        for i in 1..10 {
            println!("hi number {i} from the spawned thread!");
            thread::sleep(Duration::from_millis(1));
        }
    });

    for i in 1..5 {
        println!("hi number {i} from the main thread!");
        thread::sleep(Duration::from_millis(1));
    }

    handle.join().unwrap();
}</code></pre></pre>
<p><span class="caption">Listing 16-2: LÆ°u <code>JoinHandle</code> tá»« <code>thread::spawn</code>
Ä‘á»ƒ Ä‘áº£m báº£o luá»“ng Ä‘Æ°á»£c cháº¡y Ä‘áº¿n khi hoÃ n thÃ nh</span></p>
<p>Gá»i <code>join</code> trÃªn handle sáº½ cháº·n luá»“ng Ä‘ang cháº¡y cho Ä‘áº¿n khi luá»“ng Ä‘Æ°á»£c handle Ä‘áº¡i diá»‡n káº¿t thÃºc. <em>Cháº·n</em> má»™t luá»“ng cÃ³ nghÄ©a lÃ  luá»“ng Ä‘Ã³ bá»‹ ngÄƒn khÃ´ng thá»±c hiá»‡n cÃ´ng viá»‡c hoáº·c thoÃ¡t. VÃ¬ chÃºng ta Ä‘áº·t lá»i gá»i <code>join</code> sau vÃ²ng láº·p <code>for</code> cá»§a luá»“ng chÃ­nh, cháº¡y Listing 16-2 sáº½ táº¡o ra Ä‘áº§u ra tÆ°Æ¡ng tá»± nhÆ° sau:</p>
<!-- KhÃ´ng trÃ­ch xuáº¥t Ä‘áº§u ra vÃ¬ cÃ¡c thay Ä‘á»•i Ä‘á»‘i vá»›i Ä‘áº§u ra nÃ y khÃ´ng quan trá»ng;
cÃ¡c thay Ä‘á»•i cÃ³ kháº£ nÄƒng do cÃ¡c luá»“ng cháº¡y khÃ¡c nhau thay vÃ¬ do thay Ä‘á»•i trong trÃ¬nh biÃªn dá»‹ch -->
<pre><code class="language-text">hi number 1 from the main thread!
hi number 2 from the main thread!
hi number 1 from the spawned thread!
hi number 3 from the main thread!
hi number 2 from the spawned thread!
hi number 4 from the main thread!
hi number 3 from the spawned thread!
hi number 4 from the spawned thread!
hi number 5 from the spawned thread!
hi number 6 from the spawned thread!
hi number 7 from the spawned thread!
hi number 8 from the spawned thread!
hi number 9 from the spawned thread!
</code></pre>
<p>Hai luá»“ng tiáº¿p tá»¥c xen káº½, nhÆ°ng luá»“ng chÃ­nh sáº½ chá» vÃ¬ lá»i gá»i <code>handle.join()</code> vÃ  khÃ´ng káº¿t thÃºc cho Ä‘áº¿n khi luá»“ng Ä‘Æ°á»£c spawn hoÃ n táº¥t.</p>
<p>NhÆ°ng hÃ£y xem Ä‘iá»u gÃ¬ xáº£y ra náº¿u chÃºng ta chuyá»ƒn <code>handle.join()</code> lÃªn trÆ°á»›c vÃ²ng láº·p <code>for</code> trong <code>main</code>, nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::thread;
use std::time::Duration;

fn main() {
    let handle = thread::spawn(|| {
        for i in 1..10 {
            println!("hi number {i} from the spawned thread!");
            thread::sleep(Duration::from_millis(1));
        }
    });

    handle.join().unwrap();

    for i in 1..5 {
        println!("hi number {i} from the main thread!");
        thread::sleep(Duration::from_millis(1));
    }
}</code></pre></pre>
<p>Luá»“ng chÃ­nh sáº½ chá» cho luá»“ng Ä‘Æ°á»£c spawn hoÃ n táº¥t, sau Ä‘Ã³ má»›i cháº¡y vÃ²ng láº·p <code>for</code> cá»§a nÃ³, vÃ¬ váº­y káº¿t quáº£ sáº½ khÃ´ng cÃ²n xen káº½ ná»¯a, nhÆ° minh há»a dÆ°á»›i Ä‘Ã¢y:</p>
<!-- KhÃ´ng trÃ­ch xuáº¥t output vÃ¬ cÃ¡c thay Ä‘á»•i cá»§a output nÃ y khÃ´ng quan trá»ng;
cÃ¡c thay Ä‘á»•i cÃ³ thá»ƒ do cÃ¡c luá»“ng cháº¡y khÃ¡c nhau hÆ¡n lÃ  do thay Ä‘á»•i trong compiler -->
<pre><code class="language-text">hi number 1 from the spawned thread!
hi number 2 from the spawned thread!
hi number 3 from the spawned thread!
hi number 4 from the spawned thread!
hi number 5 from the spawned thread!
hi number 6 from the spawned thread!
hi number 7 from the spawned thread!
hi number 8 from the spawned thread!
hi number 9 from the spawned thread!
hi number 1 from the main thread!
hi number 2 from the main thread!
hi number 3 from the main thread!
hi number 4 from the main thread!
</code></pre>
<p>Nhá»¯ng chi tiáº¿t nhá», cháº³ng háº¡n nhÆ° nÆ¡i gá»i <code>join</code>, cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng Ä‘áº¿n viá»‡c cÃ¡c luá»“ng cá»§a báº¡n cÃ³ cháº¡y cÃ¹ng lÃºc hay khÃ´ng.</p>
<h3 id="sá»­-dá»¥ng-closure-vá»›i-move-trong-threads"><a class="header" href="#sá»­-dá»¥ng-closure-vá»›i-move-trong-threads">Sá»­ dá»¥ng Closure vá»›i <code>move</code> trong Threads</a></h3>
<p>ChÃºng ta thÆ°á»ng sá»­ dá»¥ng tá»« khÃ³a <code>move</code> vá»›i cÃ¡c closure Ä‘Æ°á»£c truyá»n vÃ o <code>thread::spawn</code> vÃ¬ khi Ä‘Ã³ closure sáº½ nháº­n quyá»n sá»Ÿ há»¯u cÃ¡c giÃ¡ trá»‹ mÃ  nÃ³ sá»­ dá»¥ng tá»« mÃ´i trÆ°á»ng, do Ä‘Ã³ chuyá»ƒn quyá»n sá»Ÿ há»¯u cÃ¡c giÃ¡ trá»‹ Ä‘Ã³ tá»« má»™t luá»“ng sang luá»“ng khÃ¡c. Trong pháº§n <a href="ch13-01-closures.html#capturing-references-or-moving-ownership">â€œCapturing References or Moving Ownershipâ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 13, chÃºng ta Ä‘Ã£ tháº£o luáº­n vá» <code>move</code> trong bá»‘i cáº£nh cá»§a closures. BÃ¢y giá», chÃºng ta sáº½ táº­p trung hÆ¡n vÃ o sá»± tÆ°Æ¡ng tÃ¡c giá»¯a <code>move</code> vÃ  <code>thread::spawn</code>.</p>
<p>ChÃº Ã½ trong Listing 16-1 ráº±ng closure mÃ  chÃºng ta truyá»n vÃ o <code>thread::spawn</code> khÃ´ng nháº­n tham sá»‘ nÃ o: chÃºng ta khÃ´ng sá»­ dá»¥ng báº¥t ká»³ dá»¯ liá»‡u nÃ o tá»« luá»“ng chÃ­nh trong code cá»§a luá»“ng Ä‘Æ°á»£c spawn. Äá»ƒ sá»­ dá»¥ng dá»¯ liá»‡u tá»« luá»“ng chÃ­nh trong luá»“ng Ä‘Æ°á»£c spawn, closure cá»§a luá»“ng Ä‘Æ°á»£c spawn pháº£i capture cÃ¡c giÃ¡ trá»‹ mÃ  nÃ³ cáº§n. Listing 16-3 cho tháº¥y má»™t cá»‘ gáº¯ng táº¡o má»™t vector trong luá»“ng chÃ­nh vÃ  sá»­ dá»¥ng nÃ³ trong luá»“ng Ä‘Æ°á»£c spawn. Tuy nhiÃªn, Ä‘iá»u nÃ y chÆ°a hoáº¡t Ä‘á»™ng, nhÆ° báº¡n sáº½ tháº¥y ngay sau Ä‘Ã¢y.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">use std::thread;

fn main() {
    let v = vec![1, 2, 3];

    let handle = thread::spawn(|| {
        println!("Here's a vector: {v:?}");
    });

    handle.join().unwrap();
}</code></pre>
<p><span class="caption">Listing 16-3: Cá»‘ gáº¯ng sá»­ dá»¥ng má»™t vector Ä‘Æ°á»£c táº¡o bá»Ÿi luá»“ng chÃ­nh trong má»™t luá»“ng khÃ¡c</span></p>
<p>Closure sá»­ dá»¥ng <code>v</code>, do Ä‘Ã³ nÃ³ sáº½ capture <code>v</code> vÃ  lÃ m nÃ³ trá»Ÿ thÃ nh má»™t pháº§n cá»§a mÃ´i trÆ°á»ng cá»§a closure. VÃ¬ <code>thread::spawn</code> cháº¡y closure nÃ y trong má»™t luá»“ng má»›i, chÃºng ta sáº½ mong muá»‘n cÃ³ thá»ƒ truy cáº­p <code>v</code> bÃªn trong luá»“ng má»›i Ä‘Ã³. NhÆ°ng khi biÃªn dá»‹ch vÃ­ dá»¥ nÃ y, chÃºng ta nháº­n Ä‘Æ°á»£c lá»—i sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling threads v0.1.0 (file:///projects/threads)
error[E0373]: closure may outlive the current function, but it borrows `v`, which is owned by the current function
 --&gt; src/main.rs:6:32
  |
6 |     let handle = thread::spawn(|| {
  |                                ^^ may outlive borrowed value `v`
7 |         println!("Here's a vector: {v:?}");
  |                                     - `v` is borrowed here
  |
note: function requires argument type to outlive `'static`
 --&gt; src/main.rs:6:18
  |
6 |       let handle = thread::spawn(|| {
  |  __________________^
7 | |         println!("Here's a vector: {v:?}");
8 | |     });
  | |______^
help: to force the closure to take ownership of `v` (and any other referenced variables), use the `move` keyword
  |
6 |     let handle = thread::spawn(move || {
  |                                ++++

For more information about this error, try `rustc --explain E0373`.
error: could not compile `threads` (bin "threads") due to 1 previous error
</code></pre>
<p>Rust <em>suy diá»…n</em> cÃ¡ch capture <code>v</code>, vÃ  vÃ¬ <code>println!</code> chá»‰ cáº§n má»™t tham chiáº¿u Ä‘áº¿n <code>v</code>, closure cá»‘ gáº¯ng mÆ°á»£n <code>v</code>. Tuy nhiÃªn, cÃ³ má»™t váº¥n Ä‘á»: Rust khÃ´ng thá»ƒ biáº¿t luá»“ng Ä‘Æ°á»£c spawn sáº½ cháº¡y trong bao lÃ¢u, nÃªn nÃ³ khÃ´ng biáº¿t liá»‡u tham chiáº¿u Ä‘áº¿n <code>v</code> cÃ³ luÃ´n há»£p lá»‡ hay khÃ´ng.</p>
<p>Listing 16-4 Ä‘Æ°a ra má»™t ká»‹ch báº£n cÃ³ kháº£ nÄƒng cao hÆ¡n lÃ  tham chiáº¿u Ä‘áº¿n <code>v</code> sáº½ khÃ´ng há»£p lá»‡:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">use std::thread;

fn main() {
    let v = vec![1, 2, 3];

    let handle = thread::spawn(|| {
        println!("Here's a vector: {v:?}");
    });

    drop(v); // oh no!

    handle.join().unwrap();
}</code></pre>
<p><span class="caption">Listing 16-4: Má»™t luá»“ng vá»›i closure cá»‘ gáº¯ng capture tham chiáº¿u Ä‘áº¿n <code>v</code> tá»« luá»“ng chÃ­nh, nÆ¡i <code>v</code> Ä‘Ã£ bá»‹ drop</span></p>
<p>Náº¿u Rust cho phÃ©p chÃºng ta cháº¡y Ä‘oáº¡n mÃ£ nÃ y, cÃ³ kháº£ nÄƒng luá»“ng Ä‘Æ°á»£c spawn sáº½ ngay láº­p tá»©c bá»‹ Ä‘áº·t vÃ o ná»n mÃ  khÃ´ng cháº¡y gÃ¬ cáº£. Luá»“ng Ä‘Æ°á»£c spawn cÃ³ má»™t tham chiáº¿u Ä‘áº¿n <code>v</code> bÃªn trong, nhÆ°ng luá»“ng chÃ­nh ngay láº­p tá»©c drop <code>v</code>, sá»­ dá»¥ng hÃ m <code>drop</code> mÃ  chÃºng ta Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 15. Sau Ä‘Ã³, khi luá»“ng Ä‘Æ°á»£c spawn báº¯t Ä‘áº§u thá»±c thi, <code>v</code> khÃ´ng cÃ²n há»£p lá»‡ ná»¯a, nÃªn tham chiáº¿u Ä‘áº¿n nÃ³ cÅ©ng khÃ´ng há»£p lá»‡. Ã”i khÃ´ng!</p>
<p>Äá»ƒ sá»­a lá»—i compiler trong Listing 16-3, chÃºng ta cÃ³ thá»ƒ dÃ¹ng lá»i khuyÃªn tá»« thÃ´ng bÃ¡o lá»—i:</p>
<!-- manual-regeneration
after automatic regeneration, look at listings/ch16-fearless-concurrency/listing-16-03/output.txt and copy the relevant part
-->
<pre><code class="language-text">help: to force the closure to take ownership of `v` (and any other referenced variables), use the `move` keyword
  |
6 |     let handle = thread::spawn(move || {
  |                                ++++
</code></pre>
<p>Báº±ng cÃ¡ch thÃªm tá»« khÃ³a <code>move</code> trÆ°á»›c closure, chÃºng ta buá»™c closure nháº­n quyá»n sá»Ÿ há»¯u cá»§a cÃ¡c giÃ¡ trá»‹ mÃ  nÃ³ sá»­ dá»¥ng thay vÃ¬ Ä‘á»ƒ Rust suy Ä‘oÃ¡n ráº±ng nÃ³ nÃªn mÆ°á»£n cÃ¡c giÃ¡ trá»‹ Ä‘Ã³. Sá»± chá»‰nh sá»­a Ä‘á»‘i vá»›i Listing 16-3 Ä‘Æ°á»£c thá»ƒ hiá»‡n trong Listing 16-5 sáº½ biÃªn dá»‹ch vÃ  cháº¡y nhÆ° chÃºng ta mong muá»‘n:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::thread;

fn main() {
    let v = vec![1, 2, 3];

    let handle = thread::spawn(move || {
        println!("Here's a vector: {v:?}");
    });

    handle.join().unwrap();
}</code></pre></pre>
<p>ChÃºng ta cÃ³ thá»ƒ bá»‹ cÃ¡m dá»— Ä‘á»ƒ thá»­ lÃ m Ä‘iá»u tÆ°Æ¡ng tá»± Ä‘á»ƒ sá»­a mÃ£ trong Listing 16-4,
nÆ¡i luá»“ng chÃ­nh gá»i <code>drop</code>, báº±ng cÃ¡ch sá»­ dá»¥ng má»™t closure <code>move</code>.
Tuy nhiÃªn, cÃ¡ch sá»­a nÃ y sáº½ khÃ´ng hoáº¡t Ä‘á»™ng vÃ¬ nhá»¯ng gÃ¬ Listing 16-4
Ä‘ang cá»‘ gáº¯ng lÃ m bá»‹ cáº¥m vÃ¬ má»™t lÃ½ do khÃ¡c. Náº¿u chÃºng ta thÃªm <code>move</code> vÃ o closure,
chÃºng ta sáº½ chuyá»ƒn <code>v</code> vÃ o mÃ´i trÆ°á»ng cá»§a closure, vÃ  sáº½ khÃ´ng thá»ƒ gá»i <code>drop</code>
trÃªn nÃ³ trong luá»“ng chÃ­nh ná»¯a. Thay vÃ o Ä‘Ã³, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i biÃªn dá»‹ch nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling threads v0.1.0 (file:///projects/threads)
error[E0382]: use of moved value: `v`
  --&gt; src/main.rs:10:10
   |
4  |     let v = vec![1, 2, 3];
   |         - move occurs because `v` has type `Vec&lt;i32&gt;`, which does not implement the `Copy` trait
5  |
6  |     let handle = thread::spawn(move || {
   |                                ------- value moved into closure here
7  |         println!("Here's a vector: {v:?}");
   |                                     - variable moved due to use in closure
...
10 |     drop(v); // oh no!
   |          ^ value used here after move

For more information about this error, try `rustc --explain E0382`.
error: could not compile `threads` (bin "threads") due to 1 previous error
</code></pre>
<p>CÃ¡c quy táº¯c sá»Ÿ há»¯u cá»§a Rust láº¡i cá»©u chÃºng ta má»™t láº§n ná»¯a! ChÃºng ta nháº­n Ä‘Æ°á»£c lá»—i tá»« mÃ£ trong Listing 16-3 vÃ¬ Rust tháº­n trá»ng vÃ  chá»‰ mÆ°á»£n <code>v</code> cho luá»“ng, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  luá»“ng chÃ­nh vá» lÃ½ thuyáº¿t cÃ³ thá»ƒ lÃ m cho tham chiáº¿u trong luá»“ng spawn trá»Ÿ nÃªn khÃ´ng há»£p lá»‡. Báº±ng cÃ¡ch báº£o Rust chuyá»ƒn quyá»n sá»Ÿ há»¯u <code>v</code> sang luá»“ng spawn, chÃºng ta Ä‘áº£m báº£o vá»›i Rust ráº±ng luá»“ng chÃ­nh sáº½ khÃ´ng sá»­ dá»¥ng <code>v</code> ná»¯a. Náº¿u chÃºng ta thay Ä‘á»•i Listing 16-4 theo cÃ¡ch tÆ°Æ¡ng tá»±, chÃºng ta sáº½ vi pháº¡m quy táº¯c sá»Ÿ há»¯u khi cá»‘ gáº¯ng sá»­ dá»¥ng <code>v</code> trong luá»“ng chÃ­nh. Tá»« khÃ³a <code>move</code> ghi Ä‘Ã¨ máº·c Ä‘á»‹nh tháº­n trá»ng cá»§a Rust lÃ  mÆ°á»£n; nÃ³ khÃ´ng cho phÃ©p chÃºng ta vi pháº¡m cÃ¡c quy táº¯c sá»Ÿ há»¯u.</p>
<p>Vá»›i hiá»ƒu biáº¿t cÆ¡ báº£n vá» luá»“ng vÃ  API cá»§a luá»“ng, hÃ£y xem chÃºng ta cÃ³ thá»ƒ <em>lÃ m gÃ¬</em> vá»›i cÃ¡c luá»“ng.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="sá»­-dá»¥ng-message-passing-Ä‘á»ƒ-chuyá»ƒn-dá»¯-liá»‡u-giá»¯a-cÃ¡c-luá»“ng"><a class="header" href="#sá»­-dá»¥ng-message-passing-Ä‘á»ƒ-chuyá»ƒn-dá»¯-liá»‡u-giá»¯a-cÃ¡c-luá»“ng">Sá»­ dá»¥ng Message Passing Ä‘á»ƒ Chuyá»ƒn Dá»¯ liá»‡u Giá»¯a CÃ¡c Luá»“ng</a></h2>
<p>Má»™t phÆ°Æ¡ng phÃ¡p ngÃ y cÃ ng phá»• biáº¿n Ä‘á»ƒ Ä‘áº£m báº£o concurrency an toÃ n lÃ  <em>message passing</em>, nÆ¡i cÃ¡c luá»“ng hoáº·c actor giao tiáº¿p báº±ng cÃ¡ch gá»­i cho nhau cÃ¡c thÃ´ng Ä‘iá»‡p chá»©a dá»¯ liá»‡u. Ã tÆ°á»Ÿng nÃ y Ä‘Æ°á»£c tÃ³m táº¯t trong má»™t cÃ¢u slogan tá»« <a href="https://golang.org/doc/effective_go.html#concurrency">tÃ i liá»‡u ngÃ´n ngá»¯ Go</a>:
â€œÄá»«ng giao tiáº¿p báº±ng cÃ¡ch chia sáº» bá»™ nhá»›; thay vÃ o Ä‘Ã³, hÃ£y chia sáº» bá»™ nhá»› báº±ng cÃ¡ch giao tiáº¿p.â€</p>
<p>Äá»ƒ thá»±c hiá»‡n concurrency dá»±a trÃªn gá»­i thÃ´ng Ä‘iá»‡p, thÆ° viá»‡n chuáº©n cá»§a Rust cung cáº¥p má»™t triá»ƒn khai cá»§a <em>channels</em>. Má»™t channel lÃ  má»™t khÃ¡i niá»‡m láº­p trÃ¬nh tá»•ng quÃ¡t, theo Ä‘Ã³ dá»¯ liá»‡u Ä‘Æ°á»£c gá»­i tá»« má»™t luá»“ng sang luá»“ng khÃ¡c.</p>
<p>Báº¡n cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng má»™t channel trong láº­p trÃ¬nh giá»‘ng nhÆ° má»™t dÃ²ng nÆ°á»›c cÃ³ hÆ°á»›ng, cháº³ng háº¡n nhÆ° má»™t con suá»‘i hoáº·c má»™t dÃ²ng sÃ´ng. Náº¿u báº¡n Ä‘áº·t má»™t thá»© gÃ¬ Ä‘Ã³ nhÆ° má»™t con vá»‹t cao su vÃ o sÃ´ng, nÃ³ sáº½ trÃ´i xuÃ´i dÃ²ng Ä‘áº¿n cuá»‘i con Ä‘Æ°á»ng nÆ°á»›c.</p>
<p>Má»™t channel cÃ³ hai ná»­a: ná»­a truyá»n vÃ  ná»­a nháº­n. Ná»­a truyá»n lÃ  vá»‹ trÃ­ thÆ°á»£ng lÆ°u nÆ¡i báº¡n Ä‘áº·t cÃ¡c con vá»‹t cao su vÃ o sÃ´ng, vÃ  ná»­a nháº­n lÃ  nÆ¡i con vá»‹t cao su sáº½ Ä‘áº¿n háº¡ lÆ°u. Má»™t pháº§n mÃ£ cá»§a báº¡n gá»i cÃ¡c phÆ°Æ¡ng thá»©c trÃªn ná»­a truyá»n vá»›i dá»¯ liá»‡u báº¡n muá»‘n gá»­i, vÃ  pháº§n khÃ¡c kiá»ƒm tra Ä‘áº§u nháº­n Ä‘á»ƒ nháº­n cÃ¡c thÃ´ng Ä‘iá»‡p Ä‘áº¿n. Má»™t channel Ä‘Æ°á»£c coi lÃ  <em>Ä‘Ã³ng</em> náº¿u má»™t trong hai ná»­a truyá»n hoáº·c nháº­n bá»‹ tháº£.</p>
<p>á» Ä‘Ã¢y, chÃºng ta sáº½ phÃ¡t triá»ƒn má»™t chÆ°Æ¡ng trÃ¬nh cÃ³ má»™t luá»“ng táº¡o giÃ¡ trá»‹ vÃ  gá»­i chÃºng xuá»‘ng má»™t channel, vÃ  má»™t luá»“ng khÃ¡c sáº½ nháº­n cÃ¡c giÃ¡ trá»‹ Ä‘Ã³ vÃ  in ra. ChÃºng ta sáº½ gá»­i cÃ¡c giÃ¡ trá»‹ Ä‘Æ¡n giáº£n giá»¯a cÃ¡c luá»“ng sá»­ dá»¥ng channel Ä‘á»ƒ minh há»a tÃ­nh nÄƒng. Khi báº¡n Ä‘Ã£ quen vá»›i ká»¹ thuáº­t nÃ y, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng channels cho báº¥t ká»³ luá»“ng nÃ o cáº§n giao tiáº¿p vá»›i nhau, cháº³ng háº¡n nhÆ° há»‡ thá»‘ng chat hoáº·c má»™t há»‡ thá»‘ng nÆ¡i nhiá»u luá»“ng thá»±c hiá»‡n cÃ¡c pháº§n cá»§a phÃ©p tÃ­nh vÃ  gá»­i cÃ¡c pháº§n Ä‘Ã³ Ä‘áº¿n má»™t luá»“ng tá»•ng há»£p káº¿t quáº£.</p>
<p>Äáº§u tiÃªn, trong Listing 16-6, chÃºng ta sáº½ táº¡o má»™t channel nhÆ°ng chÆ°a lÃ m gÃ¬ vá»›i nÃ³. LÆ°u Ã½ ráº±ng Ä‘iá»u nÃ y sáº½ chÆ°a biÃªn dá»‹ch vÃ¬ Rust chÆ°a biáº¿t loáº¡i giÃ¡ trá»‹ nÃ o chÃºng ta muá»‘n gá»­i qua channel.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">use std::sync::mpsc;

fn main() {
    let (tx, rx) = mpsc::channel();
}</code></pre>
<p><span class="caption">Listing 16-6: Táº¡o má»™t channel vÃ  gÃ¡n hai ná»­a cho <code>tx</code> vÃ  <code>rx</code></span></p>
<p>ChÃºng ta táº¡o má»™t channel má»›i báº±ng cÃ¡ch sá»­ dá»¥ng hÃ m <code>mpsc::channel</code>; <code>mpsc</code> viáº¿t táº¯t cá»§a <em>multiple producer, single consumer</em> (nhiá»u ngÆ°á»i sáº£n xuáº¥t, má»™t ngÆ°á»i tiÃªu thá»¥). TÃ³m láº¡i, cÃ¡ch thÆ° viá»‡n chuáº©n cá»§a Rust triá»ƒn khai channels nghÄ©a lÃ  má»™t channel cÃ³ thá»ƒ cÃ³ nhiá»u <em>sending</em> ends táº¡o ra giÃ¡ trá»‹ nhÆ°ng chá»‰ cÃ³ má»™t <em>receiving</em> end tiÃªu thá»¥ cÃ¡c giÃ¡ trá»‹ Ä‘Ã³. HÃ£y tÆ°á»Ÿng tÆ°á»£ng nhiá»u dÃ²ng suá»‘i há»£p láº¡i thÃ nh má»™t dÃ²ng sÃ´ng lá»›n: táº¥t cáº£ má»i thá»© Ä‘Æ°á»£c gá»­i tá»« báº¥t ká»³ dÃ²ng suá»‘i nÃ o sáº½ káº¿t thÃºc trong má»™t dÃ²ng sÃ´ng á»Ÿ cuá»‘i. Hiá»‡n táº¡i, chÃºng ta sáº½ báº¯t Ä‘áº§u vá»›i má»™t producer duy nháº¥t, nhÆ°ng sau Ä‘Ã³ sáº½ thÃªm nhiá»u producer khi vÃ­ dá»¥ nÃ y hoáº¡t Ä‘á»™ng.</p>
<p>HÃ m <code>mpsc::channel</code> tráº£ vá» má»™t tuple, pháº§n tá»­ Ä‘áº§u tiÃªn lÃ  ná»­a gá»­i â€“ transmitter â€“ vÃ  pháº§n tá»­ thá»© hai lÃ  ná»­a nháº­n â€“ receiver. CÃ¡c viáº¿t táº¯t <code>tx</code> vÃ  <code>rx</code> thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng trong nhiá»u lÄ©nh vá»±c cho <em>transmitter</em> vÃ  <em>receiver</em> tÆ°Æ¡ng á»©ng, vÃ¬ váº­y chÃºng ta Ä‘áº·t tÃªn biáº¿n nhÆ° váº­y Ä‘á»ƒ chá»‰ Ä‘á»‹nh má»—i Ä‘áº§u. ChÃºng ta sá»­ dá»¥ng má»™t cÃ¢u lá»‡nh <code>let</code> vá»›i pattern Ä‘á»ƒ destructure tuple; chÃºng ta sáº½ bÃ n vá» viá»‡c sá»­ dá»¥ng pattern trong cÃ¡c cÃ¢u lá»‡nh <code>let</code> vÃ  destructuring trong ChÆ°Æ¡ng 18. Hiá»‡n táº¡i, hÃ£y biáº¿t ráº±ng viá»‡c sá»­ dá»¥ng cÃ¢u lá»‡nh <code>let</code> theo cÃ¡ch nÃ y lÃ  má»™t cÃ¡ch tiá»‡n lá»£i Ä‘á»ƒ trÃ­ch xuáº¥t cÃ¡c pháº§n tá»­ cá»§a tuple do <code>mpsc::channel</code> tráº£ vá».</p>
<p>HÃ£y di chuyá»ƒn ná»­a truyá»n vÃ o má»™t luá»“ng Ä‘Æ°á»£c spawn vÃ  cho nÃ³ gá»­i má»™t chuá»—i Ä‘á»ƒ luá»“ng spawn cÃ³ thá»ƒ giao tiáº¿p vá»›i luá»“ng chÃ­nh, nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ trong Listing 16-7. Äiá»u nÃ y giá»‘ng nhÆ° Ä‘áº·t má»™t con vá»‹t cao su vÃ o dÃ²ng sÃ´ng thÆ°á»£ng lÆ°u hoáº·c gá»­i má»™t tin nháº¯n chat tá»« má»™t luá»“ng sang luá»“ng khÃ¡c.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::sync::mpsc;
use std::thread;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let val = String::from("hi");
        tx.send(val).unwrap();
    });
}</code></pre></pre>
<p><span class="caption">Listing 16-7: Di chuyá»ƒn <code>tx</code> vÃ o luá»“ng spawn vÃ  gá»­i â€œhiâ€</span></p>
<p>Má»™t láº§n ná»¯a, chÃºng ta sá»­ dá»¥ng <code>thread::spawn</code> Ä‘á»ƒ táº¡o má»™t luá»“ng má»›i vÃ  sau Ä‘Ã³ dÃ¹ng <code>move</code> Ä‘á»ƒ di chuyá»ƒn <code>tx</code> vÃ o closure sao cho luá»“ng spawn sá»Ÿ há»¯u <code>tx</code>. Luá»“ng spawn cáº§n sá»Ÿ há»¯u transmitter Ä‘á»ƒ cÃ³ thá»ƒ gá»­i tin nháº¯n qua channel. Transmitter cÃ³ phÆ°Æ¡ng thá»©c <code>send</code> nháº­n giÃ¡ trá»‹ mÃ  chÃºng ta muá»‘n gá»­i. PhÆ°Æ¡ng thá»©c <code>send</code> tráº£ vá» kiá»ƒu <code>Result&lt;T, E&gt;</code>, vÃ¬ váº­y náº¿u receiver Ä‘Ã£ bá»‹ drop vÃ  khÃ´ng cÃ³ nÆ¡i nÃ o Ä‘á»ƒ gá»­i giÃ¡ trá»‹, thao tÃ¡c gá»­i sáº½ tráº£ vá» lá»—i. Trong vÃ­ dá»¥ nÃ y, chÃºng ta gá»i <code>unwrap</code> Ä‘á»ƒ panic náº¿u cÃ³ lá»—i. NhÆ°ng trong má»™t á»©ng dá»¥ng thá»±c táº¿, chÃºng ta sáº½ xá»­ lÃ½ nÃ³ má»™t cÃ¡ch thÃ­ch há»£p: quay láº¡i ChÆ°Æ¡ng 9 Ä‘á»ƒ xem cÃ¡c chiáº¿n lÆ°á»£c xá»­ lÃ½ lá»—i Ä‘Ãºng cÃ¡ch.</p>
<p>Trong Listing 16-8, chÃºng ta sáº½ láº¥y giÃ¡ trá»‹ tá»« receiver trong luá»“ng chÃ­nh. Äiá»u nÃ y giá»‘ng nhÆ° láº¥y con vá»‹t cao su tá»« cuá»‘i dÃ²ng sÃ´ng hoáº·c nháº­n má»™t tin nháº¯n chat.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::sync::mpsc;
use std::thread;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let val = String::from("hi");
        tx.send(val).unwrap();
    });

    let received = rx.recv().unwrap();
    println!("Got: {received}");
}</code></pre></pre>
<p><span class="caption">Listing 16-8: Nháº­n giÃ¡ trá»‹ â€œhiâ€ trong luá»“ng chÃ­nh vÃ  in ra</span></p>
<p>Receiver cÃ³ hai phÆ°Æ¡ng thá»©c há»¯u Ã­ch: <code>recv</code> vÃ  <code>try_recv</code>. ChÃºng ta Ä‘ang sá»­ dá»¥ng <code>recv</code>, viáº¿t táº¯t cá»§a <em>receive</em>, phÆ°Æ¡ng thá»©c nÃ y sáº½ block luá»“ng chÃ­nh vÃ  chá» cho Ä‘áº¿n khi má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c gá»­i xuá»‘ng channel. Khi cÃ³ giÃ¡ trá»‹ Ä‘Æ°á»£c gá»­i, <code>recv</code> sáº½ tráº£ vá» giÃ¡ trá»‹ Ä‘Ã³ dÆ°á»›i dáº¡ng <code>Result&lt;T, E&gt;</code>. Khi transmitter Ä‘Ã³ng, <code>recv</code> sáº½ tráº£ vá» lá»—i Ä‘á»ƒ bÃ¡o ráº±ng khÃ´ng cÃ²n giÃ¡ trá»‹ nÃ o ná»¯a.</p>
<p>PhÆ°Æ¡ng thá»©c <code>try_recv</code> khÃ´ng block, mÃ  thay vÃ o Ä‘Ã³ sáº½ tráº£ vá» ngay láº­p tá»©c má»™t <code>Result&lt;T, E&gt;</code>: giÃ¡ trá»‹ <code>Ok</code> chá»©a tin nháº¯n náº¿u cÃ³ tin nháº¯n, vÃ  giÃ¡ trá»‹ <code>Err</code> náº¿u láº§n nÃ y khÃ´ng cÃ³ tin nháº¯n nÃ o. Sá»­ dá»¥ng <code>try_recv</code> há»¯u Ã­ch náº¿u luá»“ng nÃ y cÃ²n cÃ´ng viá»‡c khÃ¡c Ä‘á»ƒ lÃ m trong khi chá» tin nháº¯n: chÃºng ta cÃ³ thá»ƒ viáº¿t má»™t vÃ²ng láº·p gá»i <code>try_recv</code> theo thá»i gian, xá»­ lÃ½ tin nháº¯n náº¿u cÃ³, vÃ  náº¿u khÃ´ng thÃ¬ lÃ m cÃ´ng viá»‡c khÃ¡c má»™t thá»i gian ngáº¯n trÆ°á»›c khi kiá»ƒm tra láº¡i.</p>
<p>ChÃºng ta Ä‘Ã£ dÃ¹ng <code>recv</code> trong vÃ­ dá»¥ nÃ y cho Ä‘Æ¡n giáº£n; luá»“ng chÃ­nh khÃ´ng cÃ²n cÃ´ng viá»‡c gÃ¬ khÃ¡c ngoÃ i chá» tin nháº¯n, nÃªn viá»‡c block luá»“ng chÃ­nh lÃ  há»£p lÃ½.</p>
<p>Khi cháº¡y code trong Listing 16-8, chÃºng ta sáº½ tháº¥y giÃ¡ trá»‹ Ä‘Æ°á»£c in ra tá»« luá»“ng chÃ­nh:</p>
<!-- KhÃ´ng trÃ­ch xuáº¥t Ä‘áº§u ra vÃ¬ cÃ¡c thay Ä‘á»•i vá»›i Ä‘áº§u ra nÃ y khÃ´ng Ä‘Ã¡ng ká»ƒ;
cÃ¡c thay Ä‘á»•i cÃ³ kháº£ nÄƒng do cÃ¡c luá»“ng cháº¡y khÃ¡c nhau chá»© khÃ´ng pháº£i do compiler thay Ä‘á»•i -->
<pre><code class="language-text">Got: hi
</code></pre>
<p>Perfect!</p>
<h3 id="kÃªnh-vÃ -viá»‡c-chuyá»ƒn-giao-quyá»n-sá»Ÿ-há»¯u"><a class="header" href="#kÃªnh-vÃ -viá»‡c-chuyá»ƒn-giao-quyá»n-sá»Ÿ-há»¯u">KÃªnh vÃ  Viá»‡c Chuyá»ƒn Giao Quyá»n Sá»Ÿ Há»¯u</a></h3>
<p>CÃ¡c quy táº¯c sá»Ÿ há»¯u Ä‘Ã³ng vai trÃ² then chá»‘t trong viá»‡c gá»­i tin nháº¯n
vÃ¬ chÃºng giÃºp báº¡n viáº¿t mÃ£ Ä‘á»“ng thá»i an toÃ n. NgÄƒn ngá»«a lá»—i trong
láº­p trÃ¬nh Ä‘á»“ng thá»i lÃ  lá»£i Ã­ch cá»§a viá»‡c luÃ´n xem xÃ©t quyá»n sá»Ÿ há»¯u
trong toÃ n bá»™ chÆ°Æ¡ng trÃ¬nh Rust cá»§a báº¡n. HÃ£y lÃ m má»™t thÃ­ nghiá»‡m Ä‘á»ƒ
minh há»a cÃ¡ch kÃªnh vÃ  quyá»n sá»Ÿ há»¯u phá»‘i há»£p ngÄƒn ngá»«a váº¥n Ä‘á»: chÃºng ta
sáº½ thá»­ sá»­ dá»¥ng má»™t giÃ¡ trá»‹ <code>val</code> trong luá»“ng Ä‘Æ°á»£c táº¡o ra <em>sau khi</em> Ä‘Ã£ gá»­i nÃ³ qua kÃªnh.
HÃ£y thá»­ biÃªn dá»‹ch mÃ£ trong Listing 16-9 Ä‘á»ƒ tháº¥y táº¡i sao mÃ£ nÃ y khÃ´ng Ä‘Æ°á»£c phÃ©p:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">use std::sync::mpsc;
use std::thread;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let val = String::from("hi");
        tx.send(val).unwrap();
        println!("val is {val}");
    });

    let received = rx.recv().unwrap();
    println!("Got: {received}");
}</code></pre>
<p><span class="caption">Listing 16-9: Thá»­ sá»­ dá»¥ng <code>val</code> sau khi chÃºng ta Ä‘Ã£ gá»­i nÃ³
qua kÃªnh</span></p>
<p>á» Ä‘Ã¢y, chÃºng ta cá»‘ gáº¯ng in ra <code>val</code> sau khi Ä‘Ã£ gá»­i nÃ³ xuá»‘ng kÃªnh thÃ´ng qua
<code>tx.send</code>. Viá»‡c cho phÃ©p Ä‘iá»u nÃ y sáº½ lÃ  má»™t Ã½ tÆ°á»Ÿng tá»“i: má»™t khi giÃ¡ trá»‹ Ä‘Ã£
Ä‘Æ°á»£c gá»­i sang má»™t luá»“ng khÃ¡c, luá»“ng Ä‘Ã³ cÃ³ thá»ƒ sá»­a Ä‘á»•i hoáº·c há»§y (drop) nÃ³ trÆ°á»›c
khi chÃºng ta cá»‘ gáº¯ng sá»­ dá»¥ng láº¡i giÃ¡ trá»‹ nÃ y. Ráº¥t cÃ³ thá»ƒ, cÃ¡c thay Ä‘á»•i tá»« luá»“ng
kia sáº½ gÃ¢y ra lá»—i hoáº·c nhá»¯ng káº¿t quáº£ khÃ´ng mong muá»‘n do dá»¯ liá»‡u khÃ´ng nháº¥t
quÃ¡n hoáº·c tháº­m chÃ­ khÃ´ng cÃ²n tá»“n táº¡i. Tuy nhiÃªn, Rust sáº½ bÃ¡o lá»—i khi chÃºng ta
cá»‘ gáº¯ng biÃªn dá»‹ch mÃ£ trong Listing 16-9:</p>
<pre><code class="language-console">$ cargo run
   Compiling message-passing v0.1.0 (file:///projects/message-passing)
error[E0382]: borrow of moved value: `val`
  --&gt; src/main.rs:10:26
   |
8  |         let val = String::from("hi");
   |             --- move occurs because `val` has type `String`, which does not implement the `Copy` trait
9  |         tx.send(val).unwrap();
   |                 --- value moved here
10 |         println!("val is {val}");
   |                          ^^^^^ value borrowed here after move
   |
   = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)

For more information about this error, try `rustc --explain E0382`.
error: could not compile `message-passing` (bin "message-passing") due to 1 previous error
</code></pre>
<p>Lá»—i Ä‘á»“ng thá»i (concurrency) cá»§a chÃºng ta Ä‘Ã£ gÃ¢y ra má»™t lá»—i táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch. HÃ m <code>send</code>
sáº½ láº¥y quyá»n sá»Ÿ há»¯u (take ownership) cá»§a tham sá»‘ truyá»n vÃ o, vÃ  khi giÃ¡ trá»‹ bá»‹ move, phÃ­a nháº­n
(receiver) sáº½ náº¯m quyá»n sá»Ÿ há»¯u cá»§a nÃ³. Äiá»u nÃ y ngÄƒn chÃºng ta vÃ´ tÃ¬nh sá»­ dá»¥ng láº¡i giÃ¡ trá»‹ sau khi
Ä‘Ã£ gá»­i Ä‘i; há»‡ thá»‘ng ownership sáº½ kiá»ƒm tra Ä‘á»ƒ Ä‘áº£m báº£o má»i thá»© Ä‘á»u há»£p lá»‡.</p>
<h3 id="gá»­i-nhiá»u-giÃ¡-trá»‹-vÃ -quan-sÃ¡t-receiver-Äang-chá»"><a class="header" href="#gá»­i-nhiá»u-giÃ¡-trá»‹-vÃ -quan-sÃ¡t-receiver-Äang-chá»">Gá»­i Nhiá»u GiÃ¡ Trá»‹ vÃ  Quan SÃ¡t Receiver Äang Chá»</a></h3>
<p>Äoáº¡n mÃ£ trong Listing 16-8 Ä‘Ã£ biÃªn dá»‹ch vÃ  cháº¡y Ä‘Æ°á»£c, nhÆ°ng nÃ³ chÆ°a cho tháº¥y rÃµ ráº±ng
hai thread riÃªng biá»‡t Ä‘ang giao tiáº¿p vá»›i nhau thÃ´ng qua channel. Trong Listing
16-10, chÃºng ta Ä‘Ã£ thá»±c hiá»‡n má»™t sá»‘ chá»‰nh sá»­a Ä‘á»ƒ chá»©ng minh ráº±ng Ä‘oáº¡n mÃ£ trong
Listing 16-8 thá»±c sá»± Ä‘ang cháº¡y Ä‘á»“ng thá»i: thread Ä‘Æ°á»£c spawn giá» Ä‘Ã¢y sáº½ gá»­i nhiá»u
thÃ´ng Ä‘iá»‡p vÃ  táº¡m dá»«ng má»™t giÃ¢y giá»¯a má»—i láº§n gá»­i.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust noplayground">use std::sync::mpsc;
use std::thread;
use std::time::Duration;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let vals = vec![
            String::from("hi"),
            String::from("from"),
            String::from("the"),
            String::from("thread"),
        ];

        for val in vals {
            tx.send(val).unwrap();
            thread::sleep(Duration::from_secs(1));
        }
    });

    for received in rx {
        println!("Got: {received}");
    }
}</code></pre>
<p><span class="caption">Listing 16-10: Gá»­i nhiá»u thÃ´ng Ä‘iá»‡p vÃ  táº¡m dá»«ng
giá»¯a má»—i láº§n gá»­i</span></p>
<p>Láº§n nÃ y, thread Ä‘Æ°á»£c spawn cÃ³ má»™t vector cÃ¡c chuá»—i mÃ  chÃºng ta muá»‘n gá»­i tá»›i
thread chÃ­nh. ChÃºng ta láº·p qua tá»«ng pháº§n tá»­, gá»­i tá»«ng giÃ¡ trá»‹ má»™t, vÃ  táº¡m dá»«ng
giá»¯a má»—i láº§n gá»­i báº±ng cÃ¡ch gá»i hÃ m <code>thread::sleep</code> vá»›i má»™t giÃ¡ trá»‹ <code>Duration</code>
lÃ  1 giÃ¢y.</p>
<p>Trong thread chÃ­nh, chÃºng ta khÃ´ng cÃ²n gá»i hÃ m <code>recv</code> má»™t cÃ¡ch tÆ°á»ng minh ná»¯a:
thay vÃ o Ä‘Ã³, chÃºng ta coi <code>rx</code> nhÆ° má»™t iterator. Vá»›i má»—i giÃ¡ trá»‹ nháº­n Ä‘Æ°á»£c,
chÃºng ta in nÃ³ ra. Khi channel bá»‹ Ä‘Ã³ng, quÃ¡ trÃ¬nh láº·p sáº½ káº¿t thÃºc.</p>
<p>Khi cháº¡y Ä‘oáº¡n mÃ£ trong Listing 16-10, báº¡n sáº½ tháº¥y output sau, vá»›i khoáº£ng dá»«ng
1 giÃ¢y giá»¯a má»—i dÃ²ng:</p>
<!-- KhÃ´ng trÃ­ch xuáº¥t output vÃ¬ nhá»¯ng thay Ä‘á»•i trong output nÃ y khÃ´ng Ä‘Ã¡ng ká»ƒ;
cÃ¡c thay Ä‘á»•i nhiá»u kháº£ nÄƒng lÃ  do cÃ¡c thread cháº¡y khÃ¡c nhau, thay vÃ¬ do
nhá»¯ng thay Ä‘á»•i trong trÃ¬nh biÃªn dá»‹ch -->
<pre><code class="language-text">Got: hi
Got: from
Got: the
Got: thread
</code></pre>
<p>Bá»Ÿi vÃ¬ trong vÃ²ng láº·p <code>for</code> á»Ÿ thread chÃ­nh chÃºng ta khÃ´ng cÃ³ báº¥t ká»³ Ä‘oáº¡n mÃ£ nÃ o
Ä‘á»ƒ táº¡m dá»«ng hay trÃ¬ hoÃ£n, nÃªn cÃ³ thá»ƒ tháº¥y ráº±ng thread chÃ­nh Ä‘ang chá» Ä‘á»ƒ nháº­n
cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c gá»­i tá»« thread Ä‘Æ°á»£c spawn.</p>
<h3 id="táº¡o-nhiá»u-producer-báº±ng-cÃ¡ch-clone-transmitter"><a class="header" href="#táº¡o-nhiá»u-producer-báº±ng-cÃ¡ch-clone-transmitter">Táº¡o Nhiá»u Producer báº±ng CÃ¡ch Clone Transmitter</a></h3>
<p>TrÆ°á»›c Ä‘Ã³, chÃºng ta Ä‘Ã£ Ä‘á» cáº­p ráº±ng <code>mpsc</code> lÃ  tá»« viáº¿t táº¯t cá»§a <em>multiple producer,
single consumer</em> (nhiá»u bÃªn gá»­i, má»™t bÃªn nháº­n). BÃ¢y giá» hÃ£y Ã¡p dá»¥ng <code>mpsc</code> vÃ 
má»Ÿ rá»™ng Ä‘oáº¡n mÃ£ trong Listing 16-10 Ä‘á»ƒ táº¡o ra nhiá»u thread, táº¥t cáº£ Ä‘á»u gá»­i giÃ¡
trá»‹ tá»›i cÃ¹ng má»™t receiver. ChÃºng ta cÃ³ thá»ƒ lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch clone
transmitter, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 16-11:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust noplayground"><span class="boring">use std::sync::mpsc;
</span><span class="boring">use std::thread;
</span><span class="boring">use std::time::Duration;
</span><span class="boring">
</span><span class="boring">fn main() {
</span>    // --snip--

    let (tx, rx) = mpsc::channel();

    let tx1 = tx.clone();
    thread::spawn(move || {
        let vals = vec![
            String::from("hi"),
            String::from("from"),
            String::from("the"),
            String::from("thread"),
        ];

        for val in vals {
            tx1.send(val).unwrap();
            thread::sleep(Duration::from_secs(1));
        }
    });

    thread::spawn(move || {
        let vals = vec![
            String::from("more"),
            String::from("messages"),
            String::from("for"),
            String::from("you"),
        ];

        for val in vals {
            tx.send(val).unwrap();
            thread::sleep(Duration::from_secs(1));
        }
    });

    for received in rx {
        println!("Got: {received}");
    }

    // --snip--
<span class="boring">}</span></code></pre>
<p><span class="caption">Listing 16-11: Gá»­i nhiá»u thÃ´ng Ä‘iá»‡p tá»« nhiá»u producer</span></p>
<p>Láº§n nÃ y, trÆ°á»›c khi táº¡o thread Ä‘Æ°á»£c spawn Ä‘áº§u tiÃªn, chÃºng ta gá»i <code>clone</code> trÃªn
transmitter. Viá»‡c nÃ y sáº½ táº¡o ra má»™t transmitter má»›i Ä‘á»ƒ chÃºng ta truyá»n vÃ o
thread Ä‘Æ°á»£c spawn thá»© nháº¥t. Transmitter gá»‘c sáº½ Ä‘Æ°á»£c truyá»n cho thread Ä‘Æ°á»£c spawn
thá»© hai. Káº¿t quáº£ lÃ  chÃºng ta cÃ³ hai thread, má»—i thread gá»­i cÃ¡c thÃ´ng Ä‘iá»‡p khÃ¡c
nhau tá»›i cÃ¹ng má»™t receiver.</p>
<p>Khi báº¡n cháº¡y Ä‘oáº¡n mÃ£, output sáº½ trÃ´ng tÆ°Æ¡ng tá»± nhÆ° sau:</p>
<!-- KhÃ´ng trÃ­ch xuáº¥t output vÃ¬ nhá»¯ng thay Ä‘á»•i trong output nÃ y khÃ´ng Ä‘Ã¡ng ká»ƒ;
cÃ¡c thay Ä‘á»•i nhiá»u kháº£ nÄƒng lÃ  do cÃ¡c thread cháº¡y khÃ¡c nhau, thay vÃ¬ do
nhá»¯ng thay Ä‘á»•i trong trÃ¬nh biÃªn dá»‹ch -->
<pre><code class="language-text">Got: hi
Got: more
Got: from
Got: messages
Got: for
Got: the
Got: thread
Got: you
</code></pre>
<p>Báº¡n cÃ³ thá»ƒ sáº½ tháº¥y cÃ¡c giÃ¡ trá»‹ xuáº¥t hiá»‡n theo má»™t thá»© tá»± khÃ¡c, tÃ¹y thuá»™c vÃ o há»‡
thá»‘ng cá»§a báº¡n. ÄÃ¢y chÃ­nh lÃ  Ä‘iá»u khiáº¿n concurrency vá»«a thÃº vá»‹ vá»«a khÃ³ khÄƒn. Náº¿u
báº¡n thá»­ nghiá»‡m vá»›i <code>thread::sleep</code>, truyá»n cho nÃ³ cÃ¡c giÃ¡ trá»‹ khÃ¡c nhau á»Ÿ cÃ¡c
thread khÃ¡c nhau, thÃ¬ má»—i láº§n cháº¡y chÆ°Æ¡ng trÃ¬nh sáº½ cÃ ng trá»Ÿ nÃªn khÃ´ng xÃ¡c Ä‘á»‹nh
(nondeterministic) hÆ¡n vÃ  táº¡o ra output khÃ¡c nhau má»—i láº§n.</p>
<p>BÃ¢y giá», sau khi Ä‘Ã£ xem cÃ¡ch cÃ¡c channel hoáº¡t Ä‘á»™ng, chÃºng ta hÃ£y cÃ¹ng xem má»™t
phÆ°Æ¡ng phÃ¡p concurrency khÃ¡c.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="shared-state-concurrency"><a class="header" href="#shared-state-concurrency">Shared-State Concurrency</a></h2>
<p>Concurrency dá»±a trÃªn viá»‡c truyá»n thÃ´ng Ä‘iá»‡p (message passing) lÃ  má»™t cÃ¡ch tá»‘t Ä‘á»ƒ
xá»­ lÃ½ Ä‘á»“ng thá»i, nhÆ°ng Ä‘Ã³ khÃ´ng pháº£i lÃ  cÃ¡ch duy nháº¥t. Má»™t phÆ°Æ¡ng phÃ¡p khÃ¡c lÃ 
cho nhiá»u thread cÃ¹ng truy cáº­p vÃ o má»™t vÃ¹ng dá»¯ liá»‡u Ä‘Æ°á»£c chia sáº». HÃ£y xem láº¡i
má»™t pháº§n trong kháº©u hiá»‡u cá»§a tÃ i liá»‡u ngÃ´n ngá»¯ Go: â€œdo not communicate by sharing
memory.â€</p>
<p>Váº­y viá»‡c giao tiáº¿p báº±ng cÃ¡ch chia sáº» bá»™ nhá»› sáº½ trÃ´ng nhÆ° tháº¿ nÃ o? NgoÃ i ra, táº¡i
sao nhá»¯ng ngÆ°á»i á»§ng há»™ message passing láº¡i cáº£nh bÃ¡o khÃ´ng nÃªn sá»­ dá»¥ng viá»‡c chia
sáº» bá»™ nhá»›?</p>
<p>á» má»™t khÃ­a cáº¡nh nÃ o Ä‘Ã³, channel trong báº¥t ká»³ ngÃ´n ngá»¯ láº­p trÃ¬nh nÃ o cÅ©ng tÆ°Æ¡ng tá»±
nhÆ° single ownership, bá»Ÿi vÃ¬ má»™t khi báº¡n Ä‘Ã£ chuyá»ƒn má»™t giÃ¡ trá»‹ qua channel, báº¡n
khÃ´ng nÃªn sá»­ dá»¥ng láº¡i giÃ¡ trá»‹ Ä‘Ã³ ná»¯a. Concurrency dá»±a trÃªn bá»™ nhá»› dÃ¹ng chung
(shared memory concurrency) thÃ¬ giá»‘ng vá»›i multiple ownership: nhiá»u thread cÃ³
thá»ƒ truy cáº­p cÃ¹ng má»™t vá»‹ trÃ­ bá»™ nhá»› táº¡i cÃ¹ng má»™t thá»i Ä‘iá»ƒm. NhÆ° báº¡n Ä‘Ã£ tháº¥y trong
ChÆ°Æ¡ng 15, nÆ¡i smart pointer cho phÃ©p multiple ownership, thÃ¬ multiple ownership
cÃ³ thá»ƒ lÃ m tÄƒng Ä‘á»™ phá»©c táº¡p vÃ¬ cÃ¡c â€œchá»§ sá»Ÿ há»¯uâ€ khÃ¡c nhau nÃ y cáº§n Ä‘Æ°á»£c quáº£n lÃ½.
Há»‡ thá»‘ng kiá»ƒu dá»¯ liá»‡u vÃ  cÃ¡c quy táº¯c ownership cá»§a Rust há»— trá»£ ráº¥t nhiá»u trong
viá»‡c quáº£n lÃ½ nÃ y má»™t cÃ¡ch chÃ­nh xÃ¡c. Äá»ƒ láº¥y vÃ­ dá»¥, chÃºng ta hÃ£y cÃ¹ng xem mutex,
má»™t trong nhá»¯ng primitive Ä‘á»“ng thá»i phá»• biáº¿n nháº¥t cho bá»™ nhá»› dÃ¹ng chung.</p>
<h3 id="sá»­-dá»¥ng-mutex-Äá»ƒ-cho-phÃ©p-truy-cáº­p-dá»¯-liá»‡u-tá»«-má»™t-thread-táº¡i-má»™t-thá»i-Äiá»ƒm"><a class="header" href="#sá»­-dá»¥ng-mutex-Äá»ƒ-cho-phÃ©p-truy-cáº­p-dá»¯-liá»‡u-tá»«-má»™t-thread-táº¡i-má»™t-thá»i-Äiá»ƒm">Sá»­ Dá»¥ng Mutex Äá»ƒ Cho PhÃ©p Truy Cáº­p Dá»¯ Liá»‡u Tá»« Má»™t Thread Táº¡i Má»™t Thá»i Äiá»ƒm</a></h3>
<p><em>Mutex</em> lÃ  tá»« viáº¿t táº¯t cá»§a <em>mutual exclusion</em> (loáº¡i trá»« láº«n nhau), nghÄ©a lÃ  mutex
chá»‰ cho phÃ©p <strong>má»™t thread</strong> truy cáº­p vÃ o má»™t pháº§n dá»¯ liá»‡u táº¡i báº¥t ká»³ thá»i Ä‘iá»ƒm
nÃ o. Äá»ƒ truy cáº­p dá»¯ liá»‡u bÃªn trong mutex, má»™t thread trÆ°á»›c háº¿t pháº£i bÃ¡o hiá»‡u
ráº±ng nÃ³ muá»‘n truy cáº­p báº±ng cÃ¡ch yÃªu cáº§u chiáº¿m giá»¯ (<em>acquire</em>) <em>lock</em> cá»§a mutex.
Lock lÃ  má»™t cáº¥u trÃºc dá»¯ liá»‡u thuá»™c vá» mutex, dÃ¹ng Ä‘á»ƒ theo dÃµi thread nÃ o hiá»‡n
Ä‘ang cÃ³ quyá»n truy cáº­p Ä‘á»™c quyá»n vÃ o dá»¯ liá»‡u. VÃ¬ váº­y, mutex Ä‘Æ°á»£c mÃ´ táº£ lÃ  Ä‘ang
<em>canh giá»¯</em> (guarding) dá»¯ liá»‡u mÃ  nÃ³ náº¯m giá»¯ thÃ´ng qua cÆ¡ cháº¿ khÃ³a.</p>
<p>Mutex ná»•i tiáº¿ng lÃ  khÃ³ sá»­ dá»¥ng vÃ¬ báº¡n pháº£i ghi nhá»› hai quy táº¯c:</p>
<ul>
<li>Báº¡n pháº£i cá»‘ gáº¯ng acquire lock trÆ°á»›c khi sá»­ dá»¥ng dá»¯ liá»‡u.</li>
<li>Khi Ä‘Ã£ sá»­ dá»¥ng xong dá»¯ liá»‡u mÃ  mutex Ä‘ang canh giá»¯, báº¡n pháº£i má»Ÿ khÃ³a (unlock)
dá»¯ liá»‡u Ä‘Ã³ Ä‘á»ƒ cÃ¡c thread khÃ¡c cÃ³ thá»ƒ acquire lock.</li>
</ul>
<p>Äá»ƒ láº¥y má»™t phÃ©p áº©n dá»¥ trong Ä‘á»i thá»±c cho mutex, hÃ£y tÆ°á»Ÿng tÆ°á»£ng má»™t buá»•i tháº£o
luáº­n táº¡i há»™i nghá»‹ chá»‰ cÃ³ má»™t chiáº¿c micro. TrÆ°á»›c khi má»™t diá»…n giáº£ cÃ³ thá»ƒ phÃ¡t
biá»ƒu, há» pháº£i xin hoáº·c ra hiá»‡u ráº±ng há» muá»‘n sá»­ dá»¥ng micro. Khi Ä‘Ã£ cÃ³ micro, há»
cÃ³ thá»ƒ nÃ³i bao lÃ¢u tÃ¹y thÃ­ch, rá»“i chuyá»ƒn micro cho diá»…n giáº£ tiáº¿p theo Ä‘ang muá»‘n
phÃ¡t biá»ƒu. Náº¿u má»™t diá»…n giáº£ quÃªn khÃ´ng chuyá»ƒn micro sau khi nÃ³i xong, sáº½ khÃ´ng ai
khÃ¡c cÃ³ thá»ƒ nÃ³i Ä‘Æ°á»£c. Náº¿u viá»‡c quáº£n lÃ½ chiáº¿c micro dÃ¹ng chung nÃ y xáº£y ra sai
sÃ³t, buá»•i tháº£o luáº­n sáº½ khÃ´ng thá»ƒ diá»…n ra nhÆ° dá»± kiáº¿n!</p>
<p>Viá»‡c quáº£n lÃ½ mutex cÃ³ thá»ƒ cá»±c ká»³ phá»©c táº¡p Ä‘á»ƒ lÃ m cho Ä‘Ãºng, Ä‘Ã³ lÃ  lÃ½ do vÃ¬ sao ráº¥t
nhiá»u ngÆ°á»i há»©ng thÃº vá»›i channel. Tuy nhiÃªn, nhá» há»‡ thá»‘ng kiá»ƒu dá»¯ liá»‡u vÃ  cÃ¡c
quy táº¯c ownership cá»§a Rust, báº¡n khÃ´ng thá»ƒ khÃ³a vÃ  má»Ÿ khÃ³a sai Ä‘Æ°á»£c.</p>
<h4 id="api-cá»§a-mutext"><a class="header" href="#api-cá»§a-mutext">API cá»§a <code>Mutex&lt;T&gt;</code></a></h4>
<p>Äá»ƒ minh há»a cÃ¡ch sá»­ dá»¥ng mutex, chÃºng ta hÃ£y báº¯t Ä‘áº§u báº±ng viá»‡c dÃ¹ng mutex trong
bá»‘i cáº£nh single-thread, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 16-12:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::sync::Mutex;

fn main() {
    let m = Mutex::new(5);

    {
        let mut num = m.lock().unwrap();
        *num = 6;
    }

    println!("m = {m:?}");
}</code></pre></pre>
<p><span class="caption">Listing 16-12: KhÃ¡m phÃ¡ API cá»§a <code>Mutex&lt;T&gt;</code> trong bá»‘i cáº£nh
single-thread Ä‘á»ƒ Ä‘Æ¡n giáº£n hÃ³a</span></p>
<p>CÅ©ng nhÆ° nhiá»u kiá»ƒu dá»¯ liá»‡u khÃ¡c, chÃºng ta táº¡o má»™t <code>Mutex&lt;T&gt;</code> báº±ng cÃ¡ch sá»­ dá»¥ng
hÃ m liÃªn káº¿t (associated function) <code>new</code>. Äá»ƒ truy cáº­p dá»¯ liá»‡u bÃªn trong mutex,
chÃºng ta dÃ¹ng phÆ°Æ¡ng thá»©c <code>lock</code> Ä‘á»ƒ acquire lock. Lá»i gá»i nÃ y sáº½ cháº·n (block)
thread hiá»‡n táº¡i, khiáº¿n nÃ³ khÃ´ng thá»ƒ lÃ m viá»‡c gÃ¬ cho Ä‘áº¿n khi tá»›i lÆ°á»£t nÃ³ náº¯m giá»¯
lock.</p>
<p>Lá»i gá»i <code>lock</code> sáº½ tháº¥t báº¡i náº¿u má»™t thread khÃ¡c Ä‘ang giá»¯ lock bá»‹ panic. Trong
trÆ°á»ng há»£p Ä‘Ã³, sáº½ khÃ´ng ai cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c lock ná»¯a, vÃ¬ váº­y chÃºng ta Ä‘Ã£ chá»n
cÃ¡ch gá»i <code>unwrap</code> vÃ  Ä‘á»ƒ thread hiá»‡n táº¡i panic náº¿u rÆ¡i vÃ o tÃ¬nh huá»‘ng nÃ y.</p>
<p>Sau khi Ä‘Ã£ acquire Ä‘Æ°á»£c lock, chÃºng ta cÃ³ thá»ƒ coi giÃ¡ trá»‹ tráº£ vá»â€”trong trÆ°á»ng
há»£p nÃ y Ä‘Æ°á»£c Ä‘áº·t tÃªn lÃ  <code>num</code>â€”nhÆ° má»™t mutable reference tá»›i dá»¯ liá»‡u bÃªn trong.
Há»‡ thá»‘ng kiá»ƒu dá»¯ liá»‡u Ä‘áº£m báº£o ráº±ng chÃºng ta pháº£i acquire lock trÆ°á»›c khi sá»­ dá»¥ng
giÃ¡ trá»‹ bÃªn trong <code>m</code>. Kiá»ƒu cá»§a <code>m</code> lÃ  <code>Mutex&lt;i32&gt;</code>, chá»© khÃ´ng pháº£i <code>i32</code>, nÃªn
chÃºng ta <em>báº¯t buá»™c</em> pháº£i gá»i <code>lock</code> thÃ¬ má»›i cÃ³ thá»ƒ sá»­ dá»¥ng giÃ¡ trá»‹ <code>i32</code>. ChÃºng
ta khÃ´ng thá»ƒ quÃªn bÆ°á»›c nÃ y; há»‡ thá»‘ng kiá»ƒu dá»¯ liá»‡u sáº½ khÃ´ng cho phÃ©p truy cáº­p vÃ o
<code>i32</code> bÃªn trong náº¿u khÃ´ng lÃ m nhÆ° váº­y.</p>
<p>NhÆ° báº¡n cÃ³ thá»ƒ Ä‘oÃ¡n, <code>Mutex&lt;T&gt;</code> lÃ  má»™t smart pointer. ChÃ­nh xÃ¡c hÆ¡n, lá»i gá»i
<code>lock</code> <em>tráº£ vá»</em> má»™t smart pointer cÃ³ tÃªn lÃ  <code>MutexGuard</code>, Ä‘Æ°á»£c bá»c trong má»™t
<code>LockResult</code> mÃ  chÃºng ta Ä‘Ã£ xá»­ lÃ½ báº±ng cÃ¡ch gá»i <code>unwrap</code>. Smart pointer
<code>MutexGuard</code> triá»ƒn khai trait <code>Deref</code> Ä‘á»ƒ trá» tá»›i dá»¯ liá»‡u bÃªn trong; Ä‘á»“ng thá»i nÃ³
cÅ©ng cÃ³ má»™t implementation cá»§a <code>Drop</code> Ä‘á»ƒ tá»± Ä‘á»™ng giáº£i phÃ³ng lock khi
<code>MutexGuard</code> Ä‘i ra khá»i scope, Ä‘iá»u nÃ y xáº£y ra á»Ÿ cuá»‘i scope bÃªn trong. Káº¿t quáº£
lÃ  chÃºng ta khÃ´ng cÃ³ nguy cÆ¡ quÃªn giáº£i phÃ³ng lock vÃ  cháº·n mutex khÃ´ng cho cÃ¡c
thread khÃ¡c sá»­ dá»¥ng, bá»Ÿi vÃ¬ viá»‡c má»Ÿ khÃ³a diá»…n ra má»™t cÃ¡ch tá»± Ä‘á»™ng.</p>
<p>Sau khi lock Ä‘Æ°á»£c drop, chÃºng ta cÃ³ thá»ƒ in giÃ¡ trá»‹ cá»§a mutex ra vÃ  tháº¥y ráº±ng
chÃºng ta Ä‘Ã£ thay Ä‘á»•i Ä‘Æ°á»£c giÃ¡ trá»‹ <code>i32</code> bÃªn trong thÃ nh 6.</p>
<h4 id="chia-sáº»-mutext-giá»¯a-nhiá»u-thread"><a class="header" href="#chia-sáº»-mutext-giá»¯a-nhiá»u-thread">Chia Sáº» <code>Mutex&lt;T&gt;</code> Giá»¯a Nhiá»u Thread</a></h4>
<p>BÃ¢y giá», hÃ£y thá»­ chia sáº» má»™t giÃ¡ trá»‹ giá»¯a nhiá»u thread báº±ng cÃ¡ch sá»­ dá»¥ng
<code>Mutex&lt;T&gt;</code>. ChÃºng ta sáº½ táº¡o ra 10 thread vÃ  Ä‘á»ƒ má»—i thread tÄƒng giÃ¡ trá»‹ cá»§a má»™t
counter lÃªn 1, Ä‘á»ƒ counter Ä‘i tá»« 0 lÃªn 10. VÃ­ dá»¥ tiáº¿p theo trong Listing 16-13
sáº½ gÃ¢y ra má»™t lá»—i biÃªn dá»‹ch, vÃ  chÃºng ta sáº½ dÃ¹ng lá»—i Ä‘Ã³ Ä‘á»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch
sá»­ dá»¥ng <code>Mutex&lt;T&gt;</code> cÅ©ng nhÆ° cÃ¡ch Rust giÃºp chÃºng ta dÃ¹ng nÃ³ má»™t cÃ¡ch chÃ­nh xÃ¡c.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">use std::sync::Mutex;
use std::thread;

fn main() {
    let counter = Mutex::new(0);
    let mut handles = vec![];

    for _ in 0..10 {
        let handle = thread::spawn(move || {
            let mut num = counter.lock().unwrap();

            *num += 1;
        });
        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }

    println!("Result: {}", *counter.lock().unwrap());
}</code></pre>
<p><span class="caption">Listing 16-13: MÆ°á»i thread, má»—i thread tÄƒng má»™t counter
Ä‘Æ°á»£c canh giá»¯ bá»Ÿi <code>Mutex&lt;T&gt;</code></span></p>
<p>ChÃºng ta táº¡o má»™t biáº¿n <code>counter</code> Ä‘á»ƒ chá»©a má»™t giÃ¡ trá»‹ <code>i32</code> bÃªn trong má»™t
<code>Mutex&lt;T&gt;</code>, giá»‘ng nhÆ° Ä‘Ã£ lÃ m trong Listing 16-12. Tiáº¿p theo, chÃºng ta táº¡o ra
10 thread báº±ng cÃ¡ch láº·p qua má»™t khoáº£ng sá»‘. ChÃºng ta sá»­ dá»¥ng <code>thread::spawn</code> vÃ 
truyá»n cho táº¥t cáº£ cÃ¡c thread cÃ¹ng má»™t closure: closure nÃ y move <code>counter</code> vÃ o
trong thread, acquire lock trÃªn <code>Mutex&lt;T&gt;</code> báº±ng cÃ¡ch gá»i phÆ°Æ¡ng thá»©c <code>lock</code>,
sau Ä‘Ã³ cá»™ng thÃªm 1 vÃ o giÃ¡ trá»‹ bÃªn trong mutex. Khi má»™t thread cháº¡y xong
closure cá»§a nÃ³, <code>num</code> sáº½ Ä‘i ra khá»i scope vÃ  giáº£i phÃ³ng lock Ä‘á»ƒ thread khÃ¡c cÃ³
thá»ƒ acquire nÃ³.</p>
<p>Trong thread chÃ­nh, chÃºng ta thu tháº­p táº¥t cáº£ cÃ¡c join handle. Sau Ä‘Ã³, giá»‘ng nhÆ°
Ä‘Ã£ lÃ m trong Listing 16-2, chÃºng ta gá»i <code>join</code> trÃªn tá»«ng handle Ä‘á»ƒ Ä‘áº£m báº£o táº¥t
cáº£ cÃ¡c thread Ä‘á»u káº¿t thÃºc. Táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³, thread chÃ­nh sáº½ acquire lock vÃ 
in ra káº¿t quáº£ cá»§a chÆ°Æ¡ng trÃ¬nh nÃ y.</p>
<p>ChÃºng ta Ä‘Ã£ gá»£i Ã½ ráº±ng vÃ­ dá»¥ nÃ y sáº½ khÃ´ng biÃªn dá»‹ch Ä‘Æ°á»£c. BÃ¢y giá» hÃ£y cÃ¹ng tÃ¬m
hiá»ƒu lÃ½ do vÃ¬ sao!</p>
<pre><code class="language-console">$ cargo run
   Compiling shared-state v0.1.0 (file:///projects/shared-state)
error[E0382]: borrow of moved value: `counter`
  --&gt; src/main.rs:21:29
   |
5  |     let counter = Mutex::new(0);
   |         ------- move occurs because `counter` has type `Mutex&lt;i32&gt;`, which does not implement the `Copy` trait
...
8  |     for _ in 0..10 {
   |     -------------- inside of this loop
9  |         let handle = thread::spawn(move || {
   |                                    ------- value moved into closure here, in previous iteration of loop
...
21 |     println!("Result: {}", *counter.lock().unwrap());
   |                             ^^^^^^^ value borrowed here after move
   |
help: consider moving the expression out of the loop so it is only moved once
   |
8  ~     let mut value = counter.lock();
9  ~     for _ in 0..10 {
10 |         let handle = thread::spawn(move || {
11 ~             let mut num = value.unwrap();
   |

For more information about this error, try `rustc --explain E0382`.
error: could not compile `shared-state` (bin "shared-state") due to 1 previous error
</code></pre>
<p>ThÃ´ng bÃ¡o lá»—i cho biáº¿t ráº±ng giÃ¡ trá»‹ <code>counter</code> Ä‘Ã£ bá»‹ move á»Ÿ láº§n láº·p trÆ°á»›c Ä‘Ã³ cá»§a
vÃ²ng láº·p. Rust Ä‘ang nÃ³i vá»›i chÃºng ta ráº±ng chÃºng ta khÃ´ng thá»ƒ move quyá»n sá»Ÿ há»¯u
cá»§a <code>counter</code> vÃ o nhiá»u thread khÃ¡c nhau. HÃ£y sá»­a lá»—i biÃªn dá»‹ch nÃ y báº±ng má»™t
phÆ°Æ¡ng phÃ¡p multiple ownership mÃ  chÃºng ta Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 15.</p>
<h4 id="multiple-ownership-vá»›i-nhiá»u-thread"><a class="header" href="#multiple-ownership-vá»›i-nhiá»u-thread">Multiple Ownership vá»›i Nhiá»u Thread</a></h4>
<p>Trong ChÆ°Æ¡ng 15, chÃºng ta Ä‘Ã£ táº¡o cho má»™t giÃ¡ trá»‹ nhiá»u owner báº±ng cÃ¡ch sá»­ dá»¥ng
smart pointer <code>Rc&lt;T&gt;</code> Ä‘á»ƒ táº¡o ra má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c Ä‘áº¿m tham chiáº¿u (reference
counted). HÃ£y lÃ m Ä‘iá»u tÆ°Æ¡ng tá»± á»Ÿ Ä‘Ã¢y vÃ  xem Ä‘iá»u gÃ¬ sáº½ xáº£y ra. ChÃºng ta sáº½ bá»c
<code>Mutex&lt;T&gt;</code> bÃªn trong <code>Rc&lt;T&gt;</code> trong Listing 16-14 vÃ  clone <code>Rc&lt;T&gt;</code> trÆ°á»›c khi move
quyá»n sá»Ÿ há»¯u vÃ o thread.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">use std::rc::Rc;
use std::sync::Mutex;
use std::thread;

fn main() {
    let counter = Rc::new(Mutex::new(0));
    let mut handles = vec![];

    for _ in 0..10 {
        let counter = Rc::clone(&amp;counter);
        let handle = thread::spawn(move || {
            let mut num = counter.lock().unwrap();

            *num += 1;
        });
        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }

    println!("Result: {}", *counter.lock().unwrap());
}</code></pre>
<p><span class="caption">Listing 16-14: Thá»­ sá»­ dá»¥ng <code>Rc&lt;T&gt;</code> Ä‘á»ƒ cho phÃ©p
nhiá»u thread cÃ¹ng sá»Ÿ há»¯u <code>Mutex&lt;T&gt;</code></span></p>
<p>Má»™t láº§n ná»¯a, chÃºng ta biÃªn dá»‹ch vÃ  láº¡i nháº­n Ä‘Æ°á»£câ€¦ nhá»¯ng lá»—i khÃ¡c! TrÃ¬nh biÃªn
dá»‹ch Ä‘ang dáº¡y chÃºng ta ráº¥t nhiá»u Ä‘iá»u.</p>
<pre><code class="language-console">$ cargo run
   Compiling shared-state v0.1.0 (file:///projects/shared-state)
error[E0277]: `Rc&lt;Mutex&lt;i32&gt;&gt;` cannot be sent between threads safely
  --&gt; src/main.rs:11:36
   |
11 |           let handle = thread::spawn(move || {
   |                        ------------- ^------
   |                        |             |
   |  ______________________|_____________within this `{closure@src/main.rs:11:36: 11:43}`
   | |                      |
   | |                      required by a bound introduced by this call
12 | |             let mut num = counter.lock().unwrap();
13 | |
14 | |             *num += 1;
15 | |         });
   | |_________^ `Rc&lt;Mutex&lt;i32&gt;&gt;` cannot be sent between threads safely
   |
   = help: within `{closure@src/main.rs:11:36: 11:43}`, the trait `Send` is not implemented for `Rc&lt;Mutex&lt;i32&gt;&gt;`
note: required because it's used within this closure
  --&gt; src/main.rs:11:36
   |
11 |         let handle = thread::spawn(move || {
   |                                    ^^^^^^^
note: required by a bound in `spawn`
  --&gt; /rustc/4eb161250e340c8f48f66e2b929ef4a5bed7c181/library/std/src/thread/mod.rs:728:1

For more information about this error, try `rustc --explain E0277`.
error: could not compile `shared-state` (bin "shared-state") due to 1 previous error
</code></pre>
<p>Wow, thÃ´ng bÃ¡o lá»—i nÃ y tháº­t lÃ  dÃ i dÃ²ng! ÄÃ¢y lÃ  pháº§n quan trá»ng cáº§n táº­p trung:
<code>`Rc&lt;Mutex&lt;i32&gt;&gt;` cannot be sent between threads safely</code>. TrÃ¬nh biÃªn dá»‹ch
cÅ©ng cho chÃºng ta biáº¿t lÃ½ do vÃ¬ sao: <code>the trait `Send` is not implemented for `Rc&lt;Mutex&lt;i32&gt;&gt;` </code>. ChÃºng ta sáº½ nÃ³i vá» <code>Send</code> trong pháº§n tiáº¿p theo: Ä‘Ã¢y lÃ  má»™t
trong nhá»¯ng trait Ä‘áº£m báº£o ráº±ng cÃ¡c kiá»ƒu dá»¯ liá»‡u chÃºng ta dÃ¹ng vá»›i thread lÃ 
Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ sá»­ dá»¥ng trong cÃ¡c tÃ¬nh huá»‘ng Ä‘á»“ng thá»i.</p>
<p>ÄÃ¡ng tiáº¿c lÃ  <code>Rc&lt;T&gt;</code> khÃ´ng an toÃ n Ä‘á»ƒ chia sáº» giá»¯a cÃ¡c thread. Khi <code>Rc&lt;T&gt;</code> quáº£n
lÃ½ bá»™ Ä‘áº¿m tham chiáº¿u (reference count), nÃ³ tÄƒng bá»™ Ä‘áº¿m má»—i khi <code>clone</code> Ä‘Æ°á»£c gá»i
vÃ  giáº£m bá»™ Ä‘áº¿m khi má»—i báº£n clone bá»‹ drop. Tuy nhiÃªn, nÃ³ khÃ´ng sá»­ dá»¥ng báº¥t ká»³
primitive Ä‘á»“ng thá»i nÃ o Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng cÃ¡c thay Ä‘á»•i Ä‘á»‘i vá»›i bá»™ Ä‘áº¿m khÃ´ng bá»‹
ngáº¯t quÃ£ng bá»Ÿi thread khÃ¡c. Äiá»u nÃ y cÃ³ thá»ƒ dáº«n Ä‘áº¿n bá»™ Ä‘áº¿m saiâ€”nhá»¯ng lá»—i tinh vi
mÃ  sau Ä‘Ã³ cÃ³ thá»ƒ gÃ¢y ra rÃ² rá»‰ bá»™ nhá»› hoáº·c khiáº¿n má»™t giÃ¡ trá»‹ bá»‹ drop trÆ°á»›c khi
chÃºng ta dÃ¹ng xong nÃ³. Thá»© chÃºng ta cáº§n lÃ  má»™t kiá»ƒu dá»¯ liá»‡u giá»‘ng há»‡t <code>Rc&lt;T&gt;</code>
nhÆ°ng thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i Ä‘á»‘i vá»›i bá»™ Ä‘áº¿m tham chiáº¿u theo cÃ¡ch an toÃ n vá»›i
thread.</p>
<h4 id="Äáº¿m-tham-chiáº¿u-nguyÃªn-tá»­-vá»›i-arct"><a class="header" href="#Äáº¿m-tham-chiáº¿u-nguyÃªn-tá»­-vá»›i-arct">Äáº¿m Tham Chiáº¿u NguyÃªn Tá»­ vá»›i <code>Arc&lt;T&gt;</code></a></h4>
<p>May máº¯n thay, <code>Arc&lt;T&gt;</code> <em>lÃ </em> má»™t kiá»ƒu dá»¯ liá»‡u giá»‘ng nhÆ° <code>Rc&lt;T&gt;</code> nhÆ°ng an toÃ n Ä‘á»ƒ
sá»­ dá»¥ng trong cÃ¡c tÃ¬nh huá»‘ng Ä‘á»“ng thá»i. Chá»¯ <em>a</em> lÃ  viáº¿t táº¯t cá»§a <em>atomic</em>, nghÄ©a
lÃ  Ä‘Ã¢y lÃ  má»™t kiá»ƒu <em>Ä‘Æ°á»£c Ä‘áº¿m tham chiáº¿u má»™t cÃ¡ch nguyÃªn tá»­</em> (atomically
reference counted). Atomics lÃ  má»™t loáº¡i primitive Ä‘á»“ng thá»i bá»• sung mÃ  chÃºng ta
sáº½ khÃ´ng Ä‘i sÃ¢u vÃ o chi tiáº¿t á»Ÿ Ä‘Ã¢y: hÃ£y xem tÃ i liá»‡u thÆ° viá»‡n chuáº©n cho
<a href="../std/sync/atomic/index.html"><code>std::sync::atomic</code></a><!-- ignore --> Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t. á» thá»i Ä‘iá»ƒm
nÃ y, báº¡n chá»‰ cáº§n biáº¿t ráº±ng atomics hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° cÃ¡c kiá»ƒu primitive
thÃ´ng thÆ°á»ng nhÆ°ng an toÃ n Ä‘á»ƒ chia sáº» giá»¯a cÃ¡c thread.</p>
<p>LÃºc nÃ y báº¡n cÃ³ thá»ƒ tháº¯c máº¯c vÃ¬ sao táº¥t cáº£ cÃ¡c kiá»ƒu primitive khÃ´ng pháº£i Ä‘á»u lÃ 
atomic, vÃ  vÃ¬ sao cÃ¡c kiá»ƒu trong thÆ° viá»‡n chuáº©n khÃ´ng Ä‘Æ°á»£c triá»ƒn khai Ä‘á»ƒ dÃ¹ng
<code>Arc&lt;T&gt;</code> theo máº·c Ä‘á»‹nh. LÃ½ do lÃ  vÃ¬ tÃ­nh an toÃ n vá»›i thread Ä‘i kÃ¨m vá»›i má»™t chi
phÃ­ hiá»‡u nÄƒng, vÃ  báº¡n chá»‰ nÃªn tráº£ chi phÃ­ Ä‘Ã³ khi thá»±c sá»± cáº§n thiáº¿t. Náº¿u báº¡n chá»‰
thá»±c hiá»‡n cÃ¡c thao tÃ¡c trÃªn giÃ¡ trá»‹ trong pháº¡m vi má»™t thread duy nháº¥t, chÆ°Æ¡ng
trÃ¬nh cá»§a báº¡n cÃ³ thá»ƒ cháº¡y nhanh hÆ¡n náº¿u khÃ´ng pháº£i Ã¡p Ä‘áº·t cÃ¡c Ä‘áº£m báº£o mÃ 
atomics cung cáº¥p.</p>
<p>HÃ£y quay láº¡i vÃ­ dá»¥ cá»§a chÃºng ta: <code>Arc&lt;T&gt;</code> vÃ  <code>Rc&lt;T&gt;</code> cÃ³ cÃ¹ng API, vÃ¬ váº­y chÃºng ta
sá»­a chÆ°Æ¡ng trÃ¬nh báº±ng cÃ¡ch thay Ä‘á»•i dÃ²ng <code>use</code>, lá»i gá»i <code>new</code>, vÃ  lá»i gá»i
<code>clone</code>. Äoáº¡n mÃ£ trong Listing 16-15 cuá»‘i cÃ¹ng cÅ©ng sáº½ biÃªn dá»‹ch vÃ  cháº¡y Ä‘Æ°á»£c:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::sync::{Arc, Mutex};
use std::thread;

fn main() {
    let counter = Arc::new(Mutex::new(0));
    let mut handles = vec![];

    for _ in 0..10 {
        let counter = Arc::clone(&amp;counter);
        let handle = thread::spawn(move || {
            let mut num = counter.lock().unwrap();

            *num += 1;
        });
        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }

    println!("Result: {}", *counter.lock().unwrap());
}</code></pre></pre>
<p><span class="caption">Listing 16-15: Sá»­ dá»¥ng <code>Arc&lt;T&gt;</code> Ä‘á»ƒ bá»c <code>Mutex&lt;T&gt;</code>
nháº±m cÃ³ thá»ƒ chia sáº» quyá»n sá»Ÿ há»¯u giá»¯a nhiá»u thread</span></p>
<p>Äoáº¡n mÃ£ nÃ y sáº½ in ra káº¿t quáº£ sau:</p>
<!-- KhÃ´ng trÃ­ch xuáº¥t output vÃ¬ nhá»¯ng thay Ä‘á»•i trong output nÃ y khÃ´ng Ä‘Ã¡ng ká»ƒ;
cÃ¡c thay Ä‘á»•i nhiá»u kháº£ nÄƒng lÃ  do cÃ¡c thread cháº¡y khÃ¡c nhau, thay vÃ¬ do
nhá»¯ng thay Ä‘á»•i trong trÃ¬nh biÃªn dá»‹ch -->
<pre><code class="language-text">Result: 10
</code></pre>
<p>ChÃºng ta Ä‘Ã£ lÃ m Ä‘Æ°á»£c rá»“i! ChÃºng ta Ä‘Ã£ Ä‘áº¿m tá»« 0 lÃªn 10 â€” nghe cÃ³ váº» khÃ´ng máº¥y áº¥n
tÆ°á»£ng, nhÆ°ng nÃ³ Ä‘Ã£ dáº¡y cho chÃºng ta ráº¥t nhiá»u Ä‘iá»u vá» <code>Mutex&lt;T&gt;</code> vÃ  tÃ­nh an toÃ n
vá»›i thread. Báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng cáº¥u trÃºc cá»§a chÆ°Æ¡ng trÃ¬nh nÃ y Ä‘á»ƒ thá»±c hiá»‡n
nhá»¯ng thao tÃ¡c phá»©c táº¡p hÆ¡n nhiá»u so vá»›i viá»‡c chá»‰ tÄƒng má»™t counter. Vá»›i chiáº¿n
lÆ°á»£c nÃ y, báº¡n cÃ³ thá»ƒ chia má»™t phÃ©p tÃ­nh thÃ nh cÃ¡c pháº§n Ä‘á»™c láº­p, phÃ¢n chia cÃ¡c
pháº§n Ä‘Ã³ cho nhiá»u thread, vÃ  sau Ä‘Ã³ sá»­ dá»¥ng <code>Mutex&lt;T&gt;</code> Ä‘á»ƒ má»—i thread cáº­p nháº­t
káº¿t quáº£ cuá»‘i cÃ¹ng báº±ng pháº§n viá»‡c cá»§a mÃ¬nh.</p>
<p>LÆ°u Ã½ ráº±ng náº¿u báº¡n chá»‰ thá»±c hiá»‡n cÃ¡c phÃ©p toÃ¡n sá»‘ há»c Ä‘Æ¡n giáº£n, thÃ¬ cÃ³ nhá»¯ng
kiá»ƒu dá»¯ liá»‡u Ä‘Æ¡n giáº£n hÆ¡n <code>Mutex&lt;T&gt;</code> Ä‘Æ°á»£c cung cáº¥p bá»Ÿi module
<a href="../std/sync/atomic/index.html"><code>std::sync::atomic</code> cá»§a thÆ° viá»‡n chuáº©n</a><!-- ignore -->. Nhá»¯ng kiá»ƒu dá»¯
liá»‡u nÃ y cung cáº¥p kháº£ nÄƒng truy cáº­p Ä‘á»“ng thá»i, an toÃ n vÃ  nguyÃªn tá»­ (atomic)
Ä‘á»‘i vá»›i cÃ¡c kiá»ƒu primitive. ChÃºng tÃ´i chá»n sá»­ dá»¥ng <code>Mutex&lt;T&gt;</code> vá»›i má»™t kiá»ƒu
primitive trong vÃ­ dá»¥ nÃ y Ä‘á»ƒ cÃ³ thá»ƒ táº­p trung vÃ o cÃ¡ch <code>Mutex&lt;T&gt;</code> hoáº¡t Ä‘á»™ng.</p>
<h3 id="sá»±-tÆ°Æ¡ng-Äá»“ng-giá»¯a-refcelltrct-vÃ -mutextarct"><a class="header" href="#sá»±-tÆ°Æ¡ng-Äá»“ng-giá»¯a-refcelltrct-vÃ -mutextarct">Sá»± TÆ°Æ¡ng Äá»“ng Giá»¯a <code>RefCell&lt;T&gt;</code>/<code>Rc&lt;T&gt;</code> vÃ  <code>Mutex&lt;T&gt;</code>/<code>Arc&lt;T&gt;</code></a></h3>
<p>Báº¡n cÃ³ thá»ƒ Ä‘Ã£ nháº­n ra ráº±ng <code>counter</code> lÃ  immutable nhÆ°ng chÃºng ta váº«n cÃ³ thá»ƒ láº¥y
Ä‘Æ°á»£c má»™t mutable reference tá»›i giÃ¡ trá»‹ bÃªn trong nÃ³; Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ 
<code>Mutex&lt;T&gt;</code> cung cáº¥p <em>interior mutability</em>, tÆ°Æ¡ng tá»± nhÆ° há» kiá»ƒu <code>Cell</code>. CÅ©ng
giá»‘ng nhÆ° cÃ¡ch chÃºng ta Ä‘Ã£ dÃ¹ng <code>RefCell&lt;T&gt;</code> trong ChÆ°Æ¡ng 15 Ä‘á»ƒ cho phÃ©p mutate
ná»™i dung bÃªn trong má»™t <code>Rc&lt;T&gt;</code>, thÃ¬ á»Ÿ Ä‘Ã¢y chÃºng ta dÃ¹ng <code>Mutex&lt;T&gt;</code> Ä‘á»ƒ mutate ná»™i
dung bÃªn trong má»™t <code>Arc&lt;T&gt;</code>.</p>
<p>Má»™t chi tiáº¿t khÃ¡c cáº§n lÆ°u Ã½ lÃ  Rust khÃ´ng thá»ƒ báº£o vá»‡ báº¡n khá»i má»i loáº¡i lá»—i logic
khi báº¡n sá»­ dá»¥ng <code>Mutex&lt;T&gt;</code>. HÃ£y nhá»› láº¡i trong ChÆ°Æ¡ng 15 ráº±ng viá»‡c sá»­ dá»¥ng
<code>Rc&lt;T&gt;</code> Ä‘i kÃ¨m vá»›i rá»§i ro táº¡o ra cÃ¡c chu trÃ¬nh tham chiáº¿u (reference cycles), khi
hai giÃ¡ trá»‹ <code>Rc&lt;T&gt;</code> tham chiáº¿u láº«n nhau, dáº«n Ä‘áº¿n rÃ² rá»‰ bá»™ nhá»›. TÆ°Æ¡ng tá»± nhÆ° váº­y,
<code>Mutex&lt;T&gt;</code> cÅ©ng Ä‘i kÃ¨m vá»›i rá»§i ro táº¡o ra <em>deadlock</em>. Deadlock xáº£y ra khi má»™t thao
tÃ¡c cáº§n khÃ³a hai tÃ i nguyÃªn vÃ  hai thread má»—i bÃªn Ä‘Ã£ chiáº¿m giá»¯ má»™t lock, khiáº¿n
chÃºng chá» nhau vÃ´ thá»i háº¡n. Náº¿u báº¡n quan tÃ¢m Ä‘áº¿n deadlock, hÃ£y thá»­ viáº¿t má»™t
chÆ°Æ¡ng trÃ¬nh Rust cÃ³ deadlock; sau Ä‘Ã³ tÃ¬m hiá»ƒu cÃ¡c chiáº¿n lÆ°á»£c giáº£m thiá»ƒu
deadlock cho mutex trong báº¥t ká»³ ngÃ´n ngá»¯ nÃ o vÃ  thá»­ triá»ƒn khai chÃºng báº±ng Rust.
TÃ i liá»‡u API cá»§a thÆ° viá»‡n chuáº©n cho <code>Mutex&lt;T&gt;</code> vÃ  <code>MutexGuard</code> cung cáº¥p nhiá»u
thÃ´ng tin há»¯u Ã­ch.</p>
<p>ChÃºng ta sáº½ khÃ©p láº¡i chÆ°Æ¡ng nÃ y báº±ng viá»‡c nÃ³i vá» cÃ¡c trait <code>Send</code> vÃ  <code>Sync</code>, vÃ 
cÃ¡ch chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng chÃºng vá»›i cÃ¡c kiá»ƒu dá»¯ liá»‡u tá»± Ä‘á»‹nh nghÄ©a.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="concurrency-cÃ³-thá»ƒ-má»Ÿ-rá»™ng-vá»›i-cÃ¡c-trait-sync-vÃ -send"><a class="header" href="#concurrency-cÃ³-thá»ƒ-má»Ÿ-rá»™ng-vá»›i-cÃ¡c-trait-sync-vÃ -send">Concurrency CÃ³ Thá»ƒ Má»Ÿ Rá»™ng vá»›i cÃ¡c Trait <code>Sync</code> vÃ  <code>Send</code></a></h2>
<p>Tháº­t thÃº vá»‹ lÃ  ngÃ´n ngá»¯ Rust cÃ³ <em>ráº¥t</em> Ã­t tÃ­nh nÄƒng concurrency Ä‘Æ°á»£c tÃ­ch há»£p
trá»±c tiáº¿p. Gáº§n nhÆ° má»i khÃ¡i niá»‡m concurrency mÃ  chÃºng ta Ä‘Ã£ nÃ³i tá»›i trong
chÆ°Æ¡ng nÃ y Ä‘á»u thuá»™c vá» thÆ° viá»‡n chuáº©n, chá»© khÃ´ng pháº£i báº£n thÃ¢n ngÃ´n ngá»¯. CÃ¡c
lá»±a chá»n Ä‘á»ƒ xá»­ lÃ½ concurrency cá»§a báº¡n khÃ´ng bá»‹ giá»›i háº¡n trong ngÃ´n ngá»¯ hay thÆ°
viá»‡n chuáº©n; báº¡n hoÃ n toÃ n cÃ³ thá»ƒ tá»± viáº¿t cÃ¡c cÆ¡ cháº¿ concurrency cá»§a riÃªng mÃ¬nh
hoáº·c sá»­ dá»¥ng nhá»¯ng cÆ¡ cháº¿ do ngÆ°á»i khÃ¡c viáº¿t.</p>
<p>Tuy nhiÃªn, cÃ³ hai khÃ¡i niá»‡m concurrency Ä‘Æ°á»£c nhÃºng trá»±c tiáº¿p vÃ o ngÃ´n ngá»¯: cÃ¡c
marker trait <code>Sync</code> vÃ  <code>Send</code> trong module <code>std::marker</code>.</p>
<h3 id="cho-phÃ©p-chuyá»ƒn-quyá»n-sá»Ÿ-há»¯u-giá»¯a-cÃ¡c-thread-vá»›i-send"><a class="header" href="#cho-phÃ©p-chuyá»ƒn-quyá»n-sá»Ÿ-há»¯u-giá»¯a-cÃ¡c-thread-vá»›i-send">Cho PhÃ©p Chuyá»ƒn Quyá»n Sá»Ÿ Há»¯u Giá»¯a CÃ¡c Thread vá»›i <code>Send</code></a></h3>
<p>Marker trait <code>Send</code> cho biáº¿t ráº±ng quyá»n sá»Ÿ há»¯u cá»§a cÃ¡c giÃ¡ trá»‹ thuá»™c kiá»ƒu triá»ƒn
khai <code>Send</code> cÃ³ thá»ƒ Ä‘Æ°á»£c chuyá»ƒn giá»¯a cÃ¡c thread. Háº§u nhÆ° má»i kiá»ƒu dá»¯ liá»‡u trong
Rust Ä‘á»u lÃ  <code>Send</code>, nhÆ°ng váº«n cÃ³ má»™t sá»‘ ngoáº¡i lá»‡, trong Ä‘Ã³ cÃ³ <code>Rc&lt;T&gt;</code>: kiá»ƒu nÃ y
khÃ´ng thá»ƒ lÃ  <code>Send</code> bá»Ÿi vÃ¬ náº¿u báº¡n clone má»™t giÃ¡ trá»‹ <code>Rc&lt;T&gt;</code> vÃ  cá»‘ gáº¯ng chuyá»ƒn
quyá»n sá»Ÿ há»¯u cá»§a báº£n clone Ä‘Ã³ sang má»™t thread khÃ¡c, thÃ¬ cáº£ hai thread cÃ³ thá»ƒ
cáº­p nháº­t bá»™ Ä‘áº¿m tham chiáº¿u cÃ¹ng lÃºc. VÃ¬ lÃ½ do nÃ y, <code>Rc&lt;T&gt;</code> Ä‘Æ°á»£c triá»ƒn khai Ä‘á»ƒ
sá»­ dá»¥ng trong cÃ¡c tÃ¬nh huá»‘ng single-thread, nÆ¡i báº¡n khÃ´ng muá»‘n tráº£ chi phÃ­ hiá»‡u
nÄƒng cho tÃ­nh an toÃ n vá»›i thread.</p>
<p>Do Ä‘Ã³, há»‡ thá»‘ng kiá»ƒu dá»¯ liá»‡u vÃ  cÃ¡c trait bound cá»§a Rust Ä‘áº£m báº£o ráº±ng báº¡n khÃ´ng
thá»ƒ vÃ´ tÃ¬nh gá»­i má»™t giÃ¡ trá»‹ <code>Rc&lt;T&gt;</code> qua cÃ¡c thread theo cÃ¡ch khÃ´ng an toÃ n. Khi
chÃºng ta cá»‘ gáº¯ng lÃ m Ä‘iá»u nÃ y trong Listing 16-14, chÃºng ta Ä‘Ã£ nháº­n Ä‘Æ°á»£c lá»—i
<code>the trait Send is not implemented for Rc&lt;Mutex&lt;i32&gt;&gt;</code>. Khi chÃºng ta chuyá»ƒn sang
dÃ¹ng <code>Arc&lt;T&gt;</code>, vá»‘n lÃ  <code>Send</code>, thÃ¬ Ä‘oáº¡n mÃ£ Ä‘Ã£ biÃªn dá»‹ch thÃ nh cÃ´ng.</p>
<p>Báº¥t ká»³ kiá»ƒu dá»¯ liá»‡u nÃ o Ä‘Æ°á»£c cáº¥u thÃ nh hoÃ n toÃ n tá»« cÃ¡c kiá»ƒu <code>Send</code> cÅ©ng sáº½ tá»±
Ä‘á»™ng Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  <code>Send</code>. Háº§u háº¿t cÃ¡c kiá»ƒu primitive Ä‘á»u lÃ  <code>Send</code>, ngoáº¡i
trá»« raw pointer, thá»© mÃ  chÃºng ta sáº½ bÃ n tá»›i trong ChÆ°Æ¡ng 19.</p>
<h3 id="cho-phÃ©p-truy-cáº­p-tá»«-nhiá»u-thread-vá»›i-sync"><a class="header" href="#cho-phÃ©p-truy-cáº­p-tá»«-nhiá»u-thread-vá»›i-sync">Cho PhÃ©p Truy Cáº­p Tá»« Nhiá»u Thread vá»›i <code>Sync</code></a></h3>
<p>Marker trait <code>Sync</code> cho biáº¿t ráº±ng kiá»ƒu dá»¯ liá»‡u triá»ƒn khai <code>Sync</code> lÃ  an toÃ n khi
Ä‘Æ°á»£c tham chiáº¿u tá»« nhiá»u thread. NÃ³i cÃ¡ch khÃ¡c, má»™t kiá»ƒu <code>T</code> lÃ  <code>Sync</code> náº¿u <code>&amp;T</code>
(má»™t immutable reference tá»›i <code>T</code>) lÃ  <code>Send</code>, tá»©c lÃ  reference Ä‘Ã³ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»­i
sang má»™t thread khÃ¡c má»™t cÃ¡ch an toÃ n. TÆ°Æ¡ng tá»± nhÆ° <code>Send</code>, cÃ¡c kiá»ƒu primitive
lÃ  <code>Sync</code>, vÃ  cÃ¡c kiá»ƒu Ä‘Æ°á»£c cáº¥u thÃ nh hoÃ n toÃ n tá»« cÃ¡c kiá»ƒu <code>Sync</code> cÅ©ng sáº½ lÃ 
<code>Sync</code>.</p>
<p>Smart pointer <code>Rc&lt;T&gt;</code> cÅ©ng khÃ´ng pháº£i lÃ  <code>Sync</code> vÃ¬ nhá»¯ng lÃ½ do giá»‘ng nhÆ° viá»‡c nÃ³
khÃ´ng pháº£i lÃ  <code>Send</code>. Kiá»ƒu <code>RefCell&lt;T&gt;</code> (mÃ  chÃºng ta Ä‘Ã£ nÃ³i tá»›i trong ChÆ°Æ¡ng 15)
vÃ  há» cÃ¡c kiá»ƒu liÃªn quan <code>Cell&lt;T&gt;</code> khÃ´ng pháº£i lÃ  <code>Sync</code>. CÆ¡ cháº¿ kiá»ƒm tra borrow
mÃ  <code>RefCell&lt;T&gt;</code> thá»±c hiá»‡n táº¡i runtime lÃ  khÃ´ng an toÃ n vá»›i thread. Smart pointer
<code>Mutex&lt;T&gt;</code> thÃ¬ lÃ  <code>Sync</code> vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ chia sáº» quyá»n truy cáº­p giá»¯a
nhiá»u thread, nhÆ° báº¡n Ä‘Ã£ tháº¥y trong pháº§n
<a href="ch16-03-shared-state.html#sharing-a-mutext-between-multiple-threads">â€œChia Sáº» <code>Mutex&lt;T&gt;</code> Giá»¯a Nhiá»u Threadâ€</a><!-- ignore -->.</p>
<h3 id="viá»‡c-tá»±-triá»ƒn-khai-send-vÃ -sync-lÃ -khÃ´ng-an-toÃ n"><a class="header" href="#viá»‡c-tá»±-triá»ƒn-khai-send-vÃ -sync-lÃ -khÃ´ng-an-toÃ n">Viá»‡c Tá»± Triá»ƒn Khai <code>Send</code> vÃ  <code>Sync</code> LÃ  KhÃ´ng An ToÃ n</a></h3>
<p>Bá»Ÿi vÃ¬ cÃ¡c kiá»ƒu dá»¯ liá»‡u Ä‘Æ°á»£c táº¡o thÃ nh tá»« nhá»¯ng thÃ nh pháº§n <code>Send</code> vÃ  <code>Sync</code> sáº½
tá»± Ä‘á»™ng cÅ©ng lÃ  <code>Send</code> vÃ  <code>Sync</code>, nÃªn chÃºng ta khÃ´ng cáº§n pháº£i tá»± tay triá»ƒn khai
nhá»¯ng trait nÃ y. LÃ  cÃ¡c marker trait, chÃºng tháº­m chÃ­ cÃ²n khÃ´ng cÃ³ phÆ°Æ¡ng thá»©c
nÃ o Ä‘á»ƒ triá»ƒn khai. ChÃºng chá»‰ Ä‘Æ¡n thuáº§n há»¯u Ã­ch trong viá»‡c Ä‘áº£m báº£o cÃ¡c báº¥t biáº¿n
(invariant) liÃªn quan Ä‘áº¿n concurrency.</p>
<p>Viá»‡c triá»ƒn khai thá»§ cÃ´ng cÃ¡c trait nÃ y Ä‘á»“ng nghÄ©a vá»›i viá»‡c viáº¿t mÃ£ Rust khÃ´ng
an toÃ n (unsafe). ChÃºng ta sáº½ nÃ³i vá» viá»‡c sá»­ dá»¥ng unsafe Rust trong ChÆ°Æ¡ng 19;
cÃ²n táº¡i thá»i Ä‘iá»ƒm nÃ y, Ä‘iá»u quan trá»ng cáº§n biáº¿t lÃ  viá»‡c xÃ¢y dá»±ng cÃ¡c kiá»ƒu dá»¯
liá»‡u Ä‘á»“ng thá»i má»›i, khÃ´ng Ä‘Æ°á»£c cáº¥u thÃ nh tá»« cÃ¡c thÃ nh pháº§n <code>Send</code> vÃ  <code>Sync</code>, Ä‘Ã²i
há»i pháº£i suy nghÄ© ráº¥t cáº©n trá»ng Ä‘á»ƒ duy trÃ¬ cÃ¡c Ä‘áº£m báº£o an toÃ n. <a href="../nomicon/index.html">â€œThe
Rustonomiconâ€</a> cÃ³ thÃªm thÃ´ng tin vá» nhá»¯ng Ä‘áº£m báº£o nÃ y vÃ  cÃ¡ch duy trÃ¬
chÃºng.</p>
<h2 id="tÃ³m-táº¯t-6"><a class="header" href="#tÃ³m-táº¯t-6">TÃ³m Táº¯t</a></h2>
<p>ÄÃ¢y chÆ°a pháº£i lÃ  láº§n cuá»‘i cÃ¹ng báº¡n gáº·p concurrency trong cuá»‘n sÃ¡ch nÃ y: dá»± Ã¡n á»Ÿ
ChÆ°Æ¡ng 20 sáº½ sá»­ dá»¥ng cÃ¡c khÃ¡i niá»‡m trong chÆ°Æ¡ng nÃ y trong má»™t bá»‘i cáº£nh thá»±c táº¿
hÆ¡n so vá»›i nhá»¯ng vÃ­ dá»¥ nhá» Ä‘Ã£ Ä‘Æ°á»£c tháº£o luáº­n á»Ÿ Ä‘Ã¢y.</p>
<p>NhÆ° Ä‘Ã£ Ä‘á» cáº­p trÆ°á»›c Ä‘Ã³, bá»Ÿi vÃ¬ ráº¥t Ã­t cÃ¡ch Rust xá»­ lÃ½ concurrency lÃ  má»™t pháº§n
cá»§a chÃ­nh ngÃ´n ngá»¯, nÃªn nhiá»u giáº£i phÃ¡p concurrency Ä‘Æ°á»£c triá»ƒn khai dÆ°á»›i dáº¡ng
crate. Nhá»¯ng crate nÃ y phÃ¡t triá»ƒn nhanh hÆ¡n so vá»›i thÆ° viá»‡n chuáº©n, vÃ¬ váº­y hÃ£y
nhá»› tÃ¬m kiáº¿m trÃªn máº¡ng Ä‘á»ƒ cáº­p nháº­t nhá»¯ng crate hiá»‡n Ä‘áº¡i vÃ  tá»‘t nháº¥t hiá»‡n nay
Ä‘á»ƒ sá»­ dá»¥ng trong cÃ¡c tÃ¬nh huá»‘ng Ä‘a luá»“ng.</p>
<p>ThÆ° viá»‡n chuáº©n cá»§a Rust cung cáº¥p cÃ¡c channel Ä‘á»ƒ truyá»n thÃ´ng Ä‘iá»‡p vÃ  cÃ¡c kiá»ƒu
smart pointer, cháº³ng háº¡n nhÆ° <code>Mutex&lt;T&gt;</code> vÃ  <code>Arc&lt;T&gt;</code>, an toÃ n khi sá»­ dá»¥ng trong
bá»‘i cáº£nh Ä‘á»“ng thá»i. Há»‡ thá»‘ng kiá»ƒu dá»¯ liá»‡u vÃ  borrow checker Ä‘áº£m báº£o ráº±ng Ä‘oáº¡n mÃ£
sá»­ dá»¥ng cÃ¡c giáº£i phÃ¡p nÃ y sáº½ khÃ´ng rÆ¡i vÃ o tÃ¬nh tráº¡ng data race hay reference
khÃ´ng há»£p lá»‡. Má»™t khi báº¡n Ä‘Ã£ lÃ m cho chÆ°Æ¡ng trÃ¬nh biÃªn dá»‹ch thÃ nh cÃ´ng, báº¡n cÃ³
thá»ƒ yÃªn tÃ¢m ráº±ng nÃ³ sáº½ cháº¡y á»•n Ä‘á»‹nh trÃªn nhiá»u thread mÃ  khÃ´ng gáº·p pháº£i nhá»¯ng
lá»—i khÃ³ truy váº¿t thÆ°á»ng tháº¥y á»Ÿ cÃ¡c ngÃ´n ngá»¯ khÃ¡c. Láº­p trÃ¬nh Ä‘á»“ng thá»i khÃ´ng cÃ²n
lÃ  má»™t khÃ¡i niá»‡m Ä‘Ã¡ng sá»£ ná»¯a: hÃ£y tiáº¿n lÃªn vÃ  lÃ m cho chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n trá»Ÿ
nÃªn Ä‘á»“ng thá»i, má»™t cÃ¡ch khÃ´ng sá»£ hÃ£i!</p>
<p>Tiáº¿p theo, chÃºng ta sáº½ nÃ³i vá» nhá»¯ng cÃ¡ch lÃ m mang tÃ­nh idiomatic Ä‘á»ƒ mÃ´ hÃ¬nh hÃ³a
váº¥n Ä‘á» vÃ  cáº¥u trÃºc lá»i giáº£i khi chÆ°Æ¡ng trÃ¬nh Rust cá»§a báº¡n ngÃ y cÃ ng lá»›n. NgoÃ i
ra, chÃºng ta cÅ©ng sáº½ tháº£o luáº­n vá» cÃ¡ch cÃ¡c idiom cá»§a Rust liÃªn há»‡ vá»›i nhá»¯ng gÃ¬
báº¡n cÃ³ thá»ƒ Ä‘Ã£ quen thuá»™c trong láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cÃ¡c-Äáº·c-Äiá»ƒm-láº­p-trÃ¬nh-hÆ°á»›ng-Äá»‘i-tÆ°á»£ng-cá»§a-rust"><a class="header" href="#cÃ¡c-Äáº·c-Äiá»ƒm-láº­p-trÃ¬nh-hÆ°á»›ng-Äá»‘i-tÆ°á»£ng-cá»§a-rust">CÃ¡c Äáº·c Äiá»ƒm Láº­p TrÃ¬nh HÆ°á»›ng Äá»‘i TÆ°á»£ng cá»§a Rust</a></h1>
<p>Láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (Object-Oriented Programming â€“ OOP) lÃ  má»™t cÃ¡ch Ä‘á»ƒ mÃ´
hÃ¬nh hÃ³a chÆ°Æ¡ng trÃ¬nh. Object nhÆ° má»™t khÃ¡i niá»‡m trong láº­p trÃ¬nh Ä‘Æ°á»£c giá»›i thiá»‡u
láº§n Ä‘áº§u trong ngÃ´n ngá»¯ láº­p trÃ¬nh Simula vÃ o nhá»¯ng nÄƒm 1960. Nhá»¯ng object nÃ y Ä‘Ã£
áº£nh hÆ°á»Ÿng tá»›i kiáº¿n trÃºc láº­p trÃ¬nh cá»§a Alan Kay, trong Ä‘Ã³ cÃ¡c object gá»­i thÃ´ng
Ä‘iá»‡p cho nhau. Äá»ƒ mÃ´ táº£ kiáº¿n trÃºc nÃ y, Ã´ng Ä‘Ã£ Ä‘áº·t ra thuáº­t ngá»¯ <em>object-oriented
programming</em> vÃ o nÄƒm 1967. CÃ³ ráº¥t nhiá»u Ä‘á»‹nh nghÄ©a khÃ¡c nhau, tháº­m chÃ­ cáº¡nh
tranh nhau, vá» viá»‡c OOP lÃ  gÃ¬; theo má»™t sá»‘ Ä‘á»‹nh nghÄ©a thÃ¬ Rust lÃ  hÆ°á»›ng Ä‘á»‘i
tÆ°á»£ng, nhÆ°ng theo nhá»¯ng Ä‘á»‹nh nghÄ©a khÃ¡c thÃ¬ Rust láº¡i khÃ´ng pháº£i.</p>
<p>Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ khÃ¡m phÃ¡ má»™t sá»‘ Ä‘áº·c Ä‘iá»ƒm thÆ°á»ng Ä‘Æ°á»£c xem lÃ  thuá»™c
vá» láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng, vÃ  cÃ¡ch nhá»¯ng Ä‘áº·c Ä‘iá»ƒm Ä‘Ã³ Ä‘Æ°á»£c thá»ƒ hiá»‡n trong
Rust theo phong cÃ¡ch idiomatic. Sau Ä‘Ã³, chÃºng ta sáº½ chá»‰ ra cÃ¡ch triá»ƒn khai má»™t
design pattern hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng trong Rust vÃ  tháº£o luáº­n vá» nhá»¯ng Ä‘Ã¡nh Ä‘á»•i khi
lÃ m nhÆ° váº­y so vá»›i viá»‡c triá»ƒn khai má»™t lá»i giáº£i táº­n dá»¥ng cÃ¡c tháº¿ máº¡nh vá»‘n cÃ³
cá»§a Rust.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="cÃ¡c-Äáº·c-Äiá»ƒm-cá»§a-ngÃ´n-ngá»¯-láº­p-trÃ¬nh-hÆ°á»›ng-Äá»‘i-tÆ°á»£ng"><a class="header" href="#cÃ¡c-Äáº·c-Äiá»ƒm-cá»§a-ngÃ´n-ngá»¯-láº­p-trÃ¬nh-hÆ°á»›ng-Äá»‘i-tÆ°á»£ng">CÃ¡c Äáº·c Äiá»ƒm cá»§a NgÃ´n Ngá»¯ Láº­p TrÃ¬nh HÆ°á»›ng Äá»‘i TÆ°á»£ng</a></h2>
<p>Trong cá»™ng Ä‘á»“ng láº­p trÃ¬nh, khÃ´ng cÃ³ sá»± Ä‘á»“ng thuáº­n tuyá»‡t Ä‘á»‘i vá» viá»‡c má»™t ngÃ´n ngá»¯
cáº§n pháº£i cÃ³ nhá»¯ng Ä‘áº·c Ä‘iá»ƒm nÃ o thÃ¬ má»›i Ä‘Æ°á»£c xem lÃ  hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng. Rust chá»‹u
áº£nh hÆ°á»Ÿng tá»« nhiá»u mÃ´ hÃ¬nh láº­p trÃ¬nh khÃ¡c nhau, bao gá»“m cáº£ OOP; vÃ­ dá»¥, chÃºng ta
Ä‘Ã£ khÃ¡m phÃ¡ nhá»¯ng Ä‘áº·c Ä‘iá»ƒm xuáº¥t phÃ¡t tá»« láº­p trÃ¬nh hÃ m trong ChÆ°Æ¡ng 13. CÃ³ thá»ƒ
láº­p luáº­n ráº±ng cÃ¡c ngÃ´n ngá»¯ OOP chia sáº» má»™t sá»‘ Ä‘áº·c Ä‘iá»ƒm chung, cá»¥ thá»ƒ lÃ  object,
encapsulation vÃ  inheritance. HÃ£y cÃ¹ng xem tá»«ng Ä‘áº·c Ä‘iá»ƒm nÃ y cÃ³ Ã½ nghÄ©a gÃ¬ vÃ 
Rust cÃ³ há»— trá»£ chÃºng hay khÃ´ng.</p>
<h3 id="object-chá»©a-dá»¯-liá»‡u-vÃ -hÃ nh-vi"><a class="header" href="#object-chá»©a-dá»¯-liá»‡u-vÃ -hÃ nh-vi">Object Chá»©a Dá»¯ Liá»‡u vÃ  HÃ nh Vi</a></h3>
<p>Cuá»‘n sÃ¡ch <em>Design Patterns: Elements of Reusable Object-Oriented Software</em> cá»§a
Erich Gamma, Richard Helm, Ralph Johnson vÃ  John Vlissides (Addison-Wesley
Professional, 1994), thÆ°á»ng Ä‘Æ°á»£c gá»i má»™t cÃ¡ch thÃ¢n máº­t lÃ  cuá»‘n sÃ¡ch cá»§a <em>Gang of
Four</em>, lÃ  má»™t tuyá»ƒn táº­p cÃ¡c design pattern hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng. Cuá»‘n sÃ¡ch nÃ y Ä‘á»‹nh
nghÄ©a OOP nhÆ° sau:</p>
<blockquote>
<p>CÃ¡c chÆ°Æ¡ng trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c táº¡o thÃ nh tá»« cÃ¡c object. Má»™t <em>object</em>
Ä‘Ã³ng gÃ³i cáº£ dá»¯ liá»‡u láº«n cÃ¡c thá»§ tá»¥c thao tÃ¡c trÃªn dá»¯ liá»‡u Ä‘Ã³. CÃ¡c thá»§ tá»¥c nÃ y
thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  <em>method</em> hoáº·c <em>operation</em>.</p>
</blockquote>
<p>Theo Ä‘á»‹nh nghÄ©a nÃ y, Rust lÃ  má»™t ngÃ´n ngá»¯ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng: struct vÃ  enum cÃ³ dá»¯
liá»‡u, vÃ  cÃ¡c khá»‘i <code>impl</code> cung cáº¥p method cho struct vÃ  enum. Máº·c dÃ¹ struct vÃ 
enum cÃ³ method khÃ´ng Ä‘Æ°á»£c <em>gá»i</em> lÃ  object, nhÆ°ng theo Ä‘á»‹nh nghÄ©a vá» object cá»§a
Gang of Four, chÃºng cung cáº¥p cÃ¹ng má»™t chá»©c nÄƒng.</p>
<h3 id="encapsulation-che-giáº¥u-chi-tiáº¿t-triá»ƒn-khai"><a class="header" href="#encapsulation-che-giáº¥u-chi-tiáº¿t-triá»ƒn-khai">Encapsulation Che Giáº¥u Chi Tiáº¿t Triá»ƒn Khai</a></h3>
<p>Má»™t khÃ­a cáº¡nh khÃ¡c thÆ°á»ng gáº¯n liá»n vá»›i OOP lÃ  khÃ¡i niá»‡m <em>encapsulation</em>, nghÄ©a
lÃ  cÃ¡c chi tiáº¿t triá»ƒn khai cá»§a má»™t object khÃ´ng thá»ƒ bá»‹ truy cáº­p trá»±c tiáº¿p bá»Ÿi
Ä‘oáº¡n mÃ£ sá»­ dá»¥ng object Ä‘Ã³. Do Ä‘Ã³, cÃ¡ch duy nháº¥t Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i má»™t object lÃ 
thÃ´ng qua public API cá»§a nÃ³; mÃ£ sá»­ dá»¥ng object khÃ´ng nÃªn cÃ³ kháº£ nÄƒng Ä‘i sÃ¢u vÃ o
bÃªn trong object vÃ  thay Ä‘á»•i trá»±c tiáº¿p dá»¯ liá»‡u hoáº·c hÃ nh vi. Äiá»u nÃ y cho phÃ©p
láº­p trÃ¬nh viÃªn thay Ä‘á»•i vÃ  refactor pháº§n ná»™i bá»™ cá»§a object mÃ  khÃ´ng cáº§n pháº£i
thay Ä‘á»•i mÃ£ Ä‘ang sá»­ dá»¥ng object Ä‘Ã³.</p>
<p>ChÃºng ta Ä‘Ã£ tháº£o luáº­n vá» cÃ¡ch kiá»ƒm soÃ¡t encapsulation trong ChÆ°Æ¡ng 7: chÃºng ta
cÃ³ thá»ƒ dÃ¹ng tá»« khÃ³a <code>pub</code> Ä‘á»ƒ quyáº¿t Ä‘á»‹nh module, type, function vÃ  method nÃ o
trong mÃ£ cá»§a mÃ¬nh lÃ  public, vÃ  theo máº·c Ä‘á»‹nh thÃ¬ má»i thá»© cÃ²n láº¡i Ä‘á»u lÃ 
private. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a má»™t struct <code>AveragedCollection</code> cÃ³
má»™t field chá»©a má»™t vector cÃ¡c giÃ¡ trá»‹ <code>i32</code>. Struct nÃ y cÅ©ng cÃ³ thá»ƒ cÃ³ má»™t field
khÃ¡c chá»©a giÃ¡ trá»‹ trung bÃ¬nh cá»§a cÃ¡c pháº§n tá»­ trong vector, nghÄ©a lÃ  giÃ¡ trá»‹
trung bÃ¬nh khÃ´ng cáº§n pháº£i Ä‘Æ°á»£c tÃ­nh toÃ¡n má»—i khi ai Ä‘Ã³ cáº§n tá»›i. NÃ³i cÃ¡ch khÃ¡c,
<code>AveragedCollection</code> sáº½ cache giÃ¡ trá»‹ trung bÃ¬nh Ä‘Ã£ Ä‘Æ°á»£c tÃ­nh sáºµn cho chÃºng ta.
Listing 17-1 trÃ¬nh bÃ y Ä‘á»‹nh nghÄ©a cá»§a struct <code>AveragedCollection</code>:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-01/src/lib.rs}}</code></pre>
<p><span class="caption">Listing 17-1: Má»™t struct <code>AveragedCollection</code> duy trÃ¬
má»™t danh sÃ¡ch cÃ¡c sá»‘ nguyÃªn vÃ  giÃ¡ trá»‹ trung bÃ¬nh cá»§a cÃ¡c pháº§n tá»­ trong
collection</span></p>
<p>Struct nÃ y Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  <code>pub</code> Ä‘á»ƒ cÃ¡c Ä‘oáº¡n mÃ£ khÃ¡c cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³, nhÆ°ng
cÃ¡c field bÃªn trong struct váº«n Ä‘Æ°á»£c giá»¯ á»Ÿ má»©c private. Äiá»u nÃ y ráº¥t quan trá»ng
trong trÆ°á»ng há»£p nÃ y, bá»Ÿi vÃ¬ chÃºng ta muá»‘n Ä‘áº£m báº£o ráº±ng má»—i khi cÃ³ má»™t giÃ¡ trá»‹
Ä‘Æ°á»£c thÃªm vÃ o hoáº·c bá»‹ loáº¡i bá» khá»i danh sÃ¡ch, thÃ¬ giÃ¡ trá»‹ trung bÃ¬nh cÅ©ng sáº½
Ä‘Æ°á»£c cáº­p nháº­t tÆ°Æ¡ng á»©ng.</p>
<p>ChÃºng ta thá»±c hiá»‡n Ä‘iá»u Ä‘Ã³ báº±ng cÃ¡ch triá»ƒn khai cÃ¡c method <code>add</code>, <code>remove</code> vÃ 
<code>average</code> cho struct nÃ y, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 17-2:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-02/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-2: Triá»ƒn khai cÃ¡c phÆ°Æ¡ng thá»©c public
<code>add</code>, <code>remove</code> vÃ  <code>average</code> cho <code>AveragedCollection</code></span></p>
<p>CÃ¡c phÆ°Æ¡ng thá»©c public <code>add</code>, <code>remove</code> vÃ  <code>average</code> lÃ  nhá»¯ng cÃ¡ch duy nháº¥t
Ä‘á»ƒ truy cáº­p hoáº·c thay Ä‘á»•i dá»¯ liá»‡u trong má»™t instance cá»§a
<code>AveragedCollection</code>. Khi má»™t pháº§n tá»­ Ä‘Æ°á»£c thÃªm vÃ o <code>list</code> thÃ´ng qua phÆ°Æ¡ng
thá»©c <code>add</code>, hoáº·c bá»‹ loáº¡i bá» thÃ´ng qua phÆ°Æ¡ng thá»©c <code>remove</code>, thÃ¬ pháº§n triá»ƒn khai
cá»§a má»—i phÆ°Æ¡ng thá»©c nÃ y sáº½ gá»i phÆ°Æ¡ng thá»©c private <code>update_average</code> Ä‘á»ƒ xá»­ lÃ½
viá»‡c cáº­p nháº­t field <code>average</code>.</p>
<p>ChÃºng ta giá»¯ cÃ¡c field <code>list</code> vÃ  <code>average</code> á»Ÿ tráº¡ng thÃ¡i private Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng
khÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ code bÃªn ngoÃ i cÃ³ thá»ƒ trá»±c tiáº¿p thÃªm hoáº·c xÃ³a pháº§n tá»­ khá»i
field <code>list</code>. Náº¿u cho phÃ©p lÃ m nhÆ° váº­y, field <code>average</code> cÃ³ thá»ƒ bá»‹ lá»‡ch vÃ  khÃ´ng
cÃ²n Ä‘á»“ng bá»™ vá»›i <code>list</code> khi dá»¯ liá»‡u thay Ä‘á»•i. PhÆ°Æ¡ng thá»©c <code>average</code> chá»‰ tráº£ vá»
giÃ¡ trá»‹ cá»§a field <code>average</code>, cho phÃ©p code bÃªn ngoÃ i Ä‘á»c giÃ¡ trá»‹ trung bÃ¬nh
nhÆ°ng khÃ´ng thá»ƒ chá»‰nh sá»­a nÃ³.</p>
<p>Bá»Ÿi vÃ¬ chÃºng ta Ä‘Ã£ Ä‘Ã³ng gÃ³i (encapsulate) cÃ¡c chi tiáº¿t cÃ i Ä‘áº·t cá»§a struct
<code>AveragedCollection</code>, nÃªn trong tÆ°Æ¡ng lai chÃºng ta cÃ³ thá»ƒ dá»… dÃ ng thay Ä‘á»•i má»™t
sá»‘ khÃ­a cáº¡nh, cháº³ng háº¡n nhÆ° cáº¥u trÃºc dá»¯ liá»‡u Ä‘Æ°á»£c sá»­ dá»¥ng. VÃ­ dá»¥, ta cÃ³ thá»ƒ
dÃ¹ng <code>HashSet&lt;i32&gt;</code> thay cho <code>Vec&lt;i32&gt;</code> cho field <code>list</code>. Miá»…n lÃ  chá»¯ kÃ½
(signatures) cá»§a cÃ¡c phÆ°Æ¡ng thá»©c public <code>add</code>, <code>remove</code> vÃ  <code>average</code> váº«n giá»¯
nguyÃªn, thÃ¬ code sá»­ dá»¥ng <code>AveragedCollection</code> sáº½ khÃ´ng cáº§n pháº£i thay Ä‘á»•i.</p>
<p>Náº¿u chÃºng ta Ä‘á»ƒ <code>list</code> lÃ  public, thÃ¬ Ä‘iá»u nÃ y sáº½ khÃ´ng cÃ²n Ä‘Ãºng ná»¯a:
<code>HashSet&lt;i32&gt;</code> vÃ  <code>Vec&lt;i32&gt;</code> cÃ³ cÃ¡c phÆ°Æ¡ng thá»©c khÃ¡c nhau Ä‘á»ƒ thÃªm vÃ  xÃ³a pháº§n
tá»­, nÃªn code bÃªn ngoÃ i ráº¥t cÃ³ thá»ƒ sáº½ pháº£i thay Ä‘á»•i náº¿u nÃ³ thao tÃ¡c trá»±c tiáº¿p
lÃªn <code>list</code>.</p>
<p>Náº¿u Ä‘Ã³ng gÃ³i (encapsulation) lÃ  má»™t yÃªu cáº§u báº¯t buá»™c Ä‘á»ƒ má»™t ngÃ´n ngá»¯ Ä‘Æ°á»£c xem lÃ 
hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng, thÃ¬ Rust hoÃ n toÃ n Ä‘Ã¡p á»©ng Ä‘Æ°á»£c yÃªu cáº§u Ä‘Ã³. Viá»‡c cÃ³ thá»ƒ lá»±a
chá»n dÃ¹ng hay khÃ´ng dÃ¹ng tá»« khÃ³a <code>pub</code> cho tá»«ng pháº§n cá»§a code cho phÃ©p chÃºng ta
che giáº¥u chi tiáº¿t cÃ i Ä‘áº·t má»™t cÃ¡ch hiá»‡u quáº£.</p>
<h3 id="inheritance-as-a-type-system-and-as-code-sharing"><a class="header" href="#inheritance-as-a-type-system-and-as-code-sharing">Inheritance as a Type System and as Code Sharing</a></h3>
<p><em>Inheritance</em> lÃ  má»™t cÆ¡ cháº¿ cho phÃ©p má»™t Ä‘á»‘i tÆ°á»£ng káº¿ thá»«a cÃ¡c thÃ nh pháº§n tá»«
Ä‘á»‹nh nghÄ©a cá»§a má»™t Ä‘á»‘i tÆ°á»£ng khÃ¡c, nhá» Ä‘Ã³ nÃ³ cÃ³ Ä‘Æ°á»£c dá»¯ liá»‡u vÃ  hÃ nh vi cá»§a Ä‘á»‘i tÆ°á»£ng cha
mÃ  khÃ´ng cáº§n báº¡n pháº£i Ä‘á»‹nh nghÄ©a láº¡i chÃºng.</p>
<p>Náº¿u má»™t ngÃ´n ngá»¯ báº¯t buá»™c pháº£i cÃ³ inheritance thÃ¬ má»›i Ä‘Æ°á»£c coi lÃ  má»™t ngÃ´n ngá»¯ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng,
thÃ¬ Rust khÃ´ng pháº£i lÃ  má»™t ngÃ´n ngá»¯ nhÆ° váº­y. KhÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ Ä‘á»‹nh nghÄ©a má»™t struct
káº¿ thá»«a cÃ¡c field vÃ  pháº§n cÃ i Ä‘áº·t method cá»§a struct cha mÃ  khÃ´ng sá»­ dá»¥ng macro.</p>
<p>Tuy nhiÃªn, náº¿u báº¡n Ä‘Ã£ quen vá»›i viá»‡c cÃ³ inheritance trong â€œhá»™p cÃ´ng cá»¥â€ láº­p trÃ¬nh cá»§a mÃ¬nh,
báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c giáº£i phÃ¡p khÃ¡c trong Rust, tÃ¹y thuá»™c vÃ o lÃ½ do ban Ä‘áº§u khiáº¿n báº¡n
muá»‘n dÃ¹ng inheritance.</p>
<p>Báº¡n thÆ°á»ng chá»n inheritance vÃ¬ hai lÃ½ do chÃ­nh. LÃ½ do thá»© nháº¥t lÃ  Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng mÃ£ nguá»“n:
báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t má»™t hÃ nh vi cá»¥ thá»ƒ cho má»™t kiá»ƒu, vÃ  inheritance cho phÃ©p báº¡n
tÃ¡i sá»­ dá»¥ng pháº§n cÃ i Ä‘áº·t Ä‘Ã³ cho má»™t kiá»ƒu khÃ¡c. Trong Rust, báº¡n cÃ³ thá»ƒ lÃ m Ä‘iá»u nÃ y
theo cÃ¡ch háº¡n cháº¿ báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c máº·c Ä‘á»‹nh (default method implementations)
trong trait, nhÆ° báº¡n Ä‘Ã£ tháº¥y á»Ÿ Listing 10-14 khi chÃºng ta thÃªm má»™t pháº§n cÃ i Ä‘áº·t máº·c Ä‘á»‹nh
cho phÆ°Æ¡ng thá»©c <code>summarize</code> trong trait <code>Summary</code>. Báº¥t ká»³ kiá»ƒu nÃ o triá»ƒn khai trait
<code>Summary</code> Ä‘á»u sáº½ cÃ³ sáºµn phÆ°Æ¡ng thá»©c <code>summarize</code> mÃ  khÃ´ng cáº§n thÃªm báº¥t ká»³ dÃ²ng mÃ£ nÃ o.
Äiá»u nÃ y tÆ°Æ¡ng tá»± nhÆ° viá»‡c má»™t lá»›p cha cÃ³ sáºµn pháº§n cÃ i Ä‘áº·t cá»§a má»™t method vÃ  má»™t lá»›p con
káº¿ thá»«a cÅ©ng cÃ³ pháº§n cÃ i Ä‘áº·t method Ä‘Ã³. ChÃºng ta cÅ©ng cÃ³ thá»ƒ ghi Ä‘Ã¨ pháº§n cÃ i Ä‘áº·t máº·c Ä‘á»‹nh
cá»§a phÆ°Æ¡ng thá»©c <code>summarize</code> khi triá»ƒn khai trait <code>Summary</code>, tÆ°Æ¡ng tá»± nhÆ° cÃ¡ch má»™t lá»›p con
ghi Ä‘Ã¨ method Ä‘Æ°á»£c káº¿ thá»«a tá»« lá»›p cha.</p>
<p>LÃ½ do thá»© hai Ä‘á»ƒ sá»­ dá»¥ng inheritance liÃªn quan Ä‘áº¿n há»‡ thá»‘ng kiá»ƒu (type system):
cho phÃ©p má»™t kiá»ƒu con cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ nhá»¯ng nÆ¡i mÃ  kiá»ƒu cha Ä‘Æ°á»£c sá»­ dá»¥ng.
Äiá»u nÃ y cÃ²n Ä‘Æ°á»£c gá»i lÃ  <em>polymorphism</em>, nghÄ©a lÃ  báº¡n cÃ³ thá»ƒ thay tháº¿ nhiá»u Ä‘á»‘i tÆ°á»£ng
cho nhau táº¡i thá»i Ä‘iá»ƒm cháº¡y náº¿u chÃºng chia sáº» má»™t sá»‘ Ä‘áº·c Ä‘iá»ƒm nháº¥t Ä‘á»‹nh.</p>
<section class="note" aria-role="note">
<h3 id="polymorphism"><a class="header" href="#polymorphism">Polymorphism</a></h3>
<p>Vá»›i nhiá»u ngÆ°á»i, polymorphism Ä‘á»“ng nghÄ©a vá»›i inheritance. NhÆ°ng thá»±c táº¿ Ä‘Ã¢y lÃ 
má»™t khÃ¡i niá»‡m tá»•ng quÃ¡t hÆ¡n, dÃ¹ng Ä‘á»ƒ chá»‰ nhá»¯ng Ä‘oáº¡n mÃ£ cÃ³ thá»ƒ lÃ m viá»‡c vá»›i dá»¯ liá»‡u
cá»§a nhiá»u kiá»ƒu khÃ¡c nhau. Trong trÆ°á»ng há»£p inheritance, cÃ¡c kiá»ƒu Ä‘Ã³ thÆ°á»ng lÃ 
cÃ¡c lá»›p con.</p>
<p>Thay vÃ o Ä‘Ã³, Rust sá»­ dá»¥ng generics Ä‘á»ƒ trá»«u tÆ°á»£ng hÃ³a trÃªn nhiá»u kiá»ƒu kháº£ dÄ© khÃ¡c nhau
vÃ  trait bounds Ä‘á»ƒ Ã¡p Ä‘áº·t cÃ¡c rÃ ng buá»™c vá» nhá»¯ng gÃ¬ cÃ¡c kiá»ƒu Ä‘Ã³ pháº£i cung cáº¥p.
CÃ¡ch tiáº¿p cáº­n nÃ y Ä‘Ã´i khi Ä‘Æ°á»£c gá»i lÃ  <em>bounded parametric polymorphism</em>.</p>
</section>
<p>Inheritance gáº§n Ä‘Ã¢y Ä‘Ã£ dáº§n máº¥t Ä‘i sá»± Æ°a chuá»™ng nhÆ° má»™t giáº£i phÃ¡p thiáº¿t káº¿ trong nhiá»u
ngÃ´n ngá»¯ láº­p trÃ¬nh, bá»Ÿi vÃ¬ nÃ³ thÆ°á»ng cÃ³ nguy cÆ¡ chia sáº» nhiá»u mÃ£ hÆ¡n má»©c cáº§n thiáº¿t.
CÃ¡c lá»›p con khÃ´ng pháº£i lÃºc nÃ o cÅ©ng nÃªn chia sáº» toÃ n bá»™ Ä‘áº·c Ä‘iá»ƒm cá»§a lá»›p cha,
nhÆ°ng inheritance láº¡i buá»™c chÃºng pháº£i lÃ m váº­y. Äiá»u nÃ y cÃ³ thá»ƒ khiáº¿n thiáº¿t káº¿ cá»§a
chÆ°Æ¡ng trÃ¬nh kÃ©m linh hoáº¡t hÆ¡n. NÃ³ cÅ©ng táº¡o ra kháº£ nÄƒng gá»i cÃ¡c method trÃªn lá»›p con
mÃ  khÃ´ng há»£p lÃ½, hoáº·c gÃ¢y lá»—i vÃ¬ cÃ¡c method Ä‘Ã³ khÃ´ng Ã¡p dá»¥ng cho lá»›p con.
NgoÃ i ra, má»™t sá»‘ ngÃ´n ngá»¯ chá»‰ cho phÃ©p Ä‘Æ¡n káº¿ thá»«a (single inheritance),
nghÄ©a lÃ  má»™t lá»›p con chá»‰ cÃ³ thá»ƒ káº¿ thá»«a tá»« má»™t lá»›p duy nháº¥t, Ä‘iá»u nÃ y cÃ ng
háº¡n cháº¿ thÃªm tÃ­nh linh hoáº¡t cá»§a thiáº¿t káº¿ chÆ°Æ¡ng trÃ¬nh.</p>
<p>VÃ¬ nhá»¯ng lÃ½ do Ä‘Ã³, Rust chá»n má»™t hÆ°á»›ng tiáº¿p cáº­n khÃ¡c lÃ  sá»­ dá»¥ng <em>trait objects</em>
thay vÃ¬ inheritance. HÃ£y cÃ¹ng xem trait objects cho phÃ©p polymorphism trong Rust nhÆ° tháº¿ nÃ o.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="using-trait-objects-that-allow-for-values-of-different-types"><a class="header" href="#using-trait-objects-that-allow-for-values-of-different-types">Using Trait Objects That Allow for Values of Different Types</a></h2>
<p>Trong ChÆ°Æ¡ng 8, chÃºng ta Ä‘Ã£ Ä‘á» cáº­p ráº±ng má»™t háº¡n cháº¿ cá»§a vector lÃ  chÃºng chá»‰ cÃ³ thá»ƒ
lÆ°u trá»¯ cÃ¡c pháº§n tá»­ cá»§a má»™t kiá»ƒu duy nháº¥t. ChÃºng ta Ä‘Ã£ táº¡o má»™t cÃ¡ch Ğ¾Ğ±Ñ…Ğ¾Ğ´
(workaround) trong Listing 8-9 báº±ng cÃ¡ch Ä‘á»‹nh nghÄ©a má»™t enum <code>SpreadsheetCell</code>
vá»›i cÃ¡c biáº¿n thá»ƒ Ä‘á»ƒ chá»©a sá»‘ nguyÃªn, sá»‘ thá»±c vÃ  vÄƒn báº£n. Äiá»u nÃ y cho phÃ©p chÃºng ta
lÆ°u trá»¯ cÃ¡c kiá»ƒu dá»¯ liá»‡u khÃ¡c nhau trong má»—i Ã´ vÃ  váº«n cÃ³ má»™t vector Ä‘áº¡i diá»‡n cho
má»™t hÃ ng cÃ¡c Ã´. ÄÃ¢y lÃ  má»™t giáº£i phÃ¡p hoÃ n toÃ n phÃ¹ há»£p khi cÃ¡c pháº§n tá»­ cÃ³ thá»ƒ thay
tháº¿ cho nhau cá»§a chÃºng ta thuá»™c vá» má»™t táº­p kiá»ƒu cá»‘ Ä‘á»‹nh mÃ  ta biáº¿t táº¡i thá»i Ä‘iá»ƒm
biÃªn dá»‹ch.</p>
<p>Tuy nhiÃªn, Ä‘Ã´i khi chÃºng ta muá»‘n ngÆ°á»i dÃ¹ng thÆ° viá»‡n cÃ³ thá»ƒ má»Ÿ rá»™ng táº­p cÃ¡c kiá»ƒu
há»£p lá»‡ trong má»™t tÃ¬nh huá»‘ng cá»¥ thá»ƒ. Äá»ƒ minh há»a cÃ¡ch Ä‘áº¡t Ä‘Æ°á»£c Ä‘iá»u nÃ y, chÃºng ta sáº½
táº¡o má»™t vÃ­ dá»¥ vá» cÃ´ng cá»¥ giao diá»‡n ngÆ°á»i dÃ¹ng Ä‘á»“ há»a (GUI) láº·p qua má»™t danh sÃ¡ch
cÃ¡c má»¥c vÃ  gá»i má»™t phÆ°Æ¡ng thá»©c <code>draw</code> trÃªn má»—i má»¥c Ä‘á»ƒ váº½ nÃ³ lÃªn mÃ n hÃ¬nh â€” má»™t ká»¹
thuáº­t phá»• biáº¿n trong cÃ¡c cÃ´ng cá»¥ GUI. ChÃºng ta sáº½ táº¡o má»™t library crate cÃ³ tÃªn lÃ 
<code>gui</code>, chá»©a cáº¥u trÃºc cá»§a má»™t thÆ° viá»‡n GUI. Crate nÃ y cÃ³ thá»ƒ bao gá»“m má»™t sá»‘ kiá»ƒu Ä‘á»ƒ
má»i ngÆ°á»i sá»­ dá»¥ng, cháº³ng háº¡n nhÆ° <code>Button</code> hoáº·c <code>TextField</code>. NgoÃ i ra, ngÆ°á»i dÃ¹ng
<code>gui</code> cÅ©ng sáº½ muá»‘n táº¡o cÃ¡c kiá»ƒu riÃªng cá»§a há» cÃ³ thá»ƒ Ä‘Æ°á»£c váº½: vÃ­ dá»¥, má»™t láº­p trÃ¬nh
viÃªn cÃ³ thá»ƒ thÃªm <code>Image</code> vÃ  má»™t ngÆ°á»i khÃ¡c cÃ³ thá»ƒ thÃªm <code>SelectBox</code>.</p>
<p>ChÃºng ta sáº½ khÃ´ng triá»ƒn khai má»™t thÆ° viá»‡n GUI Ä‘áº§y Ä‘á»§ cho vÃ­ dá»¥ nÃ y, mÃ  chá»‰ cho tháº¥y
cÃ¡ch cÃ¡c máº£nh ghÃ©p sáº½ káº¿t há»£p vá»›i nhau nhÆ° tháº¿ nÃ o. Táº¡i thá»i Ä‘iá»ƒm viáº¿t thÆ° viá»‡n,
chÃºng ta khÃ´ng thá»ƒ biáº¿t trÆ°á»›c vÃ  Ä‘á»‹nh nghÄ©a táº¥t cáº£ cÃ¡c kiá»ƒu mÃ  nhá»¯ng láº­p trÃ¬nh
viÃªn khÃ¡c cÃ³ thá»ƒ muá»‘n táº¡o ra. NhÆ°ng chÃºng ta biáº¿t ráº±ng <code>gui</code> cáº§n theo dÃµi nhiá»u giÃ¡
trá»‹ thuá»™c cÃ¡c kiá»ƒu khÃ¡c nhau, vÃ  nÃ³ cáº§n gá»i má»™t phÆ°Æ¡ng thá»©c <code>draw</code> trÃªn má»—i giÃ¡ trá»‹
cÃ³ kiá»ƒu khÃ¡c nhau Ä‘Ã³. NÃ³ khÃ´ng cáº§n biáº¿t chÃ­nh xÃ¡c Ä‘iá»u gÃ¬ sáº½ xáº£y ra khi gá»i phÆ°Æ¡ng
thá»©c <code>draw</code>, chá»‰ cáº§n biáº¿t ráº±ng giÃ¡ trá»‹ Ä‘Ã³ cÃ³ sáºµn phÆ°Æ¡ng thá»©c nÃ y Ä‘á»ƒ chÃºng ta gá»i.</p>
<p>Äá»ƒ lÃ m Ä‘iá»u nÃ y trong má»™t ngÃ´n ngá»¯ cÃ³ inheritance, chÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a má»™t
class tÃªn lÃ  <code>Component</code> cÃ³ má»™t phÆ°Æ¡ng thá»©c tÃªn lÃ  <code>draw</code>. CÃ¡c class khÃ¡c, cháº³ng
háº¡n nhÆ° <code>Button</code>, <code>Image</code> vÃ  <code>SelectBox</code>, sáº½ káº¿ thá»«a tá»« <code>Component</code> vÃ  do Ä‘Ã³ káº¿ thá»«a
phÆ°Æ¡ng thá»©c <code>draw</code>. Má»—i class cÃ³ thá»ƒ ghi Ä‘Ã¨ phÆ°Æ¡ng thá»©c <code>draw</code> Ä‘á»ƒ Ä‘á»‹nh nghÄ©a hÃ nh vi
riÃªng cá»§a mÃ¬nh, nhÆ°ng framework cÃ³ thá»ƒ Ä‘á»‘i xá»­ vá»›i táº¥t cáº£ cÃ¡c kiá»ƒu Ä‘Ã³ nhÆ° thá»ƒ chÃºng
lÃ  cÃ¡c instance cá»§a <code>Component</code> vÃ  gá»i <code>draw</code> trÃªn chÃºng. NhÆ°ng vÃ¬ Rust khÃ´ng cÃ³
inheritance, chÃºng ta cáº§n má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ cáº¥u trÃºc thÆ° viá»‡n <code>gui</code> sao cho cho phÃ©p
ngÆ°á»i dÃ¹ng má»Ÿ rá»™ng nÃ³ báº±ng cÃ¡c kiá»ƒu má»›i.</p>
<h3 id="defining-a-trait-for-common-behavior"><a class="header" href="#defining-a-trait-for-common-behavior">Defining a Trait for Common Behavior</a></h3>
<p>Äá»ƒ triá»ƒn khai hÃ nh vi mÃ  chÃºng ta muá»‘n <code>gui</code> cÃ³, chÃºng ta sáº½ Ä‘á»‹nh nghÄ©a má»™t trait
tÃªn lÃ  <code>Draw</code> vá»›i má»™t phÆ°Æ¡ng thá»©c duy nháº¥t lÃ  <code>draw</code>. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh
nghÄ©a má»™t vector nháº­n vÃ o má»™t <em>trait object</em>. Má»™t trait object trá» tá»›i cáº£ má»™t
instance cá»§a má»™t kiá»ƒu triá»ƒn khai trait Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh vÃ  má»™t báº£ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ tra
cá»©u cÃ¡c phÆ°Æ¡ng thá»©c cá»§a trait Ä‘Ã³ táº¡i runtime. ChÃºng ta táº¡o má»™t trait object báº±ng
cÃ¡ch chá»‰ Ä‘á»‹nh má»™t dáº¡ng con trá» nÃ o Ä‘Ã³, cháº³ng háº¡n nhÆ° má»™t tham chiáº¿u <code>&amp;</code> hoáº·c má»™t
smart pointer <code>Box&lt;T&gt;</code>, sau Ä‘Ã³ lÃ  tá»« khÃ³a <code>dyn</code>, rá»“i chá»‰ Ä‘á»‹nh trait tÆ°Æ¡ng á»©ng.
(ChÃºng ta sáº½ nÃ³i vá» lÃ½ do táº¡i sao trait objects pháº£i sá»­ dá»¥ng con trá» trong ChÆ°Æ¡ng
19, á»Ÿ má»¥c <a href="ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait">â€œDynamically Sized Types and the <code>Sized</code> Trait.â€</a></p>
<!-- ignore -->) ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng trait objects thay cho generic hoáº·c kiá»ƒu
<p>cá»¥ thá»ƒ. á» báº¥t ká»³ Ä‘Ã¢u chÃºng ta sá»­ dá»¥ng trait object, há»‡ thá»‘ng kiá»ƒu cá»§a Rust sáº½ Ä‘áº£m
báº£o táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch ráº±ng má»i giÃ¡ trá»‹ Ä‘Æ°á»£c dÃ¹ng trong ngá»¯ cáº£nh Ä‘Ã³ Ä‘á»u triá»ƒn
khai trait cá»§a trait object. Do Ä‘Ã³, chÃºng ta khÃ´ng cáº§n pháº£i biáº¿t trÆ°á»›c táº¥t cáº£ cÃ¡c
kiá»ƒu kháº£ dÄ© táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch.</p>
<p>ChÃºng ta Ä‘Ã£ Ä‘á» cáº­p ráº±ng trong Rust, chÃºng ta trÃ¡nh gá»i struct vÃ  enum lÃ  â€œobjectâ€
Ä‘á»ƒ phÃ¢n biá»‡t chÃºng vá»›i object trong cÃ¡c ngÃ´n ngá»¯ khÃ¡c. Trong má»™t struct hoáº·c enum,
dá»¯ liá»‡u trong cÃ¡c field vÃ  hÃ nh vi trong cÃ¡c khá»‘i <code>impl</code> Ä‘Æ°á»£c tÃ¡ch biá»‡t, trong khi
á»Ÿ cÃ¡c ngÃ´n ngá»¯ khÃ¡c, dá»¯ liá»‡u vÃ  hÃ nh vi Ä‘Æ°á»£c káº¿t há»£p thÃ nh má»™t khÃ¡i niá»‡m duy nháº¥t
thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  object. Tuy nhiÃªn, trait objects <em>thá»±c sá»±</em> giá»‘ng vá»›i object
trong cÃ¡c ngÃ´n ngá»¯ khÃ¡c á»Ÿ chá»— chÃºng káº¿t há»£p cáº£ dá»¯ liá»‡u vÃ  hÃ nh vi. NhÆ°ng trait
objects khÃ¡c vá»›i object truyá»n thá»‘ng á»Ÿ Ä‘iá»ƒm lÃ  chÃºng ta khÃ´ng thá»ƒ thÃªm dá»¯ liá»‡u vÃ o
má»™t trait object. Trait objects khÃ´ng há»¯u dá»¥ng má»™t cÃ¡ch tá»•ng quÃ¡t nhÆ° object trong
cÃ¡c ngÃ´n ngá»¯ khÃ¡c: má»¥c Ä‘Ã­ch cá»¥ thá»ƒ cá»§a chÃºng lÃ  cho phÃ©p trá»«u tÆ°á»£ng hÃ³a trÃªn cÃ¡c
hÃ nh vi chung.</p>
<p>Listing 17-3 cho tháº¥y cÃ¡ch Ä‘á»‹nh nghÄ©a má»™t trait tÃªn lÃ  <code>Draw</code> vá»›i má»™t phÆ°Æ¡ng thá»©c
tÃªn lÃ  <code>draw</code>:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-03/src/lib.rs}}</code></pre>
<p><span class="caption">Listing 17-3: Definition of the <code>Draw</code> trait</span></p>
<p>CÃº phÃ¡p nÃ y háº³n sáº½ trÃ´ng quen thuá»™c tá»« nhá»¯ng tháº£o luáº­n cá»§a chÃºng ta vá» cÃ¡ch Ä‘á»‹nh
nghÄ©a trait trong ChÆ°Æ¡ng 10. Tiáº¿p theo lÃ  má»™t sá»‘ cÃº phÃ¡p má»›i: Listing 17-4 Ä‘á»‹nh
nghÄ©a má»™t struct tÃªn lÃ  <code>Screen</code>, struct nÃ y chá»©a má»™t vector cÃ³ tÃªn lÃ 
<code>components</code>. Vector nÃ y cÃ³ kiá»ƒu <code>Box&lt;dyn Draw&gt;</code>, tá»©c lÃ  má»™t trait object; nÃ³
Ä‘Ã³ng vai trÃ² nhÆ° má»™t Ä‘áº¡i diá»‡n (stand-in) cho báº¥t ká»³ kiá»ƒu nÃ o Ä‘Æ°á»£c Ä‘áº·t trong má»™t
<code>Box</code> mÃ  triá»ƒn khai trait <code>Draw</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-04/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-4: Definition of the <code>Screen</code> struct with a
<code>components</code> field holding a vector of trait objects that implement the <code>Draw</code>
trait</span></p>
<p>TrÃªn struct <code>Screen</code>, chÃºng ta sáº½ Ä‘á»‹nh nghÄ©a má»™t phÆ°Æ¡ng thá»©c cÃ³ tÃªn lÃ  <code>run</code>,
phÆ°Æ¡ng thá»©c nÃ y sáº½ gá»i phÆ°Æ¡ng thá»©c <code>draw</code> trÃªn tá»«ng pháº§n tá»­ trong <code>components</code>
cá»§a nÃ³, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 17-5:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-05/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-5: A <code>run</code> method on <code>Screen</code> that calls the
<code>draw</code> method on each component</span></p>
<p>CÃ¡ch nÃ y hoáº¡t Ä‘á»™ng khÃ¡c vá»›i viá»‡c Ä‘á»‹nh nghÄ©a má»™t struct sá»­ dá»¥ng tham sá»‘ kiá»ƒu
generic kÃ¨m theo trait bound. Má»™t tham sá»‘ kiá»ƒu generic chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c thay tháº¿
báº±ng má»™t kiá»ƒu cá»¥ thá»ƒ táº¡i má»™t thá»i Ä‘iá»ƒm, trong khi trait objects cho phÃ©p
nhiá»u kiá»ƒu cá»¥ thá»ƒ khÃ¡c nhau Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ thay tháº¿ cho trait object táº¡i runtime.
VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ Ä‘Ã£ Ä‘á»‹nh nghÄ©a struct <code>Screen</code> báº±ng cÃ¡ch sá»­ dá»¥ng má»™t kiá»ƒu
generic vÃ  má»™t trait bound nhÆ° trong Listing 17-6:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-06/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-6: An alternate implementation of the <code>Screen</code>
struct and its <code>run</code> method using generics and trait bounds</span></p>
<p>CÃ¡ch nÃ y giá»›i háº¡n chÃºng ta á»Ÿ má»™t instance cá»§a <code>Screen</code> mÃ  trong Ä‘Ã³ danh sÃ¡ch
cÃ¡c component Ä‘á»u cÃ³ cÃ¹ng má»™t kiá»ƒu, vÃ­ dá»¥ táº¥t cáº£ Ä‘á»u lÃ  <code>Button</code> hoáº·c táº¥t cáº£
Ä‘á»u lÃ  <code>TextField</code>. Náº¿u báº¡n chá»‰ bao giá» lÃ m viá»‡c vá»›i cÃ¡c collection Ä‘á»“ng nháº¥t
(homogeneous), thÃ¬ viá»‡c sá»­ dá»¥ng generics vÃ  trait bounds lÃ  lá»±a chá»n tá»‘t hÆ¡n,
bá»Ÿi vÃ¬ cÃ¡c Ä‘á»‹nh nghÄ©a nÃ y sáº½ Ä‘Æ°á»£c monomorphize táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch Ä‘á»ƒ sá»­
dá»¥ng cÃ¡c kiá»ƒu cá»¥ thá»ƒ.</p>
<p>NgÆ°á»£c láº¡i, vá»›i phÆ°Æ¡ng thá»©c sá»­ dá»¥ng trait objects, má»™t instance cá»§a <code>Screen</code>
cÃ³ thá»ƒ chá»©a má»™t <code>Vec&lt;T&gt;</code> bao gá»“m cáº£ <code>Box&lt;Button&gt;</code> láº«n <code>Box&lt;TextField&gt;</code>. HÃ£y cÃ¹ng
xem cÃ¡ch cÆ¡ cháº¿ nÃ y hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o, sau Ä‘Ã³ chÃºng ta sáº½ bÃ n vá» cÃ¡c áº£nh
hÆ°á»Ÿng tá»›i hiá»‡u nÄƒng táº¡i runtime.</p>
<h3 id="implementing-the-trait"><a class="header" href="#implementing-the-trait">Implementing the Trait</a></h3>
<p>BÃ¢y giá» chÃºng ta sáº½ thÃªm má»™t sá»‘ kiá»ƒu triá»ƒn khai trait <code>Draw</code>. ChÃºng ta sáº½ cung
cáº¥p kiá»ƒu <code>Button</code>. Má»™t láº§n ná»¯a, viá»‡c triá»ƒn khai Ä‘áº§y Ä‘á»§ má»™t thÆ° viá»‡n GUI náº±m ngoÃ i
pháº¡m vi cá»§a cuá»‘n sÃ¡ch nÃ y, vÃ¬ váº­y phÆ°Æ¡ng thá»©c <code>draw</code> sáº½ khÃ´ng cÃ³ pháº§n cÃ i Ä‘áº·t
há»¯u Ã­ch nÃ o trong thÃ¢n cá»§a nÃ³. Äá»ƒ hÃ¬nh dung phÆ°Æ¡ng thá»©c nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c cÃ i Ä‘áº·t
nhÆ° tháº¿ nÃ o, má»™t struct <code>Button</code> cÃ³ thá»ƒ cÃ³ cÃ¡c field nhÆ° <code>width</code>, <code>height</code> vÃ 
<code>label</code>, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 17-7:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-07/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-7: A <code>Button</code> struct that implements the
<code>Draw</code> trait</span></p>
<p>CÃ¡c field <code>width</code>, <code>height</code> vÃ  <code>label</code> cá»§a <code>Button</code> sáº½ khÃ¡c vá»›i cÃ¡c field cá»§a
nhá»¯ng component khÃ¡c; vÃ­ dá»¥, má»™t kiá»ƒu <code>TextField</code> cÃ³ thá»ƒ cÃ³ cÃ¡c field giá»‘ng váº­y
vÃ  thÃªm má»™t field <code>placeholder</code>. Má»—i kiá»ƒu mÃ  chÃºng ta muá»‘n váº½ lÃªn mÃ n hÃ¬nh Ä‘á»u
sáº½ triá»ƒn khai trait <code>Draw</code>, nhÆ°ng sáº½ sá»­ dá»¥ng cÃ¡c Ä‘oáº¡n mÃ£ khÃ¡c nhau trong phÆ°Æ¡ng
thá»©c <code>draw</code> Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cÃ¡ch váº½ cho kiá»ƒu cá»¥ thá»ƒ Ä‘Ã³, nhÆ° cÃ¡ch <code>Button</code> Ä‘Ã£ lÃ m
á»Ÿ Ä‘Ã¢y (khÃ´ng bao gá»“m mÃ£ GUI thá»±c táº¿, nhÆ° Ä‘Ã£ Ä‘á» cáº­p). VÃ­ dá»¥, kiá»ƒu <code>Button</code> cÃ³ thá»ƒ
cÃ³ thÃªm má»™t khá»‘i <code>impl</code> bá»• sung chá»©a cÃ¡c phÆ°Æ¡ng thá»©c liÃªn quan Ä‘áº¿n viá»‡c Ä‘iá»u gÃ¬
xáº£y ra khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt. Nhá»¯ng loáº¡i phÆ°Æ¡ng thá»©c nÃ y sáº½ khÃ´ng Ã¡p dá»¥ng
cho cÃ¡c kiá»ƒu nhÆ° <code>TextField</code>.</p>
<p>Náº¿u má»™t ngÆ°á»i sá»­ dá»¥ng thÆ° viá»‡n cá»§a chÃºng ta quyáº¿t Ä‘á»‹nh triá»ƒn khai má»™t struct
<code>SelectBox</code> cÃ³ cÃ¡c field <code>width</code>, <code>height</code> vÃ  <code>options</code>, thÃ¬ há» cÅ©ng sáº½ triá»ƒn
khai trait <code>Draw</code> cho kiá»ƒu <code>SelectBox</code>, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 17-8:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch17-oop/listing-17-08/src/main.rs:here}}</code></pre>
<p><span class="caption">Listing 17-8: Another crate using <code>gui</code> and implementing
the <code>Draw</code> trait on a <code>SelectBox</code> struct</span></p>
<p>NgÆ°á»i dÃ¹ng thÆ° viá»‡n cá»§a chÃºng ta giá» Ä‘Ã¢y cÃ³ thá»ƒ viáº¿t hÃ m <code>main</code> cá»§a há» Ä‘á»ƒ táº¡o
má»™t instance cá»§a <code>Screen</code>. Vá»›i instance <code>Screen</code> nÃ y, há» cÃ³ thá»ƒ thÃªm má»™t
<code>SelectBox</code> vÃ  má»™t <code>Button</code> báº±ng cÃ¡ch Ä‘áº·t má»—i component vÃ o má»™t <code>Box&lt;T&gt;</code> Ä‘á»ƒ
trá»Ÿ thÃ nh má»™t trait object. Sau Ä‘Ã³, há» cÃ³ thá»ƒ gá»i phÆ°Æ¡ng thá»©c <code>run</code> trÃªn
instance <code>Screen</code>, phÆ°Æ¡ng thá»©c nÃ y sáº½ gá»i <code>draw</code> trÃªn tá»«ng component.
Listing 17-9 minh há»a cÃ¡ch cÃ i Ä‘áº·t nÃ y:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch17-oop/listing-17-09/src/main.rs:here}}</code></pre>
<p><span class="caption">Listing 17-9: Using trait objects to store values of
different types that implement the same trait</span></p>
<p>Khi chÃºng ta viáº¿t thÆ° viá»‡n, chÃºng ta khÃ´ng biáº¿t ráº±ng sáº½ cÃ³ ngÆ°á»i thÃªm kiá»ƒu
<code>SelectBox</code>, nhÆ°ng pháº§n cÃ i Ä‘áº·t <code>Screen</code> cá»§a chÃºng ta váº«n cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng vá»›i
kiá»ƒu má»›i nÃ y vÃ  váº½ nÃ³, bá»Ÿi vÃ¬ <code>SelectBox</code> triá»ƒn khai trait <code>Draw</code>, nghÄ©a lÃ  nÃ³
triá»ƒn khai phÆ°Æ¡ng thá»©c <code>draw</code>.</p>
<p>KhÃ¡i niá»‡m nÃ y â€” chá»‰ quan tÃ¢m Ä‘áº¿n cÃ¡c â€œthÃ´ng Ä‘iá»‡pâ€ (message) mÃ  má»™t giÃ¡ trá»‹ cÃ³
thá»ƒ pháº£n há»“i, thay vÃ¬ kiá»ƒu cá»¥ thá»ƒ cá»§a giÃ¡ trá»‹ Ä‘Ã³ â€” tÆ°Æ¡ng tá»± vá»›i khÃ¡i niá»‡m <em>duck
typing</em> trong cÃ¡c ngÃ´n ngá»¯ kiá»ƒu Ä‘á»™ng: náº¿u nÃ³ Ä‘i nhÆ° vá»‹t vÃ  kÃªu nhÆ° vá»‹t, thÃ¬ nÃ³
cháº¯c háº³n lÃ  vá»‹t! Trong pháº§n cÃ i Ä‘áº·t <code>run</code> cá»§a <code>Screen</code> á»Ÿ Listing 17-5, <code>run</code>
khÃ´ng cáº§n biáº¿t kiá»ƒu cá»¥ thá»ƒ cá»§a tá»«ng component lÃ  gÃ¬. NÃ³ khÃ´ng kiá»ƒm tra xem má»™t
component cÃ³ pháº£i lÃ  instance cá»§a <code>Button</code> hay <code>SelectBox</code> hay khÃ´ng, mÃ  chá»‰
Ä‘Æ¡n giáº£n gá»i phÆ°Æ¡ng thá»©c <code>draw</code> trÃªn component Ä‘Ã³. Báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh
<code>Box&lt;dyn Draw&gt;</code> lÃ m kiá»ƒu cá»§a cÃ¡c giÃ¡ trá»‹ trong vector <code>components</code>, chÃºng ta Ä‘Ã£
Ä‘á»‹nh nghÄ©a ráº±ng <code>Screen</code> cáº§n nhá»¯ng giÃ¡ trá»‹ mÃ  chÃºng ta cÃ³ thá»ƒ gá»i Ä‘Æ°á»£c phÆ°Æ¡ng
thá»©c <code>draw</code> trÃªn chÃºng.</p>
<p>Æ¯u Ä‘iá»ƒm cá»§a viá»‡c sá»­ dá»¥ng trait objects cÃ¹ng vá»›i há»‡ thá»‘ng kiá»ƒu cá»§a Rust Ä‘á»ƒ viáº¿t
mÃ£ tÆ°Æ¡ng tá»± nhÆ° mÃ£ sá»­ dá»¥ng duck typing lÃ  chÃºng ta khÃ´ng bao giá» pháº£i kiá»ƒm tra
táº¡i runtime xem má»™t giÃ¡ trá»‹ cÃ³ triá»ƒn khai má»™t phÆ°Æ¡ng thá»©c cá»¥ thá»ƒ hay khÃ´ng, cÅ©ng
khÃ´ng pháº£i lo láº¯ng vá» viá»‡c gáº·p lá»—i khi gá»i má»™t phÆ°Æ¡ng thá»©c mÃ  giÃ¡ trá»‹ Ä‘Ã³ khÃ´ng
triá»ƒn khai. Rust sáº½ khÃ´ng biÃªn dá»‹ch mÃ£ cá»§a chÃºng ta náº¿u cÃ¡c giÃ¡ trá»‹ khÃ´ng triá»ƒn
khai cÃ¡c trait mÃ  trait object yÃªu cáº§u.</p>
<p>VÃ­ dá»¥, Listing 17-10 cho tháº¥y Ä‘iá»u gÃ¬ sáº½ xáº£y ra náº¿u chÃºng ta cá»‘ gáº¯ng táº¡o má»™t
<code>Screen</code> vá»›i má»™t <code>String</code> lÃ m component:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch17-oop/listing-17-10/src/main.rs}}</code></pre>
<p><span class="caption">Listing 17-10: Attempting to use a type that doesnâ€™t
implement the trait objectâ€™s trait</span></p>
<p>ChÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i nÃ y bá»Ÿi vÃ¬ <code>String</code> khÃ´ng triá»ƒn khai trait <code>Draw</code>:</p>
<pre><code class="language-console">{{#include ../listings/ch17-oop/listing-17-10/output.txt}}
</code></pre>
<p>Lá»—i nÃ y cho chÃºng ta biáº¿t ráº±ng hoáº·c lÃ  chÃºng ta Ä‘ang truyá»n má»™t giÃ¡ trá»‹ vÃ o
<code>Screen</code> mÃ  khÃ´ng Ä‘Ãºng dá»± Ä‘á»‹nh vÃ  nÃªn truyá»n má»™t kiá»ƒu khÃ¡c, hoáº·c chÃºng ta
nÃªn triá»ƒn khai trait <code>Draw</code> trÃªn <code>String</code> Ä‘á»ƒ <code>Screen</code> cÃ³ thá»ƒ gá»i <code>draw</code>
trÃªn nÃ³.</p>
<h3 id="trait-objects-perform-dynamic-dispatch"><a class="header" href="#trait-objects-perform-dynamic-dispatch">Trait Objects Perform Dynamic Dispatch</a></h3>
<p>HÃ£y nhá»› láº¡i trong má»¥c <a href="ch10-01-syntax.html#performance-of-code-using-generics">â€œPerformance of Code Using
Genericsâ€</a><!-- ignore --> á»Ÿ ChÆ°Æ¡ng 10
khi chÃºng ta tháº£o luáº­n vá» quÃ¡ trÃ¬nh monomorphization do compiler thá»±c hiá»‡n
khi sá»­ dá»¥ng trait bounds trÃªn generic: compiler sáº½ sinh ra cÃ¡c triá»ƒn khai
khÃ´ng-generic cá»§a cÃ¡c hÃ m vÃ  phÆ°Æ¡ng thá»©c cho tá»«ng kiá»ƒu cá»¥ thá»ƒ mÃ  chÃºng ta
sá»­ dá»¥ng thay cho tham sá»‘ kiá»ƒu generic. MÃ£ káº¿t quáº£ tá»« monomorphization
sá»­ dá»¥ng <em>static dispatch</em>, tá»©c lÃ  compiler biáº¿t chÃ­nh xÃ¡c phÆ°Æ¡ng thá»©c
báº¡n Ä‘ang gá»i táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch. NgÆ°á»£c láº¡i, <em>dynamic dispatch</em>
xáº£y ra khi compiler khÃ´ng thá»ƒ biáº¿t trÆ°á»›c phÆ°Æ¡ng thá»©c nÃ o sáº½ Ä‘Æ°á»£c gá»i
táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch. Trong trÆ°á»ng há»£p dynamic dispatch, compiler
sáº½ sinh ra mÃ£ sao cho táº¡i runtime sáº½ xÃ¡c Ä‘á»‹nh phÆ°Æ¡ng thá»©c nÃ o cáº§n gá»i.</p>
<p>Khi chÃºng ta sá»­ dá»¥ng trait objects, Rust buá»™c pháº£i dÃ¹ng dynamic dispatch.
Compiler khÃ´ng biáº¿t trÆ°á»›c táº¥t cáº£ cÃ¡c kiá»ƒu cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i mÃ£
sá»­ dá»¥ng trait objects, vÃ¬ váº­y nÃ³ khÃ´ng biáº¿t nÃªn gá»i phÆ°Æ¡ng thá»©c nÃ o Ä‘Æ°á»£c
triá»ƒn khai trÃªn kiá»ƒu nÃ o. Thay vÃ o Ä‘Ã³, táº¡i runtime, Rust sá»­ dá»¥ng cÃ¡c
con trá» bÃªn trong trait object Ä‘á»ƒ biáº¿t phÆ°Æ¡ng thá»©c nÃ o cáº§n gá»i. Viá»‡c tra
cá»©u nÃ y gÃ¢y ra chi phÃ­ táº¡i runtime mÃ  static dispatch khÃ´ng cÃ³. Dynamic
dispatch cÅ©ng ngÄƒn compiler chá»n viá»‡c inline mÃ£ cá»§a phÆ°Æ¡ng thá»©c, tá»« Ä‘Ã³
cáº£n trá»Ÿ má»™t sá»‘ tá»‘i Æ°u hÃ³a. Tuy nhiÃªn, chÃºng ta cÃ³ Ä‘Æ°á»£c sá»± linh hoáº¡t
bá»• sung trong mÃ£ mÃ  chÃºng ta viáº¿t á»Ÿ Listing 17-5 vÃ  há»— trá»£ trong
Listing 17-9, nÃªn Ä‘Ã¢y lÃ  má»™t sá»± Ä‘Ã¡nh Ä‘á»•i cáº§n cÃ¢n nháº¯c.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="implementing-an-object-oriented-design-pattern"><a class="header" href="#implementing-an-object-oriented-design-pattern">Implementing an Object-Oriented Design Pattern</a></h2>
<p><em>State pattern</em> lÃ  má»™t máº«u thiáº¿t káº¿ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (object-oriented design
pattern). Cá»‘t lÃµi cá»§a máº«u thiáº¿t káº¿ nÃ y lÃ  chÃºng ta Ä‘á»‹nh nghÄ©a má»™t táº­p há»£p
cÃ¡c tráº¡ng thÃ¡i mÃ  má»™t giÃ¡ trá»‹ cÃ³ thá»ƒ cÃ³ bÃªn trong. CÃ¡c tráº¡ng thÃ¡i Ä‘Æ°á»£c
biá»ƒu diá»…n báº±ng má»™t táº­p há»£p cÃ¡c <em>state objects</em>, vÃ  hÃ nh vi cá»§a giÃ¡ trá»‹ thay
Ä‘á»•i dá»±a trÃªn tráº¡ng thÃ¡i cá»§a nÃ³. ChÃºng ta sáº½ lÃ m vÃ­ dá»¥ vá»›i má»™t struct
blog post cÃ³ má»™t field Ä‘á»ƒ giá»¯ tráº¡ng thÃ¡i, Ä‘Ã¢y sáº½ lÃ  má»™t state object tá»«
táº­p há»£p â€œdraftâ€, â€œreviewâ€ hoáº·c â€œpublishedâ€.</p>
<p>CÃ¡c state object chia sáº» chá»©c nÄƒng: trong Rust, táº¥t nhiÃªn, chÃºng ta sá»­ dá»¥ng
struct vÃ  trait thay vÃ¬ objects vÃ  inheritance. Má»—i state object chá»‹u trÃ¡ch
nhiá»‡m cho hÃ nh vi riÃªng cá»§a nÃ³ vÃ  quyáº¿t Ä‘á»‹nh khi nÃ o nÃ³ nÃªn chuyá»ƒn sang
tráº¡ng thÃ¡i khÃ¡c. GiÃ¡ trá»‹ giá»¯ state object khÃ´ng biáº¿t gÃ¬ vá» cÃ¡c hÃ nh vi
khÃ¡c nhau cá»§a cÃ¡c tráº¡ng thÃ¡i hoáº·c khi nÃ o cáº§n chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c tráº¡ng thÃ¡i.</p>
<p>Æ¯u Ä‘iá»ƒm cá»§a viá»‡c sá»­ dá»¥ng state pattern lÃ , khi yÃªu cáº§u nghiá»‡p vá»¥ cá»§a chÆ°Æ¡ng
trÃ¬nh thay Ä‘á»•i, chÃºng ta sáº½ khÃ´ng cáº§n thay Ä‘á»•i mÃ£ cá»§a giÃ¡ trá»‹ giá»¯ tráº¡ng
thÃ¡i hoáº·c mÃ£ sá»­ dá»¥ng giÃ¡ trá»‹ Ä‘Ã³. ChÃºng ta chá»‰ cáº§n cáº­p nháº­t mÃ£ bÃªn trong
má»™t state object Ä‘á»ƒ thay Ä‘á»•i quy táº¯c cá»§a nÃ³ hoáº·c thÃªm nhiá»u state object
má»›i.</p>
<p>Äáº§u tiÃªn, chÃºng ta sáº½ triá»ƒn khai state pattern theo cÃ¡ch hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng
truyá»n thá»‘ng hÆ¡n, sau Ä‘Ã³ sáº½ dÃ¹ng cÃ¡ch tiáº¿p cáº­n tá»± nhiÃªn hÆ¡n trong Rust.
HÃ£y cÃ¹ng thá»±c hiá»‡n dáº§n dáº§n workflow cho blog post sá»­ dá»¥ng state pattern.</p>
<p>Chá»©c nÄƒng cuá»‘i cÃ¹ng sáº½ trÃ´ng nhÆ° sau:</p>
<ol>
<li>Má»™t blog post báº¯t Ä‘áº§u nhÆ° má»™t draft rá»—ng.</li>
<li>Khi draft hoÃ n táº¥t, yÃªu cáº§u review bÃ i post.</li>
<li>Khi bÃ i post Ä‘Æ°á»£c phÃª duyá»‡t, nÃ³ sáº½ Ä‘Æ°á»£c xuáº¥t báº£n (published).</li>
<li>Chá»‰ cÃ¡c blog post Ä‘Ã£ published má»›i tráº£ vá» ná»™i dung Ä‘á»ƒ in, nÃªn cÃ¡c post
chÆ°a Ä‘Æ°á»£c phÃª duyá»‡t khÃ´ng thá»ƒ vÃ´ tÃ¬nh Ä‘Æ°á»£c xuáº¥t báº£n.</li>
</ol>
<p>Báº¥t ká»³ thay Ä‘á»•i nÃ o khÃ¡c trÃªn má»™t post cÅ©ng khÃ´ng cÃ³ hiá»‡u lá»±c. VÃ­ dá»¥, náº¿u
chÃºng ta cá»‘ gáº¯ng approve má»™t draft blog post trÆ°á»›c khi yÃªu cáº§u review, post
sáº½ váº«n lÃ  má»™t draft chÆ°a Ä‘Æ°á»£c published.</p>
<p>Listing 17-11 minh há»a workflow nÃ y dÆ°á»›i dáº¡ng code: Ä‘Ã¢y lÃ  vÃ­ dá»¥ cÃ¡ch sá»­
dá»¥ng API mÃ  chÃºng ta sáº½ triá»ƒn khai trong má»™t library crate tÃªn lÃ  <code>blog</code>.
MÃ£ nÃ y sáº½ chÆ°a compile vÃ¬ chÃºng ta chÆ°a triá»ƒn khai crate <code>blog</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch17-oop/listing-17-11/src/main.rs:all}}</code></pre>
<p><span class="caption">Listing 17-11: Code that demonstrates the desired
behavior we want our <code>blog</code> crate to have</span></p>
<p>ChÃºng ta muá»‘n cho phÃ©p ngÆ°á»i dÃ¹ng táº¡o má»™t draft blog post má»›i báº±ng
<code>Post::new</code>. ChÃºng ta muá»‘n cho phÃ©p thÃªm vÄƒn báº£n vÃ o blog post. Náº¿u cá»‘
gáº¯ng láº¥y ná»™i dung cá»§a post ngay láº­p tá»©c, trÆ°á»›c khi Ä‘Æ°á»£c approval, chÃºng
ta sáº½ khÃ´ng nháº­n Ä‘Æ°á»£c báº¥t ká»³ vÄƒn báº£n nÃ o vÃ¬ post váº«n cÃ²n lÃ  draft. ChÃºng
ta Ä‘Ã£ thÃªm <code>assert_eq!</code> trong code nháº±m má»¥c Ä‘Ã­ch minh há»a. Má»™t unit test
tuyá»‡t vá»i cho trÆ°á»ng há»£p nÃ y lÃ  assert ráº±ng má»™t draft blog post tráº£ vá»
chuá»—i rá»—ng tá»« phÆ°Æ¡ng thá»©c <code>content</code>, nhÆ°ng chÃºng ta sáº½ khÃ´ng viáº¿t test
cho vÃ­ dá»¥ nÃ y.</p>
<p>Tiáº¿p theo, chÃºng ta muá»‘n cho phÃ©p yÃªu cáº§u review cho post, vÃ  muá»‘n
<code>content</code> tráº£ vá» chuá»—i rá»—ng trong khi Ä‘ang chá» review. Khi post Ä‘Æ°á»£c
approval, nÃ³ sáº½ Ä‘Æ°á»£c published, nghÄ©a lÃ  vÄƒn báº£n cá»§a post sáº½ Ä‘Æ°á»£c tráº£
vá» khi gá»i <code>content</code>.</p>
<p>ChÃº Ã½ ráº±ng kiá»ƒu duy nháº¥t chÃºng ta tÆ°Æ¡ng tÃ¡c tá»« crate lÃ  <code>Post</code>. Kiá»ƒu
nÃ y sáº½ sá»­ dá»¥ng state pattern vÃ  sáº½ giá»¯ má»™t giÃ¡ trá»‹ lÃ  má»™t trong ba state
object Ä‘áº¡i diá»‡n cho cÃ¡c tráº¡ng thÃ¡i khÃ¡c nhau mÃ  post cÃ³ thá»ƒ á»Ÿ â€” draft,
waiting for review hoáº·c published. Viá»‡c thay Ä‘á»•i tá»« tráº¡ng thÃ¡i nÃ y sang
tráº¡ng thÃ¡i khÃ¡c sáº½ Ä‘Æ°á»£c quáº£n lÃ½ ná»™i bá»™ trong kiá»ƒu <code>Post</code>. CÃ¡c state thay
Ä‘á»•i dá»±a trÃªn cÃ¡c phÆ°Æ¡ng thá»©c mÃ  ngÆ°á»i dÃ¹ng thÆ° viá»‡n gá»i trÃªn instance
cá»§a <code>Post</code>, nhÆ°ng há» khÃ´ng cáº§n quáº£n lÃ½ trá»±c tiáº¿p viá»‡c thay Ä‘á»•i state.
NgoÃ i ra, ngÆ°á»i dÃ¹ng cÅ©ng khÃ´ng thá»ƒ máº¯c lá»—i vá»›i cÃ¡c state, vÃ­ dá»¥ nhÆ°
xuáº¥t báº£n post trÆ°á»›c khi Ä‘Æ°á»£c review.</p>
<h3 id="defining-post-and-creating-a-new-instance-in-the-draft-state"><a class="header" href="#defining-post-and-creating-a-new-instance-in-the-draft-state">Defining <code>Post</code> and Creating a New Instance in the Draft State</a></h3>
<p>HÃ£y báº¯t Ä‘áº§u vá»›i viá»‡c triá»ƒn khai thÆ° viá»‡n! ChÃºng ta biáº¿t cáº§n má»™t struct
<code>Post</code> public Ä‘á»ƒ giá»¯ ná»™i dung, nÃªn sáº½ báº¯t Ä‘áº§u vá»›i Ä‘á»‹nh nghÄ©a struct vÃ 
má»™t hÃ m public <code>new</code> liÃªn káº¿t Ä‘á»ƒ táº¡o má»™t instance cá»§a <code>Post</code>, nhÆ° Ä‘Æ°á»£c
minh há»a trong Listing 17-12. ChÃºng ta cÅ©ng sáº½ táº¡o má»™t trait <code>State</code>
private Ä‘á»ƒ Ä‘á»‹nh nghÄ©a hÃ nh vi mÃ  táº¥t cáº£ state object cá»§a <code>Post</code> pháº£i cÃ³.</p>
<p>Sau Ä‘Ã³, <code>Post</code> sáº½ giá»¯ má»™t trait object `Bo</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-12/src/lib.rs}}</code></pre>
<p><span class="caption">Listing 17-12: Definition of a <code>Post</code> struct and a <code>new</code>
function that creates a new <code>Post</code> instance, a <code>State</code> trait, and a <code>Draft</code>
struct</span></p>
<p>Trait <code>State</code> Ä‘á»‹nh nghÄ©a hÃ nh vi Ä‘Æ°á»£c chia sáº» bá»Ÿi cÃ¡c tráº¡ng thÃ¡i khÃ¡c nhau cá»§a post.
CÃ¡c state object lÃ  <code>Draft</code>, <code>PendingReview</code> vÃ  <code>Published</code>, táº¥t cáº£ sáº½ triá»ƒn khai
trait <code>State</code>. Hiá»‡n táº¡i, trait chÆ°a cÃ³ phÆ°Æ¡ng thá»©c nÃ o, vÃ  chÃºng ta sáº½ báº¯t Ä‘áº§u
báº±ng viá»‡c Ä‘á»‹nh nghÄ©a tráº¡ng thÃ¡i <code>Draft</code> vÃ¬ Ä‘Ã¢y lÃ  tráº¡ng thÃ¡i mÃ  post sáº½ báº¯t Ä‘áº§u.</p>
<p>Khi táº¡o má»™t <code>Post</code> má»›i, chÃºng ta gÃ¡n field <code>state</code> vá»›i giÃ¡ trá»‹ <code>Some</code> chá»©a má»™t
<code>Box</code>. <code>Box</code> nÃ y trá» tá»›i má»™t instance má»›i cá»§a struct <code>Draft</code>. Äiá»u nÃ y Ä‘áº£m báº£o
má»—i khi táº¡o má»™t <code>Post</code> má»›i, nÃ³ sáº½ báº¯t Ä‘áº§u á»Ÿ tráº¡ng thÃ¡i draft. VÃ¬ field <code>state</code>
cá»§a <code>Post</code> lÃ  private, khÃ´ng cÃ³ cÃ¡ch nÃ o táº¡o má»™t <code>Post</code> á»Ÿ tráº¡ng thÃ¡i khÃ¡c! Trong
hÃ m <code>Post::new</code>, chÃºng ta gÃ¡n field <code>content</code> lÃ  má»™t <code>String</code> má»›i rá»—ng.</p>
<h3 id="storing-the-text-of-the-post-content"><a class="header" href="#storing-the-text-of-the-post-content">Storing the Text of the Post Content</a></h3>
<p>ChÃºng ta Ä‘Ã£ tháº¥y trong Listing 17-11 ráº±ng chÃºng ta muá»‘n gá»i má»™t phÆ°Æ¡ng thá»©c
cÃ³ tÃªn <code>add_text</code> vÃ  truyá»n vÃ o má»™t <code>&amp;str</code>, ná»™i dung nÃ y sáº½ Ä‘Æ°á»£c thÃªm lÃ m
text content cá»§a blog post. ChÃºng ta triá»ƒn khai phÆ°Æ¡ng thá»©c nÃ y thay vÃ¬ Ä‘á»ƒ
field <code>content</code> lÃ  <code>pub</code>, Ä‘á»ƒ sau nÃ y cÃ³ thá»ƒ cÃ i Ä‘áº·t má»™t phÆ°Æ¡ng thá»©c kiá»ƒm soÃ¡t
cÃ¡ch dá»¯ liá»‡u cá»§a field <code>content</code> Ä‘Æ°á»£c Ä‘á»c. PhÆ°Æ¡ng thá»©c <code>add_text</code> khÃ¡ Ä‘Æ¡n
giáº£n, nÃªn chÃºng ta sáº½ thÃªm pháº§n cÃ i Ä‘áº·t trong Listing 17-13 vÃ o khá»‘i <code>impl Post</code>:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-13/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-13: Implementing the <code>add_text</code> method to add
text to a postâ€™s <code>content</code></span></p>
<p>PhÆ°Æ¡ng thá»©c <code>add_text</code> nháº­n má»™t tham chiáº¿u mutable tá»›i <code>self</code>, vÃ¬ chÃºng ta
thay Ä‘á»•i instance cá»§a <code>Post</code> mÃ  chÃºng ta gá»i <code>add_text</code> trÃªn Ä‘Ã³. Sau Ä‘Ã³,
chÃºng ta gá»i <code>push_str</code> trÃªn <code>String</code> trong <code>content</code> vÃ  truyá»n Ä‘á»‘i sá»‘
<code>text</code> Ä‘á»ƒ thÃªm vÃ o <code>content</code> Ä‘Ã£ lÆ°u. HÃ nh vi nÃ y khÃ´ng phá»¥ thuá»™c vÃ o tráº¡ng
thÃ¡i hiá»‡n táº¡i cá»§a post, nÃªn nÃ³ khÃ´ng thuá»™c vá» state pattern. PhÆ°Æ¡ng thá»©c
<code>add_text</code> khÃ´ng tÆ°Æ¡ng tÃ¡c vá»›i field <code>state</code> chÃºt nÃ o, nhÆ°ng nÃ³ lÃ  má»™t
pháº§n cá»§a hÃ nh vi mÃ  chÃºng ta muá»‘n há»— trá»£.</p>
<h3 id="ensuring-the-content-of-a-draft-post-is-empty"><a class="header" href="#ensuring-the-content-of-a-draft-post-is-empty">Ensuring the Content of a Draft Post Is Empty</a></h3>
<p>Ngay cáº£ khi chÃºng ta Ä‘Ã£ gá»i <code>add_text</code> vÃ  thÃªm má»™t sá»‘ ná»™i dung vÃ o post,
chÃºng ta váº«n muá»‘n phÆ°Æ¡ng thá»©c <code>content</code> tráº£ vá» má»™t chuá»—i rá»—ng vÃ¬ post
váº«n Ä‘ang á»Ÿ tráº¡ng thÃ¡i draft, nhÆ° Ä‘Æ°á»£c minh há»a á»Ÿ dÃ²ng 7 cá»§a Listing 17-11.
Hiá»‡n táº¡i, chÃºng ta sáº½ triá»ƒn khai phÆ°Æ¡ng thá»©c <code>content</code> vá»›i cÃ¡ch Ä‘Æ¡n giáº£n
nháº¥t Ä‘á»ƒ Ä‘Ã¡p á»©ng yÃªu cáº§u nÃ y: luÃ´n tráº£ vá» má»™t chuá»—i rá»—ng. ChÃºng ta sáº½
thay Ä‘á»•i sau khi triá»ƒn khai kháº£ nÄƒng thay Ä‘á»•i tráº¡ng thÃ¡i cá»§a post Ä‘á»ƒ nÃ³
cÃ³ thá»ƒ Ä‘Æ°á»£c published. Cho Ä‘áº¿n nay, post chá»‰ cÃ³ thá»ƒ á»Ÿ tráº¡ng thÃ¡i draft,
nÃªn ná»™i dung post luÃ´n pháº£i trá»‘ng. Listing 17-14 minh há»a pháº§n cÃ i Ä‘áº·t
placeholder nÃ y:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-14/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-14: Adding a placeholder implementation for
the <code>content</code> method on <code>Post</code> that always returns an empty string slice</span></p>
<p>Vá»›i phÆ°Æ¡ng thá»©c <code>content</code> Ä‘Æ°á»£c thÃªm nÃ y, má»i thá»© trong Listing 17-11 Ä‘áº¿n
dÃ²ng 7 hoáº¡t Ä‘á»™ng nhÆ° mong muá»‘n.</p>
<h3 id="requesting-a-review-of-the-post-changes-its-state"><a class="header" href="#requesting-a-review-of-the-post-changes-its-state">Requesting a Review of the Post Changes Its State</a></h3>
<p>Tiáº¿p theo, chÃºng ta cáº§n thÃªm chá»©c nÄƒng Ä‘á»ƒ yÃªu cáº§u review cho má»™t post,
Ä‘iá»u nÃ y sáº½ thay Ä‘á»•i tráº¡ng thÃ¡i cá»§a nÃ³ tá»« <code>Draft</code> sang <code>PendingReview</code>.
Listing 17-15 minh há»a Ä‘oáº¡n code nÃ y:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-15/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-15: Implementing <code>request_review</code> methods on
<code>Post</code> and the <code>State</code> trait</span></p>
<p>ChÃºng ta táº¡o cho <code>Post</code> má»™t phÆ°Æ¡ng thá»©c public tÃªn lÃ  <code>request_review</code> nháº­n
má»™t tham chiáº¿u mutable tá»›i <code>self</code>. Sau Ä‘Ã³ chÃºng ta gá»i phÆ°Æ¡ng thá»©c
<code>request_review</code> ná»™i bá»™ trÃªn tráº¡ng thÃ¡i hiá»‡n táº¡i cá»§a <code>Post</code>, vÃ  phÆ°Æ¡ng thá»©c
<code>request_review</code> thá»© hai nÃ y sáº½ tiÃªu thá»¥ tráº¡ng thÃ¡i hiá»‡n táº¡i vÃ  tráº£ vá» tráº¡ng
thÃ¡i má»›i.</p>
<p>ChÃºng ta thÃªm phÆ°Æ¡ng thá»©c <code>request_review</code> vÃ o trait <code>State</code>; táº¥t cáº£ cÃ¡c
kiá»ƒu triá»ƒn khai trait nÃ y giá» Ä‘Ã¢y pháº£i triá»ƒn khai phÆ°Æ¡ng thá»©c
<code>request_review</code>. LÆ°u Ã½ ráº±ng thay vÃ¬ cÃ³ <code>self</code>, <code>&amp;self</code> hoáº·c <code>&amp;mut self</code>
lÃ m tham sá»‘ Ä‘áº§u tiÃªn, chÃºng ta cÃ³ <code>self: Box&lt;Self&gt;</code>. CÃº phÃ¡p nÃ y nghÄ©a lÃ 
phÆ°Æ¡ng thá»©c chá»‰ há»£p lá»‡ khi Ä‘Æ°á»£c gá»i trÃªn má»™t <code>Box</code> chá»©a kiá»ƒu Ä‘Ã³. CÃº phÃ¡p
nÃ y nháº­n quyá»n sá»Ÿ há»¯u cá»§a <code>Box&lt;Self&gt;</code>, lÃ m vÃ´ hiá»‡u hÃ³a tráº¡ng thÃ¡i cÅ© Ä‘á»ƒ
giÃ¡ trá»‹ tráº¡ng thÃ¡i cá»§a <code>Post</code> cÃ³ thá»ƒ biáº¿n Ä‘á»•i thÃ nh tráº¡ng thÃ¡i má»›i.</p>
<p>Äá»ƒ tiÃªu thá»¥ tráº¡ng thÃ¡i cÅ©, phÆ°Æ¡ng thá»©c <code>request_review</code> cáº§n nháº­n quyá»n sá»Ÿ
há»¯u cá»§a giÃ¡ trá»‹ tráº¡ng thÃ¡i. ÄÃ¢y lÃ  lÃ½ do <code>Option</code> trong field <code>state</code> cá»§a
<code>Post</code> xuáº¥t hiá»‡n: chÃºng ta gá»i phÆ°Æ¡ng thá»©c <code>take</code> Ä‘á»ƒ láº¥y giÃ¡ trá»‹ <code>Some</code>
ra khá»i field <code>state</code> vÃ  Ä‘á»ƒ láº¡i <code>None</code> táº¡i chá»—, vÃ¬ Rust khÃ´ng cho phÃ©p
cÃ³ cÃ¡c field chÆ°a Ä‘Æ°á»£c gÃ¡n trong struct. Äiá»u nÃ y cho phÃ©p chÃºng ta di
chuyá»ƒn giÃ¡ trá»‹ <code>state</code> ra khá»i <code>Post</code> thay vÃ¬ chá»‰ mÆ°á»£n. Sau Ä‘Ã³, chÃºng ta
gÃ¡n giÃ¡ trá»‹ <code>state</code> cá»§a post báº±ng káº¿t quáº£ cá»§a thao tÃ¡c nÃ y.</p>
<p>ChÃºng ta cáº§n gÃ¡n táº¡m <code>state</code> lÃ  <code>None</code> thay vÃ¬ gÃ¡n trá»±c tiáº¿p vá»›i code nhÆ°
<code>self.state = self.state.request_review();</code> Ä‘á»ƒ cÃ³ quyá»n sá»Ÿ há»¯u giÃ¡ trá»‹
<code>state</code>. Äiá»u nÃ y Ä‘áº£m báº£o <code>Post</code> khÃ´ng thá»ƒ dÃ¹ng giÃ¡ trá»‹ <code>state</code> cÅ© sau
khi chÃºng ta Ä‘Ã£ biáº¿n Ä‘á»•i nÃ³ thÃ nh tráº¡ng thÃ¡i má»›i.</p>
<p>PhÆ°Æ¡ng thá»©c <code>request_review</code> trÃªn <code>Draft</code> tráº£ vá» má»™t instance má»›i, Ä‘Æ°á»£c
box cá»§a struct <code>PendingReview</code>, Ä‘áº¡i diá»‡n cho tráº¡ng thÃ¡i khi má»™t post Ä‘ang
chá» review. Struct <code>PendingReview</code> cÅ©ng triá»ƒn khai phÆ°Æ¡ng thá»©c
<code>request_review</code> nhÆ°ng khÃ´ng thá»±c hiá»‡n biáº¿n Ä‘á»•i nÃ o. Thay vÃ o Ä‘Ã³, nÃ³ tráº£
vá» chÃ­nh nÃ³, vÃ¬ khi yÃªu cáº§u review trÃªn má»™t post Ä‘Ã£ á»Ÿ tráº¡ng thÃ¡i
<code>PendingReview</code>, nÃ³ váº«n giá»¯ tráº¡ng thÃ¡i <code>PendingReview</code>.</p>
<p>Giá» Ä‘Ã¢y chÃºng ta báº¯t Ä‘áº§u tháº¥y Ä‘Æ°á»£c lá»£i Ã­ch cá»§a state pattern: phÆ°Æ¡ng thá»©c
<code>request_review</code> trÃªn <code>Post</code> giá»‘ng nhau báº¥t ká»ƒ giÃ¡ trá»‹ <code>state</code> lÃ  gÃ¬.
Má»—i state chá»‹u trÃ¡ch nhiá»‡m cho cÃ¡c quy táº¯c riÃªng cá»§a nÃ³.</p>
<p>ChÃºng ta sáº½ giá»¯ nguyÃªn phÆ°Æ¡ng thá»©c <code>content</code> trÃªn <code>Post</code>, tráº£ vá» chuá»—i
rá»—ng. Giá» Ä‘Ã¢y chÃºng ta cÃ³ thá»ƒ cÃ³ má»™t <code>Post</code> á»Ÿ tráº¡ng thÃ¡i <code>PendingReview</code>
cÅ©ng nhÆ° <code>Draft</code>, nhÆ°ng chÃºng ta muá»‘n hÃ nh vi giá»‘ng nhau trong tráº¡ng
thÃ¡i <code>PendingReview</code>. Listing 17-11 giá» hoáº¡t Ä‘á»™ng Ä‘áº¿n dÃ²ng 10!</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="adding-the-approve-method-that-changes-the-behavior-of-content"></a></p>
<h3 id="adding-approve-to-change-the-behavior-of-content"><a class="header" href="#adding-approve-to-change-the-behavior-of-content">Adding <code>approve</code> to Change the Behavior of <code>content</code></a></h3>
<p>PhÆ°Æ¡ng thá»©c <code>approve</code> sáº½ tÆ°Æ¡ng tá»± nhÆ° phÆ°Æ¡ng thá»©c <code>request_review</code>: nÃ³ sáº½
gÃ¡n field <code>state</code> thÃ nh giÃ¡ trá»‹ mÃ  tráº¡ng thÃ¡i hiá»‡n táº¡i xÃ¡c Ä‘á»‹nh khi tráº¡ng
thÃ¡i Ä‘Ã³ Ä‘Æ°á»£c approve, nhÆ° minh há»a trong Listing 17-16:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-16/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-16: Implementing the <code>approve</code> method on
<code>Post</code> and the <code>State</code> trait</span></p>
<p>ChÃºng ta thÃªm phÆ°Æ¡ng thá»©c <code>approve</code> vÃ o trait <code>State</code> vÃ  thÃªm má»™t struct má»›i
triá»ƒn khai <code>State</code>, Ä‘Ã³ lÃ  tráº¡ng thÃ¡i <code>Published</code>.</p>
<p>TÆ°Æ¡ng tá»± nhÆ° cÃ¡ch <code>request_review</code> trÃªn <code>PendingReview</code> hoáº¡t Ä‘á»™ng, náº¿u chÃºng
ta gá»i phÆ°Æ¡ng thá»©c <code>approve</code> trÃªn <code>Draft</code>, sáº½ khÃ´ng cÃ³ hiá»‡u lá»±c vÃ¬ <code>approve</code>
tráº£ vá» chÃ­nh <code>self</code>. Khi gá»i <code>approve</code> trÃªn <code>PendingReview</code>, nÃ³ tráº£ vá» má»™t
instance má»›i Ä‘Æ°á»£c box cá»§a struct <code>Published</code>. Struct <code>Published</code> triá»ƒn khai
trait <code>State</code>, vÃ  cáº£ phÆ°Æ¡ng thá»©c <code>request_review</code> láº«n <code>approve</code> Ä‘á»u tráº£ vá»
chÃ­nh nÃ³, vÃ¬ trong cÃ¡c trÆ°á»ng há»£p nÃ y post nÃªn giá»¯ tráº¡ng thÃ¡i
<code>Published</code>.</p>
<p>BÃ¢y giá» chÃºng ta cáº§n cáº­p nháº­t phÆ°Æ¡ng thá»©c <code>content</code> trÃªn <code>Post</code>. ChÃºng ta
muá»‘n giÃ¡ trá»‹ tráº£ vá» tá»« <code>content</code> phá»¥ thuá»™c vÃ o tráº¡ng thÃ¡i hiá»‡n táº¡i cá»§a
<code>Post</code>, nÃªn chÃºng ta sáº½ Ä‘á»ƒ <code>Post</code> á»§y quyá»n cho má»™t phÆ°Æ¡ng thá»©c <code>content</code>
Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn field <code>state</code> cá»§a nÃ³, nhÆ° minh há»a trong Listing 17-17:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch17-oop/listing-17-17/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-17: Updating the <code>content</code> method on <code>Post</code> to
delegate to a <code>content</code> method on <code>State</code></span></p>
<p>VÃ¬ má»¥c tiÃªu lÃ  giá»¯ táº¥t cáº£ cÃ¡c quy táº¯c nÃ y bÃªn trong cÃ¡c struct triá»ƒn khai
<code>State</code>, chÃºng ta gá»i phÆ°Æ¡ng thá»©c <code>content</code> trÃªn giÃ¡ trá»‹ trong <code>state</code> vÃ 
truyá»n instance cá»§a post (tá»©c lÃ  <code>self</code>) lÃ m Ä‘á»‘i sá»‘. Sau Ä‘Ã³, chÃºng ta tráº£
vá» giÃ¡ trá»‹ Ä‘Æ°á»£c tráº£ tá»« viá»‡c sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>content</code> trÃªn giÃ¡ trá»‹
<code>state</code>.</p>
<p>ChÃºng ta gá»i phÆ°Æ¡ng thá»©c <code>as_ref</code> trÃªn <code>Option</code> vÃ¬ muá»‘n má»™t tham chiáº¿u tá»›i
giÃ¡ trá»‹ bÃªn trong <code>Option</code> thay vÃ¬ quyá»n sá»Ÿ há»¯u giÃ¡ trá»‹. VÃ¬ <code>state</code> lÃ 
<code>Option&lt;Box&lt;dyn State&gt;&gt;</code>, khi gá»i <code>as_ref</code>, chÃºng ta nháº­n Ä‘Æ°á»£c
<code>Option&lt;&amp;Box&lt;dyn State&gt;&gt;</code>. Náº¿u khÃ´ng gá»i <code>as_ref</code>, chÃºng ta sáº½ gáº·p lá»—i
vÃ¬ khÃ´ng thá»ƒ di chuyá»ƒn <code>state</code> ra khá»i <code>&amp;self</code> Ä‘Æ°á»£c mÆ°á»£n cá»§a tham sá»‘
hÃ m.</p>
<p>Sau Ä‘Ã³, chÃºng ta gá»i phÆ°Æ¡ng thá»©c <code>unwrap</code>, mÃ  chÃºng ta biáº¿t sáº½ khÃ´ng bao
giá» panic, vÃ¬ cÃ¡c phÆ°Æ¡ng thá»©c trÃªn <code>Post</code> Ä‘áº£m báº£o ráº±ng <code>state</code> luÃ´n chá»©a
giÃ¡ trá»‹ <code>Some</code> khi cÃ¡c phÆ°Æ¡ng thá»©c Ä‘Ã³ hoÃ n thÃ nh. ÄÃ¢y lÃ  má»™t trong nhá»¯ng
trÆ°á»ng há»£p Ä‘Ã£ bÃ n trong pháº§n <a href="ch09-03-to-panic-or-not-to-panic.html#cases-in-which-you-have-more-information-than-the-compiler">â€œCases In Which You Have More Information Than the
Compilerâ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 9, khi chÃºng ta biáº¿t
giÃ¡ trá»‹ <code>None</code> lÃ  khÃ´ng thá»ƒ xáº£y ra, máº·c dÃ¹ compiler khÃ´ng hiá»ƒu Ä‘Æ°á»£c Ä‘iá»u Ä‘Ã³.</p>
<p>Táº¡i thá»i Ä‘iá»ƒm nÃ y, khi gá»i <code>content</code> trÃªn <code>&amp;Box&lt;dyn State&gt;</code>, deref coercion
sáº½ cÃ³ hiá»‡u lá»±c trÃªn <code>&amp;</code> vÃ  <code>Box</code> nÃªn phÆ°Æ¡ng thá»©c <code>content</code> cuá»‘i cÃ¹ng sáº½
Ä‘Æ°á»£c gá»i trÃªn kiá»ƒu triá»ƒn khai trait <code>State</code>. Äiá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  chÃºng ta
cáº§n thÃªm <code>content</code> vÃ o Ä‘á»‹nh nghÄ©a trait <code>State</code>, vÃ  Ä‘Ã³ lÃ  nÆ¡i chÃºng ta sáº½
Ä‘áº·t logic cho ná»™i dung tráº£ vá» tÃ¹y thuá»™c vÃ o tráº¡ng thÃ¡i hiá»‡n táº¡i, nhÆ° minh
há»a trong Listing 17-18:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-18/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-18: Adding the <code>content</code> method to the <code>State</code>
trait</span></p>
<p>ChÃºng ta thÃªm má»™t triá»ƒn khai máº·c Ä‘á»‹nh cho phÆ°Æ¡ng thá»©c <code>content</code> tráº£ vá» má»™t
chuá»—i rá»—ng. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng ta khÃ´ng cáº§n triá»ƒn khai <code>content</code>
trÃªn cÃ¡c struct <code>Draft</code> vÃ  <code>PendingReview</code>. Struct <code>Published</code> sáº½ override
phÆ°Æ¡ng thá»©c <code>content</code> vÃ  tráº£ vá» giÃ¡ trá»‹ trong <code>post.content</code>.</p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta cáº§n chÃº thÃ­ch lifetime cho phÆ°Æ¡ng thá»©c nÃ y, nhÆ° Ä‘Ã£
bÃ n trong ChÆ°Æ¡ng 10. ChÃºng ta Ä‘ang láº¥y má»™t tham chiáº¿u tá»›i <code>post</code> lÃ m
Ä‘á»‘i sá»‘ vÃ  tráº£ vá» má»™t tham chiáº¿u tá»›i má»™t pháº§n cá»§a <code>post</code>, nÃªn lifetime cá»§a
tham chiáº¿u tráº£ vá» liÃªn quan tá»›i lifetime cá»§a tham sá»‘ <code>post</code>.</p>
<p>VÃ  xongâ€”táº¥t cáº£ Listing 17-11 giá» hoáº¡t Ä‘á»™ng! ChÃºng ta Ä‘Ã£ triá»ƒn khai state
pattern vá»›i cÃ¡c quy táº¯c cá»§a workflow blog post. Logic liÃªn quan tá»›i cÃ¡c
quy táº¯c náº±m trong cÃ¡c state object thay vÃ¬ ráº£i rÃ¡c trong <code>Post</code>.</p>
<section class="note" aria-role="note">
<h4 id="why-not-an-enum"><a class="header" href="#why-not-an-enum">Why Not An Enum?</a></h4>
<p>Báº¡n cÃ³ thá»ƒ tháº¯c máº¯c táº¡i sao chÃºng ta khÃ´ng dÃ¹ng má»™t <code>enum</code> vá»›i cÃ¡c tráº¡ng thÃ¡i
post khÃ¡c nhau lÃ m cÃ¡c variant. ÄÃ¢y cháº¯c cháº¯n lÃ  má»™t giáº£i phÃ¡p kháº£ thi, hÃ£y
thá»­ vÃ  so sÃ¡nh káº¿t quáº£ cuá»‘i cÃ¹ng Ä‘á»ƒ xem báº¡n thÃ­ch cÃ¡ch nÃ o! Má»™t nhÆ°á»£c Ä‘iá»ƒm
khi dÃ¹ng enum lÃ  má»i nÆ¡i kiá»ƒm tra giÃ¡ trá»‹ enum sáº½ cáº§n má»™t biá»ƒu thá»©c <code>match</code>
hoáº·c tÆ°Æ¡ng tá»± Ä‘á»ƒ xá»­ lÃ½ táº¥t cáº£ cÃ¡c variant cÃ³ thá»ƒ. Äiá»u nÃ y cÃ³ thá»ƒ trá»Ÿ nÃªn
láº·p Ä‘i láº·p láº¡i nhiá»u hÆ¡n so vá»›i giáº£i phÃ¡p trait object nÃ y.</p>
</section>
<h3 id="trade-offs-of-the-state-pattern"><a class="header" href="#trade-offs-of-the-state-pattern">Trade-offs of the State Pattern</a></h3>
<p>ChÃºng ta Ä‘Ã£ tháº¥y ráº±ng Rust cÃ³ kháº£ nÄƒng triá»ƒn khai state pattern theo hÆ°á»›ng
object-oriented Ä‘á»ƒ Ä‘Ã³ng gÃ³i cÃ¡c kiá»ƒu hÃ nh vi khÃ¡c nhau mÃ  má»™t post cÃ³ thá»ƒ
cÃ³ trong tá»«ng tráº¡ng thÃ¡i. CÃ¡c phÆ°Æ¡ng thá»©c trÃªn <code>Post</code> khÃ´ng biáº¿t gÃ¬ vá»
cÃ¡c hÃ nh vi khÃ¡c nhau. Vá»›i cÃ¡ch chÃºng ta tá»• chá»©c code, chá»‰ cáº§n nhÃ¬n vÃ o
má»™t nÆ¡i Ä‘á»ƒ biáº¿t cÃ¡c cÃ¡ch mÃ  má»™t post Ä‘Ã£ Ä‘Æ°á»£c publish cÃ³ thá»ƒ hÃ nh xá»­: Ä‘Ã³
lÃ  pháº§n triá»ƒn khai trait <code>State</code> trÃªn struct <code>Published</code>.</p>
<p>Náº¿u táº¡o má»™t triá»ƒn khai thay tháº¿ khÃ´ng dÃ¹ng state pattern, chÃºng ta cÃ³ thá»ƒ
dÃ¹ng biá»ƒu thá»©c <code>match</code> trong cÃ¡c phÆ°Æ¡ng thá»©c cá»§a <code>Post</code> hoáº·c tháº­m chÃ­ trong
code <code>main</code> Ä‘á»ƒ kiá»ƒm tra tráº¡ng thÃ¡i cá»§a post vÃ  thay Ä‘á»•i hÃ nh vi á»Ÿ nhá»¯ng nÆ¡i
Ä‘Ã³. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng ta pháº£i xem á»Ÿ nhiá»u nÆ¡i Ä‘á»ƒ hiá»ƒu táº¥t cáº£
cÃ¡c tÃ¡c Ä‘á»™ng khi post á»Ÿ tráº¡ng thÃ¡i published! Sá»‘ lÆ°á»£ng chá»— pháº£i xem sáº½
tÄƒng lÃªn khi thÃªm nhiá»u tráº¡ng thÃ¡i: má»—i biá»ƒu thá»©c <code>match</code> Ä‘Ã³ cáº§n thÃªm
má»™t nhÃ¡nh má»›i.</p>
<p>Vá»›i state pattern, cÃ¡c phÆ°Æ¡ng thá»©c <code>Post</code> vÃ  nÆ¡i sá»­ dá»¥ng <code>Post</code> khÃ´ng cáº§n
biá»ƒu thá»©c <code>match</code>, vÃ  Ä‘á»ƒ thÃªm tráº¡ng thÃ¡i má»›i, chá»‰ cáº§n thÃªm má»™t struct má»›i
vÃ  triá»ƒn khai cÃ¡c phÆ°Æ¡ng thá»©c trait trÃªn struct Ä‘Ã³.</p>
<p>Triá»ƒn khai theo state pattern dá»… dÃ ng má»Ÿ rá»™ng Ä‘á»ƒ thÃªm nhiá»u chá»©c nÄƒng hÆ¡n.
Äá»ƒ tháº¥y sá»± Ä‘Æ¡n giáº£n khi báº£o trÃ¬ code dÃ¹ng state pattern, thá»­ má»™t sá»‘ gá»£i Ã½:</p>
<ul>
<li>ThÃªm phÆ°Æ¡ng thá»©c <code>reject</code> thay Ä‘á»•i tráº¡ng thÃ¡i post tá»« <code>PendingReview</code>
vá» <code>Draft</code>.</li>
<li>YÃªu cáº§u hai láº§n gá»i <code>approve</code> trÆ°á»›c khi tráº¡ng thÃ¡i Ä‘Æ°á»£c chuyá»ƒn sang
<code>Published</code>.</li>
<li>Cho phÃ©p ngÆ°á»i dÃ¹ng thÃªm ná»™i dung text chá»‰ khi post á»Ÿ tráº¡ng thÃ¡i
<code>Draft</code>. Gá»£i Ã½: Ä‘á»ƒ state object chá»‹u trÃ¡ch nhiá»‡m vá»›i nhá»¯ng gÃ¬ cÃ³ thá»ƒ
thay Ä‘á»•i vá» content nhÆ°ng khÃ´ng chá»‹u trÃ¡ch nhiá»‡m sá»­a Ä‘á»•i <code>Post</code>.</li>
</ul>
<p>Má»™t nhÆ°á»£c Ä‘iá»ƒm cá»§a state pattern lÃ , vÃ¬ cÃ¡c state triá»ƒn khai cÃ¡c chuyá»ƒn
Ä‘á»•i giá»¯a cÃ¡c state, má»™t sá»‘ state bá»‹ coupling vá»›i nhau. Náº¿u thÃªm má»™t state
giá»¯a <code>PendingReview</code> vÃ  <code>Published</code>, nhÆ° <code>Scheduled</code>, chÃºng ta sáº½ pháº£i
thay Ä‘á»•i code trong <code>PendingReview</code> Ä‘á»ƒ chuyá»ƒn sang <code>Scheduled</code>. Sáº½ bá»›t
cÃ´ng sá»©c hÆ¡n náº¿u <code>PendingReview</code> khÃ´ng cáº§n thay Ä‘á»•i khi thÃªm tráº¡ng thÃ¡i
má»›i, nhÆ°ng Ä‘iá»u Ä‘Ã³ Ä‘á»“ng nghÄ©a pháº£i chuyá»ƒn sang má»™t design pattern khÃ¡c.</p>
<p>Má»™t nhÆ°á»£c Ä‘iá»ƒm khÃ¡c lÃ  chÃºng ta Ä‘Ã£ láº·p láº¡i má»™t sá»‘ logic. Äá»ƒ loáº¡i bá» má»™t
sá»‘ trÃ¹ng láº·p, cÃ³ thá»ƒ thá»­ táº¡o triá»ƒn khai máº·c Ä‘á»‹nh cho cÃ¡c phÆ°Æ¡ng thá»©c
<code>request_review</code> vÃ  <code>approve</code> trÃªn trait <code>State</code> tráº£ vá» <code>self</code>; tuy nhiÃªn,
Ä‘iá»u nÃ y vi pháº¡m object safety, vÃ¬ trait khÃ´ng biáº¿t chÃ­nh xÃ¡c <code>self</code> cá»¥ thá»ƒ
sáº½ lÃ  gÃ¬. ChÃºng ta muá»‘n dÃ¹ng <code>State</code> nhÆ° má»™t trait object, nÃªn cÃ¡c phÆ°Æ¡ng
thá»©c cáº§n object safe.</p>
<p>CÃ¡c trÃ¹ng láº·p khÃ¡c gá»“m cÃ¡c triá»ƒn khai tÆ°Æ¡ng tá»± cá»§a <code>request_review</code> vÃ 
<code>approve</code> trÃªn <code>Post</code>. Cáº£ hai phÆ°Æ¡ng thá»©c Ä‘á»u á»§y quyá»n cho triá»ƒn khai
cá»§a cÃ¹ng phÆ°Æ¡ng thá»©c trÃªn giÃ¡ trá»‹ trong field <code>state</code> cá»§a <code>Option</code> vÃ 
gÃ¡n giÃ¡ trá»‹ má»›i cá»§a field <code>state</code> báº±ng káº¿t quáº£ tráº£ vá». Náº¿u cÃ³ nhiá»u
phÆ°Æ¡ng thá»©c trÃªn <code>Post</code> theo máº«u nÃ y, cÃ³ thá»ƒ cÃ¢n nháº¯c Ä‘á»‹nh nghÄ©a má»™t macro
Ä‘á»ƒ loáº¡i bá» sá»± láº·p láº¡i (xem pháº§n <a href="ch19-06-macros.html#macros">â€œMacrosâ€</a><!-- ignore --> trong
ChÆ°Æ¡ng 19).</p>
<p>Báº±ng viá»‡c triá»ƒn khai state pattern chÃ­nh xÃ¡c nhÆ° Ä‘á»‹nh nghÄ©a cho cÃ¡c ngÃ´n
ngá»¯ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng, chÃºng ta chÆ°a táº­n dá»¥ng háº¿t sá»©c máº¡nh cá»§a Rust. HÃ£y xem
má»™t sá»‘ thay Ä‘á»•i cÃ³ thá»ƒ thá»±c hiá»‡n trÃªn crate <code>blog</code> Ä‘á»ƒ biáº¿n cÃ¡c tráº¡ng thÃ¡i
vÃ  chuyá»ƒn Ä‘á»•i khÃ´ng há»£p lá»‡ thÃ nh lá»—i biÃªn dá»‹ch.</p>
<h4 id="encoding-states-and-behavior-as-types"><a class="header" href="#encoding-states-and-behavior-as-types">Encoding States and Behavior as Types</a></h4>
<p>ChÃºng ta sáº½ minh há»a cÃ¡ch suy nghÄ© láº¡i state pattern Ä‘á»ƒ nháº­n Ä‘Æ°á»£c má»™t bá»™
trade-off khÃ¡c. Thay vÃ¬ Ä‘Ã³ng gÃ³i hoÃ n toÃ n cÃ¡c state vÃ  chuyá»ƒn Ä‘á»•i sao cho
code bÃªn ngoÃ i khÃ´ng biáº¿t gÃ¬ vá» chÃºng, chÃºng ta sáº½ mÃ£ hÃ³a cÃ¡c state thÃ nh
cÃ¡c kiá»ƒu khÃ¡c nhau. Do Ä‘Ã³, há»‡ thá»‘ng kiá»ƒm tra kiá»ƒu cá»§a Rust sáº½ ngÄƒn viá»‡c
sá»­ dá»¥ng cÃ¡c post Ä‘ang á»Ÿ tráº¡ng thÃ¡i draft á»Ÿ nhá»¯ng nÆ¡i chá»‰ cho phÃ©p post
Ä‘Ã£ publish báº±ng cÃ¡ch phÃ¡t sinh lá»—i biÃªn dá»‹ch.</p>
<p>HÃ£y xem xÃ©t pháº§n Ä‘áº§u cá»§a <code>main</code> trong Listing 17-11:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch17-oop/listing-17-11/src/main.rs:here}}</code></pre>
<p>ChÃºng ta váº«n cho phÃ©p táº¡o cÃ¡c post má»›i á»Ÿ tráº¡ng thÃ¡i draft báº±ng <code>Post::new</code>
vÃ  thÃªm text vÃ o ná»™i dung cá»§a post. NhÆ°ng thay vÃ¬ cÃ³ má»™t phÆ°Æ¡ng thá»©c <code>content</code>
trÃªn post draft tráº£ vá» chuá»—i rá»—ng, chÃºng ta sáº½ lÃ m sao Ä‘á»ƒ post draft hoÃ n
toÃ n khÃ´ng cÃ³ phÆ°Æ¡ng thá»©c <code>content</code>. NhÆ° váº­y, náº¿u cá»‘ gáº¯ng láº¥y ná»™i dung
cá»§a post draft, trÃ¬nh biÃªn dá»‹ch sáº½ bÃ¡o lá»—i ráº±ng phÆ°Æ¡ng thá»©c khÃ´ng tá»“n táº¡i.
Káº¿t quáº£ lÃ , sáº½ khÃ´ng thá»ƒ vÃ´ tÃ¬nh hiá»ƒn thá»‹ ná»™i dung post draft trong
mÃ´i trÆ°á»ng production, vÃ¬ code Ä‘Ã³ tháº­m chÃ­ sáº½ khÃ´ng compile Ä‘Æ°á»£c. Listing
17-19 trÃ¬nh bÃ y Ä‘á»‹nh nghÄ©a cá»§a struct <code>Post</code> vÃ  struct <code>DraftPost</code>, cÅ©ng
nhÆ° cÃ¡c phÆ°Æ¡ng thá»©c trÃªn má»—i struct:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-19/src/lib.rs}}</code></pre>
<p><span class="caption">Listing 17-19: A <code>Post</code> with a <code>content</code> method and a
<code>DraftPost</code> without a <code>content</code> method</span></p>
<p>Cáº£ hai struct <code>Post</code> vÃ  <code>DraftPost</code> Ä‘á»u cÃ³ má»™t field <code>content</code> private
lÆ°u trá»¯ ná»™i dung blog post. CÃ¡c struct khÃ´ng cÃ²n field <code>state</code> vÃ¬ chÃºng
ta Ä‘ang chuyá»ƒn viá»‡c mÃ£ hÃ³a tráº¡ng thÃ¡i sang cÃ¡c kiá»ƒu cá»§a struct. Struct
<code>Post</code> sáº½ Ä‘áº¡i diá»‡n cho má»™t post Ä‘Ã£ publish, vÃ  nÃ³ cÃ³ phÆ°Æ¡ng thá»©c <code>content</code>
tráº£ vá» giÃ¡ trá»‹ cá»§a <code>content</code>.</p>
<p>ChÃºng ta váº«n cÃ³ má»™t hÃ m <code>Post::new</code>, nhÆ°ng thay vÃ¬ tráº£ vá» má»™t instance
cá»§a <code>Post</code>, nÃ³ tráº£ vá» má»™t instance cá»§a <code>DraftPost</code>. VÃ¬ <code>content</code> lÃ  private
vÃ  khÃ´ng cÃ³ hÃ m nÃ o tráº£ vá» <code>Post</code>, hiá»‡n táº¡i khÃ´ng thá»ƒ táº¡o má»™t instance
cá»§a <code>Post</code>.</p>
<p>Struct <code>DraftPost</code> cÃ³ phÆ°Æ¡ng thá»©c <code>add_text</code>, nÃªn chÃºng ta cÃ³ thá»ƒ thÃªm text
vÃ o <code>content</code> nhÆ° trÆ°á»›c, nhÆ°ng lÆ°u Ã½ ráº±ng <code>DraftPost</code> khÃ´ng cÃ³ phÆ°Æ¡ng thá»©c
<code>content</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a! VÃ¬ váº­y chÆ°Æ¡ng trÃ¬nh Ä‘áº£m báº£o táº¥t cáº£ cÃ¡c post
báº¯t Ä‘áº§u lÃ  draft, vÃ  post draft khÃ´ng cÃ³ ná»™i dung sáºµn sÃ ng Ä‘á»ƒ hiá»ƒn thá»‹.
Báº¥t ká»³ cá»‘ gáº¯ng vÆ°á»£t qua cÃ¡c giá»›i háº¡n nÃ y sáº½ dáº«n Ä‘áº¿n lá»—i biÃªn dá»‹ch.</p>
<h4 id="implementing-transitions-as-transformations-into-different-types"><a class="header" href="#implementing-transitions-as-transformations-into-different-types">Implementing Transitions as Transformations into Different Types</a></h4>
<p>Váº­y lÃ m sao Ä‘á»ƒ cÃ³ má»™t post Ä‘Ã£ publish? ChÃºng ta muá»‘n Ä‘áº£m báº£o quy táº¯c
ráº±ng má»™t post draft pháº£i Ä‘Æ°á»£c review vÃ  approve trÆ°á»›c khi publish. Má»™t
post á»Ÿ tráº¡ng thÃ¡i pending review váº«n khÃ´ng Ä‘Æ°á»£c hiá»ƒn thá»‹ ná»™i dung. HÃ£y
triá»ƒn khai cÃ¡c giá»›i háº¡n nÃ y báº±ng cÃ¡ch thÃªm má»™t struct khÃ¡c lÃ 
<code>PendingReviewPost</code>, Ä‘á»‹nh nghÄ©a phÆ°Æ¡ng thá»©c <code>request_review</code> trÃªn
<code>DraftPost</code> tráº£ vá» <code>PendingReviewPost</code>, vÃ  Ä‘á»‹nh nghÄ©a phÆ°Æ¡ng thá»©c <code>approve</code>
trÃªn <code>PendingReviewPost</code> tráº£ vá» má»™t <code>Post</code>, nhÆ° minh há»a trong Listing 17-20:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch17-oop/listing-17-20/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 17-20: A <code>PendingReviewPost</code> that gets created by
calling <code>request_review</code> on <code>DraftPost</code> and an <code>approve</code> method that turns a
<code>PendingReviewPost</code> into a published <code>Post</code></span></p>
<p>CÃ¡c phÆ°Æ¡ng thá»©c <code>request_review</code> vÃ  <code>approve</code> nháº­n quyá»n sá»Ÿ há»¯u cá»§a <code>self</code>,
do Ä‘Ã³ tiÃªu thá»¥ cÃ¡c instance <code>DraftPost</code> vÃ  <code>PendingReviewPost</code> vÃ  biáº¿n
chÃºng thÃ nh <code>PendingReviewPost</code> vÃ  <code>Post</code> Ä‘Ã£ publish, tÆ°Æ¡ng á»©ng. NhÆ° váº­y,
sau khi gá»i <code>request_review</code> trÃªn má»™t post draft, sáº½ khÃ´ng cÃ²n tá»“n táº¡i
instance <code>DraftPost</code> nÃ o, vÃ  tÆ°Æ¡ng tá»± cho cÃ¡c tráº¡ng thÃ¡i khÃ¡c. Struct
<code>PendingReviewPost</code> khÃ´ng cÃ³ phÆ°Æ¡ng thá»©c <code>content</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a, vÃ¬
váº­y cá»‘ gáº¯ng Ä‘á»c ná»™i dung cá»§a nÃ³ sáº½ dáº«n Ä‘áº¿n lá»—i biÃªn dá»‹ch, tÆ°Æ¡ng tá»± nhÆ°
<code>DraftPost</code>. VÃ¬ cÃ¡ch duy nháº¥t Ä‘á»ƒ cÃ³ má»™t instance <code>Post</code> Ä‘Ã£ publish cÃ³
phÆ°Æ¡ng thá»©c <code>content</code> lÃ  gá»i <code>approve</code> trÃªn <code>PendingReviewPost</code>, vÃ  cÃ¡ch
duy nháº¥t Ä‘á»ƒ cÃ³ má»™t <code>PendingReviewPost</code> lÃ  gá»i <code>request_review</code> trÃªn
<code>DraftPost</code>, chÃºng ta Ä‘Ã£ mÃ£ hÃ³a workflow cá»§a blog post vÃ o há»‡ thá»‘ng kiá»ƒu.</p>
<p>NhÆ°ng chÃºng ta cÅ©ng pháº£i thá»±c hiá»‡n má»™t sá»‘ thay Ä‘á»•i nhá» cho <code>main</code>. CÃ¡c
phÆ°Æ¡ng thá»©c <code>request_review</code> vÃ  <code>approve</code> tráº£ vá» cÃ¡c instance má»›i thay vÃ¬
sá»­a Ä‘á»•i struct hiá»‡n táº¡i, vÃ¬ váº­y chÃºng ta cáº§n thÃªm cÃ¡c gÃ¡n <code>let post =</code>
shadowing Ä‘á»ƒ lÆ°u cÃ¡c instance tráº£ vá». ChÃºng ta cÅ©ng khÃ´ng thá»ƒ giá»¯ cÃ¡c
assertion vá» ná»™i dung cá»§a draft vÃ  pending review posts lÃ  chuá»—i rá»—ng,
vÃ  cÅ©ng khÃ´ng cáº§n chÃºng ná»¯a: code cá»‘ gáº¯ng sá»­ dá»¥ng content cá»§a cÃ¡c post
trong nhá»¯ng tráº¡ng thÃ¡i Ä‘Ã³ sáº½ khÃ´ng compile Ä‘Æ°á»£c. Code cáº­p nháº­t trong <code>main</code>
Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 17-21:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch17-oop/listing-17-21/src/main.rs}}</code></pre>
<p><span class="caption">Listing 17-21: Modifications to <code>main</code> to use the new
implementation of the blog post workflow</span></p>
<p>Nhá»¯ng thay Ä‘á»•i cáº§n thiáº¿t Ä‘á»ƒ gÃ¡n láº¡i <code>post</code> trong <code>main</code> nghÄ©a lÃ 
implementation nÃ y khÃ´ng hoÃ n toÃ n tuÃ¢n theo state pattern hÆ°á»›ng Ä‘á»‘i
tÆ°á»£ng ná»¯a: cÃ¡c chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c tráº¡ng thÃ¡i khÃ´ng cÃ²n Ä‘Æ°á»£c
encapsulate hoÃ n toÃ n bÃªn trong <code>Post</code>. Tuy nhiÃªn, Ä‘iá»ƒm lá»£i lÃ  cÃ¡c
tráº¡ng thÃ¡i khÃ´ng há»£p lá»‡ giá» Ä‘Ã£ khÃ´ng thá»ƒ xáº£y ra nhá» há»‡ thá»‘ng kiá»ƒu vÃ 
viá»‡c kiá»ƒm tra kiá»ƒu diá»…n ra táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch! Äiá»u nÃ y Ä‘áº£m báº£o
má»™t sá»‘ lá»—i, cháº³ng háº¡n nhÆ° hiá»ƒn thá»‹ ná»™i dung cá»§a post chÆ°a publish, sáº½
Ä‘Æ°á»£c phÃ¡t hiá»‡n trÆ°á»›c khi vÃ o production.</p>
<p>HÃ£y thá»­ thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ gá»£i Ã½ á»Ÿ Ä‘áº§u pháº§n nÃ y trÃªn crate <code>blog</code>
sau Listing 17-21 Ä‘á»ƒ xem báº¡n Ä‘Ã¡nh giÃ¡ tháº¿ nÃ o vá» thiáº¿t káº¿ phiÃªn báº£n
mÃ£ nguá»“n nÃ y. LÆ°u Ã½ ráº±ng má»™t sá»‘ tÃ¡c vá»¥ cÃ³ thá»ƒ Ä‘Ã£ Ä‘Æ°á»£c hoÃ n thÃ nh
trong thiáº¿t káº¿ nÃ y.</p>
<p>ChÃºng ta tháº¥y ráº±ng máº·c dÃ¹ Rust cÃ³ thá»ƒ triá»ƒn khai cÃ¡c pattern hÆ°á»›ng
Ä‘á»‘i tÆ°á»£ng, cÃ¡c pattern khÃ¡c, cháº³ng háº¡n nhÆ° mÃ£ hÃ³a tráº¡ng thÃ¡i vÃ o
há»‡ thá»‘ng kiá»ƒu, cÅ©ng cÃ³ sáºµn trong Rust. CÃ¡c pattern nÃ y cÃ³ cÃ¡c
trade-offs khÃ¡c nhau. Máº·c dÃ¹ báº¡n cÃ³ thá»ƒ ráº¥t quen thuá»™c vá»›i cÃ¡c
pattern hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng, suy nghÄ© láº¡i váº¥n Ä‘á» Ä‘á»ƒ táº­n dá»¥ng cÃ¡c
tÃ­nh nÄƒng cá»§a Rust cÃ³ thá»ƒ mang láº¡i lá»£i Ã­ch, cháº³ng háº¡n nhÆ° ngÄƒn
má»™t sá»‘ lá»—i ngay tá»« thá»i Ä‘iá»ƒm biÃªn dá»‹ch. Pattern hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng
khÃ´ng pháº£i lÃºc nÃ o cÅ©ng lÃ  giáº£i phÃ¡p tá»‘t nháº¥t trong Rust do má»™t
sá»‘ Ä‘áº·c Ä‘iá»ƒm, nhÆ° ownership, mÃ  cÃ¡c ngÃ´n ngá»¯ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng khÃ´ng
cÃ³.</p>
<h2 id="tÃ³m-táº¯t-7"><a class="header" href="#tÃ³m-táº¯t-7">TÃ³m táº¯t</a></h2>
<p>DÃ¹ báº¡n cÃ³ coi Rust lÃ  ngÃ´n ngá»¯ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng hay khÃ´ng sau khi
Ä‘á»c chÆ°Æ¡ng nÃ y, báº¡n Ä‘Ã£ biáº¿t ráº±ng cÃ³ thá»ƒ sá»­ dá»¥ng trait object Ä‘á»ƒ
cÃ³ má»™t sá»‘ tÃ­nh nÄƒng hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng trong Rust. Dynamic dispatch
cÃ³ thá»ƒ mang láº¡i cho code cá»§a báº¡n má»™t sá»‘ tÃ­nh linh hoáº¡t Ä‘á»•i láº¥y
má»™t chÃºt chi phÃ­ runtime. Báº¡n cÃ³ thá»ƒ dÃ¹ng linh hoáº¡t nÃ y Ä‘á»ƒ triá»ƒn
khai cÃ¡c pattern hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng giÃºp maintainability cá»§a code tá»‘t
hÆ¡n. Rust cÅ©ng cÃ³ cÃ¡c tÃ­nh nÄƒng khÃ¡c, nhÆ° ownership, mÃ  cÃ¡c ngÃ´n
ngá»¯ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng khÃ´ng cÃ³. Má»™t pattern hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng sáº½
khÃ´ng pháº£i lÃºc nÃ o cÅ©ng lÃ  cÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ táº­n dá»¥ng sá»©c máº¡nh
cá»§a Rust, nhÆ°ng lÃ  má»™t lá»±a chá»n kháº£ thi.</p>
<p>Tiáº¿p theo, chÃºng ta sáº½ xem cÃ¡c pattern, lÃ  má»™t trong nhá»¯ng tÃ­nh
nÄƒng cá»§a Rust cho phÃ©p nhiá»u linh hoáº¡t. ChÃºng ta Ä‘Ã£ xem qua chÃºng
ngáº¯n gá»n trong suá»‘t cuá»‘n sÃ¡ch nhÆ°ng chÆ°a tháº¥y Ä‘áº§y Ä‘á»§ kháº£ nÄƒng cá»§a
chÃºng. HÃ£y tiáº¿p tá»¥c!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="patterns-and-matching"><a class="header" href="#patterns-and-matching">Patterns and Matching</a></h1>
<p><em>Patterns</em> lÃ  má»™t cÃº phÃ¡p Ä‘áº·c biá»‡t trong Rust dÃ¹ng Ä‘á»ƒ so khá»›p vá»›i cáº¥u trÃºc
cá»§a cÃ¡c kiá»ƒu dá»¯ liá»‡u, cáº£ phá»©c táº¡p láº«n Ä‘Æ¡n giáº£n. Sá»­ dá»¥ng patterns káº¿t há»£p vá»›i
cÃ¡c biá»ƒu thá»©c <code>match</code> vÃ  cÃ¡c cáº¥u trÃºc khÃ¡c sáº½ cho báº¡n nhiá»u quyá»n kiá»ƒm soÃ¡t
hÆ¡n Ä‘á»‘i vá»›i luá»“ng Ä‘iá»u khiá»ƒn cá»§a chÆ°Æ¡ng trÃ¬nh. Má»™t pattern bao gá»“m sá»±
káº¿t há»£p cá»§a má»™t sá»‘ thÃ nh pháº§n sau:</p>
<ul>
<li>Literals (háº±ng sá»‘)</li>
<li>CÃ¡c máº£ng, enum, struct, hoáº·c tuple Ä‘Æ°á»£c destructure</li>
<li>Biáº¿n</li>
<li>Wildcards (<code>_</code>)</li>
<li>Placeholders</li>
</ul>
<p>Má»™t sá»‘ vÃ­ dá»¥ vá» pattern gá»“m <code>x</code>, <code>(a, 3)</code>, vÃ  <code>Some(Color::Red)</code>. Trong
cÃ¡c ngá»¯ cáº£nh mÃ  pattern há»£p lá»‡, cÃ¡c thÃ nh pháº§n nÃ y mÃ´ táº£ â€œhÃ¬nh dáº¡ngâ€ cá»§a
dá»¯ liá»‡u. ChÆ°Æ¡ng trÃ¬nh sau Ä‘Ã³ sáº½ so khá»›p cÃ¡c giÃ¡ trá»‹ vá»›i pattern Ä‘á»ƒ xÃ¡c Ä‘á»‹nh
xem giÃ¡ trá»‹ cÃ³ Ä‘Ãºng â€œhÃ¬nh dáº¡ngâ€ dá»¯ liá»‡u Ä‘á»ƒ cháº¡y Ä‘oáº¡n code tÆ°Æ¡ng á»©ng hay khÃ´ng.</p>
<p>Äá»ƒ sá»­ dá»¥ng má»™t pattern, chÃºng ta so sÃ¡nh nÃ³ vá»›i má»™t giÃ¡ trá»‹. Náº¿u pattern
khá»›p vá»›i giÃ¡ trá»‹, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c pháº§n cá»§a giÃ¡ trá»‹ Ä‘Ã³ trong code.
HÃ£y nhá»› láº¡i cÃ¡c biá»ƒu thá»©c <code>match</code> trong ChÆ°Æ¡ng 6 mÃ  Ä‘Ã£ sá»­ dá»¥ng patterns,
cháº³ng háº¡n nhÆ° vÃ­ dá»¥ mÃ¡y phÃ¢n loáº¡i Ä‘á»“ng xu. Náº¿u giÃ¡ trá»‹ phÃ¹ há»£p vá»›i hÃ¬nh dáº¡ng
cá»§a pattern, chÃºng ta cÃ³ thá»ƒ dÃ¹ng cÃ¡c pháº§n Ä‘Æ°á»£c Ä‘áº·t tÃªn. Náº¿u khÃ´ng, Ä‘oáº¡n
code liÃªn quan Ä‘áº¿n pattern Ä‘Ã³ sáº½ khÃ´ng cháº¡y.</p>
<p>ChÆ°Æ¡ng nÃ y lÃ  má»™t tÃ i liá»‡u tham kháº£o vá» táº¥t cáº£ cÃ¡c váº¥n Ä‘á» liÃªn quan Ä‘áº¿n
patterns. ChÃºng ta sáº½ Ä‘á» cáº­p Ä‘áº¿n cÃ¡c vá»‹ trÃ­ há»£p lá»‡ Ä‘á»ƒ sá»­ dá»¥ng patterns,
sá»± khÃ¡c nhau giá»¯a refutable vÃ  irrefutable patterns, cÅ©ng nhÆ° cÃ¡c loáº¡i cÃº
phÃ¡p pattern mÃ  báº¡n cÃ³ thá»ƒ gáº·p. Káº¿t thÃºc chÆ°Æ¡ng nÃ y, báº¡n sáº½ biáº¿t cÃ¡ch sá»­
dá»¥ng patterns Ä‘á»ƒ biá»ƒu diá»…n nhiá»u khÃ¡i niá»‡m má»™t cÃ¡ch rÃµ rÃ ng.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="táº¥t-cáº£-cÃ¡c-nÆ¡i-patterns-cÃ³-thá»ƒ-Ä‘Æ°á»£c-sá»­-dá»¥ng"><a class="header" href="#táº¥t-cáº£-cÃ¡c-nÆ¡i-patterns-cÃ³-thá»ƒ-Ä‘Æ°á»£c-sá»­-dá»¥ng">Táº¥t cáº£ cÃ¡c nÆ¡i patterns cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng</a></h2>
<p>Patterns xuáº¥t hiá»‡n á»Ÿ nhiá»u nÆ¡i trong Rust, vÃ  báº¡n Ä‘Ã£ sá»­ dá»¥ng chÃºng khÃ¡ nhiá»u
mÃ  cÃ³ thá»ƒ khÃ´ng nháº­n ra! Pháº§n nÃ y sáº½ tháº£o luáº­n táº¥t cáº£ cÃ¡c nÆ¡i mÃ  patterns
há»£p lá»‡.</p>
<h3 id="nhÃ¡nh-arm-cá»§a-match"><a class="header" href="#nhÃ¡nh-arm-cá»§a-match">NhÃ¡nh (<code>arm</code>) cá»§a <code>match</code></a></h3>
<p>NhÆ° Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 6, chÃºng ta sá»­ dá»¥ng patterns trong cÃ¡c nhÃ¡nh
cá»§a biá»ƒu thá»©c <code>match</code>. Vá» máº·t hÃ¬nh thá»©c, biá»ƒu thá»©c <code>match</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a
báº±ng tá»« khÃ³a <code>match</code>, má»™t giÃ¡ trá»‹ Ä‘á»ƒ so khá»›p, vÃ  má»™t hoáº·c nhiá»u nhÃ¡nh (<code>match arm</code>) bao gá»“m má»™t pattern vÃ  má»™t biá»ƒu thá»©c sáº½ cháº¡y náº¿u giÃ¡ trá»‹ khá»›p vá»›i
pattern cá»§a nhÃ¡nh Ä‘Ã³, vÃ­ dá»¥:</p>
<pre><code class="language-text">match VALUE {
    PATTERN =&gt; EXPRESSION,
    PATTERN =&gt; EXPRESSION,
    PATTERN =&gt; EXPRESSION,
}
</code></pre>
<p>VÃ­ dá»¥, Ä‘Ã¢y lÃ  biá»ƒu thá»©c <code>match</code> tá»« Listing 6-5, khá»›p vá»›i má»™t giÃ¡ trá»‹
<code>Option&lt;i32&gt;</code> trong biáº¿n <code>x</code>:</p>
<pre><code class="language-rust ignore">match x {
    None =&gt; None,
    Some(i) =&gt; Some(i + 1),
}</code></pre>
<p>CÃ¡c pattern trong biá»ƒu thá»©c <code>match</code> nÃ y lÃ  <code>None</code> vÃ  <code>Some(value)</code> Ä‘á»©ng phÃ­a
trÃ¡i cá»§a má»—i mÅ©i tÃªn.</p>
<p>Má»™t yÃªu cáº§u Ä‘á»‘i vá»›i biá»ƒu thá»©c <code>match</code> lÃ  chÃºng pháº£i <em>toÃ n diá»‡n</em> (exhaustive),
tá»©c lÃ  pháº£i bao quÃ¡t má»i kháº£ nÄƒng cá»§a giÃ¡ trá»‹ trong biá»ƒu thá»©c <code>match</code>. Má»™t
cÃ¡ch Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng báº¡n Ä‘Ã£ bao quÃ¡t táº¥t cáº£ kháº£ nÄƒng lÃ  sá»­ dá»¥ng má»™t pattern
báº¯t táº¥t cáº£ (catchall) á»Ÿ arm cuá»‘i cÃ¹ng: vÃ­ dá»¥, má»™t tÃªn biáº¿n khá»›p vá»›i báº¥t ká»³
giÃ¡ trá»‹ nÃ o sáº½ luÃ´n thÃ nh cÃ´ng vÃ  bao quÃ¡t táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p cÃ²n láº¡i.</p>
<p>Pattern <code>_</code> sáº½ khá»›p vá»›i báº¥t cá»© giÃ¡ trá»‹ nÃ o, nhÆ°ng khÃ´ng gÃ¡n giÃ¡ trá»‹ Ä‘Ã³ cho
biáº¿n, nÃªn thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng á»Ÿ arm cuá»‘i cÃ¹ng. Pattern <code>_</code> há»¯u Ã­ch khi báº¡n muá»‘n
bá» qua báº¥t ká»³ giÃ¡ trá»‹ nÃ o khÃ´ng Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh. ChÃºng ta sáº½ Ä‘i sÃ¢u hÆ¡n vá»
pattern <code>_</code> trong pháº§n <a href="ch18-03-pattern-syntax.html#ignoring-values-in-a-pattern">â€œIgnoring Values in a Patternâ€</a><!-- ignore --> á»Ÿ cuá»‘i chÆ°Æ¡ng nÃ y.</p>
<h3 id="biá»ƒu-thá»©c-Ä‘iá»u-kiá»‡n-if-let"><a class="header" href="#biá»ƒu-thá»©c-Ä‘iá»u-kiá»‡n-if-let">Biá»ƒu thá»©c Ä‘iá»u kiá»‡n <code>if let</code></a></h3>
<p>Trong ChÆ°Æ¡ng 6, chÃºng ta Ä‘Ã£ tháº£o luáº­n cÃ¡ch dÃ¹ng <code>if let</code> chá»§ yáº¿u nhÆ° má»™t
cÃ¡ch viáº¿t ngáº¯n gá»n cho <code>match</code> khi chá»‰ quan tÃ¢m Ä‘áº¿n má»™t trÆ°á»ng há»£p. TÃ¹y chá»n,
<code>if let</code> cÃ³ thá»ƒ Ä‘i kÃ¨m <code>else</code> chá»©a code sáº½ cháº¡y náº¿u pattern trong <code>if let</code> khÃ´ng
khá»›p.</p>
<p>Listing 18-1 cho tháº¥y báº¡n cÃ³ thá»ƒ káº¿t há»£p <code>if let</code>, <code>else if</code> vÃ  <code>else if let</code>.
CÃ¡ch lÃ m nÃ y linh hoáº¡t hÆ¡n <code>match</code> vÃ¬ báº¡n cÃ³ thá»ƒ so sÃ¡nh nhiá»u giÃ¡ trá»‹ khÃ¡c
nhau, vÃ  Rust khÃ´ng yÃªu cáº§u cÃ¡c Ä‘iá»u kiá»‡n trong chuá»—i <code>if let</code>, <code>else if</code>,
<code>else if let</code> pháº£i liÃªn quan Ä‘áº¿n nhau.</p>
<p>VÃ­ dá»¥ nÃ y xÃ¡c Ä‘á»‹nh mÃ u ná»n dá»±a trÃªn má»™t chuá»—i kiá»ƒm tra nhiá»u Ä‘iá»u kiá»‡n khÃ¡c
nhau. ChÃºng ta sá»­ dá»¥ng cÃ¡c biáº¿n vá»›i giÃ¡ trá»‹ cá»‘ Ä‘á»‹nh, mÃ  trong thá»±c táº¿ chÆ°Æ¡ng
trÃ¬nh cÃ³ thá»ƒ nháº­n tá»« input cá»§a ngÆ°á»i dÃ¹ng.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-01/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-1: Káº¿t há»£p <code>if let</code>, <code>else if</code>, <code>else if let</code> vÃ  <code>else</code></span></p>
<p>Náº¿u ngÆ°á»i dÃ¹ng chá»‰ Ä‘á»‹nh má»™t mÃ u yÃªu thÃ­ch, mÃ u Ä‘Ã³ sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng lÃ m mÃ u ná»n.
Náº¿u khÃ´ng cÃ³ mÃ u yÃªu thÃ­ch nÃ o Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh vÃ  hÃ´m nay lÃ  thá»© Ba, mÃ u ná»n sáº½
lÃ  xanh lÃ¡. NgÆ°á»£c láº¡i, náº¿u ngÆ°á»i dÃ¹ng chá»‰ Ä‘á»‹nh tuá»•i cá»§a há» dÆ°á»›i dáº¡ng chuá»—i vÃ 
chÃºng ta cÃ³ thá»ƒ parse thÃ nh sá»‘ thÃ nh cÃ´ng, mÃ u ná»n sáº½ lÃ  tÃ­m hoáº·c cam tÃ¹y
thuá»™c vÃ o giÃ¡ trá»‹ sá»‘ Ä‘Ã³. Náº¿u khÃ´ng cÃ³ Ä‘iá»u kiá»‡n nÃ o trong sá»‘ nÃ y Ä‘Ãºng, mÃ u
ná»n sáº½ lÃ  xanh dÆ°Æ¡ng.</p>
<p>Cáº¥u trÃºc Ä‘iá»u kiá»‡n nÃ y cho phÃ©p chÃºng ta há»— trá»£ cÃ¡c yÃªu cáº§u phá»©c táº¡p. Vá»›i cÃ¡c
giÃ¡ trá»‹ cá»‘ Ä‘á»‹nh trong vÃ­ dá»¥ nÃ y, chÆ°Æ¡ng trÃ¬nh sáº½ in ra
<code>Using purple as the background color</code>.</p>
<p>Báº¡n cÃ³ thá»ƒ tháº¥y ráº±ng <code>if let</code> cÅ©ng cÃ³ thá»ƒ táº¡o ra cÃ¡c biáº¿n shadowed (biáº¿n che
phá»§) tÆ°Æ¡ng tá»± nhÆ° cÃ¡c nhÃ¡nh trong <code>match</code>: dÃ²ng <code>if let Ok(age) = age</code> táº¡o
ra má»™t biáº¿n <code>age</code> má»›i shadowed, chá»©a giÃ¡ trá»‹ bÃªn trong variant <code>Ok</code>. Äiá»u nÃ y
cÃ³ nghÄ©a lÃ  chÃºng ta cáº§n Ä‘áº·t Ä‘iá»u kiá»‡n <code>if age &gt; 30</code> bÃªn trong khá»‘i Ä‘Ã³: chÃºng
ta khÃ´ng thá»ƒ káº¿t há»£p hai Ä‘iá»u kiá»‡n nÃ y thÃ nh <code>if let Ok(age) = age &amp;&amp; age &gt; 30</code>.
Biáº¿n <code>age</code> shadowed mÃ  chÃºng ta muá»‘n so sÃ¡nh vá»›i 30 chá»‰ há»£p lá»‡ khi pháº¡m vi
má»›i báº¯t Ä‘áº§u vá»›i dáº¥u ngoáº·c nhá»n.</p>
<p>NhÆ°á»£c Ä‘iá»ƒm cá»§a viá»‡c sá»­ dá»¥ng cÃ¡c biá»ƒu thá»©c <code>if let</code> lÃ  trÃ¬nh biÃªn dá»‹ch khÃ´ng kiá»ƒm tra
tÃ­nh bao quÃ¡t (exhaustiveness), trong khi vá»›i cÃ¡c biá»ƒu thá»©c <code>match</code>, trÃ¬nh biÃªn dá»‹ch
sáº½ lÃ m Ä‘iá»u nÃ y. Náº¿u chÃºng ta bá» qua khá»‘i <code>else</code> cuá»‘i cÃ¹ng vÃ  do Ä‘Ã³ bá» lá»¡ viá»‡c xá»­ lÃ½
má»™t sá»‘ trÆ°á»ng há»£p, trÃ¬nh biÃªn dá»‹ch sáº½ khÃ´ng cáº£nh bÃ¡o chÃºng ta vá» lá»—i logic tiá»m áº©n.</p>
<h3 id="vÃ²ng-láº·p-Ä‘iá»u-kiá»‡n-while-let"><a class="header" href="#vÃ²ng-láº·p-Ä‘iá»u-kiá»‡n-while-let">VÃ²ng láº·p Ä‘iá»u kiá»‡n <code>while let</code></a></h3>
<p>TÆ°Æ¡ng tá»± nhÆ° <code>if let</code>, vÃ²ng láº·p Ä‘iá»u kiá»‡n <code>while let</code> cho phÃ©p má»™t vÃ²ng láº·p <code>while</code>
cháº¡y miá»…n lÃ  pattern tiáº¿p tá»¥c khá»›p. Trong Listing 18-2, chÃºng ta viáº¿t má»™t vÃ²ng láº·p
<code>while let</code> sá»­ dá»¥ng vector nhÆ° má»™t stack vÃ  in cÃ¡c giÃ¡ trá»‹ trong vector theo thá»© tá»±
ngÆ°á»£c láº¡i so vá»›i thá»© tá»± chÃºng Ä‘Æ°á»£c Ä‘áº©y vÃ o.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-02/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-2: Sá»­ dá»¥ng vÃ²ng láº·p <code>while let</code> Ä‘á»ƒ in cÃ¡c giÃ¡ trá»‹
miá»…n lÃ  <code>stack.pop()</code> tráº£ vá» <code>Some</code></span></p>
<p>VÃ­ dá»¥ nÃ y sáº½ in ra 3, 2, rá»“i 1. PhÆ°Æ¡ng thá»©c <code>pop</code> láº¥y pháº§n tá»­ cuá»‘i cÃ¹ng ra khá»i vector
vÃ  tráº£ vá» <code>Some(value)</code>. Náº¿u vector trá»‘ng, <code>pop</code> tráº£ vá» <code>None</code>. VÃ²ng láº·p <code>while</code>
tiáº¿p tá»¥c cháº¡y mÃ£ trong khá»‘i cá»§a nÃ³ miá»…n lÃ  <code>pop</code> tráº£ vá» <code>Some</code>. Khi <code>pop</code> tráº£ vá»
<code>None</code>, vÃ²ng láº·p dá»«ng láº¡i. ChÃºng ta cÃ³ thá»ƒ dÃ¹ng <code>while let</code> Ä‘á»ƒ láº¥y tá»«ng pháº§n tá»­
ra khá»i stack.</p>
<h3 id="vÃ²ng-láº·p-for"><a class="header" href="#vÃ²ng-láº·p-for">VÃ²ng láº·p <code>for</code></a></h3>
<p>Trong má»™t vÃ²ng láº·p <code>for</code>, giÃ¡ trá»‹ ngay sau tá»« khÃ³a <code>for</code> lÃ  má»™t pattern. VÃ­ dá»¥, trong
<code>for x in y</code>, <code>x</code> lÃ  pattern. Listing 18-3 minh há»a cÃ¡ch sá»­ dá»¥ng pattern trong vÃ²ng láº·p
<code>for</code> Ä‘á»ƒ phÃ¡ vá»¡ (destructure) má»™t tuple nhÆ° má»™t pháº§n cá»§a vÃ²ng láº·p.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-03/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-3: Sá»­ dá»¥ng pattern trong vÃ²ng láº·p <code>for</code> Ä‘á»ƒ
phÃ¡ vá»¡ (destructure) má»™t tuple</span></p>
<p>MÃ£ trong Listing 18-3 sáº½ in ra káº¿t quáº£ sau:</p>
<pre><code class="language-console">{{#include ../listings/ch18-patterns-and-matching/listing-18-03/output.txt}}
</code></pre>
<p>ChÃºng ta Ä‘iá»u chá»‰nh má»™t iterator báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>enumerate</code>
Ä‘á»ƒ nÃ³ tráº£ vá» má»™t giÃ¡ trá»‹ vÃ  chá»‰ sá»‘ cá»§a giÃ¡ trá»‹ Ä‘Ã³, Ä‘áº·t vÃ o trong má»™t tuple.
GiÃ¡ trá»‹ Ä‘áº§u tiÃªn Ä‘Æ°á»£c táº¡o ra lÃ  tuple <code>(0, 'a')</code>. Khi giÃ¡ trá»‹ nÃ y Ä‘Æ°á»£c so khá»›p
vá»›i pattern <code>(index, value)</code>, <code>index</code> sáº½ lÃ  <code>0</code> vÃ  <code>value</code> sáº½ lÃ  <code>'a'</code>,
in ra dÃ²ng Ä‘áº§u tiÃªn cá»§a output.</p>
<h3 id="cÃ¢u-lá»‡nh-let"><a class="header" href="#cÃ¢u-lá»‡nh-let">CÃ¢u lá»‡nh <code>let</code></a></h3>
<p>TrÆ°á»›c chÆ°Æ¡ng nÃ y, chÃºng ta chá»‰ má»›i tháº£o luáº­n rÃµ rÃ ng vá» viá»‡c sá»­ dá»¥ng pattern vá»›i
<code>match</code> vÃ  <code>if let</code>, nhÆ°ng thá»±c ra, chÃºng ta Ä‘Ã£ sá»­ dá»¥ng pattern á»Ÿ nhiá»u nÆ¡i khÃ¡c
ná»¯a, bao gá»“m cáº£ trong cÃ¡c cÃ¢u lá»‡nh <code>let</code>. VÃ­ dá»¥, xem xÃ©t má»™t phÃ©p gÃ¡n biáº¿n Ä‘Æ¡n giáº£n
vá»›i <code>let</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 5;
<span class="boring">}</span></code></pre></pre>
<p>Má»—i khi báº¡n sá»­ dá»¥ng má»™t cÃ¢u lá»‡nh <code>let</code> nhÆ° tháº¿ nÃ y, báº¡n Ä‘Ã£ Ä‘ang sá»­ dá»¥ng pattern,
máº·c dÃ¹ cÃ³ thá»ƒ báº¡n chÆ°a nháº­n ra! NÃ³i má»™t cÃ¡ch chÃ­nh thá»©c hÆ¡n, má»™t cÃ¢u lá»‡nh <code>let</code>
trÃ´ng nhÆ° sau:</p>
<pre><code class="language-text">let PATTERN = EXPRESSION;
</code></pre>
<p>Trong cÃ¡c cÃ¢u lá»‡nh nhÆ° <code>let x = 5;</code> vá»›i tÃªn biáº¿n á»Ÿ vá»‹ trÃ­ <code>PATTERN</code>,
tÃªn biáº¿n chá»‰ lÃ  má»™t dáº¡ng Ä‘Æ¡n giáº£n Ä‘áº·c biá»‡t cá»§a pattern. Rust so sÃ¡nh biá»ƒu thá»©c vá»›i pattern vÃ  gÃ¡n cÃ¡c tÃªn mÃ  nÃ³ tÃ¬m tháº¥y.
VÃ¬ váº­y, trong vÃ­ dá»¥ <code>let x = 5;</code>, <code>x</code> lÃ  má»™t pattern cÃ³ nghÄ©a lÃ  â€œrÃ ng buá»™c giÃ¡ trá»‹ khá»›p á»Ÿ Ä‘Ã¢y vÃ o biáº¿n <code>x</code>.â€
Bá»Ÿi vÃ¬ tÃªn <code>x</code> lÃ  toÃ n bá»™ pattern, pattern nÃ y vá» cÆ¡ báº£n cÃ³ nghÄ©a lÃ  â€œrÃ ng buá»™c má»i giÃ¡ trá»‹ vÃ o biáº¿n <code>x</code>, báº¥t ká»ƒ giÃ¡ trá»‹ Ä‘Ã³ lÃ  gÃ¬.â€</p>
<p>Äá»ƒ tháº¥y rÃµ hÆ¡n khÃ­a cáº¡nh pattern matching cá»§a <code>let</code>, hÃ£y xem Listing 18-4,
trong Ä‘Ã³ sá»­ dá»¥ng má»™t pattern vá»›i <code>let</code> Ä‘á»ƒ phÃ¢n rÃ£ (destructure) má»™t tuple.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-04/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-4: Sá»­ dá»¥ng pattern Ä‘á»ƒ phÃ¢n rÃ£ má»™t tuple vÃ 
táº¡o ba biáº¿n cÃ¹ng lÃºc</span></p>
<p>á» Ä‘Ã¢y, chÃºng ta so khá»›p má»™t tuple vá»›i má»™t pattern. Rust so sÃ¡nh giÃ¡ trá»‹ <code>(1, 2, 3)</code>
vá»›i pattern <code>(x, y, z)</code> vÃ  nháº­n tháº¥y giÃ¡ trá»‹ khá»›p vá»›i pattern, vÃ¬ váº­y Rust
rÃ ng buá»™c <code>1</code> cho <code>x</code>, <code>2</code> cho <code>y</code>, vÃ  <code>3</code> cho <code>z</code>. Báº¡n cÃ³ thá»ƒ coi pattern tuple nÃ y
nhÆ° lÃ  viá»‡c lá»“ng ba pattern biáº¿n riÃªng láº» bÃªn trong nÃ³.</p>
<p>Náº¿u sá»‘ lÆ°á»£ng pháº§n tá»­ trong pattern khÃ´ng khá»›p vá»›i sá»‘ lÆ°á»£ng pháº§n tá»­
trong tuple, kiá»ƒu tá»•ng thá»ƒ sáº½ khÃ´ng khá»›p vÃ  chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i biÃªn dá»‹ch.
VÃ­ dá»¥, Listing 18-5 cho tháº¥y má»™t thá»­ nghiá»‡m phÃ¢n rÃ£ má»™t tuple cÃ³ ba pháº§n tá»­
thÃ nh hai biáº¿n, Ä‘iá»u nÃ y sáº½ khÃ´ng hoáº¡t Ä‘á»™ng.</p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-05/src/main.rs:here}}</code></pre>
<p><span class="caption">Listing 18-5: Táº¡o pattern khÃ´ng Ä‘Ãºng khi sá»‘ biáº¿n
khÃ´ng khá»›p vá»›i sá»‘ pháº§n tá»­ trong tuple</span></p>
<p>Viá»‡c cá»‘ gáº¯ng biÃªn dá»‹ch Ä‘oáº¡n code nÃ y sáº½ dáº«n Ä‘áº¿n lá»—i kiá»ƒu sau:</p>
<pre><code class="language-console">{{#include ../listings/ch18-patterns-and-matching/listing-18-05/output.txt}}
</code></pre>
<p>Äá»ƒ sá»­a lá»—i, chÃºng ta cÃ³ thá»ƒ bá» qua má»™t hoáº·c nhiá»u giÃ¡ trá»‹ trong tuple báº±ng cÃ¡ch sá»­ dá»¥ng <code>_</code> hoáº·c <code>..</code>, nhÆ° báº¡n sáº½ tháº¥y trong pháº§n <a href="ch18-03-pattern-syntax.html#ignoring-values-in-a-pattern">â€œIgnoring Values in a Patternâ€</a><!-- ignore -->. Náº¿u váº¥n Ä‘á» lÃ  cÃ³ quÃ¡ nhiá»u biáº¿n trong pattern, giáº£i phÃ¡p lÃ  Ä‘iá»u chá»‰nh cho khá»›p kiá»ƒu báº±ng cÃ¡ch loáº¡i bá» bá»›t cÃ¡c biáº¿n sao cho sá»‘ biáº¿n báº±ng sá»‘ pháº§n tá»­ trong tuple.</p>
<h3 id="tham-sá»‘-hÃ m"><a class="header" href="#tham-sá»‘-hÃ m">Tham sá»‘ HÃ m</a></h3>
<p>Tham sá»‘ hÃ m cÅ©ng cÃ³ thá»ƒ lÃ  pattern. Äoáº¡n code trong Listing 18-6, khai bÃ¡o má»™t hÃ m tÃªn lÃ  <code>foo</code> vá»›i má»™t tham sá»‘ tÃªn lÃ  <code>x</code> kiá»ƒu <code>i32</code>, cháº¯c háº³n giá» Ä‘Ã¢y Ä‘Ã£ trá»Ÿ nÃªn quen thuá»™c.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-06/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-6: Chá»¯ kÃ½ hÃ m sá»­ dá»¥ng pattern trong cÃ¡c tham sá»‘</span></p>
<p>Pháº§n <code>x</code> chÃ­nh lÃ  má»™t pattern! Giá»‘ng nhÆ° vá»›i <code>let</code>, chÃºng ta cÃ³ thá»ƒ so khá»›p má»™t tuple trong cÃ¡c tham sá»‘ cá»§a hÃ m vá»›i pattern. Listing 18-7 tÃ¡ch cÃ¡c giÃ¡ trá»‹ trong má»™t tuple khi truyá»n nÃ³ vÃ o hÃ m.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-07/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-7: Má»™t hÃ m vá»›i cÃ¡c tham sá»‘ tÃ¡ch má»™t tuple</span></p>
<p>Äoáº¡n mÃ£ nÃ y sáº½ in ra <code>Current location: (3, 5)</code>. CÃ¡c giÃ¡ trá»‹ <code>&amp;(3, 5)</code> khá»›p vá»›i pattern <code>&amp;(x, y)</code>, vÃ¬ váº­y <code>x</code> lÃ  giÃ¡ trá»‹ <code>3</code> vÃ  <code>y</code> lÃ  giÃ¡ trá»‹ <code>5</code>.</p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng pattern trong danh sÃ¡ch tham sá»‘ cá»§a closure giá»‘ng nhÆ° trong danh sÃ¡ch tham sá»‘ cá»§a hÃ m, bá»Ÿi vÃ¬ closures tÆ°Æ¡ng tá»± nhÆ° cÃ¡c hÃ m, nhÆ° Ä‘Ã£ tháº£o luáº­n á»Ÿ ChÆ°Æ¡ng 13.</p>
<p>Táº¡i thá»i Ä‘iá»ƒm nÃ y, báº¡n Ä‘Ã£ tháº¥y nhiá»u cÃ¡ch sá»­ dá»¥ng pattern, nhÆ°ng pattern khÃ´ng hoáº¡t Ä‘á»™ng giá»‘ng nhau á»Ÿ má»i nÆ¡i mÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng chÃºng. á» má»™t sá»‘ nÆ¡i, pattern pháº£i lÃ  khÃ´ng thá»ƒ tháº¥t báº¡i (irrefutable); trong cÃ¡c trÆ°á»ng há»£p khÃ¡c, chÃºng cÃ³ thá»ƒ tháº¥t báº¡i (refutable). ChÃºng ta sáº½ tháº£o luáº­n hai khÃ¡i niá»‡m nÃ y tiáº¿p theo.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="tÃ­nh-cÃ³-thá»ƒ-tháº¥t-báº¡i-cá»§a-pattern-liá»‡u-má»™t-pattern-cÃ³-thá»ƒ-khÃ´ng-khá»›p"><a class="header" href="#tÃ­nh-cÃ³-thá»ƒ-tháº¥t-báº¡i-cá»§a-pattern-liá»‡u-má»™t-pattern-cÃ³-thá»ƒ-khÃ´ng-khá»›p">TÃ­nh cÃ³ thá»ƒ tháº¥t báº¡i cá»§a Pattern: Liá»‡u má»™t Pattern cÃ³ thá»ƒ khÃ´ng khá»›p</a></h2>
<p>Pattern cÃ³ hai dáº¡ng: <strong>cÃ³ thá»ƒ tháº¥t báº¡i</strong> (refutable) vÃ  <strong>khÃ´ng thá»ƒ tháº¥t báº¡i</strong> (irrefutable). Pattern sáº½ khá»›p vá»›i má»i giÃ¡ trá»‹ cÃ³ thá»ƒ Ä‘Æ°á»£c truyá»n vÃ o gá»i lÃ  <strong>khÃ´ng thá»ƒ tháº¥t báº¡i</strong>. VÃ­ dá»¥, <code>x</code> trong cÃ¢u lá»‡nh <code>let x = 5;</code> vÃ¬ <code>x</code> khá»›p vá»›i má»i giÃ¡ trá»‹ vÃ  do Ä‘Ã³ khÃ´ng thá»ƒ tháº¥t báº¡i.</p>
<p>Pattern cÃ³ thá»ƒ khÃ´ng khá»›p vá»›i má»™t sá»‘ giÃ¡ trá»‹ cá»¥ thá»ƒ gá»i lÃ  <strong>cÃ³ thá»ƒ tháº¥t báº¡i</strong>. VÃ­ dá»¥, <code>Some(x)</code> trong biá»ƒu thá»©c <code>if let Some(x) = a_value</code> vÃ¬ náº¿u giÃ¡ trá»‹ trong biáº¿n <code>a_value</code> lÃ  <code>None</code> thay vÃ¬ <code>Some</code>, pattern <code>Some(x)</code> sáº½ khÃ´ng khá»›p.</p>
<p>Tham sá»‘ cá»§a hÃ m, cÃ¢u lá»‡nh <code>let</code>, vÃ  vÃ²ng láº·p <code>for</code> chá»‰ cháº¥p nháº­n <strong>pattern khÃ´ng thá»ƒ tháº¥t báº¡i</strong>, vÃ¬ chÆ°Æ¡ng trÃ¬nh khÃ´ng thá»ƒ thá»±c hiá»‡n viá»‡c gÃ¬ cÃ³ Ã½ nghÄ©a náº¿u giÃ¡ trá»‹ khÃ´ng khá»›p. Biá»ƒu thá»©c <code>if let</code> vÃ  <code>while let</code> cháº¥p nháº­n cáº£ <strong>pattern cÃ³ thá»ƒ tháº¥t báº¡i</strong> vÃ  <strong>khÃ´ng thá»ƒ tháº¥t báº¡i</strong>, nhÆ°ng trÃ¬nh biÃªn dá»‹ch sáº½ cáº£nh bÃ¡o náº¿u dÃ¹ng pattern khÃ´ng thá»ƒ tháº¥t báº¡i, bá»Ÿi vÃ¬ theo Ä‘á»‹nh nghÄ©a, cÃ¡c pattern nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ xá»­ lÃ½ kháº£ nÄƒng tháº¥t báº¡i: chá»©c nÄƒng cá»§a má»™t Ä‘iá»u kiá»‡n phá»¥ thuá»™c vÃ o viá»‡c thá»±c hiá»‡n khÃ¡c nhau khi thÃ nh cÃ´ng hoáº·c tháº¥t báº¡i.</p>
<p>NhÃ¬n chung, báº¡n khÃ´ng cáº§n quÃ¡ lo láº¯ng vá» sá»± khÃ¡c biá»‡t giá»¯a <strong>refutable</strong> vÃ  <strong>irrefutable</strong>, nhÆ°ng báº¡n cáº§n hiá»ƒu khÃ¡i niá»‡m nÃ y Ä‘á»ƒ pháº£n á»©ng khi gáº·p thÃ´ng bÃ¡o lá»—i liÃªn quan. Trong cÃ¡c trÆ°á»ng há»£p Ä‘Ã³, báº¡n sáº½ cáº§n thay Ä‘á»•i pattern hoáº·c cáº¥u trÃºc sá»­ dá»¥ng pattern, tÃ¹y thuá»™c vÃ o hÃ nh vi mong muá»‘n cá»§a mÃ£.</p>
<p>HÃ£y xem vÃ­ dá»¥ vá» nhá»¯ng gÃ¬ xáº£y ra khi chÃºng ta sá»­ dá»¥ng <strong>pattern cÃ³ thá»ƒ tháº¥t báº¡i</strong> á»Ÿ nÆ¡i Rust yÃªu cáº§u <strong>pattern khÃ´ng thá»ƒ tháº¥t báº¡i</strong> vÃ  ngÆ°á»£c láº¡i. Listing 18-8 cho tháº¥y má»™t cÃ¢u lá»‡nh <code>let</code>, nhÆ°ng pattern Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh lÃ  <code>Some(x)</code>, má»™t pattern cÃ³ thá»ƒ tháº¥t báº¡i. NhÆ° báº¡n cÃ³ thá»ƒ Ä‘oÃ¡n, mÃ£ nÃ y sáº½ khÃ´ng biÃªn dá»‹ch Ä‘Æ°á»£c.</p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-08/src/main.rs:here}}</code></pre>
<p><span class="caption">Listing 18-8: Cá»‘ gáº¯ng sá»­ dá»¥ng pattern cÃ³ thá»ƒ tháº¥t báº¡i vá»›i <code>let</code></span></p>
<p>Náº¿u <code>some_option_value</code> lÃ  giÃ¡ trá»‹ <code>None</code>, nÃ³ sáº½ khÃ´ng khá»›p vá»›i pattern <code>Some(x)</code>,
tá»©c pattern nÃ y lÃ  cÃ³ thá»ƒ tháº¥t báº¡i. Tuy nhiÃªn, cÃ¢u lá»‡nh <code>let</code> chá»‰ cháº¥p nháº­n pattern
khÃ´ng thá»ƒ tháº¥t báº¡i, vÃ¬ khÃ´ng cÃ³ gÃ¬ há»£p lá»‡ mÃ  chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ thá»±c hiá»‡n vá»›i giÃ¡ trá»‹ <code>None</code>.
Khi biÃªn dá»‹ch, Rust sáº½ bÃ¡o lá»—i vÃ¬ chÃºng ta Ä‘Ã£ cá»‘ sá»­ dá»¥ng pattern cÃ³ thá»ƒ tháº¥t báº¡i á»Ÿ nÆ¡i yÃªu cáº§u pattern khÃ´ng thá»ƒ tháº¥t báº¡i:</p>
<pre><code class="language-console">{{#include ../listings/ch18-patterns-and-matching/listing-18-08/output.txt}}
</code></pre>
<p>VÃ¬ chÃºng ta khÃ´ng bao phá»§ Ä‘Æ°á»£c (vÃ  cÅ©ng khÃ´ng thá»ƒ bao phá»§!) má»i giÃ¡ trá»‹ há»£p lá»‡ vá»›i pattern <code>Some(x)</code>, Rust chÃ­nh xÃ¡c khi Ä‘Æ°a ra lá»—i biÃªn dá»‹ch.</p>
<p>Náº¿u chÃºng ta cÃ³ má»™t pattern cÃ³ thá»ƒ tháº¥t báº¡i á»Ÿ nÆ¡i yÃªu cáº§u pattern khÃ´ng thá»ƒ tháº¥t báº¡i, ta cÃ³ thá»ƒ sá»­a báº±ng cÃ¡ch thay Ä‘á»•i Ä‘oáº¡n mÃ£ sá»­ dá»¥ng pattern: thay vÃ¬ dÃ¹ng <code>let</code>, ta dÃ¹ng <code>if let</code>. Khi Ä‘Ã³, náº¿u pattern khÃ´ng khá»›p, chÆ°Æ¡ng trÃ¬nh sáº½ bá» qua Ä‘oáº¡n mÃ£ trong dáº¥u ngoáº·c nhá»n, cho phÃ©p tiáº¿p tá»¥c thá»±c thi há»£p lá»‡. Listing 18-9 minh há»a cÃ¡ch sá»­a mÃ£ trong Listing 18-8.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-09/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-9: Sá»­ dá»¥ng <code>if let</code> vÃ  má»™t khá»‘i vá»›i pattern cÃ³ thá»ƒ tháº¥t báº¡i thay vÃ¬ <code>let</code></span></p>
<p>ChÃºng ta Ä‘Ã£ táº¡o ra má»™t â€œlá»‘i thoÃ¡tâ€ cho Ä‘oáº¡n mÃ£! Äoáº¡n mÃ£ nÃ y hoÃ n toÃ n há»£p lá»‡, máº·c dÃ¹ Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  chÃºng ta khÃ´ng thá»ƒ dÃ¹ng má»™t pattern khÃ´ng thá»ƒ tháº¥t báº¡i mÃ  khÃ´ng nháº­n Ä‘Æ°á»£c cáº£nh bÃ¡o. Náº¿u chÃºng ta cung cáº¥p cho <code>if let</code> má»™t pattern luÃ´n khá»›p, cháº³ng háº¡n nhÆ° <code>x</code>, nhÆ° trong Listing 18-10, trÃ¬nh biÃªn dá»‹ch sáº½ Ä‘Æ°a ra cáº£nh bÃ¡o.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-10/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-10: Cá»‘ gáº¯ng sá»­ dá»¥ng má»™t pattern khÃ´ng thá»ƒ tháº¥t báº¡i vá»›i <code>if let</code></span></p>
<p>Rust bÃ¡o lá»—i ráº±ng viá»‡c dÃ¹ng <code>if let</code> vá»›i má»™t pattern khÃ´ng thá»ƒ tháº¥t báº¡i lÃ  vÃ´ nghÄ©a:</p>
<pre><code class="language-console">{{#include ../listings/ch18-patterns-and-matching/listing-18-10/output.txt}}
</code></pre>
<p>VÃ¬ lÃ½ do nÃ y, cÃ¡c nhÃ¡nh (<code>arm</code>) trong <code>match</code> pháº£i sá»­ dá»¥ng cÃ¡c
pattern cÃ³ thá»ƒ tháº¥t báº¡i (refutable), ngoáº¡i trá»« nhÃ¡nh cuá»‘i cÃ¹ng,
vá»‘n nÃªn khá»›p vá»›i má»i giÃ¡ trá»‹ cÃ²n láº¡i báº±ng má»™t pattern khÃ´ng thá»ƒ tháº¥t báº¡i (irrefutable).
Rust cho phÃ©p chÃºng ta sá»­ dá»¥ng má»™t pattern khÃ´ng thá»ƒ tháº¥t báº¡i trong má»™t <code>match</code>
chá»‰ cÃ³ má»™t nhÃ¡nh, nhÆ°ng cÃº phÃ¡p nÃ y khÃ´ng thá»±c sá»± há»¯u Ã­ch vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c
thay tháº¿ báº±ng má»™t cÃ¢u lá»‡nh <code>let</code> Ä‘Æ¡n giáº£n hÆ¡n.</p>
<p>BÃ¢y giá», khi báº¡n Ä‘Ã£ biáº¿t Ä‘Æ°á»£c nÆ¡i cÃ³ thá»ƒ sá»­ dá»¥ng patterns vÃ  sá»± khÃ¡c
nhau giá»¯a pattern cÃ³ thá»ƒ tháº¥t báº¡i vÃ  khÃ´ng thá»ƒ tháº¥t báº¡i, hÃ£y
cÃ¹ng tÃ¬m hiá»ƒu táº¥t cáº£ cÃº phÃ¡p mÃ  chÃºng ta cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ táº¡o patterns.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="cÃº-phÃ¡p-pattern"><a class="header" href="#cÃº-phÃ¡p-pattern">CÃº phÃ¡p Pattern</a></h2>
<p>Trong pháº§n nÃ y, chÃºng ta sáº½ táº­p há»£p táº¥t cáº£ cÃ¡c cÃº phÃ¡p há»£p lá»‡ trong patterns
vÃ  tháº£o luáº­n lÃ½ do cÅ©ng nhÆ° khi nÃ o báº¡n muá»‘n sá»­ dá»¥ng tá»«ng loáº¡i.</p>
<h3 id="khá»›p-vá»›i-literal"><a class="header" href="#khá»›p-vá»›i-literal">Khá»›p vá»›i Literal</a></h3>
<p>NhÆ° báº¡n Ä‘Ã£ tháº¥y trong ChÆ°Æ¡ng 6, báº¡n cÃ³ thá»ƒ so khá»›p patterns trá»±c tiáº¿p vá»›i cÃ¡c literal. VÃ­ dá»¥ code sau minh há»a:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/no-listing-01-literals/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>Code nÃ y sáº½ in ra <code>one</code> vÃ¬ giÃ¡ trá»‹ trong <code>x</code> lÃ  1. CÃº phÃ¡p nÃ y há»¯u Ã­ch khi báº¡n muá»‘n chÆ°Æ¡ng trÃ¬nh thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng nÃ o Ä‘Ã³ náº¿u nháº­n Ä‘Æ°á»£c má»™t giÃ¡ trá»‹ cá»¥ thá»ƒ.</p>
<h3 id="khá»›p-vá»›i-biáº¿n-Äáº·t-tÃªn"><a class="header" href="#khá»›p-vá»›i-biáº¿n-Äáº·t-tÃªn">Khá»›p vá»›i Biáº¿n Äáº·t TÃªn</a></h3>
<p>CÃ¡c biáº¿n Ä‘áº·t tÃªn lÃ  cÃ¡c pattern khÃ´ng thá»ƒ tháº¥t báº¡i (irrefutable patterns)
vÃ  khá»›p vá»›i báº¥t ká»³ giÃ¡ trá»‹ nÃ o; chÃºng ta Ä‘Ã£ sá»­ dá»¥ng chÃºng nhiá»u láº§n trong sÃ¡ch.
Tuy nhiÃªn, cÃ³ má»™t váº¥n Ä‘á» nhá» khi sá»­ dá»¥ng cÃ¡c biáº¿n Ä‘áº·t tÃªn trong cÃ¡c biá»ƒu thá»©c <code>match</code>.
VÃ¬ <code>match</code> táº¡o ra má»™t scope má»›i, cÃ¡c biáº¿n Ä‘Æ°á»£c khai bÃ¡o nhÆ° má»™t pháº§n cá»§a pattern
bÃªn trong <code>match</code> sáº½ che khuáº¥t (shadow) cÃ¡c biáº¿n cÃ¹ng tÃªn bÃªn ngoÃ i <code>match</code>,
giá»‘ng nhÆ° cÃ¡ch táº¥t cáº£ cÃ¡c biáº¿n khÃ¡c hoáº¡t Ä‘á»™ng. Trong Listing 18-11,
chÃºng ta khai bÃ¡o má»™t biáº¿n tÃªn lÃ  <code>x</code> vá»›i giÃ¡ trá»‹ <code>Some(5)</code> vÃ  má»™t biáº¿n <code>y</code> vá»›i giÃ¡ trá»‹ <code>10</code>.
Sau Ä‘Ã³, chÃºng ta táº¡o má»™t biá»ƒu thá»©c <code>match</code> trÃªn giÃ¡ trá»‹ <code>x</code>.
HÃ£y quan sÃ¡t cÃ¡c pattern trong cÃ¡c nhÃ¡nh cá»§a <code>match</code> vÃ  lá»‡nh <code>println!</code> á»Ÿ cuá»‘i,
vÃ  thá»­ Ä‘oÃ¡n xem code sáº½ in gÃ¬ trÆ°á»›c khi cháº¡y hoáº·c Ä‘á»c tiáº¿p.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-11/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-11: Má»™t biá»ƒu thá»©c <code>match</code> vá»›i má»™t nhÃ¡nh
giá»›i thiá»‡u biáº¿n bá»‹ shadow <code>y</code></span></p>
<p>HÃ£y cÃ¹ng xem xÃ©t Ä‘iá»u gÃ¬ xáº£y ra khi biá»ƒu thá»©c <code>match</code> cháº¡y.
Pattern trong nhÃ¡nh <code>match</code> Ä‘áº§u tiÃªn khÃ´ng khá»›p vá»›i giÃ¡ trá»‹ Ä‘Ã£ Ä‘á»‹nh nghÄ©a cá»§a <code>x</code>,
vÃ¬ váº­y chÆ°Æ¡ng trÃ¬nh tiáº¿p tá»¥c.</p>
<p>Pattern trong nhÃ¡nh <code>match</code> thá»© hai giá»›i thiá»‡u má»™t biáº¿n má»›i tÃªn lÃ  <code>y</code>
sáº½ khá»›p vá»›i báº¥t ká»³ giÃ¡ trá»‹ nÃ o bÃªn trong <code>Some</code>. VÃ¬ chÃºng ta Ä‘ang á»Ÿ
trong má»™t scope má»›i bÃªn trong biá»ƒu thá»©c <code>match</code>, Ä‘Ã¢y lÃ  má»™t biáº¿n <code>y</code> má»›i,
khÃ´ng pháº£i <code>y</code> mÃ  chÃºng ta Ä‘Ã£ khai bÃ¡o lÃºc Ä‘áº§u vá»›i giÃ¡ trá»‹ 10. Binding <code>y</code>
má»›i nÃ y sáº½ khá»›p vá»›i báº¥t ká»³ giÃ¡ trá»‹ nÃ o bÃªn trong <code>Some</code>, chÃ­nh xÃ¡c lÃ  giÃ¡ trá»‹ trong <code>x</code>.
Do Ä‘Ã³, <code>y</code> má»›i nÃ y Ä‘Æ°á»£c gÃ¡n giÃ¡ trá»‹ bÃªn trong <code>Some</code> trong <code>x</code>. GiÃ¡ trá»‹ Ä‘Ã³ lÃ  <code>5</code>,
vÃ¬ váº­y biá»ƒu thá»©c cá»§a nhÃ¡nh nÃ y sáº½ cháº¡y vÃ  in ra <code>Matched, y = 5</code>.</p>
<p>Náº¿u <code>x</code> lÃ  <code>None</code> thay vÃ¬ <code>Some(5)</code>, cÃ¡c pattern trong hai nhÃ¡nh Ä‘áº§u tiÃªn sáº½ khÃ´ng khá»›p,
vÃ¬ váº­y giÃ¡ trá»‹ sáº½ khá»›p vá»›i dáº¥u gáº¡ch dÆ°á»›i <code>_</code>. ChÃºng ta khÃ´ng giá»›i thiá»‡u biáº¿n <code>x</code>
trong pattern cá»§a nhÃ¡nh <code>_</code>, vÃ¬ váº­y <code>x</code> trong biá»ƒu thá»©c váº«n lÃ  <code>x</code> bÃªn ngoÃ i, chÆ°a bá»‹ shadow.
Trong trÆ°á»ng há»£p giáº£ Ä‘á»‹nh nÃ y, <code>match</code> sáº½ in ra <code>Default case, x = None</code>.</p>
<p>Khi biá»ƒu thá»©c <code>match</code> káº¿t thÃºc, scope cá»§a nÃ³ káº¿t thÃºc, vÃ  scope cá»§a <code>y</code> bÃªn trong cÅ©ng káº¿t thÃºc.
Lá»‡nh <code>println!</code> cuá»‘i cÃ¹ng sáº½ in ra <code>at the end: x = Some(5), y = 10</code>.</p>
<p>Äá»ƒ táº¡o má»™t biá»ƒu thá»©c <code>match</code> so sÃ¡nh giÃ¡ trá»‹ cá»§a <code>x</code> vÃ  <code>y</code> bÃªn ngoÃ i,
thay vÃ¬ giá»›i thiá»‡u má»™t biáº¿n bá»‹ shadow, chÃºng ta sáº½ cáº§n sá»­ dá»¥ng má»™t match guard Ä‘iá»u kiá»‡n.
ChÃºng ta sáº½ nÃ³i vá» match guards sau trong pháº§n <a href="ch18-03-pattern-syntax.html#extra-conditionals-with-match-guards">â€œExtra Conditionals with Match Guardsâ€</a>.</p>
<h3 id="nhiá»u-pattern"><a class="header" href="#nhiá»u-pattern">Nhiá»u Pattern</a></h3>
<p>Trong biá»ƒu thá»©c <code>match</code>, báº¡n cÃ³ thá»ƒ khá»›p nhiá»u pattern báº±ng cÃº phÃ¡p <code>|</code>,
lÃ  toÃ¡n tá»­ <em>hoáº·c</em> cho pattern. VÃ­ dá»¥, trong Ä‘oáº¡n code sau chÃºng ta khá»›p giÃ¡ trá»‹ cá»§a <code>x</code>
vá»›i cÃ¡c nhÃ¡nh <code>match</code>, trong Ä‘Ã³ nhÃ¡nh Ä‘áº§u tiÃªn cÃ³ má»™t tÃ¹y chá»n <em>hoáº·c</em>, nghÄ©a lÃ  náº¿u giÃ¡ trá»‹
cá»§a <code>x</code> khá»›p vá»›i báº¥t ká»³ giÃ¡ trá»‹ nÃ o trong nhÃ¡nh Ä‘Ã³, code cá»§a nhÃ¡nh Ä‘Ã³ sáº½ cháº¡y:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/no-listing-02-multiple-patterns/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>Äoáº¡n code nÃ y sáº½ in ra <code>one or two</code>.</p>
<h3 id="khá»›p-vá»›i-má»™t-pháº¡m-vi-giÃ¡-trá»‹-báº±ng-"><a class="header" href="#khá»›p-vá»›i-má»™t-pháº¡m-vi-giÃ¡-trá»‹-báº±ng-">Khá»›p vá»›i má»™t pháº¡m vi giÃ¡ trá»‹ báº±ng <code>..=</code></a></h3>
<p>CÃº phÃ¡p <code>..=</code> cho phÃ©p chÃºng ta khá»›p vá»›i má»™t pháº¡m vi giÃ¡ trá»‹ bao gá»“m cáº£ hai Ä‘áº§u.
Trong Ä‘oáº¡n code sau, khi má»™t pattern khá»›p vá»›i báº¥t ká»³ giÃ¡ trá»‹ nÃ o trong pháº¡m vi Ä‘Ã£ cho, nhÃ¡nh Ä‘Ã³ sáº½ Ä‘Æ°á»£c thá»±c thi:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/no-listing-03-ranges/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>Náº¿u <code>x</code> lÃ  1, 2, 3, 4 hoáº·c 5, nhÃ¡nh Ä‘áº§u tiÃªn sáº½ khá»›p. CÃº phÃ¡p nÃ y tiá»‡n lá»£i
hÆ¡n khi muá»‘n khá»›p nhiá»u giÃ¡ trá»‹ so vá»›i viá»‡c dÃ¹ng toÃ¡n tá»­ <code>|</code> Ä‘á»ƒ diá»…n táº£ cÃ¹ng má»™t Ã½ tÆ°á»Ÿng;
náº¿u dÃ¹ng <code>|</code> thÃ¬ pháº£i viáº¿t <code>1 | 2 | 3 | 4 | 5</code>. Viá»‡c chá»‰ Ä‘á»‹nh má»™t pháº¡m vi ngáº¯n gá»n hÆ¡n nhiá»u,
Ä‘áº·c biá»‡t náº¿u muá»‘n khá»›p, vÃ­ dá»¥, báº¥t ká»³ sá»‘ nÃ o tá»« 1 Ä‘áº¿n 1.000!</p>
<p>TrÃ¬nh biÃªn dá»‹ch kiá»ƒm tra ráº±ng pháº¡m vi khÃ´ng rá»—ng táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch,
vÃ  vÃ¬ chá»‰ cÃ³ cÃ¡c kiá»ƒu <code>char</code> vÃ  sá»‘ mÃ  Rust cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh pháº¡m vi cÃ³ rá»—ng hay khÃ´ng,
nÃªn pháº¡m vi chá»‰ Ä‘Æ°á»£c phÃ©p vá»›i cÃ¡c giÃ¡ trá»‹ sá»‘ hoáº·c <code>char</code>.</p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ sá»­ dá»¥ng pháº¡m vi cá»§a cÃ¡c giÃ¡ trá»‹ <code>char</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/no-listing-04-ranges-of-char/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>Rust cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh ráº±ng <code>'c'</code> náº±m trong pháº¡m vi cá»§a nhÃ¡nh Ä‘áº§u tiÃªn vÃ  in ra <code>early ASCII letter</code>.</p>
<h3 id="phÃ¡-cáº¥u-trÃºc-Ä‘á»ƒ-tÃ¡ch-cÃ¡c-giÃ¡-trá»‹"><a class="header" href="#phÃ¡-cáº¥u-trÃºc-Ä‘á»ƒ-tÃ¡ch-cÃ¡c-giÃ¡-trá»‹">PhÃ¡ cáº¥u trÃºc Ä‘á»ƒ tÃ¡ch cÃ¡c giÃ¡ trá»‹</a></h3>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ dÃ¹ng pattern Ä‘á»ƒ phÃ¡ cáº¥u trÃºc cÃ¡c struct,
enum vÃ  tuple Ä‘á»ƒ sá»­ dá»¥ng cÃ¡c pháº§n khÃ¡c nhau cá»§a cÃ¡c giÃ¡ trá»‹ nÃ y. HÃ£y xem xÃ©t tá»«ng loáº¡i giÃ¡ trá»‹.</p>
<h4 id="phÃ¡-cáº¥u-trÃºc-struct"><a class="header" href="#phÃ¡-cáº¥u-trÃºc-struct">PhÃ¡ cáº¥u trÃºc Struct</a></h4>
<p>Listing 18-12 minh há»a má»™t struct <code>Point</code> vá»›i hai trÆ°á»ng <code>x</code> vÃ  <code>y</code>, mÃ  chÃºng ta cÃ³ thá»ƒ tÃ¡ch ra báº±ng pattern trong má»™t cÃ¢u lá»‡nh <code>let</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-12/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-12: PhÃ¡ cáº¥u trÃºc cÃ¡c trÆ°á»ng cá»§a struct thÃ nh cÃ¡c biáº¿n riÃªng biá»‡t</span></p>
<p>Äoáº¡n code nÃ y táº¡o ra cÃ¡c biáº¿n <code>a</code> vÃ  <code>b</code> tÆ°Æ¡ng á»©ng vá»›i giÃ¡ trá»‹ cá»§a cÃ¡c trÆ°á»ng
<code>x</code> vÃ  <code>y</code> trong struct <code>p</code>. VÃ­ dá»¥ nÃ y cho tháº¥y tÃªn cá»§a cÃ¡c biáº¿n trong pattern
khÃ´ng nháº¥t thiáº¿t pháº£i trÃ¹ng vá»›i tÃªn trÆ°á»ng cá»§a struct. Tuy nhiÃªn, thÆ°á»ng thÃ¬
chÃºng ta Ä‘áº·t tÃªn biáº¿n giá»‘ng tÃªn trÆ°á»ng Ä‘á»ƒ dá»… nhá»› biáº¿n nÃ o Ä‘áº¿n tá»« trÆ°á»ng nÃ o.</p>
<p>Do thÃ³i quen phá»• biáº¿n nÃ y vÃ  vÃ¬ viáº¿t <code>let Point { x: x, y: y } = p;</code> gÃ¢y trÃ¹ng láº·p nhiá»u,
Rust cÃ³ cÃº phÃ¡p rÃºt gá»n cho cÃ¡c pattern khá»›p vá»›i cÃ¡c trÆ°á»ng struct:
báº¡n chá»‰ cáº§n liá»‡t kÃª tÃªn trÆ°á»ng, vÃ  cÃ¡c biáº¿n Ä‘Æ°á»£c táº¡o ra tá»« pattern sáº½ cÃ³ cÃ¹ng tÃªn.
Listing 18-13 hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° Listing 18-12, nhÆ°ng cÃ¡c biáº¿n Ä‘Æ°á»£c táº¡o ra
trong pattern <code>let</code> lÃ  <code>x</code> vÃ  <code>y</code> thay vÃ¬ <code>a</code> vÃ  <code>b</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-13/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-13: PhÃ¡ cáº¥u trÃºc cÃ¡c trÆ°á»ng struct sá»­ dá»¥ng cÃº phÃ¡p rÃºt gá»n cho trÆ°á»ng</span></p>
<p>Äoáº¡n code nÃ y táº¡o ra cÃ¡c biáº¿n <code>x</code> vÃ  <code>y</code> tÆ°Æ¡ng á»©ng vá»›i cÃ¡c trÆ°á»ng <code>x</code> vÃ  <code>y</code> cá»§a biáº¿n <code>p</code>.
Káº¿t quáº£ lÃ  cÃ¡c biáº¿n <code>x</code> vÃ  <code>y</code> chá»©a giÃ¡ trá»‹ tá»« struct <code>p</code>.</p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ phÃ¡ cáº¥u trÃºc vá»›i cÃ¡c giÃ¡ trá»‹ literal nhÆ° má»™t pháº§n cá»§a
pattern struct thay vÃ¬ táº¡o biáº¿n cho táº¥t cáº£ cÃ¡c trÆ°á»ng. CÃ¡ch nÃ y cho phÃ©p kiá»ƒm tra
má»™t sá»‘ trÆ°á»ng cÃ³ giÃ¡ trá»‹ cá»¥ thá»ƒ hay khÃ´ng trong khi táº¡o biáº¿n Ä‘á»ƒ phÃ¡ cáº¥u trÃºc cÃ¡c trÆ°á»ng cÃ²n láº¡i.</p>
<p>Trong Listing 18-14, chÃºng ta cÃ³ má»™t biá»ƒu thá»©c <code>match</code> phÃ¢n loáº¡i cÃ¡c
giÃ¡ trá»‹ <code>Point</code> thÃ nh ba trÆ°á»ng há»£p: cÃ¡c Ä‘iá»ƒm náº±m trá»±c tiáº¿p trÃªn trá»¥c <code>x</code> (Ä‘Ãºng khi <code>y = 0</code>), trÃªn trá»¥c <code>y</code> (<code>x = 0</code>),
hoáº·c khÃ´ng náº±m trÃªn cáº£ hai trá»¥c.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-14/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-14: PhÃ¡ cáº¥u trÃºc vÃ  so khá»›p giÃ¡ trá»‹ literal trong má»™t pattern</span></p>
<p>Arm Ä‘áº§u tiÃªn sáº½ khá»›p vá»›i báº¥t ká»³ Ä‘iá»ƒm nÃ o náº±m trÃªn trá»¥c <code>x</code>
báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh ráº±ng trÆ°á»ng <code>y</code> khá»›p náº¿u giÃ¡ trá»‹ cá»§a nÃ³ báº±ng literal <code>0</code>.
Pattern váº«n táº¡o ra má»™t biáº¿n <code>x</code> mÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng trong code cá»§a arm nÃ y.</p>
<p>TÆ°Æ¡ng tá»±, arm thá»© hai khá»›p vá»›i báº¥t ká»³ Ä‘iá»ƒm nÃ o náº±m trÃªn trá»¥c <code>y</code> báº±ng cÃ¡ch
chá»‰ Ä‘á»‹nh ráº±ng trÆ°á»ng <code>x</code> khá»›p náº¿u giÃ¡ trá»‹ cá»§a nÃ³ báº±ng <code>0</code> vÃ  táº¡o biáº¿n <code>y</code>
cho giÃ¡ trá»‹ cá»§a trÆ°á»ng <code>y</code>. Arm thá»© ba khÃ´ng chá»‰ Ä‘á»‹nh báº¥t ká»³ literal nÃ o,
nÃªn nÃ³ khá»›p vá»›i má»i <code>Point</code> khÃ¡c vÃ  táº¡o biáº¿n cho cáº£ trÆ°á»ng <code>x</code> vÃ  <code>y</code>.</p>
<p>Trong vÃ­ dá»¥ nÃ y, giÃ¡ trá»‹ <code>p</code> khá»›p vá»›i arm thá»© hai vÃ¬ <code>x</code> chá»©a giÃ¡ trá»‹ 0,
do Ä‘Ã³ code sáº½ in ra <code>On the y axis at 7</code>.</p>
<p>HÃ£y nhá»› ráº±ng má»™t biá»ƒu thá»©c <code>match</code> sáº½ dá»«ng viá»‡c kiá»ƒm tra cÃ¡c arm khi
Ä‘Ã£ tÃ¬m tháº¥y pattern khá»›p Ä‘áº§u tiÃªn, nÃªn máº·c dÃ¹ <code>Point { x: 0, y: 0 }</code>
náº±m trÃªn cáº£ trá»¥c <code>x</code> vÃ  trá»¥c <code>y</code>, code nÃ y chá»‰ in ra <code>On the x axis at 0</code>.</p>
<h4 id="phÃ¡-cáº¥u-trÃºc-enum"><a class="header" href="#phÃ¡-cáº¥u-trÃºc-enum">PhÃ¡ cáº¥u trÃºc Enum</a></h4>
<p>ChÃºng ta Ä‘Ã£ phÃ¡ cáº¥u trÃºc cÃ¡c enum trong sÃ¡ch nÃ y (vÃ­ dá»¥, Listing 6-5 trong ChÆ°Æ¡ng 6),
nhÆ°ng chÆ°a bÃ n rÃµ rÃ ng ráº±ng pattern Ä‘á»ƒ phÃ¡ cáº¥u trÃºc má»™t enum tÆ°Æ¡ng á»©ng vá»›i cÃ¡ch dá»¯ liá»‡u
bÃªn trong enum Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. VÃ­ dá»¥, trong Listing 18-15 chÃºng ta dÃ¹ng enum <code>Message</code>
tá»« Listing 6-2 vÃ  viáº¿t má»™t <code>match</code> vá»›i cÃ¡c pattern Ä‘á»ƒ phÃ¡ cáº¥u trÃºc tá»«ng giÃ¡ trá»‹ bÃªn trong.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-15/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-15: PhÃ¡ cáº¥u trÃºc cÃ¡c biáº¿n thá»ƒ enum chá»©a cÃ¡c loáº¡i giÃ¡ trá»‹ khÃ¡c nhau</span></p>
<p>Code nÃ y sáº½ in ra <code>Change the color to red 0, green 160, and blue 255</code>.
HÃ£y thá»­ thay Ä‘á»•i giÃ¡ trá»‹ cá»§a <code>msg</code> Ä‘á»ƒ xem code tá»« cÃ¡c arm khÃ¡c cháº¡y.</p>
<p>Äá»‘i vá»›i cÃ¡c biáº¿n thá»ƒ enum khÃ´ng chá»©a dá»¯ liá»‡u, nhÆ° <code>Message::Quit</code>,
chÃºng ta khÃ´ng thá»ƒ phÃ¡ cáº¥u trÃºc thÃªm. ChÃºng ta chá»‰ cÃ³ thá»ƒ so khá»›p
vá»›i giÃ¡ trá»‹ literal <code>Message::Quit</code>, vÃ  khÃ´ng cÃ³ biáº¿n nÃ o trong pattern nÃ y.</p>
<p>Äá»‘i vá»›i cÃ¡c biáº¿n thá»ƒ enum giá»‘ng struct, nhÆ° <code>Message::Move</code>,
chÃºng ta cÃ³ thá»ƒ dÃ¹ng pattern tÆ°Æ¡ng tá»± nhÆ° pattern dÃ¹ng Ä‘á»ƒ so khá»›p struct.
Sau tÃªn biáº¿n thá»ƒ, Ä‘áº·t dáº¥u ngoáº·c nhá»n vÃ  liá»‡t kÃª cÃ¡c trÆ°á»ng vá»›i biáº¿n
Ä‘á»ƒ tÃ¡ch cÃ¡c pháº§n ra dÃ¹ng trong code cá»§a arm nÃ y.
á» Ä‘Ã¢y chÃºng ta dÃ¹ng dáº¡ng shorthand nhÆ° trong Listing 18-13.</p>
<p>Äá»‘i vá»›i cÃ¡c biáº¿n thá»ƒ enum giá»‘ng tuple, nhÆ° <code>Message::Write</code> chá»©a tuple
vá»›i má»™t pháº§n tá»­ vÃ  <code>Message::ChangeColor</code> chá»©a tuple vá»›i ba pháº§n tá»­,
pattern cÅ©ng tÆ°Æ¡ng tá»± nhÆ° pattern dÃ¹ng Ä‘á»ƒ so khá»›p tuple. Sá»‘ biáº¿n
trong pattern pháº£i khá»›p vá»›i sá»‘ pháº§n tá»­ trong biáº¿n thá»ƒ mÃ  chÃºng ta Ä‘ang so khá»›p.</p>
<h4 id="phÃ¡-cáº¥u-trÃºc-struct-vÃ -enum-lá»“ng-nhau"><a class="header" href="#phÃ¡-cáº¥u-trÃºc-struct-vÃ -enum-lá»“ng-nhau">PhÃ¡ cáº¥u trÃºc Struct vÃ  Enum lá»“ng nhau</a></h4>
<p>Cho Ä‘áº¿n nay, cÃ¡c vÃ­ dá»¥ cá»§a chÃºng ta Ä‘á»u so khá»›p struct hoáº·c enum má»™t cáº¥p,
nhÆ°ng matching cÅ©ng cÃ³ thá»ƒ lÃ m viá»‡c vá»›i cÃ¡c má»¥c lá»“ng nhau! VÃ­ dá»¥, chÃºng ta
cÃ³ thá»ƒ tÃ¡i cáº¥u trÃºc code trong Listing 18-15 Ä‘á»ƒ há»— trá»£ mÃ u RGB vÃ  HSV
trong thÃ´ng Ä‘iá»‡p <code>ChangeColor</code>, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 18-16.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-16/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-16: So khá»›p vá»›i enum lá»“ng nhau</span></p>
<p>Pattern cá»§a arm Ä‘áº§u tiÃªn trong biá»ƒu thá»©c <code>match</code> so khá»›p vá»›i biáº¿n thá»ƒ
enum <code>Message::ChangeColor</code> chá»©a má»™t biáº¿n thá»ƒ <code>Color::Rgb</code>;
sau Ä‘Ã³ pattern liÃªn káº¿t vá»›i ba giÃ¡ trá»‹ <code>i32</code> bÃªn trong.
Pattern cá»§a arm thá»© hai cÅ©ng so khá»›p vá»›i biáº¿n thá»ƒ enum <code>Message::ChangeColor</code>,
nhÆ°ng enum bÃªn trong so khá»›p vá»›i <code>Color::Hsv</code> thay vÃ o Ä‘Ã³.
ChÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh cÃ¡c Ä‘iá»u kiá»‡n phá»©c táº¡p nÃ y trong má»™t biá»ƒu thá»©c <code>match</code>, máº·c dÃ¹ liÃªn quan Ä‘áº¿n hai enum.</p>
<h4 id="phÃ¡-cáº¥u-trÃºc-struct-vÃ -tuple"><a class="header" href="#phÃ¡-cáº¥u-trÃºc-struct-vÃ -tuple">PhÃ¡ cáº¥u trÃºc Struct vÃ  Tuple</a></h4>
<p>ChÃºng ta cÃ³ thá»ƒ káº¿t há»£p, so khá»›p, vÃ  lá»“ng cÃ¡c pattern destructuring
theo nhá»¯ng cÃ¡ch phá»©c táº¡p hÆ¡n. VÃ­ dá»¥ sau Ä‘Ã¢y minh há»a má»™t destructure phá»©c táº¡p,
nÆ¡i chÃºng ta lá»“ng struct vÃ  tuple bÃªn trong má»™t tuple
vÃ  phÃ¡ cáº¥u trÃºc táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ nguyÃªn thá»§y ra:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/no-listing-05-destructuring-structs-and-tuples/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>MÃ£ nÃ y cho phÃ©p chÃºng ta tÃ¡ch cÃ¡c kiá»ƒu dá»¯ liá»‡u phá»©c táº¡p thÃ nh cÃ¡c pháº§n thÃ nh pháº§n Ä‘á»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c giÃ¡ trá»‹ mÃ  chÃºng ta quan tÃ¢m má»™t cÃ¡ch riÃªng biá»‡t.</p>
<p>PhÃ¡ cáº¥u trÃºc vá»›i cÃ¡c pattern lÃ  má»™t cÃ¡ch tiá»‡n lá»£i Ä‘á»ƒ sá»­ dá»¥ng tá»«ng pháº§n cá»§a giÃ¡ trá»‹, cháº³ng háº¡n nhÆ° giÃ¡ trá»‹ tá»« má»—i trÆ°á»ng trong má»™t struct, má»™t cÃ¡ch tÃ¡ch biá»‡t vá»›i nhau.</p>
<h3 id="bá»-qua-giÃ¡-trá»‹-trong-má»™t-pattern"><a class="header" href="#bá»-qua-giÃ¡-trá»‹-trong-má»™t-pattern">Bá» qua giÃ¡ trá»‹ trong má»™t pattern</a></h3>
<p>Báº¡n Ä‘Ã£ tháº¥y ráº±ng Ä‘Ã´i khi ráº¥t há»¯u Ã­ch khi bá» qua cÃ¡c giÃ¡ trá»‹ trong má»™t pattern, vÃ­ dá»¥ nhÆ° trong arm cuá»‘i cÃ¹ng cá»§a <code>match</code>, Ä‘á»ƒ cÃ³ má»™t catchall khÃ´ng thá»±c sá»± lÃ m gÃ¬ nhÆ°ng váº«n bao quÃ¡t táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ cÃ²n láº¡i. CÃ³ vÃ i cÃ¡ch Ä‘á»ƒ bá» qua toÃ n bá»™ giÃ¡ trá»‹ hoáº·c má»™t pháº§n giÃ¡ trá»‹ trong má»™t pattern: sá»­ dá»¥ng pattern <code>_</code> (nhÆ° báº¡n Ä‘Ã£ tháº¥y), sá»­ dá»¥ng pattern <code>_</code> bÃªn trong má»™t pattern khÃ¡c, sá»­ dá»¥ng tÃªn báº¯t Ä‘áº§u báº±ng dáº¥u gáº¡ch dÆ°á»›i, hoáº·c dÃ¹ng <code>..</code> Ä‘á»ƒ bá» qua cÃ¡c pháº§n cÃ²n láº¡i cá»§a giÃ¡ trá»‹. HÃ£y cÃ¹ng tÃ¬m hiá»ƒu cÃ¡ch vÃ  lÃ½ do sá»­ dá»¥ng tá»«ng pattern nÃ y.</p>
<h4 id="bá»-qua-toÃ n-bá»™-giÃ¡-trá»‹-vá»›i-_"><a class="header" href="#bá»-qua-toÃ n-bá»™-giÃ¡-trá»‹-vá»›i-_">Bá» qua toÃ n bá»™ giÃ¡ trá»‹ vá»›i <code>_</code></a></h4>
<p>ChÃºng ta Ä‘Ã£ sá»­ dá»¥ng dáº¥u gáº¡ch dÆ°á»›i nhÆ° má»™t wildcard pattern sáº½ so khá»›p vá»›i báº¥t ká»³ giÃ¡ trá»‹ nÃ o nhÆ°ng khÃ´ng liÃªn káº¿t vá»›i giÃ¡ trá»‹ Ä‘Ã³. Äiá»u nÃ y Ä‘áº·c biá»‡t há»¯u Ã­ch khi lÃ  arm cuá»‘i cÃ¹ng trong biá»ƒu thá»©c <code>match</code>, nhÆ°ng chÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ trong báº¥t ká»³ pattern nÃ o, bao gá»“m cáº£ tham sá»‘ cá»§a hÃ m, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 18-17.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-17/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-17: Sá»­ dá»¥ng <code>_</code> trong chá»¯ kÃ½ hÃ m</span></p>
<p>MÃ£ nÃ y sáº½ hoÃ n toÃ n bá» qua giÃ¡ trá»‹ <code>3</code> Ä‘Æ°á»£c truyá»n vÃ o lÃ m Ä‘á»‘i sá»‘ Ä‘áº§u tiÃªn, vÃ  sáº½ in ra <code>This code only uses the y parameter: 4</code>.</p>
<p>Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p khi báº¡n khÃ´ng cÃ²n cáº§n má»™t tham sá»‘ hÃ m cá»¥ thá»ƒ nÃ o Ä‘Ã³, báº¡n sáº½ thay Ä‘á»•i chá»¯ kÃ½ hÃ m Ä‘á»ƒ khÃ´ng bao gá»“m tham sá»‘ khÃ´ng sá»­ dá»¥ng. Viá»‡c bá» qua má»™t tham sá»‘ hÃ m Ä‘áº·c biá»‡t há»¯u Ã­ch trong cÃ¡c trÆ°á»ng há»£p, vÃ­ dá»¥, khi báº¡n Ä‘ang triá»ƒn khai má»™t trait vÃ  cáº§n má»™t chá»¯ kÃ½ kiá»ƒu nháº¥t Ä‘á»‹nh nhÆ°ng pháº§n thÃ¢n hÃ m trong triá»ƒn khai cá»§a báº¡n khÃ´ng cáº§n má»™t trong cÃ¡c tham sá»‘. Khi Ä‘Ã³, báº¡n trÃ¡nh Ä‘Æ°á»£c cáº£nh bÃ¡o tá»« trÃ¬nh biÃªn dá»‹ch vá» tham sá»‘ hÃ m khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng, nhÆ° sáº½ xáº£y ra náº¿u báº¡n Ä‘áº·t tÃªn cho tham sá»‘ Ä‘Ã³.</p>
<h4 id="bá»-qua-má»™t-pháº§n-giÃ¡-trá»‹-vá»›i-_-lá»“ng-nhau"><a class="header" href="#bá»-qua-má»™t-pháº§n-giÃ¡-trá»‹-vá»›i-_-lá»“ng-nhau">Bá» qua má»™t pháº§n giÃ¡ trá»‹ vá»›i <code>_</code> lá»“ng nhau</a></h4>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng <code>_</code> bÃªn trong má»™t pattern khÃ¡c Ä‘á»ƒ chá»‰ bá» qua má»™t pháº§n cá»§a giÃ¡ trá»‹, vÃ­ dá»¥, khi chÃºng ta muá»‘n kiá»ƒm tra chá»‰ má»™t pháº§n cá»§a giÃ¡ trá»‹ nhÆ°ng khÃ´ng cáº§n sá»­ dá»¥ng cÃ¡c pháº§n khÃ¡c trong mÃ£ tÆ°Æ¡ng á»©ng mÃ  chÃºng ta muá»‘n cháº¡y. Listing 18-18 cho tháº¥y mÃ£ chá»‹u trÃ¡ch nhiá»‡m quáº£n lÃ½ giÃ¡ trá»‹ cá»§a má»™t cÃ i Ä‘áº·t. YÃªu cáº§u nghiá»‡p vá»¥ lÃ  ngÆ°á»i dÃ¹ng khÃ´ng Ä‘Æ°á»£c phÃ©p ghi Ä‘Ã¨ má»™t tÃ¹y chá»‰nh cÃ i Ä‘áº·t Ä‘Ã£ tá»“n táº¡i nhÆ°ng cÃ³ thá»ƒ há»§y cÃ i Ä‘áº·t Ä‘Ã³ vÃ  Ä‘áº·t giÃ¡ trá»‹ náº¿u cÃ i Ä‘áº·t hiá»‡n Ä‘ang chÆ°a Ä‘Æ°á»£c thiáº¿t láº­p.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-18/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-18: Sá»­ dá»¥ng dáº¥u gáº¡ch dÆ°á»›i <code>_</code> trong cÃ¡c pattern
khá»›p vá»›i cÃ¡c biáº¿n thá»ƒ <code>Some</code> khi chÃºng ta khÃ´ng cáº§n dÃ¹ng giÃ¡ trá»‹ bÃªn trong <code>Some</code></span></p>
<p>MÃ£ nÃ y sáº½ in ra <code>Can't overwrite an existing customized value</code> vÃ  sau Ä‘Ã³ lÃ  <code>setting is Some(5)</code>. Trong nhÃ¡nh match Ä‘áº§u tiÃªn, chÃºng ta khÃ´ng cáº§n khá»›p hoáº·c sá»­ dá»¥ng cÃ¡c giÃ¡ trá»‹ bÃªn trong báº¥t ká»³ biáº¿n thá»ƒ <code>Some</code> nÃ o, nhÆ°ng chÃºng ta cáº§n kiá»ƒm tra trÆ°á»ng há»£p khi <code>setting_value</code> vÃ  <code>new_setting_value</code> lÃ  biáº¿n thá»ƒ <code>Some</code>. Trong trÆ°á»ng há»£p Ä‘Ã³, chÃºng ta in lÃ½ do khÃ´ng thay Ä‘á»•i <code>setting_value</code>, vÃ  giÃ¡ trá»‹ nÃ y sáº½ khÃ´ng bá»‹ thay Ä‘á»•i.</p>
<p>Trong táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p khÃ¡c (náº¿u má»™t trong <code>setting_value</code> hoáº·c <code>new_setting_value</code> lÃ  <code>None</code>) Ä‘Æ°á»£c biá»ƒu diá»…n báº±ng pattern <code>_</code> trong nhÃ¡nh thá»© hai, chÃºng ta cho phÃ©p <code>new_setting_value</code> trá»Ÿ thÃ nh <code>setting_value</code>.</p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng dáº¥u gáº¡ch dÆ°á»›i <code>_</code> á»Ÿ nhiá»u vá»‹ trÃ­ trong má»™t pattern Ä‘á»ƒ bá» qua cÃ¡c giÃ¡ trá»‹ cá»¥ thá»ƒ. Listing 18-19 Ä‘Æ°a ra vÃ­ dá»¥ bá» qua giÃ¡ trá»‹ thá»© hai vÃ  thá»© tÆ° trong má»™t tuple gá»“m nÄƒm pháº§n tá»­.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-19/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-19: Bá» qua nhiá»u pháº§n cá»§a má»™t tuple</span></p>
<p>MÃ£ nÃ y sáº½ in ra <code>Some numbers: 2, 8, 32</code>, vÃ  cÃ¡c giÃ¡ trá»‹ 4 vÃ  16 sáº½ bá»‹ bá» qua.</p>
<h4 id="bá»-qua-biáº¿n-khÃ´ng-sá»­-dá»¥ng-báº±ng-cÃ¡ch-Ä‘áº·t-tÃªn-biáº¿n-báº¯t-Ä‘áº§u-báº±ng-_"><a class="header" href="#bá»-qua-biáº¿n-khÃ´ng-sá»­-dá»¥ng-báº±ng-cÃ¡ch-Ä‘áº·t-tÃªn-biáº¿n-báº¯t-Ä‘áº§u-báº±ng-_">Bá» qua biáº¿n khÃ´ng sá»­ dá»¥ng báº±ng cÃ¡ch Ä‘áº·t tÃªn biáº¿n báº¯t Ä‘áº§u báº±ng <code>_</code></a></h4>
<p>Náº¿u báº¡n táº¡o má»™t biáº¿n nhÆ°ng khÃ´ng sá»­ dá»¥ng nÃ³ á»Ÿ báº¥t ká»³ Ä‘Ã¢u, Rust thÆ°á»ng sáº½ Ä‘Æ°a ra cáº£nh bÃ¡o vÃ¬ má»™t biáº¿n khÃ´ng sá»­ dá»¥ng cÃ³ thá»ƒ lÃ  má»™t lá»—i. Tuy nhiÃªn, Ä‘Ã´i khi viá»‡c táº¡o má»™t biáº¿n mÃ  báº¡n chÆ°a dÃ¹ng Ä‘áº¿n cÅ©ng há»¯u Ã­ch, vÃ­ dá»¥ khi báº¡n Ä‘ang thá»­ nghiá»‡m hoáº·c má»›i báº¯t Ä‘áº§u má»™t dá»± Ã¡n. Trong trÆ°á»ng há»£p nÃ y, báº¡n cÃ³ thá»ƒ báº£o Rust khÃ´ng cáº£nh bÃ¡o vá» biáº¿n khÃ´ng sá»­ dá»¥ng báº±ng cÃ¡ch Ä‘áº·t tÃªn biáº¿n báº¯t Ä‘áº§u báº±ng dáº¥u gáº¡ch dÆ°á»›i <code>_</code>. Trong Listing 18-20, chÃºng ta táº¡o hai biáº¿n khÃ´ng sá»­ dá»¥ng, nhÆ°ng khi biÃªn dá»‹ch mÃ£ nÃ y, chÃºng ta chá»‰ nháº­n cáº£nh bÃ¡o vá» má»™t trong sá»‘ chÃºng.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-20/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-20: Äáº·t tÃªn biáº¿n báº¯t Ä‘áº§u báº±ng dáº¥u gáº¡ch dÆ°á»›i Ä‘á»ƒ trÃ¡nh cáº£nh bÃ¡o biáº¿n khÃ´ng sá»­ dá»¥ng</span></p>
<p>á» Ä‘Ã¢y, chÃºng ta nháº­n Ä‘Æ°á»£c cáº£nh bÃ¡o vá» viá»‡c khÃ´ng sá»­ dá»¥ng biáº¿n <code>y</code>, nhÆ°ng khÃ´ng cÃ³ cáº£nh bÃ¡o vá» viá»‡c khÃ´ng sá»­ dá»¥ng <code>_x</code>.</p>
<p>LÆ°u Ã½ ráº±ng cÃ³ má»™t sá»± khÃ¡c biá»‡t tinh táº¿ giá»¯a viá»‡c chá»‰ dÃ¹ng <code>_</code> vÃ  dÃ¹ng má»™t tÃªn báº¯t Ä‘áº§u báº±ng dáº¥u gáº¡ch dÆ°á»›i. CÃº phÃ¡p <code>_x</code> váº«n gÃ¡n giÃ¡ trá»‹ cho biáº¿n <code>_x</code>, trong khi <code>_</code> khÃ´ng gÃ¡n gÃ¬ cáº£. Äá»ƒ minh há»a trÆ°á»ng há»£p mÃ  sá»± khÃ¡c biá»‡t nÃ y quan trá»ng, Listing 18-21 sáº½ cung cáº¥p cho chÃºng ta má»™t lá»—i.</p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-21/src/main.rs:here}}</code></pre>
<p><span class="caption">Listing 18-21: Má»™t biáº¿n khÃ´ng sá»­ dá»¥ng báº¯t Ä‘áº§u báº±ng dáº¥u gáº¡ch dÆ°á»›i váº«n gÃ¡n giÃ¡ trá»‹, Ä‘iá»u nÃ y cÃ³ thá»ƒ chiáº¿m quyá»n sá»Ÿ há»¯u giÃ¡ trá»‹</span></p>
<p>ChÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i vÃ¬ giÃ¡ trá»‹ <code>s</code> váº«n bá»‹ chuyá»ƒn vÃ o <code>_s</code>, Ä‘iá»u nÃ y ngÄƒn chÃºng ta sá»­ dá»¥ng láº¡i <code>s</code>. Tuy nhiÃªn, viá»‡c chá»‰ dÃ¹ng dáº¥u gáº¡ch dÆ°á»›i <code>_</code> sáº½ khÃ´ng bao giá» gÃ¡n giÃ¡ trá»‹. Listing 18-22 sáº½ biÃªn dá»‹ch mÃ  khÃ´ng cÃ³ lá»—i nÃ o vÃ¬ <code>s</code> khÃ´ng bá»‹ chuyá»ƒn vÃ o <code>_</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-22/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-22: Sá»­ dá»¥ng dáº¥u gáº¡ch dÆ°á»›i khÃ´ng gÃ¡n giÃ¡ trá»‹</span></p>
<p>Äoáº¡n mÃ£ nÃ y hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng vÃ¬ chÃºng ta khÃ´ng bao giá» gÃ¡n <code>s</code> cho báº¥t cá»© thá»© gÃ¬; nÃ³ khÃ´ng bá»‹ di chuyá»ƒn.</p>
<h4 id="bá»-qua-cÃ¡c-pháº§n-cÃ²n-láº¡i-cá»§a-giÃ¡-trá»‹-vá»›i-"><a class="header" href="#bá»-qua-cÃ¡c-pháº§n-cÃ²n-láº¡i-cá»§a-giÃ¡-trá»‹-vá»›i-">Bá» qua cÃ¡c pháº§n cÃ²n láº¡i cá»§a giÃ¡ trá»‹ vá»›i <code>..</code></a></h4>
<p>Vá»›i cÃ¡c giÃ¡ trá»‹ cÃ³ nhiá»u pháº§n, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃº phÃ¡p <code>..</code> Ä‘á»ƒ dÃ¹ng má»™t sá»‘ pháº§n cá»¥ thá»ƒ vÃ  bá» qua pháº§n cÃ²n láº¡i, trÃ¡nh pháº£i liá»‡t kÃª nhiá»u dáº¥u gáº¡ch dÆ°á»›i cho tá»«ng giÃ¡ trá»‹ bá»‹ bá» qua. Máº«u <code>..</code> bá» qua báº¥t ká»³ pháº§n nÃ o cá»§a giÃ¡ trá»‹ mÃ  chÃºng ta chÆ°a khá»›p rÃµ rÃ ng trong pháº§n cÃ²n láº¡i cá»§a máº«u. Trong Listing 18-23, chÃºng ta cÃ³ má»™t struct <code>Point</code> chá»©a tá»a Ä‘á»™ trong khÃ´ng gian ba chiá»u. Trong biá»ƒu thá»©c <code>match</code>, chÃºng ta chá»‰ muá»‘n thao tÃ¡c trÃªn tá»a Ä‘á»™ <code>x</code> vÃ  bá» qua cÃ¡c giÃ¡ trá»‹ trong cÃ¡c trÆ°á»ng <code>y</code> vÃ  <code>z</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-23/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-23: Bá» qua táº¥t cáº£ cÃ¡c trÆ°á»ng cá»§a <code>Point</code> ngoáº¡i trá»« <code>x</code> báº±ng cÃ¡ch sá»­ dá»¥ng <code>..</code></span></p>
<p>ChÃºng ta liá»‡t kÃª giÃ¡ trá»‹ <code>x</code> vÃ  sau Ä‘Ã³ chá»‰ bao gá»“m máº«u <code>..</code>. CÃ¡ch nÃ y nhanh hÆ¡n so vá»›i viá»‡c pháº£i liá»‡t kÃª <code>y: _</code> vÃ  <code>z: _</code>, Ä‘áº·c biá»‡t khi lÃ m viá»‡c vá»›i cÃ¡c struct cÃ³ nhiá»u trÆ°á»ng trong nhá»¯ng trÆ°á»ng há»£p chá»‰ má»™t hoáº·c hai trÆ°á»ng lÃ  cáº§n thiáº¿t.</p>
<p>CÃº phÃ¡p <code>..</code> sáº½ má»Ÿ rá»™ng ra Ä‘á»§ sá»‘ lÆ°á»£ng giÃ¡ trá»‹ cáº§n thiáº¿t. Listing 18-24 cho tháº¥y cÃ¡ch sá»­ dá»¥ng <code>..</code> vá»›i má»™t tuple.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-24/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-24: Chá»‰ khá»›p giÃ¡ trá»‹ Ä‘áº§u vÃ  cuá»‘i trong má»™t tuple vÃ  bá» qua táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ khÃ¡c</span></p>
<p>Trong Ä‘oáº¡n code nÃ y, giÃ¡ trá»‹ Ä‘áº§u vÃ  cuá»‘i Ä‘Æ°á»£c khá»›p vá»›i <code>first</code> vÃ  <code>last</code>. Máº«u <code>..</code> sáº½ khá»›p vÃ  bá» qua táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ á»Ÿ giá»¯a.</p>
<p>Tuy nhiÃªn, viá»‡c sá»­ dá»¥ng <code>..</code> pháº£i rÃµ rÃ ng. Náº¿u khÃ´ng rÃµ giÃ¡ trá»‹ nÃ o cáº§n khá»›p vÃ  giÃ¡ trá»‹ nÃ o cáº§n bá» qua, Rust sáº½ bÃ¡o lá»—i. Listing 18-25 cho tháº¥y má»™t vÃ­ dá»¥ sá»­ dá»¥ng <code>..</code> má»™t cÃ¡ch mÆ¡ há»“, vÃ¬ váº­y sáº½ khÃ´ng biÃªn dá»‹ch Ä‘Æ°á»£c.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-25/src/main.rs}}</code></pre>
<p><span class="caption">Listing 18-25: Cá»‘ gáº¯ng sá»­ dá»¥ng <code>..</code> má»™t cÃ¡ch mÆ¡ há»“</span></p>
<p>Khi biÃªn dá»‹ch vÃ­ dá»¥ nÃ y, chÃºng ta nháº­n Ä‘Æ°á»£c lá»—i sau:</p>
<pre><code class="language-console">{{#include ../listings/ch18-patterns-and-matching/listing-18-25/output.txt}}
</code></pre>
<p>Viá»‡c Rust khÃ´ng thá»ƒ xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c bao nhiÃªu giÃ¡ trá»‹ trong tuple sáº½ bá»‹
bá» qua trÆ°á»›c khi so khá»›p vá»›i giÃ¡ trá»‹ <code>second</code>, vÃ  sau Ä‘Ã³ bao nhiÃªu giÃ¡ trá»‹ tiáº¿p theo bá»‹ bá» qua.
MÃ£ nÃ y cÃ³ thá»ƒ cÃ³ nghÄ©a lÃ  chÃºng ta muá»‘n bá» qua <code>2</code>, gÃ¡n <code>second</code> lÃ  <code>4</code>,
vÃ  sau Ä‘Ã³ bá» qua <code>8</code>, <code>16</code>, vÃ  <code>32</code>; hoáº·c bá» qua <code>2</code> vÃ  <code>4</code>, gÃ¡n <code>second</code> lÃ  <code>8</code>,
vÃ  sau Ä‘Ã³ bá» qua <code>16</code> vÃ  <code>32</code>; v.v. TÃªn biáº¿n <code>second</code> khÃ´ng cÃ³ Ã½ nghÄ©a Ä‘áº·c biá»‡t vá»›i Rust,
vÃ¬ váº­y chÃºng ta nháº­n Ä‘Æ°á»£c lá»—i biÃªn dá»‹ch vÃ¬ viá»‡c sá»­ dá»¥ng <code>..</code> á»Ÿ hai vá»‹ trÃ­ nhÆ° váº­y lÃ  mÆ¡ há»“.</p>
<h3 id="Äiá»u-kiá»‡n-bá»•-sung-vá»›i-match-guards"><a class="header" href="#Äiá»u-kiá»‡n-bá»•-sung-vá»›i-match-guards">Äiá»u kiá»‡n bá»• sung vá»›i Match Guards</a></h3>
<p><em>Match guard</em> lÃ  má»™t Ä‘iá»u kiá»‡n <code>if</code> bá»• sung, Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh sau pattern
trong má»™t nhÃ¡nh <code>match</code>, vÃ  Ä‘iá»u kiá»‡n nÃ y cÅ©ng pháº£i Ä‘Ãºng Ä‘á»ƒ nhÃ¡nh Ä‘Ã³ Ä‘Æ°á»£c chá»n.
Match guards há»¯u Ã­ch Ä‘á»ƒ biá»ƒu diá»…n cÃ¡c Ã½ tÆ°á»Ÿng phá»©c táº¡p hÆ¡n so vá»›i viá»‡c chá»‰ dÃ¹ng pattern.</p>
<p>Äiá»u kiá»‡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c biáº¿n Ä‘Æ°á»£c táº¡o ra trong pattern.
Listing 18-26 minh há»a má»™t <code>match</code> mÃ  nhÃ¡nh Ä‘áº§u tiÃªn cÃ³ pattern <code>Some(x)</code>
vÃ  Ä‘á»“ng thá»i cÃ³ match guard <code>if x % 2 == 0</code> (Ä‘iá»u nÃ y sáº½ Ä‘Ãºng náº¿u sá»‘ lÃ  cháºµn).</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-26/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-26: ThÃªm match guard vÃ o má»™t pattern</span></p>
<p>VÃ­ dá»¥ nÃ y sáº½ in ra <code>The number 4 is even</code>. Khi <code>num</code>
Ä‘Æ°á»£c so khá»›p vá»›i pattern á»Ÿ nhÃ¡nh Ä‘áº§u tiÃªn, nÃ³ khá»›p vÃ¬ <code>Some(4)</code> khá»›p vá»›i <code>Some(x)</code>.
Sau Ä‘Ã³, match guard kiá»ƒm tra xem pháº§n dÆ° khi chia <code>x</code>
cho 2 cÃ³ báº±ng 0 khÃ´ng, vÃ  vÃ¬ báº±ng 0, nhÃ¡nh Ä‘áº§u tiÃªn Ä‘Æ°á»£c chá»n.</p>
<p>Náº¿u <code>num</code> lÃ  <code>Some(5)</code>, match guard á»Ÿ nhÃ¡nh Ä‘áº§u tiÃªn sáº½ tráº£ vá» false
vÃ¬ pháº§n dÆ° cá»§a 5 chia 2 lÃ  1, khÃ´ng báº±ng 0. Rust sáº½ chuyá»ƒn sang nhÃ¡nh thá»© hai,
nhÃ¡nh nÃ y khá»›p vÃ¬ nhÃ¡nh thá»© hai khÃ´ng cÃ³ match guard vÃ  do Ä‘Ã³ khá»›p vá»›i báº¥t ká»³ biáº¿n thá»ƒ <code>Some</code> nÃ o.</p>
<p>KhÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ biá»ƒu diá»…n Ä‘iá»u kiá»‡n <code>if x % 2 == 0</code> trong má»™t pattern,
vÃ¬ váº­y match guard cho phÃ©p chÃºng ta diá»…n Ä‘áº¡t logic nÃ y.
NhÆ°á»£c Ä‘iá»ƒm cá»§a kháº£ nÄƒng biá»ƒu diá»…n bá»• sung nÃ y lÃ  trÃ¬nh biÃªn dá»‹ch
sáº½ khÃ´ng kiá»ƒm tra tÃ­nh Ä‘áº§y Ä‘á»§ (exhaustiveness) khi cÃ³ cÃ¡c biá»ƒu thá»©c match guard.</p>
<p>Trong Listing 18-11, chÃºng ta Ä‘Ã£ Ä‘á» cáº­p ráº±ng cÃ³ thá»ƒ dÃ¹ng match guards Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» shadowing biáº¿n trong pattern. HÃ£y nhá»› ráº±ng chÃºng ta Ä‘Ã£ táº¡o má»™t biáº¿n má»›i bÃªn trong pattern trong biá»ƒu thá»©c <code>match</code> thay vÃ¬ dÃ¹ng biáº¿n bÃªn ngoÃ i <code>match</code>. Biáº¿n má»›i nÃ y khiáº¿n chÃºng ta khÃ´ng thá»ƒ kiá»ƒm tra giÃ¡ trá»‹ cá»§a biáº¿n bÃªn ngoÃ i. Listing 18-27 minh há»a cÃ¡ch dÃ¹ng match guard Ä‘á»ƒ kháº¯c phá»¥c váº¥n Ä‘á» nÃ y.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-27/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-27: Sá»­ dá»¥ng match guard Ä‘á»ƒ kiá»ƒm tra báº±ng vá»›i biáº¿n bÃªn ngoÃ i</span></p>
<p>MÃ£ nÃ y giá» sáº½ in ra <code>Default case, x = Some(5)</code>. Pattern trong nhÃ¡nh thá»© hai khÃ´ng táº¡o ra má»™t biáº¿n má»›i <code>y</code> Ä‘á»ƒ shadow biáº¿n <code>y</code> bÃªn ngoÃ i, cÃ³ nghÄ©a lÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng biáº¿n <code>y</code> bÃªn ngoÃ i trong match guard. Thay vÃ¬ chá»‰ Ä‘á»‹nh pattern lÃ  <code>Some(y)</code>, Ä‘iá»u nÃ y sáº½ shadow biáº¿n <code>y</code> bÃªn ngoÃ i, chÃºng ta chá»‰ Ä‘á»‹nh <code>Some(n)</code>. Äiá»u nÃ y táº¡o ra má»™t biáº¿n má»›i <code>n</code> khÃ´ng shadow báº¥t cá»© gÃ¬ vÃ¬ bÃªn ngoÃ i <code>match</code> khÃ´ng cÃ³ biáº¿n <code>n</code>.</p>
<p>Match guard <code>if n == y</code> khÃ´ng pháº£i lÃ  má»™t pattern vÃ  do Ä‘Ã³ khÃ´ng táº¡o biáº¿n má»›i. Biáº¿n <code>y</code> nÃ y <em>lÃ </em> biáº¿n <code>y</code> bÃªn ngoÃ i, khÃ´ng pháº£i má»™t <code>y</code> má»›i bá»‹ shadow, vÃ  chÃºng ta cÃ³ thá»ƒ tÃ¬m giÃ¡ trá»‹ cÃ³ cÃ¹ng giÃ¡ trá»‹ vá»›i biáº¿n <code>y</code> bÃªn ngoÃ i báº±ng cÃ¡ch so sÃ¡nh <code>n</code> vá»›i <code>y</code>.</p>
<p>Báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng toÃ¡n tá»­ <em>or</em> <code>|</code> trong match guard Ä‘á»ƒ chá»‰ Ä‘á»‹nh nhiá»u pattern; Ä‘iá»u kiá»‡n match guard sáº½ Ã¡p dá»¥ng cho táº¥t cáº£ cÃ¡c pattern. Listing 18-28 minh há»a thá»© tá»± Æ°u tiÃªn khi káº¿t há»£p pattern dÃ¹ng <code>|</code> vá»›i match guard. Pháº§n quan trá»ng cá»§a vÃ­ dá»¥ nÃ y lÃ  match guard <code>if y</code> Ã¡p dá»¥ng cho <code>4</code>, <code>5</code>, <em>vÃ </em> <code>6</code>, máº·c dÃ¹ cÃ³ váº» nhÆ° <code>if y</code> chá»‰ Ã¡p dá»¥ng cho <code>6</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-28/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-28: Káº¿t há»£p nhiá»u pattern vá»›i match guard</span></p>
<p>Äiá»u kiá»‡n match chá»‰ ra ráº±ng nhÃ¡nh nÃ y chá»‰ Ä‘Æ°á»£c chá»n náº¿u giÃ¡ trá»‹ cá»§a <code>x</code> báº±ng <code>4</code>, <code>5</code> hoáº·c <code>6</code> <em>vÃ </em> náº¿u <code>y</code> lÃ  <code>true</code>. Khi Ä‘oáº¡n mÃ£ nÃ y cháº¡y, pattern cá»§a nhÃ¡nh Ä‘áº§u tiÃªn khá»›p vÃ¬ <code>x</code> lÃ  <code>4</code>, nhÆ°ng match guard <code>if y</code> lÃ  false, nÃªn nhÃ¡nh Ä‘áº§u tiÃªn khÃ´ng Ä‘Æ°á»£c chá»n. ChÆ°Æ¡ng trÃ¬nh tiáº¿p tá»¥c sang nhÃ¡nh thá»© hai, nhÃ¡nh nÃ y khá»›p, vÃ  chÆ°Æ¡ng trÃ¬nh in ra <code>no</code>. NguyÃªn nhÃ¢n lÃ  Ä‘iá»u kiá»‡n <code>if</code> Ã¡p dá»¥ng cho toÃ n bá»™ pattern <code>4 | 5 | 6</code>, khÃ´ng chá»‰ giÃ¡ trá»‹ cuá»‘i cÃ¹ng <code>6</code>. NÃ³i cÃ¡ch khÃ¡c, thá»© tá»± Æ°u tiÃªn cá»§a match guard so vá»›i pattern Ä‘Æ°á»£c hiá»ƒu nhÆ° sau:</p>
<pre><code class="language-text">(4 | 5 | 6) if y =&gt; ...
</code></pre>
<p>rather than this:</p>
<pre><code class="language-text">4 | 5 | (6 if y) =&gt; ...
</code></pre>
<p>Sau khi cháº¡y mÃ£, hÃ nh vi Æ°u tiÃªn trá»Ÿ nÃªn rÃµ rÃ ng: náº¿u match guard chá»‰ Ã¡p dá»¥ng cho giÃ¡ trá»‹ cuá»‘i cÃ¹ng trong danh sÃ¡ch cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh báº±ng toÃ¡n tá»­ <code>|</code>, nhÃ¡nh Ä‘Ã³ sáº½ khá»›p vÃ  chÆ°Æ¡ng trÃ¬nh sáº½ in ra <code>yes</code>.</p>
<h3 id="gÃ¡n-vá»›i-"><a class="header" href="#gÃ¡n-vá»›i-">GÃ¡n vá»›i <code>@</code></a></h3>
<p>ToÃ¡n tá»­ <em>at</em> <code>@</code> cho phÃ©p chÃºng ta táº¡o má»™t biáº¿n giá»¯ giÃ¡ trá»‹ Ä‘á»“ng thá»i vá»›i viá»‡c kiá»ƒm tra giÃ¡ trá»‹ Ä‘Ã³ Ä‘á»ƒ khá»›p vá»›i pattern. Trong Listing 18-29, chÃºng ta muá»‘n kiá»ƒm tra ráº±ng trÆ°á»ng <code>id</code> cá»§a <code>Message::Hello</code> náº±m trong pháº¡m vi <code>3..=7</code>. Äá»“ng thá»i, chÃºng ta muá»‘n gÃ¡n giÃ¡ trá»‹ nÃ y cho biáº¿n <code>id_variable</code> Ä‘á»ƒ sá»­ dá»¥ng trong mÃ£ cá»§a nhÃ¡nh. ChÃºng ta cÃ³ thá»ƒ Ä‘áº·t tÃªn biáº¿n nÃ y lÃ  <code>id</code>, giá»‘ng nhÆ° tÃªn trÆ°á»ng, nhÆ°ng trong vÃ­ dá»¥ nÃ y sáº½ dÃ¹ng má»™t tÃªn khÃ¡c.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-29/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 18-29: Sá»­ dá»¥ng <code>@</code> Ä‘á»ƒ gÃ¡n giÃ¡ trá»‹ trong má»™t pattern Ä‘á»“ng thá»i kiá»ƒm tra nÃ³</span></p>
<p>VÃ­ dá»¥ nÃ y sáº½ in ra <code>Found an id in range: 5</code>. Báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh <code>id_variable @</code> trÆ°á»›c pháº¡m vi <code>3..=7</code>, chÃºng ta Ä‘ang náº¯m báº¯t báº¥t ká»³ giÃ¡ trá»‹ nÃ o khá»›p vá»›i pháº¡m vi Ä‘á»“ng thá»i kiá»ƒm tra ráº±ng giÃ¡ trá»‹ Ä‘Ã³ khá»›p vá»›i pattern pháº¡m vi.</p>
<p>Trong nhÃ¡nh thá»© hai, nÆ¡i chá»‰ cÃ³ má»™t pháº¡m vi Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong pattern, mÃ£ liÃªn quan Ä‘áº¿n nhÃ¡nh khÃ´ng cÃ³ biáº¿n nÃ o chá»©a giÃ¡ trá»‹ thá»±c táº¿ cá»§a trÆ°á»ng <code>id</code>. GiÃ¡ trá»‹ trÆ°á»ng <code>id</code> cÃ³ thá»ƒ lÃ  10, 11, hoáº·c 12, nhÆ°ng mÃ£ Ä‘i kÃ¨m vá»›i pattern Ä‘Ã³ khÃ´ng biáº¿t giÃ¡ trá»‹ nÃ o. MÃ£ pattern khÃ´ng thá»ƒ sá»­ dá»¥ng giÃ¡ trá»‹ tá»« trÆ°á»ng <code>id</code>, vÃ¬ chÃºng ta chÆ°a lÆ°u giÃ¡ trá»‹ <code>id</code> vÃ o má»™t biáº¿n.</p>
<p>Trong nhÃ¡nh cuá»‘i cÃ¹ng, nÆ¡i chÃºng ta Ä‘Ã£ chá»‰ Ä‘á»‹nh má»™t biáº¿n mÃ  khÃ´ng cÃ³ pháº¡m vi, chÃºng ta cÃ³ giÃ¡ trá»‹ sáºµn Ä‘á»ƒ sá»­ dá»¥ng trong mÃ£ nhÃ¡nh thÃ´ng qua biáº¿n cÃ³ tÃªn <code>id</code>. LÃ½ do lÃ  chÃºng ta Ä‘Ã£ sá»­ dá»¥ng cÃº phÃ¡p viáº¿t táº¯t cho trÆ°á»ng struct. NhÆ°ng chÃºng ta khÃ´ng Ã¡p dá»¥ng báº¥t ká»³ kiá»ƒm tra nÃ o cho giÃ¡ trá»‹ trong trÆ°á»ng <code>id</code> trong nhÃ¡nh nÃ y, nhÆ° Ä‘Ã£ lÃ m vá»›i hai nhÃ¡nh Ä‘áº§u: báº¥t ká»³ giÃ¡ trá»‹ nÃ o cÅ©ng sáº½ khá»›p vá»›i pattern nÃ y.</p>
<p>Sá»­ dá»¥ng <code>@</code> cho phÃ©p chÃºng ta vá»«a kiá»ƒm tra giÃ¡ trá»‹ vá»«a lÆ°u nÃ³ vÃ o má»™t biáº¿n trong cÃ¹ng má»™t pattern.</p>
<h2 id="tÃ³m-táº¯t-8"><a class="header" href="#tÃ³m-táº¯t-8">TÃ³m táº¯t</a></h2>
<p>CÃ¡c pattern trong Rust ráº¥t há»¯u Ã­ch Ä‘á»ƒ phÃ¢n biá»‡t cÃ¡c loáº¡i dá»¯ liá»‡u khÃ¡c nhau. Khi sá»­ dá»¥ng trong biá»ƒu thá»©c <code>match</code>, Rust Ä‘áº£m báº£o cÃ¡c pattern cá»§a báº¡n bao phá»§ má»i giÃ¡ trá»‹ cÃ³ thá»ƒ, náº¿u khÃ´ng chÆ°Æ¡ng trÃ¬nh sáº½ khÃ´ng biÃªn dá»‹ch. CÃ¡c pattern trong cÃ¡c cÃ¢u lá»‡nh <code>let</code> vÃ  tham sá»‘ hÃ m lÃ m cho cÃ¡c cáº¥u trÃºc nÃ y há»¯u Ã­ch hÆ¡n, cho phÃ©p phÃ¡ cáº¥u trÃºc cÃ¡c giÃ¡ trá»‹ thÃ nh cÃ¡c pháº§n nhá» hÆ¡n Ä‘á»“ng thá»i gÃ¡n cho cÃ¡c biáº¿n. ChÃºng ta cÃ³ thá»ƒ táº¡o cÃ¡c pattern Ä‘Æ¡n giáº£n hoáº·c phá»©c táº¡p tÃ¹y theo nhu cáº§u.</p>
<p>Tiáº¿p theo, trong chÆ°Æ¡ng Ã¡p chÃ³t cá»§a cuá»‘n sÃ¡ch, chÃºng ta sáº½ xem xÃ©t má»™t sá»‘ khÃ­a cáº¡nh nÃ¢ng cao cá»§a nhiá»u tÃ­nh nÄƒng trong Rust.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cÃ¡c-tÃ­nh-nÄƒng-nÃ¢ng-cao"><a class="header" href="#cÃ¡c-tÃ­nh-nÄƒng-nÃ¢ng-cao">CÃ¡c TÃ­nh NÄƒng NÃ¢ng Cao</a></h1>
<p>Äáº¿n giá», báº¡n Ä‘Ã£ há»c Ä‘Æ°á»£c cÃ¡c pháº§n thÆ°á»ng dÃ¹ng nháº¥t cá»§a ngÃ´n ngá»¯ láº­p trÃ¬nh Rust. TrÆ°á»›c khi thá»±c hiá»‡n thÃªm má»™t dá»± Ã¡n ná»¯a trong ChÆ°Æ¡ng 20, chÃºng ta sáº½ xem qua má»™t vÃ i khÃ­a cáº¡nh cá»§a ngÃ´n ngá»¯ mÃ  báº¡n cÃ³ thá»ƒ gáº·p Ä‘Ã´i khi, nhÆ°ng khÃ´ng sá»­ dá»¥ng hÃ ng ngÃ y. Báº¡n cÃ³ thá»ƒ dÃ¹ng chÆ°Æ¡ng nÃ y nhÆ° má»™t tÃ i liá»‡u tham kháº£o khi gáº·p cÃ¡c khÃ¡i niá»‡m chÆ°a quen. Nhá»¯ng tÃ­nh nÄƒng Ä‘Æ°á»£c trÃ¬nh bÃ y á»Ÿ Ä‘Ã¢y há»¯u Ã­ch trong cÃ¡c tÃ¬nh huá»‘ng ráº¥t cá»¥ thá»ƒ. Máº·c dÃ¹ báº¡n cÃ³ thá»ƒ khÃ´ng dÃ¹ng chÃºng thÆ°á»ng xuyÃªn, chÃºng tÃ´i muá»‘n Ä‘áº£m báº£o ráº±ng báº¡n náº¯m vá»¯ng táº¥t cáº£ cÃ¡c tÃ­nh nÄƒng mÃ  Rust cung cáº¥p.</p>
<p>Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ Ä‘á» cáº­p Ä‘áº¿n:</p>
<ul>
<li><strong>Unsafe Rust</strong>: cÃ¡ch bá» qua má»™t sá»‘ Ä‘áº£m báº£o cá»§a Rust vÃ  tá»± chá»‹u trÃ¡ch nhiá»‡m duy trÃ¬ cÃ¡c Ä‘áº£m báº£o Ä‘Ã³ báº±ng tay.</li>
<li><strong>CÃ¡c trait nÃ¢ng cao</strong>: associated types, default type parameters, fully qualified syntax, supertraits, vÃ  newtype pattern liÃªn quan Ä‘áº¿n traits.</li>
<li><strong>CÃ¡c loáº¡i nÃ¢ng cao</strong>: tÃ¬m hiá»ƒu thÃªm vá» newtype pattern, type aliases, never type, vÃ  dynamically sized types.</li>
<li><strong>CÃ¡c hÃ m vÃ  closure nÃ¢ng cao</strong>: function pointers vÃ  cÃ¡ch tráº£ vá» closure.</li>
<li><strong>Macros</strong>: cÃ¡ch Ä‘á»‹nh nghÄ©a code táº¡o ra thÃªm code táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch.</li>
</ul>
<p>ÄÃ¢y lÃ  má»™t bá»™ sÆ°u táº­p cÃ¡c tÃ­nh nÄƒng cá»§a Rust vá»›i Ä‘á»§ thá»© dÃ nh cho má»i ngÆ°á»i! HÃ£y báº¯t Ä‘áº§u khÃ¡m phÃ¡!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="unsafe-rust"><a class="header" href="#unsafe-rust">Unsafe Rust</a></h2>
<p>Táº¥t cáº£ code mÃ  chÃºng ta Ä‘Ã£ tháº£o luáº­n cho Ä‘áº¿n giá» Ä‘á»u Ä‘Æ°á»£c Rust
Ä‘áº£m báº£o an toÃ n bá»™ nhá»› táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch. Tuy nhiÃªn,
Rust cÃ²n cÃ³ má»™t ngÃ´n ngá»¯ â€œáº©nâ€ bÃªn trong, khÃ´ng thá»±c thi cÃ¡c Ä‘áº£m báº£o vá» an toÃ n bá»™ nhá»› nÃ y:
nÃ³ Ä‘Æ°á»£c gá»i lÃ  <em>unsafe Rust</em> vÃ  hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° Rust bÃ¬nh thÆ°á»ng,
nhÆ°ng cung cáº¥p cho chÃºng ta nhá»¯ng â€œsiÃªu quyá»nâ€ bá»• sung.</p>
<p>Unsafe Rust tá»“n táº¡i vÃ¬ báº£n cháº¥t, phÃ¢n tÃ­ch tÄ©nh lÃ  báº£o thá»§.
Khi trÃ¬nh biÃªn dá»‹ch cá»‘ gáº¯ng xÃ¡c Ä‘á»‹nh xem code cÃ³ tuÃ¢n thá»§ cÃ¡c Ä‘áº£m báº£o hay khÃ´ng,
nÃ³ thÃ  tá»« chá»‘i má»™t sá»‘ chÆ°Æ¡ng trÃ¬nh há»£p lá»‡ cÃ²n hÆ¡n cháº¥p nháº­n má»™t
sá»‘ chÆ°Æ¡ng trÃ¬nh khÃ´ng há»£p lá»‡. Máº·c dÃ¹ code <em>cÃ³ thá»ƒ</em> á»•n, náº¿u trÃ¬nh biÃªn dá»‹ch
Rust khÃ´ng cÃ³ Ä‘á»§ thÃ´ng tin Ä‘á»ƒ tá»± tin, nÃ³ sáº½ tá»« chá»‘i code. Trong nhá»¯ng trÆ°á»ng há»£p nÃ y,
báº¡n cÃ³ thá»ƒ dÃ¹ng code unsafe Ä‘á»ƒ nÃ³i vá»›i trÃ¬nh biÃªn dá»‹ch: â€œTin tÃ´i Ä‘i, tÃ´i biáº¿t mÃ¬nh Ä‘ang lÃ m gÃ¬.â€
Tuy nhiÃªn, hÃ£y cáº©n tháº­n, vÃ¬ sá»­ dá»¥ng unsafe Rust khÃ´ng Ä‘Ãºng cÃ¡ch cÃ³ thá»ƒ gÃ¢y ra
cÃ¡c váº¥n Ä‘á» liÃªn quan Ä‘áº¿n an toÃ n bá»™ nhá»›, nhÆ° truy cáº­p con trá» null.</p>
<p>Má»™t lÃ½ do khÃ¡c khiáº¿n Rust cÃ³ â€œbáº£n sao unsafeâ€ lÃ  vÃ¬ pháº§n cá»©ng mÃ¡y tÃ­nh vá»‘n khÃ´ng an toÃ n.
Náº¿u Rust khÃ´ng cho phÃ©p cÃ¡c thao tÃ¡c unsafe, báº¡n sáº½ khÃ´ng thá»ƒ thá»±c hiá»‡n má»™t sá»‘ tÃ¡c vá»¥ nháº¥t Ä‘á»‹nh. Rust cáº§n cho phÃ©p báº¡n láº­p trÃ¬nh há»‡ thá»‘ng má»©c tháº¥p, nhÆ° tÆ°Æ¡ng tÃ¡c trá»±c tiáº¿p vá»›i há»‡ Ä‘iá»u hÃ nh hoáº·c tháº­m chÃ­ viáº¿t há»‡ Ä‘iá»u hÃ nh riÃªng. LÃ m viá»‡c vá»›i láº­p trÃ¬nh há»‡ thá»‘ng má»©c tháº¥p lÃ  má»™t trong nhá»¯ng má»¥c tiÃªu cá»§a ngÃ´n ngá»¯. HÃ£y khÃ¡m phÃ¡ nhá»¯ng gÃ¬ chÃºng ta cÃ³ thá»ƒ lÃ m vá»›i unsafe Rust vÃ  cÃ¡ch thá»±c hiá»‡n.</p>
<h3 id="siÃªu-quyá»n-unsafe"><a class="header" href="#siÃªu-quyá»n-unsafe">SiÃªu Quyá»n Unsafe</a></h3>
<p>Äá»ƒ chuyá»ƒn sang unsafe Rust, dÃ¹ng tá»« khÃ³a <code>unsafe</code> vÃ  báº¯t Ä‘áº§u má»™t khá»‘i má»›i chá»©a code unsafe. Trong unsafe Rust, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n nÄƒm hÃ nh Ä‘á»™ng mÃ  trong Rust an toÃ n khÃ´ng Ä‘Æ°á»£c phÃ©p, gá»i lÃ  <em>siÃªu quyá»n unsafe</em>. Nhá»¯ng siÃªu quyá»n nÃ y bao gá»“m kháº£ nÄƒng:</p>
<ul>
<li>Giáº£i tham chiáº¿u má»™t con trá» thÃ´ (raw pointer)</li>
<li>Gá»i má»™t hÃ m hoáº·c phÆ°Æ¡ng thá»©c unsafe</li>
<li>Truy cáº­p hoáº·c sá»­a Ä‘á»•i biáº¿n static cÃ³ thá»ƒ thay Ä‘á»•i (mutable static)</li>
<li>Triá»ƒn khai má»™t trait unsafe</li>
<li>Truy cáº­p cÃ¡c trÆ°á»ng cá»§a <code>union</code></li>
</ul>
<p>Äiá»u quan trá»ng cáº§n hiá»ƒu lÃ  <code>unsafe</code> khÃ´ng táº¯t bá»™ kiá»ƒm tra mÆ°á»£n (borrow checker) hay vÃ´ hiá»‡u hÃ³a báº¥t ká»³ kiá»ƒm tra an toÃ n nÃ o khÃ¡c cá»§a Rust: náº¿u báº¡n dÃ¹ng má»™t reference trong unsafe code, nÃ³ váº«n Ä‘Æ°á»£c kiá»ƒm tra. Tá»« khÃ³a <code>unsafe</code> chá»‰ cho phÃ©p báº¡n truy cáº­p nÄƒm tÃ­nh nÄƒng trÃªn mÃ  compiler khÃ´ng kiá»ƒm tra an toÃ n bá»™ nhá»›. Báº¡n váº«n cÃ³ má»™t má»©c Ä‘á»™ an toÃ n nháº¥t Ä‘á»‹nh bÃªn trong khá»‘i unsafe.</p>
<p>NgoÃ i ra, <code>unsafe</code> khÃ´ng cÃ³ nghÄ©a lÃ  code bÃªn trong khá»‘i nÃ y cháº¯c cháº¯n nguy hiá»ƒm hay sáº½ gÃ¢y ra váº¥n Ä‘á» an toÃ n bá»™ nhá»›: Ã½ Ä‘á»‹nh lÃ  ngÆ°á»i láº­p trÃ¬nh pháº£i Ä‘áº£m báº£o code trong khá»‘i <code>unsafe</code> truy cáº­p bá»™ nhá»› má»™t cÃ¡ch há»£p lá»‡.</p>
<p>Con ngÆ°á»i cÃ³ thá»ƒ máº¯c sai láº§m, vÃ  lá»—i sáº½ xáº£y ra, nhÆ°ng viá»‡c yÃªu cáº§u nÄƒm thao tÃ¡c unsafe pháº£i náº±m trong cÃ¡c khá»‘i Ä‘Ã¡nh dáº¥u <code>unsafe</code> giÃºp báº¡n biáº¿t ráº±ng má»i lá»—i liÃªn quan Ä‘áº¿n an toÃ n bá»™ nhá»› Ä‘á»u pháº£i náº±m trong khá»‘i <code>unsafe</code>. Giá»¯ cÃ¡c khá»‘i <code>unsafe</code> cÃ ng nhá» cÃ ng tá»‘t; báº¡n sáº½ biáº¿t Æ¡n khi sau nÃ y pháº£i Ä‘iá»u tra lá»—i bá»™ nhá»›.</p>
<p>Äá»ƒ cÃ´ láº­p code unsafe cÃ ng nhiá»u cÃ ng tá»‘t, tá»‘t nháº¥t lÃ  bao bá»c code unsafe bÃªn trong má»™t abstraction an toÃ n vÃ  cung cáº¥p má»™t API an toÃ n, mÃ  chÃºng ta sáº½ tháº£o luáº­n sau trong chÆ°Æ¡ng khi xem xÃ©t cÃ¡c hÃ m vÃ  phÆ°Æ¡ng thá»©c unsafe. Má»™t sá»‘ pháº§n cá»§a thÆ° viá»‡n chuáº©n Ä‘Æ°á»£c triá»ƒn khai nhÆ° cÃ¡c abstraction an toÃ n trÃªn code unsafe Ä‘Ã£ Ä‘Æ°á»£c kiá»ƒm tra. Viá»‡c bá»c code unsafe trong má»™t abstraction an toÃ n ngÄƒn viá»‡c sá»­ dá»¥ng <code>unsafe</code> lan rá»™ng ra táº¥t cáº£ cÃ¡c nÆ¡i mÃ  báº¡n hoáº·c ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ muá»‘n dÃ¹ng chá»©c nÄƒng Ä‘Æ°á»£c triá»ƒn khai báº±ng code unsafe, bá»Ÿi vÃ¬ viá»‡c sá»­ dá»¥ng abstraction an toÃ n lÃ  an toÃ n.</p>
<p>BÃ¢y giá», hÃ£y cÃ¹ng xem tá»«ng siÃªu quyá»n unsafe. ChÃºng ta cÅ©ng sáº½ xem má»™t sá»‘ abstraction cung cáº¥p giao diá»‡n an toÃ n cho code unsafe.</p>
<h3 id="giáº£i-tham-chiáº¿u-má»™t-con-trá»-thÃ´"><a class="header" href="#giáº£i-tham-chiáº¿u-má»™t-con-trá»-thÃ´">Giáº£i Tham Chiáº¿u Má»™t Con Trá» ThÃ´</a></h3>
<p>Trong ChÆ°Æ¡ng 4, trong pháº§n <a href="ch04-02-references-and-borrowing.html#dangling-references">â€œDangling Referencesâ€</a><!-- ignore -->, chÃºng ta Ä‘Ã£ Ä‘á» cáº­p ráº±ng compiler Ä‘áº£m báº£o cÃ¡c reference luÃ´n há»£p lá»‡. Unsafe Rust cÃ³ hai loáº¡i má»›i gá»i lÃ  <em>raw pointers</em>, tÆ°Æ¡ng tá»± nhÆ° reference. Giá»‘ng nhÆ° reference, raw pointer cÃ³ thá»ƒ lÃ  immutable hoáº·c mutable, Ä‘Æ°á»£c viáº¿t lÃ  <code>*const T</code> vÃ  <code>*mut T</code>. Dáº¥u sao á»Ÿ Ä‘Ã¢y khÃ´ng pháº£i lÃ  toÃ¡n tá»­ dereference; nÃ³ lÃ  má»™t pháº§n cá»§a tÃªn kiá»ƒu. Trong ngá»¯ cáº£nh raw pointer, <em>immutable</em> cÃ³ nghÄ©a lÃ  con trá» khÃ´ng thá»ƒ Ä‘Æ°á»£c gÃ¡n trá»±c tiáº¿p sau khi Ä‘Æ°á»£c dereference.</p>
<p>KhÃ¡c vá»›i reference vÃ  smart pointer, raw pointer:</p>
<ul>
<li>Cho phÃ©p bá» qua cÃ¡c quy táº¯c mÆ°á»£n báº±ng cÃ¡ch cÃ³ cáº£ immutable vÃ  mutable pointer hoáº·c nhiá»u mutable pointer tá»›i cÃ¹ng má»™t Ä‘á»‹a chá»‰</li>
<li>KhÃ´ng Ä‘Æ°á»£c Ä‘áº£m báº£o trá» tá»›i bá»™ nhá»› há»£p lá»‡</li>
<li>CÃ³ thá»ƒ lÃ  null</li>
<li>KhÃ´ng thá»±c hiá»‡n báº¥t ká»³ viá»‡c dá»n dáº¹p tá»± Ä‘á»™ng nÃ o</li>
</ul>
<p>Báº±ng cÃ¡ch tá»« chá»‘i cÃ¡c Ä‘áº£m báº£o mÃ  Rust Ã¡p dá»¥ng, báº¡n cÃ³ thá»ƒ Ä‘Ã¡nh Ä‘á»•i an toÃ n Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº£m báº£o Ä‘á»ƒ láº¥y hiá»‡u nÄƒng cao hÆ¡n hoáº·c kháº£ nÄƒng tÆ°Æ¡ng tÃ¡c vá»›i ngÃ´n ngá»¯ khÃ¡c hoáº·c pháº§n cá»©ng nÆ¡i cÃ¡c Ä‘áº£m báº£o cá»§a Rust khÃ´ng Ã¡p dá»¥ng.</p>
<p>Listing 19-1 minh há»a cÃ¡ch táº¡o má»™t immutable vÃ  má»™t mutable raw pointer tá»« cÃ¡c reference.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-01/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<h3 id="táº¡o-con-trá»-thÃ´-tá»«-reference"><a class="header" href="#táº¡o-con-trá»-thÃ´-tá»«-reference">Táº¡o Con Trá» ThÃ´ tá»« Reference</a></h3>
<p>LÆ°u Ã½ ráº±ng trong vÃ­ dá»¥ nÃ y chÃºng ta <strong>khÃ´ng dÃ¹ng tá»« khÃ³a <code>unsafe</code></strong>. ChÃºng ta cÃ³ thá»ƒ táº¡o raw pointer trong code an toÃ n; chá»‰ cÃ³ Ä‘iá»u khÃ´ng thá»ƒ dereference raw pointer ngoÃ i má»™t khá»‘i <code>unsafe</code>, nhÆ° báº¡n sáº½ tháº¥y ngay sau Ä‘Ã¢y.</p>
<p>ChÃºng ta Ä‘Ã£ táº¡o raw pointer báº±ng cÃ¡ch dÃ¹ng <code>as</code> Ä‘á»ƒ Ã©p kiá»ƒu má»™t immutable vÃ  má»™t mutable reference thÃ nh cÃ¡c loáº¡i raw pointer tÆ°Æ¡ng á»©ng. VÃ¬ chÃºng Ä‘Æ°á»£c táº¡o trá»±c tiáº¿p tá»« cÃ¡c reference Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº£m báº£o há»£p lá»‡, chÃºng ta biáº¿t nhá»¯ng raw pointer nÃ y lÃ  há»£p lá»‡, nhÆ°ng khÃ´ng thá»ƒ giáº£ Ä‘á»‹nh Ä‘iá»u Ä‘Ã³ cho báº¥t ká»³ raw pointer nÃ o khÃ¡c.</p>
<p>Äá»ƒ minh há»a, tiáº¿p theo chÃºng ta sáº½ táº¡o má»™t raw pointer mÃ  tÃ­nh há»£p lá»‡ cá»§a nÃ³ khÃ´ng cháº¯c cháº¯n. Listing 19-2 sáº½ cho tháº¥y cÃ¡ch táº¡o raw pointer tá»›i má»™t Ä‘á»‹a chá»‰ bá»™ nhá»› tÃ¹y Ã½. Viá»‡c sá»­ dá»¥ng bá»™ nhá»› tÃ¹y Ã½ lÃ  undefined behavior: cÃ³ thá»ƒ cÃ³ dá»¯ liá»‡u táº¡i Ä‘á»‹a chá»‰ Ä‘Ã³ hoáº·c khÃ´ng, compiler cÃ³ thá»ƒ tá»‘i Æ°u code khiáº¿n khÃ´ng cÃ³ truy cáº­p bá»™ nhá»› nÃ o, hoáº·c chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ lá»—i vá»›i segmentation fault. ThÆ°á»ng thÃ¬ khÃ´ng cÃ³ lÃ½ do chÃ­nh Ä‘Ã¡ng Ä‘á»ƒ viáº¿t code nhÆ° váº­y, nhÆ°ng vá» máº·t ká»¹ thuáº­t lÃ  cÃ³ thá»ƒ.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-02/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<h3 id="ghi-nhá»›-vá»-raw-pointer"><a class="header" href="#ghi-nhá»›-vá»-raw-pointer">Ghi Nhá»› vá» Raw Pointer</a></h3>
<p>Nhá»› ráº±ng chÃºng ta cÃ³ thá»ƒ táº¡o raw pointer trong code an toÃ n, nhÆ°ng khÃ´ng thá»ƒ dereference raw pointer vÃ  Ä‘á»c dá»¯ liá»‡u mÃ  nÃ³ trá» tá»›i. Trong Listing 19-3, chÃºng ta sáº½ dÃ¹ng toÃ¡n tá»­ dereference <code>*</code> trÃªn raw pointer, vÃ  Ä‘iá»u nÃ y yÃªu cáº§u pháº£i náº±m trong má»™t khá»‘i <code>unsafe</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-03/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<h3 id="lÃ½-do-sá»­-dá»¥ng-raw-pointer"><a class="header" href="#lÃ½-do-sá»­-dá»¥ng-raw-pointer">LÃ½ do sá»­ dá»¥ng Raw Pointer</a></h3>
<p>Viá»‡c táº¡o con trá» khÃ´ng gÃ¢y háº¡i; chá»‰ khi chÃºng ta cá»‘ truy cáº­p giÃ¡ trá»‹ mÃ  nÃ³ trá» tá»›i má»›i cÃ³ thá»ƒ gáº·p giÃ¡ trá»‹ khÃ´ng há»£p lá»‡.</p>
<p>LÆ°u Ã½ ráº±ng trong Listing 19-1 vÃ  19-3, chÃºng ta Ä‘Ã£ táº¡o <code>*const i32</code> vÃ  <code>*mut i32</code> trá» tá»›i cÃ¹ng má»™t vá»‹ trÃ­ bá»™ nhá»› chá»©a <code>num</code>. Náº¿u thay vÃ o Ä‘Ã³ ta táº¡o tham chiáº¿u immutable vÃ  mutable tá»›i <code>num</code>, code sáº½ khÃ´ng biÃªn dá»‹ch vÃ¬ luáº­t sá»Ÿ há»¯u cá»§a Rust khÃ´ng cho phÃ©p má»™t tham chiáº¿u mutable cÃ¹ng lÃºc vá»›i báº¥t ká»³ tham chiáº¿u immutable nÃ o. Vá»›i raw pointer, ta cÃ³ thá»ƒ táº¡o má»™t con trá» mutable vÃ  má»™t con trá» immutable tá»›i cÃ¹ng vá»‹ trÃ­ vÃ  thay Ä‘á»•i dá»¯ liá»‡u qua con trá» mutable, cÃ³ thá»ƒ gÃ¢y ra <strong>data race</strong>. HÃ£y cáº©n tháº­n!</p>
<p>Má»™t trÆ°á»ng há»£p chÃ­nh sá»­ dá»¥ng raw pointer lÃ  khi giao tiáº¿p vá»›i code C, hoáº·c khi xÃ¢y dá»±ng cÃ¡c abstraction an toÃ n mÃ  borrow checker khÃ´ng hiá»ƒu Ä‘Æ°á»£c.</p>
<hr />
<h3 id="gá»i-unsafe-function-hoáº·c-method"><a class="header" href="#gá»i-unsafe-function-hoáº·c-method">Gá»i Unsafe Function hoáº·c Method</a></h3>
<p>Má»™t loáº¡i thao tÃ¡c khÃ¡c trong khá»‘i unsafe lÃ  gá»i <strong>unsafe function</strong>. ChÃºng trÃ´ng giá»‘ng nhÆ° hÃ m thÃ´ng thÆ°á»ng, nhÆ°ng cÃ³ thÃªm tá»« khÃ³a <code>unsafe</code> trÆ°á»›c pháº§n Ä‘á»‹nh nghÄ©a. Tá»« khÃ³a nÃ y chá»‰ ra ráº±ng hÃ m cÃ³ nhá»¯ng yÃªu cáº§u mÃ  ta cáº§n Ä‘áº£m báº£o khi gá»i, vÃ¬ Rust khÃ´ng thá»ƒ cháº¯c ráº±ng ta Ä‘Ã£ Ä‘Ã¡p á»©ng cÃ¡c yÃªu cáº§u Ä‘Ã³. Khi gá»i má»™t unsafe function trong khá»‘i <code>unsafe</code>, ta Ä‘á»“ng nghÄ©a ráº±ng Ä‘Ã£ Ä‘á»c tÃ i liá»‡u hÃ m vÃ  chá»‹u trÃ¡ch nhiá»‡m Ä‘áº£m báº£o cÃ¡c há»£p Ä‘á»“ng cá»§a hÃ m.</p>
<p>VÃ­ dá»¥ má»™t hÃ m unsafe tÃªn <code>dangerous</code> mÃ  body khÃ´ng lÃ m gÃ¬:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-01-unsafe-fn/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>ChÃºng ta pháº£i gá»i hÃ m <code>dangerous</code> bÃªn trong má»™t khá»‘i <code>unsafe</code> riÃªng. Náº¿u chÃºng ta cá»‘ gáº¯ng gá»i <code>dangerous</code> mÃ  khÃ´ng cÃ³ khá»‘i <code>unsafe</code>, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i:</p>
<pre><code class="language-console">{{#include ../listings/ch19-advanced-features/output-only-01-missing-unsafe/output.txt}}
</code></pre>
<p>Vá»›i khá»‘i <code>unsafe</code>, chÃºng ta Ä‘ang kháº³ng Ä‘á»‹nh vá»›i Rust ráº±ng chÃºng ta Ä‘Ã£ Ä‘á»c tÃ i liá»‡u cá»§a hÃ m, hiá»ƒu cÃ¡ch sá»­ dá»¥ng Ä‘Ãºng, vÃ  Ä‘Ã£ xÃ¡c minh ráº±ng chÃºng ta Ä‘ang tuÃ¢n thá»§ há»£p Ä‘á»“ng cá»§a hÃ m Ä‘Ã³.</p>
<p>CÃ¡c thÃ¢n hÃ m cá»§a cÃ¡c hÃ m <code>unsafe</code> vá» cÆ¡ báº£n lÃ  cÃ¡c khá»‘i <code>unsafe</code>, vÃ¬ váº­y Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c unsafe khÃ¡c bÃªn trong má»™t hÃ m unsafe, chÃºng ta khÃ´ng cáº§n pháº£i thÃªm má»™t khá»‘i <code>unsafe</code> khÃ¡c.</p>
<h4 id="táº¡o-má»™t-safe-abstraction-trÃªn-unsafe-code"><a class="header" href="#táº¡o-má»™t-safe-abstraction-trÃªn-unsafe-code">Táº¡o má»™t Safe Abstraction trÃªn Unsafe Code</a></h4>
<p>Chá»‰ vÃ¬ má»™t hÃ m chá»©a mÃ£ unsafe khÃ´ng cÃ³ nghÄ©a lÃ  chÃºng ta pháº£i Ä‘Ã¡nh dáº¥u toÃ n bá»™ hÃ m lÃ  <code>unsafe</code>. Thá»±c táº¿, viá»‡c bao bá»c mÃ£ <code>unsafe</code> trong má»™t hÃ m an toÃ n lÃ  má»™t trá»«u tÆ°á»£ng phá»• biáº¿n.</p>
<p>VÃ­ dá»¥, hÃ£y nghiÃªn cá»©u hÃ m <code>split_at_mut</code> tá»« thÆ° viá»‡n chuáº©n, hÃ m nÃ y yÃªu cáº§u má»™t sá»‘ mÃ£ <code>unsafe</code>. ChÃºng ta sáº½ khÃ¡m phÃ¡ cÃ¡ch triá»ƒn khai nÃ³. PhÆ°Æ¡ng thá»©c an toÃ n nÃ y Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn cÃ¡c slice cÃ³ thá»ƒ thay Ä‘á»•i: nÃ³ nháº­n má»™t slice vÃ  chia nÃ³ thÃ nh hai báº±ng cÃ¡ch tÃ¡ch slice táº¡i chá»‰ sá»‘ Ä‘Æ°á»£c truyá»n lÃ m tham sá»‘. Danh sÃ¡ch 19-4 cho tháº¥y cÃ¡ch sá»­ dá»¥ng <code>split_at_mut</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-04/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-4: Sá»­ dá»¥ng hÃ m an toÃ n <code>split_at_mut</code></span></p>
<p>ChÃºng ta khÃ´ng thá»ƒ triá»ƒn khai hÃ m nÃ y chá»‰ báº±ng Rust an toÃ n. Má»™t thá»­ nghiá»‡m cÃ³ thá»ƒ trÃ´ng giá»‘ng nhÆ° Listing 19-5, nhÆ°ng sáº½ khÃ´ng biÃªn dá»‹ch Ä‘Æ°á»£c. Äá»ƒ Ä‘Æ¡n giáº£n, chÃºng ta sáº½ triá»ƒn khai <code>split_at_mut</code> nhÆ° má»™t hÃ m thay vÃ¬ má»™t phÆ°Æ¡ng thá»©c vÃ  chá»‰ dÃ nh cho cÃ¡c slice cá»§a giÃ¡ trá»‹ <code>i32</code> thay vÃ¬ má»™t kiá»ƒu tá»•ng quÃ¡t <code>T</code>.</p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-05/src/main.rs:here}}</code></pre>
<p><span class="caption">Listing 19-5: Má»™t triá»ƒn khai thá»­ nghiá»‡m cá»§a <code>split_at_mut</code> chá»‰ sá»­ dá»¥ng Rust an toÃ n</span></p>
<p>HÃ m nÃ y trÆ°á»›c tiÃªn láº¥y tá»•ng Ä‘á»™ dÃ i cá»§a slice. Sau Ä‘Ã³, nÃ³ kháº³ng Ä‘á»‹nh ráº±ng chá»‰ sá»‘ Ä‘Æ°á»£c truyá»n lÃ m tham sá»‘ náº±m trong slice báº±ng cÃ¡ch kiá»ƒm tra xem nÃ³ cÃ³ nhá» hÆ¡n hoáº·c báº±ng Ä‘á»™ dÃ i hay khÃ´ng. Viá»‡c kháº³ng Ä‘á»‹nh nÃ y cÃ³ nghÄ©a lÃ  náº¿u chÃºng ta truyá»n má»™t chá»‰ sá»‘ lá»›n hÆ¡n Ä‘á»™ dÃ i Ä‘á»ƒ tÃ¡ch slice táº¡i Ä‘Ã³, hÃ m sáº½ panic trÆ°á»›c khi cá»‘ gáº¯ng sá»­ dá»¥ng chá»‰ sá»‘ Ä‘Ã³.</p>
<p>Tiáº¿p theo, chÃºng ta tráº£ vá» hai slice cÃ³ thá»ƒ thay Ä‘á»•i trong má»™t tuple: má»™t tá»« Ä‘áº§u slice gá»‘c Ä‘áº¿n chá»‰ sá»‘ <code>mid</code> vÃ  má»™t tá»« <code>mid</code> Ä‘áº¿n cuá»‘i slice.</p>
<p>Khi chÃºng ta cá»‘ gáº¯ng biÃªn dá»‹ch mÃ£ trong Listing 19-5, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i.</p>
<pre><code class="language-console">{{#include ../listings/ch19-advanced-features/listing-19-05/output.txt}}
</code></pre>
<p>TrÃ¬nh kiá»ƒm tra mÆ°á»£n (borrow checker) cá»§a Rust khÃ´ng thá»ƒ hiá»ƒu ráº±ng chÃºng ta Ä‘ang mÆ°á»£n cÃ¡c pháº§n khÃ¡c nhau cá»§a slice; nÃ³ chá»‰ biáº¿t ráº±ng chÃºng ta Ä‘ang mÆ°á»£n cÃ¹ng má»™t slice hai láº§n. Viá»‡c mÆ°á»£n cÃ¡c pháº§n khÃ¡c nhau cá»§a slice vá» cÆ¡ báº£n lÃ  há»£p lá»‡ vÃ¬ hai slice nÃ y khÃ´ng chá»“ng láº¥n, nhÆ°ng Rust khÃ´ng Ä‘á»§ thÃ´ng minh Ä‘á»ƒ nháº­n ra Ä‘iá»u nÃ y. Khi chÃºng ta biáº¿t mÃ£ lÃ  an toÃ n, nhÆ°ng Rust thÃ¬ khÃ´ng, Ä‘Ã³ lÃ  lÃºc cáº§n sá»­ dá»¥ng mÃ£ <code>unsafe</code>.</p>
<p>Listing 19-6 cho tháº¥y cÃ¡ch sá»­ dá»¥ng má»™t khá»‘i <code>unsafe</code>, má»™t con trá» thÃ´ (raw pointer), vÃ  má»™t sá»‘ lá»i gá»i tá»›i cÃ¡c hÃ m unsafe Ä‘á»ƒ thá»±c hiá»‡n triá»ƒn khai <code>split_at_mut</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-06/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-6: Sá»­ dá»¥ng mÃ£ unsafe trong triá»ƒn khai hÃ m <code>split_at_mut</code></span></p>
<p>Nhá»› láº¡i tá»« pháº§n <a href="ch04-03-slices.html#the-slice-type">â€œThe Slice Typeâ€</a><!-- ignore --> trong ChÆ°Æ¡ng 4 ráº±ng slice lÃ  má»™t con trá» tá»›i dá»¯ liá»‡u vÃ  Ä‘á»™ dÃ i cá»§a slice. ChÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>len</code> Ä‘á»ƒ láº¥y Ä‘á»™ dÃ i cá»§a slice vÃ  phÆ°Æ¡ng thá»©c <code>as_mut_ptr</code> Ä‘á»ƒ truy cáº­p con trá» thÃ´ (raw pointer) cá»§a slice. Trong trÆ°á»ng há»£p nÃ y, vÃ¬ chÃºng ta cÃ³ má»™t slice cÃ³ thá»ƒ thay Ä‘á»•i cá»§a cÃ¡c giÃ¡ trá»‹ <code>i32</code>, <code>as_mut_ptr</code> tráº£ vá» má»™t con trá» thÃ´ vá»›i kiá»ƒu <code>*mut i32</code>, mÃ  chÃºng ta Ä‘Ã£ lÆ°u vÃ o biáº¿n <code>ptr</code>.</p>
<p>ChÃºng ta giá»¯ láº¡i kháº³ng Ä‘á»‹nh ráº±ng chá»‰ sá»‘ <code>mid</code> náº±m trong slice. Sau Ä‘Ã³, chÃºng ta Ä‘áº¿n pháº§n mÃ£ unsafe: hÃ m <code>slice::from_raw_parts_mut</code> nháº­n má»™t con trá» thÃ´ vÃ  má»™t Ä‘á»™ dÃ i, vÃ  nÃ³ táº¡o ra má»™t slice. ChÃºng ta sá»­ dá»¥ng hÃ m nÃ y Ä‘á»ƒ táº¡o má»™t slice báº¯t Ä‘áº§u tá»« <code>ptr</code> vá»›i Ä‘á»™ dÃ i <code>mid</code>. Sau Ä‘Ã³, chÃºng ta gá»i phÆ°Æ¡ng thá»©c <code>add</code> trÃªn <code>ptr</code> vá»›i <code>mid</code> lÃ m tham sá»‘ Ä‘á»ƒ láº¥y má»™t con trá» thÃ´ báº¯t Ä‘áº§u tá»« <code>mid</code>, vÃ  chÃºng ta táº¡o má»™t slice sá»­ dá»¥ng con trá» Ä‘Ã³ vá»›i sá»‘ pháº§n tá»­ cÃ²n láº¡i sau <code>mid</code> lÃ m Ä‘á»™ dÃ i.</p>
<p>HÃ m <code>slice::from_raw_parts_mut</code> lÃ  unsafe vÃ¬ nÃ³ nháº­n má»™t con trá» thÃ´ vÃ  pháº£i tin ráº±ng con trá» nÃ y lÃ  há»£p lá»‡. PhÆ°Æ¡ng thá»©c <code>add</code> trÃªn con trá» thÃ´ cÅ©ng lÃ  unsafe, vÃ¬ nÃ³ pháº£i tin ráº±ng vá»‹ trÃ­ offset cÅ©ng lÃ  má»™t con trá» há»£p lá»‡. Do Ä‘Ã³, chÃºng ta pháº£i Ä‘áº·t má»™t khá»‘i <code>unsafe</code> xung quanh cÃ¡c lá»i gá»i tá»›i <code>slice::from_raw_parts_mut</code> vÃ  <code>add</code> Ä‘á»ƒ cÃ³ thá»ƒ gá»i chÃºng. Báº±ng cÃ¡ch nhÃ¬n vÃ o mÃ£ vÃ  thÃªm kháº³ng Ä‘á»‹nh ráº±ng <code>mid</code> pháº£i nhá» hÆ¡n hoáº·c báº±ng <code>len</code>, chÃºng ta cÃ³ thá»ƒ cháº¯c cháº¯n ráº±ng táº¥t cáº£ cÃ¡c con trá» thÃ´ Ä‘Æ°á»£c sá»­ dá»¥ng bÃªn trong khá»‘i <code>unsafe</code> sáº½ lÃ  con trá» há»£p lá»‡ tá»›i dá»¯ liá»‡u trong slice. ÄÃ¢y lÃ  cÃ¡ch sá»­ dá»¥ng <code>unsafe</code> cháº¥p nháº­n Ä‘Æ°á»£c vÃ  phÃ¹ há»£p.</p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta khÃ´ng cáº§n Ä‘Ã¡nh dáº¥u hÃ m <code>split_at_mut</code> káº¿t quáº£ lÃ  <code>unsafe</code>, vÃ  chÃºng ta cÃ³ thá»ƒ gá»i hÃ m nÃ y tá»« Rust an toÃ n. ChÃºng ta Ä‘Ã£ táº¡o má»™t lá»›p trá»«u tÆ°á»£ng an toÃ n cho mÃ£ unsafe vá»›i triá»ƒn khai cá»§a hÃ m sá»­ dá»¥ng mÃ£ <code>unsafe</code> má»™t cÃ¡ch an toÃ n, vÃ¬ nÃ³ chá»‰ táº¡o ra cÃ¡c con trá» há»£p lá»‡ tá»« dá»¯ liá»‡u mÃ  hÃ m nÃ y cÃ³ quyá»n truy cáº­p.</p>
<p>NgÆ°á»£c láº¡i, viá»‡c sá»­ dá»¥ng <code>slice::from_raw_parts_mut</code> trong Listing 19-7 cÃ³ thá»ƒ gÃ¢y crash khi slice Ä‘Æ°á»£c sá»­ dá»¥ng. MÃ£ nÃ y láº¥y má»™t vá»‹ trÃ­ bá»™ nhá»› tÃ¹y Ã½ vÃ  táº¡o má»™t slice dÃ i 10.000 pháº§n tá»­.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-07/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-7: Táº¡o má»™t slice tá»« vá»‹ trÃ­ bá»™ nhá»› tÃ¹y Ã½</span></p>
<p>ChÃºng ta khÃ´ng sá»Ÿ há»¯u bá»™ nhá»› táº¡i vá»‹ trÃ­ tÃ¹y Ã½ nÃ y, vÃ  khÃ´ng cÃ³ Ä‘áº£m báº£o ráº±ng slice mÃ  mÃ£ nÃ y táº¡o ra chá»©a cÃ¡c giÃ¡ trá»‹ <code>i32</code> há»£p lá»‡. Viá»‡c cá»‘ gáº¯ng sá»­ dá»¥ng <code>values</code> nhÆ° thá»ƒ nÃ³ lÃ  má»™t slice há»£p lá»‡ sáº½ dáº«n Ä‘áº¿n hÃ nh vi khÃ´ng xÃ¡c Ä‘á»‹nh (undefined behavior).</p>
<h4 id="sá»­-dá»¥ng-cÃ¡c-hÃ m-extern-Ä‘á»ƒ-gá»i-mÃ£-bÃªn-ngoÃ i"><a class="header" href="#sá»­-dá»¥ng-cÃ¡c-hÃ m-extern-Ä‘á»ƒ-gá»i-mÃ£-bÃªn-ngoÃ i">Sá»­ dá»¥ng cÃ¡c hÃ m <code>extern</code> Ä‘á»ƒ gá»i mÃ£ bÃªn ngoÃ i</a></h4>
<p>ÄÃ´i khi, mÃ£ Rust cá»§a báº¡n cÃ³ thá»ƒ cáº§n tÆ°Æ¡ng tÃ¡c vá»›i mÃ£ Ä‘Æ°á»£c viáº¿t báº±ng ngÃ´n ngá»¯ khÃ¡c. Äá»ƒ lÃ m Ä‘iá»u nÃ y, Rust cÃ³ tá»« khÃ³a <code>extern</code> giÃºp táº¡o vÃ  sá»­ dá»¥ng <em>Foreign Function Interface (FFI)</em>. FFI lÃ  má»™t cÃ¡ch Ä‘á»ƒ má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh Ä‘á»‹nh nghÄ©a cÃ¡c hÃ m vÃ  cho phÃ©p má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c (foreign) gá»i cÃ¡c hÃ m Ä‘Ã³.</p>
<p>Listing 19-8 minh há»a cÃ¡ch thiáº¿t láº­p tÃ­ch há»£p vá»›i hÃ m <code>abs</code> tá»« thÆ° viá»‡n chuáº©n C. CÃ¡c hÃ m Ä‘Æ°á»£c khai bÃ¡o trong cÃ¡c khá»‘i <code>extern</code> luÃ´n lÃ  unsafe khi gá»i tá»« mÃ£ Rust. LÃ½ do lÃ  cÃ¡c ngÃ´n ngá»¯ khÃ¡c khÃ´ng tuÃ¢n thá»§ cÃ¡c quy táº¯c vÃ  Ä‘áº£m báº£o cá»§a Rust, vÃ  Rust khÃ´ng thá»ƒ kiá»ƒm tra chÃºng, vÃ¬ váº­y trÃ¡ch nhiá»‡m Ä‘áº£m báº£o an toÃ n thuá»™c vá» láº­p trÃ¬nh viÃªn.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-08/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-8: Khai bÃ¡o vÃ  gá»i má»™t hÃ m <code>extern</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong ngÃ´n ngá»¯ khÃ¡c</span></p>
<p>Trong khá»‘i <code>extern "C"</code>, chÃºng ta liá»‡t kÃª tÃªn vÃ  chá»¯ kÃ½ cá»§a cÃ¡c hÃ m bÃªn ngoÃ i tá»« ngÃ´n ngá»¯ khÃ¡c mÃ  chÃºng ta muá»‘n gá»i. Pháº§n <code>"C"</code> Ä‘á»‹nh nghÄ©a <em>application binary interface (ABI)</em> mÃ  hÃ m bÃªn ngoÃ i sá»­ dá»¥ng: ABI xÃ¡c Ä‘á»‹nh cÃ¡ch gá»i hÃ m á»Ÿ cáº¥p Ä‘á»™ assembly. ABI <code>"C"</code> lÃ  phá»• biáº¿n nháº¥t vÃ  theo chuáº©n ABI cá»§a ngÃ´n ngá»¯ láº­p trÃ¬nh C.</p>
<section class="note" aria-role="note">
<h4 id="gá»i-hÃ m-rust-tá»«-cÃ¡c-ngÃ´n-ngá»¯-khÃ¡c"><a class="header" href="#gá»i-hÃ m-rust-tá»«-cÃ¡c-ngÃ´n-ngá»¯-khÃ¡c">Gá»i hÃ m Rust tá»« cÃ¡c ngÃ´n ngá»¯ khÃ¡c</a></h4>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng <code>extern</code> Ä‘á»ƒ táº¡o má»™t giao diá»‡n cho phÃ©p cÃ¡c ngÃ´n ngá»¯ khÃ¡c gá»i cÃ¡c hÃ m Rust. Thay vÃ¬ táº¡o toÃ n bá»™ khá»‘i <code>extern</code>, chÃºng ta thÃªm tá»« khÃ³a <code>extern</code> vÃ  chá»‰ Ä‘á»‹nh ABI sáº½ sá»­ dá»¥ng ngay trÆ°á»›c tá»« khÃ³a <code>fn</code> cho hÃ m tÆ°Æ¡ng á»©ng. ChÃºng ta cÅ©ng cáº§n thÃªm chÃº thÃ­ch <code>#[no_mangle]</code> Ä‘á»ƒ thÃ´ng bÃ¡o cho trÃ¬nh biÃªn dá»‹ch Rust khÃ´ng thay Ä‘á»•i tÃªn hÃ m nÃ y. <em>Mangling</em> lÃ  khi má»™t trÃ¬nh biÃªn dá»‹ch thay Ä‘á»•i tÃªn mÃ  chÃºng ta Ä‘Ã£ Ä‘áº·t cho hÃ m thÃ nh má»™t tÃªn khÃ¡c chá»©a thÃªm thÃ´ng tin cho cÃ¡c pháº§n khÃ¡c cá»§a quÃ¡ trÃ¬nh biÃªn dá»‹ch sá»­ dá»¥ng, nhÆ°ng Ã­t dá»… Ä‘á»c hÆ¡n vá»›i con ngÆ°á»i. Má»—i trÃ¬nh biÃªn dá»‹ch ngÃ´n ngá»¯ láº­p trÃ¬nh thay Ä‘á»•i tÃªn theo cÃ¡ch hÆ¡i khÃ¡c nhau, vÃ¬ váº­y Ä‘á»ƒ má»™t hÃ m Rust cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i tá»« cÃ¡c ngÃ´n ngá»¯ khÃ¡c, chÃºng ta pháº£i táº¯t viá»‡c thay Ä‘á»•i tÃªn cá»§a trÃ¬nh biÃªn dá»‹ch Rust.</p>
<p>Trong vÃ­ dá»¥ sau, chÃºng ta lÃ m cho hÃ m <code>call_from_c</code> cÃ³ thá»ƒ truy cáº­p tá»« mÃ£ C, sau khi nÃ³ Ä‘Æ°á»£c biÃªn dá»‹ch thÃ nh thÆ° viá»‡n chia sáº» vÃ  liÃªn káº¿t tá»« C:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[no_mangle]
pub extern "C" fn call_from_c() {
    println!("Just called a Rust function from C!");
}
<span class="boring">}</span></code></pre></pre>
<p>This usage of <code>extern</code> does not require <code>unsafe</code>.</p>
</section>
<h3 id="truy-cáº­p-hoáº·c-sá»­a-Ä‘á»•i-má»™t-biáº¿n-static-cÃ³-thá»ƒ-thay-Ä‘á»•i"><a class="header" href="#truy-cáº­p-hoáº·c-sá»­a-Ä‘á»•i-má»™t-biáº¿n-static-cÃ³-thá»ƒ-thay-Ä‘á»•i">Truy cáº­p hoáº·c sá»­a Ä‘á»•i má»™t biáº¿n static cÃ³ thá»ƒ thay Ä‘á»•i</a></h3>
<p>Trong cuá»‘n sÃ¡ch nÃ y, chÃºng ta chÆ°a nÃ³i vá» <em>biáº¿n toÃ n cá»¥c</em> (global variables), mÃ  Rust há»— trá»£ nhÆ°ng cÃ³ thá»ƒ gÃ¢y ra váº¥n Ä‘á» vá»›i cÃ¡c quy táº¯c ownership cá»§a Rust. Náº¿u hai luá»“ng truy cáº­p cÃ¹ng má»™t biáº¿n toÃ n cá»¥c cÃ³ thá»ƒ thay Ä‘á»•i, Ä‘iá»u nÃ y cÃ³ thá»ƒ gÃ¢y ra <em>data race</em>.</p>
<p>Trong Rust, cÃ¡c biáº¿n toÃ n cá»¥c Ä‘Æ°á»£c gá»i lÃ  biáº¿n <em>static</em>. Listing 19-9 cho tháº¥y má»™t vÃ­ dá»¥ vá» khai bÃ¡o vÃ  sá»­ dá»¥ng biáº¿n static vá»›i má»™t slice chuá»—i lÃ m giÃ¡ trá»‹.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-09/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-9: Khai bÃ¡o vÃ  sá»­ dá»¥ng má»™t biáº¿n static khÃ´ng thá»ƒ thay Ä‘á»•i</span></p>
<p>CÃ¡c biáº¿n static tÆ°Æ¡ng tá»± nhÆ° cÃ¡c háº±ng sá»‘ (constants), mÃ  chÃºng ta Ä‘Ã£ tháº£o luáº­n trong pháº§n <a href="ch03-01-variables-and-mutability.html#constants">â€œDifferences Between Variables and Constantsâ€</a><!-- ignore --> á»Ÿ ChÆ°Æ¡ng 3. TÃªn cá»§a cÃ¡c biáº¿n static theo quy Æ°á»›c viáº¿t <code>SCREAMING_SNAKE_CASE</code>. CÃ¡c biáº¿n static chá»‰ cÃ³ thá»ƒ lÆ°u trá»¯ cÃ¡c tham chiáº¿u vá»›i lifetime <code>'static</code>, nghÄ©a lÃ  trÃ¬nh biÃªn dá»‹ch Rust cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c lifetime vÃ  chÃºng ta khÃ´ng cáº§n pháº£i chÃº thÃ­ch rÃµ rÃ ng. Truy cáº­p má»™t biáº¿n static khÃ´ng thá»ƒ thay Ä‘á»•i lÃ  an toÃ n.</p>
<p>Má»™t khÃ¡c biá»‡t tinh táº¿ giá»¯a constants vÃ  biáº¿n static khÃ´ng thá»ƒ thay Ä‘á»•i lÃ  cÃ¡c giÃ¡ trá»‹ trong má»™t biáº¿n static cÃ³ má»™t Ä‘á»‹a chá»‰ cá»‘ Ä‘á»‹nh trong bá»™ nhá»›. Viá»‡c sá»­ dá»¥ng giÃ¡ trá»‹ nÃ y sáº½ luÃ´n truy cáº­p cÃ¹ng má»™t dá»¯ liá»‡u. NgÆ°á»£c láº¡i, constants Ä‘Æ°á»£c phÃ©p sao chÃ©p dá»¯ liá»‡u má»—i khi chÃºng Ä‘Æ°á»£c sá»­ dá»¥ng. Má»™t khÃ¡c biá»‡t ná»¯a lÃ  cÃ¡c biáº¿n static cÃ³ thá»ƒ thay Ä‘á»•i Ä‘Æ°á»£c (mutable). Truy cáº­p vÃ  sá»­a Ä‘á»•i cÃ¡c biáº¿n static mutable lÃ  <em>unsafe</em>. Listing 19-10 cho tháº¥y cÃ¡ch khai bÃ¡o, truy cáº­p vÃ  sá»­a Ä‘á»•i má»™t biáº¿n static mutable cÃ³ tÃªn lÃ  <code>COUNTER</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-10/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-10: Äá»c hoáº·c ghi vÃ o má»™t biáº¿n static mutable lÃ  unsafe</span></p>
<p>NhÆ° vá»›i cÃ¡c biáº¿n thÃ´ng thÆ°á»ng, chÃºng ta xÃ¡c Ä‘á»‹nh kháº£ nÄƒng thay Ä‘á»•i báº±ng tá»« khÃ³a <code>mut</code>. Báº¥t ká»³ mÃ£ nÃ o Ä‘á»c hoáº·c ghi tá»« <code>COUNTER</code> pháº£i náº±m trong má»™t khá»‘i <code>unsafe</code>. MÃ£ nÃ y biÃªn dá»‹ch vÃ  in ra <code>COUNTER: 3</code> nhÆ° chÃºng ta mong Ä‘á»£i vÃ¬ nÃ³ cháº¡y Ä‘Æ¡n luá»“ng. Náº¿u cÃ³ nhiá»u luá»“ng truy cáº­p <code>COUNTER</code>, ráº¥t cÃ³ kháº£ nÄƒng xáº£y ra <em>data races</em>.</p>
<p>Vá»›i dá»¯ liá»‡u mutable cÃ³ thá»ƒ truy cáº­p toÃ n cá»¥c, ráº¥t khÃ³ Ä‘áº£m báº£o khÃ´ng cÃ³ <em>data race</em>, Ä‘Ã³ lÃ  lÃ½ do Rust coi cÃ¡c biáº¿n static mutable lÃ  unsafe. Khi cÃ³ thá»ƒ, nÃªn sá»­ dá»¥ng cÃ¡c ká»¹ thuáº­t Ä‘á»“ng thá»i (concurrency) vÃ  cÃ¡c con trá» thÃ´ng minh an toÃ n vá»›i luá»“ng (thread-safe smart pointers) mÃ  chÃºng ta Ä‘Ã£ tháº£o luáº­n á»Ÿ ChÆ°Æ¡ng 16 Ä‘á»ƒ trÃ¬nh biÃªn dá»‹ch kiá»ƒm tra ráº±ng dá»¯ liá»‡u Ä‘Æ°á»£c truy cáº­p tá»« cÃ¡c luá»“ng khÃ¡c nhau má»™t cÃ¡ch an toÃ n.</p>
<h3 id="triá»ƒn-khai-má»™t-unsafe-trait"><a class="header" href="#triá»ƒn-khai-má»™t-unsafe-trait">Triá»ƒn khai má»™t Unsafe Trait</a></h3>
<p>ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng <code>unsafe</code> Ä‘á»ƒ triá»ƒn khai má»™t unsafe trait. Má»™t trait lÃ  unsafe khi Ã­t nháº¥t má»™t trong cÃ¡c phÆ°Æ¡ng thá»©c cá»§a nÃ³ cÃ³ má»™t báº¥t biáº¿n (invariant) mÃ  trÃ¬nh biÃªn dá»‹ch khÃ´ng thá»ƒ xÃ¡c minh. ChÃºng ta khai bÃ¡o má»™t trait lÃ  <code>unsafe</code> báº±ng cÃ¡ch thÃªm tá»« khÃ³a <code>unsafe</code> trÆ°á»›c <code>trait</code> vÃ  Ä‘Ã¡nh dáº¥u viá»‡c triá»ƒn khai trait Ä‘Ã³ cÅ©ng lÃ  <code>unsafe</code>, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 19-11.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-11/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-11: Khai bÃ¡o vÃ  triá»ƒn khai má»™t unsafe trait</span></p>
<p>Báº±ng cÃ¡ch sá»­ dá»¥ng <code>unsafe impl</code>, chÃºng ta há»©a ráº±ng sáº½ tuÃ¢n thá»§ cÃ¡c báº¥t biáº¿n mÃ  trÃ¬nh biÃªn dá»‹ch khÃ´ng thá»ƒ xÃ¡c minh.</p>
<p>VÃ­ dá»¥, hÃ£y nhá»› láº¡i cÃ¡c marker trait <code>Sync</code> vÃ  <code>Send</code> mÃ  chÃºng ta Ä‘Ã£ tháº£o luáº­n trong pháº§n <a href="ch16-04-extensible-concurrency-sync-and-send.html#extensible-concurrency-with-the-sync-and-send-traits">â€œExtensible Concurrency with the <code>Sync</code> and <code>Send</code> Traitsâ€</a><!-- ignore --> á»Ÿ ChÆ°Æ¡ng 16: trÃ¬nh biÃªn dá»‹ch sáº½ triá»ƒn khai cÃ¡c trait nÃ y tá»± Ä‘á»™ng náº¿u cÃ¡c kiá»ƒu cá»§a chÃºng ta Ä‘Æ°á»£c cáº¥u thÃ nh hoÃ n toÃ n tá»« cÃ¡c kiá»ƒu <code>Send</code> vÃ  <code>Sync</code>. Náº¿u chÃºng ta triá»ƒn khai má»™t kiá»ƒu chá»©a má»™t kiá»ƒu khÃ´ng pháº£i <code>Send</code> hoáº·c <code>Sync</code>, cháº³ng háº¡n nhÆ° raw pointer, vÃ  muá»‘n Ä‘Ã¡nh dáº¥u kiá»ƒu Ä‘Ã³ lÃ  <code>Send</code> hoáº·c <code>Sync</code>, chÃºng ta pháº£i sá»­ dá»¥ng <code>unsafe</code>. Rust khÃ´ng thá»ƒ xÃ¡c minh ráº±ng kiá»ƒu cá»§a chÃºng ta tuÃ¢n thá»§ cÃ¡c Ä‘áº£m báº£o cÃ³ thá»ƒ gá»­i an toÃ n qua cÃ¡c luá»“ng hoáº·c truy cáº­p tá»« nhiá»u luá»“ng; do Ä‘Ã³, chÃºng ta cáº§n thá»±c hiá»‡n cÃ¡c kiá»ƒm tra nÃ y thá»§ cÃ´ng vÃ  chá»‰ ra Ä‘iá»u Ä‘Ã³ báº±ng <code>unsafe</code>.</p>
<h3 id="truy-cáº­p-cÃ¡c-trÆ°á»ng-cá»§a-má»™t-union"><a class="header" href="#truy-cáº­p-cÃ¡c-trÆ°á»ng-cá»§a-má»™t-union">Truy cáº­p cÃ¡c trÆ°á»ng cá»§a má»™t Union</a></h3>
<p>HÃ nh Ä‘á»™ng cuá»‘i cÃ¹ng chá»‰ hoáº¡t Ä‘á»™ng vá»›i <code>unsafe</code> lÃ  truy cáº­p cÃ¡c trÆ°á»ng cá»§a má»™t <em>union</em>. Má»™t <code>union</code> tÆ°Æ¡ng tá»± nhÆ° má»™t <code>struct</code>, nhÆ°ng táº¡i má»™t thá»i Ä‘iá»ƒm chá»‰ má»™t trÆ°á»ng Ä‘Æ°á»£c khai bÃ¡o Ä‘Æ°á»£c sá»­ dá»¥ng trong má»™t thá»ƒ hiá»‡n cá»¥ thá»ƒ. Union chá»§ yáº¿u Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i union trong mÃ£ C. Viá»‡c truy cáº­p cÃ¡c trÆ°á»ng cá»§a union lÃ  unsafe vÃ¬ Rust khÃ´ng thá»ƒ Ä‘áº£m báº£o kiá»ƒu dá»¯ liá»‡u Ä‘ang Ä‘Æ°á»£c lÆ°u trá»¯ trong thá»ƒ hiá»‡n union lÃ  gÃ¬. Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm vá» union trong <a href="../reference/items/unions.html">the Rust Reference</a>.</p>
<h3 id="khi-nÃ o-nÃªn-sá»­-dá»¥ng-mÃ£-unsafe"><a class="header" href="#khi-nÃ o-nÃªn-sá»­-dá»¥ng-mÃ£-unsafe">Khi nÃ o nÃªn sá»­ dá»¥ng mÃ£ Unsafe</a></h3>
<p>Viá»‡c sá»­ dá»¥ng <code>unsafe</code> Ä‘á»ƒ thá»±c hiá»‡n má»™t trong nÄƒm hÃ nh Ä‘á»™ng (siÃªu nÄƒng lá»±c) vá»«a tháº£o luáº­n khÃ´ng pháº£i lÃ  sai hoáº·c bá»‹ coi thÆ°á»ng. NhÆ°ng viá»‡c viáº¿t mÃ£ <code>unsafe</code> Ä‘Ãºng lÃ  khÃ³ hÆ¡n vÃ¬ trÃ¬nh biÃªn dá»‹ch khÃ´ng thá»ƒ Ä‘áº£m báº£o an toÃ n bá»™ nhá»›. Khi báº¡n cÃ³ lÃ½ do Ä‘á»ƒ sá»­ dá»¥ng mÃ£ <code>unsafe</code>, báº¡n cÃ³ thá»ƒ lÃ m nhÆ° váº­y, vÃ  viá»‡c cÃ³ chÃº thÃ­ch <code>unsafe</code> rÃµ rÃ ng giÃºp dá»… dÃ ng theo dÃµi nguá»“n gá»‘c cá»§a váº¥n Ä‘á» khi chÃºng xáº£y ra.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="advanced-traits"><a class="header" href="#advanced-traits">Advanced Traits</a></h2>
<p>ChÃºng ta Ä‘Ã£ láº§n Ä‘áº§u tiÃªn tÃ¬m hiá»ƒu vá» traits trong pháº§n <a href="ch10-02-traits.html#traits-defining-shared-behavior">â€œTraits: Defining Shared Behaviorâ€</a><!-- ignore --> á»Ÿ ChÆ°Æ¡ng 10, nhÆ°ng chÆ°a tháº£o luáº­n vá» cÃ¡c chi tiáº¿t nÃ¢ng cao hÆ¡n. Giá» khi báº¡n Ä‘Ã£ biáº¿t thÃªm vá» Rust, chÃºng ta cÃ³ thá»ƒ Ä‘i vÃ o cÃ¡c chi tiáº¿t ká»¹ thuáº­t.</p>
<h3 id="chá»‰-Ä‘á»‹nh-loáº¡i-placeholder-trong-Ä‘á»‹nh-nghÄ©a-trait-vá»›i-associated-types"><a class="header" href="#chá»‰-Ä‘á»‹nh-loáº¡i-placeholder-trong-Ä‘á»‹nh-nghÄ©a-trait-vá»›i-associated-types">Chá»‰ Ä‘á»‹nh loáº¡i placeholder trong Ä‘á»‹nh nghÄ©a Trait vá»›i Associated Types</a></h3>
<p><em>Associated types</em> káº¿t ná»‘i má»™t placeholder type vá»›i má»™t trait sao cho cÃ¡c Ä‘á»‹nh nghÄ©a phÆ°Æ¡ng thá»©c cá»§a trait cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c loáº¡i placeholder nÃ y trong chá»¯ kÃ½ cá»§a chÃºng. NgÆ°á»i triá»ƒn khai má»™t trait sáº½ chá»‰ Ä‘á»‹nh loáº¡i cá»¥ thá»ƒ sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng thay cho placeholder type cho triá»ƒn khai Ä‘Ã³. Nhá» Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a má»™t trait sá»­ dá»¥ng má»™t sá»‘ loáº¡i mÃ  khÃ´ng cáº§n biáº¿t chÃ­nh xÃ¡c cÃ¡c loáº¡i Ä‘Ã³ lÃ  gÃ¬ cho Ä‘áº¿n khi trait Ä‘Æ°á»£c triá»ƒn khai.</p>
<p>ChÃºng tÃ´i Ä‘Ã£ mÃ´ táº£ háº§u háº¿t cÃ¡c tÃ­nh nÄƒng nÃ¢ng cao trong chÆ°Æ¡ng nÃ y lÃ  hiáº¿m khi cáº§n Ä‘áº¿n. Associated types náº±m á»Ÿ má»©c trung gian: chÃºng Ä‘Æ°á»£c sá»­ dá»¥ng Ã­t hÆ¡n cÃ¡c tÃ­nh nÄƒng Ä‘Æ°á»£c giáº£i thÃ­ch trong pháº§n cÃ²n láº¡i cá»§a cuá»‘n sÃ¡ch nhÆ°ng phá»• biáº¿n hÆ¡n nhiá»u so vá»›i cÃ¡c tÃ­nh nÄƒng khÃ¡c Ä‘Æ°á»£c tháº£o luáº­n trong chÆ°Æ¡ng nÃ y.</p>
<p>Má»™t vÃ­ dá»¥ vá» trait vá»›i associated type lÃ  trait <code>Iterator</code> mÃ  thÆ° viá»‡n chuáº©n cung cáº¥p. Associated type Ä‘Æ°á»£c Ä‘áº·t tÃªn lÃ  <code>Item</code> vÃ  Ä‘áº¡i diá»‡n cho kiá»ƒu giÃ¡ trá»‹ mÃ  kiá»ƒu triá»ƒn khai trait <code>Iterator</code> Ä‘ang láº·p qua. Äá»‹nh nghÄ©a cá»§a trait <code>Iterator</code> Ä‘Æ°á»£c trÃ¬nh bÃ y nhÆ° trong Listing 19-12.</p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-12/src/lib.rs}}</code></pre>
<p><span class="caption">Listing 19-12: Äá»‹nh nghÄ©a trait <code>Iterator</code> vá»›i associated type <code>Item</code></span></p>
<p>Kiá»ƒu <code>Item</code> lÃ  má»™t placeholder, vÃ  Ä‘á»‹nh nghÄ©a phÆ°Æ¡ng thá»©c <code>next</code> cho tháº¥y nÃ³ sáº½ tráº£ vá» cÃ¡c giÃ¡ trá»‹ kiá»ƒu <code>Option&lt;Self::Item&gt;</code>. NgÆ°á»i triá»ƒn khai trait <code>Iterator</code> sáº½ chá»‰ Ä‘á»‹nh kiá»ƒu cá»¥ thá»ƒ cho <code>Item</code>, vÃ  phÆ°Æ¡ng thá»©c <code>next</code> sáº½ tráº£ vá» má»™t <code>Option</code> chá»©a giÃ¡ trá»‹ cá»§a kiá»ƒu cá»¥ thá»ƒ Ä‘Ã³.</p>
<p>Associated types cÃ³ váº» giá»‘ng vá»›i generics, vÃ¬ generics cho phÃ©p chÃºng ta Ä‘á»‹nh nghÄ©a má»™t hÃ m mÃ  khÃ´ng cáº§n chá»‰ Ä‘á»‹nh cÃ¡c kiá»ƒu mÃ  nÃ³ cÃ³ thá»ƒ xá»­ lÃ½. Äá»ƒ xem sá»± khÃ¡c biá»‡t giá»¯a hai khÃ¡i niá»‡m nÃ y, chÃºng ta sáº½ xem má»™t triá»ƒn khai trait <code>Iterator</code> trÃªn má»™t kiá»ƒu cÃ³ tÃªn lÃ  <code>Counter</code> mÃ  chá»‰ Ä‘á»‹nh kiá»ƒu <code>Item</code> lÃ  <code>u32</code>:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-22-iterator-on-counter/src/lib.rs:ch19}}</code></pre>
<p>CÃº phÃ¡p nÃ y cÃ³ váº» tÆ°Æ¡ng tá»± nhÆ° cÃº phÃ¡p cá»§a generics. Váº­y táº¡i sao khÃ´ng Ä‘á»‹nh nghÄ©a trait <code>Iterator</code> vá»›i generics, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 19-13?</p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-13/src/lib.rs}}</code></pre>
<p><span class="caption">Listing 19-13: Má»™t Ä‘á»‹nh nghÄ©a giáº£ tÆ°á»Ÿng cá»§a trait <code>Iterator</code> sá»­ dá»¥ng generics</span></p>
<p>Sá»± khÃ¡c biá»‡t lÃ  khi sá»­ dá»¥ng generics, nhÆ° trong Listing 19-13, chÃºng ta pháº£i chÃº thÃ­ch cÃ¡c kiá»ƒu trong má»—i triá»ƒn khai; vÃ¬ chÃºng ta cÅ©ng cÃ³ thá»ƒ triá»ƒn khai <code>Iterator&lt;String&gt; for Counter</code> hoáº·c báº¥t ká»³ kiá»ƒu nÃ o khÃ¡c, chÃºng ta cÃ³ thá»ƒ cÃ³ nhiá»u triá»ƒn khai cá»§a <code>Iterator</code> cho <code>Counter</code>. NÃ³i cÃ¡ch khÃ¡c, khi má»™t trait cÃ³ tham sá»‘ generic, nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c triá»ƒn khai cho má»™t kiá»ƒu nhiá»u láº§n, thay Ä‘á»•i cÃ¡c kiá»ƒu cá»¥ thá»ƒ cá»§a cÃ¡c tham sá»‘ generic má»—i láº§n. Khi chÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>next</code> trÃªn <code>Counter</code>, chÃºng ta pháº£i cung cáº¥p chÃº thÃ­ch kiá»ƒu Ä‘á»ƒ chá»‰ ra triá»ƒn khai <code>Iterator</code> nÃ o muá»‘n sá»­ dá»¥ng.</p>
<p>Vá»›i associated types, chÃºng ta khÃ´ng cáº§n chÃº thÃ­ch kiá»ƒu vÃ¬ chÃºng ta khÃ´ng thá»ƒ triá»ƒn khai má»™t trait trÃªn cÃ¹ng má»™t kiá»ƒu nhiá»u láº§n. Trong Listing 19-12 vá»›i Ä‘á»‹nh nghÄ©a sá»­ dá»¥ng associated types, chÃºng ta chá»‰ cÃ³ thá»ƒ chá»n kiá»ƒu cá»§a <code>Item</code> má»™t láº§n, vÃ¬ chá»‰ cÃ³ má»™t <code>impl Iterator for Counter</code>. ChÃºng ta khÃ´ng cáº§n pháº£i chá»‰ Ä‘á»‹nh ráº±ng muá»‘n má»™t iterator cá»§a cÃ¡c giÃ¡ trá»‹ <code>u32</code> á»Ÿ má»i nÆ¡i mÃ  gá»i <code>next</code> trÃªn <code>Counter</code>.</p>
<p>Associated types cÅ©ng trá»Ÿ thÃ nh má»™t pháº§n cá»§a há»£p Ä‘á»“ng cá»§a trait: ngÆ°á»i triá»ƒn khai trait pháº£i cung cáº¥p má»™t kiá»ƒu Ä‘á»ƒ thay tháº¿ cho placeholder cá»§a associated type. Associated types thÆ°á»ng cÃ³ má»™t tÃªn mÃ´ táº£ cÃ¡ch sá»­ dá»¥ng kiá»ƒu Ä‘Ã³, vÃ  viá»‡c tÃ i liá»‡u hÃ³a associated type trong tÃ i liá»‡u API lÃ  má»™t thá»±c hÃ nh tá»‘t.</p>
<h3 id="tham-sá»‘-kiá»ƒu-generic-máº·c-Ä‘á»‹nh-vÃ -náº¡p-chá»“ng-toÃ¡n-tá»­-operator-overloading"><a class="header" href="#tham-sá»‘-kiá»ƒu-generic-máº·c-Ä‘á»‹nh-vÃ -náº¡p-chá»“ng-toÃ¡n-tá»­-operator-overloading">Tham sá»‘ kiá»ƒu Generic máº·c Ä‘á»‹nh vÃ  Náº¡p chá»“ng toÃ¡n tá»­ (Operator Overloading)</a></h3>
<p>Khi sá»­ dá»¥ng tham sá»‘ kiá»ƒu generic, chÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh má»™t kiá»ƒu cá»¥ thá»ƒ máº·c Ä‘á»‹nh cho generic type. Äiá»u nÃ y loáº¡i bá» nhu cáº§u ngÆ°á»i triá»ƒn khai trait pháº£i chá»‰ Ä‘á»‹nh kiá»ƒu cá»¥ thá»ƒ náº¿u kiá»ƒu máº·c Ä‘á»‹nh phÃ¹ há»£p. Báº¡n chá»‰ Ä‘á»‹nh kiá»ƒu máº·c Ä‘á»‹nh khi khai bÃ¡o má»™t kiá»ƒu generic vá»›i cÃº phÃ¡p <code>&lt;PlaceholderType=ConcreteType&gt;</code>.</p>
<p>Má»™t vÃ­ dá»¥ tuyá»‡t vá»i vá» tÃ¬nh huá»‘ng mÃ  ká»¹ thuáº­t nÃ y há»¯u Ã­ch lÃ  vá»›i <em>operator overloading</em>, trong Ä‘Ã³ báº¡n tÃ¹y chá»‰nh hÃ nh vi cá»§a má»™t toÃ¡n tá»­ (cháº³ng háº¡n <code>+</code>) trong cÃ¡c tÃ¬nh huá»‘ng cá»¥ thá»ƒ.</p>
<p>Rust khÃ´ng cho phÃ©p báº¡n táº¡o toÃ¡n tá»­ riÃªng hoáº·c náº¡p chá»“ng cÃ¡c toÃ¡n tá»­ tÃ¹y Ã½. NhÆ°ng báº¡n cÃ³ thá»ƒ náº¡p chá»“ng cÃ¡c phÃ©p toÃ¡n vÃ  trait tÆ°Æ¡ng á»©ng Ä‘Æ°á»£c liá»‡t kÃª trong <code>std::ops</code> báº±ng cÃ¡ch triá»ƒn khai cÃ¡c trait liÃªn quan Ä‘áº¿n toÃ¡n tá»­ Ä‘Ã³. VÃ­ dá»¥, trong Listing 19-14 chÃºng ta náº¡p chá»“ng toÃ¡n tá»­ <code>+</code> Ä‘á»ƒ cá»™ng hai thá»ƒ hiá»‡n <code>Point</code> vá»›i nhau. ChÃºng ta lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch triá»ƒn khai trait <code>Add</code> trÃªn struct <code>Point</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-14/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-14: Triá»ƒn khai trait <code>Add</code> Ä‘á»ƒ náº¡p chá»“ng toÃ¡n tá»­ <code>+</code> cho cÃ¡c thá»ƒ hiá»‡n <code>Point</code></span></p>
<p>PhÆ°Æ¡ng thá»©c <code>add</code> cá»™ng cÃ¡c giÃ¡ trá»‹ <code>x</code> cá»§a hai thá»ƒ hiá»‡n <code>Point</code> vÃ  cÃ¡c giÃ¡ trá»‹ <code>y</code> cá»§a hai thá»ƒ hiá»‡n <code>Point</code> Ä‘á»ƒ táº¡o ra má»™t <code>Point</code> má»›i. Trait <code>Add</code> cÃ³ má»™t associated type tÃªn lÃ  <code>Output</code> xÃ¡c Ä‘á»‹nh kiá»ƒu Ä‘Æ°á»£c tráº£ vá» tá»« phÆ°Æ¡ng thá»©c <code>add</code>.</p>
<p>Tham sá»‘ kiá»ƒu generic máº·c Ä‘á»‹nh trong mÃ£ nÃ y náº±m trong trait <code>Add</code>. ÄÃ¢y lÃ  Ä‘á»‹nh nghÄ©a cá»§a nÃ³:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Add&lt;Rhs=Self&gt; {
    type Output;

    fn add(self, rhs: Rhs) -&gt; Self::Output;
}
<span class="boring">}</span></code></pre></pre>
<p>MÃ£ nÃ y cÃ³ váº» khÃ¡ quen thuá»™c: má»™t trait vá»›i má»™t phÆ°Æ¡ng thá»©c vÃ  má»™t associated type. Pháº§n má»›i lÃ  <code>Rhs=Self</code>: cÃº phÃ¡p nÃ y Ä‘Æ°á»£c gá»i lÃ  <em>default type parameters</em>. Tham sá»‘ kiá»ƒu generic <code>Rhs</code> (viáº¿t táº¯t cá»§a â€œright hand sideâ€) xÃ¡c Ä‘á»‹nh kiá»ƒu cá»§a tham sá»‘ <code>rhs</code> trong phÆ°Æ¡ng thá»©c <code>add</code>. Náº¿u chÃºng ta khÃ´ng chá»‰ Ä‘á»‹nh má»™t kiá»ƒu cá»¥ thá»ƒ cho <code>Rhs</code> khi triá»ƒn khai trait <code>Add</code>, kiá»ƒu cá»§a <code>Rhs</code> sáº½ máº·c Ä‘á»‹nh lÃ  <code>Self</code>, tá»©c lÃ  kiá»ƒu mÃ  chÃºng ta Ä‘ang triá»ƒn khai <code>Add</code>.</p>
<p>Khi chÃºng ta triá»ƒn khai <code>Add</code> cho <code>Point</code>, chÃºng ta sá»­ dá»¥ng máº·c Ä‘á»‹nh cho <code>Rhs</code> vÃ¬ muá»‘n cá»™ng hai thá»ƒ hiá»‡n <code>Point</code>. HÃ£y xem má»™t vÃ­ dá»¥ vá» viá»‡c triá»ƒn khai trait <code>Add</code> mÃ  chÃºng ta muá»‘n tÃ¹y chá»‰nh kiá»ƒu <code>Rhs</code> thay vÃ¬ sá»­ dá»¥ng máº·c Ä‘á»‹nh.</p>
<p>ChÃºng ta cÃ³ hai struct, <code>Millimeters</code> vÃ  <code>Meters</code>, chá»©a cÃ¡c giÃ¡ trá»‹ á»Ÿ cÃ¡c Ä‘Æ¡n vá»‹ khÃ¡c nhau. Viá»‡c bao bá»c má»ng má»™t kiá»ƒu hiá»‡n cÃ³ trong má»™t struct khÃ¡c Ä‘Æ°á»£c gá»i lÃ  <em>newtype pattern</em>, mÃ  chÃºng ta mÃ´ táº£ chi tiáº¿t hÆ¡n trong pháº§n <a href="ch19-03-advanced-traits.html#using-the-newtype-pattern-to-implement-external-traits-on-external-types">â€œUsing the Newtype Pattern to Implement External Traits on External Typesâ€</a><!-- ignore -->. ChÃºng ta muá»‘n cá»™ng cÃ¡c giÃ¡ trá»‹ millimeters vá»›i cÃ¡c giÃ¡ trá»‹ meters vÃ  Ä‘áº£m báº£o viá»‡c triá»ƒn khai <code>Add</code> thá»±c hiá»‡n chuyá»ƒn Ä‘á»•i Ä‘Ãºng. ChÃºng ta cÃ³ thá»ƒ triá»ƒn khai <code>Add</code> cho <code>Millimeters</code> vá»›i <code>Meters</code> lÃ  <code>Rhs</code>, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 19-15.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-15/src/lib.rs}}</code></pre>
<p><span class="caption">Listing 19-15: Triá»ƒn khai trait <code>Add</code> trÃªn <code>Millimeters</code> Ä‘á»ƒ cá»™ng <code>Millimeters</code> vá»›i <code>Meters</code></span></p>
<p>Äá»ƒ cá»™ng <code>Millimeters</code> vÃ  <code>Meters</code>, chÃºng ta chá»‰ Ä‘á»‹nh <code>impl Add&lt;Meters&gt;</code> Ä‘á»ƒ Ä‘áº·t giÃ¡ trá»‹ cá»§a tham sá»‘ kiá»ƒu <code>Rhs</code> thay vÃ¬ sá»­ dá»¥ng máº·c Ä‘á»‹nh lÃ  <code>Self</code>.</p>
<p>Báº¡n sáº½ sá»­ dá»¥ng default type parameters theo hai cÃ¡ch chÃ­nh:</p>
<ul>
<li>Má»Ÿ rá»™ng má»™t kiá»ƒu mÃ  khÃ´ng phÃ¡ vá»¡ mÃ£ hiá»‡n cÃ³</li>
<li>Cho phÃ©p tÃ¹y chá»‰nh trong cÃ¡c trÆ°á»ng há»£p cá»¥ thá»ƒ mÃ  háº§u háº¿t ngÆ°á»i dÃ¹ng khÃ´ng cáº§n Ä‘áº¿n</li>
</ul>
<p>Trait <code>Add</code> trong thÆ° viá»‡n chuáº©n lÃ  má»™t vÃ­ dá»¥ cho má»¥c Ä‘Ã­ch thá»© hai: thÆ°á»ng thÃ¬ báº¡n sáº½ cá»™ng hai kiá»ƒu giá»‘ng nhau, nhÆ°ng trait <code>Add</code> cung cáº¥p kháº£ nÄƒng tÃ¹y chá»‰nh vÆ°á»£t ra ngoÃ i Ä‘iá»u Ä‘Ã³. Viá»‡c sá»­ dá»¥ng default type parameter trong Ä‘á»‹nh nghÄ©a trait <code>Add</code> cÃ³ nghÄ©a lÃ  báº¡n khÃ´ng cáº§n chá»‰ Ä‘á»‹nh tham sá»‘ bá»• sung háº§u háº¿t thá»i gian. NÃ³i cÃ¡ch khÃ¡c, má»™t chÃºt boilerplate khi triá»ƒn khai khÃ´ng cáº§n thiáº¿t, giÃºp trait dá»… sá»­ dá»¥ng hÆ¡n.</p>
<p>Má»¥c Ä‘Ã­ch thá»© nháº¥t tÆ°Æ¡ng tá»± má»¥c Ä‘Ã­ch thá»© hai nhÆ°ng ngÆ°á»£c láº¡i: náº¿u báº¡n muá»‘n thÃªm má»™t tham sá»‘ kiá»ƒu vÃ o má»™t trait hiá»‡n cÃ³, báº¡n cÃ³ thá»ƒ cung cáº¥p giÃ¡ trá»‹ máº·c Ä‘á»‹nh Ä‘á»ƒ má»Ÿ rá»™ng chá»©c nÄƒng cá»§a trait mÃ  khÃ´ng phÃ¡ vá»¡ mÃ£ triá»ƒn khai hiá»‡n cÃ³.</p>
<h3 id="cÃº-phÃ¡p-Ä‘áº§y-Ä‘á»§-Ä‘á»ƒ-phÃ¢n-biá»‡t-gá»i-phÆ°Æ¡ng-thá»©c-cÃ¹ng-tÃªn"><a class="header" href="#cÃº-phÃ¡p-Ä‘áº§y-Ä‘á»§-Ä‘á»ƒ-phÃ¢n-biá»‡t-gá»i-phÆ°Æ¡ng-thá»©c-cÃ¹ng-tÃªn">CÃº phÃ¡p Ä‘áº§y Ä‘á»§ Ä‘á»ƒ phÃ¢n biá»‡t: Gá»i phÆ°Æ¡ng thá»©c cÃ¹ng tÃªn</a></h3>
<p>Rust khÃ´ng ngÄƒn cáº£n má»™t trait cÃ³ phÆ°Æ¡ng thá»©c cÃ¹ng tÃªn vá»›i phÆ°Æ¡ng thá»©c cá»§a trait khÃ¡c, vÃ  cÅ©ng khÃ´ng ngÄƒn cáº£n báº¡n triá»ƒn khai cáº£ hai trait trÃªn cÃ¹ng má»™t kiá»ƒu. CÅ©ng cÃ³ thá»ƒ triá»ƒn khai phÆ°Æ¡ng thá»©c trá»±c tiáº¿p trÃªn kiá»ƒu vá»›i cÃ¹ng tÃªn nhÆ° cÃ¡c phÆ°Æ¡ng thá»©c tá»« trait.</p>
<p>Khi gá»i cÃ¡c phÆ°Æ¡ng thá»©c cÃ¹ng tÃªn, báº¡n cáº§n thÃ´ng bÃ¡o cho Rust biáº¿t báº¡n muá»‘n sá»­ dá»¥ng phÆ°Æ¡ng thá»©c nÃ o. Xem xÃ©t mÃ£ trong Listing 19-16, nÆ¡i chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a hai trait, <code>Pilot</code> vÃ  <code>Wizard</code>, Ä‘á»u cÃ³ phÆ°Æ¡ng thá»©c gá»i lÃ  <code>fly</code>. Sau Ä‘Ã³, chÃºng ta triá»ƒn khai cáº£ hai trait trÃªn kiá»ƒu <code>Human</code>, mÃ  kiá»ƒu nÃ y Ä‘Ã£ cÃ³ má»™t phÆ°Æ¡ng thá»©c tÃªn lÃ  <code>fly</code> Ä‘Æ°á»£c triá»ƒn khai trá»±c tiáº¿p. Má»—i phÆ°Æ¡ng thá»©c <code>fly</code> thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng khÃ¡c nhau.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-16/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-16: Hai trait Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a cÃ³ phÆ°Æ¡ng thá»©c <code>fly</code> vÃ  Ä‘Æ°á»£c triá»ƒn khai trÃªn kiá»ƒu <code>Human</code>, Ä‘á»“ng thá»i má»™t phÆ°Æ¡ng thá»©c <code>fly</code> Ä‘Æ°á»£c triá»ƒn khai trá»±c tiáº¿p trÃªn <code>Human</code></span></p>
<p>Khi chÃºng ta gá»i <code>fly</code> trÃªn má»™t thá»ƒ hiá»‡n cá»§a <code>Human</code>, trÃ¬nh biÃªn dá»‹ch máº·c Ä‘á»‹nh sáº½ gá»i phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c triá»ƒn khai trá»±c tiáº¿p trÃªn kiá»ƒu, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 19-17.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-17/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-17: Gá»i <code>fly</code> trÃªn má»™t thá»ƒ hiá»‡n cá»§a <code>Human</code></span></p>
<p>Cháº¡y mÃ£ nÃ y sáº½ in ra <code>*waving arms furiously*</code>, cho tháº¥y Rust Ä‘Ã£ gá»i phÆ°Æ¡ng thá»©c <code>fly</code> Ä‘Æ°á»£c triá»ƒn khai trá»±c tiáº¿p trÃªn <code>Human</code>.</p>
<p>Äá»ƒ gá»i cÃ¡c phÆ°Æ¡ng thá»©c <code>fly</code> tá»« trait <code>Pilot</code> hoáº·c trait <code>Wizard</code>, chÃºng ta cáº§n sá»­ dá»¥ng cÃº phÃ¡p rÃµ rÃ ng hÆ¡n Ä‘á»ƒ chá»‰ Ä‘á»‹nh phÆ°Æ¡ng thá»©c <code>fly</code> mÃ  chÃºng ta muá»‘n. Listing 19-18 minh há»a cÃº phÃ¡p nÃ y.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-18/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-18: Chá»‰ Ä‘á»‹nh phÆ°Æ¡ng thá»©c <code>fly</code> cá»§a trait nÃ o mÃ  chÃºng ta muá»‘n gá»i</span></p>
<p>Viá»‡c chá»‰ Ä‘á»‹nh tÃªn trait trÆ°á»›c tÃªn phÆ°Æ¡ng thá»©c giÃºp Rust hiá»ƒu rÃµ chÃºng ta muá»‘n gá»i triá»ƒn khai <code>fly</code> nÃ o. ChÃºng ta cÅ©ng cÃ³ thá»ƒ viáº¿t <code>Human::fly(&amp;person)</code>, Ä‘iá»u nÃ y tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i <code>person.fly()</code> mÃ  chÃºng ta Ä‘Ã£ sá»­ dá»¥ng trong Listing 19-18, nhÆ°ng cÃº phÃ¡p nÃ y dÃ i hÆ¡n má»™t chÃºt náº¿u khÃ´ng cáº§n phÃ¢n biá»‡t.</p>
<p>Cháº¡y mÃ£ nÃ y sáº½ in ra:</p>
<pre><code class="language-console">{{#include ../listings/ch19-advanced-features/listing-19-18/output.txt}}
</code></pre>
<p>VÃ¬ phÆ°Æ¡ng thá»©c <code>fly</code> nháº­n má»™t tham sá»‘ <code>self</code>, náº¿u chÃºng ta cÃ³ hai <em>kiá»ƒu</em> Ä‘á»u triá»ƒn khai cÃ¹ng má»™t <em>trait</em>, Rust cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh triá»ƒn khai cá»§a trait nÃ o sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng dá»±a trÃªn kiá»ƒu cá»§a <code>self</code>.</p>
<p>Tuy nhiÃªn, cÃ¡c hÃ m liÃªn quan (associated functions) mÃ  khÃ´ng pháº£i lÃ  phÆ°Æ¡ng thá»©c thÃ¬ khÃ´ng cÃ³ tham sá»‘ <code>self</code>. Khi cÃ³ nhiá»u kiá»ƒu hoáº·c trait Ä‘á»‹nh nghÄ©a cÃ¡c hÃ m khÃ´ng pháº£i phÆ°Æ¡ng thá»©c vá»›i cÃ¹ng tÃªn hÃ m, Rust khÃ´ng luÃ´n biáº¿t báº¡n muá»‘n dÃ¹ng kiá»ƒu nÃ o trá»« khi báº¡n sá»­ dá»¥ng <em>fully qualified syntax</em>. VÃ­ dá»¥, trong Listing 19-19, chÃºng ta táº¡o má»™t trait cho má»™t tráº¡i Ä‘á»™ng váº­t muá»‘n Ä‘áº·t tÃªn táº¥t cáº£ chÃ³ con lÃ  <em>Spot</em>. ChÃºng ta táº¡o trait <code>Animal</code> vá»›i má»™t hÃ m liÃªn quan khÃ´ng pháº£i phÆ°Æ¡ng thá»©c <code>baby_name</code>. Trait <code>Animal</code> Ä‘Æ°á»£c triá»ƒn khai cho struct <code>Dog</code>, trÃªn Ä‘Ã³ chÃºng ta cÅ©ng cung cáº¥p má»™t hÃ m liÃªn quan khÃ´ng pháº£i phÆ°Æ¡ng thá»©c <code>baby_name</code> trá»±c tiáº¿p.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-19/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-19: Má»™t trait vá»›i má»™t associated function vÃ  má»™t kiá»ƒu cÃ³ associated function cÃ¹ng tÃªn, Ä‘á»“ng thá»i triá»ƒn khai trait Ä‘Ã³</span></p>
<p>ChÃºng ta triá»ƒn khai mÃ£ Ä‘á»ƒ Ä‘áº·t tÃªn táº¥t cáº£ chÃ³ con lÃ  Spot trong hÃ m liÃªn quan <code>baby_name</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trá»±c tiáº¿p trÃªn <code>Dog</code>. Kiá»ƒu <code>Dog</code> cÅ©ng triá»ƒn khai trait <code>Animal</code>, mÃ´ táº£ cÃ¡c Ä‘áº·c Ä‘iá»ƒm mÃ  táº¥t cáº£ Ä‘á»™ng váº­t cÃ³. ChÃ³ con Ä‘Æ°á»£c gá»i lÃ  puppies, vÃ  Ä‘iá»u nÃ y Ä‘Æ°á»£c thá»ƒ hiá»‡n trong viá»‡c triá»ƒn khai trait <code>Animal</code> trÃªn <code>Dog</code> trong hÃ m <code>baby_name</code> liÃªn quan Ä‘áº¿n trait <code>Animal</code>.</p>
<p>Trong <code>main</code>, chÃºng ta gá»i hÃ m <code>Dog::baby_name</code>, phÆ°Æ¡ng thá»©c nÃ y gá»i hÃ m liÃªn quan Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trá»±c tiáº¿p trÃªn <code>Dog</code>. MÃ£ nÃ y sáº½ in ra:</p>
<pre><code class="language-console">{{#include ../listings/ch19-advanced-features/listing-19-19/output.txt}}
</code></pre>
<p>Káº¿t quáº£ nÃ y khÃ´ng pháº£i lÃ  Ä‘iá»u chÃºng ta muá»‘n. ChÃºng ta muá»‘n gá»i hÃ m <code>baby_name</code> lÃ  má»™t pháº§n cá»§a trait <code>Animal</code> mÃ  chÃºng ta Ä‘Ã£ triá»ƒn khai trÃªn <code>Dog</code> Ä‘á»ƒ mÃ£ in ra <code>A baby dog is called a puppy</code>. Ká»¹ thuáº­t chá»‰ Ä‘á»‹nh tÃªn trait mÃ  chÃºng ta Ä‘Ã£ sá»­ dá»¥ng trong Listing 19-18 khÃ´ng giÃºp Ä‘Æ°á»£c á»Ÿ Ä‘Ã¢y; náº¿u chÃºng ta thay Ä‘á»•i <code>main</code> thÃ nh mÃ£ trong Listing 19-20, sáº½ xáº£y ra lá»—i biÃªn dá»‹ch.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-20/src/main.rs:here}}</code></pre>
<p><span class="caption">Listing 19-20: Thá»­ gá»i hÃ m <code>baby_name</code> tá»« trait <code>Animal</code>, nhÆ°ng Rust khÃ´ng biáº¿t triá»ƒn khai nÃ o sáº½ sá»­ dá»¥ng</span></p>
<p>VÃ¬ <code>Animal::baby_name</code> khÃ´ng cÃ³ tham sá»‘ <code>self</code>, vÃ  cÃ³ thá»ƒ cÃ³ cÃ¡c kiá»ƒu khÃ¡c triá»ƒn khai trait <code>Animal</code>, Rust khÃ´ng thá»ƒ xÃ¡c Ä‘á»‹nh triá»ƒn khai nÃ o cá»§a <code>Animal::baby_name</code> mÃ  chÃºng ta muá»‘n sá»­ dá»¥ng. ChÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i biÃªn dá»‹ch sau:</p>
<pre><code class="language-console">{{#include ../listings/ch19-advanced-features/listing-19-20/output.txt}}
</code></pre>
<p>Äá»ƒ phÃ¢n biá»‡t vÃ  cho Rust biáº¿t ráº±ng chÃºng ta muá»‘n sá»­ dá»¥ng triá»ƒn khai cá»§a <code>Animal</code> cho <code>Dog</code> thay vÃ¬ triá»ƒn khai cá»§a <code>Animal</code> cho má»™t kiá»ƒu khÃ¡c, chÃºng ta cáº§n sá»­ dá»¥ng cÃº phÃ¡p Ä‘áº§y Ä‘á»§ (fully qualified syntax). Listing 19-21 minh há»a cÃ¡ch sá»­ dá»¥ng cÃº phÃ¡p Ä‘áº§y Ä‘á»§.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-21/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-21: Sá»­ dá»¥ng cÃº phÃ¡p Ä‘áº§y Ä‘á»§ Ä‘á»ƒ chá»‰ Ä‘á»‹nh ráº±ng chÃºng ta muá»‘n gá»i hÃ m <code>baby_name</code> tá»« trait <code>Animal</code> Ä‘Æ°á»£c triá»ƒn khai trÃªn <code>Dog</code></span></p>
<p>ChÃºng ta cung cáº¥p cho Rust má»™t chÃº thÃ­ch kiá»ƒu trong dáº¥u ngoáº·c nhá»n, cho biáº¿t chÃºng ta muá»‘n gá»i phÆ°Æ¡ng thá»©c <code>baby_name</code> tá»« trait <code>Animal</code> nhÆ° Ä‘Æ°á»£c triá»ƒn khai trÃªn <code>Dog</code> báº±ng cÃ¡ch nÃ³i ráº±ng chÃºng ta muá»‘n coi kiá»ƒu <code>Dog</code> nhÆ° má»™t <code>Animal</code> cho láº§n gá»i hÃ m nÃ y. MÃ£ nÃ y bÃ¢y giá» sáº½ in ra káº¿t quáº£ nhÆ° mong muá»‘n:</p>
<pre><code class="language-console">{{#include ../listings/ch19-advanced-features/listing-19-21/output.txt}}
</code></pre>
<p>NÃ³i chung, cÃº phÃ¡p Ä‘áº§y Ä‘á»§ (fully qualified syntax) Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° sau:</p>
<pre><code class="language-rust ignore">&lt;Type as Trait&gt;::function(receiver_if_method, next_arg, ...);</code></pre>
<p>Äá»‘i vá»›i cÃ¡c hÃ m liÃªn quan (associated functions) khÃ´ng pháº£i lÃ  phÆ°Æ¡ng thá»©c, sáº½ khÃ´ng cÃ³ <code>receiver</code>: chá»‰ cÃ³ danh sÃ¡ch cÃ¡c tham sá»‘ khÃ¡c. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃº phÃ¡p Ä‘áº§y Ä‘á»§ á»Ÿ báº¥t cá»© nÆ¡i nÃ o gá»i hÃ m hoáº·c phÆ°Æ¡ng thá»©c. Tuy nhiÃªn, báº¡n Ä‘Æ°á»£c phÃ©p bá» báº¥t ká»³ pháº§n nÃ o cá»§a cÃº phÃ¡p nÃ y mÃ  Rust cÃ³ thá»ƒ suy ra tá»« cÃ¡c thÃ´ng tin khÃ¡c trong chÆ°Æ¡ng trÃ¬nh. Báº¡n chá»‰ cáº§n sá»­ dá»¥ng cÃº phÃ¡p dÃ i dÃ²ng hÆ¡n nÃ y trong nhá»¯ng trÆ°á»ng há»£p cÃ³ nhiá»u triá»ƒn khai sá»­ dá»¥ng cÃ¹ng má»™t tÃªn vÃ  Rust cáº§n giÃºp xÃ¡c Ä‘á»‹nh triá»ƒn khai nÃ o báº¡n muá»‘n gá»i.</p>
<h3 id="sá»­-dá»¥ng-supertraits-Ä‘á»ƒ-yÃªu-cáº§u-chá»©c-nÄƒng-cá»§a-má»™t-trait-trong-má»™t-trait-khÃ¡c"><a class="header" href="#sá»­-dá»¥ng-supertraits-Ä‘á»ƒ-yÃªu-cáº§u-chá»©c-nÄƒng-cá»§a-má»™t-trait-trong-má»™t-trait-khÃ¡c">Sá»­ dá»¥ng Supertraits Ä‘á»ƒ yÃªu cáº§u chá»©c nÄƒng cá»§a má»™t trait trong má»™t trait khÃ¡c</a></h3>
<p>ÄÃ´i khi, báº¡n cÃ³ thá»ƒ viáº¿t má»™t Ä‘á»‹nh nghÄ©a trait phá»¥ thuá»™c vÃ o má»™t trait khÃ¡c: Ä‘á»ƒ má»™t kiá»ƒu triá»ƒn khai trait Ä‘áº§u tiÃªn, báº¡n muá»‘n yÃªu cáº§u kiá»ƒu Ä‘Ã³ cÅ©ng pháº£i triá»ƒn khai trait thá»© hai. Báº¡n lÃ m Ä‘iá»u nÃ y Ä‘á»ƒ Ä‘á»‹nh nghÄ©a trait cá»§a báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c thÃ nh pháº§n liÃªn quan (associated items) cá»§a trait thá»© hai. Trait mÃ  Ä‘á»‹nh nghÄ©a trait cá»§a báº¡n dá»±a vÃ o Ä‘Æ°á»£c gá»i lÃ  <em>supertrait</em> cá»§a trait Ä‘Ã³.</p>
<p>VÃ­ dá»¥, giáº£ sá»­ chÃºng ta muá»‘n táº¡o má»™t trait <code>OutlinePrint</code> vá»›i má»™t phÆ°Æ¡ng thá»©c <code>outline_print</code> sáº½ in má»™t giÃ¡ trá»‹ sao cho Ä‘Æ°á»£c khung bá»Ÿi cÃ¡c dáº¥u sao. Tá»©c lÃ , vá»›i struct <code>Point</code> triá»ƒn khai trait <code>Display</code> cá»§a thÆ° viá»‡n chuáº©n Ä‘á»ƒ hiá»ƒn thá»‹ <code>(x, y)</code>, khi chÃºng ta gá»i <code>outline_print</code> trÃªn má»™t thá»ƒ hiá»‡n <code>Point</code> cÃ³ <code>x = 1</code> vÃ  <code>y = 3</code>, nÃ³ sáº½ in ra:</p>
<pre><code class="language-text">**********
*        *
* (1, 3) *
*        *
**********
</code></pre>
<p>Trong viá»‡c triá»ƒn khai phÆ°Æ¡ng thá»©c <code>outline_print</code>, chÃºng ta muá»‘n sá»­ dá»¥ng chá»©c nÄƒng cá»§a trait <code>Display</code>. Do Ä‘Ã³, chÃºng ta cáº§n chá»‰ Ä‘á»‹nh ráº±ng trait <code>OutlinePrint</code> sáº½ chá»‰ hoáº¡t Ä‘á»™ng cho cÃ¡c kiá»ƒu cÅ©ng triá»ƒn khai <code>Display</code> vÃ  cung cáº¥p cÃ¡c chá»©c nÄƒng mÃ  <code>OutlinePrint</code> cáº§n. ChÃºng ta cÃ³ thá»ƒ lÃ m Ä‘iá»u Ä‘Ã³ trong Ä‘á»‹nh nghÄ©a trait báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh <code>OutlinePrint: Display</code>. Ká»¹ thuáº­t nÃ y tÆ°Æ¡ng tá»± nhÆ° viá»‡c thÃªm má»™t trait bound vÃ o trait. Listing 19-22 trÃ¬nh bÃ y má»™t triá»ƒn khai cá»§a trait <code>OutlinePrint</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-22/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-22: Triá»ƒn khai trait <code>OutlinePrint</code> yÃªu cáº§u chá»©c nÄƒng tá»« <code>Display</code></span></p>
<p>VÃ¬ chÃºng ta Ä‘Ã£ chá»‰ Ä‘á»‹nh ráº±ng <code>OutlinePrint</code> yÃªu cáº§u trait <code>Display</code>, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng hÃ m <code>to_string</code> Ä‘Æ°á»£c triá»ƒn khai tá»± Ä‘á»™ng cho báº¥t ká»³ kiá»ƒu nÃ o triá»ƒn khai <code>Display</code>. Náº¿u chÃºng ta thá»­ sá»­ dá»¥ng <code>to_string</code> mÃ  khÃ´ng thÃªm dáº¥u hai cháº¥m vÃ  chá»‰ Ä‘á»‹nh trait <code>Display</code> sau tÃªn trait, chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i nÃ³i ráº±ng khÃ´ng tÃ¬m tháº¥y phÆ°Æ¡ng thá»©c nÃ o tÃªn lÃ  <code>to_string</code> cho kiá»ƒu <code>&amp;Self</code> trong pháº¡m vi hiá»‡n táº¡i.</p>
<p>HÃ£y xem Ä‘iá»u gÃ¬ xáº£y ra khi chÃºng ta cá»‘ triá»ƒn khai <code>OutlinePrint</code> trÃªn má»™t kiá»ƒu khÃ´ng triá»ƒn khai <code>Display</code>, cháº³ng háº¡n nhÆ° struct <code>Point</code>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-02-impl-outlineprint-for-point/src/main.rs:here}}</code></pre>
<p>ChÃºng ta sáº½ nháº­n Ä‘Æ°á»£c lá»—i nÃ³i ráº±ng trait <code>Display</code> lÃ  báº¯t buá»™c nhÆ°ng chÆ°a Ä‘Æ°á»£c triá»ƒn khai:</p>
<pre><code class="language-console">{{#include ../listings/ch19-advanced-features/no-listing-02-impl-outlineprint-for-point/output.txt}}
</code></pre>
<p>Äá»ƒ kháº¯c phá»¥c, chÃºng ta triá»ƒn khai trait <code>Display</code> trÃªn <code>Point</code> vÃ  thá»a mÃ£n rÃ ng buá»™c mÃ  <code>OutlinePrint</code> yÃªu cáº§u, nhÆ° sau:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-03-impl-display-for-point/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>Sau Ä‘Ã³, viá»‡c triá»ƒn khai trait <code>OutlinePrint</code> trÃªn <code>Point</code> sáº½ biÃªn dá»‹ch thÃ nh cÃ´ng, vÃ  chÃºng ta cÃ³ thá»ƒ gá»i <code>outline_print</code> trÃªn má»™t thá»ƒ hiá»‡n cá»§a <code>Point</code> Ä‘á»ƒ hiá»ƒn thá»‹ nÃ³ trong má»™t khung dáº¥u sao.</p>
<h3 id="sá»­-dá»¥ng-newtype-pattern-Ä‘á»ƒ-triá»ƒn-khai-cÃ¡c-trait-bÃªn-ngoÃ i-trÃªn-cÃ¡c-kiá»ƒu-bÃªn-ngoÃ i"><a class="header" href="#sá»­-dá»¥ng-newtype-pattern-Ä‘á»ƒ-triá»ƒn-khai-cÃ¡c-trait-bÃªn-ngoÃ i-trÃªn-cÃ¡c-kiá»ƒu-bÃªn-ngoÃ i">Sá»­ dá»¥ng Newtype Pattern Ä‘á»ƒ triá»ƒn khai cÃ¡c trait bÃªn ngoÃ i trÃªn cÃ¡c kiá»ƒu bÃªn ngoÃ i</a></h3>
<p>Trong ChÆ°Æ¡ng 10, trong pháº§n <a href="ch10-02-traits.html#implementing-a-trait-on-a-type">â€œImplementing a Trait on a Typeâ€</a><!-- ignore -->, chÃºng ta Ä‘Ã£ Ä‘á» cáº­p Ä‘áº¿n quy táº¯c orphan (orphan rule) cho ráº±ng chÃºng ta chá»‰ Ä‘Æ°á»£c phÃ©p triá»ƒn khai má»™t trait trÃªn má»™t kiá»ƒu náº¿u trait hoáº·c kiá»ƒu Ä‘Ã³ lÃ  cá»¥c bá»™ trong crate cá»§a chÃºng ta. CÃ³ thá»ƒ vÆ°á»£t qua giá»›i háº¡n nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng <em>newtype pattern</em>, liÃªn quan Ä‘áº¿n viá»‡c táº¡o má»™t kiá»ƒu má»›i trong má»™t tuple struct. (ChÃºng ta Ä‘Ã£ há»c vá» tuple structs trong pháº§n <a href="ch05-01-defining-structs.html#using-tuple-structs-without-named-fields-to-create-different-types">â€œUsing Tuple Structs without Named Fields to Create Different Typesâ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 5.) Tuple struct sáº½ cÃ³ má»™t trÆ°á»ng vÃ  lÃ  má»™t wrapper má»ng quanh kiá»ƒu mÃ  chÃºng ta muá»‘n triá»ƒn khai trait. Khi Ä‘Ã³, kiá»ƒu wrapper lÃ  cá»¥c bá»™ trong crate cá»§a chÃºng ta, vÃ  chÃºng ta cÃ³ thá»ƒ triá»ƒn khai trait trÃªn wrapper. Thuáº­t ngá»¯ <em>newtype</em> xuáº¥t phÃ¡t tá»« ngÃ´n ngá»¯ láº­p trÃ¬nh Haskell. Viá»‡c sá»­ dá»¥ng pattern nÃ y khÃ´ng áº£nh hÆ°á»Ÿng tá»›i hiá»‡u nÄƒng khi cháº¡y, vÃ  kiá»ƒu wrapper sáº½ bá»‹ loáº¡i bá» táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch.</p>
<p>VÃ­ dá»¥, giáº£ sá»­ chÃºng ta muá»‘n triá»ƒn khai <code>Display</code> trÃªn <code>Vec&lt;T&gt;</code>, Ä‘iá»u mÃ  quy táº¯c orphan ngÄƒn cáº£n chÃºng ta lÃ m trá»±c tiáº¿p vÃ¬ trait <code>Display</code> vÃ  kiá»ƒu <code>Vec&lt;T&gt;</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a bÃªn ngoÃ i crate cá»§a chÃºng ta. ChÃºng ta cÃ³ thá»ƒ táº¡o má»™t struct <code>Wrapper</code> chá»©a má»™t thá»ƒ hiá»‡n cá»§a <code>Vec&lt;T&gt;</code>; sau Ä‘Ã³ triá»ƒn khai <code>Display</code> trÃªn <code>Wrapper</code> vÃ  sá»­ dá»¥ng giÃ¡ trá»‹ <code>Vec&lt;T&gt;</code>, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 19-23.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-23/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-23: Táº¡o má»™t kiá»ƒu <code>Wrapper</code> quanh <code>Vec&lt;String&gt;</code> Ä‘á»ƒ triá»ƒn khai <code>Display</code></span></p>
<p>Viá»‡c triá»ƒn khai <code>Display</code> sá»­ dá»¥ng <code>self.0</code> Ä‘á»ƒ truy cáº­p vÃ o <code>Vec&lt;T&gt;</code> bÃªn trong, vÃ¬ <code>Wrapper</code> lÃ  má»™t tuple struct vÃ  <code>Vec&lt;T&gt;</code> lÃ  pháº§n tá»­ á»Ÿ chá»‰ sá»‘ 0 trong tuple. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c chá»©c nÄƒng cá»§a kiá»ƒu <code>Display</code> trÃªn <code>Wrapper</code>.</p>
<p>NhÆ°á»£c Ä‘iá»ƒm cá»§a ká»¹ thuáº­t nÃ y lÃ  <code>Wrapper</code> lÃ  má»™t kiá»ƒu má»›i, vÃ¬ váº­y nÃ³ khÃ´ng cÃ³ cÃ¡c phÆ°Æ¡ng thá»©c cá»§a giÃ¡ trá»‹ mÃ  nÃ³ Ä‘ang chá»©a. ChÃºng ta sáº½ pháº£i triá»ƒn khai táº¥t cáº£ cÃ¡c phÆ°Æ¡ng thá»©c cá»§a <code>Vec&lt;T&gt;</code> trá»±c tiáº¿p trÃªn <code>Wrapper</code> sao cho cÃ¡c phÆ°Æ¡ng thá»©c á»§y quyá»n (delegate) tá»›i <code>self.0</code>, Ä‘iá»u nÃ y cho phÃ©p chÃºng ta sá»­ dá»¥ng <code>Wrapper</code> giá»‘ng há»‡t nhÆ° má»™t <code>Vec&lt;T&gt;</code>. Náº¿u muá»‘n kiá»ƒu má»›i cÃ³ má»i phÆ°Æ¡ng thá»©c mÃ  kiá»ƒu bÃªn trong cÃ³, viá»‡c triá»ƒn khai trait <code>Deref</code> (Ä‘Æ°á»£c tháº£o luáº­n trong ChÆ°Æ¡ng 15, pháº§n <a href="ch15-02-deref.html#treating-smart-pointers-like-regular-references-with-the-deref-trait">â€œTreating Smart Pointers Like Regular References with the <code>Deref</code> Traitâ€</a><!-- ignore -->) trÃªn <code>Wrapper</code> Ä‘á»ƒ tráº£ vá» kiá»ƒu bÃªn trong sáº½ lÃ  má»™t giáº£i phÃ¡p. Náº¿u khÃ´ng muá»‘n kiá»ƒu <code>Wrapper</code> cÃ³ táº¥t cáº£ cÃ¡c phÆ°Æ¡ng thá»©c cá»§a kiá»ƒu bÃªn trong â€” vÃ­ dá»¥, Ä‘á»ƒ háº¡n cháº¿ hÃ nh vi cá»§a kiá»ƒu <code>Wrapper</code> â€” chÃºng ta chá»‰ cáº§n triá»ƒn khai thá»§ cÃ´ng nhá»¯ng phÆ°Æ¡ng thá»©c mÃ  chÃºng ta muá»‘n.</p>
<p>Pattern newtype nÃ y cÅ©ng há»¯u Ã­ch ngay cáº£ khi khÃ´ng cÃ³ trait liÃªn quan. BÃ¢y giá» hÃ£y chuyá»ƒn sang vÃ  xem má»™t sá»‘ cÃ¡ch nÃ¢ng cao Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i há»‡ thá»‘ng kiá»ƒu cá»§a Rust.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="kiá»ƒu-nÃ¢ng-cao"><a class="header" href="#kiá»ƒu-nÃ¢ng-cao">Kiá»ƒu nÃ¢ng cao</a></h2>
<p>Há»‡ thá»‘ng kiá»ƒu cá»§a Rust cÃ³ má»™t sá»‘ tÃ­nh nÄƒng mÃ  chÃºng ta Ä‘Ã£ Ä‘á» cáº­p nhÆ°ng chÆ°a bÃ n chi tiáº¿t. ChÃºng ta sáº½ báº¯t Ä‘áº§u báº±ng viá»‡c tháº£o luáº­n vá» newtypes nÃ³i chung vÃ  xem táº¡i sao newtypes há»¯u Ã­ch nhÆ° cÃ¡c kiá»ƒu. Sau Ä‘Ã³, chÃºng ta sáº½ chuyá»ƒn sang type aliases, má»™t tÃ­nh nÄƒng tÆ°Æ¡ng tá»± newtypes nhÆ°ng cÃ³ ngá»¯ nghÄ©a hÆ¡i khÃ¡c. ChÃºng ta cÅ©ng sáº½ tháº£o luáº­n vá» kiá»ƒu <code>!</code> vÃ  cÃ¡c kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘á»™ng (dynamically sized types).</p>
<h3 id="sá»­-dá»¥ng-newtype-pattern-Ä‘á»ƒ-Ä‘áº£m-báº£o-an-toÃ n-kiá»ƒu-vÃ -trá»«u-tÆ°á»£ng-hÃ³a"><a class="header" href="#sá»­-dá»¥ng-newtype-pattern-Ä‘á»ƒ-Ä‘áº£m-báº£o-an-toÃ n-kiá»ƒu-vÃ -trá»«u-tÆ°á»£ng-hÃ³a">Sá»­ dá»¥ng Newtype Pattern Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n kiá»ƒu vÃ  trá»«u tÆ°á»£ng hÃ³a</a></h3>
<blockquote>
<p>LÆ°u Ã½: Pháº§n nÃ y giáº£ Ä‘á»‹nh báº¡n Ä‘Ã£ Ä‘á»c pháº§n trÆ°á»›c <a href="ch19-03-advanced-traits.html#using-the-newtype-pattern-to-implement-external-traits-on-external-types">â€œUsing the Newtype Pattern to Implement External Traits on External Types.â€</a><!-- ignore --></p>
</blockquote>
<p>Newtype pattern cÅ©ng há»¯u Ã­ch cho cÃ¡c nhiá»‡m vá»¥ vÆ°á»£t ra ngoÃ i nhá»¯ng gÃ¬ chÃºng ta Ä‘Ã£ tháº£o luáº­n, bao gá»“m viá»‡c Ä‘áº£m báº£o táº¡i thá»i gian biÃªn dá»‹ch ráº±ng cÃ¡c giÃ¡ trá»‹ khÃ´ng bá»‹ nháº§m láº«n vÃ  chá»‰ Ä‘á»‹nh Ä‘Æ¡n vá»‹ cá»§a má»™t giÃ¡ trá»‹. Báº¡n Ä‘Ã£ tháº¥y má»™t vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng newtypes Ä‘á»ƒ chá»‰ Ä‘á»‹nh Ä‘Æ¡n vá»‹ trong Listing 19-15: nhá»› ráº±ng cÃ¡c struct <code>Millimeters</code> vÃ  <code>Meters</code> bá»c cÃ¡c giÃ¡ trá»‹ <code>u32</code> trong má»™t newtype. Náº¿u chÃºng ta viáº¿t má»™t hÃ m vá»›i tham sá»‘ kiá»ƒu <code>Millimeters</code>, chÃºng ta sáº½ khÃ´ng thá»ƒ biÃªn dá»‹ch má»™t chÆ°Æ¡ng trÃ¬nh mÃ  vÃ´ tÃ¬nh cá»‘ gá»i hÃ m Ä‘Ã³ vá»›i giÃ¡ trá»‹ kiá»ƒu <code>Meters</code> hoáº·c má»™t <code>u32</code> thÃ´ng thÆ°á»ng.</p>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng newtype pattern Ä‘á»ƒ trá»«u tÆ°á»£ng hÃ³a má»™t sá»‘ chi tiáº¿t triá»ƒn khai cá»§a má»™t kiá»ƒu: kiá»ƒu má»›i cÃ³ thá»ƒ cung cáº¥p má»™t API cÃ´ng khai khÃ¡c vá»›i API cá»§a kiá»ƒu bÃªn trong riÃªng tÆ°.</p>
<p>Newtypes cÅ©ng cÃ³ thá»ƒ che giáº¥u triá»ƒn khai bÃªn trong. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ cung cáº¥p kiá»ƒu <code>People</code> Ä‘á»ƒ bá»c má»™t <code>HashMap&lt;i32, String&gt;</code> lÆ°u trá»¯ ID cá»§a má»™t ngÆ°á»i liÃªn káº¿t vá»›i tÃªn cá»§a há». MÃ£ sá»­ dá»¥ng <code>People</code> chá»‰ tÆ°Æ¡ng tÃ¡c vá»›i API cÃ´ng khai mÃ  chÃºng ta cung cáº¥p, cháº³ng háº¡n nhÆ° má»™t phÆ°Æ¡ng thá»©c thÃªm tÃªn vÃ o táº­p há»£p <code>People</code>; mÃ£ Ä‘Ã³ khÃ´ng cáº§n biáº¿t ráº±ng chÃºng ta gÃ¡n má»™t ID <code>i32</code> cho tÃªn bÃªn trong. Newtype pattern lÃ  má»™t cÃ¡ch nháº¹ Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i (encapsulation) nháº±m che giáº¥u chi tiáº¿t triá»ƒn khai, nhÆ° chÃºng ta Ä‘Ã£ tháº£o luáº­n trong pháº§n <a href="ch17-01-what-is-oo.html#encapsulation-that-hides-implementation-details">â€œEncapsulation that Hides Implementation Detailsâ€</a><!-- ignore --> cá»§a ChÆ°Æ¡ng 17.</p>
<h3 id="táº¡o-bÃ­-danh-kiá»ƒu-vá»›i-type-aliases"><a class="header" href="#táº¡o-bÃ­-danh-kiá»ƒu-vá»›i-type-aliases">Táº¡o bÃ­ danh kiá»ƒu vá»›i Type Aliases</a></h3>
<p>Rust cung cáº¥p kháº£ nÄƒng khai bÃ¡o má»™t <em>type alias</em> Ä‘á»ƒ Ä‘áº·t má»™t tÃªn khÃ¡c cho má»™t kiá»ƒu hiá»‡n cÃ³. ChÃºng ta sá»­ dá»¥ng tá»« khÃ³a <code>type</code> cho viá»‡c nÃ y. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ táº¡o bÃ­ danh <code>Kilometers</code> cho <code>i32</code> nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-04-kilometers-alias/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>BÃ¢y giá», bÃ­ danh <code>Kilometers</code> lÃ  má»™t <em>tÃªn Ä‘á»“ng nghÄ©a</em> vá»›i <code>i32</code>; khÃ¡c vá»›i cÃ¡c kiá»ƒu <code>Millimeters</code> vÃ  <code>Meters</code> mÃ  chÃºng ta Ä‘Ã£ táº¡o trong Listing 19-15, <code>Kilometers</code> khÃ´ng pháº£i lÃ  má»™t kiá»ƒu má»›i, riÃªng biá»‡t. CÃ¡c giÃ¡ trá»‹ cÃ³ kiá»ƒu <code>Kilometers</code> sáº½ Ä‘Æ°á»£c xá»­ lÃ½ giá»‘ng nhÆ° cÃ¡c giÃ¡ trá»‹ kiá»ƒu <code>i32</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-04-kilometers-alias/src/main.rs:there}}
<span class="boring">}</span></code></pre></pre>
<p>VÃ¬ <code>Kilometers</code> vÃ  <code>i32</code> lÃ  cÃ¹ng má»™t kiá»ƒu, chÃºng ta cÃ³ thá»ƒ cá»™ng cÃ¡c giÃ¡ trá»‹ cá»§a cáº£ hai kiá»ƒu vÃ  cÃ³ thá»ƒ truyá»n cÃ¡c giÃ¡ trá»‹ <code>Kilometers</code> vÃ o cÃ¡c hÃ m nháº­n tham sá»‘ kiá»ƒu <code>i32</code>. Tuy nhiÃªn, sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p nÃ y, chÃºng ta khÃ´ng cÃ³ lá»£i Ã­ch kiá»ƒm tra kiá»ƒu (type checking) nhÆ° khi sá»­ dá»¥ng newtype pattern Ä‘Ã£ tháº£o luáº­n trÆ°á»›c Ä‘Ã³. NÃ³i cÃ¡ch khÃ¡c, náº¿u chÃºng ta nháº§m láº«n giá»¯a cÃ¡c giÃ¡ trá»‹ <code>Kilometers</code> vÃ  <code>i32</code> á»Ÿ Ä‘Ã¢u Ä‘Ã³, trÃ¬nh biÃªn dá»‹ch sáº½ khÃ´ng bÃ¡o lá»—i.</p>
<p>TrÆ°á»ng há»£p sá»­ dá»¥ng chÃ­nh cá»§a cÃ¡c bÃ­ danh kiá»ƒu lÃ  giáº£m sá»± láº·p láº¡i. VÃ­ dá»¥, chÃºng ta cÃ³ thá»ƒ cÃ³ má»™t kiá»ƒu dÃ i nhÆ° sau:</p>
<pre><code class="language-rust ignore">Box&lt;dyn Fn() + Send + 'static&gt;</code></pre>
<p>Viá»‡c viáº¿t kiá»ƒu dÃ i nÃ y trong cÃ¡c chá»¯ kÃ½ hÃ m vÃ  chÃº thÃ­ch kiá»ƒu kháº¯p nÆ¡i trong mÃ£ cÃ³ thá»ƒ gÃ¢y má»‡t má»i vÃ  dá»… sai sÃ³t. HÃ£y tÆ°á»Ÿng tÆ°á»£ng má»™t dá»± Ã¡n Ä‘áº§y cÃ¡c Ä‘oáº¡n mÃ£ nhÆ° trong Listing 19-24.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-24/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-24: Sá»­ dá»¥ng má»™t kiá»ƒu dÃ i á»Ÿ nhiá»u nÆ¡i</span></p>
<p>Má»™t bÃ­ danh kiá»ƒu giÃºp mÃ£ nÃ y dá»… quáº£n lÃ½ hÆ¡n báº±ng cÃ¡ch giáº£m sá»± láº·p láº¡i. Trong Listing 19-25, chÃºng ta Ä‘Ã£ táº¡o má»™t bÃ­ danh tÃªn lÃ  <code>Thunk</code> cho kiá»ƒu dÃ i dÃ²ng vÃ  cÃ³ thá»ƒ thay tháº¿ táº¥t cáº£ cÃ¡c láº§n sá»­ dá»¥ng kiá»ƒu nÃ y báº±ng bÃ­ danh ngáº¯n hÆ¡n <code>Thunk</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-25/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-25: Giá»›i thiá»‡u bÃ­ danh kiá»ƒu <code>Thunk</code> Ä‘á»ƒ giáº£m sá»± láº·p láº¡i</span></p>
<p>MÃ£ nÃ y dá»… Ä‘á»c vÃ  viáº¿t hÆ¡n ráº¥t nhiá»u! Viá»‡c chá»n má»™t tÃªn cÃ³ Ã½ nghÄ©a cho má»™t bÃ­ danh kiá»ƒu cÅ©ng giÃºp truyá»n Ä‘áº¡t Ã½ Ä‘á»‹nh cá»§a báº¡n (<em>thunk</em> lÃ  má»™t tá»« chá»‰ Ä‘oáº¡n mÃ£ sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ sau, nÃªn nÃ³ lÃ  tÃªn phÃ¹ há»£p cho má»™t closure Ä‘Æ°á»£c lÆ°u trá»¯).</p>
<p>CÃ¡c bÃ­ danh kiá»ƒu cÅ©ng thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i kiá»ƒu <code>Result&lt;T, E&gt;</code> Ä‘á»ƒ giáº£m sá»± láº·p láº¡i. HÃ£y xem xÃ©t module <code>std::io</code> trong thÆ° viá»‡n chuáº©n. CÃ¡c thao tÃ¡c I/O thÆ°á»ng tráº£ vá» <code>Result&lt;T, E&gt;</code> Ä‘á»ƒ xá»­ lÃ½ cÃ¡c tÃ¬nh huá»‘ng khi thao tÃ¡c khÃ´ng thÃ nh cÃ´ng. ThÆ° viá»‡n nÃ y cÃ³ struct <code>std::io::Error</code> Ä‘áº¡i diá»‡n cho táº¥t cáº£ cÃ¡c lá»—i I/O cÃ³ thá»ƒ xáº£y ra. Nhiá»u hÃ m trong <code>std::io</code> sáº½ tráº£ vá» <code>Result&lt;T, E&gt;</code> vá»›i <code>E</code> lÃ  <code>std::io::Error</code>, vÃ­ dá»¥ nhÆ° cÃ¡c hÃ m trong trait <code>Write</code>:</p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-05-write-trait/src/lib.rs}}</code></pre>
<p>Kiá»ƒu <code>Result&lt;..., Error&gt;</code> Ä‘Æ°á»£c láº·p láº¡i ráº¥t nhiá»u. Do Ä‘Ã³, <code>std::io</code> cÃ³ khai bÃ¡o bÃ­ danh kiá»ƒu nhÆ° sau:</p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-06-result-alias/src/lib.rs:here}}</code></pre>
<p>VÃ¬ khai bÃ¡o nÃ y náº±m trong module <code>std::io</code>, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng bÃ­ danh kiá»ƒu Ä‘áº§y Ä‘á»§ <code>std::io::Result&lt;T&gt;</code>; nghÄ©a lÃ  má»™t <code>Result&lt;T, E&gt;</code> vá»›i <code>E</code> Ä‘Æ°á»£c Ä‘iá»n lÃ  <code>std::io::Error</code>. Chá»¯ kÃ½ cÃ¡c hÃ m trong trait <code>Write</code> sáº½ trÃ´ng nhÆ° sau:</p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-06-result-alias/src/lib.rs:there}}</code></pre>
<p>BÃ­ danh kiá»ƒu há»¯u Ã­ch theo hai cÃ¡ch: nÃ³ lÃ m cho mÃ£ dá»… viáº¿t hÆ¡n <em>vÃ </em> cung cáº¥p má»™t giao diá»‡n nháº¥t quÃ¡n trÃªn toÃ n bá»™ <code>std::io</code>. VÃ¬ nÃ³ chá»‰ lÃ  má»™t bÃ­ danh, nÃ³ váº«n lÃ  <code>Result&lt;T, E&gt;</code>, nghÄ©a lÃ  chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng báº¥t ká»³ phÆ°Æ¡ng thá»©c nÃ o hoáº¡t Ä‘á»™ng trÃªn <code>Result&lt;T, E&gt;</code> vá»›i nÃ³, cÅ©ng nhÆ° cÃ¡c cÃº phÃ¡p Ä‘áº·c biá»‡t nhÆ° toÃ¡n tá»­ <code>?</code>.</p>
<h3 id="kiá»ƒu-never-khÃ´ng-bao-giá»-tráº£-vá»"><a class="header" href="#kiá»ƒu-never-khÃ´ng-bao-giá»-tráº£-vá»">Kiá»ƒu Never khÃ´ng bao giá» tráº£ vá»</a></h3>
<p>Rust cÃ³ má»™t kiá»ƒu Ä‘áº·c biá»‡t tÃªn lÃ  <code>!</code>, trong lÃ½ thuyáº¿t kiá»ƒu Ä‘Æ°á»£c gá»i lÃ  <em>kiá»ƒu rá»—ng</em> vÃ¬ nÃ³ khÃ´ng cÃ³ giÃ¡ trá»‹ nÃ o. ChÃºng ta thÃ­ch gá»i nÃ³ lÃ  <em>never type</em> vÃ¬ nÃ³ Ä‘á»©ng á»Ÿ vá»‹ trÃ­ kiá»ƒu tráº£ vá» khi má»™t hÃ m sáº½ khÃ´ng bao giá» tráº£ vá». ÄÃ¢y lÃ  má»™t vÃ­ dá»¥:</p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-07-never-type/src/lib.rs:here}}</code></pre>
<p>MÃ£ nÃ y Ä‘Æ°á»£c Ä‘á»c lÃ  â€œhÃ m <code>bar</code> khÃ´ng bao giá» tráº£ vá».â€ CÃ¡c hÃ m tráº£ vá» kiá»ƒu never Ä‘Æ°á»£c gá»i lÃ  <em>diverging functions</em>. ChÃºng ta khÃ´ng thá»ƒ táº¡o giÃ¡ trá»‹ cá»§a kiá»ƒu <code>!</code>, nÃªn <code>bar</code> sáº½ khÃ´ng bao giá» cÃ³ thá»ƒ tráº£ vá».</p>
<p>NhÆ°ng má»™t kiá»ƒu mÃ  báº¡n khÃ´ng bao giá» cÃ³ thá»ƒ táº¡o giÃ¡ trá»‹ cá»§a nÃ³ cÃ³ tÃ¡c dá»¥ng gÃ¬? HÃ£y nhá»› láº¡i mÃ£ tá»« Listing 2-5, má»™t pháº§n cá»§a trÃ² chÆ¡i Ä‘oÃ¡n sá»‘; chÃºng tÃ´i Ä‘Ã£ tÃ¡i hiá»‡n má»™t pháº§n á»Ÿ Ä‘Ã¢y trong Listing 19-26.</p>
<pre><code class="language-rust ignore"><span class="boring">use std::cmp::Ordering;
</span><span class="boring">use std::io;
</span><span class="boring">
</span><span class="boring">use rand::Rng;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    println!("Guess the number!");
</span><span class="boring">
</span><span class="boring">    let secret_number = rand::thread_rng().gen_range(1..=100);
</span><span class="boring">
</span><span class="boring">    println!("The secret number is: {secret_number}");
</span><span class="boring">
</span><span class="boring">    loop {
</span><span class="boring">        println!("Please input your guess.");
</span><span class="boring">
</span><span class="boring">        let mut guess = String::new();
</span><span class="boring">
</span><span class="boring">        // --snip--
</span><span class="boring">
</span><span class="boring">        io::stdin()
</span><span class="boring">            .read_line(&amp;mut guess)
</span><span class="boring">            .expect("Failed to read line");
</span><span class="boring">
</span>        let guess: u32 = match guess.trim().parse() {
            Ok(num) =&gt; num,
            Err(_) =&gt; continue,
        };
<span class="boring">
</span><span class="boring">        println!("You guessed: {guess}");
</span><span class="boring">
</span><span class="boring">        // --snip--
</span><span class="boring">
</span><span class="boring">        match guess.cmp(&amp;secret_number) {
</span><span class="boring">            Ordering::Less =&gt; println!("Too small!"),
</span><span class="boring">            Ordering::Greater =&gt; println!("Too big!"),
</span><span class="boring">            Ordering::Equal =&gt; {
</span><span class="boring">                println!("You win!");
</span><span class="boring">                break;
</span><span class="boring">            }
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p><span class="caption">Listing 19-26: Má»™t <code>match</code> vá»›i nhÃ¡nh káº¿t thÃºc báº±ng <code>continue</code></span></p>
<p>LÃºc Ä‘Ã³, chÃºng ta Ä‘Ã£ bá» qua má»™t sá»‘ chi tiáº¿t trong mÃ£ nÃ y. Trong ChÆ°Æ¡ng 6, trong pháº§n <a href="ch06-02-match.html#the-match-control-flow-operator">â€œToÃ¡n tá»­ Ä‘iá»u khiá»ƒn luá»“ng <code>match</code>â€</a><!-- ignore -->, chÃºng ta Ä‘Ã£ tháº£o luáº­n ráº±ng táº¥t cáº£ cÃ¡c nhÃ¡nh cá»§a <code>match</code> pháº£i tráº£ vá» cÃ¹ng má»™t kiá»ƒu. VÃ¬ váº­y, vÃ­ dá»¥, mÃ£ sau Ä‘Ã¢y sáº½ khÃ´ng hoáº¡t Ä‘á»™ng:</p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-08-match-arms-different-types/src/main.rs:here}}</code></pre>
<p>Kiá»ƒu cá»§a <code>guess</code> trong mÃ£ nÃ y sáº½ pháº£i vá»«a lÃ  má»™t sá»‘ nguyÃªn <em>vá»«a</em> lÃ  má»™t chuá»—i, vÃ  Rust yÃªu cáº§u <code>guess</code> chá»‰ cÃ³ má»™t kiá»ƒu duy nháº¥t. Váº­y <code>continue</code> tráº£ vá» gÃ¬? LÃ m sao chÃºng ta Ä‘Æ°á»£c phÃ©p tráº£ vá» má»™t <code>u32</code> tá»« má»™t nhÃ¡nh vÃ  cÃ³ má»™t nhÃ¡nh khÃ¡c káº¿t thÃºc báº±ng <code>continue</code> trong Listing 19-26?</p>
<p>NhÆ° báº¡n cÃ³ thá»ƒ Ä‘oÃ¡n, <code>continue</code> cÃ³ giÃ¡ trá»‹ kiá»ƒu <code>!</code>. NghÄ©a lÃ  khi Rust tÃ­nh toÃ¡n kiá»ƒu cá»§a <code>guess</code>, nÃ³ nhÃ¬n vÃ o cáº£ hai nhÃ¡nh cá»§a <code>match</code>, nhÃ¡nh trÆ°á»›c cÃ³ giÃ¡ trá»‹ lÃ  <code>u32</code> vÃ  nhÃ¡nh sau cÃ³ giÃ¡ trá»‹ lÃ  <code>!</code>. VÃ¬ <code>!</code> khÃ´ng bao giá» cÃ³ giÃ¡ trá»‹, Rust quyáº¿t Ä‘á»‹nh ráº±ng kiá»ƒu cá»§a <code>guess</code> lÃ  <code>u32</code>.</p>
<p>CÃ¡ch chÃ­nh thá»©c Ä‘á»ƒ mÃ´ táº£ hÃ nh vi nÃ y lÃ  cÃ¡c biá»ƒu thá»©c cÃ³ kiá»ƒu <code>!</code> cÃ³ thá»ƒ Ä‘Æ°á»£c Ã©p sang báº¥t ká»³ kiá»ƒu nÃ o khÃ¡c. ChÃºng ta Ä‘Æ°á»£c phÃ©p káº¿t thÃºc nhÃ¡nh <code>match</code> nÃ y báº±ng <code>continue</code> vÃ¬ <code>continue</code> khÃ´ng tráº£ vá» giÃ¡ trá»‹; thay vÃ o Ä‘Ã³, nÃ³ Ä‘Æ°a luá»“ng Ä‘iá»u khiá»ƒn quay trá»Ÿ láº¡i Ä‘áº§u vÃ²ng láº·p, nÃªn trong trÆ°á»ng há»£p <code>Err</code>, chÃºng ta khÃ´ng bao giá» gÃ¡n giÃ¡ trá»‹ cho <code>guess</code>.</p>
<p>Kiá»ƒu never cÅ©ng há»¯u Ã­ch vá»›i macro <code>panic!</code>. HÃ£y nhá»› láº¡i hÃ m <code>unwrap</code> mÃ  chÃºng ta gá»i trÃªn cÃ¡c giÃ¡ trá»‹ <code>Option&lt;T&gt;</code> Ä‘á»ƒ táº¡o ra má»™t giÃ¡ trá»‹ hoáº·c gÃ¢y panic vá»›i Ä‘á»‹nh nghÄ©a sau:</p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-09-unwrap-definition/src/lib.rs:here}}</code></pre>
<p>Trong mÃ£ nÃ y, Ä‘iá»u tÆ°Æ¡ng tá»± xáº£y ra nhÆ° trong <code>match</code> á»Ÿ Listing 19-26: Rust tháº¥y ráº±ng <code>val</code> cÃ³ kiá»ƒu <code>T</code> vÃ  <code>panic!</code> cÃ³ kiá»ƒu <code>!</code>, nÃªn káº¿t quáº£ cá»§a toÃ n bá»™ biá»ƒu thá»©c <code>match</code> lÃ  <code>T</code>. MÃ£ nÃ y hoáº¡t Ä‘á»™ng vÃ¬ <code>panic!</code> khÃ´ng táº¡o ra giÃ¡ trá»‹; nÃ³ káº¿t thÃºc chÆ°Æ¡ng trÃ¬nh. Trong trÆ°á»ng há»£p <code>None</code>, chÃºng ta sáº½ khÃ´ng tráº£ vá» giÃ¡ trá»‹ tá»« <code>unwrap</code>, nÃªn mÃ£ nÃ y lÃ  há»£p lá»‡.</p>
<p>Má»™t biá»ƒu thá»©c cuá»‘i cÃ¹ng cÃ³ kiá»ƒu <code>!</code> lÃ  <code>loop</code>:</p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-10-loop-returns-never/src/main.rs:here}}</code></pre>
<p>á» Ä‘Ã¢y, vÃ²ng láº·p khÃ´ng bao giá» káº¿t thÃºc, nÃªn <code>!</code> lÃ  giÃ¡ trá»‹ cá»§a biá»ƒu thá»©c. Tuy nhiÃªn, Ä‘iá»u nÃ y sáº½ khÃ´ng Ä‘Ãºng náº¿u chÃºng ta bao gá»“m má»™t <code>break</code>, vÃ¬ vÃ²ng láº·p sáº½ káº¿t thÃºc khi gáº·p <code>break</code>.</p>
<h3 id="kiá»ƒu-cÃ³-kÃ­ch-thÆ°á»›c-Äá»™ng-vÃ -trait-sized"><a class="header" href="#kiá»ƒu-cÃ³-kÃ­ch-thÆ°á»›c-Äá»™ng-vÃ -trait-sized">Kiá»ƒu cÃ³ KÃ­ch thÆ°á»›c Äá»™ng vÃ  Trait <code>Sized</code></a></h3>
<p>Rust cáº§n biáº¿t má»™t sá»‘ chi tiáº¿t vá» cÃ¡c kiá»ƒu cá»§a nÃ³, cháº³ng háº¡n nhÆ° bao nhiÃªu bá»™ nhá»› cáº§n cáº¥p phÃ¡t cho má»™t giÃ¡ trá»‹ cá»§a kiá»ƒu cá»¥ thá»ƒ. Äiá»u nÃ y Ä‘á»ƒ láº¡i má»™t khÃ­a cáº¡nh hÆ¡i khÃ³ hiá»ƒu lÃºc Ä‘áº§u trong há»‡ thá»‘ng kiá»ƒu cá»§a Rust: khÃ¡i niá»‡m <em>cÃ¡c kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘á»™ng</em>. ÄÃ´i khi Ä‘Æ°á»£c gá»i lÃ  <em>DSTs</em> hoáº·c <em>unsized types</em>, cÃ¡c kiá»ƒu nÃ y cho phÃ©p chÃºng ta viáº¿t mÃ£ vá»›i cÃ¡c giÃ¡ trá»‹ mÃ  kÃ­ch thÆ°á»›c chá»‰ biáº¿t Ä‘Æ°á»£c khi cháº¡y chÆ°Æ¡ng trÃ¬nh.</p>
<p>HÃ£y Ä‘i sÃ¢u vÃ o chi tiáº¿t vá» má»™t kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘á»™ng gá»i lÃ  <code>str</code>, mÃ  chÃºng ta Ä‘Ã£ sá»­ dá»¥ng trong suá»‘t cuá»‘n sÃ¡ch. ÄÃºng váº­y, khÃ´ng pháº£i <code>&amp;str</code>, mÃ  chÃ­nh <code>str</code> lÃ  má»™t DST. ChÃºng ta khÃ´ng thá»ƒ biáº¿t Ä‘á»™ dÃ i cá»§a chuá»—i cho Ä‘áº¿n khi cháº¡y chÆ°Æ¡ng trÃ¬nh, nghÄ©a lÃ  chÃºng ta khÃ´ng thá»ƒ táº¡o biáº¿n cÃ³ kiá»ƒu <code>str</code>, cÅ©ng khÃ´ng thá»ƒ nháº­n Ä‘á»‘i sá»‘ kiá»ƒu <code>str</code>. Xem xÃ©t mÃ£ sau, mÃ£ nÃ y khÃ´ng hoáº¡t Ä‘á»™ng:</p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-11-cant-create-str/src/main.rs:here}}</code></pre>
<p>Rust cáº§n biáº¿t lÆ°á»£ng bá»™ nhá»› cáº§n cáº¥p phÃ¡t cho báº¥t ká»³ giÃ¡ trá»‹ nÃ o cá»§a má»™t kiá»ƒu cá»¥ thá»ƒ, vÃ  táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ cá»§a má»™t kiá»ƒu pháº£i sá»­ dá»¥ng cÃ¹ng má»™t lÆ°á»£ng bá»™ nhá»›. Náº¿u Rust cho phÃ©p chÃºng ta viáº¿t Ä‘oáº¡n mÃ£ nÃ y, hai giÃ¡ trá»‹ <code>str</code> nÃ y sáº½ cáº§n chiáº¿m cÃ¹ng má»™t lÆ°á»£ng khÃ´ng gian. NhÆ°ng chÃºng cÃ³ Ä‘á»™ dÃ i khÃ¡c nhau: <code>s1</code> cáº§n 12 byte bá»™ nhá»› vÃ  <code>s2</code> cáº§n 15 byte. ÄÃ¢y lÃ  lÃ½ do táº¡i sao khÃ´ng thá»ƒ táº¡o má»™t biáº¿n chá»©a kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘á»™ng.</p>
<p>Váº­y chÃºng ta lÃ m gÃ¬? Trong trÆ°á»ng há»£p nÃ y, báº¡n Ä‘Ã£ biáº¿t cÃ¢u tráº£ lá»i: chÃºng ta Ä‘áº·t kiá»ƒu cá»§a <code>s1</code> vÃ  <code>s2</code> lÃ  <code>&amp;str</code> thay vÃ¬ <code>str</code>. Nhá»› láº¡i tá»« pháº§n <a href="ch04-03-slices.html#string-slices">â€œString Slicesâ€</a><!-- ignore --> trong ChÆ°Æ¡ng 4 ráº±ng cáº¥u trÃºc dá»¯ liá»‡u slice chá»‰ lÆ°u vá»‹ trÃ­ báº¯t Ä‘áº§u vÃ  Ä‘á»™ dÃ i cá»§a slice. VÃ¬ váº­y, máº·c dÃ¹ má»™t <code>&amp;T</code> lÃ  má»™t giÃ¡ trá»‹ duy nháº¥t lÆ°u Ä‘á»‹a chá»‰ bá»™ nhá»› nÆ¡i <code>T</code> náº±m, má»™t <code>&amp;str</code> láº¡i lÃ  <em>hai</em> giÃ¡ trá»‹: Ä‘á»‹a chá»‰ cá»§a <code>str</code> vÃ  Ä‘á»™ dÃ i cá»§a nÃ³. NhÆ° váº­y, chÃºng ta cÃ³ thá»ƒ biáº¿t kÃ­ch thÆ°á»›c cá»§a má»™t giÃ¡ trá»‹ <code>&amp;str</code> táº¡i thá»i gian biÃªn dá»‹ch: nÃ³ gáº¥p Ä‘Ã´i kÃ­ch thÆ°á»›c cá»§a má»™t <code>usize</code>. Tá»©c lÃ , chÃºng ta luÃ´n biáº¿t kÃ­ch thÆ°á»›c cá»§a <code>&amp;str</code>, báº¥t ká»ƒ chuá»—i mÃ  nÃ³ tham chiáº¿u dÃ i bao nhiÃªu. NÃ³i chung, Ä‘Ã¢y lÃ  cÃ¡ch cÃ¡c kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘á»™ng Ä‘Æ°á»£c sá»­ dá»¥ng trong Rust: chÃºng cÃ³ má»™t pháº§n metadata bá»• sung lÆ°u kÃ­ch thÆ°á»›c cá»§a thÃ´ng tin Ä‘á»™ng. Quy táº¯c vÃ ng cá»§a cÃ¡c kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘á»™ng lÃ  chÃºng ta pháº£i luÃ´n Ä‘áº·t cÃ¡c giÃ¡ trá»‹ cá»§a kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘á»™ng sau má»™t con trá» nÃ o Ä‘Ã³.</p>
<p>ChÃºng ta cÃ³ thá»ƒ káº¿t há»£p <code>str</code> vá»›i táº¥t cáº£ cÃ¡c loáº¡i con trá»: vÃ­ dá»¥, <code>Box&lt;str&gt;</code> hoáº·c <code>Rc&lt;str&gt;</code>. Thá»±c táº¿, báº¡n Ä‘Ã£ tháº¥y Ä‘iá»u nÃ y trÆ°á»›c Ä‘Ã¢y nhÆ°ng vá»›i má»™t kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘á»™ng khÃ¡c: traits. Má»—i trait lÃ  má»™t kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘á»™ng mÃ  chÃºng ta cÃ³ thá»ƒ tham chiáº¿u báº±ng cÃ¡ch sá»­ dá»¥ng tÃªn cá»§a trait. Trong ChÆ°Æ¡ng 17, pháº§n <a href="ch17-02-trait-objects.html#using-trait-objects-that-allow-for-values-of-different-types">â€œUsing Trait Objects That Allow for Values of Different Typesâ€</a><!-- ignore -->, chÃºng ta Ä‘Ã£ Ä‘á» cáº­p ráº±ng Ä‘á»ƒ sá»­ dá»¥ng trait nhÆ° trait objects, chÃºng ta pháº£i Ä‘áº·t chÃºng sau má»™t con trá», cháº³ng háº¡n nhÆ° <code>&amp;dyn Trait</code> hoáº·c <code>Box&lt;dyn Trait&gt;</code> (<code>Rc&lt;dyn Trait&gt;</code> cÅ©ng Ä‘Æ°á»£c).</p>
<p>Äá»ƒ lÃ m viá»‡c vá»›i DSTs, Rust cung cáº¥p trait <code>Sized</code> Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xem kÃ­ch thÆ°á»›c cá»§a má»™t kiá»ƒu cÃ³ Ä‘Æ°á»£c biáº¿t táº¡i thá»i gian biÃªn dá»‹ch hay khÃ´ng. Trait nÃ y Ä‘Æ°á»£c triá»ƒn khai tá»± Ä‘á»™ng cho má»i thá»© cÃ³ kÃ­ch thÆ°á»›c Ä‘Æ°á»£c biáº¿t táº¡i thá»i gian biÃªn dá»‹ch. NgoÃ i ra, Rust ngáº§m thÃªm má»™t rÃ ng buá»™c <code>Sized</code> vÃ o má»i hÃ m generic. Tá»©c lÃ , má»™t Ä‘á»‹nh nghÄ©a hÃ m generic nhÆ° sau:</p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-12-generic-fn-definition/src/lib.rs}}</code></pre>
<p>thá»±c ra Ä‘Æ°á»£c coi nhÆ° chÃºng ta Ä‘Ã£ viáº¿t nhÆ° sau:</p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-13-generic-implicit-sized-bound/src/lib.rs}}</code></pre>
<p>Máº·c Ä‘á»‹nh, cÃ¡c hÃ m generic chá»‰ hoáº¡t Ä‘á»™ng trÃªn cÃ¡c kiá»ƒu cÃ³ kÃ­ch thÆ°á»›c Ä‘Æ°á»£c biáº¿t táº¡i thá»i gian biÃªn dá»‹ch. Tuy nhiÃªn, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃº phÃ¡p Ä‘áº·c biá»‡t sau Ä‘á»ƒ ná»›i lá»ng háº¡n cháº¿ nÃ y:</p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-14-generic-maybe-sized/src/lib.rs}}</code></pre>
<p>Má»™t rÃ ng buá»™c trait vá»›i <code>?Sized</code> cÃ³ nghÄ©a lÃ  â€œ<code>T</code> cÃ³ thá»ƒ cÃ³ hoáº·c khÃ´ng cÃ³ kÃ­ch thÆ°á»›c xÃ¡c Ä‘á»‹nhâ€ vÃ  kÃ½ hiá»‡u nÃ y ghi Ä‘Ã¨ máº·c Ä‘á»‹nh ráº±ng cÃ¡c kiá»ƒu generic pháº£i cÃ³ kÃ­ch thÆ°á»›c Ä‘Æ°á»£c biáº¿t táº¡i thá»i gian biÃªn dá»‹ch. CÃº phÃ¡p <code>?Trait</code> vá»›i Ã½ nghÄ©a nÃ y chá»‰ Ã¡p dá»¥ng cho <code>Sized</code>, khÃ´ng Ã¡p dá»¥ng cho báº¥t ká»³ trait nÃ o khÃ¡c.</p>
<p>CÅ©ng lÆ°u Ã½ ráº±ng chÃºng ta Ä‘Ã£ chuyá»ƒn kiá»ƒu cá»§a tham sá»‘ <code>t</code> tá»« <code>T</code> sang <code>&amp;T</code>. VÃ¬ kiá»ƒu nÃ y cÃ³ thá»ƒ khÃ´ng pháº£i lÃ  <code>Sized</code>, chÃºng ta cáº§n sá»­ dá»¥ng nÃ³ thÃ´ng qua má»™t loáº¡i con trá» nÃ o Ä‘Ã³. Trong trÆ°á»ng há»£p nÃ y, chÃºng ta Ä‘Ã£ chá»n sá»­ dá»¥ng má»™t reference.</p>
<p>Tiáº¿p theo, chÃºng ta sáº½ nÃ³i vá» cÃ¡c hÃ m vÃ  closures!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="hÃ m-vÃ -closures-nÃ¢ng-cao"><a class="header" href="#hÃ m-vÃ -closures-nÃ¢ng-cao">HÃ m vÃ  Closures NÃ¢ng Cao</a></h2>
<p>Pháº§n nÃ y khÃ¡m phÃ¡ má»™t sá»‘ tÃ­nh nÄƒng nÃ¢ng cao liÃªn quan Ä‘áº¿n hÃ m vÃ  closures, bao gá»“m con trá» hÃ m vÃ  viá»‡c tráº£ vá» closures.</p>
<h3 id="con-trá»-hÃ m"><a class="header" href="#con-trá»-hÃ m">Con Trá» HÃ m</a></h3>
<p>ChÃºng ta Ä‘Ã£ nÃ³i vá» cÃ¡ch truyá»n closures vÃ o hÃ m; báº¡n cÅ©ng cÃ³ thá»ƒ truyá»n cÃ¡c hÃ m thÃ´ng thÆ°á»ng vÃ o hÃ m! Ká»¹ thuáº­t nÃ y há»¯u Ã­ch khi báº¡n muá»‘n truyá»n má»™t hÃ m Ä‘Ã£ Ä‘á»‹nh nghÄ©a thay vÃ¬ Ä‘á»‹nh nghÄ©a má»™t closure má»›i. CÃ¡c hÃ m tá»± Ä‘á»™ng chuyá»ƒn sang kiá»ƒu <code>fn</code> (vá»›i chá»¯ f thÆ°á»ng), khÃ´ng nháº§m láº«n vá»›i trait closure <code>Fn</code>. Kiá»ƒu <code>fn</code> Ä‘Æ°á»£c gá»i lÃ  <em>con trá» hÃ m</em>. Viá»‡c truyá»n cÃ¡c hÃ m báº±ng con trá» hÃ m cho phÃ©p báº¡n sá»­ dá»¥ng cÃ¡c hÃ m nhÆ° cÃ¡c Ä‘á»‘i sá»‘ cho cÃ¡c hÃ m khÃ¡c.</p>
<p>CÃº phÃ¡p Ä‘á»ƒ chá»‰ Ä‘á»‹nh ráº±ng má»™t tham sá»‘ lÃ  con trá» hÃ m tÆ°Æ¡ng tá»± nhÆ° cÃº phÃ¡p cá»§a closures, nhÆ° Ä‘Æ°á»£c minh há»a trong Listing 19-27, nÆ¡i chÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a má»™t hÃ m <code>add_one</code> cá»™ng má»™t vÃ o tham sá»‘ cá»§a nÃ³. HÃ m <code>do_twice</code> nháº­n hai tham sá»‘: má»™t con trá» hÃ m tá»›i báº¥t ká»³ hÃ m nÃ o nháº­n má»™t tham sá»‘ <code>i32</code> vÃ  tráº£ vá» <code>i32</code>, vÃ  má»™t giÃ¡ trá»‹ <code>i32</code>. HÃ m <code>do_twice</code> gá»i hÃ m <code>f</code> hai láº§n, truyá»n cho nÃ³ giÃ¡ trá»‹ <code>arg</code>, sau Ä‘Ã³ cá»™ng káº¿t quáº£ cá»§a hai láº§n gá»i hÃ m láº¡i vá»›i nhau. HÃ m <code>main</code> gá»i <code>do_twice</code> vá»›i cÃ¡c Ä‘á»‘i sá»‘ <code>add_one</code> vÃ  <code>5</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-27/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-27: Sá»­ dá»¥ng kiá»ƒu <code>fn</code> Ä‘á»ƒ nháº­n con trá» hÃ m lÃ m Ä‘á»‘i sá»‘</span></p>
<p>Äoáº¡n mÃ£ nÃ y in ra <code>The answer is: 12</code>. ChÃºng ta chá»‰ Ä‘á»‹nh ráº±ng tham sá»‘ <code>f</code> trong <code>do_twice</code> lÃ  má»™t <code>fn</code> nháº­n má»™t tham sá»‘ kiá»ƒu <code>i32</code> vÃ  tráº£ vá» <code>i32</code>. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ gá»i <code>f</code> trong thÃ¢n hÃ m <code>do_twice</code>. Trong <code>main</code>, chÃºng ta cÃ³ thá»ƒ truyá»n tÃªn hÃ m <code>add_one</code> lÃ m Ä‘á»‘i sá»‘ Ä‘áº§u tiÃªn cho <code>do_twice</code>.</p>
<p>KhÃ¡c vá»›i closures, <code>fn</code> lÃ  má»™t kiá»ƒu chá»© khÃ´ng pháº£i trait, vÃ¬ váº­y chÃºng ta chá»‰ Ä‘á»‹nh <code>fn</code> lÃ m kiá»ƒu tham sá»‘ trá»±c tiáº¿p thay vÃ¬ khai bÃ¡o má»™t tham sá»‘ generic vá»›i má»™t trong cÃ¡c trait <code>Fn</code> lÃ m rÃ ng buá»™c trait.</p>
<p>Con trá» hÃ m triá»ƒn khai cáº£ ba trait cá»§a closure (<code>Fn</code>, <code>FnMut</code> vÃ  <code>FnOnce</code>), nghÄ©a lÃ  báº¡n luÃ´n cÃ³ thá»ƒ truyá»n má»™t con trá» hÃ m lÃ m Ä‘á»‘i sá»‘ cho má»™t hÃ m yÃªu cáº§u má»™t closure. Tá»‘t nháº¥t lÃ  viáº¿t cÃ¡c hÃ m sá»­ dá»¥ng kiá»ƒu generic vÃ  má»™t trong cÃ¡c trait cá»§a closure Ä‘á»ƒ hÃ m cá»§a báº¡n cÃ³ thá»ƒ cháº¥p nháº­n cáº£ hÃ m vÃ  closures.</p>
<p>Tuy nhiÃªn, má»™t vÃ­ dá»¥ vá» trÆ°á»ng há»£p báº¡n chá»‰ muá»‘n nháº­n <code>fn</code> mÃ  khÃ´ng pháº£i closures lÃ  khi tÆ°Æ¡ng tÃ¡c vá»›i mÃ£ bÃªn ngoÃ i khÃ´ng cÃ³ closures: cÃ¡c hÃ m C cÃ³ thá»ƒ nháº­n cÃ¡c hÃ m lÃ m Ä‘á»‘i sá»‘, nhÆ°ng C khÃ´ng cÃ³ closures.</p>
<p>Láº¥y vÃ­ dá»¥ vá» nÆ¡i báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng má»™t closure Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a inline hoáº·c má»™t hÃ m cÃ³ tÃªn, hÃ£y xem cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <code>map</code> do trait <code>Iterator</code> cung cáº¥p trong thÆ° viá»‡n chuáº©n. Äá»ƒ sá»­ dá»¥ng hÃ m <code>map</code> Ä‘á»ƒ biáº¿n má»™t vector cÃ¡c sá»‘ thÃ nh má»™t vector cÃ¡c chuá»—i, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng má»™t closure, nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-15-map-closure/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>Hoáº·c chÃºng ta cÃ³ thá»ƒ Ä‘áº·t tÃªn má»™t hÃ m lÃ m Ä‘á»‘i sá»‘ cho <code>map</code> thay vÃ¬ sá»­ dá»¥ng closure, nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-16-map-function/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>LÆ°u Ã½ ráº±ng chÃºng ta pháº£i sá»­ dá»¥ng cÃº phÃ¡p Ä‘áº§y Ä‘á»§ mÃ  chÃºng ta Ä‘Ã£ nÃ³i trÆ°á»›c Ä‘Ã³ trong pháº§n <a href="ch19-03-advanced-traits.html#advanced-traits">â€œAdvanced Traitsâ€</a><!-- ignore --> vÃ¬ cÃ³ nhiá»u hÃ m cÃ¹ng tÃªn <code>to_string</code> cÃ³ sáºµn. á» Ä‘Ã¢y, chÃºng ta Ä‘ang sá»­ dá»¥ng hÃ m <code>to_string</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong trait <code>ToString</code>, mÃ  thÆ° viá»‡n chuáº©n Ä‘Ã£ triá»ƒn khai cho báº¥t ká»³ kiá»ƒu nÃ o thá»±c thi trait <code>Display</code>.</p>
<p>Nhá»› láº¡i tá»« pháº§n <a href="ch06-01-defining-an-enum.html#enum-values">â€œEnum valuesâ€</a><!-- ignore --> trong ChÆ°Æ¡ng 6 ráº±ng tÃªn cá»§a má»—i biáº¿n thá»ƒ enum mÃ  chÃºng ta Ä‘á»‹nh nghÄ©a cÅ©ng trá»Ÿ thÃ nh má»™t hÃ m khá»Ÿi táº¡o. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c hÃ m khá»Ÿi táº¡o nÃ y nhÆ° cÃ¡c con trá» hÃ m triá»ƒn khai cÃ¡c trait cá»§a closure, nghÄ©a lÃ  chÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh cÃ¡c hÃ m khá»Ÿi táº¡o lÃ m Ä‘á»‘i sá»‘ cho cÃ¡c phÆ°Æ¡ng thá»©c nháº­n closure, nhÆ° sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-17-map-initializer/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>á» Ä‘Ã¢y chÃºng ta táº¡o cÃ¡c instance <code>Status::Value</code> sá»­ dá»¥ng tá»«ng giÃ¡ trá»‹ <code>u32</code> trong pháº¡m vi mÃ  <code>map</code> Ä‘Æ°á»£c gá»i báº±ng cÃ¡ch sá»­ dá»¥ng hÃ m khá»Ÿi táº¡o cá»§a <code>Status::Value</code>. Má»™t sá»‘ ngÆ°á»i thÃ­ch phong cÃ¡ch nÃ y, trong khi má»™t sá»‘ ngÆ°á»i thÃ­ch dÃ¹ng closures. ChÃºng biÃªn dá»‹ch ra cÃ¹ng má»™t mÃ£, vÃ¬ váº­y hÃ£y sá»­ dá»¥ng phong cÃ¡ch nÃ o rÃµ rÃ ng hÆ¡n vá»›i báº¡n.</p>
<h3 id="tráº£-vá»-closures"><a class="header" href="#tráº£-vá»-closures">Tráº£ vá» Closures</a></h3>
<p>Closures Ä‘Æ°á»£c biá»ƒu diá»…n báº±ng cÃ¡c trait, nghÄ©a lÃ  báº¡n khÃ´ng thá»ƒ tráº£ vá» closures trá»±c tiáº¿p. Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p mÃ  báº¡n muá»‘n tráº£ vá» má»™t trait, báº¡n cÃ³ thá»ƒ thay vÃ o Ä‘Ã³ sá»­ dá»¥ng kiá»ƒu cá»¥ thá»ƒ triá»ƒn khai trait lÃ m giÃ¡ trá»‹ tráº£ vá» cá»§a hÃ m. Tuy nhiÃªn, báº¡n khÃ´ng thá»ƒ lÃ m Ä‘iá»u Ä‘Ã³ vá»›i closures vÃ¬ chÃºng khÃ´ng cÃ³ kiá»ƒu cá»¥ thá»ƒ cÃ³ thá»ƒ tráº£ vá»; vÃ­ dá»¥, báº¡n khÃ´ng Ä‘Æ°á»£c phÃ©p sá»­ dá»¥ng con trá» hÃ m <code>fn</code> lÃ m kiá»ƒu tráº£ vá».</p>
<p>Äoáº¡n mÃ£ sau cá»‘ gáº¯ng tráº£ vá» má»™t closure trá»±c tiáº¿p, nhÆ°ng sáº½ khÃ´ng biÃªn dá»‹ch:</p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-18-returns-closure/src/lib.rs}}</code></pre>
<p>Lá»—i biÃªn dá»‹ch sáº½ nhÆ° sau:</p>
<pre><code class="language-console">{{#include ../listings/ch19-advanced-features/no-listing-18-returns-closure/output.txt}}
</code></pre>
<p>Lá»—i nÃ y láº¡i liÃªn quan Ä‘áº¿n trait <code>Sized</code>! Rust khÃ´ng biáº¿t cáº§n bao nhiÃªu bá»™ nhá»› Ä‘á»ƒ lÆ°u closure. ChÃºng ta Ä‘Ã£ tháº¥y má»™t giáº£i phÃ¡p cho váº¥n Ä‘á» nÃ y trÆ°á»›c Ä‘Ã³. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng má»™t trait object:</p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-19-returns-closure-trait-object/src/lib.rs}}</code></pre>
<p>Äoáº¡n mÃ£ nÃ y sáº½ biÃªn dá»‹ch bÃ¬nh thÆ°á»ng. Äá»ƒ tÃ¬m hiá»ƒu thÃªm vá» trait objects, tham kháº£o pháº§n <a href="ch17-02-trait-objects.html#using-trait-objects-that-allow-for-values-of-different-types">â€œUsing Trait Objects That Allow for Values of Different Typesâ€</a><!-- ignore --> trong ChÆ°Æ¡ng 17.</p>
<p>Tiáº¿p theo, hÃ£y cÃ¹ng xem vá» macros!</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="macros"><a class="header" href="#macros">Macros</a></h2>
<p>ChÃºng ta Ä‘Ã£ sá»­ dá»¥ng cÃ¡c macro nhÆ° <code>println!</code> trong suá»‘t cuá»‘n sÃ¡ch nÃ y, nhÆ°ng chÃºng ta chÆ°a khÃ¡m phÃ¡ Ä‘áº§y Ä‘á»§ macro lÃ  gÃ¬ vÃ  cÃ¡ch chÃºng hoáº¡t Ä‘á»™ng. Thuáº­t ngá»¯ <em>macro</em> Ä‘á» cáº­p Ä‘áº¿n má»™t táº­p há»£p cÃ¡c tÃ­nh nÄƒng trong Rust: <em>macro khai bÃ¡o</em> vá»›i <code>macro_rules!</code> vÃ  ba loáº¡i <em>macro thá»§ tá»¥c</em>:</p>
<ul>
<li>Macro <code>#[derive]</code> tÃ¹y chá»‰nh, xÃ¡c Ä‘á»‹nh mÃ£ Ä‘Æ°á»£c thÃªm vá»›i thuá»™c tÃ­nh <code>derive</code> sá»­ dá»¥ng trÃªn struct vÃ  enum</li>
<li>Macro kiá»ƒu thuá»™c tÃ­nh, Ä‘á»‹nh nghÄ©a cÃ¡c thuá»™c tÃ­nh tÃ¹y chá»‰nh cÃ³ thá»ƒ sá»­ dá»¥ng trÃªn báº¥t ká»³ item nÃ o</li>
<li>Macro kiá»ƒu hÃ m, trÃ´ng giá»‘ng nhÆ° cÃ¡c lá»i gá»i hÃ m nhÆ°ng hoáº¡t Ä‘á»™ng trÃªn cÃ¡c token Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh lÃ m Ä‘á»‘i sá»‘</li>
</ul>
<p>ChÃºng ta sáº½ láº§n lÆ°á»£t nÃ³i vá» tá»«ng loáº¡i, nhÆ°ng trÆ°á»›c tiÃªn, hÃ£y xem lÃ½ do táº¡i sao chÃºng ta cáº§n macro khi Ä‘Ã£ cÃ³ hÃ m.</p>
<h3 id="sá»±-khÃ¡c-biá»‡t-giá»¯a-macros-vÃ -functions"><a class="header" href="#sá»±-khÃ¡c-biá»‡t-giá»¯a-macros-vÃ -functions">Sá»± khÃ¡c biá»‡t giá»¯a Macros vÃ  Functions</a></h3>
<p>Vá» cÆ¡ báº£n, macros lÃ  cÃ¡ch viáº¿t mÃ£ mÃ  tá»± nÃ³ viáº¿t ra mÃ£ khÃ¡c, Ä‘iá»u nÃ y Ä‘Æ°á»£c gá»i lÃ  <em>metaprogramming</em>. Trong Phá»¥ lá»¥c C, chÃºng ta tháº£o luáº­n vá» thuá»™c tÃ­nh <code>derive</code>, táº¡o ra viá»‡c triá»ƒn khai cÃ¡c trait khÃ¡c nhau cho báº¡n. ChÃºng ta cÅ©ng Ä‘Ã£ sá»­ dá»¥ng cÃ¡c macro <code>println!</code> vÃ  <code>vec!</code> trong suá»‘t cuá»‘n sÃ¡ch. Táº¥t cáº£ cÃ¡c macro nÃ y <em>má»Ÿ rá»™ng</em> Ä‘á»ƒ táº¡o ra nhiá»u mÃ£ hÆ¡n so vá»›i mÃ£ báº¡n viáº¿t thá»§ cÃ´ng.</p>
<p>Metaprogramming há»¯u Ã­ch Ä‘á»ƒ giáº£m lÆ°á»£ng mÃ£ báº¡n pháº£i viáº¿t vÃ  duy trÃ¬, Ä‘iá»u nÃ y cÅ©ng lÃ  má»™t trong nhá»¯ng vai trÃ² cá»§a hÃ m. Tuy nhiÃªn, macros cÃ³ má»™t sá»‘ kháº£ nÄƒng bá»• sung mÃ  hÃ m khÃ´ng cÃ³.</p>
<p>Má»™t chá»¯ kÃ½ hÃ m pháº£i khai bÃ¡o sá»‘ lÆ°á»£ng vÃ  kiá»ƒu cá»§a cÃ¡c tham sá»‘ mÃ  hÃ m cÃ³. NgÆ°á»£c láº¡i, macros cÃ³ thá»ƒ nháº­n má»™t sá»‘ lÆ°á»£ng biáº¿n Ä‘á»•i cá»§a cÃ¡c tham sá»‘: chÃºng ta cÃ³ thá»ƒ gá»i <code>println!("hello")</code> vá»›i má»™t Ä‘á»‘i sá»‘ hoáº·c <code>println!("hello {}", name)</code> vá»›i hai Ä‘á»‘i sá»‘. NgoÃ i ra, macros Ä‘Æ°á»£c má»Ÿ rá»™ng trÆ°á»›c khi trÃ¬nh biÃªn dá»‹ch giáº£i thÃ­ch Ã½ nghÄ©a cá»§a mÃ£, vÃ¬ váº­y má»™t macro cÃ³ thá»ƒ, vÃ­ dá»¥, triá»ƒn khai má»™t trait trÃªn má»™t kiá»ƒu nháº¥t Ä‘á»‹nh. Má»™t hÃ m khÃ´ng thá»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u Ä‘Ã³, vÃ¬ nÃ³ Ä‘Æ°á»£c gá»i táº¡i runtime vÃ  má»™t trait cáº§n Ä‘Æ°á»£c triá»ƒn khai táº¡i compile time.</p>
<p>NhÆ°á»£c Ä‘iá»ƒm cá»§a viá»‡c triá»ƒn khai macro thay vÃ¬ hÃ m lÃ  cÃ¡c Ä‘á»‹nh nghÄ©a macro phá»©c táº¡p hÆ¡n Ä‘á»‹nh nghÄ©a hÃ m vÃ¬ báº¡n Ä‘ang viáº¿t mÃ£ Rust mÃ  tá»± nÃ³ viáº¿t ra mÃ£ Rust khÃ¡c. Do sá»± giÃ¡n tiáº¿p nÃ y, cÃ¡c Ä‘á»‹nh nghÄ©a macro thÆ°á»ng khÃ³ Ä‘á»c, hiá»ƒu vÃ  duy trÃ¬ hÆ¡n so vá»›i Ä‘á»‹nh nghÄ©a hÃ m.</p>
<p>Má»™t khÃ¡c biá»‡t quan trá»ng khÃ¡c giá»¯a macros vÃ  hÃ m lÃ  báº¡n pháº£i Ä‘á»‹nh nghÄ©a macro hoáº·c Ä‘Æ°a chÃºng vÃ o pháº¡m vi <em>trÆ°á»›c</em> khi gá»i chÃºng trong má»™t file, khÃ¡c vá»›i cÃ¡c hÃ m mÃ  báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a á»Ÿ báº¥t cá»© Ä‘Ã¢u vÃ  gá»i á»Ÿ báº¥t cá»© Ä‘Ã¢u.</p>
<h3 id="macros-khai-bÃ¡o-vá»›i-macro_rules-cho-metaprogramming-chung"><a class="header" href="#macros-khai-bÃ¡o-vá»›i-macro_rules-cho-metaprogramming-chung">Macros Khai BÃ¡o vá»›i <code>macro_rules!</code> cho Metaprogramming Chung</a></h3>
<p>HÃ¬nh thá»©c macro Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i nháº¥t trong Rust lÃ  <em>macro khai bÃ¡o</em>. ChÃºng Ä‘Ã´i khi cÃ²n Ä‘Æ°á»£c gá»i lÃ  â€œmacros theo vÃ­ dá»¥â€, â€œ<code>macro_rules!</code> macros,â€ hoáº·c Ä‘Æ¡n giáº£n lÃ  â€œmacros.â€ Vá» báº£n cháº¥t, macro khai bÃ¡o cho phÃ©p báº¡n viáº¿t má»™t cÃ¡i gÃ¬ Ä‘Ã³ tÆ°Æ¡ng tá»± nhÆ° biá»ƒu thá»©c <code>match</code> trong Rust. NhÆ° Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 6, biá»ƒu thá»©c <code>match</code> lÃ  cÃ¡c cáº¥u trÃºc Ä‘iá»u khiá»ƒn nháº­n má»™t biá»ƒu thá»©c, so sÃ¡nh giÃ¡ trá»‹ káº¿t quáº£ cá»§a biá»ƒu thá»©c vá»›i cÃ¡c pattern, vÃ  sau Ä‘Ã³ cháº¡y mÃ£ liÃªn quan Ä‘áº¿n pattern khá»›p. Macro cÅ©ng so sÃ¡nh má»™t giÃ¡ trá»‹ vá»›i cÃ¡c pattern Ä‘Æ°á»£c liÃªn káº¿t vá»›i mÃ£ cá»¥ thá»ƒ: trong trÆ°á»ng há»£p nÃ y, giÃ¡ trá»‹ lÃ  mÃ£ nguá»“n Rust literal Ä‘Æ°á»£c truyá»n vÃ o macro; cÃ¡c pattern Ä‘Æ°á»£c so sÃ¡nh vá»›i cáº¥u trÃºc cá»§a mÃ£ nguá»“n Ä‘Ã³; vÃ  mÃ£ liÃªn káº¿t vá»›i má»—i pattern, khi khá»›p, sáº½ thay tháº¿ mÃ£ Ä‘Æ°á»£c truyá»n vÃ o macro. Táº¥t cáº£ Ä‘iá»u nÃ y xáº£y ra trong quÃ¡ trÃ¬nh biÃªn dá»‹ch.</p>
<p>Äá»ƒ Ä‘á»‹nh nghÄ©a má»™t macro, báº¡n sá»­ dá»¥ng cáº¥u trÃºc <code>macro_rules!</code>. HÃ£y cÃ¹ng khÃ¡m phÃ¡ cÃ¡ch sá»­ dá»¥ng <code>macro_rules!</code> báº±ng cÃ¡ch xem cÃ¡ch macro <code>vec!</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. ChÆ°Æ¡ng 8 Ä‘Ã£ Ä‘á» cáº­p cÃ¡ch chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng macro <code>vec!</code> Ä‘á»ƒ táº¡o má»™t vector má»›i vá»›i cÃ¡c giÃ¡ trá»‹ cá»¥ thá»ƒ. VÃ­ dá»¥, macro sau táº¡o má»™t vector má»›i chá»©a ba sá»‘ nguyÃªn:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let v: Vec&lt;u32&gt; = vec![1, 2, 3];
<span class="boring">}</span></code></pre></pre>
<p>ChÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng macro <code>vec!</code> Ä‘á»ƒ táº¡o má»™t vector gá»“m hai sá»‘ nguyÃªn hoáº·c má»™t vector gá»“m nÄƒm string slice. ChÃºng ta sáº½ khÃ´ng thá»ƒ sá»­ dá»¥ng hÃ m Ä‘á»ƒ lÃ m Ä‘iá»u tÆ°Æ¡ng tá»± vÃ¬ khÃ´ng biáº¿t trÆ°á»›c sá»‘ lÆ°á»£ng hoáº·c kiá»ƒu cá»§a cÃ¡c giÃ¡ trá»‹.</p>
<p>Listing 19-28 cho tháº¥y má»™t Ä‘á»‹nh nghÄ©a hÆ¡i Ä‘Æ¡n giáº£n hÃ³a cá»§a macro <code>vec!</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-28/src/lib.rs}}</code></pre>
<p><span class="caption">Listing 19-28: PhiÃªn báº£n Ä‘Æ¡n giáº£n hÃ³a cá»§a Ä‘á»‹nh nghÄ©a macro <code>vec!</code></span></p>
<blockquote>
<p>LÆ°u Ã½: Äá»‹nh nghÄ©a thá»±c táº¿ cá»§a macro <code>vec!</code> trong thÆ° viá»‡n chuáº©n bao gá»“m mÃ£ Ä‘á»ƒ cáº¥p phÃ¡t trÆ°á»›c lÆ°á»£ng bá»™ nhá»› chÃ­nh xÃ¡c. MÃ£ Ä‘Ã³ lÃ  má»™t tá»‘i Æ°u hÃ³a mÃ  chÃºng ta khÃ´ng bao gá»“m á»Ÿ Ä‘Ã¢y Ä‘á»ƒ lÃ m vÃ­ dá»¥ Ä‘Æ¡n giáº£n hÆ¡n.</p>
</blockquote>
<p>ChÃº thÃ­ch <code>#[macro_export]</code> chá»‰ ra ráº±ng macro nÃ y nÃªn cÃ³ sáºµn báº¥t cá»© khi nÃ o crate chá»©a macro Ä‘Æ°á»£c Ä‘Æ°a vÃ o pháº¡m vi. Náº¿u khÃ´ng cÃ³ chÃº thÃ­ch nÃ y, macro sáº½ khÃ´ng thá»ƒ Ä‘Æ°á»£c Ä‘Æ°a vÃ o pháº¡m vi.</p>
<p>ChÃºng ta báº¯t Ä‘áº§u Ä‘á»‹nh nghÄ©a macro vá»›i <code>macro_rules!</code> vÃ  tÃªn cá»§a macro mÃ  chÃºng ta Ä‘ang Ä‘á»‹nh nghÄ©a <em>khÃ´ng cÃ³</em> dáº¥u cháº¥m than. TÃªn, trong trÆ°á»ng há»£p nÃ y lÃ  <code>vec</code>, Ä‘Æ°á»£c theo sau bá»Ÿi dáº¥u ngoáº·c nhá»n xÃ¡c Ä‘á»‹nh thÃ¢n cá»§a Ä‘á»‹nh nghÄ©a macro.</p>
<p>Cáº¥u trÃºc trong thÃ¢n <code>vec!</code> tÆ°Æ¡ng tá»± cáº¥u trÃºc cá»§a má»™t biá»ƒu thá»©c <code>match</code>. á» Ä‘Ã¢y chÃºng ta cÃ³ má»™t nhÃ¡nh vá»›i pattern <code>( $( $x:expr ),* )</code>, theo sau bá»Ÿi <code>=&gt;</code> vÃ  khá»‘i mÃ£ liÃªn káº¿t vá»›i pattern nÃ y. Náº¿u pattern khá»›p, khá»‘i mÃ£ liÃªn káº¿t sáº½ Ä‘Æ°á»£c táº¡o ra. VÃ¬ Ä‘Ã¢y lÃ  pattern duy nháº¥t trong macro nÃ y, chá»‰ cÃ³ má»™t cÃ¡ch há»£p lá»‡ Ä‘á»ƒ khá»›p; báº¥t ká»³ pattern nÃ o khÃ¡c sáº½ dáº«n Ä‘áº¿n lá»—i. CÃ¡c macro phá»©c táº¡p hÆ¡n sáº½ cÃ³ nhiá»u nhÃ¡nh hÆ¡n.</p>
<p>CÃº phÃ¡p pattern há»£p lá»‡ trong Ä‘á»‹nh nghÄ©a macro khÃ¡c vá»›i cÃº phÃ¡p pattern Ä‘Æ°á»£c trÃ¬nh bÃ y trong ChÆ°Æ¡ng 18 vÃ¬ cÃ¡c macro pattern Ä‘Æ°á»£c khá»›p vá»›i cáº¥u trÃºc mÃ£ Rust thay vÃ¬ giÃ¡ trá»‹. HÃ£y cÃ¹ng phÃ¢n tÃ­ch cÃ¡c thÃ nh pháº§n pattern trong Listing 19-28; Ä‘á»ƒ xem toÃ n bá»™ cÃº phÃ¡p pattern cá»§a macro, tham kháº£o <a href="../reference/macros-by-example.html">Rust Reference</a>.</p>
<p>Äáº§u tiÃªn, chÃºng ta sá»­ dá»¥ng má»™t cáº·p dáº¥u ngoáº·c Ä‘á»ƒ bao quanh toÃ n bá»™ pattern. ChÃºng ta sá»­ dá»¥ng dáº¥u Ä‘Ã´ la (<code>$</code>) Ä‘á»ƒ khai bÃ¡o má»™t biáº¿n trong há»‡ thá»‘ng macro sáº½ chá»©a mÃ£ Rust khá»›p vá»›i pattern. Dáº¥u Ä‘Ã´ la lÃ m rÃµ ráº±ng Ä‘Ã¢y lÃ  má»™t biáº¿n macro, khÃ¡c vá»›i biáº¿n Rust thÃ´ng thÆ°á»ng. Tiáº¿p theo lÃ  má»™t cáº·p dáº¥u ngoáº·c Ä‘á»ƒ báº¯t cÃ¡c giÃ¡ trá»‹ khá»›p vá»›i pattern bÃªn trong dáº¥u ngoáº·c Ä‘á»ƒ sá»­ dá»¥ng trong mÃ£ thay tháº¿. BÃªn trong <code>$()</code> lÃ  <code>$x:expr</code>, khá»›p vá»›i báº¥t ká»³ biá»ƒu thá»©c Rust nÃ o vÃ  gÃ¡n tÃªn <code>$x</code> cho biá»ƒu thá»©c Ä‘Ã³.</p>
<p>Dáº¥u pháº©y theo sau <code>$()</code> chá»‰ ra ráº±ng má»™t kÃ½ tá»± dáº¥u pháº©y thá»±c táº¿ cÃ³ thá»ƒ xuáº¥t hiá»‡n tÃ¹y chá»n sau mÃ£ khá»›p vá»›i <code>$()</code>. Dáº¥u <code>*</code> chá»‰ ra ráº±ng pattern khá»›p vá»›i khÃ´ng hoáº·c nhiá»u láº§n báº¥t cá»© thá»© gÃ¬ Ä‘á»©ng trÆ°á»›c <code>*</code>.</p>
<p>Khi chÃºng ta gá»i macro nÃ y vá»›i <code>vec![1, 2, 3];</code>, pattern <code>$x</code> khá»›p ba láº§n vá»›i ba biá»ƒu thá»©c <code>1</code>, <code>2</code>, vÃ  <code>3</code>.</p>
<p>BÃ¢y giá» hÃ£y xem pattern trong thÃ¢n mÃ£ liÃªn káº¿t vá»›i nhÃ¡nh nÃ y: <code>temp_vec.push()</code> trong <code>$()*</code> Ä‘Æ°á»£c sinh ra cho má»—i pháº§n khá»›p vá»›i <code>$()</code> trong pattern khÃ´ng hoáº·c nhiá»u láº§n tÃ¹y thuá»™c vÃ o sá»‘ láº§n pattern khá»›p. <code>$x</code> Ä‘Æ°á»£c thay tháº¿ báº±ng má»—i biá»ƒu thá»©c khá»›p. Khi chÃºng ta gá»i macro nÃ y vá»›i <code>vec![1, 2, 3];</code>, mÃ£ Ä‘Æ°á»£c sinh ra thay tháº¿ cho lá»i gá»i macro nÃ y sáº½ lÃ :</p>
<pre><code class="language-rust ignore">{
    let mut temp_vec = Vec::new();
    temp_vec.push(1);
    temp_vec.push(2);
    temp_vec.push(3);
    temp_vec
}</code></pre>
<p>ChÃºng ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a má»™t macro cÃ³ thá»ƒ nháº­n báº¥t ká»³ sá»‘ lÆ°á»£ng Ä‘á»‘i sá»‘ nÃ o vá»›i báº¥t ká»³ kiá»ƒu nÃ o vÃ  cÃ³ thá»ƒ sinh mÃ£ Ä‘á»ƒ táº¡o má»™t vector chá»©a cÃ¡c pháº§n tá»­ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh.</p>
<p>Äá»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch viáº¿t macro, tham kháº£o tÃ i liá»‡u trá»±c tuyáº¿n hoáº·c cÃ¡c nguá»“n khÃ¡c, cháº³ng háº¡n nhÆ° <a href="https://veykril.github.io/tlborm/">â€œThe Little Book of Rust Macrosâ€</a> do Daniel Keep khá»Ÿi xÆ°á»›ng vÃ  tiáº¿p tá»¥c bá»Ÿi Lukas Wirth.</p>
<h3 id="macros-thá»§-tá»¥c-Ä‘á»ƒ-sinh-mÃ£-tá»«-thuá»™c-tÃ­nh"><a class="header" href="#macros-thá»§-tá»¥c-Ä‘á»ƒ-sinh-mÃ£-tá»«-thuá»™c-tÃ­nh">Macros Thá»§ Tá»¥c Ä‘á»ƒ Sinh MÃ£ tá»« Thuá»™c TÃ­nh</a></h3>
<p>HÃ¬nh thá»©c thá»© hai cá»§a macro lÃ  <em>macro thá»§ tá»¥c</em>, hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° má»™t hÃ m (vÃ  lÃ  má»™t loáº¡i thá»§ tá»¥c). Macros thá»§ tá»¥c nháº­n má»™t sá»‘ mÃ£ lÃ m Ä‘áº§u vÃ o, thao tÃ¡c trÃªn mÃ£ Ä‘Ã³, vÃ  táº¡o ra má»™t sá»‘ mÃ£ lÃ m Ä‘áº§u ra thay vÃ¬ so khá»›p vá»›i cÃ¡c pattern vÃ  thay tháº¿ mÃ£ nhÆ° cÃ¡c macro khai bÃ¡o. Ba loáº¡i macros thá»§ tá»¥c lÃ  custom derive, attribute-like, vÃ  function-like, vÃ  táº¥t cáº£ hoáº¡t Ä‘á»™ng theo cÃ¡ch tÆ°Æ¡ng tá»±.</p>
<p>Khi táº¡o macros thá»§ tá»¥c, Ä‘á»‹nh nghÄ©a pháº£i náº±m trong má»™t crate riÃªng vá»›i loáº¡i crate Ä‘áº·c biá»‡t. Äiá»u nÃ y do cÃ¡c lÃ½ do ká»¹ thuáº­t phá»©c táº¡p mÃ  chÃºng ta hy vá»ng sáº½ loáº¡i bá» trong tÆ°Æ¡ng lai. Trong Listing 19-29, chÃºng ta minh há»a cÃ¡ch Ä‘á»‹nh nghÄ©a má»™t macro thá»§ tá»¥c, trong Ä‘Ã³ <code>some_attribute</code> lÃ  má»™t chá»— giá»¯ chá»— cho viá»‡c sá»­ dá»¥ng má»™t loáº¡i macro cá»¥ thá»ƒ.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore">use proc_macro;

#[some_attribute]
pub fn some_name(input: TokenStream) -&gt; TokenStream {
}</code></pre>
<p><span class="caption">Listing 19-29: VÃ­ dá»¥ vá» viá»‡c Ä‘á»‹nh nghÄ©a má»™t procedural macro</span></p>
<p>HÃ m Ä‘á»‹nh nghÄ©a má»™t procedural macro nháº­n má»™t <code>TokenStream</code> lÃ m Ä‘áº§u vÃ o vÃ  táº¡o ra má»™t <code>TokenStream</code> lÃ m Ä‘áº§u ra. Kiá»ƒu <code>TokenStream</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a bá»Ÿi crate <code>proc_macro</code> Ä‘i kÃ¨m vá»›i Rust vÃ  Ä‘áº¡i diá»‡n cho má»™t chuá»—i cÃ¡c token. ÄÃ¢y lÃ  pháº§n cá»‘t lÃµi cá»§a macro: mÃ£ nguá»“n mÃ  macro thao tÃ¡c táº¡o thÃ nh <code>TokenStream</code> Ä‘áº§u vÃ o, vÃ  mÃ£ mÃ  macro sinh ra lÃ  <code>TokenStream</code> Ä‘áº§u ra. HÃ m cÅ©ng cÃ³ má»™t thuá»™c tÃ­nh Ä‘i kÃ¨m chá»‰ ra loáº¡i procedural macro mÃ  chÃºng ta Ä‘ang táº¡o. ChÃºng ta cÃ³ thá»ƒ cÃ³ nhiá»u loáº¡i procedural macro trong cÃ¹ng má»™t crate.</p>
<p>HÃ£y xem cÃ¡c loáº¡i procedural macro khÃ¡c nhau. ChÃºng ta sáº½ báº¯t Ä‘áº§u vá»›i má»™t custom derive macro vÃ  sau Ä‘Ã³ giáº£i thÃ­ch nhá»¯ng khÃ¡c biá»‡t nhá» khiáº¿n cÃ¡c dáº¡ng khÃ¡c khÃ¡c nhau.</p>
<h3 id="cÃ¡ch-viáº¿t-custom-derive-macro"><a class="header" href="#cÃ¡ch-viáº¿t-custom-derive-macro">CÃ¡ch Viáº¿t Custom <code>derive</code> Macro</a></h3>
<p>HÃ£y táº¡o má»™t crate cÃ³ tÃªn <code>hello_macro</code> Ä‘á»‹nh nghÄ©a má»™t trait cÃ³ tÃªn <code>HelloMacro</code> vá»›i má»™t hÃ m liÃªn káº¿t lÃ  <code>hello_macro</code>. Thay vÃ¬ yÃªu cáº§u ngÆ°á»i dÃ¹ng triá»ƒn khai trait <code>HelloMacro</code> cho tá»«ng kiá»ƒu cá»§a há», chÃºng ta sáº½ cung cáº¥p má»™t procedural macro Ä‘á»ƒ ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ chÃº thÃ­ch kiá»ƒu cá»§a há» vá»›i <code>#[derive(HelloMacro)]</code> Ä‘á»ƒ nháº­n triá»ƒn khai máº·c Ä‘á»‹nh cá»§a hÃ m <code>hello_macro</code>. Triá»ƒn khai máº·c Ä‘á»‹nh sáº½ in ra <code>Hello, Macro! My name is TypeName!</code>, trong Ä‘Ã³ <code>TypeName</code> lÃ  tÃªn cá»§a kiá»ƒu mÃ  trait nÃ y Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. NÃ³i cÃ¡ch khÃ¡c, chÃºng ta sáº½ viáº¿t má»™t crate cho phÃ©p láº­p trÃ¬nh viÃªn khÃ¡c viáº¿t mÃ£ nhÆ° Listing 19-30 sá»­ dá»¥ng crate cá»§a chÃºng ta.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-30/src/main.rs}}</code></pre>
<p><span class="caption">Listing 19-30: MÃ£ mÃ  ngÆ°á»i dÃ¹ng crate cá»§a chÃºng ta cÃ³ thá»ƒ viáº¿t khi sá»­ dá»¥ng procedural macro</span></p>
<p>Äoáº¡n mÃ£ nÃ y sáº½ in ra <code>Hello, Macro! My name is Pancakes!</code> khi hoÃ n táº¥t. BÆ°á»›c Ä‘áº§u tiÃªn lÃ  táº¡o má»™t crate thÆ° viá»‡n má»›i, nhÆ° sau:</p>
<pre><code class="language-console">$ cargo new hello_macro --lib
</code></pre>
<p>Tiáº¿p theo, chÃºng ta sáº½ Ä‘á»‹nh nghÄ©a trait <code>HelloMacro</code> vÃ  hÃ m liÃªn káº¿t cá»§a nÃ³:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-20-impl-hellomacro-for-pancakes/hello_macro/src/lib.rs}}</code></pre>
<p>ChÃºng ta Ä‘Ã£ cÃ³ má»™t trait vÃ  hÃ m cá»§a nÃ³. Táº¡i thá»i Ä‘iá»ƒm nÃ y, ngÆ°á»i dÃ¹ng crate cá»§a chÃºng ta cÃ³ thá»ƒ triá»ƒn khai trait Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c chá»©c nÄƒng mong muá»‘n, nhÆ° sau:</p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-20-impl-hellomacro-for-pancakes/pancakes/src/main.rs}}</code></pre>
<p>Tuy nhiÃªn, há» sáº½ pháº£i viáº¿t khá»‘i triá»ƒn khai cho tá»«ng kiá»ƒu mÃ  há» muá»‘n sá»­ dá»¥ng vá»›i <code>hello_macro</code>; chÃºng ta muá»‘n giÃºp há» khá»i pháº£i lÃ m viá»‡c nÃ y.</p>
<p>NgoÃ i ra, chÃºng ta chÆ°a thá»ƒ cung cáº¥p hÃ m <code>hello_macro</code> vá»›i triá»ƒn khai máº·c Ä‘á»‹nh in ra tÃªn cá»§a kiá»ƒu mÃ  trait Ä‘Æ°á»£c triá»ƒn khai trÃªn Ä‘Ã³: Rust khÃ´ng cÃ³ kháº£ nÄƒng reflection, vÃ¬ váº­y khÃ´ng thá»ƒ tra cá»©u tÃªn kiá»ƒu táº¡i runtime. ChÃºng ta cáº§n má»™t macro Ä‘á»ƒ sinh mÃ£ táº¡i thá»i gian biÃªn dá»‹ch.</p>
<p>BÆ°á»›c tiáº¿p theo lÃ  Ä‘á»‹nh nghÄ©a procedural macro. Táº¡i thá»i Ä‘iá»ƒm viáº¿t, cÃ¡c procedural macro cáº§n náº±m trong má»™t crate riÃªng. Trong tÆ°Æ¡ng lai, háº¡n cháº¿ nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c loáº¡i bá». Quy Æ°á»›c cáº¥u trÃºc crate vÃ  crate macro nhÆ° sau: Ä‘á»‘i vá»›i má»™t crate cÃ³ tÃªn <code>foo</code>, crate procedural macro custom derive sáº½ Ä‘Æ°á»£c gá»i lÃ  <code>foo_derive</code>. HÃ£y báº¯t Ä‘áº§u má»™t crate má»›i cÃ³ tÃªn <code>hello_macro_derive</code> bÃªn trong dá»± Ã¡n <code>hello_macro</code> cá»§a chÃºng ta:</p>
<pre><code class="language-console">$ cargo new hello_macro_derive --lib
</code></pre>
<p>Hai crate cá»§a chÃºng ta cÃ³ má»‘i quan há»‡ cháº·t cháº½, vÃ¬ váº­y chÃºng ta táº¡o crate procedural macro bÃªn trong thÆ° má»¥c cá»§a crate <code>hello_macro</code>. Náº¿u chÃºng ta thay Ä‘á»•i Ä‘á»‹nh nghÄ©a trait trong <code>hello_macro</code>, chÃºng ta cÅ©ng sáº½ pháº£i thay Ä‘á»•i triá»ƒn khai cá»§a procedural macro trong <code>hello_macro_derive</code>. Hai crate sáº½ cáº§n Ä‘Æ°á»£c phÃ¡t hÃ nh riÃªng, vÃ  láº­p trÃ¬nh viÃªn sá»­ dá»¥ng cÃ¡c crate nÃ y sáº½ cáº§n thÃªm cáº£ hai lÃ m dependencies vÃ  Ä‘Æ°a cáº£ hai vÃ o pháº¡m vi. ChÃºng ta cÃ³ thá»ƒ Ä‘á»ƒ crate <code>hello_macro</code> sá»­ dá»¥ng <code>hello_macro_derive</code> lÃ m dependency vÃ  re-export mÃ£ procedural macro. Tuy nhiÃªn, cÃ¡ch chÃºng ta cáº¥u trÃºc dá»± Ã¡n cho phÃ©p láº­p trÃ¬nh viÃªn sá»­ dá»¥ng <code>hello_macro</code> ngay cáº£ khi há» khÃ´ng cáº§n chá»©c nÄƒng <code>derive</code>.</p>
<p>ChÃºng ta cáº§n khai bÃ¡o crate <code>hello_macro_derive</code> lÃ  má»™t procedural macro crate. ChÃºng ta cÅ©ng sáº½ cáº§n chá»©c nÄƒng tá»« cÃ¡c crate <code>syn</code> vÃ  <code>quote</code>, nhÆ° báº¡n sáº½ tháº¥y ngay sau Ä‘Ã¢y, vÃ¬ váº­y cáº§n thÃªm chÃºng lÃ m dependencies. ThÃªm cÃ¡c dÃ²ng sau vÃ o file <em>Cargo.toml</em> cá»§a <code>hello_macro_derive</code>:</p>
<p><span class="filename">Filename: hello_macro_derive/Cargo.toml</span></p>
<pre><code class="language-toml">{{#include ../listings/ch19-advanced-features/listing-19-31/hello_macro/hello_macro_derive/Cargo.toml:6:12}}
</code></pre>
<p>Äá»ƒ báº¯t Ä‘áº§u Ä‘á»‹nh nghÄ©a procedural macro, Ä‘áº·t mÃ£ trong Listing 19-31 vÃ o file <em>src/lib.rs</em> cá»§a crate <code>hello_macro_derive</code>. LÆ°u Ã½ ráº±ng mÃ£ nÃ y sáº½ chÆ°a biÃªn dá»‹ch cho Ä‘áº¿n khi chÃºng ta thÃªm Ä‘á»‹nh nghÄ©a cho hÃ m <code>impl_hello_macro</code>.</p>
<p><span class="filename">Filename: hello_macro_derive/src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-31/hello_macro/hello_macro_derive/src/lib.rs}}</code></pre>
<p><span class="caption">Listing 19-31: MÃ£ mÃ  háº§u háº¿t cÃ¡c crate procedural macro sáº½ cáº§n Ä‘á»ƒ xá»­ lÃ½ mÃ£ Rust</span></p>
<p>LÆ°u Ã½ ráº±ng chÃºng ta Ä‘Ã£ tÃ¡ch mÃ£ thÃ nh hÃ m <code>hello_macro_derive</code>, chá»‹u trÃ¡ch nhiá»‡m phÃ¢n tÃ­ch <code>TokenStream</code>, vÃ  hÃ m <code>impl_hello_macro</code>, chá»‹u trÃ¡ch nhiá»‡m biáº¿n Ä‘á»•i cÃ¢y cÃº phÃ¡p: Ä‘iá»u nÃ y giÃºp viá»‡c viáº¿t procedural macro thuáº­n tiá»‡n hÆ¡n. MÃ£ trong hÃ m ngoÃ i (<code>hello_macro_derive</code> trong trÆ°á»ng há»£p nÃ y) sáº½ giá»‘ng nhau cho háº§u háº¿t má»i crate procedural macro mÃ  báº¡n tháº¥y hoáº·c táº¡o. MÃ£ báº¡n chá»‰ Ä‘á»‹nh trong thÃ¢n cá»§a hÃ m bÃªn trong (<code>impl_hello_macro</code> trong trÆ°á»ng há»£p nÃ y) sáº½ khÃ¡c nhau tÃ¹y thuá»™c vÃ o má»¥c Ä‘Ã­ch cá»§a procedural macro cá»§a báº¡n.</p>
<p>ChÃºng ta Ä‘Ã£ giá»›i thiá»‡u ba crate má»›i: <code>proc_macro</code>, <a href="https://crates.io/crates/syn"><code>syn</code></a> vÃ  <a href="https://crates.io/crates/quote"><code>quote</code></a>. Crate <code>proc_macro</code> Ä‘i kÃ¨m vá»›i Rust, vÃ¬ váº­y chÃºng ta khÃ´ng cáº§n thÃªm nÃ³ vÃ o dependencies trong <em>Cargo.toml</em>. Crate <code>proc_macro</code> lÃ  API cá»§a compiler cho phÃ©p chÃºng ta Ä‘á»c vÃ  thao tÃ¡c mÃ£ Rust tá»« mÃ£ cá»§a chÃ­nh chÃºng ta.</p>
<p>Crate <code>syn</code> phÃ¢n tÃ­ch mÃ£ Rust tá»« má»™t chuá»—i thÃ nh má»™t cáº¥u trÃºc dá»¯ liá»‡u mÃ  chÃºng ta cÃ³ thá»ƒ thao tÃ¡c. Crate <code>quote</code> biáº¿n cÃ¡c cáº¥u trÃºc dá»¯ liá»‡u cá»§a <code>syn</code> trá»Ÿ láº¡i thÃ nh mÃ£ Rust. CÃ¡c crate nÃ y lÃ m cho viá»‡c phÃ¢n tÃ­ch báº¥t ká»³ loáº¡i mÃ£ Rust nÃ o mÃ  chÃºng ta muá»‘n xá»­ lÃ½ trá»Ÿ nÃªn Ä‘Æ¡n giáº£n hÆ¡n nhiá»u: viáº¿t má»™t parser Ä‘áº§y Ä‘á»§ cho mÃ£ Rust khÃ´ng pháº£i lÃ  viá»‡c Ä‘Æ¡n giáº£n.</p>
<p>HÃ m <code>hello_macro_derive</code> sáº½ Ä‘Æ°á»£c gá»i khi ngÆ°á»i dÃ¹ng thÆ° viá»‡n cá»§a chÃºng ta chá»‰ Ä‘á»‹nh <code>#[derive(HelloMacro)]</code> trÃªn má»™t kiá»ƒu. Äiá»u nÃ y kháº£ thi vÃ¬ chÃºng ta Ä‘Ã£ chÃº thÃ­ch hÃ m <code>hello_macro_derive</code> vá»›i <code>proc_macro_derive</code> vÃ  chá»‰ Ä‘á»‹nh tÃªn <code>HelloMacro</code>, khá»›p vá»›i tÃªn trait cá»§a chÃºng ta; Ä‘Ã¢y lÃ  quy Æ°á»›c mÃ  háº§u háº¿t procedural macro tuÃ¢n theo.</p>
<p>HÃ m <code>hello_macro_derive</code> trÆ°á»›c tiÃªn chuyá»ƒn <code>input</code> tá»« <code>TokenStream</code> thÃ nh má»™t cáº¥u trÃºc dá»¯ liá»‡u mÃ  chÃºng ta cÃ³ thá»ƒ diá»…n giáº£i vÃ  thao tÃ¡c. ÄÃ¢y lÃ  nÆ¡i crate <code>syn</code> phÃ¡t huy tÃ¡c dá»¥ng. HÃ m <code>parse</code> trong <code>syn</code> nháº­n má»™t <code>TokenStream</code> vÃ  tráº£ vá» má»™t struct <code>DeriveInput</code> Ä‘áº¡i diá»‡n cho mÃ£ Rust Ä‘Ã£ Ä‘Æ°á»£c phÃ¢n tÃ­ch. Listing 19-32 hiá»ƒn thá»‹ cÃ¡c pháº§n liÃªn quan cá»§a struct <code>DeriveInput</code> mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c tá»« viá»‡c phÃ¢n tÃ­ch chuá»—i <code>struct Pancakes;</code>:</p>
<pre><code class="language-rust ignore">DeriveInput {
    // --snip--

    ident: Ident {
        ident: "Pancakes",
        span: #0 bytes(95..103)
    },
    data: Struct(
        DataStruct {
            struct_token: Struct,
            fields: Unit,
            semi_token: Some(
                Semi
            )
        }
    )
}</code></pre>
<p><span class="caption">Listing 19-32: Instance <code>DeriveInput</code> chÃºng ta nháº­n Ä‘Æ°á»£c khi phÃ¢n tÃ­ch mÃ£ cÃ³ thuá»™c tÃ­nh macro trong Listing 19-30</span></p>
<p>CÃ¡c trÆ°á»ng cá»§a struct nÃ y cho tháº¥y mÃ£ Rust mÃ  chÃºng ta Ä‘Ã£ phÃ¢n tÃ­ch lÃ  má»™t unit struct vá»›i <code>ident</code> (identifier, nghÄ©a lÃ  tÃªn) lÃ  <code>Pancakes</code>. CÃ³ nhiá»u trÆ°á»ng khÃ¡c trong struct nÃ y Ä‘á»ƒ mÃ´ táº£ Ä‘á»§ loáº¡i mÃ£ Rust; xem tÃ i liá»‡u <a href="https://docs.rs/syn/1.0/syn/struct.DeriveInput.html"><code>syn</code> vá» <code>DeriveInput</code></a> Ä‘á»ƒ biáº¿t thÃªm thÃ´ng tin.</p>
<p>ChÃºng ta sáº¯p Ä‘á»‹nh nghÄ©a hÃ m <code>impl_hello_macro</code>, nÆ¡i chÃºng ta sáº½ xÃ¢y dá»±ng mÃ£ Rust má»›i mÃ  muá»‘n thÃªm vÃ o. NhÆ°ng trÆ°á»›c khi lÃ m Ä‘iá»u Ä‘Ã³, lÆ°u Ã½ ráº±ng Ä‘áº§u ra cá»§a macro derive cá»§a chÃºng ta cÅ©ng lÃ  má»™t <code>TokenStream</code>. <code>TokenStream</code> tráº£ vá» Ä‘Æ°á»£c thÃªm vÃ o mÃ£ mÃ  ngÆ°á»i dÃ¹ng crate cá»§a chÃºng ta viáº¿t, vÃ¬ váº­y khi há» biÃªn dá»‹ch crate cá»§a há», há» sáº½ nháº­n Ä‘Æ°á»£c chá»©c nÄƒng bá»• sung mÃ  chÃºng ta cung cáº¥p trong <code>TokenStream</code> Ä‘Ã£ Ä‘Æ°á»£c sá»­a Ä‘á»•i.</p>
<p>Báº¡n cÃ³ thá»ƒ nháº­n tháº¥y chÃºng ta Ä‘ang gá»i <code>unwrap</code> Ä‘á»ƒ lÃ m cho hÃ m <code>hello_macro_derive</code> panic náº¿u lá»i gá»i Ä‘áº¿n hÃ m <code>syn::parse</code> tháº¥t báº¡i á»Ÿ Ä‘Ã¢y. Äiá»u nÃ y cáº§n thiáº¿t vÃ¬ procedural macro cá»§a chÃºng ta pháº£i panic khi cÃ³ lá»—i vÃ¬ cÃ¡c hÃ m <code>proc_macro_derive</code> pháº£i tráº£ vá» <code>TokenStream</code> thay vÃ¬ <code>Result</code> Ä‘á»ƒ tuÃ¢n theo API procedural macro. ChÃºng ta Ä‘Ã£ Ä‘Æ¡n giáº£n hÃ³a vÃ­ dá»¥ nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng <code>unwrap</code>; trong mÃ£ sáº£n xuáº¥t, báº¡n nÃªn cung cáº¥p thÃ´ng bÃ¡o lá»—i cá»¥ thá»ƒ hÆ¡n vá» nhá»¯ng gÃ¬ Ä‘Ã£ xáº£y ra báº±ng cÃ¡ch sá»­ dá»¥ng <code>panic!</code> hoáº·c <code>expect</code>.</p>
<p>BÃ¢y giá» khi chÃºng ta cÃ³ mÃ£ Ä‘á»ƒ chuyá»ƒn Ä‘á»•i mÃ£ Rust Ä‘Æ°á»£c chÃº thÃ­ch tá»« <code>TokenStream</code> thÃ nh má»™t instance <code>DeriveInput</code>, hÃ£y sinh mÃ£ thá»±c thi trait <code>HelloMacro</code> trÃªn kiá»ƒu Ä‘Æ°á»£c chÃº thÃ­ch, nhÆ° Ä‘Æ°á»£c trÃ¬nh bÃ y trong Listing 19-33.</p>
<p><span class="filename">Filename: hello_macro_derive/src/lib.rs</span></p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-33/hello_macro/hello_macro_derive/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 19-33: Triá»ƒn khai trait <code>HelloMacro</code> sá»­ dá»¥ng mÃ£ Rust Ä‘Ã£ Ä‘Æ°á»£c phÃ¢n tÃ­ch</span></p>
<p>ChÃºng ta nháº­n Ä‘Æ°á»£c má»™t instance struct <code>Ident</code> chá»©a tÃªn (identifier) cá»§a kiá»ƒu Ä‘Æ°á»£c chÃº thÃ­ch báº±ng cÃ¡ch sá»­ dá»¥ng <code>ast.ident</code>. Struct trong Listing 19-32 cho tháº¥y khi cháº¡y hÃ m <code>impl_hello_macro</code> trÃªn mÃ£ trong Listing 19-30, <code>ident</code> nháº­n Ä‘Æ°á»£c sáº½ cÃ³ trÆ°á»ng <code>ident</code> vá»›i giÃ¡ trá»‹ <code>"Pancakes"</code>. Do Ä‘Ã³, biáº¿n <code>name</code> trong Listing 19-33 sáº½ chá»©a má»™t instance struct <code>Ident</code> mÃ  khi in ra sáº½ lÃ  chuá»—i <code>"Pancakes"</code>, tÃªn cá»§a struct trong Listing 19-30.</p>
<p>Macro <code>quote!</code> cho phÃ©p chÃºng ta Ä‘á»‹nh nghÄ©a mÃ£ Rust mÃ  chÃºng ta muá»‘n tráº£ vá». Compiler mong Ä‘á»£i thá»© gÃ¬ Ä‘Ã³ khÃ¡c so vá»›i káº¿t quáº£ trá»±c tiáº¿p cá»§a viá»‡c thá»±c thi macro <code>quote!</code>, vÃ¬ váº­y chÃºng ta cáº§n chuyá»ƒn Ä‘á»•i nÃ³ thÃ nh <code>TokenStream</code>. ChÃºng ta lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch gá»i phÆ°Æ¡ng thá»©c <code>into</code>, phÆ°Æ¡ng thá»©c nÃ y tiÃªu thá»¥ biá»ƒu diá»…n trung gian vÃ  tráº£ vá» giÃ¡ trá»‹ kiá»ƒu <code>TokenStream</code> yÃªu cáº§u.</p>
<p>Macro <code>quote!</code> cÅ©ng cung cáº¥p cÆ¡ cháº¿ templating ráº¥t tiá»‡n lá»£i: chÃºng ta cÃ³ thá»ƒ viáº¿t <code>#name</code>, vÃ  <code>quote!</code> sáº½ thay tháº¿ báº±ng giÃ¡ trá»‹ trong biáº¿n <code>name</code>. Báº¡n tháº­m chÃ­ cÃ³ thá»ƒ thá»±c hiá»‡n má»™t sá»‘ láº·p láº¡i tÆ°Æ¡ng tá»± cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a cÃ¡c macro thÃ´ng thÆ°á»ng. Xem <a href="https://docs.rs/quote">tÃ i liá»‡u crate <code>quote</code></a> Ä‘á»ƒ cÃ³ giá»›i thiá»‡u chi tiáº¿t.</p>
<p>ChÃºng ta muá»‘n procedural macro sinh ra triá»ƒn khai trait <code>HelloMacro</code> cho kiá»ƒu mÃ  ngÆ°á»i dÃ¹ng Ä‘Ã£ chÃº thÃ­ch, Ä‘iá»u nÃ y cÃ³ thá»ƒ láº¥y báº±ng cÃ¡ch sá»­ dá»¥ng <code>#name</code>. Triá»ƒn khai trait cÃ³ má»™t hÃ m lÃ  <code>hello_macro</code>, thÃ¢n hÃ m chá»©a chá»©c nÄƒng mÃ  chÃºng ta muá»‘n cung cáº¥p: in ra <code>Hello, Macro! My name is</code> vÃ  sau Ä‘Ã³ lÃ  tÃªn cá»§a kiá»ƒu Ä‘Æ°á»£c chÃº thÃ­ch.</p>
<p>Macro <code>stringify!</code> Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ Ä‘Ã¢y lÃ  built-in trong Rust. NÃ³ nháº­n má»™t biá»ƒu thá»©c Rust, cháº³ng háº¡n nhÆ° <code>1 + 2</code>, vÃ  táº¡i thá»i gian biÃªn dá»‹ch chuyá»ƒn biá»ƒu thá»©c Ä‘Ã³ thÃ nh má»™t literal string, vÃ­ dá»¥ <code>"1 + 2"</code>. Äiá»u nÃ y khÃ¡c vá»›i <code>format!</code> hoáº·c <code>println!</code>, cÃ¡c macro nÃ y sáº½ Ä‘Ã¡nh giÃ¡ biá»ƒu thá»©c rá»“i chuyá»ƒn káº¿t quáº£ thÃ nh má»™t <code>String</code>. CÃ³ kháº£ nÄƒng input <code>#name</code> lÃ  má»™t biá»ƒu thá»©c cáº§n in ra nguyÃªn vÄƒn, vÃ¬ váº­y chÃºng ta dÃ¹ng <code>stringify!</code>. Sá»­ dá»¥ng <code>stringify!</code> cÅ©ng tiáº¿t kiá»‡m má»™t phÃ©p cáº¥p phÃ¡t báº±ng cÃ¡ch chuyá»ƒn <code>#name</code> thÃ nh literal string táº¡i thá»i gian biÃªn dá»‹ch.</p>
<p>á» thá»i Ä‘iá»ƒm nÃ y, <code>cargo build</code> nÃªn hoÃ n táº¥t thÃ nh cÃ´ng cáº£ trong <code>hello_macro</code> vÃ  <code>hello_macro_derive</code>. HÃ£y káº¿t ná»‘i cÃ¡c crate nÃ y vá»›i mÃ£ trong Listing 19-30 Ä‘á»ƒ xem procedural macro hoáº¡t Ä‘á»™ng! Táº¡o má»™t dá»± Ã¡n nhá»‹ phÃ¢n má»›i trong thÆ° má»¥c <em>projects</em> báº±ng lá»‡nh <code>cargo new pancakes</code>. ChÃºng ta cáº§n thÃªm <code>hello_macro</code> vÃ  <code>hello_macro_derive</code> lÃ m dependencies trong <em>Cargo.toml</em> cá»§a crate <code>pancakes</code>. Náº¿u báº¡n xuáº¥t báº£n cÃ¡c phiÃªn báº£n cá»§a <code>hello_macro</code> vÃ  <code>hello_macro_derive</code> lÃªn <a href="https://crates.io/">crates.io</a>, chÃºng sáº½ lÃ  dependencies thÃ´ng thÆ°á»ng; náº¿u khÃ´ng, báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh chÃºng lÃ  dependencies theo <code>path</code> nhÆ° sau:</p>
<pre><code class="language-toml">{{#include ../listings/ch19-advanced-features/no-listing-21-pancakes/pancakes/Cargo.toml:7:9}}
</code></pre>
<p>Äáº·t mÃ£ trong Listing 19-30 vÃ o <em>src/main.rs</em>, vÃ  cháº¡y <code>cargo run</code>: nÃ³ sáº½ in ra <code>Hello, Macro! My name is Pancakes!</code>. Triá»ƒn khai trait <code>HelloMacro</code> tá»« procedural macro Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o mÃ  crate <code>pancakes</code> khÃ´ng cáº§n tá»± triá»ƒn khai; <code>#[derive(HelloMacro)]</code> Ä‘Ã£ thÃªm triá»ƒn khai trait nÃ y.</p>
<p>Tiáº¿p theo, hÃ£y khÃ¡m phÃ¡ cÃ¡ch cÃ¡c loáº¡i procedural macro khÃ¡c khÃ¡c vá»›i custom derive macros.</p>
<h3 id="macros-kiá»ƒu-attribute"><a class="header" href="#macros-kiá»ƒu-attribute">Macros kiá»ƒu Attribute</a></h3>
<p>Macros kiá»ƒu attribute tÆ°Æ¡ng tá»± nhÆ° custom derive macros, nhÆ°ng thay vÃ¬ sinh mÃ£ cho thuá»™c tÃ­nh <code>derive</code>, chÃºng cho phÃ©p báº¡n táº¡o cÃ¡c thuá»™c tÃ­nh má»›i. ChÃºng cÅ©ng linh hoáº¡t hÆ¡n: <code>derive</code> chá»‰ hoáº¡t Ä‘á»™ng cho structs vÃ  enums; cÃ¡c attribute cÃ³ thá»ƒ Ã¡p dá»¥ng cho cÃ¡c item khÃ¡c, cháº³ng háº¡n nhÆ° cÃ¡c hÃ m. DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ sá»­ dá»¥ng macro kiá»ƒu attribute: giáº£ sá»­ báº¡n cÃ³ má»™t attribute tÃªn <code>route</code> Ä‘á»ƒ chÃº thÃ­ch cÃ¡c hÃ m khi sá»­ dá»¥ng má»™t framework á»©ng dá»¥ng web:</p>
<pre><code class="language-rust ignore">#[route(GET, "/")]
fn index() {</code></pre>
<p>Attribute <code>#[route]</code> nÃ y sáº½ Ä‘Æ°á»£c framework Ä‘á»‹nh nghÄ©a nhÆ° má»™t procedural macro. Chá»¯ kÃ½ cá»§a hÃ m Ä‘á»‹nh nghÄ©a macro sáº½ trÃ´ng nhÆ° sau:</p>
<pre><code class="language-rust ignore">#[proc_macro_attribute]
pub fn route(attr: TokenStream, item: TokenStream) -&gt; TokenStream {</code></pre>
<p>á» Ä‘Ã¢y, chÃºng ta cÃ³ hai tham sá»‘ kiá»ƒu <code>TokenStream</code>. Tham sá»‘ Ä‘áº§u tiÃªn dÃ nh cho ná»™i dung cá»§a attribute: pháº§n <code>GET, "/"</code>. Tham sá»‘ thá»© hai lÃ  thÃ¢n cá»§a item mÃ  attribute Ä‘Æ°á»£c gáº¯n vÃ o: trong trÆ°á»ng há»£p nÃ y lÃ  <code>fn index() {}</code> vÃ  pháº§n cÃ²n láº¡i cá»§a thÃ¢n hÃ m.</p>
<p>NgoÃ i ra, macros kiá»ƒu attribute hoáº¡t Ä‘á»™ng giá»‘ng há»‡t nhÆ° custom derive macros: báº¡n táº¡o má»™t crate vá»›i loáº¡i crate <code>proc-macro</code> vÃ  triá»ƒn khai má»™t hÃ m sinh ra mÃ£ báº¡n muá»‘n!</p>
<h3 id="macros-kiá»ƒu-function"><a class="header" href="#macros-kiá»ƒu-function">Macros kiá»ƒu Function</a></h3>
<p>Macros kiá»ƒu function Ä‘á»‹nh nghÄ©a cÃ¡c macro trÃ´ng giá»‘ng nhÆ° lá»i gá»i hÃ m. TÆ°Æ¡ng tá»± nhÆ° cÃ¡c macro <code>macro_rules!</code>, chÃºng linh hoáº¡t hÆ¡n cÃ¡c hÃ m thÃ´ng thÆ°á»ng; vÃ­ dá»¥, chÃºng cÃ³ thá»ƒ nháº­n sá»‘ lÆ°á»£ng Ä‘á»‘i sá»‘ khÃ´ng xÃ¡c Ä‘á»‹nh. Tuy nhiÃªn, cÃ¡c macro <code>macro_rules!</code> chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a báº±ng cÃº phÃ¡p giá»‘ng match mÃ  chÃºng ta Ä‘Ã£ tháº£o luáº­n trong pháº§n <a href="ch19-06-macros.html#declarative-macros-with-macro_rules-for-general-metaprogramming">â€œDeclarative Macros with <code>macro_rules!</code> for General Metaprogrammingâ€</a><!-- ignore --> trÆ°á»›c Ä‘Ã³. CÃ¡c macro kiá»ƒu function nháº­n má»™t tham sá»‘ <code>TokenStream</code> vÃ  Ä‘á»‹nh nghÄ©a cá»§a chÃºng thao tÃ¡c vá»›i <code>TokenStream</code> Ä‘Ã³ báº±ng mÃ£ Rust giá»‘ng nhÆ° hai loáº¡i procedural macro khÃ¡c. Má»™t vÃ­ dá»¥ vá» macro kiá»ƒu function lÃ  macro <code>sql!</code> cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i nhÆ° sau:</p>
<pre><code class="language-rust ignore">let sql = sql!(SELECT * FROM posts WHERE id=1);</code></pre>
<p>Macro nÃ y sáº½ phÃ¢n tÃ­ch cÃ¢u lá»‡nh SQL bÃªn trong nÃ³ vÃ  kiá»ƒm tra xem cÃº phÃ¡p cÃ³ Ä‘Ãºng hay khÃ´ng, Ä‘iá»u nÃ y phá»©c táº¡p hÆ¡n nhiá»u so vá»›i nhá»¯ng gÃ¬ má»™t macro <code>macro_rules!</code> cÃ³ thá»ƒ lÃ m. Macro <code>sql!</code> sáº½ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° sau:</p>
<pre><code class="language-rust ignore">#[proc_macro]
pub fn sql(input: TokenStream) -&gt; TokenStream {</code></pre>
<p>Äá»‹nh nghÄ©a nÃ y tÆ°Æ¡ng tá»± nhÆ° chá»¯ kÃ½ cá»§a macro custom derive: chÃºng ta nháº­n cÃ¡c token bÃªn trong dáº¥u ngoáº·c vÃ  tráº£ vá» mÃ£ mÃ  chÃºng ta muá»‘n sinh ra.</p>
<h2 id="tÃ³m-táº¯t-9"><a class="header" href="#tÃ³m-táº¯t-9">TÃ³m táº¯t</a></h2>
<p>HÃº! BÃ¢y giá» báº¡n Ä‘Ã£ cÃ³ má»™t sá»‘ tÃ­nh nÄƒng Rust trong há»™p cÃ´ng cá»¥ cá»§a mÃ¬nh mÃ  cÃ³ thá»ƒ báº¡n sáº½ khÃ´ng dÃ¹ng thÆ°á»ng xuyÃªn, nhÆ°ng báº¡n sáº½ biáº¿t chÃºng kháº£ dá»¥ng trong nhá»¯ng tÃ¬nh huá»‘ng ráº¥t cá»¥ thá»ƒ. ChÃºng ta Ä‘Ã£ giá»›i thiá»‡u má»™t sá»‘ chá»§ Ä‘á» phá»©c táº¡p Ä‘á»ƒ khi gáº·p chÃºng trong gá»£i Ã½ lá»—i hoáº·c trong mÃ£ cá»§a ngÆ°á»i khÃ¡c, báº¡n sáº½ nháº­n biáº¿t Ä‘Æ°á»£c cÃ¡c khÃ¡i niá»‡m vÃ  cÃº phÃ¡p nÃ y. Sá»­ dá»¥ng chÆ°Æ¡ng nÃ y nhÆ° má»™t tÃ i liá»‡u tham kháº£o Ä‘á»ƒ hÆ°á»›ng dáº«n báº¡n Ä‘áº¿n cÃ¡c giáº£i phÃ¡p.</p>
<p>Tiáº¿p theo, chÃºng ta sáº½ Ä‘Æ°a táº¥t cáº£ nhá»¯ng gÃ¬ Ä‘Ã£ tháº£o luáº­n trong suá»‘t cuá»‘n sÃ¡ch vÃ o thá»±c hÃ nh vÃ  lÃ m thÃªm má»™t dá»± Ã¡n ná»¯a!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dá»±-Ã¡n-cuá»‘i-cÃ¹ng-xÃ¢y-dá»±ng-web-server-Äa-luá»“ng"><a class="header" href="#dá»±-Ã¡n-cuá»‘i-cÃ¹ng-xÃ¢y-dá»±ng-web-server-Äa-luá»“ng">Dá»± Ã¡n cuá»‘i cÃ¹ng: XÃ¢y dá»±ng Web Server Äa Luá»“ng</a></h1>
<p>ChÃºng ta Ä‘Ã£ Ä‘i má»™t cháº·ng Ä‘Æ°á»ng dÃ i, vÃ  giá» Ä‘Ã£ Ä‘áº¿n cuá»‘i cuá»‘n sÃ¡ch. Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ xÃ¢y dá»±ng thÃªm má»™t dá»± Ã¡n ná»¯a cÃ¹ng nhau Ä‘á»ƒ minh há»a má»™t sá»‘ khÃ¡i niá»‡m Ä‘Ã£ há»c trong cÃ¡c chÆ°Æ¡ng cuá»‘i, cÅ©ng nhÆ° Ã´n láº¡i má»™t sá»‘ bÃ i há»c trÆ°á»›c Ä‘Ã³.</p>
<p>Trong dá»± Ã¡n cuá»‘i cÃ¹ng nÃ y, chÃºng ta sáº½ táº¡o má»™t web server tráº£ vá» â€œhelloâ€ vÃ  hiá»ƒn thá»‹ giá»‘ng nhÆ° HÃ¬nh 20-1 trong trÃ¬nh duyá»‡t web.</p>
<p><img src="img/trpl20-01.png" alt="hello from rust" /></p>
<p><span class="caption">HÃ¬nh 20-1: Dá»± Ã¡n chia sáº» cuá»‘i cÃ¹ng cá»§a chÃºng ta</span></p>
<p>Káº¿ hoáº¡ch xÃ¢y dá»±ng web server cá»§a chÃºng ta nhÆ° sau:</p>
<ol>
<li>TÃ¬m hiá»ƒu má»™t chÃºt vá» TCP vÃ  HTTP.</li>
<li>Láº¯ng nghe cÃ¡c káº¿t ná»‘i TCP trÃªn má»™t socket.</li>
<li>PhÃ¢n tÃ­ch má»™t sá»‘ yÃªu cáº§u HTTP.</li>
<li>Táº¡o pháº£n há»“i HTTP Ä‘Ãºng chuáº©n.</li>
<li>Cáº£i thiá»‡n throughput cá»§a server báº±ng má»™t thread pool.</li>
</ol>
<p>TrÆ°á»›c khi báº¯t Ä‘áº§u, chÃºng ta nÃªn nháº¯c má»™t chi tiáº¿t: phÆ°Æ¡ng phÃ¡p chÃºng ta sá»­ dá»¥ng sáº½ khÃ´ng pháº£i lÃ  cÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ xÃ¢y dá»±ng web server vá»›i Rust. ThÃ nh viÃªn cá»™ng Ä‘á»“ng Ä‘Ã£ xuáº¥t báº£n nhiá»u crate sáºµn sÃ ng sáº£n xuáº¥t trÃªn <a href="https://crates.io/">crates.io</a> cung cáº¥p cÃ¡c triá»ƒn khai web server vÃ  thread pool Ä‘áº§y Ä‘á»§ hÆ¡n so vá»›i nhá»¯ng gÃ¬ chÃºng ta sáº½ xÃ¢y dá»±ng. Tuy nhiÃªn, má»¥c tiÃªu cá»§a chÃºng ta trong chÆ°Æ¡ng nÃ y lÃ  Ä‘á»ƒ há»c, khÃ´ng pháº£i chá»n con Ä‘Æ°á»ng dá»… dÃ ng. VÃ¬ Rust lÃ  má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh há»‡ thá»‘ng, chÃºng ta cÃ³ thá»ƒ lá»±a chá»n má»©c Ä‘á»™ trá»«u tÆ°á»£ng mÃ  mÃ¬nh muá»‘n lÃ m viá»‡c vÃ  cÃ³ thá»ƒ Ä‘i xuá»‘ng má»©c tháº¥p hÆ¡n so vá»›i cÃ¡c ngÃ´n ngá»¯ khÃ¡c. Do Ä‘Ã³, chÃºng ta sáº½ viáº¿t server HTTP cÆ¡ báº£n vÃ  thread pool má»™t cÃ¡ch thá»§ cÃ´ng Ä‘á»ƒ báº¡n cÃ³ thá»ƒ há»c cÃ¡c Ã½ tÆ°á»Ÿng vÃ  ká»¹ thuáº­t chung Ä‘áº±ng sau cÃ¡c crate mÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng trong tÆ°Æ¡ng lai.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="xÃ¢y-dá»±ng-web-server-ÄÆ¡n-luá»“ng"><a class="header" href="#xÃ¢y-dá»±ng-web-server-ÄÆ¡n-luá»“ng">XÃ¢y dá»±ng Web Server ÄÆ¡n Luá»“ng</a></h2>
<p>ChÃºng ta sáº½ báº¯t Ä‘áº§u báº±ng viá»‡c táº¡o má»™t web server Ä‘Æ¡n luá»“ng hoáº¡t Ä‘á»™ng. TrÆ°á»›c khi báº¯t Ä‘áº§u, hÃ£y xem qua tá»•ng quan nhanh vá» cÃ¡c giao thá»©c liÃªn quan Ä‘áº¿n viá»‡c xÃ¢y dá»±ng web server. Chi tiáº¿t vá» cÃ¡c giao thá»©c nÃ y vÆ°á»£t ngoÃ i pháº¡m vi cá»§a cuá»‘n sÃ¡ch, nhÆ°ng má»™t cÃ¡i nhÃ¬n tá»•ng quan sáº½ cung cáº¥p thÃ´ng tin cáº§n thiáº¿t.</p>
<p>Hai giao thá»©c chÃ­nh liÃªn quan Ä‘áº¿n web server lÃ  <em>Hypertext Transfer Protocol</em> <em>(HTTP)</em> vÃ  <em>Transmission Control Protocol</em> <em>(TCP)</em>. Cáº£ hai Ä‘á»u lÃ  cÃ¡c giao thá»©c <em>yÃªu cáº§u-pháº£n há»“i</em>, nghÄ©a lÃ  <em>client</em> khá»Ÿi táº¡o yÃªu cáº§u vÃ  <em>server</em> láº¯ng nghe cÃ¡c yÃªu cáº§u vÃ  tráº£ vá» pháº£n há»“i cho client. Ná»™i dung cá»§a cÃ¡c yÃªu cáº§u vÃ  pháº£n há»“i Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi cÃ¡c giao thá»©c nÃ y.</p>
<p>TCP lÃ  giao thá»©c cáº¥p tháº¥p hÆ¡n, mÃ´ táº£ chi tiáº¿t cÃ¡ch thÃ´ng tin di chuyá»ƒn tá»« server nÃ y sang server khÃ¡c nhÆ°ng khÃ´ng xÃ¡c Ä‘á»‹nh thÃ´ng tin Ä‘Ã³ lÃ  gÃ¬. HTTP xÃ¢y dá»±ng trÃªn TCP báº±ng cÃ¡ch xÃ¡c Ä‘á»‹nh ná»™i dung cá»§a cÃ¡c yÃªu cáº§u vÃ  pháº£n há»“i. Vá» máº·t ká»¹ thuáº­t, cÃ³ thá»ƒ sá»­ dá»¥ng HTTP vá»›i cÃ¡c giao thá»©c khÃ¡c, nhÆ°ng trong pháº§n lá»›n cÃ¡c trÆ°á»ng há»£p, HTTP gá»­i dá»¯ liá»‡u qua TCP. ChÃºng ta sáº½ lÃ m viá»‡c vá»›i cÃ¡c byte thÃ´ cá»§a yÃªu cáº§u vÃ  pháº£n há»“i TCP vÃ  HTTP.</p>
<h3 id="láº¯ng-nghe-káº¿t-ná»‘i-tcp"><a class="header" href="#láº¯ng-nghe-káº¿t-ná»‘i-tcp">Láº¯ng nghe Káº¿t ná»‘i TCP</a></h3>
<p>Web server cá»§a chÃºng ta cáº§n láº¯ng nghe káº¿t ná»‘i TCP, Ä‘Ã¢y lÃ  pháº§n Ä‘áº§u tiÃªn chÃºng ta sáº½ thá»±c hiá»‡n. ThÆ° viá»‡n chuáº©n cung cáº¥p module <code>std::net</code> cho phÃ©p chÃºng ta lÃ m Ä‘iá»u nÃ y. HÃ£y táº¡o má»™t dá»± Ã¡n má»›i theo cÃ¡ch thÃ´ng thÆ°á»ng:</p>
<pre><code class="language-console">$ cargo new hello
     Created binary (application) `hello` project
$ cd hello
</code></pre>
<p>BÃ¢y giá», hÃ£y nháº­p mÃ£ trong Listing 20-1 vÃ o <em>src/main.rs</em> Ä‘á»ƒ báº¯t Ä‘áº§u. MÃ£ nÃ y sáº½ láº¯ng nghe táº¡i Ä‘á»‹a chá»‰ cá»¥c bá»™ <code>127.0.0.1:7878</code> cho cÃ¡c luá»“ng TCP Ä‘áº¿n. Khi nháº­n Ä‘Æ°á»£c má»™t luá»“ng Ä‘áº¿n, nÃ³ sáº½ in ra <code>Connection established!</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch20-web-server/listing-20-01/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 20-1: Láº¯ng nghe cÃ¡c luá»“ng Ä‘áº¿n vÃ  in thÃ´ng bÃ¡o khi nháº­n Ä‘Æ°á»£c luá»“ng</span></p>
<p>Sá»­ dá»¥ng <code>TcpListener</code>, chÃºng ta cÃ³ thá»ƒ láº¯ng nghe cÃ¡c káº¿t ná»‘i TCP táº¡i Ä‘á»‹a chá»‰ <code>127.0.0.1:7878</code>. Trong Ä‘á»‹a chá»‰ nÃ y, pháº§n trÆ°á»›c dáº¥u hai cháº¥m lÃ  Ä‘á»‹a chá»‰ IP Ä‘áº¡i diá»‡n cho mÃ¡y tÃ­nh cá»§a báº¡n (Ä‘iá»u nÃ y giá»‘ng nhau trÃªn má»i mÃ¡y vÃ  khÃ´ng Ä‘áº¡i diá»‡n cho mÃ¡y cá»§a tÃ¡c giáº£), vÃ  <code>7878</code> lÃ  cá»•ng. ChÃºng ta chá»n cá»•ng nÃ y vÃ¬ hai lÃ½ do: HTTP thÆ°á»ng khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng trÃªn cá»•ng nÃ y nÃªn server cá»§a chÃºng ta khÃ³ bá»‹ xung Ä‘á»™t vá»›i báº¥t ká»³ web server nÃ o Ä‘ang cháº¡y trÃªn mÃ¡y cá»§a báº¡n, vÃ  7878 gá»£i nhá»› Ä‘áº¿n tá»« <em>rust</em> khi báº¥m trÃªn bÃ n phÃ­m sá»‘ Ä‘iá»‡n thoáº¡i.</p>
<p>HÃ m <code>bind</code> trong trÆ°á»ng há»£p nÃ y hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° hÃ m <code>new</code> vÃ¬ nÃ³ tráº£ vá» má»™t instance <code>TcpListener</code> má»›i. HÃ m Ä‘Æ°á»£c gá»i lÃ  <code>bind</code> vÃ¬ trong máº¡ng, viá»‡c káº¿t ná»‘i Ä‘áº¿n má»™t cá»•ng Ä‘á»ƒ láº¯ng nghe Ä‘Æ°á»£c gá»i lÃ  â€œbinding to a portâ€.</p>
<p>HÃ m <code>bind</code> tráº£ vá» má»™t <code>Result&lt;T, E&gt;</code>, Ä‘iá»u nÃ y cho tháº¥y viá»‡c binding cÃ³ thá»ƒ tháº¥t báº¡i. VÃ­ dá»¥, káº¿t ná»‘i tá»›i cá»•ng 80 yÃªu cáº§u quyá»n quáº£n trá»‹ (ngÆ°á»i dÃ¹ng thÆ°á»ng khÃ´ng cÃ³ quyá»n cÃ³ thá»ƒ láº¯ng nghe cÃ¡c cá»•ng cao hÆ¡n 1023), nÃªn náº¿u thá»­ káº¿t ná»‘i tá»›i cá»•ng 80 mÃ  khÃ´ng cÃ³ quyá»n quáº£n trá»‹, binding sáº½ tháº¥t báº¡i. Binding cÅ©ng sáº½ khÃ´ng thÃ nh cÃ´ng náº¿u cháº¡y hai instance cá»§a chÆ°Æ¡ng trÃ¬nh cÃ¹ng lÃºc trÃªn cÃ¹ng má»™t cá»•ng. VÃ¬ chÃºng ta Ä‘ang viáº¿t má»™t server cÆ¡ báº£n cho má»¥c Ä‘Ã­ch há»c táº­p, chÃºng ta sáº½ khÃ´ng xá»­ lÃ½ nhá»¯ng lá»—i nÃ y; thay vÃ o Ä‘Ã³, sá»­ dá»¥ng <code>unwrap</code> Ä‘á»ƒ dá»«ng chÆ°Æ¡ng trÃ¬nh náº¿u cÃ³ lá»—i xáº£y ra.</p>
<p>PhÆ°Æ¡ng thá»©c <code>incoming</code> trÃªn <code>TcpListener</code> tráº£ vá» má»™t iterator cung cáº¥p má»™t chuá»—i cÃ¡c luá»“ng (cá»¥ thá»ƒ lÃ  cÃ¡c luá»“ng kiá»ƒu <code>TcpStream</code>). Má»™t <em>stream</em> Ä‘áº¡i diá»‡n cho má»™t káº¿t ná»‘i má»Ÿ giá»¯a client vÃ  server. Má»™t <em>connection</em> lÃ  tÃªn gá»i cho toÃ n bá»™ quÃ¡ trÃ¬nh yÃªu cáº§u vÃ  pháº£n há»“i trong Ä‘Ã³ client káº¿t ná»‘i Ä‘áº¿n server, server sinh ra pháº£n há»“i, vÃ  server Ä‘Ã³ng káº¿t ná»‘i. VÃ¬ váº­y, chÃºng ta sáº½ Ä‘á»c tá»« <code>TcpStream</code> Ä‘á»ƒ xem client gá»­i gÃ¬ vÃ  sau Ä‘Ã³ ghi pháº£n há»“i vÃ o luá»“ng Ä‘á»ƒ gá»­i dá»¯ liá»‡u trá»Ÿ láº¡i client. NhÃ¬n chung, vÃ²ng láº·p <code>for</code> nÃ y sáº½ xá»­ lÃ½ tá»«ng káº¿t ná»‘i theo thá»© tá»± vÃ  táº¡o ra má»™t chuá»—i cÃ¡c luá»“ng Ä‘á»ƒ chÃºng ta xá»­ lÃ½.</p>
<p>Hiá»‡n táº¡i, cÃ¡ch xá»­ lÃ½ luá»“ng cá»§a chÃºng ta chá»‰ gá»“m viá»‡c gá»i <code>unwrap</code> Ä‘á»ƒ káº¿t thÃºc chÆ°Æ¡ng trÃ¬nh náº¿u luá»“ng cÃ³ lá»—i; náº¿u khÃ´ng cÃ³ lá»—i, chÆ°Æ¡ng trÃ¬nh sáº½ in ra thÃ´ng bÃ¡o. ChÃºng ta sáº½ thÃªm nhiá»u chá»©c nÄƒng hÆ¡n cho trÆ°á»ng há»£p thÃ nh cÃ´ng trong listing tiáº¿p theo. LÃ½ do cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c lá»—i tá»« phÆ°Æ¡ng thá»©c <code>incoming</code> khi client káº¿t ná»‘i Ä‘áº¿n server lÃ  vÃ¬ chÃºng ta khÃ´ng thá»±c sá»± láº·p qua cÃ¡c káº¿t ná»‘i mÃ  láº·p qua <em>cÃ¡c ná»— lá»±c káº¿t ná»‘i</em>. Káº¿t ná»‘i cÃ³ thá»ƒ khÃ´ng thÃ nh cÃ´ng vÃ¬ nhiá»u lÃ½ do, nhiá»u lÃ½ do phá»¥ thuá»™c vÃ o há»‡ Ä‘iá»u hÃ nh. VÃ­ dá»¥, nhiá»u há»‡ Ä‘iá»u hÃ nh giá»›i háº¡n sá»‘ lÆ°á»£ng káº¿t ná»‘i má»Ÿ Ä‘á»“ng thá»i mÃ  chÃºng cÃ³ thá»ƒ há»— trá»£; cÃ¡c ná»— lá»±c káº¿t ná»‘i má»›i vÆ°á»£t quÃ¡ sá»‘ lÆ°á»£ng Ä‘Ã³ sáº½ gÃ¢y lá»—i cho Ä‘áº¿n khi má»™t sá»‘ káº¿t ná»‘i má»Ÿ Ä‘Æ°á»£c Ä‘Ã³ng.</p>
<p>HÃ£y thá»­ cháº¡y Ä‘oáº¡n mÃ£ nÃ y! Thá»±c thi <code>cargo run</code> trong terminal vÃ  má»Ÿ <em>127.0.0.1:7878</em> trong trÃ¬nh duyá»‡t web. TrÃ¬nh duyá»‡t sáº½ hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i nhÆ° â€œConnection reset,â€ vÃ¬ server hiá»‡n táº¡i chÆ°a gá»­i dá»¯ liá»‡u tráº£ vá». NhÆ°ng khi nhÃ¬n vÃ o terminal, báº¡n sáº½ tháº¥y nhiá»u thÃ´ng bÃ¡o Ä‘Æ°á»£c in ra khi trÃ¬nh duyá»‡t káº¿t ná»‘i tá»›i server!</p>
<pre><code class="language-text">     Running `target/debug/hello`
Connection established!
Connection established!
Connection established!
</code></pre>
<p>ÄÃ´i khi báº¡n sáº½ tháº¥y nhiá»u thÃ´ng bÃ¡o Ä‘Æ°á»£c in ra cho cÃ¹ng má»™t yÃªu cáº§u tá»« trÃ¬nh duyá»‡t; lÃ½ do cÃ³ thá»ƒ lÃ  trÃ¬nh duyá»‡t Ä‘ang gá»­i yÃªu cáº§u cho trang chÃ­nh cÅ©ng nhÆ° cho cÃ¡c tÃ i nguyÃªn khÃ¡c, cháº³ng háº¡n nhÆ° biá»ƒu tÆ°á»£ng <em>favicon.ico</em> xuáº¥t hiá»‡n trong tab trÃ¬nh duyá»‡t.</p>
<p>CÅ©ng cÃ³ thá»ƒ trÃ¬nh duyá»‡t Ä‘ang cá»‘ gáº¯ng káº¿t ná»‘i tá»›i server nhiá»u láº§n vÃ¬ server khÃ´ng pháº£n há»“i dá»¯ liá»‡u. Khi <code>stream</code> ra khá»i pháº¡m vi vÃ  bá»‹ drop á»Ÿ cuá»‘i vÃ²ng láº·p, káº¿t ná»‘i sáº½ Ä‘Æ°á»£c Ä‘Ã³ng theo cÃ¡ch <code>drop</code> Ä‘Æ°á»£c triá»ƒn khai. TrÃ¬nh duyá»‡t Ä‘Ã´i khi xá»­ lÃ½ cÃ¡c káº¿t ná»‘i bá»‹ Ä‘Ã³ng báº±ng cÃ¡ch thá»­ láº¡i, vÃ¬ váº¥n Ä‘á» cÃ³ thá»ƒ chá»‰ lÃ  táº¡m thá»i. Yáº¿u tá»‘ quan trá»ng lÃ  chÃºng ta Ä‘Ã£ thÃ nh cÃ´ng trong viá»‡c láº¥y Ä‘Æ°á»£c handle tá»›i má»™t káº¿t ná»‘i TCP!</p>
<p>HÃ£y nhá»› dá»«ng chÆ°Æ¡ng trÃ¬nh báº±ng cÃ¡ch nháº¥n <span class="keystroke">ctrl-c</span> khi báº¡n hoÃ n táº¥t viá»‡c cháº¡y má»™t phiÃªn báº£n code. Sau Ä‘Ã³ khá»Ÿi Ä‘á»™ng láº¡i chÆ°Æ¡ng trÃ¬nh báº±ng lá»‡nh <code>cargo run</code> sau khi báº¡n thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i Ä‘á»ƒ Ä‘áº£m báº£o báº¡n Ä‘ang cháº¡y phiÃªn báº£n code má»›i nháº¥t.</p>
<h3 id="Äá»c-request"><a class="header" href="#Äá»c-request">Äá»c Request</a></h3>
<p>HÃ£y triá»ƒn khai chá»©c nÄƒng Ä‘á»c request tá»« trÃ¬nh duyá»‡t! Äá»ƒ tÃ¡ch biá»‡t viá»‡c láº¥y káº¿t ná»‘i vÃ  xá»­ lÃ½ káº¿t ná»‘i, chÃºng ta sáº½ táº¡o má»™t hÃ m má»›i Ä‘á»ƒ xá»­ lÃ½ káº¿t ná»‘i. Trong hÃ m <code>handle_connection</code> má»›i nÃ y, chÃºng ta sáº½ Ä‘á»c dá»¯ liá»‡u tá»« TCP stream vÃ  in ra Ä‘á»ƒ cÃ³ thá»ƒ quan sÃ¡t dá»¯ liá»‡u Ä‘Æ°á»£c gá»­i tá»« trÃ¬nh duyá»‡t. Thay Ä‘á»•i code Ä‘á»ƒ trÃ´ng giá»‘ng nhÆ° Listing 20-2.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch20-web-server/listing-20-02/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 20-2: Äá»c tá»« <code>TcpStream</code> vÃ  in dá»¯ liá»‡u ra</span></p>
<p>ChÃºng ta Ä‘Æ°a <code>std::io::prelude</code> vÃ  <code>std::io::BufReader</code> vÃ o pháº¡m vi Ä‘á»ƒ cÃ³ quyá»n truy cáº­p vÃ o cÃ¡c trait vÃ  kiá»ƒu giÃºp Ä‘á»c vÃ  ghi tá»« stream. Trong vÃ²ng láº·p <code>for</code> á»Ÿ hÃ m <code>main</code>, thay vÃ¬ in thÃ´ng bÃ¡o ráº±ng chÃºng ta Ä‘Ã£ nháº­n Ä‘Æ°á»£c káº¿t ná»‘i, giá» chÃºng ta gá»i hÃ m <code>handle_connection</code> má»›i vÃ  truyá»n <code>stream</code> vÃ o.</p>
<p>Trong hÃ m <code>handle_connection</code>, chÃºng ta táº¡o má»™t instance <code>BufReader</code> bao quanh tham chiáº¿u mutable tá»›i <code>stream</code>. <code>BufReader</code> thÃªm bá»™ Ä‘á»‡m báº±ng cÃ¡ch quáº£n lÃ½ cÃ¡c gá»i tá»›i cÃ¡c phÆ°Æ¡ng thá»©c cá»§a trait <code>std::io::Read</code> cho chÃºng ta.</p>
<p>ChÃºng ta táº¡o biáº¿n <code>http_request</code> Ä‘á»ƒ thu tháº­p cÃ¡c dÃ²ng cá»§a request mÃ  trÃ¬nh duyá»‡t gá»­i Ä‘áº¿n server. ChÃºng ta chá»‰ Ä‘á»‹nh ráº±ng muá»‘n thu tháº­p cÃ¡c dÃ²ng nÃ y trong má»™t vector báº±ng cÃ¡ch thÃªm chÃº thÃ­ch kiá»ƒu <code>Vec&lt;_&gt;</code>.</p>
<p><code>BufReader</code> triá»ƒn khai trait <code>std::io::BufRead</code>, trait nÃ y cung cáº¥p phÆ°Æ¡ng thá»©c <code>lines</code>. PhÆ°Æ¡ng thá»©c <code>lines</code> tráº£ vá» má»™t iterator cÃ¡c giÃ¡ trá»‹ <code>Result&lt;String, std::io::Error&gt;</code> báº±ng cÃ¡ch tÃ¡ch luá»“ng dá»¯ liá»‡u má»—i khi gáº·p byte newline. Äá»ƒ láº¥y Ä‘Æ°á»£c tá»«ng <code>String</code>, chÃºng ta dÃ¹ng <code>map</code> vÃ  <code>unwrap</code> má»—i <code>Result</code>. <code>Result</code> cÃ³ thá»ƒ lÃ  lá»—i náº¿u dá»¯ liá»‡u khÃ´ng há»£p lá»‡ UTF-8 hoáº·c cÃ³ váº¥n Ä‘á» khi Ä‘á»c tá»« stream. Trong chÆ°Æ¡ng trÃ¬nh sáº£n xuáº¥t nÃªn xá»­ lÃ½ lá»—i má»™t cÃ¡ch má»m dáº»o hÆ¡n, nhÆ°ng chÃºng ta chá»n dá»«ng chÆ°Æ¡ng trÃ¬nh trong trÆ°á»ng há»£p lá»—i Ä‘á»ƒ Ä‘Æ¡n giáº£n.</p>
<p>TrÃ¬nh duyá»‡t bÃ¡o hiá»‡u káº¿t thÃºc má»™t HTTP request báº±ng viá»‡c gá»­i hai kÃ½ tá»± newline liÃªn tiáº¿p, vÃ¬ váº­y Ä‘á»ƒ láº¥y má»™t request tá»« stream, chÃºng ta láº¥y cÃ¡c dÃ²ng cho tá»›i khi gáº·p má»™t dÃ²ng trá»‘ng. Khi Ä‘Ã£ thu tháº­p xong cÃ¡c dÃ²ng vÃ o vector, chÃºng ta in chÃºng ra sá»­ dá»¥ng Ä‘á»‹nh dáº¡ng debug Ä‘áº¹p Ä‘á»ƒ cÃ³ thá»ƒ xem cÃ¡c lá»‡nh mÃ  trÃ¬nh duyá»‡t gá»­i tá»›i server.</p>
<p>HÃ£y thá»­ cháº¡y code nÃ y! Khá»Ÿi Ä‘á»™ng chÆ°Æ¡ng trÃ¬nh vÃ  thá»±c hiá»‡n má»™t request tá»« trÃ¬nh duyá»‡t láº§n ná»¯a. LÆ°u Ã½ ráº±ng trÃ¬nh duyá»‡t váº«n sáº½ hiá»ƒn thá»‹ trang lá»—i, nhÆ°ng Ä‘áº§u ra cá»§a chÆ°Æ¡ng trÃ¬nh trong terminal sáº½ trÃ´ng giá»‘ng nhÆ° sau:</p>
<pre><code class="language-console">$ cargo run
   Compiling hello v0.1.0 (file:///projects/hello)
    Finished dev [unoptimized + debuginfo] target(s) in 0.42s
     Running `target/debug/hello`
Request: [
    "GET / HTTP/1.1",
    "Host: 127.0.0.1:7878",
    "User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:99.0) Gecko/20100101 Firefox/99.0",
    "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8",
    "Accept-Language: en-US,en;q=0.5",
    "Accept-Encoding: gzip, deflate, br",
    "DNT: 1",
    "Connection: keep-alive",
    "Upgrade-Insecure-Requests: 1",
    "Sec-Fetch-Dest: document",
    "Sec-Fetch-Mode: navigate",
    "Sec-Fetch-Site: none",
    "Sec-Fetch-User: ?1",
    "Cache-Control: max-age=0",
]
</code></pre>
<p>TÃ¹y vÃ o trÃ¬nh duyá»‡t, báº¡n cÃ³ thá»ƒ tháº¥y Ä‘áº§u ra hÆ¡i khÃ¡c nhau. Giá» khi chÃºng ta Ä‘Ã£ in dá»¯ liá»‡u request ra, chÃºng ta cÃ³ thá»ƒ tháº¥y lÃ½ do vÃ¬ sao má»™t request tá»« trÃ¬nh duyá»‡t láº¡i táº¡o ra nhiá»u káº¿t ná»‘i báº±ng cÃ¡ch nhÃ¬n vÃ o Ä‘Æ°á»ng dáº«n sau <code>GET</code> trong dÃ²ng Ä‘áº§u tiÃªn cá»§a request. Náº¿u cÃ¡c káº¿t ná»‘i láº·p láº¡i Ä‘á»u yÃªu cáº§u <code>/*</code>, chÃºng ta biáº¿t trÃ¬nh duyá»‡t Ä‘ang cá»‘ gáº¯ng láº¥y <code>/*</code> nhiá»u láº§n vÃ¬ chÆ°a nháº­n Ä‘Æ°á»£c pháº£n há»“i tá»« chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta.</p>
<p>HÃ£y phÃ¢n tÃ­ch dá»¯ liá»‡u request nÃ y Ä‘á»ƒ hiá»ƒu trÃ¬nh duyá»‡t Ä‘ang yÃªu cáº§u gÃ¬ tá»« chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta.</p>
<h3 id="xem-ká»¹-má»™t-http-request"><a class="header" href="#xem-ká»¹-má»™t-http-request">Xem ká»¹ má»™t HTTP Request</a></h3>
<p>HTTP lÃ  má»™t giao thá»©c dá»±a trÃªn vÄƒn báº£n, vÃ  má»™t request cÃ³ Ä‘á»‹nh dáº¡ng nhÆ° sau:</p>
<pre><code class="language-text">Method Request-URI HTTP-Version CRLF
headers CRLF
message-body
</code></pre>
<p>DÃ²ng Ä‘áº§u tiÃªn lÃ  <em>request line</em> chá»©a thÃ´ng tin vá» yÃªu cáº§u mÃ  client gá»­i tá»›i. Pháº§n Ä‘áº§u cá»§a request line chá»‰ ra <em>method</em> Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng, cháº³ng háº¡n nhÆ° <code>GET</code> hoáº·c <code>POST</code>, mÃ´ táº£ cÃ¡ch client thá»±c hiá»‡n request nÃ y. Client cá»§a chÃºng ta sá»­ dá»¥ng request <code>GET</code>, cÃ³ nghÄ©a lÃ  nÃ³ Ä‘ang yÃªu cáº§u láº¥y thÃ´ng tin.</p>
<p>Pháº§n tiáº¿p theo cá»§a request line lÃ  <code>/*</code>, chá»‰ ra <em>Uniform Resource Identifier</em> <em>(URI)</em> mÃ  client Ä‘ang yÃªu cáº§u: URI gáº§n giá»‘ng, nhÆ°ng khÃ´ng hoÃ n toÃ n giá»‘ng, vá»›i <em>Uniform Resource Locator</em> <em>(URL)</em>. Sá»± khÃ¡c biá»‡t giá»¯a URI vÃ  URL khÃ´ng quan trá»ng trong chÆ°Æ¡ng nÃ y, nhÆ°ng chuáº©n HTTP dÃ¹ng thuáº­t ngá»¯ URI, nÃªn ta cÃ³ thá»ƒ táº¡m thay tháº¿ URL báº±ng URI trong suy nghÄ©.</p>
<p>Pháº§n cuá»‘i cÃ¹ng lÃ  phiÃªn báº£n HTTP mÃ  client Ä‘ang sá»­ dá»¥ng, vÃ  sau Ä‘Ã³ request line káº¿t thÃºc báº±ng <em>CRLF sequence</em>. (CRLF lÃ  viáº¿t táº¯t cá»§a <em>carriage return</em> vÃ  <em>line feed</em>, cÃ¡c thuáº­t ngá»¯ tá»« thá»i mÃ¡y Ä‘Ã¡nh chá»¯!) Chuá»—i CRLF cÅ©ng cÃ³ thá»ƒ viáº¿t lÃ  <code>\r\n</code>, trong Ä‘Ã³ <code>\r</code> lÃ  carriage return vÃ  <code>\n</code> lÃ  line feed. CRLF phÃ¢n tÃ¡ch request line vá»›i pháº§n dá»¯ liá»‡u request cÃ²n láº¡i. Khi in ra, CRLF hiá»ƒn thá»‹ nhÆ° xuá»‘ng dÃ²ng thay vÃ¬ <code>\r\n</code>.</p>
<p>NhÃ¬n vÃ o request line tá»« káº¿t quáº£ chÆ°Æ¡ng trÃ¬nh, ta tháº¥y <code>GET</code> lÃ  method, <code>/*</code> lÃ  request URI, vÃ  <code>HTTP/1.1</code> lÃ  version.</p>
<p>Sau request line, cÃ¡c dÃ²ng cÃ²n láº¡i báº¯t Ä‘áº§u tá»« <code>Host:</code> trá»Ÿ Ä‘i lÃ  cÃ¡c header. CÃ¡c request <code>GET</code> khÃ´ng cÃ³ body.</p>
<p>HÃ£y thá»­ gá»­i request tá»« má»™t trÃ¬nh duyá»‡t khÃ¡c hoáº·c yÃªu cáº§u má»™t Ä‘á»‹a chá»‰ khÃ¡c, vÃ­ dá»¥ <em>127.0.0.1:7878/test</em>, Ä‘á»ƒ tháº¥y dá»¯ liá»‡u request thay Ä‘á»•i nhÆ° tháº¿ nÃ o.</p>
<p>Giá» khi Ä‘Ã£ biáº¿t trÃ¬nh duyá»‡t Ä‘ang yÃªu cáº§u gÃ¬, hÃ£y gá»­i dá»¯ liá»‡u pháº£n há»“i láº¡i!</p>
<h3 id="viáº¿t-response"><a class="header" href="#viáº¿t-response">Viáº¿t Response</a></h3>
<p>ChÃºng ta sáº½ triá»ƒn khai viá»‡c gá»­i dá»¯ liá»‡u pháº£n há»“i cho client. Response cÃ³ Ä‘á»‹nh dáº¡ng nhÆ° sau:</p>
<pre><code class="language-text">HTTP-Version Status-Code Reason-Phrase CRLF
headers CRLF
message-body
</code></pre>
<p>DÃ²ng Ä‘áº§u tiÃªn lÃ  má»™t <em>dÃ²ng tráº¡ng thÃ¡i</em> chá»©a phiÃªn báº£n HTTP Ä‘Æ°á»£c sá»­ dá»¥ng trong
pháº£n há»“i, má»™t mÃ£ tráº¡ng thÃ¡i dáº¡ng sá»‘ tÃ³m táº¯t káº¿t quáº£ cá»§a yÃªu cáº§u, vÃ  má»™t
cá»¥m tá»« lÃ½ do cung cáº¥p mÃ´ táº£ vÄƒn báº£n vá» mÃ£ tráº¡ng thÃ¡i. Sau chuá»—i CRLF lÃ 
cÃ¡c header (náº¿u cÃ³), má»™t chuá»—i CRLF khÃ¡c, vÃ  pháº§n thÃ¢n cá»§a pháº£n há»“i.</p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ vá» pháº£n há»“i sá»­ dá»¥ng HTTP phiÃªn báº£n 1.1, cÃ³ mÃ£ tráº¡ng
thÃ¡i 200, cá»¥m tá»« lÃ½ do OK, khÃ´ng cÃ³ header, vÃ  khÃ´ng cÃ³ thÃ¢n:</p>
<pre><code class="language-text">HTTP/1.1 200 OK\r\n\r\n
</code></pre>
<p>MÃ£ tráº¡ng thÃ¡i 200 lÃ  pháº£n há»“i thÃ nh cÃ´ng chuáº©n. VÄƒn báº£n lÃ  má»™t pháº£n há»“i HTTP
nhá» thÃ nh cÃ´ng. HÃ£y ghi Ä‘iá»u nÃ y vÃ o stream nhÆ° pháº£n há»“i cá»§a chÃºng ta cho
má»™t yÃªu cáº§u thÃ nh cÃ´ng! Tá»« hÃ m <code>handle_connection</code>, xÃ³a <code>println!</code> Ä‘ang
in dá»¯ liá»‡u yÃªu cáº§u vÃ  thay tháº¿ báº±ng mÃ£ trong Listing 20-3.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch20-web-server/listing-20-03/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 20-3: Ghi má»™t pháº£n há»“i HTTP nhá» thÃ nh cÃ´ng vÃ o
stream</span></p>
<p>DÃ²ng má»›i Ä‘áº§u tiÃªn Ä‘á»‹nh nghÄ©a biáº¿n <code>response</code> chá»©a dá»¯ liá»‡u thÃ´ng Ä‘iá»‡p thÃ nh
cÃ´ng. Sau Ä‘Ã³ chÃºng ta gá»i <code>as_bytes</code> trÃªn <code>response</code> Ä‘á»ƒ chuyá»ƒn dá»¯ liá»‡u
chuá»—i thÃ nh bytes. PhÆ°Æ¡ng thá»©c <code>write_all</code> trÃªn <code>stream</code> nháº­n má»™t <code>&amp;[u8]</code>
vÃ  gá»­i trá»±c tiáº¿p cÃ¡c byte Ä‘Ã³ xuá»‘ng káº¿t ná»‘i. VÃ¬ thao tÃ¡c <code>write_all</code> cÃ³ thá»ƒ
tháº¥t báº¡i, chÃºng ta dÃ¹ng <code>unwrap</code> trÃªn káº¿t quáº£ lá»—i nhÆ° trÆ°á»›c. Má»™t láº§n ná»¯a, trong
á»©ng dá»¥ng thá»±c táº¿ báº¡n nÃªn thÃªm xá»­ lÃ½ lá»—i á»Ÿ Ä‘Ã¢y.</p>
<p>Vá»›i nhá»¯ng thay Ä‘á»•i nÃ y, hÃ£y cháº¡y code vÃ  thá»±c hiá»‡n má»™t yÃªu cáº§u. ChÃºng ta
khÃ´ng cÃ²n in dá»¯ liá»‡u ra terminal, nÃªn sáº½ khÃ´ng tháº¥y báº¥t ká»³ output nÃ o ngoÃ i
output tá»« Cargo. Khi báº¡n load <em>127.0.0.1:7878</em> trong trÃ¬nh duyá»‡t web, báº¡n
sáº½ nháº­n Ä‘Æ°á»£c má»™t trang tráº¯ng thay vÃ¬ má»™t lá»—i. Báº¡n vá»«a tá»± tay viáº¿t code Ä‘á»ƒ
nháº­n má»™t yÃªu cáº§u HTTP vÃ  gá»­i má»™t pháº£n há»“i!</p>
<h3 id="tráº£-vá»-html-thá»±c"><a class="header" href="#tráº£-vá»-html-thá»±c">Tráº£ vá» HTML thá»±c</a></h3>
<p>HÃ£y triá»ƒn khai chá»©c nÄƒng Ä‘á»ƒ tráº£ vá» nhiá»u hÆ¡n má»™t trang tráº¯ng. Táº¡o file má»›i
<em>hello.html</em> á»Ÿ thÆ° má»¥c gá»‘c cá»§a dá»± Ã¡n, khÃ´ng pháº£i trong thÆ° má»¥c <em>src</em>. Báº¡n
cÃ³ thá»ƒ nháº­p báº¥t ká»³ HTML nÃ o báº¡n muá»‘n; Listing 20-4 cho tháº¥y má»™t vÃ­ dá»¥
kháº£ thi.</p>
<p><span class="filename">Filename: hello.html</span></p>
<pre><code class="language-html">{{#include ../listings/ch20-web-server/listing-20-05/hello.html}}
</code></pre>
<p><span class="caption">Listing 20-4: Má»™t file HTML máº«u Ä‘á»ƒ tráº£ vá» trong pháº£n há»“i</span></p>
<p>ÄÃ¢y lÃ  má»™t tÃ i liá»‡u HTML5 tá»‘i giáº£n vá»›i má»™t tiÃªu Ä‘á» vÃ  má»™t vÃ i Ä‘oáº¡n vÄƒn báº£n.
Äá»ƒ tráº£ vá» file nÃ y tá»« server khi nháº­n Ä‘Æ°á»£c má»™t yÃªu cáº§u, chÃºng ta sáº½ chá»‰nh
sá»­a <code>handle_connection</code> nhÆ° trong Listing 20-5 Ä‘á»ƒ Ä‘á»c file HTML, thÃªm nÃ³ vÃ o
pháº£n há»“i dÆ°á»›i dáº¡ng pháº§n thÃ¢n, vÃ  gá»­i Ä‘i.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch20-web-server/listing-20-05/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 20-5: Gá»­i ná»™i dung cá»§a <em>hello.html</em> nhÆ° pháº§n
thÃ¢n cá»§a pháº£n há»“i</span></p>
<p>ChÃºng ta Ä‘Ã£ thÃªm <code>fs</code> vÃ o cÃ¢u lá»‡nh <code>use</code> Ä‘á»ƒ Ä‘Æ°a module filesystem cá»§a thÆ° viá»‡n
chuáº©n vÃ o pháº¡m vi sá»­ dá»¥ng. Code Ä‘á»ƒ Ä‘á»c ná»™i dung cá»§a má»™t file thÃ nh má»™t
chuá»—i cÃ³ thá»ƒ sáº½ quen thuá»™c; chÃºng ta Ä‘Ã£ dÃ¹ng nÃ³ á»Ÿ ChÆ°Æ¡ng 12 khi Ä‘á»c
ná»™i dung file cho dá»± Ã¡n I/O trong Listing 12-4.</p>
<p>Tiáº¿p theo, chÃºng ta sá»­ dá»¥ng <code>format!</code> Ä‘á»ƒ thÃªm ná»™i dung file lÃ m pháº§n thÃ¢n cá»§a
pháº£n há»“i thÃ nh cÃ´ng. Äá»ƒ Ä‘áº£m báº£o má»™t pháº£n há»“i HTTP há»£p lá»‡, chÃºng ta thÃªm
header <code>Content-Length</code>, Ä‘Æ°á»£c Ä‘áº·t báº±ng kÃ­ch thÆ°á»›c cá»§a pháº§n thÃ¢n pháº£n há»“i, trong
trÆ°á»ng há»£p nÃ y lÃ  kÃ­ch thÆ°á»›c cá»§a <code>hello.html</code>.</p>
<p>Cháº¡y code nÃ y vá»›i <code>cargo run</code> vÃ  load <em>127.0.0.1:7878</em> trong trÃ¬nh duyá»‡t;
báº¡n sáº½ tháº¥y HTML cá»§a báº¡n Ä‘Æ°á»£c hiá»ƒn thá»‹!</p>
<p>Hiá»‡n táº¡i, chÃºng ta Ä‘ang bá» qua dá»¯ liá»‡u yÃªu cáº§u trong <code>http_request</code> vÃ  chá»‰
gá»­i láº¡i ná»™i dung cá»§a file HTML má»™t cÃ¡ch vÃ´ Ä‘iá»u kiá»‡n. Äiá»u nÃ y cÃ³ nghÄ©a lÃ 
náº¿u báº¡n thá»­ yÃªu cáº§u <em>127.0.0.1:7878/something-else</em> trong trÃ¬nh duyá»‡t, báº¡n
váº«n sáº½ nháº­n Ä‘Æ°á»£c cÃ¹ng pháº£n há»“i HTML nÃ y. Hiá»‡n táº¡i, server cá»§a chÃºng ta ráº¥t
háº¡n cháº¿ vÃ  khÃ´ng thá»±c hiá»‡n nhá»¯ng gÃ¬ háº§u háº¿t cÃ¡c web server lÃ m. ChÃºng ta
muá»‘n tÃ¹y chá»‰nh pháº£n há»“i dá»±a trÃªn yÃªu cáº§u vÃ  chá»‰ gá»­i file HTML cho má»™t yÃªu
cáº§u há»£p lá»‡ tá»›i <em>/</em>.</p>
<h3 id="xÃ¡c-thá»±c-yÃªu-cáº§u-vÃ -pháº£n-há»“i-cÃ³-chá»n-lá»c"><a class="header" href="#xÃ¡c-thá»±c-yÃªu-cáº§u-vÃ -pháº£n-há»“i-cÃ³-chá»n-lá»c">XÃ¡c thá»±c yÃªu cáº§u vÃ  pháº£n há»“i cÃ³ chá»n lá»c</a></h3>
<p>Hiá»‡n táº¡i, web server cá»§a chÃºng ta sáº½ tráº£ vá» HTML trong file báº¥t ká»ƒ client
yÃªu cáº§u gÃ¬. HÃ£y thÃªm chá»©c nÄƒng kiá»ƒm tra ráº±ng trÃ¬nh duyá»‡t Ä‘ang yÃªu cáº§u <em>/</em>
trÆ°á»›c khi tráº£ vá» file HTML vÃ  tráº£ lá»—i náº¿u trÃ¬nh duyá»‡t yÃªu cáº§u báº¥t cá»© thá»© gÃ¬
khÃ¡c. Äá»ƒ lÃ m Ä‘iá»u nÃ y, chÃºng ta cáº§n chá»‰nh sá»­a <code>handle_connection</code>, nhÆ°
trong Listing 20-6. Code má»›i nÃ y kiá»ƒm tra ná»™i dung yÃªu cáº§u nháº­n Ä‘Æ°á»£c vá»›i
cÃ¡i mÃ  chÃºng ta biáº¿t lÃ  má»™t yÃªu cáº§u tá»›i <em>/</em>, vÃ  thÃªm cÃ¡c khá»‘i <code>if</code> vÃ  <code>else</code>
Ä‘á»ƒ xá»­ lÃ½ cÃ¡c yÃªu cáº§u khÃ¡c nhau.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch20-web-server/listing-20-06/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 20-6: Xá»­ lÃ½ cÃ¡c yÃªu cáº§u tá»›i <em>/</em> khÃ¡c vá»›i cÃ¡c
yÃªu cáº§u khÃ¡c</span></p>
<p>ChÃºng ta chá»‰ xem dÃ²ng Ä‘áº§u tiÃªn cá»§a yÃªu cáº§u HTTP, vÃ¬ váº­y thay vÃ¬ Ä‘á»c toÃ n bá»™
yÃªu cáº§u vÃ o má»™t vector, chÃºng ta gá»i <code>next</code> Ä‘á»ƒ láº¥y pháº§n tá»­ Ä‘áº§u tiÃªn tá»« iterator.
<code>unwrap</code> Ä‘áº§u tiÃªn xá»­ lÃ½ <code>Option</code> vÃ  dá»«ng chÆ°Æ¡ng trÃ¬nh náº¿u iterator khÃ´ng cÃ³
pháº§n tá»­ nÃ o. <code>unwrap</code> thá»© hai xá»­ lÃ½ <code>Result</code> vÃ  cÃ³ cÃ¹ng hiá»‡u á»©ng nhÆ° <code>unwrap</code>
trong <code>map</code> Ä‘Æ°á»£c thÃªm á»Ÿ Listing 20-2.</p>
<p>Tiáº¿p theo, chÃºng ta kiá»ƒm tra <code>request_line</code> xem nÃ³ cÃ³ báº±ng dÃ²ng yÃªu cáº§u cá»§a
má»™t GET request tá»›i Ä‘Æ°á»ng dáº«n <em>/</em> hay khÃ´ng. Náº¿u cÃ³, khá»‘i <code>if</code> tráº£ vá»
ná»™i dung file HTML cá»§a chÃºng ta.</p>
<p>Náº¿u <code>request_line</code> <em>khÃ´ng</em> báº±ng GET request tá»›i Ä‘Æ°á»ng dáº«n <em>/</em>, Ä‘iá»u Ä‘Ã³
cÃ³ nghÄ©a lÃ  chÃºng ta nháº­n Ä‘Æ°á»£c má»™t yÃªu cáº§u khÃ¡c. ChÃºng ta sáº½ thÃªm code vÃ o
khá»‘i <code>else</code> trong má»™t lÃºc Ä‘á»ƒ pháº£n há»“i táº¥t cáº£ cÃ¡c yÃªu cáº§u khÃ¡c.</p>
<p>Cháº¡y code nÃ y ngay vÃ  yÃªu cáº§u <em>127.0.0.1:7878</em>; báº¡n sáº½ nháº­n Ä‘Æ°á»£c HTML trong
<em>hello.html</em>. Náº¿u báº¡n thá»±c hiá»‡n báº¥t ká»³ yÃªu cáº§u nÃ o khÃ¡c, cháº³ng háº¡n nhÆ°
<em>127.0.0.1:7878/something-else</em>, báº¡n sáº½ nháº­n Ä‘Æ°á»£c lá»—i káº¿t ná»‘i giá»‘ng nhÆ° khi
cháº¡y code á»Ÿ Listing 20-1 vÃ  Listing 20-2.</p>
<p>BÃ¢y giá» hÃ£y thÃªm code trong Listing 20-7 vÃ o khá»‘i <code>else</code> Ä‘á»ƒ tráº£ vá» pháº£n há»“i
vá»›i mÃ£ tráº¡ng thÃ¡i 404, bÃ¡o hiá»‡u ráº±ng ná»™i dung cho yÃªu cáº§u khÃ´ng tÃ¬m tháº¥y.
ChÃºng ta cÅ©ng sáº½ tráº£ vá» má»™t sá»‘ HTML cho má»™t trang hiá»ƒn thá»‹ trong trÃ¬nh duyá»‡t
Ä‘á»ƒ bÃ¡o pháº£n há»“i tá»›i ngÆ°á»i dÃ¹ng cuá»‘i.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch20-web-server/listing-20-07/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 20-7: Pháº£n há»“i vá»›i mÃ£ tráº¡ng thÃ¡i 404 vÃ  trang
lá»—i náº¿u cÃ³ yÃªu cáº§u khÃ¡c ngoÃ i <em>/</em></span></p>
<p>á» Ä‘Ã¢y, pháº£n há»“i cá»§a chÃºng ta cÃ³ má»™t dÃ²ng tráº¡ng thÃ¡i vá»›i mÃ£ 404 vÃ  cá»¥m tá»« lÃ½
do <code>NOT FOUND</code>. Pháº§n thÃ¢n cá»§a pháº£n há»“i sáº½ lÃ  HTML trong file <em>404.html</em>. Báº¡n
sáº½ cáº§n táº¡o má»™t file <em>404.html</em> bÃªn cáº¡nh <em>hello.html</em> cho trang lá»—i; má»™t láº§n
ná»¯a, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng báº¥t ká»³ HTML nÃ o báº¡n muá»‘n hoáº·c dÃ¹ng vÃ­ dá»¥ HTML trong
Listing 20-8.</p>
<p><span class="filename">Filename: 404.html</span></p>
<pre><code class="language-html">{{#include ../listings/ch20-web-server/listing-20-07/404.html}}
</code></pre>
<p><span class="caption">Listing 20-8: Ná»™i dung máº«u cho trang tráº£ vá» vá»›i
báº¥t ká»³ pháº£n há»“i 404 nÃ o</span></p>
<p>Vá»›i nhá»¯ng thay Ä‘á»•i nÃ y, hÃ£y cháº¡y láº¡i server cá»§a báº¡n. YÃªu cáº§u <em>127.0.0.1:7878</em>
sáº½ tráº£ vá» ná»™i dung cá»§a <em>hello.html</em>, vÃ  báº¥t ká»³ yÃªu cáº§u nÃ o khÃ¡c, nhÆ°
<em>127.0.0.1:7878/foo</em>, sáº½ tráº£ vá» HTML lá»—i tá»« <em>404.html</em>.</p>
<h3 id="má»™t-chÃºt-refactoring"><a class="header" href="#má»™t-chÃºt-refactoring">Má»™t chÃºt refactoring</a></h3>
<p>Hiá»‡n táº¡i, cÃ¡c khá»‘i <code>if</code> vÃ  <code>else</code> cÃ³ nhiá»u Ä‘oáº¡n láº·p láº¡i: cáº£ hai Ä‘á»u Ä‘á»c file
vÃ  ghi ná»™i dung file vÃ o stream. Sá»± khÃ¡c biá»‡t duy nháº¥t lÃ  dÃ²ng tráº¡ng thÃ¡i
vÃ  tÃªn file. HÃ£y lÃ m code ngáº¯n gá»n hÆ¡n báº±ng cÃ¡ch tÃ¡ch nhá»¯ng khÃ¡c biá»‡t Ä‘Ã³
ra cÃ¡c dÃ²ng <code>if</code> vÃ  <code>else</code> riÃªng, gÃ¡n giÃ¡ trá»‹ dÃ²ng tráº¡ng thÃ¡i vÃ  tÃªn file
vÃ o cÃ¡c biáº¿n; sau Ä‘Ã³ chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c biáº¿n nÃ y má»™t cÃ¡ch
vÃ´ Ä‘iá»u kiá»‡n trong code Ä‘á»ƒ Ä‘á»c file vÃ  ghi pháº£n há»“i. Listing 20-9 cho tháº¥y
code káº¿t quáº£ sau khi thay tháº¿ cÃ¡c khá»‘i <code>if</code> vÃ  <code>else</code> lá»›n.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch20-web-server/listing-20-09/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 20-9: Refactoring cÃ¡c khá»‘i <code>if</code> vÃ  <code>else</code> chá»‰
chá»©a code khÃ¡c nhau giá»¯a hai trÆ°á»ng há»£p</span></p>
<p>BÃ¢y giá» cÃ¡c khá»‘i <code>if</code> vÃ  <code>else</code> chá»‰ tráº£ vá» cÃ¡c giÃ¡ trá»‹ thÃ­ch há»£p cho dÃ²ng
tráº¡ng thÃ¡i vÃ  tÃªn file dÆ°á»›i dáº¡ng má»™t tuple; sau Ä‘Ã³ chÃºng ta dÃ¹ng
destructuring Ä‘á»ƒ gÃ¡n hai giÃ¡ trá»‹ nÃ y vÃ o <code>status_line</code> vÃ  <code>filename</code>
sá»­ dá»¥ng pattern trong cÃ¢u lá»‡nh <code>let</code>, nhÆ° Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 18.</p>
<p>Code bá»‹ láº·p trÆ°á»›c Ä‘Ã³ giá» náº±m ngoÃ i cÃ¡c khá»‘i <code>if</code> vÃ  <code>else</code> vÃ  sá»­ dá»¥ng
cÃ¡c biáº¿n <code>status_line</code> vÃ  <code>filename</code>. Äiá»u nÃ y giÃºp dá»… nhÃ¬n tháº¥y sá»± khÃ¡c
biá»‡t giá»¯a hai trÆ°á»ng há»£p, vÃ  cÃ³ nghÄ©a lÃ  chÃºng ta chá»‰ cÃ³ má»™t chá»— Ä‘á»ƒ
cáº­p nháº­t code náº¿u muá»‘n thay Ä‘á»•i cÃ¡ch Ä‘á»c file vÃ  ghi pháº£n há»“i. HÃ nh vi
cá»§a code trong Listing 20-9 sáº½ giá»‘ng vá»›i Listing 20-8.</p>
<p>Tuyá»‡t vá»i! BÃ¢y giá» chÃºng ta cÃ³ má»™t web server Ä‘Æ¡n giáº£n vá»›i khoáº£ng 40 dÃ²ng
code Rust, pháº£n há»“i má»™t yÃªu cáº§u vá»›i má»™t trang ná»™i dung vÃ  pháº£n há»“i táº¥t cáº£
cÃ¡c yÃªu cáº§u khÃ¡c vá»›i pháº£n há»“i 404.</p>
<p>Hiá»‡n táº¡i, server cá»§a chÃºng ta cháº¡y trong má»™t thread duy nháº¥t, nghÄ©a lÃ 
chá»‰ cÃ³ thá»ƒ phá»¥c vá»¥ má»™t yÃªu cáº§u táº¡i má»™t thá»i Ä‘iá»ƒm. HÃ£y xem Ä‘iá»u nÃ y cÃ³ thá»ƒ
gÃ¢y ra váº¥n Ä‘á» nhÆ° tháº¿ nÃ o báº±ng cÃ¡ch mÃ´ phá»ng má»™t sá»‘ yÃªu cáº§u cháº­m. Sau Ä‘Ã³
chÃºng ta sáº½ sá»­a Ä‘á»ƒ server cÃ³ thá»ƒ xá»­ lÃ½ nhiá»u yÃªu cáº§u cÃ¹ng lÃºc.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="biáº¿n-server-cháº¡y-má»™t-luá»“ng-thÃ nh-server-nhiá»u-luá»“ng"><a class="header" href="#biáº¿n-server-cháº¡y-má»™t-luá»“ng-thÃ nh-server-nhiá»u-luá»“ng">Biáº¿n Server Cháº¡y Má»™t Luá»“ng ThÃ nh Server Nhiá»u Luá»“ng</a></h2>
<p>Hiá»‡n táº¡i, server sáº½ xá»­ lÃ½ tá»«ng yÃªu cáº§u theo lÆ°á»£t, nghÄ©a lÃ  nÃ³ sáº½ khÃ´ng xá»­ lÃ½
káº¿t ná»‘i thá»© hai cho Ä‘áº¿n khi yÃªu cáº§u Ä‘áº§u tiÃªn hoÃ n táº¥t. Náº¿u server nháº­n Ä‘Æ°á»£c
ngÃ y cÃ ng nhiá»u yÃªu cáº§u, viá»‡c thá»±c thi tuáº§n tá»± nÃ y sáº½ cÃ ng kÃ©m hiá»‡u quáº£.
Náº¿u server nháº­n Ä‘Æ°á»£c má»™t yÃªu cáº§u máº¥t nhiá»u thá»i gian Ä‘á»ƒ xá»­ lÃ½, cÃ¡c yÃªu cáº§u
sau sáº½ pháº£i chá» cho Ä‘áº¿n khi yÃªu cáº§u lÃ¢u hoÃ n táº¥t, ngay cáº£ khi cÃ¡c yÃªu cáº§u
má»›i cÃ³ thá»ƒ xá»­ lÃ½ nhanh. ChÃºng ta sáº½ cáº§n kháº¯c phá»¥c Ä‘iá»u nÃ y, nhÆ°ng trÆ°á»›c
háº¿t, hÃ£y xem váº¥n Ä‘á» nÃ y trong thá»±c táº¿.</p>
<h3 id="mÃ´-phá»ng-má»™t-yÃªu-cáº§u-cháº­m-trong-cÃ i-Äáº·t-server-hiá»‡n-táº¡i"><a class="header" href="#mÃ´-phá»ng-má»™t-yÃªu-cáº§u-cháº­m-trong-cÃ i-Äáº·t-server-hiá»‡n-táº¡i">MÃ´ phá»ng Má»™t YÃªu Cáº§u Cháº­m Trong CÃ i Äáº·t Server Hiá»‡n Táº¡i</a></h3>
<p>ChÃºng ta sáº½ xem cÃ¡ch má»™t yÃªu cáº§u xá»­ lÃ½ cháº­m cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c yÃªu cáº§u
khÃ¡c gá»­i Ä‘áº¿n server hiá»‡n táº¡i. Listing 20-10 triá»ƒn khai xá»­ lÃ½ yÃªu cáº§u tá»›i
<em>/sleep</em> vá»›i pháº£n há»“i giáº£ láº­p cháº­m, khiáº¿n server ngá»§ 5 giÃ¢y trÆ°á»›c khi
pháº£n há»“i.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch20-web-server/listing-20-10/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 20-10: MÃ´ phá»ng má»™t yÃªu cáº§u cháº­m báº±ng cÃ¡ch
ngá»§ 5 giÃ¢y</span></p>
<p>ChÃºng ta chuyá»ƒn tá»« <code>if</code> sang <code>match</code> vÃ¬ bÃ¢y giá» cÃ³ ba trÆ°á»ng há»£p. ChÃºng ta
cáº§n match rÃµ rÃ ng trÃªn má»™t slice cá»§a <code>request_line</code> Ä‘á»ƒ so khá»›p vá»›i cÃ¡c
giÃ¡ trá»‹ literal cá»§a chuá»—i; <code>match</code> khÃ´ng tá»± Ä‘á»™ng tham chiáº¿u vÃ  giáº£i tham
chiáº¿u nhÆ° phÆ°Æ¡ng thá»©c so sÃ¡nh báº±ng (<code>==</code>) lÃ m.</p>
<p>NhÃ¡nh Ä‘áº§u tiÃªn giá»‘ng nhÆ° khá»‘i <code>if</code> trong Listing 20-9. NhÃ¡nh thá»© hai match
vá»›i yÃªu cáº§u tá»›i <em>/sleep</em>. Khi nháº­n Ä‘Æ°á»£c yÃªu cáº§u Ä‘Ã³, server sáº½ ngá»§ 5 giÃ¢y
trÆ°á»›c khi hiá»ƒn thá»‹ trang HTML thÃ nh cÃ´ng. NhÃ¡nh thá»© ba giá»‘ng nhÆ° khá»‘i <code>else</code>
trong Listing 20-9.</p>
<p>Báº¡n cÃ³ thá»ƒ tháº¥y server cá»§a chÃºng ta cÃ²n ráº¥t thÃ´ sÆ¡: cÃ¡c thÆ° viá»‡n thá»±c táº¿ sáº½
xá»­ lÃ½ nháº­n diá»‡n nhiá»u yÃªu cáº§u má»™t cÃ¡ch Ã­t tá»‘n lá»i hÆ¡n nhiá»u!</p>
<p>Khá»Ÿi Ä‘á»™ng server báº±ng <code>cargo run</code>. Sau Ä‘Ã³ má»Ÿ hai cá»­a sá»• trÃ¬nh duyá»‡t: má»™t cho
<em>http://127.0.0.1:7878/</em> vÃ  má»™t cho <em>http://127.0.0.1:7878/sleep</em>. Náº¿u báº¡n
nháº­p URI <em>/</em> vÃ i láº§n, nhÆ° trÆ°á»›c, báº¡n sáº½ tháº¥y pháº£n há»“i nhanh. NhÆ°ng náº¿u
nháº­p <em>/sleep</em> rá»“i load <em>/</em>, báº¡n sáº½ tháº¥y <em>/</em> pháº£i chá» cho Ä‘áº¿n khi <code>sleep</code>
ngá»§ Ä‘á»§ 5 giÃ¢y má»›i táº£i xong.</p>
<p>CÃ³ nhiá»u ká»¹ thuáº­t Ä‘á»ƒ trÃ¡nh cÃ¡c yÃªu cáº§u bá»‹ káº¹t phÃ­a sau má»™t yÃªu cáº§u cháº­m; ká»¹
thuáº­t chÃºng ta sáº½ triá»ƒn khai lÃ  thread pool.</p>
<h3 id="cáº£i-thiá»‡n-throughput-vá»›i-thread-pool"><a class="header" href="#cáº£i-thiá»‡n-throughput-vá»›i-thread-pool">Cáº£i thiá»‡n Throughput vá»›i Thread Pool</a></h3>
<p>Má»™t <em>thread pool</em> lÃ  má»™t nhÃ³m cÃ¡c thread Ä‘Ã£ Ä‘Æ°á»£c sinh ra, Ä‘ang chá» vÃ  sáºµn sÃ ng
xá»­ lÃ½ má»™t nhiá»‡m vá»¥. Khi chÆ°Æ¡ng trÃ¬nh nháº­n má»™t nhiá»‡m vá»¥ má»›i, nÃ³ sáº½ gÃ¡n má»™t
thread trong pool cho nhiá»‡m vá»¥ Ä‘Ã³, vÃ  thread Ä‘Ã³ sáº½ xá»­ lÃ½ nhiá»‡m vá»¥. CÃ¡c
thread cÃ²n láº¡i trong pool sáº½ sáºµn sÃ ng xá»­ lÃ½ cÃ¡c nhiá»‡m vá»¥ khÃ¡c Ä‘áº¿n trong
khi thread Ä‘áº§u tiÃªn Ä‘ang xá»­ lÃ½. Khi thread Ä‘áº§u tiÃªn hoÃ n táº¥t nhiá»‡m vá»¥ cá»§a
nÃ³, nÃ³ Ä‘Æ°á»£c tráº£ láº¡i pool cá»§a cÃ¡c thread rá»—i, sáºµn sÃ ng xá»­ lÃ½ nhiá»‡m vá»¥ má»›i.
Thread pool cho phÃ©p báº¡n xá»­ lÃ½ cÃ¡c káº¿t ná»‘i Ä‘á»“ng thá»i, tÄƒng throughput cá»§a
server.</p>
<p>ChÃºng ta sáº½ giá»›i háº¡n sá»‘ lÆ°á»£ng thread trong pool á»Ÿ má»™t con sá»‘ nhá» Ä‘á»ƒ báº£o
vá»‡ khá»i cÃ¡c cuá»™c táº¥n cÃ´ng Denial of Service (DoS); náº¿u chÆ°Æ¡ng trÃ¬nh táº¡o má»™t
thread má»›i cho má»—i yÃªu cáº§u khi nÃ³ Ä‘áº¿n, má»™t ngÆ°á»i gá»­i 10 triá»‡u yÃªu cáº§u
tá»›i server cá»§a chÃºng ta cÃ³ thá»ƒ gÃ¢y há»—n loáº¡n báº±ng cÃ¡ch sá»­ dá»¥ng háº¿t táº¥t cáº£
tÃ i nguyÃªn server vÃ  lÃ m táº¯c ngháº½n xá»­ lÃ½ yÃªu cáº§u.</p>
<p>Thay vÃ¬ sinh ra sá»‘ lÆ°á»£ng thread khÃ´ng giá»›i háº¡n, chÃºng ta sáº½ cÃ³ má»™t sá»‘
thread cá»‘ Ä‘á»‹nh chá» trong pool. CÃ¡c yÃªu cáº§u Ä‘áº¿n Ä‘Æ°á»£c gá»­i vÃ o pool Ä‘á»ƒ xá»­ lÃ½.
Pool sáº½ duy trÃ¬ má»™t hÃ ng Ä‘á»£i cÃ¡c yÃªu cáº§u Ä‘áº¿n. Má»—i thread trong pool sáº½ láº¥y
má»™t yÃªu cáº§u tá»« hÃ ng Ä‘á»£i nÃ y, xá»­ lÃ½ yÃªu cáº§u, vÃ  sau Ä‘Ã³ yÃªu cáº§u má»™t yÃªu cáº§u
khÃ¡c tá»« hÃ ng Ä‘á»£i. Vá»›i thiáº¿t káº¿ nÃ y, chÃºng ta cÃ³ thá»ƒ xá»­ lÃ½ Ä‘á»“ng thá»i tá»‘i Ä‘a
<code>N</code> yÃªu cáº§u, trong Ä‘Ã³ <code>N</code> lÃ  sá»‘ lÆ°á»£ng thread. Náº¿u má»—i thread Ä‘ang pháº£n há»“i
má»™t yÃªu cáº§u cháº¡y lÃ¢u, cÃ¡c yÃªu cáº§u tiáº¿p theo váº«n cÃ³ thá»ƒ xáº¿p vÃ o hÃ ng Ä‘á»£i,
nhÆ°ng chÃºng ta Ä‘Ã£ tÄƒng sá»‘ lÆ°á»£ng yÃªu cáº§u cháº¡y lÃ¢u cÃ³ thá»ƒ xá»­ lÃ½ trÆ°á»›c khi
Ä‘áº¡t Ä‘áº¿n Ä‘iá»ƒm Ä‘Ã³.</p>
<p>Ká»¹ thuáº­t nÃ y chá»‰ lÃ  má»™t trong nhiá»u cÃ¡ch Ä‘á»ƒ cáº£i thiá»‡n throughput cá»§a
web server. CÃ¡c lá»±a chá»n khÃ¡c báº¡n cÃ³ thá»ƒ khÃ¡m phÃ¡ lÃ  <em>fork/join model</em>,
<em>mÃ´ hÃ¬nh async I/O Ä‘Æ¡n luá»“ng</em>, hoáº·c <em>mÃ´ hÃ¬nh async I/O Ä‘a luá»“ng</em>. Náº¿u báº¡n
quan tÃ¢m Ä‘áº¿n chá»§ Ä‘á» nÃ y, báº¡n cÃ³ thá»ƒ Ä‘á»c thÃªm vá» cÃ¡c giáº£i phÃ¡p khÃ¡c vÃ  thá»­
triá»ƒn khai; vá»›i má»™t ngÃ´n ngá»¯ má»©c tháº¥p nhÆ° Rust, táº¥t cáº£ cÃ¡c lá»±a chá»n nÃ y
Ä‘á»u kháº£ thi.</p>
<p>TrÆ°á»›c khi báº¯t Ä‘áº§u triá»ƒn khai thread pool, hÃ£y bÃ n vá» cÃ¡ch sá»­ dá»¥ng pool
nÃªn trÃ´ng nhÆ° tháº¿ nÃ o. Khi thiáº¿t káº¿ code, viáº¿t trÆ°á»›c giao diá»‡n client cÃ³
thá»ƒ giÃºp hÆ°á»›ng dáº«n thiáº¿t káº¿. Viáº¿t API cá»§a code sao cho cáº¥u trÃºc phÃ¹ há»£p
vá»›i cÃ¡ch báº¡n muá»‘n gá»i nÃ³; sau Ä‘Ã³ triá»ƒn khai chá»©c nÄƒng bÃªn trong cáº¥u trÃºc
Ä‘Ã³ thay vÃ¬ triá»ƒn khai chá»©c nÄƒng trÆ°á»›c rá»“i má»›i thiáº¿t káº¿ API cÃ´ng khai.</p>
<p>TÆ°Æ¡ng tá»± nhÆ° cÃ¡ch chÃºng ta sá»­ dá»¥ng phÃ¡t triá»ƒn hÆ°á»›ng kiá»ƒm thá»­ (TDD) trong
dá»± Ã¡n á»Ÿ ChÆ°Æ¡ng 12, á»Ÿ Ä‘Ã¢y chÃºng ta sáº½ sá»­ dá»¥ng phÃ¡t triá»ƒn dá»±a trÃªn compiler.
ChÃºng ta sáº½ viáº¿t code gá»i cÃ¡c hÃ m muá»‘n dÃ¹ng, vÃ  sau Ä‘Ã³ xem lá»—i tá»« compiler
Ä‘á»ƒ xÃ¡c Ä‘á»‹nh Ä‘iá»u gÃ¬ cáº§n thay Ä‘á»•i tiáº¿p theo Ä‘á»ƒ code hoáº¡t Ä‘á»™ng. Tuy nhiÃªn,
trÆ°á»›c khi lÃ m Ä‘iá»u Ä‘Ã³, chÃºng ta sáº½ khÃ¡m phÃ¡ ká»¹ thuáº­t mÃ  chÃºng ta sáº½ khÃ´ng
dÃ¹ng lÃ m Ä‘iá»ƒm khá»Ÿi Ä‘áº§u.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="code-structure-if-we-could-spawn-a-thread-for-each-request"></a></p>
<h4 id="sinh-má»™t-thread-cho-má»—i-yÃªu-cáº§u"><a class="header" href="#sinh-má»™t-thread-cho-má»—i-yÃªu-cáº§u">Sinh Má»™t Thread Cho Má»—i YÃªu Cáº§u</a></h4>
<p>TrÆ°á»›c háº¿t, hÃ£y xem code cá»§a chÃºng ta sáº½ trÃ´ng nhÆ° tháº¿ nÃ o náº¿u táº¡o má»™t thread
má»›i cho má»—i káº¿t ná»‘i. NhÆ° Ä‘Ã£ Ä‘á» cáº­p trÆ°á»›c Ä‘Ã³, Ä‘Ã¢y khÃ´ng pháº£i lÃ  káº¿ hoáº¡ch
cuá»‘i cÃ¹ng cá»§a chÃºng ta do cÃ¡c váº¥n Ä‘á» cÃ³ thá»ƒ phÃ¡t sinh tá»« viá»‡c sinh sá»‘ lÆ°á»£ng
thread khÃ´ng giá»›i háº¡n, nhÆ°ng Ä‘Ã¢y lÃ  Ä‘iá»ƒm khá»Ÿi Ä‘áº§u Ä‘á»ƒ cÃ³ má»™t server Ä‘a luá»“ng
hoáº¡t Ä‘á»™ng. Sau Ä‘Ã³ chÃºng ta sáº½ thÃªm thread pool nhÆ° má»™t cáº£i tiáº¿n, vÃ  so sÃ¡nh
hai giáº£i phÃ¡p sáº½ dá»… hÆ¡n. Listing 20-11 cho tháº¥y nhá»¯ng thay Ä‘á»•i cáº§n thá»±c hiá»‡n
trong <code>main</code> Ä‘á»ƒ sinh má»™t thread má»›i xá»­ lÃ½ má»—i stream trong vÃ²ng láº·p <code>for</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch20-web-server/listing-20-11/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 20-11: Sinh má»™t thread má»›i cho má»—i stream</span></p>
<p>NhÆ° báº¡n Ä‘Ã£ há»c trong ChÆ°Æ¡ng 16, <code>thread::spawn</code> sáº½ táº¡o má»™t thread má»›i vÃ 
cháº¡y code trong closure trÃªn thread má»›i Ä‘Ã³. Náº¿u báº¡n cháº¡y code nÃ y vÃ  load
<em>/sleep</em> trong trÃ¬nh duyá»‡t, rá»“i <em>/</em> trong hai tab trÃ¬nh duyá»‡t khÃ¡c, báº¡n sáº½
tháº¥y ráº±ng cÃ¡c yÃªu cáº§u tá»›i <em>/</em> khÃ´ng pháº£i chá» <em>/sleep</em> hoÃ n táº¥t. Tuy nhiÃªn,
nhÆ° Ä‘Ã£ Ä‘á» cáº­p, Ä‘iá»u nÃ y cuá»‘i cÃ¹ng sáº½ lÃ m quÃ¡ táº£i há»‡ thá»‘ng vÃ¬ báº¡n Ä‘ang táº¡o
cÃ¡c thread má»›i mÃ  khÃ´ng giá»›i háº¡n.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="creating-a-similar-interface-for-a-finite-number-of-threads"></a></p>
<h4 id="táº¡o-má»™t-sá»‘-lÆ°á»£ng-thread-háº¡n-cháº¿"><a class="header" href="#táº¡o-má»™t-sá»‘-lÆ°á»£ng-thread-háº¡n-cháº¿">Táº¡o Má»™t Sá»‘ LÆ°á»£ng Thread Háº¡n Cháº¿</a></h4>
<p>ChÃºng ta muá»‘n thread pool hoáº¡t Ä‘á»™ng theo cÃ¡ch tÆ°Æ¡ng tá»± vÃ  quen thuá»™c Ä‘á»ƒ
viá»‡c chuyá»ƒn tá»« threads sang thread pool khÃ´ng yÃªu cáº§u thay Ä‘á»•i lá»›n trong
code sá»­ dá»¥ng API cá»§a chÃºng ta. Listing 20-12 cho tháº¥y giao diá»‡n giáº£ Ä‘á»‹nh
cho struct <code>ThreadPool</code> mÃ  chÃºng ta muá»‘n dÃ¹ng thay vÃ¬ <code>thread::spawn</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch20-web-server/listing-20-12/src/main.rs:here}}</code></pre>
<p><span class="caption">Listing 20-12: Giao diá»‡n <code>ThreadPool</code> lÃ½ tÆ°á»Ÿng cá»§a chÃºng ta</span></p>
<p>ChÃºng ta dÃ¹ng <code>ThreadPool::new</code> Ä‘á»ƒ táº¡o má»™t thread pool má»›i vá»›i sá»‘ lÆ°á»£ng
thread cÃ³ thá»ƒ cáº¥u hÃ¬nh, trong trÆ°á»ng há»£p nÃ y lÃ  bá»‘n. Sau Ä‘Ã³, trong vÃ²ng
láº·p <code>for</code>, <code>pool.execute</code> cÃ³ giao diá»‡n tÆ°Æ¡ng tá»± nhÆ° <code>thread::spawn</code> á»Ÿ chá»—
nÃ³ nháº­n má»™t closure mÃ  pool sáº½ cháº¡y cho má»—i stream. ChÃºng ta cáº§n triá»ƒn khai
<code>pool.execute</code> sao cho nÃ³ nháº­n closure vÃ  giao nÃ³ cho má»™t thread trong pool
Ä‘á»ƒ cháº¡y. Code nÃ y chÆ°a thá»ƒ biÃªn dá»‹ch ngay, nhÆ°ng chÃºng ta sáº½ thá»­ Ä‘á»ƒ compiler
hÆ°á»›ng dáº«n cÃ¡ch sá»­a.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="building-the-threadpool-struct-using-compiler-driven-development"></a></p>
<h4 id="xÃ¢y-dá»±ng-threadpool-sá»­-dá»¥ng-phÃ¡t-triá»ƒn-dá»±a-trÃªn-compiler"><a class="header" href="#xÃ¢y-dá»±ng-threadpool-sá»­-dá»¥ng-phÃ¡t-triá»ƒn-dá»±a-trÃªn-compiler">XÃ¢y dá»±ng <code>ThreadPool</code> Sá»­ Dá»¥ng PhÃ¡t Triá»ƒn Dá»±a TrÃªn Compiler</a></h4>
<p>Thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i trong Listing 20-12 vÃ o <em>src/main.rs</em>, vÃ  sau Ä‘Ã³
sá»­ dá»¥ng cÃ¡c lá»—i tá»« <code>cargo check</code> Ä‘á»ƒ hÆ°á»›ng dáº«n quÃ¡ trÃ¬nh phÃ¡t triá»ƒn. ÄÃ¢y lÃ 
lá»—i Ä‘áº§u tiÃªn mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c:</p>
<pre><code class="language-console">{{#include ../listings/ch20-web-server/listing-20-12/output.txt}}
</code></pre>
<p>Tuyá»‡t vá»i! Lá»—i nÃ y cho chÃºng ta biáº¿t cáº§n cÃ³ má»™t kiá»ƒu hoáº·c module <code>ThreadPool</code>,
vÃ¬ váº­y chÃºng ta sáº½ xÃ¢y dá»±ng má»™t cÃ¡i ngay bÃ¢y giá». Viá»‡c triá»ƒn khai <code>ThreadPool</code>
sáº½ Ä‘á»™c láº­p vá»›i loáº¡i cÃ´ng viá»‡c mÃ  web server cá»§a chÃºng ta Ä‘ang thá»±c hiá»‡n. VÃ¬
váº­y, hÃ£y chuyá»ƒn crate <code>hello</code> tá»« binary crate sang library crate Ä‘á»ƒ chá»©a
viá»‡c triá»ƒn khai <code>ThreadPool</code>. Sau khi chuyá»ƒn sang library crate, chÃºng ta
cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng thÆ° viá»‡n thread pool riÃªng cho báº¥t ká»³ cÃ´ng viá»‡c nÃ o
muá»‘n lÃ m vá»›i thread pool, khÃ´ng chá»‰ giá»›i háº¡n cho viá»‡c phá»¥c vá»¥ cÃ¡c yÃªu cáº§u
web.</p>
<p>Táº¡o má»™t file <em>src/lib.rs</em> chá»©a ná»™i dung sau, Ä‘Ã¢y lÃ  Ä‘á»‹nh nghÄ©a Ä‘Æ¡n giáº£n nháº¥t
cá»§a struct <code>ThreadPool</code> mÃ  chÃºng ta cÃ³ thá»ƒ cÃ³ hiá»‡n táº¡i:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/no-listing-01-define-threadpool-struct/src/lib.rs}}</code></pre>
<p>Sau Ä‘Ã³, chá»‰nh sá»­a file <em>main.rs</em> Ä‘á»ƒ Ä‘Æ°a <code>ThreadPool</code> vÃ o pháº¡m vi sá»­ dá»¥ng tá»«
library crate báº±ng cÃ¡ch thÃªm Ä‘oáº¡n code sau lÃªn Ä‘áº§u <em>src/main.rs</em>:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch20-web-server/no-listing-01-define-threadpool-struct/src/main.rs:here}}</code></pre>
<p>Code nÃ y váº«n chÆ°a hoáº¡t Ä‘á»™ng, nhÆ°ng hÃ£y kiá»ƒm tra láº¡i Ä‘á»ƒ nháº­n lá»—i tiáº¿p theo
mÃ  chÃºng ta cáº§n xá»­ lÃ½:</p>
<pre><code class="language-console">{{#include ../listings/ch20-web-server/no-listing-01-define-threadpool-struct/output.txt}}
</code></pre>
<p>Lá»—i nÃ y cho tháº¥y bÆ°á»›c tiáº¿p theo lÃ  chÃºng ta cáº§n táº¡o má»™t hÃ m liÃªn káº¿t (associated
function) tÃªn lÃ  <code>new</code> cho <code>ThreadPool</code>. ChÃºng ta cÅ©ng biáº¿t ráº±ng <code>new</code> cáº§n
má»™t tham sá»‘ cÃ³ thá»ƒ nháº­n <code>4</code> lÃ m Ä‘á»‘i sá»‘ vÃ  nÃªn tráº£ vá» má»™t instance cá»§a
<code>ThreadPool</code>. HÃ£y triá»ƒn khai hÃ m <code>new</code> Ä‘Æ¡n giáº£n nháº¥t cÃ³ cÃ¡c Ä‘áº·c Ä‘iá»ƒm Ä‘Ã³:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/no-listing-02-impl-threadpool-new/src/lib.rs}}</code></pre>
<p>ChÃºng ta chá»n <code>usize</code> lÃ m kiá»ƒu cá»§a tham sá»‘ <code>size</code>, vÃ¬ má»™t sá»‘ lÆ°á»£ng thread
Ã¢m lÃ  vÃ´ nghÄ©a. ChÃºng ta cÅ©ng biáº¿t ráº±ng chÃºng ta sáº½ dÃ¹ng sá»‘ 4 nÃ y lÃ m sá»‘
lÆ°á»£ng pháº§n tá»­ trong má»™t táº­p há»£p cÃ¡c thread, vÃ  Ä‘Ã³ lÃ  má»¥c Ä‘Ã­ch cá»§a kiá»ƒu
<code>usize</code>, nhÆ° Ä‘Ã£ tháº£o luáº­n trong pháº§n <a href="ch03-02-data-types.html#integer-types">â€œInteger Typesâ€</a><!--
ignore --> cá»§a ChÆ°Æ¡ng 3.</p>
<p>HÃ£y kiá»ƒm tra láº¡i code:</p>
<pre><code class="language-console">{{#include ../listings/ch20-web-server/no-listing-02-impl-threadpool-new/output.txt}}
</code></pre>
<p>BÃ¢y giá» lá»—i xuáº¥t hiá»‡n vÃ¬ chÃºng ta chÆ°a cÃ³ phÆ°Æ¡ng thá»©c <code>execute</code> trÃªn
<code>ThreadPool</code>. HÃ£y nhá»› láº¡i trong pháº§n <a href="ch20-02-multithreaded.html#creating-a-finite-number-of-threads">â€œTáº¡o Má»™t Sá»‘ LÆ°á»£ng Thread Háº¡n Cháº¿â€</a><!-- ignore --> ráº±ng
chÃºng ta quyáº¿t Ä‘á»‹nh thread pool nÃªn cÃ³ giao diá»‡n tÆ°Æ¡ng tá»± <code>thread::spawn</code>.
NgoÃ i ra, chÃºng ta sáº½ triá»ƒn khai hÃ m <code>execute</code> sao cho nÃ³ nháº­n closure Ä‘Æ°á»£c
truyá»n vÃ  giao nÃ³ cho má»™t thread rá»—i trong pool Ä‘á»ƒ cháº¡y.</p>
<p>ChÃºng ta sáº½ Ä‘á»‹nh nghÄ©a phÆ°Æ¡ng thá»©c <code>execute</code> trÃªn <code>ThreadPool</code> Ä‘á»ƒ nháº­n
má»™t closure lÃ m tham sá»‘. HÃ£y nhá»› láº¡i trong pháº§n <a href="ch13-01-closures.html#moving-captured-values-out-of-the-closure-and-the-fn-traits">â€œDi chuyá»ƒn giÃ¡ trá»‹
báº¯t Ä‘Æ°á»£c ra khá»i closure vÃ  cÃ¡c trait <code>Fn</code>â€</a><!-- ignore --> á»Ÿ
ChÆ°Æ¡ng 13 ráº±ng chÃºng ta cÃ³ thá»ƒ nháº­n closures lÃ m tham sá»‘ vá»›i ba trait
khÃ¡c nhau: <code>Fn</code>, <code>FnMut</code>, vÃ  <code>FnOnce</code>. ChÃºng ta cáº§n quyáº¿t Ä‘á»‹nh loáº¡i closure
sáº½ dÃ¹ng á»Ÿ Ä‘Ã¢y. ChÃºng ta biáº¿t ráº±ng cuá»‘i cÃ¹ng sáº½ lÃ m Ä‘iá»u gÃ¬ Ä‘Ã³ tÆ°Æ¡ng tá»±
nhÆ° triá»ƒn khai <code>thread::spawn</code> trong thÆ° viá»‡n chuáº©n, vÃ¬ váº­y cÃ³ thá»ƒ xem
giá»›i háº¡n mÃ  chá»¯ kÃ½ cá»§a <code>thread::spawn</code> Ä‘áº·t trÃªn tham sá»‘ cá»§a nÃ³. TÃ i liá»‡u
cho chÃºng ta tháº¥y nhÆ° sau:</p>
<pre><code class="language-rust ignore">pub fn spawn&lt;F, T&gt;(f: F) -&gt; JoinHandle&lt;T&gt;
    where
        F: FnOnce() -&gt; T,
        F: Send + 'static,
        T: Send + 'static,</code></pre>
<p>Tham sá»‘ kiá»ƒu <code>F</code> lÃ  thá»© chÃºng ta quan tÃ¢m á»Ÿ Ä‘Ã¢y; tham sá»‘ kiá»ƒu <code>T</code> liÃªn quan
Ä‘áº¿n giÃ¡ trá»‹ tráº£ vá», vÃ  chÃºng ta khÃ´ng quan tÃ¢m Ä‘áº¿n Ä‘iá»u Ä‘Ã³. ChÃºng ta cÃ³ thá»ƒ
tháº¥y ráº±ng <code>spawn</code> sá»­ dá»¥ng <code>FnOnce</code> lÃ m trait bound trÃªn <code>F</code>. ÄÃ¢y cÃ³ láº½ lÃ 
cÃ¡i chÃºng ta cÅ©ng muá»‘n, vÃ¬ cuá»‘i cÃ¹ng chÃºng ta sáº½ truyá»n Ä‘á»‘i sá»‘ nháº­n Ä‘Æ°á»£c
trong <code>execute</code> cho <code>spawn</code>. ChÃºng ta cÃ³ thá»ƒ tá»± tin hÆ¡n ráº±ng <code>FnOnce</code> lÃ 
trait cáº§n dÃ¹ng bá»Ÿi vÃ¬ thread cháº¡y má»™t yÃªu cáº§u sáº½ chá»‰ thá»±c thi closure cá»§a
yÃªu cáº§u Ä‘Ã³ má»™t láº§n, phÃ¹ há»£p vá»›i <code>Once</code> trong <code>FnOnce</code>.</p>
<p>Tham sá»‘ kiá»ƒu <code>F</code> cÅ©ng cÃ³ trait bound <code>Send</code> vÃ  lifetime bound <code>'static</code>,
cÃ¡c bound nÃ y há»¯u Ã­ch trong tÃ¬nh huá»‘ng cá»§a chÃºng ta: cáº§n <code>Send</code> Ä‘á»ƒ chuyá»ƒn
closure tá»« thread nÃ y sang thread khÃ¡c vÃ  <code>'static</code> vÃ¬ chÃºng ta khÃ´ng biáº¿t
thread sáº½ máº¥t bao lÃ¢u Ä‘á»ƒ thá»±c thi. HÃ£y táº¡o phÆ°Æ¡ng thá»©c <code>execute</code> trÃªn
<code>ThreadPool</code> nháº­n má»™t tham sá»‘ generic kiá»ƒu <code>F</code> vá»›i cÃ¡c bound nÃ y:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/no-listing-03-define-execute/src/lib.rs:here}}</code></pre>
<p>ChÃºng ta váº«n dÃ¹ng <code>()</code> sau <code>FnOnce</code> vÃ¬ <code>FnOnce</code> nÃ y Ä‘áº¡i diá»‡n cho má»™t closure
khÃ´ng nháº­n tham sá»‘ vÃ  tráº£ vá» kiá»ƒu unit <code>()</code>. Giá»‘ng nhÆ° Ä‘á»‹nh nghÄ©a hÃ m, kiá»ƒu
tráº£ vá» cÃ³ thá»ƒ bá» qua trong chá»¯ kÃ½, nhÆ°ng ngay cáº£ khi khÃ´ng cÃ³ tham sá»‘, chÃºng
ta váº«n cáº§n dáº¥u ngoáº·c Ä‘Æ¡n.</p>
<p>Má»™t láº§n ná»¯a, Ä‘Ã¢y lÃ  triá»ƒn khai Ä‘Æ¡n giáº£n nháº¥t cá»§a phÆ°Æ¡ng thá»©c <code>execute</code>: nÃ³
khÃ´ng lÃ m gÃ¬ cáº£, nhÆ°ng má»¥c tiÃªu hiá»‡n táº¡i chá»‰ lÃ  lÃ m cho code cÃ³ thá»ƒ biÃªn
dá»‹ch. HÃ£y kiá»ƒm tra láº¡i:</p>
<pre><code class="language-console">{{#include ../listings/ch20-web-server/no-listing-03-define-execute/output.txt}}
</code></pre>
<p>NÃ³ biÃªn dá»‹ch Ä‘Æ°á»£c rá»“i! NhÆ°ng lÆ°u Ã½ ráº±ng náº¿u báº¡n thá»­ <code>cargo run</code> vÃ  gá»­i yÃªu cáº§u
trong trÃ¬nh duyá»‡t, báº¡n sáº½ tháº¥y cÃ¡c lá»—i trong trÃ¬nh duyá»‡t nhÆ° Ä‘Ã£ tháº¥y á»Ÿ Ä‘áº§u
chÆ°Æ¡ng. ThÆ° viá»‡n cá»§a chÃºng ta váº«n chÆ°a thá»±c sá»± gá»i closure Ä‘Æ°á»£c truyá»n vÃ o
<code>execute</code>!</p>
<blockquote>
<p>LÆ°u Ã½: Má»™t cÃ¢u nÃ³i báº¡n cÃ³ thá»ƒ nghe vá» cÃ¡c ngÃ´n ngá»¯ vá»›i compiler nghiÃªm ngáº·t,
nhÆ° Haskell vÃ  Rust, lÃ  â€œnáº¿u code biÃªn dá»‹ch Ä‘Æ°á»£c, thÃ¬ nÃ³ cháº¡y Ä‘Æ°á»£c.â€ NhÆ°ng
cÃ¢u nÃ³i nÃ y khÃ´ng hoÃ n toÃ n Ä‘Ãºng. Dá»± Ã¡n cá»§a chÃºng ta biÃªn dá»‹ch Ä‘Æ°á»£c, nhÆ°ng
hoÃ n toÃ n khÃ´ng lÃ m gÃ¬ cáº£! Náº¿u chÃºng ta Ä‘ang xÃ¢y dá»±ng má»™t dá»± Ã¡n thá»±c sá»±,
hoÃ n chá»‰nh, Ä‘Ã¢y sáº½ lÃ  thá»i Ä‘iá»ƒm tá»‘t Ä‘á»ƒ báº¯t Ä‘áº§u viáº¿t unit test Ä‘á»ƒ kiá»ƒm tra
ráº±ng code biÃªn dá»‹ch <em>vÃ </em> cÃ³ hÃ nh vi chÃºng ta mong muá»‘n.</p>
</blockquote>
<h4 id="xÃ¡c-thá»±c-sá»‘-lÆ°á»£ng-thread-trong-new"><a class="header" href="#xÃ¡c-thá»±c-sá»‘-lÆ°á»£ng-thread-trong-new">XÃ¡c thá»±c Sá»‘ LÆ°á»£ng Thread trong <code>new</code></a></h4>
<p>ChÃºng ta chÆ°a lÃ m gÃ¬ vá»›i cÃ¡c tham sá»‘ cá»§a <code>new</code> vÃ  <code>execute</code>. HÃ£y triá»ƒn khai
ná»™i dung cá»§a cÃ¡c hÃ m nÃ y vá»›i hÃ nh vi mÃ  chÃºng ta muá»‘n. Äá»ƒ báº¯t Ä‘áº§u, hÃ£y nghÄ©
vá» <code>new</code>. TrÆ°á»›c Ä‘Ã³, chÃºng ta Ä‘Ã£ chá»n kiá»ƒu unsigned cho tham sá»‘ <code>size</code>,
bá»Ÿi vÃ¬ má»™t pool vá»›i sá»‘ thread Ã¢m lÃ  vÃ´ nghÄ©a. Tuy nhiÃªn, má»™t pool vá»›i sá»‘
thread báº±ng 0 cÅ©ng vÃ´ nghÄ©a, nhÆ°ng zero lÃ  má»™t giÃ¡ trá»‹ <code>usize</code> hoÃ n toÃ n
há»£p lá»‡. ChÃºng ta sáº½ thÃªm code Ä‘á»ƒ kiá»ƒm tra ráº±ng <code>size</code> lá»›n hÆ¡n 0 trÆ°á»›c khi
tráº£ vá» má»™t instance <code>ThreadPool</code> vÃ  lÃ m chÆ°Æ¡ng trÃ¬nh panic náº¿u nháº­n Ä‘Æ°á»£c 0
báº±ng cÃ¡ch sá»­ dá»¥ng macro <code>assert!</code>, nhÆ° minh há»a trong Listing 20-13.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/listing-20-13/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-13: Triá»ƒn khai <code>ThreadPool::new</code> Ä‘á»ƒ panic náº¿u
<code>size</code> báº±ng 0</span></p>
<p>ChÃºng ta cÅ©ng Ä‘Ã£ thÃªm má»™t sá»‘ tÃ i liá»‡u cho <code>ThreadPool</code> báº±ng doc comments.
LÆ°u Ã½ ráº±ng chÃºng ta Ä‘Ã£ tuÃ¢n theo cÃ¡c thá»±c hÃ nh tÃ i liá»‡u tá»‘t báº±ng cÃ¡ch thÃªm
má»™t pháº§n nÃªu ra cÃ¡c tÃ¬nh huá»‘ng mÃ  hÃ m cÃ³ thá»ƒ panic, nhÆ° Ä‘Ã£ tháº£o luáº­n trong
ChÆ°Æ¡ng 14. Thá»­ cháº¡y <code>cargo doc --open</code> vÃ  nháº¥p vÃ o struct <code>ThreadPool</code> Ä‘á»ƒ
xem tÃ i liá»‡u Ä‘Æ°á»£c sinh ra cho <code>new</code> trÃ´ng nhÆ° tháº¿ nÃ o!</p>
<p>Thay vÃ¬ thÃªm macro <code>assert!</code> nhÆ° chÃºng ta Ä‘Ã£ lÃ m á»Ÿ Ä‘Ã¢y, chÃºng ta cÃ³ thá»ƒ
Ä‘á»•i <code>new</code> thÃ nh <code>build</code> vÃ  tráº£ vá» má»™t <code>Result</code> giá»‘ng nhÆ° vá»›i <code>Config::build</code>
trong dá»± Ã¡n I/O á»Ÿ Listing 12-9. NhÆ°ng trong trÆ°á»ng há»£p nÃ y, chÃºng ta quyáº¿t
Ä‘á»‹nh ráº±ng viá»‡c cá»‘ táº¡o má»™t thread pool mÃ  khÃ´ng cÃ³ thread nÃ o nÃªn lÃ  lá»—i
khÃ´ng thá»ƒ khÃ´i phá»¥c. Náº¿u báº¡n cáº£m tháº¥y tham vá»ng, thá»­ viáº¿t má»™t hÃ m tÃªn lÃ 
<code>build</code> vá»›i chá»¯ kÃ½ sau Ä‘á»ƒ so sÃ¡nh vá»›i hÃ m <code>new</code>:</p>
<pre><code class="language-rust ignore">pub fn build(size: usize) -&gt; Result&lt;ThreadPool, PoolCreationError&gt; {</code></pre>
<h4 id="táº¡o-khÃ´ng-gian-lÆ°u-trá»¯-cÃ¡c-thread"><a class="header" href="#táº¡o-khÃ´ng-gian-lÆ°u-trá»¯-cÃ¡c-thread">Táº¡o KhÃ´ng Gian LÆ°u Trá»¯ CÃ¡c Thread</a></h4>
<p>BÃ¢y giá» chÃºng ta Ä‘Ã£ cÃ³ cÃ¡ch Ä‘á»ƒ biáº¿t ráº±ng sá»‘ lÆ°á»£ng thread há»£p lá»‡ Ä‘á»ƒ lÆ°u trong
pool, chÃºng ta cÃ³ thá»ƒ táº¡o cÃ¡c thread Ä‘Ã³ vÃ  lÆ°u chÃºng trong struct <code>ThreadPool</code>
trÆ°á»›c khi tráº£ vá» struct. NhÆ°ng lÃ m tháº¿ nÃ o Ä‘á»ƒ â€œlÆ°uâ€ má»™t thread? HÃ£y cÃ¹ng
nhÃ¬n láº¡i chá»¯ kÃ½ cá»§a <code>thread::spawn</code>:</p>
<pre><code class="language-rust ignore">pub fn spawn&lt;F, T&gt;(f: F) -&gt; JoinHandle&lt;T&gt;
    where
        F: FnOnce() -&gt; T,
        F: Send + 'static,
        T: Send + 'static,</code></pre>
<p>HÃ m <code>spawn</code> tráº£ vá» má»™t <code>JoinHandle&lt;T&gt;</code>, trong Ä‘Ã³ <code>T</code> lÃ  kiá»ƒu mÃ  closure tráº£
vá». HÃ£y thá»­ sá»­ dá»¥ng <code>JoinHandle</code> vÃ  xem Ä‘iá»u gÃ¬ xáº£y ra. Trong trÆ°á»ng há»£p cá»§a
chÃºng ta, cÃ¡c closure Ä‘Æ°á»£c truyá»n vÃ o thread pool sáº½ xá»­ lÃ½ káº¿t ná»‘i vÃ  khÃ´ng
tráº£ vá» gÃ¬, nÃªn <code>T</code> sáº½ lÃ  kiá»ƒu unit <code>()</code>.</p>
<p>Code trong Listing 20-14 sáº½ biÃªn dá»‹ch Ä‘Æ°á»£c nhÆ°ng váº«n chÆ°a táº¡o báº¥t ká»³ thread
nÃ o. ChÃºng ta Ä‘Ã£ thay Ä‘á»•i Ä‘á»‹nh nghÄ©a cá»§a <code>ThreadPool</code> Ä‘á»ƒ giá»¯ má»™t vector cÃ¡c
instance <code>thread::JoinHandle&lt;()&gt;</code>, khá»Ÿi táº¡o vector vá»›i dung lÆ°á»£ng <code>size</code>,
thiáº¿t láº­p má»™t vÃ²ng láº·p <code>for</code> Ä‘á»ƒ cháº¡y code táº¡o cÃ¡c thread, vÃ  tráº£ vá» má»™t
instance <code>ThreadPool</code> chá»©a chÃºng.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore not_desired_behavior">{{#rustdoc_include ../listings/ch20-web-server/listing-20-14/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-14: Táº¡o má»™t vector cho <code>ThreadPool</code> Ä‘á»ƒ giá»¯ cÃ¡c thread</span></p>
<p>ChÃºng ta Ä‘Ã£ Ä‘Æ°a <code>std::thread</code> vÃ o pháº¡m vi sá»­ dá»¥ng trong library crate, vÃ¬
chÃºng ta dÃ¹ng <code>thread::JoinHandle</code> lÃ m kiá»ƒu cá»§a cÃ¡c pháº§n tá»­ trong vector cá»§a
<code>ThreadPool</code>.</p>
<p>Khi nháº­n Ä‘Æ°á»£c má»™t kÃ­ch thÆ°á»›c há»£p lá»‡, <code>ThreadPool</code> cá»§a chÃºng ta táº¡o má»™t
vector má»›i cÃ³ thá»ƒ chá»©a <code>size</code> pháº§n tá»­. HÃ m <code>with_capacity</code> thá»±c hiá»‡n cÃ¹ng
má»™t nhiá»‡m vá»¥ nhÆ° <code>Vec::new</code> nhÆ°ng cÃ³ má»™t khÃ¡c biá»‡t quan trá»ng: nÃ³ cáº¥p phÃ¡t
trÆ°á»›c khÃ´ng gian trong vector. VÃ¬ chÃºng ta biáº¿t cáº§n lÆ°u <code>size</code> pháº§n tá»­
trong vector, viá»‡c cáº¥p phÃ¡t nÃ y trÆ°á»›c giÃºp hiá»‡u quáº£ hÆ¡n má»™t chÃºt so vá»›i
<code>Vec::new</code>, vá»‘n sáº½ tá»± thay Ä‘á»•i kÃ­ch thÆ°á»›c khi cÃ¡c pháº§n tá»­ Ä‘Æ°á»£c chÃ¨n vÃ o.</p>
<p>Khi báº¡n cháº¡y láº¡i <code>cargo check</code>, nÃ³ sáº½ thÃ nh cÃ´ng.</p>
<h4 id="struct-worker-chá»‹u-trÃ¡ch-nhiá»‡m-gá»­i-code-tá»«-threadpool-tá»›i-thread"><a class="header" href="#struct-worker-chá»‹u-trÃ¡ch-nhiá»‡m-gá»­i-code-tá»«-threadpool-tá»›i-thread">Struct <code>Worker</code> Chá»‹u TrÃ¡ch Nhiá»‡m Gá»­i Code tá»« <code>ThreadPool</code> tá»›i Thread</a></h4>
<p>ChÃºng ta Ä‘Ã£ Ä‘á»ƒ láº¡i má»™t comment trong vÃ²ng láº·p <code>for</code> á»Ÿ Listing 20-14 liÃªn
quan Ä‘áº¿n viá»‡c táº¡o cÃ¡c thread. á» Ä‘Ã¢y, chÃºng ta sáº½ xem cÃ¡ch thá»±c sá»± táº¡o thread.
ThÆ° viá»‡n chuáº©n cung cáº¥p <code>thread::spawn</code> nhÆ° má»™t cÃ¡ch Ä‘á»ƒ táº¡o thread, vÃ 
<code>thread::spawn</code> mong muá»‘n nháº­n Ä‘Æ°á»£c má»™t Ä‘oáº¡n code mÃ  thread sáº½ cháº¡y ngay
khi thread Ä‘Æ°á»£c táº¡o. Tuy nhiÃªn, trong trÆ°á»ng há»£p cá»§a chÃºng ta, chÃºng ta muá»‘n
táº¡o cÃ¡c thread vÃ  Ä‘á»ƒ chÃºng <em>chá»</em> code mÃ  chÃºng ta sáº½ gá»­i sau. Viá»‡c triá»ƒn
khai thread trong thÆ° viá»‡n chuáº©n khÃ´ng bao gá»“m cÃ¡ch lÃ m nÃ y; chÃºng ta pháº£i
tá»± triá»ƒn khai.</p>
<p>ChÃºng ta sáº½ triá»ƒn khai hÃ nh vi nÃ y báº±ng cÃ¡ch giá»›i thiá»‡u má»™t cáº¥u trÃºc dá»¯
liá»‡u má»›i giá»¯a <code>ThreadPool</code> vÃ  cÃ¡c thread Ä‘á»ƒ quáº£n lÃ½ hÃ nh vi nÃ y. ChÃºng ta
sáº½ gá»i cáº¥u trÃºc dá»¯ liá»‡u nÃ y lÃ  <em>Worker</em>, má»™t thuáº­t ngá»¯ phá»• biáº¿n trong cÃ¡c
triá»ƒn khai pooling. Worker sáº½ nháº­n code cáº§n cháº¡y vÃ  thá»±c thi code Ä‘Ã³ trÃªn
thread cá»§a chÃ­nh Worker. HÃ£y tÆ°á»Ÿng tÆ°á»£ng nhá»¯ng ngÆ°á»i lÃ m viá»‡c trong báº¿p
táº¡i má»™t nhÃ  hÃ ng: cÃ¡c worker sáº½ chá» cho Ä‘áº¿n khi cÃ³ Ä‘Æ¡n hÃ ng tá»« khÃ¡ch, rá»“i
chá»‹u trÃ¡ch nhiá»‡m nháº­n Ä‘Æ¡n vÃ  thá»±c hiá»‡n nÃ³.</p>
<p>Thay vÃ¬ lÆ°u má»™t vector cÃ¡c instance <code>JoinHandle&lt;()&gt;</code> trong thread pool, chÃºng
ta sáº½ lÆ°u cÃ¡c instance cá»§a struct <code>Worker</code>. Má»—i <code>Worker</code> sáº½ lÆ°u má»™t instance
<code>JoinHandle&lt;()&gt;</code>. Sau Ä‘Ã³, chÃºng ta sáº½ triá»ƒn khai má»™t phÆ°Æ¡ng thá»©c trÃªn <code>Worker</code>
nháº­n má»™t closure Ä‘á»ƒ cháº¡y vÃ  gá»­i nÃ³ Ä‘áº¿n thread Ä‘ang cháº¡y Ä‘á»ƒ thá»±c thi. ChÃºng
ta cÅ©ng sáº½ cáº¥p cho má»—i worker má»™t <code>id</code> Ä‘á»ƒ phÃ¢n biá»‡t cÃ¡c worker khÃ¡c nhau
trong pool khi ghi log hoáº·c gá»¡ lá»—i.</p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  quy trÃ¬nh má»›i xáº£y ra khi táº¡o má»™t <code>ThreadPool</code>. ChÃºng ta sáº½
triá»ƒn khai code gá»­i closure tá»›i thread sau khi Ä‘Ã£ thiáº¿t láº­p <code>Worker</code> nhÆ°
sau:</p>
<ol>
<li>Äá»‹nh nghÄ©a má»™t struct <code>Worker</code> giá»¯ <code>id</code> vÃ  <code>JoinHandle&lt;()&gt;</code>.</li>
<li>Thay Ä‘á»•i <code>ThreadPool</code> Ä‘á»ƒ giá»¯ má»™t vector cÃ¡c instance <code>Worker</code>.</li>
<li>Äá»‹nh nghÄ©a hÃ m <code>Worker::new</code> nháº­n má»™t sá»‘ <code>id</code> vÃ  tráº£ vá» má»™t instance
<code>Worker</code> chá»©a <code>id</code> vÃ  má»™t thread Ä‘Æ°á»£c spawn vá»›i má»™t closure rá»—ng.</li>
<li>Trong <code>ThreadPool::new</code>, dÃ¹ng bá»™ Ä‘áº¿m vÃ²ng láº·p <code>for</code> Ä‘á»ƒ táº¡o <code>id</code>, táº¡o
má»™t <code>Worker</code> má»›i vá»›i <code>id</code> Ä‘Ã³, vÃ  lÆ°u worker vÃ o vector.</li>
</ol>
<p>Náº¿u báº¡n muá»‘n thá»­ thÃ¡ch, hÃ£y triá»ƒn khai nhá»¯ng thay Ä‘á»•i nÃ y trÆ°á»›c khi xem
code trong Listing 20-15.</p>
<p>Sáºµn sÃ ng chÆ°a? ÄÃ¢y lÃ  Listing 20-15 vá»›i má»™t cÃ¡ch Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c sá»­a Ä‘á»•i
nÃªu trÃªn.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/listing-20-15/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-15: Sá»­a Ä‘á»•i <code>ThreadPool</code> Ä‘á»ƒ giá»¯ cÃ¡c instance <code>Worker</code> thay vÃ¬ giá»¯ trá»±c tiáº¿p cÃ¡c thread</span></p>
<p>ChÃºng ta Ä‘Ã£ Ä‘á»•i tÃªn trÆ°á»ng trong <code>ThreadPool</code> tá»« <code>threads</code> thÃ nh <code>workers</code>
vÃ¬ bÃ¢y giá» nÃ³ giá»¯ cÃ¡c instance <code>Worker</code> thay vÃ¬ cÃ¡c instance <code>JoinHandle&lt;()&gt;</code>.
ChÃºng ta dÃ¹ng bá»™ Ä‘áº¿m trong vÃ²ng láº·p <code>for</code> lÃ m Ä‘á»‘i sá»‘ cho <code>Worker::new</code>, vÃ 
lÆ°u tá»«ng <code>Worker</code> má»›i vÃ o vector cÃ³ tÃªn <code>workers</code>.</p>
<p>Code bÃªn ngoÃ i (nhÆ° server cá»§a chÃºng ta trong <em>src/main.rs</em>) khÃ´ng cáº§n
biáº¿t chi tiáº¿t triá»ƒn khai vá» viá»‡c sá»­ dá»¥ng struct <code>Worker</code> trong <code>ThreadPool</code>,
vÃ¬ váº­y chÃºng ta lÃ m struct <code>Worker</code> vÃ  hÃ m <code>new</code> cá»§a nÃ³ lÃ  private. HÃ m
<code>Worker::new</code> dÃ¹ng <code>id</code> Ä‘Æ°á»£c truyá»n vÃ o vÃ  lÆ°u má»™t instance <code>JoinHandle&lt;()&gt;</code>
Ä‘Æ°á»£c táº¡o ra báº±ng cÃ¡ch spawn má»™t thread má»›i vá»›i closure rá»—ng.</p>
<blockquote>
<p>LÆ°u Ã½: Náº¿u há»‡ Ä‘iá»u hÃ nh khÃ´ng thá»ƒ táº¡o thread vÃ¬ khÃ´ng Ä‘á»§ tÃ i nguyÃªn há»‡
thá»‘ng, <code>thread::spawn</code> sáº½ panic. Äiá»u nÃ y sáº½ khiáº¿n toÃ n bá»™ server cá»§a
chÃºng ta panic, máº·c dÃ¹ má»™t sá»‘ thread cÃ³ thá»ƒ táº¡o thÃ nh cÃ´ng. VÃ¬ Ä‘Æ¡n giáº£n,
hÃ nh vi nÃ y lÃ  á»•n, nhÆ°ng trong triá»ƒn khai thread pool thá»±c táº¿, báº¡n cÃ³ thá»ƒ
muá»‘n dÃ¹ng <a href="../std/thread/struct.Builder.html"><code>std::thread::Builder</code></a><!-- ignore --> vÃ  phÆ°Æ¡ng thá»©c
<a href="../std/thread/struct.Builder.html#method.spawn"><code>spawn</code></a><!-- ignore --> cá»§a nÃ³, tráº£ vá» <code>Result</code> thay vÃ¬ panic.</p>
</blockquote>
<p>Code nÃ y sáº½ biÃªn dá»‹ch vÃ  lÆ°u sá»‘ lÆ°á»£ng instance <code>Worker</code> mÃ  chÃºng ta chá»‰ Ä‘á»‹nh
lÃ m Ä‘á»‘i sá»‘ cho <code>ThreadPool::new</code>. NhÆ°ng chÃºng ta váº«n <em>chÆ°a</em> xá»­ lÃ½ closure
mÃ  ta nháº­n Ä‘Æ°á»£c trong <code>execute</code>. HÃ£y xem cÃ¡ch lÃ m tiáº¿p theo.</p>
<h4 id="gá»­i-yÃªu-cáº§u-tá»›i-thread-thÃ´ng-qua-channels"><a class="header" href="#gá»­i-yÃªu-cáº§u-tá»›i-thread-thÃ´ng-qua-channels">Gá»­i YÃªu Cáº§u tá»›i Thread thÃ´ng qua Channels</a></h4>
<p>Váº¥n Ä‘á» tiáº¿p theo lÃ  cÃ¡c closure Ä‘Æ°á»£c truyá»n cho <code>thread::spawn</code> hiá»‡n khÃ´ng
lÃ m gÃ¬ cáº£. Hiá»‡n táº¡i, chÃºng ta nháº­n closure muá»‘n thá»±c thi trong phÆ°Æ¡ng thá»©c
<code>execute</code>. NhÆ°ng chÃºng ta cáº§n truyá»n má»™t closure cho <code>thread::spawn</code> khi
táº¡o má»—i <code>Worker</code> trong quÃ¡ trÃ¬nh táº¡o <code>ThreadPool</code>.</p>
<p>ChÃºng ta muá»‘n cÃ¡c struct <code>Worker</code> vá»«a táº¡o láº¥y code Ä‘á»ƒ cháº¡y tá»« má»™t queue
Ä‘Æ°á»£c giá»¯ trong <code>ThreadPool</code> vÃ  gá»­i code Ä‘Ã³ tá»›i thread cá»§a nÃ³ Ä‘á»ƒ thá»±c thi.</p>
<p>CÃ¡c channel mÃ  chÃºng ta Ä‘Ã£ há»c trong ChÆ°Æ¡ng 16 â€” má»™t cÃ¡ch Ä‘Æ¡n giáº£n Ä‘á»ƒ
giao tiáº¿p giá»¯a hai thread â€” sáº½ hoÃ n háº£o cho trÆ°á»ng há»£p nÃ y. ChÃºng ta sáº½
dÃ¹ng má»™t channel lÃ m queue cÃ¡c job, vÃ  <code>execute</code> sáº½ gá»­i má»™t job tá»«
<code>ThreadPool</code> tá»›i cÃ¡c instance <code>Worker</code>, vÃ  <code>Worker</code> sáº½ gá»­i job tá»›i thread
cá»§a nÃ³. Káº¿ hoáº¡ch nhÆ° sau:</p>
<ol>
<li><code>ThreadPool</code> sáº½ táº¡o má»™t channel vÃ  giá»¯ sender.</li>
<li>Má»—i <code>Worker</code> sáº½ giá»¯ receiver.</li>
<li>ChÃºng ta sáº½ táº¡o má»™t struct <code>Job</code> má»›i Ä‘á»ƒ giá»¯ cÃ¡c closure mÃ  muá»‘n gá»­i qua channel.</li>
<li>PhÆ°Æ¡ng thá»©c <code>execute</code> sáº½ gá»­i job mÃ  nÃ³ muá»‘n thá»±c thi qua sender.</li>
<li>Trong thread cá»§a nÃ³, <code>Worker</code> sáº½ láº·p qua receiver vÃ  thá»±c thi cÃ¡c closure
cá»§a báº¥t ká»³ job nÃ o nÃ³ nháº­n Ä‘Æ°á»£c.</li>
</ol>
<p>HÃ£y báº¯t Ä‘áº§u báº±ng viá»‡c táº¡o má»™t channel trong <code>ThreadPool::new</code> vÃ  giá»¯ sender
trong instance <code>ThreadPool</code>, nhÆ° minh há»a trong Listing 20-16. Struct <code>Job</code>
hiá»‡n táº¡i chÆ°a giá»¯ gÃ¬ nhÆ°ng sáº½ lÃ  kiá»ƒu cá»§a item mÃ  chÃºng ta gá»­i qua channel.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/listing-20-16/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-16: Sá»­a Ä‘á»•i <code>ThreadPool</code> Ä‘á»ƒ lÆ°u sender cá»§a má»™t channel truyá»n cÃ¡c instance <code>Job</code></span></p>
<p>Trong <code>ThreadPool::new</code>, chÃºng ta táº¡o channel má»›i vÃ  cho pool giá»¯ sender. Äiá»u
nÃ y sáº½ biÃªn dá»‹ch thÃ nh cÃ´ng.</p>
<p>HÃ£y thá»­ truyá»n receiver cá»§a channel vÃ o tá»«ng worker khi thread pool táº¡o
channel. ChÃºng ta biáº¿t ráº±ng muá»‘n sá»­ dá»¥ng receiver trong thread mÃ  worker
spawn, vÃ¬ váº­y sáº½ tham chiáº¿u tá»›i tham sá»‘ <code>receiver</code> trong closure. Code trong
Listing 20-17 váº«n chÆ°a thá»ƒ biÃªn dá»‹ch hoÃ n chá»‰nh.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch20-web-server/listing-20-17/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-17: Truyá»n receiver tá»›i cÃ¡c worker</span></p>
<p>ChÃºng ta Ä‘Ã£ thá»±c hiá»‡n má»™t sá»‘ thay Ä‘á»•i nhá» vÃ  Ä‘Æ¡n giáº£n: truyá»n receiver vÃ o
<code>Worker::new</code>, rá»“i sá»­ dá»¥ng nÃ³ bÃªn trong closure.</p>
<p>Khi thá»­ kiá»ƒm tra code nÃ y, chÃºng ta nháº­n Ä‘Æ°á»£c lá»—i sau:</p>
<pre><code class="language-console">{{#include ../listings/ch20-web-server/listing-20-17/output.txt}}
</code></pre>
<p>Code Ä‘ang cá»‘ gáº¯ng truyá»n <code>receiver</code> tá»›i nhiá»u instance <code>Worker</code>. Äiá»u nÃ y sáº½
khÃ´ng hoáº¡t Ä‘á»™ng, nhÆ° báº¡n Ä‘Ã£ há»c trong ChÆ°Æ¡ng 16: triá»ƒn khai channel mÃ  Rust
cung cáº¥p lÃ  <em>nhiá»u producer</em>, má»™t <em>consumer</em>. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng ta
khÃ´ng thá»ƒ chá»‰ clone Ä‘áº§u nháº­n cá»§a channel Ä‘á»ƒ sá»­a code nÃ y. ChÃºng ta cÅ©ng khÃ´ng
muá»‘n gá»­i má»™t message nhiá»u láº§n tá»›i nhiá»u consumer; chÃºng ta muá»‘n má»™t danh
sÃ¡ch message vá»›i nhiá»u worker sao cho má»—i message chá»‰ Ä‘Æ°á»£c xá»­ lÃ½ má»™t láº§n.</p>
<p>NgoÃ i ra, viá»‡c láº¥y má»™t job ra khá»i queue cá»§a channel liÃªn quan tá»›i viá»‡c
biáº¿n Ä‘á»•i <code>receiver</code>, vÃ¬ váº­y cÃ¡c thread cáº§n má»™t cÃ¡ch an toÃ n Ä‘á»ƒ chia sáº» vÃ 
sá»­a Ä‘á»•i <code>receiver</code>; náº¿u khÃ´ng, chÃºng ta cÃ³ thá»ƒ gáº·p cÃ¡c race condition (nhÆ°
Ä‘Ã£ Ä‘á» cáº­p trong ChÆ°Æ¡ng 16).</p>
<p>HÃ£y nhá»› láº¡i cÃ¡c smart pointer an toÃ n vá»›i thread Ä‘Æ°á»£c tháº£o luáº­n trong ChÆ°Æ¡ng
16: Ä‘á»ƒ chia sáº» quyá»n sá»Ÿ há»¯u giá»¯a nhiá»u thread vÃ  cho phÃ©p cÃ¡c thread thay
Ä‘á»•i giÃ¡ trá»‹, chÃºng ta cáº§n dÃ¹ng <code>Arc&lt;Mutex&lt;T&gt;&gt;</code>. Kiá»ƒu <code>Arc</code> cho phÃ©p nhiá»u
worker sá»Ÿ há»¯u receiver, vÃ  <code>Mutex</code> Ä‘áº£m báº£o ráº±ng chá»‰ cÃ³ má»™t worker láº¥y job
tá»« receiver táº¡i má»™t thá»i Ä‘iá»ƒm. Listing 20-18 trÃ¬nh bÃ y cÃ¡c thay Ä‘á»•i cáº§n thá»±c
hiá»‡n.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/listing-20-18/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-18: Chia sáº» receiver giá»¯a cÃ¡c worker sá»­ dá»¥ng <code>Arc</code> vÃ  <code>Mutex</code></span></p>
<p>Trong <code>ThreadPool::new</code>, chÃºng ta Ä‘áº·t receiver vÃ o trong má»™t <code>Arc</code> vÃ  má»™t <code>Mutex</code>.
Vá»›i má»—i worker má»›i, chÃºng ta clone <code>Arc</code> Ä‘á»ƒ tÄƒng reference count, cho phÃ©p cÃ¡c
worker cÃ¹ng sá»Ÿ há»¯u receiver.</p>
<p>Vá»›i nhá»¯ng thay Ä‘á»•i nÃ y, code Ä‘Ã£ biÃªn dá»‹ch Ä‘Æ°á»£c! ChÃºng ta Ä‘ang tiáº¿n gáº§n tá»›i má»¥c tiÃªu!</p>
<h4 id="triá»ƒn-khai-phÆ°Æ¡ng-thá»©c-execute"><a class="header" href="#triá»ƒn-khai-phÆ°Æ¡ng-thá»©c-execute">Triá»ƒn khai phÆ°Æ¡ng thá»©c <code>execute</code></a></h4>
<p>Cuá»‘i cÃ¹ng, hÃ£y triá»ƒn khai phÆ°Æ¡ng thá»©c <code>execute</code> trÃªn <code>ThreadPool</code>. ChÃºng ta cÅ©ng
sáº½ thay <code>Job</code> tá»« má»™t struct sang type alias cho má»™t trait object, chá»©a kiá»ƒu closure
mÃ  <code>execute</code> nháº­n vÃ o. NhÆ° Ä‘Ã£ tháº£o luáº­n trong pháº§n <a href="ch19-04-advanced-types.html#creating-type-synonyms-with-type-aliases">â€œCreating Type Synonyms with Type Aliasesâ€</a><!-- ignore -->
trong ChÆ°Æ¡ng 19, type alias giÃºp chÃºng ta rÃºt gá»n cÃ¡c kiá»ƒu dÃ i Ä‘á»ƒ tiá»‡n sá»­ dá»¥ng.
Xem vÃ­ dá»¥ trong Listing 20-19.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/listing-20-19/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-19: Táº¡o type alias <code>Job</code> cho má»™t <code>Box</code> giá»¯ tá»«ng closure vÃ  gá»­i job xuá»‘ng channel</span></p>
<p>Sau khi táº¡o má»™t instance <code>Job</code> má»›i sá»­ dá»¥ng closure nháº­n Ä‘Æ°á»£c trong <code>execute</code>,
chÃºng ta gá»­i job Ä‘Ã³ xuá»‘ng Ä‘áº§u gá»­i (sending end) cá»§a channel. ChÃºng ta gá»i
<code>unwrap</code> trÃªn <code>send</code> trong trÆ°á»ng há»£p gá»­i tháº¥t báº¡i. Äiá»u nÃ y cÃ³ thá»ƒ xáº£y ra
náº¿u, vÃ­ dá»¥, chÃºng ta dá»«ng táº¥t cáº£ cÃ¡c thread, nghÄ©a lÃ  Ä‘áº§u nháº­n (receiving end)
khÃ´ng cÃ²n nháº­n message má»›i. Hiá»‡n táº¡i, chÃºng ta khÃ´ng thá»ƒ dá»«ng cÃ¡c thread:
cÃ¡c thread sáº½ tiáº¿p tá»¥c thá»±c thi miá»…n lÃ  pool tá»“n táº¡i. LÃ½ do chÃºng ta dÃ¹ng
<code>unwrap</code> lÃ  vÃ¬ biáº¿t trÆ°á»ng há»£p tháº¥t báº¡i sáº½ khÃ´ng xáº£y ra, nhÆ°ng compiler khÃ´ng biáº¿t Ä‘iá»u Ä‘Ã³.</p>
<p>NhÆ°ng chÃºng ta váº«n chÆ°a hoÃ n táº¥t! Trong worker, closure Ä‘Æ°á»£c truyá»n cho
<code>thread::spawn</code> hiá»‡n táº¡i váº«n chá»‰ <em>tham chiáº¿u</em> Ä‘áº¿n Ä‘áº§u nháº­n cá»§a channel.
Thay vÃ o Ä‘Ã³, chÃºng ta cáº§n closure láº·p vÃ´ háº¡n, há»i Ä‘áº§u nháº­n cá»§a channel vá»
má»™t job vÃ  cháº¡y job khi nháº­n Ä‘Æ°á»£c. HÃ£y thá»±c hiá»‡n thay Ä‘á»•i nhÆ° trong Listing 20-20
trong <code>Worker::new</code>.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/listing-20-20/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-20: Nháº­n vÃ  thá»±c thi cÃ¡c job trong thread cá»§a worker</span></p>
<p>á» Ä‘Ã¢y, trÆ°á»›c tiÃªn chÃºng ta gá»i <code>lock</code> trÃªn <code>receiver</code> Ä‘á»ƒ láº¥y mutex, rá»“i gá»i
<code>unwrap</code> Ä‘á»ƒ panic náº¿u cÃ³ lá»—i. Viá»‡c láº¥y lock cÃ³ thá»ƒ tháº¥t báº¡i náº¿u mutex á»Ÿ tráº¡ng
thÃ¡i <em>poisoned</em>, Ä‘iá»u nÃ y xáº£y ra náº¿u má»™t thread khÃ¡c panic trong khi giá»¯ lock
thay vÃ¬ tháº£ lock. Trong tÃ¬nh huá»‘ng nÃ y, gá»i <code>unwrap</code> Ä‘á»ƒ thread nÃ y panic lÃ 
hÃ nh Ä‘á»™ng Ä‘Ãºng. Báº¡n cÃ³ thá»ƒ thay <code>unwrap</code> báº±ng <code>expect</code> vá»›i thÃ´ng bÃ¡o lá»—i
cÃ³ Ã½ nghÄ©a vá»›i báº¡n.</p>
<p>Náº¿u chÃºng ta láº¥y Ä‘Æ°á»£c lock trÃªn mutex, gá»i <code>recv</code> Ä‘á»ƒ nháº­n má»™t <code>Job</code> tá»« channel.
Má»™t <code>unwrap</code> cuá»‘i cÃ¹ng bá» qua má»i lá»—i táº¡i Ä‘Ã¢y, cÃ³ thá»ƒ xáº£y ra náº¿u thread giá»¯
sender Ä‘Ã£ táº¯t, tÆ°Æ¡ng tá»± nhÆ° cÃ¡ch <code>send</code> tráº£ vá» <code>Err</code> náº¿u receiver táº¯t.</p>
<p>Lá»‡nh gá»i <code>recv</code> sáº½ block, vÃ¬ váº­y náº¿u chÆ°a cÃ³ job, thread hiá»‡n táº¡i sáº½ chá» cho
Ä‘áº¿n khi cÃ³ job. <code>Mutex&lt;T&gt;</code> Ä‘áº£m báº£o chá»‰ má»™t thread <code>Worker</code> táº¡i má»™t thá»i Ä‘iá»ƒm
thá»­ yÃªu cáº§u job.</p>
<p>Thread pool cá»§a chÃºng ta giá» Ä‘Ã£ hoáº¡t Ä‘á»™ng! HÃ£y cháº¡y <code>cargo run</code> vÃ  thá»±c hiá»‡n
má»™t vÃ i request:</p>
<!-- manual-regeneration
cd listings/ch20-web-server/listing-20-20
cargo run
make some requests to 127.0.0.1:7878
Can't automate because the output depends on making requests
-->
<pre><code class="language-console">$ cargo run
   Compiling hello v0.1.0 (file:///projects/hello)
warning: field is never read: `workers`
 --&gt; src/lib.rs:7:5
  |
7 |     workers: Vec&lt;Worker&gt;,
  |     ^^^^^^^^^^^^^^^^^^^^
  |
  = note: `#[warn(dead_code)]` on by default

warning: field is never read: `id`
  --&gt; src/lib.rs:48:5
   |
48 |     id: usize,
   |     ^^^^^^^^^

warning: field is never read: `thread`
  --&gt; src/lib.rs:49:5
   |
49 |     thread: thread::JoinHandle&lt;()&gt;,
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: `hello` (lib) generated 3 warnings
    Finished dev [unoptimized + debuginfo] target(s) in 1.40s
     Running `target/debug/hello`
Worker 0 got a job; executing.
Worker 2 got a job; executing.
Worker 1 got a job; executing.
Worker 3 got a job; executing.
Worker 0 got a job; executing.
Worker 2 got a job; executing.
Worker 1 got a job; executing.
Worker 3 got a job; executing.
Worker 0 got a job; executing.
Worker 2 got a job; executing.
</code></pre>
<p>ThÃ nh cÃ´ng! Giá» chÃºng ta Ä‘Ã£ cÃ³ má»™t thread pool thá»±c thi cÃ¡c káº¿t ná»‘i má»™t cÃ¡ch
báº¥t Ä‘á»“ng bá»™. KhÃ´ng bao giá» cÃ³ hÆ¡n bá»‘n thread Ä‘Æ°á»£c táº¡o, vÃ¬ váº­y há»‡ thá»‘ng sáº½ khÃ´ng
bá»‹ quÃ¡ táº£i náº¿u server nháº­n nhiá»u request. Náº¿u chÃºng ta gá»­i má»™t request tá»›i
<em>/sleep</em>, server váº«n cÃ³ thá»ƒ phá»¥c vá»¥ cÃ¡c request khÃ¡c nhá» má»™t thread khÃ¡c
thá»±c thi chÃºng.</p>
<blockquote>
<p>LÆ°u Ã½: náº¿u báº¡n má»Ÿ <em>/sleep</em> trÃªn nhiá»u cá»­a sá»• trÃ¬nh duyá»‡t cÃ¹ng lÃºc, chÃºng
cÃ³ thá»ƒ táº£i láº§n lÆ°á»£t vá»›i khoáº£ng cÃ¡ch 5 giÃ¢y. Má»™t sá»‘ trÃ¬nh duyá»‡t thá»±c thi
nhiá»u instance cá»§a cÃ¹ng má»™t request theo thá»© tá»± Ä‘á»ƒ phá»¥c vá»¥ caching.
Giá»›i háº¡n nÃ y khÃ´ng pháº£i do server web cá»§a chÃºng ta gÃ¢y ra.</p>
</blockquote>
<p>Sau khi há»c vá» vÃ²ng láº·p <code>while let</code> trong ChÆ°Æ¡ng 18, báº¡n cÃ³ thá»ƒ tá»± há»i
táº¡i sao chÃºng ta khÃ´ng viáº¿t code thread cá»§a worker nhÆ° trong Listing 20-21.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore not_desired_behavior">{{#rustdoc_include ../listings/ch20-web-server/listing-20-21/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-21: Má»™t cÃ¡ch triá»ƒn khai khÃ¡c cá»§a <code>Worker::new</code> sá»­ dá»¥ng <code>while let</code></span></p>
<p>Code nÃ y biÃªn dá»‹ch vÃ  cháº¡y Ä‘Æ°á»£c nhÆ°ng khÃ´ng mang láº¡i hÃ nh vi threading nhÆ° mong muá»‘n:
má»™t request cháº­m váº«n sáº½ khiáº¿n cÃ¡c request khÃ¡c pháº£i chá» xá»­ lÃ½. NguyÃªn nhÃ¢n khÃ¡ tinh táº¿:
struct <code>Mutex</code> khÃ´ng cÃ³ phÆ°Æ¡ng thá»©c <code>unlock</code> cÃ´ng khai vÃ¬ quyá»n sá»Ÿ há»¯u lock dá»±a trÃªn
vÃ²ng Ä‘á»i cá»§a <code>MutexGuard&lt;T&gt;</code> trong <code>LockResult&lt;MutexGuard&lt;T&gt;&gt;</code> mÃ  phÆ°Æ¡ng thá»©c <code>lock</code> tráº£ vá».
Táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch, borrow checker sáº½ thá»±c thi quy táº¯c ráº±ng má»™t tÃ i nguyÃªn Ä‘Æ°á»£c
báº£o vá»‡ bá»Ÿi <code>Mutex</code> khÃ´ng thá»ƒ truy cáº­p náº¿u chÃºng ta khÃ´ng giá»¯ lock. Tuy nhiÃªn, cÃ¡ch
triá»ƒn khai nÃ y cÅ©ng cÃ³ thá»ƒ khiáº¿n lock bá»‹ giá»¯ lÃ¢u hÆ¡n dá»± kiáº¿n náº¿u chÃºng ta khÃ´ng chÃº Ã½
Ä‘áº¿n vÃ²ng Ä‘á»i cá»§a <code>MutexGuard&lt;T&gt;</code>.</p>
<p>Code trong Listing 20-20 sá»­ dá»¥ng <code>let job = receiver.lock().unwrap().recv().unwrap();</code>
hoáº¡t Ä‘á»™ng vÃ¬ vá»›i <code>let</code>, báº¥t ká»³ giÃ¡ trá»‹ táº¡m thá»i nÃ o dÃ¹ng trong biá»ƒu thá»©c bÃªn pháº£i
dáº¥u báº±ng sáº½ bá»‹ drop ngay khi cÃ¢u lá»‡nh <code>let</code> káº¿t thÃºc. Tuy nhiÃªn, <code>while let</code> (vÃ  <code>if let</code>
vÃ  <code>match</code>) khÃ´ng drop cÃ¡c giÃ¡ trá»‹ táº¡m thá»i cho Ä‘áº¿n khi káº¿t thÃºc block liÃªn quan. Trong
Listing 20-21, lock váº«n bá»‹ giá»¯ trong suá»‘t cuá»™c gá»i tá»›i <code>job()</code>, nghÄ©a lÃ  cÃ¡c worker khÃ¡c
khÃ´ng thá»ƒ nháº­n job.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="táº¯t-vÃ -dá»n-dáº¹p-má»™t-cÃ¡ch-ÃŠm-Ã¡i"><a class="header" href="#táº¯t-vÃ -dá»n-dáº¹p-má»™t-cÃ¡ch-ÃŠm-Ã¡i">Táº¯t vÃ  Dá»n dáº¹p Má»™t cÃ¡ch ÃŠm Ã¡i</a></h2>
<p>Code trong Listing 20-20 Ä‘ang xá»­ lÃ½ cÃ¡c request má»™t cÃ¡ch báº¥t Ä‘á»“ng bá»™ thÃ´ng qua
viá»‡c sá»­ dá»¥ng thread pool, Ä‘Ãºng nhÆ° chÃºng ta mong muá»‘n. ChÃºng ta nháº­n má»™t sá»‘
cáº£nh bÃ¡o vá» cÃ¡c trÆ°á»ng <code>workers</code>, <code>id</code>, vÃ  <code>thread</code> mÃ  chÃºng ta khÃ´ng sá»­ dá»¥ng
trá»±c tiáº¿p, nháº¯c nhá»Ÿ ráº±ng chÃºng ta chÆ°a dá»n dáº¹p gÃ¬ cáº£. Khi sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p
Ã­t tinh táº¿ hÆ¡n <span class="keystroke">ctrl-c</span> Ä‘á»ƒ dá»«ng thread chÃ­nh, táº¥t
cáº£ cÃ¡c thread khÃ¡c cÅ©ng bá»‹ dá»«ng ngay láº­p tá»©c, ngay cáº£ khi chÃºng Ä‘ang xá»­ lÃ½ má»™t
request.</p>
<p>Tiáº¿p theo, chÃºng ta sáº½ triá»ƒn khai trait <code>Drop</code> Ä‘á»ƒ gá»i <code>join</code> trÃªn tá»«ng thread trong pool
Ä‘á»ƒ chÃºng cÃ³ thá»ƒ hoÃ n táº¥t cÃ¡c request mÃ  chÃºng Ä‘ang xá»­ lÃ½ trÆ°á»›c khi Ä‘Ã³ng. Sau Ä‘Ã³,
chÃºng ta sáº½ triá»ƒn khai má»™t cÃ¡ch Ä‘á»ƒ bÃ¡o cho cÃ¡c thread biáº¿t ráº±ng chÃºng nÃªn ngá»«ng
nháº­n request má»›i vÃ  táº¯t. Äá»ƒ xem code nÃ y hoáº¡t Ä‘á»™ng, chÃºng ta sáº½ chá»‰nh sá»­a server
chá»‰ cháº¥p nháº­n hai request trÆ°á»›c khi táº¯t thread pool má»™t cÃ¡ch Ãªm Ã¡i.</p>
<h3 id="triá»ƒn-khai-trait-drop-trÃªn-threadpool"><a class="header" href="#triá»ƒn-khai-trait-drop-trÃªn-threadpool">Triá»ƒn khai trait <code>Drop</code> trÃªn <code>ThreadPool</code></a></h3>
<p>HÃ£y báº¯t Ä‘áº§u vá»›i viá»‡c triá»ƒn khai <code>Drop</code> cho thread pool. Khi pool bá»‹ drop, táº¥t cáº£
cÃ¡c thread cá»§a chÃºng ta nÃªn join Ä‘á»ƒ Ä‘áº£m báº£o chÃºng hoÃ n thÃ nh cÃ´ng viá»‡c. Listing 20-22
cho tháº¥y má»™t láº§n thá»­ Ä‘áº§u tiÃªn cá»§a viá»‡c triá»ƒn khai <code>Drop</code>; code nÃ y váº«n chÆ°a cháº¡y Ä‘Æ°á»£c.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch20-web-server/listing-20-22/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-22: Gá»i <code>join</code> trÃªn tá»«ng thread khi thread pool
ra khá»i pháº¡m vi</span></p>
<p>TrÆ°á»›c tiÃªn, chÃºng ta láº·p qua tá»«ng <code>worker</code> trong thread pool. ChÃºng ta sá»­ dá»¥ng <code>&amp;mut</code>
vÃ¬ <code>self</code> lÃ  má»™t tham chiáº¿u cÃ³ thá»ƒ thay Ä‘á»•i, vÃ  chÃºng ta cÅ©ng cáº§n kháº£ nÄƒng thay Ä‘á»•i
<code>worker</code>. Vá»›i má»—i worker, chÃºng ta in ra má»™t thÃ´ng bÃ¡o nÃ³i ráº±ng worker cá»¥ thá»ƒ nÃ y
Ä‘ang táº¯t, sau Ä‘Ã³ gá»i <code>join</code> trÃªn thread cá»§a worker Ä‘Ã³. Náº¿u viá»‡c gá»i <code>join</code> tháº¥t báº¡i,
chÃºng ta sá»­ dá»¥ng <code>unwrap</code> Ä‘á»ƒ Rust panic vÃ  thá»±c hiá»‡n má»™t viá»‡c táº¯t khÃ´ng Ãªm Ã¡i.</p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  lá»—i mÃ  chÃºng ta nháº­n Ä‘Æ°á»£c khi biÃªn dá»‹ch code nÃ y:</p>
<pre><code class="language-console">{{#include ../listings/ch20-web-server/listing-20-22/output.txt}}
</code></pre>
<p>Lá»—i nÃ y cho chÃºng ta biáº¿t ráº±ng khÃ´ng thá»ƒ gá»i <code>join</code> vÃ¬ chÃºng ta chá»‰ cÃ³ má»™t
tham chiáº¿u thay Ä‘á»•i (<code>mutable borrow</code>) tá»›i má»—i <code>worker</code>, trong khi <code>join</code>
yÃªu cáº§u quyá»n sá»Ÿ há»¯u (<code>ownership</code>) cá»§a Ä‘á»‘i sá»‘. Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y,
chÃºng ta cáº§n di chuyá»ƒn thread ra khá»i instance <code>Worker</code> Ä‘ang sá»Ÿ há»¯u <code>thread</code>
Ä‘á»ƒ <code>join</code> cÃ³ thá»ƒ tiÃªu thá»¥ thread Ä‘Ã³. ChÃºng ta Ä‘Ã£ lÃ m Ä‘iá»u nÃ y trong Listing 17-15:
náº¿u <code>Worker</code> giá»¯ má»™t <code>Option&lt;thread::JoinHandle&lt;()&gt;&gt;</code>, chÃºng ta cÃ³ thá»ƒ gá»i
phÆ°Æ¡ng thá»©c <code>take</code> trÃªn <code>Option</code> Ä‘á»ƒ di chuyá»ƒn giÃ¡ trá»‹ ra khá»i biáº¿n <code>Some</code>
vÃ  Ä‘á»ƒ láº¡i <code>None</code> á»Ÿ vá»‹ trÃ­ Ä‘Ã³. NÃ³i cÃ¡ch khÃ¡c, má»™t <code>Worker</code> Ä‘ang cháº¡y sáº½ cÃ³
biáº¿n <code>Some</code> trong <code>thread</code>, vÃ  khi muá»‘n dá»n dáº¹p má»™t <code>Worker</code>, chÃºng ta sáº½
thay <code>Some</code> báº±ng <code>None</code> Ä‘á»ƒ <code>Worker</code> khÃ´ng cÃ²n thread nÃ o Ä‘á»ƒ cháº¡y.</p>
<p>VÃ¬ váº­y, chÃºng ta biáº¿t ráº±ng cáº§n cáº­p nháº­t Ä‘á»‹nh nghÄ©a cá»§a <code>Worker</code> nhÆ° sau:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch20-web-server/no-listing-04-update-worker-definition/src/lib.rs:here}}</code></pre>
<p>BÃ¢y giá» chÃºng ta hÃ£y dá»±a vÃ o compiler Ä‘á»ƒ tÃ¬m cÃ¡c chá»— khÃ¡c cáº§n thay Ä‘á»•i.
Khi kiá»ƒm tra mÃ£ nÃ y, chÃºng ta nháº­n Ä‘Æ°á»£c hai lá»—i:</p>
<pre><code class="language-console">{{#include ../listings/ch20-web-server/no-listing-04-update-worker-definition/output.txt}}
</code></pre>
<p>HÃ£y giáº£i quyáº¿t lá»—i thá»© hai, liÃªn quan Ä‘áº¿n mÃ£ á»Ÿ cuá»‘i <code>Worker::new</code>; chÃºng ta cáº§n
bao <code>thread</code> trong <code>Some</code> khi táº¡o má»™t <code>Worker</code> má»›i. Thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i sau
Ä‘á»ƒ sá»­a lá»—i nÃ y:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch20-web-server/no-listing-05-fix-worker-new/src/lib.rs:here}}</code></pre>
<p>Lá»—i Ä‘áº§u tiÃªn náº±m trong pháº§n triá»ƒn khai <code>Drop</code>. ChÃºng ta Ä‘Ã£ Ä‘á» cáº­p trÆ°á»›c Ä‘Ã³ ráº±ng
chÃºng ta dá»± Ä‘á»‹nh gá»i <code>take</code> trÃªn giÃ¡ trá»‹ <code>Option</code> Ä‘á»ƒ di chuyá»ƒn <code>thread</code> ra khá»i
<code>worker</code>. CÃ¡c thay Ä‘á»•i sau sáº½ thá»±c hiá»‡n Ä‘iá»u Ä‘Ã³:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust ignore not_desired_behavior">{{#rustdoc_include ../listings/ch20-web-server/no-listing-06-fix-threadpool-drop/src/lib.rs:here}}</code></pre>
<p>NhÆ° Ä‘Ã£ tháº£o luáº­n trong ChÆ°Æ¡ng 17, phÆ°Æ¡ng thá»©c <code>take</code> trÃªn <code>Option</code> sáº½ láº¥y giÃ¡ trá»‹
<code>Some</code> ra vÃ  Ä‘á»ƒ láº¡i <code>None</code> á»Ÿ chá»— Ä‘Ã³. ChÃºng ta dÃ¹ng <code>if let</code> Ä‘á»ƒ phÃ¡ cáº¥u trÃºc
<code>Some</code> vÃ  láº¥y ra <code>thread</code>; sau Ä‘Ã³ gá»i <code>join</code> trÃªn <code>thread</code> Ä‘Ã³. Náº¿u <code>thread</code> cá»§a
má»™t worker Ä‘Ã£ lÃ  <code>None</code>, nghÄ©a lÃ  worker Ä‘Ã³ Ä‘Ã£ Ä‘Æ°á»£c dá»n dáº¹p trÆ°á»›c, nÃªn trong
trÆ°á»ng há»£p nÃ y sáº½ khÃ´ng cÃ³ gÃ¬ xáº£y ra.</p>
<h3 id="thÃ´ng-bÃ¡o-cho-cÃ¡c-thread-dá»«ng-láº¯ng-nghe-job"><a class="header" href="#thÃ´ng-bÃ¡o-cho-cÃ¡c-thread-dá»«ng-láº¯ng-nghe-job">ThÃ´ng bÃ¡o cho cÃ¡c Thread dá»«ng láº¯ng nghe Job</a></h3>
<p>Vá»›i táº¥t cáº£ nhá»¯ng thay Ä‘á»•i trÃªn, code cá»§a chÃºng ta Ä‘Ã£ biÃªn dá»‹ch mÃ  khÃ´ng cÃ³ cáº£nh bÃ¡o.
Tuy nhiÃªn, váº¥n Ä‘á» lÃ  code hiá»‡n táº¡i váº«n chÆ°a hoáº¡t Ä‘á»™ng Ä‘Ãºng nhÆ° mong muá»‘n.
Äiá»ƒm then chá»‘t náº±m á»Ÿ logic trong cÃ¡c closure mÃ  cÃ¡c thread cá»§a <code>Worker</code> Ä‘ang cháº¡y:
hiá»‡n táº¡i chÃºng ta chá»‰ gá»i <code>join</code>, nhÆ°ng Ä‘iá»u nÃ y sáº½ khÃ´ng táº¯t cÃ¡c thread
bá»Ÿi vÃ¬ chÃºng <code>loop</code> vÃ´ táº­n Ä‘á»ƒ chá» job. Náº¿u thá»­ <code>drop</code> <code>ThreadPool</code> vá»›i
cÃ¡ch triá»ƒn khai hiá»‡n táº¡i, thread chÃ­nh sáº½ bá»‹ block vÃ´ thá»i háº¡n chá» thread Ä‘áº§u tiÃªn káº¿t thÃºc.</p>
<p>Äá»ƒ kháº¯c phá»¥c váº¥n Ä‘á» nÃ y, chÃºng ta cáº§n thay Ä‘á»•i trong triá»ƒn khai <code>drop</code> cá»§a
<code>ThreadPool</code> vÃ  thay Ä‘á»•i trong vÃ²ng láº·p cá»§a <code>Worker</code>.</p>
<p>TrÆ°á»›c tiÃªn, chÃºng ta sáº½ thay Ä‘á»•i <code>drop</code> cá»§a <code>ThreadPool</code> Ä‘á»ƒ chá»§ Ä‘á»™ng
<code>drop</code> <code>sender</code> trÆ°á»›c khi chá» cÃ¡c thread hoÃ n táº¥t. Listing 20-23 minh há»a
cÃ¡c thay Ä‘á»•i trong <code>ThreadPool</code> Ä‘á»ƒ chá»§ Ä‘á»™ng <code>drop</code> <code>sender</code>. ChÃºng ta sá»­ dá»¥ng
cÃ¹ng ká»¹ thuáº­t <code>Option</code> vÃ  <code>take</code> nhÆ° vá»›i thread Ä‘á»ƒ cÃ³ thá»ƒ di chuyá»ƒn <code>sender</code>
ra khá»i <code>ThreadPool</code>:</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground not_desired_behavior">{{#rustdoc_include ../listings/ch20-web-server/listing-20-23/src/lib.rs:here}}</code></pre>
<p>Viá»‡c <code>drop</code> <code>sender</code> sáº½ Ä‘Ã³ng kÃªnh, bÃ¡o hiá»‡u ráº±ng sáº½ khÃ´ng cÃ²n thÃ´ng Ä‘iá»‡p nÃ o
Ä‘Æ°á»£c gá»­i ná»¯a. Khi Ä‘iá»u nÃ y xáº£y ra, táº¥t cáº£ cÃ¡c láº§n gá»i <code>recv</code> trong vÃ²ng láº·p
vÃ´ háº¡n cá»§a cÃ¡c worker sáº½ tráº£ vá» lá»—i. Trong Listing 20-24, chÃºng ta thay Ä‘á»•i
vÃ²ng láº·p cá»§a <code>Worker</code> Ä‘á»ƒ thoÃ¡t vÃ²ng láº·p má»™t cÃ¡ch an toÃ n khi nháº­n lá»—i,
nghÄ©a lÃ  cÃ¡c thread sáº½ káº¿t thÃºc khi <code>ThreadPool</code> gá»i <code>join</code> trÃªn chÃºng.</p>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/listing-20-24/src/lib.rs:here}}</code></pre>
<p><span class="caption">Listing 20-24: ThoÃ¡t vÃ²ng láº·p má»™t cÃ¡ch rÃµ rÃ ng khi <code>recv</code> tráº£ vá» lá»—i</span></p>
<p>Äá»ƒ tháº¥y Ä‘oáº¡n code nÃ y hoáº¡t Ä‘á»™ng, hÃ£y chá»‰nh sá»­a <code>main</code> sao cho server chá»‰ nháº­n tá»‘i Ä‘a hai request
trÆ°á»›c khi Ä‘Ã³ng server má»™t cÃ¡ch gá»n gÃ ng, nhÆ° minh há»a trong Listing 20-25.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch20-web-server/listing-20-25/src/main.rs:here}}</code></pre>
<p><span class="caption">Listing 20-25: Táº¯t server sau khi phá»¥c vá»¥ hai request báº±ng cÃ¡ch thoÃ¡t khá»i vÃ²ng láº·p</span></p>
<p>Trong thá»±c táº¿, báº¡n sáº½ khÃ´ng muá»‘n má»™t web server táº¯t sau khi
chá»‰ phá»¥c vá»¥ hai request. Äoáº¡n code nÃ y chá»‰ nháº±m minh há»a
ráº±ng cÆ¡ cháº¿ táº¯t server gá»n gÃ ng vÃ  dá»n dáº¹p tÃ i nguyÃªn Ä‘ang hoáº¡t Ä‘á»™ng.</p>
<p>PhÆ°Æ¡ng thá»©c <code>take</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong trait <code>Iterator</code>
vÃ  giá»›i háº¡n sá»‘ láº§n láº·p tá»‘i Ä‘a lÃ  hai. <code>ThreadPool</code> sáº½ ra khá»i pháº¡m vi
khi káº¿t thÃºc <code>main</code>, vÃ  implementation cá»§a <code>drop</code> sáº½ Ä‘Æ°á»£c gá»i.</p>
<p>Cháº¡y server báº±ng <code>cargo run</code>, vÃ  gá»­i ba request. Request thá»© ba sáº½ gáº·p lá»—i,
vÃ  trÃªn terminal báº¡n sáº½ tháº¥y Ä‘áº§u ra tÆ°Æ¡ng tá»± nhÆ° sau:</p>
<!-- manual-regeneration
cd listings/ch20-web-server/listing-20-25
cargo run
curl http://127.0.0.1:7878
curl http://127.0.0.1:7878
curl http://127.0.0.1:7878
third request will error because server will have shut down
copy output below
Can't automate because the output depends on making requests
-->
<pre><code class="language-console">$ cargo run
   Compiling hello v0.1.0 (file:///projects/hello)
    Finished dev [unoptimized + debuginfo] target(s) in 1.0s
     Running `target/debug/hello`
Worker 0 got a job; executing.
Shutting down.
Shutting down worker 0
Worker 3 got a job; executing.
Worker 1 disconnected; shutting down.
Worker 2 disconnected; shutting down.
Worker 3 disconnected; shutting down.
Worker 0 disconnected; shutting down.
Shutting down worker 1
Shutting down worker 2
Shutting down worker 3
</code></pre>
<p>Báº¡n cÃ³ thá»ƒ tháº¥y thá»© tá»± in ra cá»§a cÃ¡c worker vÃ  cÃ¡c message sáº½ khÃ¡c nhau.
ChÃºng ta cÃ³ thá»ƒ hiá»ƒu cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Ä‘oáº¡n code nÃ y qua cÃ¡c thÃ´ng bÃ¡o:
worker 0 vÃ  3 nháº­n hai request Ä‘áº§u tiÃªn. Server ngá»«ng cháº¥p nháº­n káº¿t ná»‘i
sau káº¿t ná»‘i thá»© hai, vÃ  implementation cá»§a <code>Drop</code> trÃªn <code>ThreadPool</code>
báº¯t Ä‘áº§u thá»±c thi trÆ°á»›c khi worker 3 ká»‹p báº¯t Ä‘áº§u cÃ´ng viá»‡c cá»§a nÃ³.
Viá»‡c drop <code>sender</code> sáº½ ngáº¯t káº¿t ná»‘i táº¥t cáº£ cÃ¡c worker vÃ  bÃ¡o cho chÃºng táº¯t.
Má»—i worker sáº½ in ra má»™t thÃ´ng bÃ¡o khi chÃºng bá»‹ ngáº¯t káº¿t ná»‘i,
sau Ä‘Ã³ thread pool gá»i <code>join</code> Ä‘á»ƒ chá» cÃ¡c thread worker káº¿t thÃºc.</p>
<p>LÆ°u Ã½ má»™t Ä‘iá»ƒm thÃº vá»‹ trong láº§n thá»±c thi nÃ y: <code>ThreadPool</code> drop <code>sender</code>,
vÃ  trÆ°á»›c khi báº¥t ká»³ worker nÃ o nháº­n Ä‘Æ°á»£c lá»—i, chÃºng ta Ä‘Ã£ thá»­ join worker 0.
Worker 0 chÆ°a nháº­n lá»—i tá»« <code>recv</code>, nÃªn thread chÃ­nh bá»‹ cháº·n chá» worker 0 hoÃ n thÃ nh.
Trong lÃºc Ä‘Ã³, worker 3 nháº­n Ä‘Æ°á»£c má»™t job vÃ  sau Ä‘Ã³ táº¥t cáº£ cÃ¡c thread nháº­n lá»—i.
Khi worker 0 káº¿t thÃºc, thread chÃ­nh chá» cÃ¡c worker cÃ²n láº¡i hoÃ n thÃ nh.
LÃºc Ä‘Ã³, táº¥t cáº£ Ä‘Ã£ thoÃ¡t khá»i vÃ²ng láº·p vÃ  dá»«ng láº¡i.</p>
<p>ChÃºc má»«ng! ChÃºng ta Ä‘Ã£ hoÃ n thÃ nh dá»± Ã¡n; chÃºng ta cÃ³ má»™t web server
cÆ¡ báº£n sá»­ dá»¥ng thread pool Ä‘á»ƒ pháº£n há»“i báº¥t Ä‘á»“ng bá»™.
ChÃºng ta cÃ³ thá»ƒ thá»±c hiá»‡n táº¯t server má»™t cÃ¡ch gá»n gÃ ng, dá»n dáº¹p táº¥t cáº£ cÃ¡c thread trong pool.</p>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  toÃ n bá»™ code Ä‘á»ƒ tham kháº£o:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore">{{#rustdoc_include ../listings/ch20-web-server/no-listing-07-final-code/src/main.rs}}</code></pre>
<p><span class="filename">Filename: src/lib.rs</span></p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch20-web-server/no-listing-07-final-code/src/lib.rs}}</code></pre>
<p>ChÃºng ta váº«n cÃ³ thá»ƒ lÃ m nhiá»u hÆ¡n ná»¯a! Náº¿u báº¡n muá»‘n tiáº¿p tá»¥c cáº£i tiáº¿n dá»± Ã¡n nÃ y, Ä‘Ã¢y lÃ  má»™t sá»‘ Ã½ tÆ°á»Ÿng:</p>
<ul>
<li>ThÃªm nhiá»u tÃ i liá»‡u hÆ¡n cho <code>ThreadPool</code> vÃ  cÃ¡c phÆ°Æ¡ng thá»©c public cá»§a nÃ³.</li>
<li>ThÃªm cÃ¡c bÃ i test cho chá»©c nÄƒng cá»§a thÆ° viá»‡n.</li>
<li>Thay cÃ¡c láº§n gá»i <code>unwrap</code> báº±ng cÆ¡ cháº¿ xá»­ lÃ½ lá»—i cháº¯c cháº¯n hÆ¡n.</li>
<li>Sá»­ dá»¥ng <code>ThreadPool</code> Ä‘á»ƒ thá»±c hiá»‡n má»™t nhiá»‡m vá»¥ khÃ¡c ngoÃ i viá»‡c phá»¥c vá»¥ web request.</li>
<li>TÃ¬m má»™t crate thread pool trÃªn <a href="https://crates.io/">crates.io</a> vÃ  triá»ƒn khai má»™t web server tÆ°Æ¡ng tá»± báº±ng crate Ä‘Ã³. Sau Ä‘Ã³ so sÃ¡nh API vÃ  Ä‘á»™ á»•n Ä‘á»‹nh vá»›i thread pool mÃ  chÃºng ta tá»± implement.</li>
</ul>
<h2 id="tÃ³m-táº¯t-10"><a class="header" href="#tÃ³m-táº¯t-10">TÃ³m táº¯t</a></h2>
<p>Xuáº¥t sáº¯c! Báº¡n Ä‘Ã£ Ä‘i Ä‘áº¿n cuá»‘i cuá»‘n sÃ¡ch! ChÃºng tÃ´i cáº£m Æ¡n báº¡n
Ä‘Ã£ Ä‘á»“ng hÃ nh cÃ¹ng chÃºng tÃ´i trong chuyáº¿n tham quan Rust.
BÃ¢y giá» báº¡n Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ triá»ƒn khai cÃ¡c dá»± Ã¡n Rust cá»§a riÃªng mÃ¬nh
vÃ  há»— trá»£ cÃ¡c dá»± Ã¡n cá»§a ngÆ°á»i khÃ¡c. HÃ£y nhá»› ráº±ng cá»™ng Ä‘á»“ng Rustacean
luÃ´n chÃ o Ä‘Ã³n vÃ  sáºµn sÃ ng giÃºp báº¡n vÆ°á»£t qua báº¥t ká»³ thá»­ thÃ¡ch nÃ o trÃªn hÃ nh trÃ¬nh há»c Rust cá»§a báº¡n.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="appendix"><a class="header" href="#appendix">Appendix</a></h1>
<p>The following sections contain reference material you may find useful in your
Rust journey.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="appendix-a-keywords"><a class="header" href="#appendix-a-keywords">Appendix A: Keywords</a></h2>
<p>The following list contains keywords that are reserved for current or future
use by the Rust language. As such, they cannot be used as identifiers (except
as raw identifiers as weâ€™ll discuss in the â€œ<a href="appendix-01-keywords.html#raw-identifiers">Raw
Identifiers</a><!-- ignore -->â€ section). Identifiers are names
of functions, variables, parameters, struct fields, modules, crates, constants,
macros, static values, attributes, types, traits, or lifetimes.</p>
<h3 id="keywords-currently-in-use"><a class="header" href="#keywords-currently-in-use">Keywords Currently in Use</a></h3>
<p>The following is a list of keywords currently in use, with their functionality
described.</p>
<ul>
<li><code>as</code> - perform primitive casting, disambiguate the specific trait containing
an item, or rename items in <code>use</code> statements</li>
<li><code>async</code> -  return a <code>Future</code> instead of blocking the current thread</li>
<li><code>await</code> - suspend execution until the result of a <code>Future</code> is ready</li>
<li><code>break</code> - exit a loop immediately</li>
<li><code>const</code> - define constant items or constant raw pointers</li>
<li><code>continue</code> - continue to the next loop iteration</li>
<li><code>crate</code> - in a module path, refers to the crate root</li>
<li><code>dyn</code> - dynamic dispatch to a trait object</li>
<li><code>else</code> - fallback for <code>if</code> and <code>if let</code> control flow constructs</li>
<li><code>enum</code> - define an enumeration</li>
<li><code>extern</code> - link an external function or variable</li>
<li><code>false</code> - Boolean false literal</li>
<li><code>fn</code> - define a function or the function pointer type</li>
<li><code>for</code> - loop over items from an iterator, implement a trait, or specify a
higher-ranked lifetime</li>
<li><code>if</code> - branch based on the result of a conditional expression</li>
<li><code>impl</code> - implement inherent or trait functionality</li>
<li><code>in</code> - part of <code>for</code> loop syntax</li>
<li><code>let</code> - bind a variable</li>
<li><code>loop</code> - loop unconditionally</li>
<li><code>match</code> - match a value to patterns</li>
<li><code>mod</code> - define a module</li>
<li><code>move</code> - make a closure take ownership of all its captures</li>
<li><code>mut</code> - denote mutability in references, raw pointers, or pattern bindings</li>
<li><code>pub</code> - denote public visibility in struct fields, <code>impl</code> blocks, or modules</li>
<li><code>ref</code> - bind by reference</li>
<li><code>return</code> - return from function</li>
<li><code>Self</code> - a type alias for the type we are defining or implementing</li>
<li><code>self</code> - method subject or current module</li>
<li><code>static</code> - global variable or lifetime lasting the entire program execution</li>
<li><code>struct</code> - define a structure</li>
<li><code>super</code> - parent module of the current module</li>
<li><code>trait</code> - define a trait</li>
<li><code>true</code> - Boolean true literal</li>
<li><code>type</code> - define a type alias or associated type</li>
<li><code>union</code> - define a <a href="../reference/items/unions.html">union</a><!-- ignore -->; is only a keyword when used
in a union declaration</li>
<li><code>unsafe</code> - denote unsafe code, functions, traits, or implementations</li>
<li><code>use</code> - bring symbols into scope</li>
<li><code>where</code> - denote clauses that constrain a type</li>
<li><code>while</code> - loop conditionally based on the result of an expression</li>
</ul>
<h3 id="keywords-reserved-for-future-use"><a class="header" href="#keywords-reserved-for-future-use">Keywords Reserved for Future Use</a></h3>
<p>The following keywords do not yet have any functionality but are reserved by
Rust for potential future use.</p>
<ul>
<li><code>abstract</code></li>
<li><code>become</code></li>
<li><code>box</code></li>
<li><code>do</code></li>
<li><code>final</code></li>
<li><code>macro</code></li>
<li><code>override</code></li>
<li><code>priv</code></li>
<li><code>try</code></li>
<li><code>typeof</code></li>
<li><code>unsized</code></li>
<li><code>virtual</code></li>
<li><code>yield</code></li>
</ul>
<h3 id="raw-identifiers"><a class="header" href="#raw-identifiers">Raw Identifiers</a></h3>
<p><em>Raw identifiers</em> are the syntax that lets you use keywords where they wouldnâ€™t
normally be allowed. You use a raw identifier by prefixing a keyword with <code>r#</code>.</p>
<p>For example, <code>match</code> is a keyword. If you try to compile the following function
that uses <code>match</code> as its name:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><code class="language-rust ignore does_not_compile">fn match(needle: &amp;str, haystack: &amp;str) -&gt; bool {
    haystack.contains(needle)
}</code></pre>
<p>youâ€™ll get this error:</p>
<pre><code class="language-text">error: expected identifier, found keyword `match`
 --&gt; src/main.rs:4:4
  |
4 | fn match(needle: &amp;str, haystack: &amp;str) -&gt; bool {
  |    ^^^^^ expected identifier, found keyword
</code></pre>
<p>The error shows that you canâ€™t use the keyword <code>match</code> as the function
identifier. To use <code>match</code> as a function name, you need to use the raw
identifier syntax, like this:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn r#match(needle: &amp;str, haystack: &amp;str) -&gt; bool {
    haystack.contains(needle)
}

fn main() {
    assert!(r#match("foo", "foobar"));
}</code></pre></pre>
<p>This code will compile without any errors. Note the <code>r#</code> prefix on the function
name in its definition as well as where the function is called in <code>main</code>.</p>
<p>Raw identifiers allow you to use any word you choose as an identifier, even if
that word happens to be a reserved keyword. This gives us more freedom to
choose identifier names, as well as lets us integrate with programs written in
a language where these words arenâ€™t keywords. In addition, raw identifiers
allow you to use libraries written in a different Rust edition than your crate
uses. For example, <code>try</code> isnâ€™t a keyword in the 2015 edition but is in the 2018
edition. If you depend on a library thatâ€™s written using the 2015 edition and
has a <code>try</code> function, youâ€™ll need to use the raw identifier syntax, <code>r#try</code> in
this case, to call that function from your 2018 edition code. See <a href="appendix-05-editions.html">Appendix
E</a><!-- ignore --> for more information on editions.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="appendix-b-operators-and-symbols"><a class="header" href="#appendix-b-operators-and-symbols">Appendix B: Operators and Symbols</a></h2>
<p>This appendix contains a glossary of Rustâ€™s syntax, including operators and
other symbols that appear by themselves or in the context of paths, generics,
trait bounds, macros, attributes, comments, tuples, and brackets.</p>
<h3 id="operators"><a class="header" href="#operators">Operators</a></h3>
<p>Table B-1 contains the operators in Rust, an example of how the operator would
appear in context, a short explanation, and whether that operator is
overloadable. If an operator is overloadable, the relevant trait to use to
overload that operator is listed.</p>
<p><span class="caption">Table B-1: Operators</span></p>
<div class="table-wrapper"><table><thead><tr><th>Operator</th><th>Example</th><th>Explanation</th><th>Overloadable?</th></tr></thead><tbody>
<tr><td><code>!</code></td><td><code>ident!(...)</code>, <code>ident!{...}</code>, <code>ident![...]</code></td><td>Macro expansion</td><td></td></tr>
<tr><td><code>!</code></td><td><code>!expr</code></td><td>Bitwise or logical complement</td><td><code>Not</code></td></tr>
<tr><td><code>!=</code></td><td><code>expr != expr</code></td><td>Nonequality comparison</td><td><code>PartialEq</code></td></tr>
<tr><td><code>%</code></td><td><code>expr % expr</code></td><td>Arithmetic remainder</td><td><code>Rem</code></td></tr>
<tr><td><code>%=</code></td><td><code>var %= expr</code></td><td>Arithmetic remainder and assignment</td><td><code>RemAssign</code></td></tr>
<tr><td><code>&amp;</code></td><td><code>&amp;expr</code>, <code>&amp;mut expr</code></td><td>Borrow</td><td></td></tr>
<tr><td><code>&amp;</code></td><td><code>&amp;type</code>, <code>&amp;mut type</code>, <code>&amp;'a type</code>, <code>&amp;'a mut type</code></td><td>Borrowed pointer type</td><td></td></tr>
<tr><td><code>&amp;</code></td><td><code>expr &amp; expr</code></td><td>Bitwise AND</td><td><code>BitAnd</code></td></tr>
<tr><td><code>&amp;=</code></td><td><code>var &amp;= expr</code></td><td>Bitwise AND and assignment</td><td><code>BitAndAssign</code></td></tr>
<tr><td><code>&amp;&amp;</code></td><td><code>expr &amp;&amp; expr</code></td><td>Short-circuiting logical AND</td><td></td></tr>
<tr><td><code>*</code></td><td><code>expr * expr</code></td><td>Arithmetic multiplication</td><td><code>Mul</code></td></tr>
<tr><td><code>*=</code></td><td><code>var *= expr</code></td><td>Arithmetic multiplication and assignment</td><td><code>MulAssign</code></td></tr>
<tr><td><code>*</code></td><td><code>*expr</code></td><td>Dereference</td><td><code>Deref</code></td></tr>
<tr><td><code>*</code></td><td><code>*const type</code>, <code>*mut type</code></td><td>Raw pointer</td><td></td></tr>
<tr><td><code>+</code></td><td><code>trait + trait</code>, <code>'a + trait</code></td><td>Compound type constraint</td><td></td></tr>
<tr><td><code>+</code></td><td><code>expr + expr</code></td><td>Arithmetic addition</td><td><code>Add</code></td></tr>
<tr><td><code>+=</code></td><td><code>var += expr</code></td><td>Arithmetic addition and assignment</td><td><code>AddAssign</code></td></tr>
<tr><td><code>,</code></td><td><code>expr, expr</code></td><td>Argument and element separator</td><td></td></tr>
<tr><td><code>-</code></td><td><code>- expr</code></td><td>Arithmetic negation</td><td><code>Neg</code></td></tr>
<tr><td><code>-</code></td><td><code>expr - expr</code></td><td>Arithmetic subtraction</td><td><code>Sub</code></td></tr>
<tr><td><code>-=</code></td><td><code>var -= expr</code></td><td>Arithmetic subtraction and assignment</td><td><code>SubAssign</code></td></tr>
<tr><td><code>-&gt;</code></td><td><code>fn(...) -&gt; type</code>, <code>|â€¦| -&gt; type</code></td><td>Function and closure return type</td><td></td></tr>
<tr><td><code>.</code></td><td><code>expr.ident</code></td><td>Member access</td><td></td></tr>
<tr><td><code>..</code></td><td><code>..</code>, <code>expr..</code>, <code>..expr</code>, <code>expr..expr</code></td><td>Right-exclusive range literal</td><td><code>PartialOrd</code></td></tr>
<tr><td><code>..=</code></td><td><code>..=expr</code>, <code>expr..=expr</code></td><td>Right-inclusive range literal</td><td><code>PartialOrd</code></td></tr>
<tr><td><code>..</code></td><td><code>..expr</code></td><td>Struct literal update syntax</td><td></td></tr>
<tr><td><code>..</code></td><td><code>variant(x, ..)</code>, <code>struct_type { x, .. }</code></td><td>â€œAnd the restâ€ pattern binding</td><td></td></tr>
<tr><td><code>...</code></td><td><code>expr...expr</code></td><td>(Deprecated, use <code>..=</code> instead) In a pattern: inclusive range pattern</td><td></td></tr>
<tr><td><code>/</code></td><td><code>expr / expr</code></td><td>Arithmetic division</td><td><code>Div</code></td></tr>
<tr><td><code>/=</code></td><td><code>var /= expr</code></td><td>Arithmetic division and assignment</td><td><code>DivAssign</code></td></tr>
<tr><td><code>:</code></td><td><code>pat: type</code>, <code>ident: type</code></td><td>Constraints</td><td></td></tr>
<tr><td><code>:</code></td><td><code>ident: expr</code></td><td>Struct field initializer</td><td></td></tr>
<tr><td><code>:</code></td><td><code>'a: loop {...}</code></td><td>Loop label</td><td></td></tr>
<tr><td><code>;</code></td><td><code>expr;</code></td><td>Statement and item terminator</td><td></td></tr>
<tr><td><code>;</code></td><td><code>[...; len]</code></td><td>Part of fixed-size array syntax</td><td></td></tr>
<tr><td><code>&lt;&lt;</code></td><td><code>expr &lt;&lt; expr</code></td><td>Left-shift</td><td><code>Shl</code></td></tr>
<tr><td><code>&lt;&lt;=</code></td><td><code>var &lt;&lt;= expr</code></td><td>Left-shift and assignment</td><td><code>ShlAssign</code></td></tr>
<tr><td><code>&lt;</code></td><td><code>expr &lt; expr</code></td><td>Less than comparison</td><td><code>PartialOrd</code></td></tr>
<tr><td><code>&lt;=</code></td><td><code>expr &lt;= expr</code></td><td>Less than or equal to comparison</td><td><code>PartialOrd</code></td></tr>
<tr><td><code>=</code></td><td><code>var = expr</code>, <code>ident = type</code></td><td>Assignment/equivalence</td><td></td></tr>
<tr><td><code>==</code></td><td><code>expr == expr</code></td><td>Equality comparison</td><td><code>PartialEq</code></td></tr>
<tr><td><code>=&gt;</code></td><td><code>pat =&gt; expr</code></td><td>Part of match arm syntax</td><td></td></tr>
<tr><td><code>&gt;</code></td><td><code>expr &gt; expr</code></td><td>Greater than comparison</td><td><code>PartialOrd</code></td></tr>
<tr><td><code>&gt;=</code></td><td><code>expr &gt;= expr</code></td><td>Greater than or equal to comparison</td><td><code>PartialOrd</code></td></tr>
<tr><td><code>&gt;&gt;</code></td><td><code>expr &gt;&gt; expr</code></td><td>Right-shift</td><td><code>Shr</code></td></tr>
<tr><td><code>&gt;&gt;=</code></td><td><code>var &gt;&gt;= expr</code></td><td>Right-shift and assignment</td><td><code>ShrAssign</code></td></tr>
<tr><td><code>@</code></td><td><code>ident @ pat</code></td><td>Pattern binding</td><td></td></tr>
<tr><td><code>^</code></td><td><code>expr ^ expr</code></td><td>Bitwise exclusive OR</td><td><code>BitXor</code></td></tr>
<tr><td><code>^=</code></td><td><code>var ^= expr</code></td><td>Bitwise exclusive OR and assignment</td><td><code>BitXorAssign</code></td></tr>
<tr><td><code>|</code></td><td><code>pat | pat</code></td><td>Pattern alternatives</td><td></td></tr>
<tr><td><code>|</code></td><td><code>expr | expr</code></td><td>Bitwise OR</td><td><code>BitOr</code></td></tr>
<tr><td><code>|=</code></td><td><code>var |= expr</code></td><td>Bitwise OR and assignment</td><td><code>BitOrAssign</code></td></tr>
<tr><td><code>||</code></td><td><code>expr || expr</code></td><td>Short-circuiting logical OR</td><td></td></tr>
<tr><td><code>?</code></td><td><code>expr?</code></td><td>Error propagation</td><td></td></tr>
</tbody></table>
</div>
<h3 id="non-operator-symbols"><a class="header" href="#non-operator-symbols">Non-operator Symbols</a></h3>
<p>The following list contains all symbols that donâ€™t function as operators; that
is, they donâ€™t behave like a function or method call.</p>
<p>Table B-2 shows symbols that appear on their own and are valid in a variety of
locations.</p>
<p><span class="caption">Table B-2: Stand-Alone Syntax</span></p>
<div class="table-wrapper"><table><thead><tr><th>Symbol</th><th>Explanation</th></tr></thead><tbody>
<tr><td><code>'ident</code></td><td>Named lifetime or loop label</td></tr>
<tr><td><code>...u8</code>, <code>...i32</code>, <code>...f64</code>, <code>...usize</code>, etc.</td><td>Numeric literal of specific type</td></tr>
<tr><td><code>"..."</code></td><td>String literal</td></tr>
<tr><td><code>r"..."</code>, <code>r#"..."#</code>, <code>r##"..."##</code>, etc.</td><td>Raw string literal, escape characters not processed</td></tr>
<tr><td><code>b"..."</code></td><td>Byte string literal; constructs an array of bytes instead of a string</td></tr>
<tr><td><code>br"..."</code>, <code>br#"..."#</code>, <code>br##"..."##</code>, etc.</td><td>Raw byte string literal, combination of raw and byte string literal</td></tr>
<tr><td><code>'...'</code></td><td>Character literal</td></tr>
<tr><td><code>b'...'</code></td><td>ASCII byte literal</td></tr>
<tr><td><code>|â€¦| expr</code></td><td>Closure</td></tr>
<tr><td><code>!</code></td><td>Always empty bottom type for diverging functions</td></tr>
<tr><td><code>_</code></td><td>â€œIgnoredâ€ pattern binding; also used to make integer literals readable</td></tr>
</tbody></table>
</div>
<p>Table B-3 shows symbols that appear in the context of a path through the module
hierarchy to an item.</p>
<p><span class="caption">Table B-3: Path-Related Syntax</span></p>
<div class="table-wrapper"><table><thead><tr><th>Symbol</th><th>Explanation</th></tr></thead><tbody>
<tr><td><code>ident::ident</code></td><td>Namespace path</td></tr>
<tr><td><code>::path</code></td><td>Path relative to the crate root (i.e., an explicitly absolute path)</td></tr>
<tr><td><code>self::path</code></td><td>Path relative to the current module (i.e., an explicitly relative path).</td></tr>
<tr><td><code>super::path</code></td><td>Path relative to the parent of the current module</td></tr>
<tr><td><code>type::ident</code>, <code>&lt;type as trait&gt;::ident</code></td><td>Associated constants, functions, and types</td></tr>
<tr><td><code>&lt;type&gt;::...</code></td><td>Associated item for a type that cannot be directly named (e.g., <code>&lt;&amp;T&gt;::...</code>, <code>&lt;[T]&gt;::...</code>, etc.)</td></tr>
<tr><td><code>trait::method(...)</code></td><td>Disambiguating a method call by naming the trait that defines it</td></tr>
<tr><td><code>type::method(...)</code></td><td>Disambiguating a method call by naming the type for which itâ€™s defined</td></tr>
<tr><td><code>&lt;type as trait&gt;::method(...)</code></td><td>Disambiguating a method call by naming the trait and type</td></tr>
</tbody></table>
</div>
<p>Table B-4 shows symbols that appear in the context of using generic type
parameters.</p>
<p><span class="caption">Table B-4: Generics</span></p>
<div class="table-wrapper"><table><thead><tr><th>Symbol</th><th>Explanation</th></tr></thead><tbody>
<tr><td><code>path&lt;...&gt;</code></td><td>Specifies parameters to generic type in a type (e.g., <code>Vec&lt;u8&gt;</code>)</td></tr>
<tr><td><code>path::&lt;...&gt;</code>, <code>method::&lt;...&gt;</code></td><td>Specifies parameters to generic type, function, or method in an expression; often referred to as turbofish (e.g., <code>"42".parse::&lt;i32&gt;()</code>)</td></tr>
<tr><td><code>fn ident&lt;...&gt; ...</code></td><td>Define generic function</td></tr>
<tr><td><code>struct ident&lt;...&gt; ...</code></td><td>Define generic structure</td></tr>
<tr><td><code>enum ident&lt;...&gt; ...</code></td><td>Define generic enumeration</td></tr>
<tr><td><code>impl&lt;...&gt; ...</code></td><td>Define generic implementation</td></tr>
<tr><td><code>for&lt;...&gt; type</code></td><td>Higher-ranked lifetime bounds</td></tr>
<tr><td><code>type&lt;ident=type&gt;</code></td><td>A generic type where one or more associated types have specific assignments (e.g., <code>Iterator&lt;Item=T&gt;</code>)</td></tr>
</tbody></table>
</div>
<p>Table B-5 shows symbols that appear in the context of constraining generic type
parameters with trait bounds.</p>
<p><span class="caption">Table B-5: Trait Bound Constraints</span></p>
<div class="table-wrapper"><table><thead><tr><th>Symbol</th><th>Explanation</th></tr></thead><tbody>
<tr><td><code>T: U</code></td><td>Generic parameter <code>T</code> constrained to types that implement <code>U</code></td></tr>
<tr><td><code>T: 'a</code></td><td>Generic type <code>T</code> must outlive lifetime <code>'a</code> (meaning the type cannot transitively contain any references with lifetimes shorter than <code>'a</code>)</td></tr>
<tr><td><code>T: 'static</code></td><td>Generic type <code>T</code> contains no borrowed references other than <code>'static</code> ones</td></tr>
<tr><td><code>'b: 'a</code></td><td>Generic lifetime <code>'b</code> must outlive lifetime <code>'a</code></td></tr>
<tr><td><code>T: ?Sized</code></td><td>Allow generic type parameter to be a dynamically sized type</td></tr>
<tr><td><code>'a + trait</code>, <code>trait + trait</code></td><td>Compound type constraint</td></tr>
</tbody></table>
</div>
<p>Table B-6 shows symbols that appear in the context of calling or defining
macros and specifying attributes on an item.</p>
<p><span class="caption">Table B-6: Macros and Attributes</span></p>
<div class="table-wrapper"><table><thead><tr><th>Symbol</th><th>Explanation</th></tr></thead><tbody>
<tr><td><code>#[meta]</code></td><td>Outer attribute</td></tr>
<tr><td><code>#![meta]</code></td><td>Inner attribute</td></tr>
<tr><td><code>$ident</code></td><td>Macro substitution</td></tr>
<tr><td><code>$ident:kind</code></td><td>Macro capture</td></tr>
<tr><td><code>$(â€¦)â€¦</code></td><td>Macro repetition</td></tr>
<tr><td><code>ident!(...)</code>, <code>ident!{...}</code>, <code>ident![...]</code></td><td>Macro invocation</td></tr>
</tbody></table>
</div>
<p>Table B-7 shows symbols that create comments.</p>
<p><span class="caption">Table B-7: Comments</span></p>
<div class="table-wrapper"><table><thead><tr><th>Symbol</th><th>Explanation</th></tr></thead><tbody>
<tr><td><code>//</code></td><td>Line comment</td></tr>
<tr><td><code>//!</code></td><td>Inner line doc comment</td></tr>
<tr><td><code>///</code></td><td>Outer line doc comment</td></tr>
<tr><td><code>/*...*/</code></td><td>Block comment</td></tr>
<tr><td><code>/*!...*/</code></td><td>Inner block doc comment</td></tr>
<tr><td><code>/**...*/</code></td><td>Outer block doc comment</td></tr>
</tbody></table>
</div>
<p>Table B-8 shows symbols that appear in the context of using tuples.</p>
<p><span class="caption">Table B-8: Tuples</span></p>
<div class="table-wrapper"><table><thead><tr><th>Symbol</th><th>Explanation</th></tr></thead><tbody>
<tr><td><code>()</code></td><td>Empty tuple (aka unit), both literal and type</td></tr>
<tr><td><code>(expr)</code></td><td>Parenthesized expression</td></tr>
<tr><td><code>(expr,)</code></td><td>Single-element tuple expression</td></tr>
<tr><td><code>(type,)</code></td><td>Single-element tuple type</td></tr>
<tr><td><code>(expr, ...)</code></td><td>Tuple expression</td></tr>
<tr><td><code>(type, ...)</code></td><td>Tuple type</td></tr>
<tr><td><code>expr(expr, ...)</code></td><td>Function call expression; also used to initialize tuple <code>struct</code>s and tuple <code>enum</code> variants</td></tr>
<tr><td><code>expr.0</code>, <code>expr.1</code>, etc.</td><td>Tuple indexing</td></tr>
</tbody></table>
</div>
<p>Table B-9 shows the contexts in which curly braces are used.</p>
<p><span class="caption">Table B-9: Curly Brackets</span></p>
<div class="table-wrapper"><table><thead><tr><th>Context</th><th>Explanation</th></tr></thead><tbody>
<tr><td><code>{...}</code></td><td>Block expression</td></tr>
<tr><td><code>Type {...}</code></td><td><code>struct</code> literal</td></tr>
</tbody></table>
</div>
<p>Table B-10 shows the contexts in which square brackets are used.</p>
<p><span class="caption">Table B-10: Square Brackets</span></p>
<div class="table-wrapper"><table><thead><tr><th>Context</th><th>Explanation</th></tr></thead><tbody>
<tr><td><code>[...]</code></td><td>Array literal</td></tr>
<tr><td><code>[expr; len]</code></td><td>Array literal containing <code>len</code> copies of <code>expr</code></td></tr>
<tr><td><code>[type; len]</code></td><td>Array type containing <code>len</code> instances of <code>type</code></td></tr>
<tr><td><code>expr[expr]</code></td><td>Collection indexing. Overloadable (<code>Index</code>, <code>IndexMut</code>)</td></tr>
<tr><td><code>expr[..]</code>, <code>expr[a..]</code>, <code>expr[..b]</code>, <code>expr[a..b]</code></td><td>Collection indexing pretending to be collection slicing, using <code>Range</code>, <code>RangeFrom</code>, <code>RangeTo</code>, or <code>RangeFull</code> as the â€œindexâ€</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h2 id="appendix-c-derivable-traits"><a class="header" href="#appendix-c-derivable-traits">Appendix C: Derivable Traits</a></h2>
<p>In various places in the book, weâ€™ve discussed the <code>derive</code> attribute, which
you can apply to a struct or enum definition. The <code>derive</code> attribute generates
code that will implement a trait with its own default implementation on the
type youâ€™ve annotated with the <code>derive</code> syntax.</p>
<p>In this appendix, we provide a reference of all the traits in the standard
library that you can use with <code>derive</code>. Each section covers:</p>
<ul>
<li>What operators and methods deriving this trait will enable</li>
<li>What the implementation of the trait provided by <code>derive</code> does</li>
<li>What implementing the trait signifies about the type</li>
<li>The conditions in which youâ€™re allowed or not allowed to implement the trait</li>
<li>Examples of operations that require the trait</li>
</ul>
<p>If you want different behavior from that provided by the <code>derive</code> attribute,
consult the <a href="../std/index.html">standard library documentation</a><!-- ignore -->
for each trait for details of how to manually implement them.</p>
<p>These traits listed here are the only ones defined by the standard library that
can be implemented on your types using <code>derive</code>. Other traits defined in the
standard library donâ€™t have sensible default behavior, so itâ€™s up to you to
implement them in the way that makes sense for what youâ€™re trying to accomplish.</p>
<p>An example of a trait that canâ€™t be derived is <code>Display</code>, which handles
formatting for end users. You should always consider the appropriate way to
display a type to an end user. What parts of the type should an end user be
allowed to see? What parts would they find relevant? What format of the data
would be most relevant to them? The Rust compiler doesnâ€™t have this insight, so
it canâ€™t provide appropriate default behavior for you.</p>
<p>The list of derivable traits provided in this appendix is not comprehensive:
libraries can implement <code>derive</code> for their own traits, making the list of
traits you can use <code>derive</code> with truly open-ended. Implementing <code>derive</code>
involves using a procedural macro, which is covered in the
<a href="ch19-06-macros.html#macros">â€œMacrosâ€</a><!-- ignore --> section of Chapter 19.</p>
<h3 id="debug-for-programmer-output"><a class="header" href="#debug-for-programmer-output"><code>Debug</code> for Programmer Output</a></h3>
<p>The <code>Debug</code> trait enables debug formatting in format strings, which you
indicate by adding <code>:?</code> within <code>{}</code> placeholders.</p>
<p>The <code>Debug</code> trait allows you to print instances of a type for debugging
purposes, so you and other programmers using your type can inspect an instance
at a particular point in a programâ€™s execution.</p>
<p>The <code>Debug</code> trait is required, for example, in use of the <code>assert_eq!</code> macro.
This macro prints the values of instances given as arguments if the equality
assertion fails so programmers can see why the two instances werenâ€™t equal.</p>
<h3 id="partialeq-and-eq-for-equality-comparisons"><a class="header" href="#partialeq-and-eq-for-equality-comparisons"><code>PartialEq</code> and <code>Eq</code> for Equality Comparisons</a></h3>
<p>The <code>PartialEq</code> trait allows you to compare instances of a type to check for
equality and enables use of the <code>==</code> and <code>!=</code> operators.</p>
<p>Deriving <code>PartialEq</code> implements the <code>eq</code> method. When <code>PartialEq</code> is derived on
structs, two instances are equal only if <em>all</em> fields are equal, and the
instances are not equal if any fields are not equal. When derived on enums,
each variant is equal to itself and not equal to the other variants.</p>
<p>The <code>PartialEq</code> trait is required, for example, with the use of the
<code>assert_eq!</code> macro, which needs to be able to compare two instances of a type
for equality.</p>
<p>The <code>Eq</code> trait has no methods. Its purpose is to signal that for every value of
the annotated type, the value is equal to itself. The <code>Eq</code> trait can only be
applied to types that also implement <code>PartialEq</code>, although not all types that
implement <code>PartialEq</code> can implement <code>Eq</code>. One example of this is floating point
number types: the implementation of floating point numbers states that two
instances of the not-a-number (<code>NaN</code>) value are not equal to each other.</p>
<p>An example of when <code>Eq</code> is required is for keys in a <code>HashMap&lt;K, V&gt;</code> so the
<code>HashMap&lt;K, V&gt;</code> can tell whether two keys are the same.</p>
<h3 id="partialord-and-ord-for-ordering-comparisons"><a class="header" href="#partialord-and-ord-for-ordering-comparisons"><code>PartialOrd</code> and <code>Ord</code> for Ordering Comparisons</a></h3>
<p>The <code>PartialOrd</code> trait allows you to compare instances of a type for sorting
purposes. A type that implements <code>PartialOrd</code> can be used with the <code>&lt;</code>, <code>&gt;</code>,
<code>&lt;=</code>, and <code>&gt;=</code> operators. You can only apply the <code>PartialOrd</code> trait to types
that also implement <code>PartialEq</code>.</p>
<p>Deriving <code>PartialOrd</code> implements the <code>partial_cmp</code> method, which returns an
<code>Option&lt;Ordering&gt;</code> that will be <code>None</code> when the values given donâ€™t produce an
ordering. An example of a value that doesnâ€™t produce an ordering, even though
most values of that type can be compared, is the not-a-number (<code>NaN</code>) floating
point value. Calling <code>partial_cmp</code> with any floating point number and the <code>NaN</code>
floating point value will return <code>None</code>.</p>
<p>When derived on structs, <code>PartialOrd</code> compares two instances by comparing the
value in each field in the order in which the fields appear in the struct
definition. When derived on enums, variants of the enum declared earlier in the
enum definition are considered less than the variants listed later.</p>
<p>The <code>PartialOrd</code> trait is required, for example, for the <code>gen_range</code> method
from the <code>rand</code> crate that generates a random value in the range specified by a
range expression.</p>
<p>The <code>Ord</code> trait allows you to know that for any two values of the annotated
type, a valid ordering will exist. The <code>Ord</code> trait implements the <code>cmp</code> method,
which returns an <code>Ordering</code> rather than an <code>Option&lt;Ordering&gt;</code> because a valid
ordering will always be possible. You can only apply the <code>Ord</code> trait to types
that also implement <code>PartialOrd</code> and <code>Eq</code> (and <code>Eq</code> requires <code>PartialEq</code>). When
derived on structs and enums, <code>cmp</code> behaves the same way as the derived
implementation for <code>partial_cmp</code> does with <code>PartialOrd</code>.</p>
<p>An example of when <code>Ord</code> is required is when storing values in a <code>BTreeSet&lt;T&gt;</code>,
a data structure that stores data based on the sort order of the values.</p>
<h3 id="clone-and-copy-for-duplicating-values"><a class="header" href="#clone-and-copy-for-duplicating-values"><code>Clone</code> and <code>Copy</code> for Duplicating Values</a></h3>
<p>The <code>Clone</code> trait allows you to explicitly create a deep copy of a value, and
the duplication process might involve running arbitrary code and copying heap
data. See the <a href="ch04-01-what-is-ownership.html#ways-variables-and-data-interact-clone">â€œWays Variables and Data Interact:
Cloneâ€</a><!-- ignore --> section in
Chapter 4 for more information on <code>Clone</code>.</p>
<p>Deriving <code>Clone</code> implements the <code>clone</code> method, which when implemented for the
whole type, calls <code>clone</code> on each of the parts of the type. This means all the
fields or values in the type must also implement <code>Clone</code> to derive <code>Clone</code>.</p>
<p>An example of when <code>Clone</code> is required is when calling the <code>to_vec</code> method on a
slice. The slice doesnâ€™t own the type instances it contains, but the vector
returned from <code>to_vec</code> will need to own its instances, so <code>to_vec</code> calls
<code>clone</code> on each item. Thus, the type stored in the slice must implement <code>Clone</code>.</p>
<p>The <code>Copy</code> trait allows you to duplicate a value by only copying bits stored on
the stack; no arbitrary code is necessary. See the <a href="ch04-01-what-is-ownership.html#stack-only-data-copy">â€œStack-Only Data:
Copyâ€</a><!-- ignore --> section in Chapter 4 for more
information on <code>Copy</code>.</p>
<p>The <code>Copy</code> trait doesnâ€™t define any methods to prevent programmers from
overloading those methods and violating the assumption that no arbitrary code
is being run. That way, all programmers can assume that copying a value will be
very fast.</p>
<p>You can derive <code>Copy</code> on any type whose parts all implement <code>Copy</code>. A type that
implements <code>Copy</code> must also implement <code>Clone</code>, because a type that implements
<code>Copy</code> has a trivial implementation of <code>Clone</code> that performs the same task as
<code>Copy</code>.</p>
<p>The <code>Copy</code> trait is rarely required; types that implement <code>Copy</code> have
optimizations available, meaning you donâ€™t have to call <code>clone</code>, which makes
the code more concise.</p>
<p>Everything possible with <code>Copy</code> you can also accomplish with <code>Clone</code>, but the
code might be slower or have to use <code>clone</code> in places.</p>
<h3 id="hash-for-mapping-a-value-to-a-value-of-fixed-size"><a class="header" href="#hash-for-mapping-a-value-to-a-value-of-fixed-size"><code>Hash</code> for Mapping a Value to a Value of Fixed Size</a></h3>
<p>The <code>Hash</code> trait allows you to take an instance of a type of arbitrary size and
map that instance to a value of fixed size using a hash function. Deriving
<code>Hash</code> implements the <code>hash</code> method. The derived implementation of the <code>hash</code>
method combines the result of calling <code>hash</code> on each of the parts of the type,
meaning all fields or values must also implement <code>Hash</code> to derive <code>Hash</code>.</p>
<p>An example of when <code>Hash</code> is required is in storing keys in a <code>HashMap&lt;K, V&gt;</code>
to store data efficiently.</p>
<h3 id="default-for-default-values"><a class="header" href="#default-for-default-values"><code>Default</code> for Default Values</a></h3>
<p>The <code>Default</code> trait allows you to create a default value for a type. Deriving
<code>Default</code> implements the <code>default</code> function. The derived implementation of the
<code>default</code> function calls the <code>default</code> function on each part of the type,
meaning all fields or values in the type must also implement <code>Default</code> to
derive <code>Default</code>.</p>
<p>The <code>Default::default</code> function is commonly used in combination with the struct
update syntax discussed in the <a href="ch05-01-defining-structs.html#creating-instances-from-other-instances-with-struct-update-syntax">â€œCreating Instances From Other Instances With
Struct Update
Syntaxâ€</a><!-- ignore -->
section in Chapter 5. You can customize a few fields of a struct and then
set and use a default value for the rest of the fields by using
<code>..Default::default()</code>.</p>
<p>The <code>Default</code> trait is required when you use the method <code>unwrap_or_default</code> on
<code>Option&lt;T&gt;</code> instances, for example. If the <code>Option&lt;T&gt;</code> is <code>None</code>, the method
<code>unwrap_or_default</code> will return the result of <code>Default::default</code> for the type
<code>T</code> stored in the <code>Option&lt;T&gt;</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="appendix-d---useful-development-tools"><a class="header" href="#appendix-d---useful-development-tools">Appendix D - Useful Development Tools</a></h2>
<p>In this appendix, we talk about some useful development tools that the Rust
project provides. Weâ€™ll look at automatic formatting, quick ways to apply
warning fixes, a linter, and integrating with IDEs.</p>
<h3 id="automatic-formatting-with-rustfmt"><a class="header" href="#automatic-formatting-with-rustfmt">Automatic Formatting with <code>rustfmt</code></a></h3>
<p>The <code>rustfmt</code> tool reformats your code according to the community code style.
Many collaborative projects use <code>rustfmt</code> to prevent arguments about which
style to use when writing Rust: everyone formats their code using the tool.</p>
<p>To install <code>rustfmt</code>, enter the following:</p>
<pre><code class="language-console">$ rustup component add rustfmt
</code></pre>
<p>This command gives you <code>rustfmt</code> and <code>cargo-fmt</code>, similar to how Rust gives you
both <code>rustc</code> and <code>cargo</code>. To format any Cargo project, enter the following:</p>
<pre><code class="language-console">$ cargo fmt
</code></pre>
<p>Running this command reformats all the Rust code in the current crate. This
should only change the code style, not the code semantics. For more information
on <code>rustfmt</code>, see <a href="https://github.com/rust-lang/rustfmt">its documentation</a>.</p>
<h3 id="fix-your-code-with-rustfix"><a class="header" href="#fix-your-code-with-rustfix">Fix Your Code with <code>rustfix</code></a></h3>
<p>The rustfix tool is included with Rust installations and can automatically fix
compiler warnings that have a clear way to correct the problem thatâ€™s likely
what you want. Itâ€™s likely youâ€™ve seen compiler warnings before. For example,
consider this code:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn do_something() {}

fn main() {
    for i in 0..100 {
        do_something();
    }
}</code></pre></pre>
<p>Here, weâ€™re calling the <code>do_something</code> function 100 times, but we never use the
variable <code>i</code> in the body of the <code>for</code> loop. Rust warns us about that:</p>
<pre><code class="language-console">$ cargo build
   Compiling myprogram v0.1.0 (file:///projects/myprogram)
warning: unused variable: `i`
 --&gt; src/main.rs:4:9
  |
4 |     for i in 0..100 {
  |         ^ help: consider using `_i` instead
  |
  = note: #[warn(unused_variables)] on by default

    Finished dev [unoptimized + debuginfo] target(s) in 0.50s
</code></pre>
<p>The warning suggests that we use <code>_i</code> as a name instead: the underscore
indicates that we intend for this variable to be unused. We can automatically
apply that suggestion using the <code>rustfix</code> tool by running the command <code>cargo fix</code>:</p>
<pre><code class="language-console">$ cargo fix
    Checking myprogram v0.1.0 (file:///projects/myprogram)
      Fixing src/main.rs (1 fix)
    Finished dev [unoptimized + debuginfo] target(s) in 0.59s
</code></pre>
<p>When we look at <em>src/main.rs</em> again, weâ€™ll see that <code>cargo fix</code> has changed the
code:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn do_something() {}

fn main() {
    for _i in 0..100 {
        do_something();
    }
}</code></pre></pre>
<p>The <code>for</code> loop variable is now named <code>_i</code>, and the warning no longer appears.</p>
<p>You can also use the <code>cargo fix</code> command to transition your code between
different Rust editions. Editions are covered in Appendix E.</p>
<h3 id="more-lints-with-clippy"><a class="header" href="#more-lints-with-clippy">More Lints with Clippy</a></h3>
<p>The Clippy tool is a collection of lints to analyze your code so you can catch
common mistakes and improve your Rust code.</p>
<p>To install Clippy, enter the following:</p>
<pre><code class="language-console">$ rustup component add clippy
</code></pre>
<p>To run Clippyâ€™s lints on any Cargo project, enter the following:</p>
<pre><code class="language-console">$ cargo clippy
</code></pre>
<p>For example, say you write a program that uses an approximation of a
mathematical constant, such as pi, as this program does:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let x = 3.1415;
    let r = 8.0;
    println!("the area of the circle is {}", x * r * r);
}</code></pre></pre>
<p>Running <code>cargo clippy</code> on this project results in this error:</p>
<pre><code class="language-text">error: approximate value of `f{32, 64}::consts::PI` found
 --&gt; src/main.rs:2:13
  |
2 |     let x = 3.1415;
  |             ^^^^^^
  |
  = note: `#[deny(clippy::approx_constant)]` on by default
  = help: consider using the constant directly
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#approx_constant
</code></pre>
<p>This error lets you know that Rust already has a more precise <code>PI</code> constant
defined, and that your program would be more correct if you used the constant
instead. You would then change your code to use the <code>PI</code> constant. The
following code doesnâ€™t result in any errors or warnings from Clippy:</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024">fn main() {
    let x = std::f64::consts::PI;
    let r = 8.0;
    println!("the area of the circle is {}", x * r * r);
}</code></pre></pre>
<p>For more information on Clippy, see <a href="https://github.com/rust-lang/rust-clippy">its documentation</a>.</p>
<h3 id="ide-integration-using-rust-analyzer"><a class="header" href="#ide-integration-using-rust-analyzer">IDE Integration Using <code>rust-analyzer</code></a></h3>
<p>To help IDE integration, the Rust community recommends using
<a href="https://rust-analyzer.github.io"><code>rust-analyzer</code></a><!-- ignore -->. This tool is a set of
compiler-centric utilities that speaks the <a href="http://langserver.org/">Language Server Protocol</a><!--
ignore -->, which is a specification for IDEs and programming languages to
communicate with each other. Different clients can use <code>rust-analyzer</code>, such as
<a href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer">the Rust analyzer plug-in for Visual Studio Code</a>.</p>
<p>Visit the <code>rust-analyzer</code> projectâ€™s <a href="https://rust-analyzer.github.io">home page</a><!-- ignore -->
for installation instructions, then install the language server support in your
particular IDE. Your IDE will gain abilities such as autocompletion, jump to
definition, and inline errors.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="appendix-e---editions"><a class="header" href="#appendix-e---editions">Appendix E - Editions</a></h2>
<p>In Chapter 1, you saw that <code>cargo new</code> adds a bit of metadata to your
<em>Cargo.toml</em> file about an edition. This appendix talks about what that means!</p>
<p>The Rust language and compiler have a six-week release cycle, meaning users get
a constant stream of new features. Other programming languages release larger
changes less often; Rust releases smaller updates more frequently. After a
while, all of these tiny changes add up. But from release to release, it can be
difficult to look back and say, â€œWow, between Rust 1.10 and Rust 1.31, Rust has
changed a lot!â€</p>
<p>Every two or three years, the Rust team produces a new Rust <em>edition</em>. Each
edition brings together the features that have landed into a clear package with
fully updated documentation and tooling. New editions ship as part of the usual
six-week release process.</p>
<p>Editions serve different purposes for different people:</p>
<ul>
<li>For active Rust users, a new edition brings together incremental changes into
an easy-to-understand package.</li>
<li>For non-users, a new edition signals that some major advancements have
landed, which might make Rust worth another look.</li>
<li>For those developing Rust, a new edition provides a rallying point for the
project as a whole.</li>
</ul>
<p>At the time of this writing, three Rust editions are available: Rust 2015, Rust
2018, and Rust 2021. This book is written using Rust 2021 edition idioms.</p>
<p>The <code>edition</code> key in <em>Cargo.toml</em> indicates which edition the compiler should
use for your code. If the key doesnâ€™t exist, Rust uses <code>2015</code> as the edition
value for backward compatibility reasons.</p>
<p>Each project can opt in to an edition other than the default 2015 edition.
Editions can contain incompatible changes, such as including a new keyword that
conflicts with identifiers in code. However, unless you opt in to those
changes, your code will continue to compile even as you upgrade the Rust
compiler version you use.</p>
<p>All Rust compiler versions support any edition that existed prior to that
compilerâ€™s release, and they can link crates of any supported editions
together. Edition changes only affect the way the compiler initially parses
code. Therefore, if youâ€™re using Rust 2015 and one of your dependencies uses
Rust 2018, your project will compile and be able to use that dependency. The
opposite situation, where your project uses Rust 2018 and a dependency uses
Rust 2015, works as well.</p>
<p>To be clear: most features will be available on all editions. Developers using
any Rust edition will continue to see improvements as new stable releases are
made. However, in some cases, mainly when new keywords are added, some new
features might only be available in later editions. You will need to switch
editions if you want to take advantage of such features.</p>
<p>For more details, the <a href="https://doc.rust-lang.org/stable/edition-guide/"><em>Edition
Guide</em></a> is a complete book
about editions that enumerates the differences between editions and explains
how to automatically upgrade your code to a new edition via <code>cargo fix</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="appendix-f-translations-of-the-book"><a class="header" href="#appendix-f-translations-of-the-book">Appendix F: Translations of the Book</a></h2>
<p>For resources in languages other than English. Most are still in progress; see
<a href="https://github.com/rust-lang/book/issues?q=is%3Aopen+is%3Aissue+label%3ATranslations">the Translations label</a> to help or let us know about a new translation!</p>
<ul>
<li><a href="https://github.com/rust-br/rust-book-pt-br">PortuguÃªs</a> (BR)</li>
<li><a href="https://github.com/nunojesus/rust-book-pt-pt">PortuguÃªs</a> (PT)</li>
<li><a href="https://github.com/KaiserY/trpl-zh-cn">ç®€ä½“ä¸­æ–‡</a></li>
<li><a href="https://github.com/rust-tw/book-tw">æ­£é«”ä¸­æ–‡</a></li>
<li><a href="https://github.com/pavloslav/rust-book-uk-ua">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</a></li>
<li><a href="https://github.com/thecodix/book">EspaÃ±ol</a>, <a href="https://github.com/ManRR/rust-book-es">alternate</a></li>
<li><a href="https://github.com/Ciro-Fusco/book_it">Italiano</a></li>
<li><a href="https://github.com/rust-lang-ru/book">Ğ ÑƒÑÑĞºĞ¸Ğ¹</a></li>
<li><a href="https://github.com/rinthel/rust-lang-book-ko">í•œêµ­ì–´</a></li>
<li><a href="https://github.com/rust-lang-ja/book-ja">æ—¥æœ¬èª</a></li>
<li><a href="https://github.com/Jimskapt/rust-book-fr">FranÃ§ais</a></li>
<li><a href="https://github.com/paytchoo/book-pl">Polski</a></li>
<li><a href="https://github.com/agentzero1/book">Cebuano</a></li>
<li><a href="https://github.com/josephace135/book">Tagalog</a></li>
<li><a href="https://github.com/psychoslave/Rust-libro">Esperanto</a></li>
<li><a href="https://github.com/TChatzigiannakis/rust-book-greek">ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</a></li>
<li><a href="https://github.com/sebras/book">Svenska</a></li>
<li><a href="https://github.com/pomokhtari/rust-book-fa">Farsi</a></li>
<li><a href="https://github.com/rust-lang-de/rustbook-de">Deutsch</a></li>
<li><a href="https://github.com/venkatarun95/rust-book-hindi">à¤¹à¤¿à¤‚à¤¦à¥€</a></li>
<li><a href="https://github.com/rust-lang-th/book-th">à¹„à¸—à¸¢</a></li>
<li><a href="https://github.com/DanKHansen/book-dk">Danske</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="appendix-g---how-rust-is-made-and-nightly-rust"><a class="header" href="#appendix-g---how-rust-is-made-and-nightly-rust">Appendix G - How Rust is Made and â€œNightly Rustâ€</a></h2>
<p>This appendix is about how Rust is made and how that affects you as a Rust
developer.</p>
<h3 id="stability-without-stagnation"><a class="header" href="#stability-without-stagnation">Stability Without Stagnation</a></h3>
<p>As a language, Rust cares a <em>lot</em> about the stability of your code. We want
Rust to be a rock-solid foundation you can build on, and if things were
constantly changing, that would be impossible. At the same time, if we canâ€™t
experiment with new features, we may not find out important flaws until after
their release, when we can no longer change things.</p>
<p>Our solution to this problem is what we call â€œstability without stagnationâ€,
and our guiding principle is this: you should never have to fear upgrading to a
new version of stable Rust. Each upgrade should be painless, but should also
bring you new features, fewer bugs, and faster compile times.</p>
<h3 id="choo-choo-release-channels-and-riding-the-trains"><a class="header" href="#choo-choo-release-channels-and-riding-the-trains">Choo, Choo! Release Channels and Riding the Trains</a></h3>
<p>Rust development operates on a <em>train schedule</em>. That is, all development is
done on the <code>master</code> branch of the Rust repository. Releases follow a software
release train model, which has been used by Cisco IOS and other software
projects. There are three <em>release channels</em> for Rust:</p>
<ul>
<li>Nightly</li>
<li>Beta</li>
<li>Stable</li>
</ul>
<p>Most Rust developers primarily use the stable channel, but those who want to
try out experimental new features may use nightly or beta.</p>
<p>Hereâ€™s an example of how the development and release process works: letâ€™s
assume that the Rust team is working on the release of Rust 1.5. That release
happened in December of 2015, but it will provide us with realistic version
numbers. A new feature is added to Rust: a new commit lands on the <code>master</code>
branch. Each night, a new nightly version of Rust is produced. Every day is a
release day, and these releases are created by our release infrastructure
automatically. So as time passes, our releases look like this, once a night:</p>
<pre><code class="language-text">nightly: * - - * - - *
</code></pre>
<p>Every six weeks, itâ€™s time to prepare a new release! The <code>beta</code> branch of the
Rust repository branches off from the <code>master</code> branch used by nightly. Now,
there are two releases:</p>
<pre><code class="language-text">nightly: * - - * - - *
                     |
beta:                *
</code></pre>
<p>Most Rust users do not use beta releases actively, but test against beta in
their CI system to help Rust discover possible regressions. In the meantime,
thereâ€™s still a nightly release every night:</p>
<pre><code class="language-text">nightly: * - - * - - * - - * - - *
                     |
beta:                *
</code></pre>
<p>Letâ€™s say a regression is found. Good thing we had some time to test the beta
release before the regression snuck into a stable release! The fix is applied
to <code>master</code>, so that nightly is fixed, and then the fix is backported to the
<code>beta</code> branch, and a new release of beta is produced:</p>
<pre><code class="language-text">nightly: * - - * - - * - - * - - * - - *
                     |
beta:                * - - - - - - - - *
</code></pre>
<p>Six weeks after the first beta was created, itâ€™s time for a stable release! The
<code>stable</code> branch is produced from the <code>beta</code> branch:</p>
<pre><code class="language-text">nightly: * - - * - - * - - * - - * - - * - * - *
                     |
beta:                * - - - - - - - - *
                                       |
stable:                                *
</code></pre>
<p>Hooray! Rust 1.5 is done! However, weâ€™ve forgotten one thing: because the six
weeks have gone by, we also need a new beta of the <em>next</em> version of Rust, 1.6.
So after <code>stable</code> branches off of <code>beta</code>, the next version of <code>beta</code> branches
off of <code>nightly</code> again:</p>
<pre><code class="language-text">nightly: * - - * - - * - - * - - * - - * - * - *
                     |                         |
beta:                * - - - - - - - - *       *
                                       |
stable:                                *
</code></pre>
<p>This is called the â€œtrain modelâ€ because every six weeks, a release â€œleaves the
stationâ€, but still has to take a journey through the beta channel before it
arrives as a stable release.</p>
<p>Rust releases every six weeks, like clockwork. If you know the date of one Rust
release, you can know the date of the next one: itâ€™s six weeks later. A nice
aspect of having releases scheduled every six weeks is that the next train is
coming soon. If a feature happens to miss a particular release, thereâ€™s no need
to worry: another one is happening in a short time! This helps reduce pressure
to sneak possibly unpolished features in close to the release deadline.</p>
<p>Thanks to this process, you can always check out the next build of Rust and
verify for yourself that itâ€™s easy to upgrade to: if a beta release doesnâ€™t
work as expected, you can report it to the team and get it fixed before the
next stable release happens! Breakage in a beta release is relatively rare, but
<code>rustc</code> is still a piece of software, and bugs do exist.</p>
<h3 id="unstable-features"><a class="header" href="#unstable-features">Unstable Features</a></h3>
<p>Thereâ€™s one more catch with this release model: unstable features. Rust uses a
technique called â€œfeature flagsâ€ to determine what features are enabled in a
given release. If a new feature is under active development, it lands on
<code>master</code>, and therefore, in nightly, but behind a <em>feature flag</em>. If you, as a
user, wish to try out the work-in-progress feature, you can, but you must be
using a nightly release of Rust and annotate your source code with the
appropriate flag to opt in.</p>
<p>If youâ€™re using a beta or stable release of Rust, you canâ€™t use any feature
flags. This is the key that allows us to get practical use with new features
before we declare them stable forever. Those who wish to opt into the bleeding
edge can do so, and those who want a rock-solid experience can stick with
stable and know that their code wonâ€™t break. Stability without stagnation.</p>
<p>This book only contains information about stable features, as in-progress
features are still changing, and surely theyâ€™ll be different between when this
book was written and when they get enabled in stable builds. You can find
documentation for nightly-only features online.</p>
<h3 id="rustup-and-the-role-of-rust-nightly"><a class="header" href="#rustup-and-the-role-of-rust-nightly">Rustup and the Role of Rust Nightly</a></h3>
<p>Rustup makes it easy to change between different release channels of Rust, on a
global or per-project basis. By default, youâ€™ll have stable Rust installed. To
install nightly, for example:</p>
<pre><code class="language-console">$ rustup toolchain install nightly
</code></pre>
<p>You can see all of the <em>toolchains</em> (releases of Rust and associated
components) you have installed with <code>rustup</code> as well. Hereâ€™s an example on one
of your authorsâ€™ Windows computer:</p>
<pre><code class="language-powershell">&gt; rustup toolchain list
stable-x86_64-pc-windows-msvc (default)
beta-x86_64-pc-windows-msvc
nightly-x86_64-pc-windows-msvc
</code></pre>
<p>As you can see, the stable toolchain is the default. Most Rust users use stable
most of the time. You might want to use stable most of the time, but use
nightly on a specific project, because you care about a cutting-edge feature.
To do so, you can use <code>rustup override</code> in that projectâ€™s directory to set the
nightly toolchain as the one <code>rustup</code> should use when youâ€™re in that directory:</p>
<pre><code class="language-console">$ cd ~/projects/needs-nightly
$ rustup override set nightly
</code></pre>
<p>Now, every time you call <code>rustc</code> or <code>cargo</code> inside of
<em>~/projects/needs-nightly</em>, <code>rustup</code> will make sure that you are using nightly
Rust, rather than your default of stable Rust. This comes in handy when you
have a lot of Rust projects!</p>
<h3 id="the-rfc-process-and-teams"><a class="header" href="#the-rfc-process-and-teams">The RFC Process and Teams</a></h3>
<p>So how do you learn about these new features? Rustâ€™s development model follows
a <em>Request For Comments (RFC) process</em>. If youâ€™d like an improvement in Rust,
you can write up a proposal, called an RFC.</p>
<p>Anyone can write RFCs to improve Rust, and the proposals are reviewed and
discussed by the Rust team, which is comprised of many topic subteams. Thereâ€™s
a full list of the teams <a href="https://www.rust-lang.org/governance">on Rustâ€™s
website</a>, which includes teams for
each area of the project: language design, compiler implementation,
infrastructure, documentation, and more. The appropriate team reads the
proposal and the comments, writes some comments of their own, and eventually,
thereâ€™s consensus to accept or reject the feature.</p>
<p>If the feature is accepted, an issue is opened on the Rust repository, and
someone can implement it. The person who implements it very well may not be the
person who proposed the feature in the first place! When the implementation is
ready, it lands on the <code>master</code> branch behind a feature gate, as we discussed
in the <a href="appendix-07-nightly-rust.html#unstable-features">â€œUnstable Featuresâ€</a><!-- ignore --> section.</p>
<p>After some time, once Rust developers who use nightly releases have been able
to try out the new feature, team members will discuss the feature, how itâ€™s
worked out on nightly, and decide if it should make it into stable Rust or not.
If the decision is to move forward, the feature gate is removed, and the
feature is now considered stable! It rides the trains into a new stable release
of Rust.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="ferris.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>

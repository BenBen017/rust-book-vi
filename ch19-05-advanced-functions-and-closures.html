<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Advanced Functions and Closures - The Rust Programming Language</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="ferris.css">
        <link rel="stylesheet" href="theme/2018-edition.css">
        <link rel="stylesheet" href="theme/semantic-notes.css">
        <link rel="stylesheet" href="theme/listing.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Programming Language</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="hàm-và-closures-nâng-cao"><a class="header" href="#hàm-và-closures-nâng-cao">Hàm và Closures Nâng Cao</a></h2>
<p>Phần này khám phá một số tính năng nâng cao liên quan đến hàm và closures, bao gồm con trỏ hàm và việc trả về closures.</p>
<h3 id="con-trỏ-hàm"><a class="header" href="#con-trỏ-hàm">Con Trỏ Hàm</a></h3>
<p>Chúng ta đã nói về cách truyền closures vào hàm; bạn cũng có thể truyền các hàm thông thường vào hàm! Kỹ thuật này hữu ích khi bạn muốn truyền một hàm đã định nghĩa thay vì định nghĩa một closure mới. Các hàm tự động chuyển sang kiểu <code>fn</code> (với chữ f thường), không nhầm lẫn với trait closure <code>Fn</code>. Kiểu <code>fn</code> được gọi là <em>con trỏ hàm</em>. Việc truyền các hàm bằng con trỏ hàm cho phép bạn sử dụng các hàm như các đối số cho các hàm khác.</p>
<p>Cú pháp để chỉ định rằng một tham số là con trỏ hàm tương tự như cú pháp của closures, như được minh họa trong Listing 19-27, nơi chúng ta đã định nghĩa một hàm <code>add_one</code> cộng một vào tham số của nó. Hàm <code>do_twice</code> nhận hai tham số: một con trỏ hàm tới bất kỳ hàm nào nhận một tham số <code>i32</code> và trả về <code>i32</code>, và một giá trị <code>i32</code>. Hàm <code>do_twice</code> gọi hàm <code>f</code> hai lần, truyền cho nó giá trị <code>arg</code>, sau đó cộng kết quả của hai lần gọi hàm lại với nhau. Hàm <code>main</code> gọi <code>do_twice</code> với các đối số <code>add_one</code> và <code>5</code>.</p>
<p><span class="filename">Filename: src/main.rs</span></p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/listing-19-27/src/main.rs}}
<span class="boring">}</span></code></pre></pre>
<p><span class="caption">Listing 19-27: Sử dụng kiểu <code>fn</code> để nhận con trỏ hàm làm đối số</span></p>
<p>Đoạn mã này in ra <code>The answer is: 12</code>. Chúng ta chỉ định rằng tham số <code>f</code> trong <code>do_twice</code> là một <code>fn</code> nhận một tham số kiểu <code>i32</code> và trả về <code>i32</code>. Sau đó, chúng ta có thể gọi <code>f</code> trong thân hàm <code>do_twice</code>. Trong <code>main</code>, chúng ta có thể truyền tên hàm <code>add_one</code> làm đối số đầu tiên cho <code>do_twice</code>.</p>
<p>Khác với closures, <code>fn</code> là một kiểu chứ không phải trait, vì vậy chúng ta chỉ định <code>fn</code> làm kiểu tham số trực tiếp thay vì khai báo một tham số generic với một trong các trait <code>Fn</code> làm ràng buộc trait.</p>
<p>Con trỏ hàm triển khai cả ba trait của closure (<code>Fn</code>, <code>FnMut</code> và <code>FnOnce</code>), nghĩa là bạn luôn có thể truyền một con trỏ hàm làm đối số cho một hàm yêu cầu một closure. Tốt nhất là viết các hàm sử dụng kiểu generic và một trong các trait của closure để hàm của bạn có thể chấp nhận cả hàm và closures.</p>
<p>Tuy nhiên, một ví dụ về trường hợp bạn chỉ muốn nhận <code>fn</code> mà không phải closures là khi tương tác với mã bên ngoài không có closures: các hàm C có thể nhận các hàm làm đối số, nhưng C không có closures.</p>
<p>Lấy ví dụ về nơi bạn có thể sử dụng một closure được định nghĩa inline hoặc một hàm có tên, hãy xem cách sử dụng phương thức <code>map</code> do trait <code>Iterator</code> cung cấp trong thư viện chuẩn. Để sử dụng hàm <code>map</code> để biến một vector các số thành một vector các chuỗi, chúng ta có thể sử dụng một closure, như sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-15-map-closure/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>Hoặc chúng ta có thể đặt tên một hàm làm đối số cho <code>map</code> thay vì sử dụng closure, như sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-16-map-function/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>Lưu ý rằng chúng ta phải sử dụng cú pháp đầy đủ mà chúng ta đã nói trước đó trong phần <a href="ch19-03-advanced-traits.html#advanced-traits">“Advanced Traits”</a><!-- ignore --> vì có nhiều hàm cùng tên <code>to_string</code> có sẵn. Ở đây, chúng ta đang sử dụng hàm <code>to_string</code> được định nghĩa trong trait <code>ToString</code>, mà thư viện chuẩn đã triển khai cho bất kỳ kiểu nào thực thi trait <code>Display</code>.</p>
<p>Nhớ lại từ phần <a href="ch06-01-defining-an-enum.html#enum-values">“Enum values”</a><!-- ignore --> trong Chương 6 rằng tên của mỗi biến thể enum mà chúng ta định nghĩa cũng trở thành một hàm khởi tạo. Chúng ta có thể sử dụng các hàm khởi tạo này như các con trỏ hàm triển khai các trait của closure, nghĩa là chúng ta có thể chỉ định các hàm khởi tạo làm đối số cho các phương thức nhận closure, như sau:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-17-map-initializer/src/main.rs:here}}
<span class="boring">}</span></code></pre></pre>
<p>Ở đây chúng ta tạo các instance <code>Status::Value</code> sử dụng từng giá trị <code>u32</code> trong phạm vi mà <code>map</code> được gọi bằng cách sử dụng hàm khởi tạo của <code>Status::Value</code>. Một số người thích phong cách này, trong khi một số người thích dùng closures. Chúng biên dịch ra cùng một mã, vì vậy hãy sử dụng phong cách nào rõ ràng hơn với bạn.</p>
<h3 id="trả-về-closures"><a class="header" href="#trả-về-closures">Trả về Closures</a></h3>
<p>Closures được biểu diễn bằng các trait, nghĩa là bạn không thể trả về closures trực tiếp. Trong hầu hết các trường hợp mà bạn muốn trả về một trait, bạn có thể thay vào đó sử dụng kiểu cụ thể triển khai trait làm giá trị trả về của hàm. Tuy nhiên, bạn không thể làm điều đó với closures vì chúng không có kiểu cụ thể có thể trả về; ví dụ, bạn không được phép sử dụng con trỏ hàm <code>fn</code> làm kiểu trả về.</p>
<p>Đoạn mã sau cố gắng trả về một closure trực tiếp, nhưng sẽ không biên dịch:</p>
<pre><code class="language-rust ignore does_not_compile">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-18-returns-closure/src/lib.rs}}</code></pre>
<p>Lỗi biên dịch sẽ như sau:</p>
<pre><code class="language-console">{{#include ../listings/ch19-advanced-features/no-listing-18-returns-closure/output.txt}}
</code></pre>
<p>Lỗi này lại liên quan đến trait <code>Sized</code>! Rust không biết cần bao nhiêu bộ nhớ để lưu closure. Chúng ta đã thấy một giải pháp cho vấn đề này trước đó. Chúng ta có thể sử dụng một trait object:</p>
<pre><code class="language-rust noplayground">{{#rustdoc_include ../listings/ch19-advanced-features/no-listing-19-returns-closure-trait-object/src/lib.rs}}</code></pre>
<p>Đoạn mã này sẽ biên dịch bình thường. Để tìm hiểu thêm về trait objects, tham khảo phần <a href="ch17-02-trait-objects.html#using-trait-objects-that-allow-for-values-of-different-types">“Using Trait Objects That Allow for Values of Different Types”</a><!-- ignore --> trong Chương 17.</p>
<p>Tiếp theo, hãy cùng xem về macros!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch19-04-advanced-types.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="ch19-06-macros.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch19-04-advanced-types.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="ch19-06-macros.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="ferris.js"></script>



    </div>
    </body>
</html>
